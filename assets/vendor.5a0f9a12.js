var GCe=Object.defineProperty,jCe=Object.defineProperties;var HCe=Object.getOwnPropertyDescriptors;var L4=Object.getOwnPropertySymbols;var cQ=Object.prototype.hasOwnProperty,hQ=Object.prototype.propertyIsEnumerable;var lQ=(e,t,i)=>t in e?GCe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ie=(e,t)=>{for(var i in t||(t={}))cQ.call(t,i)&&lQ(e,i,t[i]);if(L4)for(var i of L4(t))hQ.call(t,i)&&lQ(e,i,t[i]);return e},qe=(e,t)=>jCe(e,HCe(t));var wF=(e,t)=>{var i={};for(var r in e)cQ.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&L4)for(var r of L4(e))t.indexOf(r)<0&&hQ.call(e,r)&&(i[r]=e[r]);return i};function pL(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function xO(e,t,i){if(!pL(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Khe(e,t,i){if(!pL(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=xO(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const qCe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function kb({key:e}){return qCe[e]||e}const F1=null;function L(e){return e!=null}function J(e){return e==null}function hxt(e){return e===void 0}function Da(e,t){return L(e)?t(e):F1}function uxt(e){return e}function WCe(e,t){if(J(e))throw new Error(t);return e}function Wt(e,t){return L(e)?e:typeof t=="function"?t():t}function dxt(e,t){return L(e)?e:t}function Ht(e){return L(e)&&e.destroy(),null}function Xt(e){return L(e)&&e.dispose(),null}function _o(e){return L(e)&&e.remove(),null}function Ql(e){return L(e)&&e.abort(),null}function es(e){return L(e)&&e.release(),null}function pxt(e,t){return L(e)&&L(t)?e.equals(t):e===t}function XCe(e){return null}function fxt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);L(s)&&i.push(s)}),i}function mxt(e,t){const i=new Array;for(const r of e)i.push(kc(r,null,t));return i}function gxt(e,t){for(const i of e)Da(i,t)}function kc(e,t,i){return L(e)?i(e):t}function yxt(e){return e.filter(t=>L(t))}function Ss(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function vxt(e){return e}function GT(e){return Hp(()=>e.forEach(t=>L(t)&&t.remove()))}function Hp(e){return{remove:()=>{e&&(e(),e=void 0)}}}function _xt(e){return Hp(()=>{const t=e();L(t)&&t.remove()})}function bxt(e){return Hp(L(e)?()=>e.destroy():void 0)}function YCe(e,t){const i=setTimeout(e,t);return Hp(()=>clearTimeout(i))}function JCe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const fL=JCe(globalThis);class Wu{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Wu._m:t}getInt(){return this._seed=(Wu._a*this._seed+Wu._c)%Wu._m,this._seed}getFloat(){return this.getInt()/(Wu._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Wu._m*r}}Wu._m=2147483647,Wu._a=48271,Wu._c=0;function mL(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function $2(e,t,i){if(J(e)&&J(t))return!0;if(J(e)||J(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function ZCe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(a=>i(a,n))),s=e.filter(n=>!t.some(a=>i(a,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function KCe(e){return e&&typeof e.length=="number"}function wxt(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const QCe=!!Array.prototype.fill;function xxt(e,t){if(QCe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function eMe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function tMe(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const l=s+Math.floor((n-s)/2);t>e[l]?s=l+1:n=l}const a=e[s];return i?t>=e[r-1]?-1:a===t?s:s-1:a===t?s:-1}function Txt(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class Qhe{constructor(){this.last=0}}const eue=new Qhe;function tue(e,t,i,r){r=r||eue;const s=Math.max(0,r.last-10);for(let a=s;a<i;++a)if(e[a]===t)return r.last=a,a;const n=Math.min(s,i);for(let a=0;a<n;++a)if(e[a]===t)return r.last=a,a;return-1}function gL(e,t,i,r){const s=i==null?e.length:i,n=tue(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const Ed=new Set;function iMe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;Ed.clear();for(let l=0;l<r;++l)Ed.add(t[l]);s=s||eue;const a=Math.max(0,s.last-10);for(let l=a;l<i;++l)if(Ed.has(e[l])&&(n&&n.push(e[l]),Ed.delete(e[l]),e[l]=e[i-1],--i,--l,Ed.size===0||i===0))return Ed.clear(),i;for(let l=0;l<a;++l)if(Ed.has(e[l])&&(n&&n.push(e[l]),Ed.delete(e[l]),e[l]=e[i-1],--i,--l,Ed.size===0||i===0))return Ed.clear(),i;return Ed.clear(),i}function rMe(e){return e?(uQ.seed=e,()=>uQ.getFloat()):Math.random}function Sxt(e,t){const i=rMe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const uQ=new Wu;function Iq(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}var dQ,pQ;let eg;var fQ,mQ;(dQ=globalThis.dojoConfig)!=null&&dQ.has||(pQ=globalThis.esriConfig)!=null&&pQ.has?eg=ie(ie({},(fQ=globalThis.dojoConfig)==null?void 0:fQ.has),(mQ=globalThis.esriConfig)==null?void 0:mQ.has):eg={};function je(e){return typeof eg[e]=="function"?eg[e]=eg[e](globalThis):eg[e]}je.add=(e,t,i,r)=>((r||eg[e]===void 0)&&(eg[e]=t),i&&je(e)),je.cache=eg,je.add("esri-deprecation-warnings",!0),(()=>{var e;je.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(je.add("host-browser",t),je.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),je.add("dom",t),je("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(je.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),je.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),je.add("khtml",s.includes("Konqueror")?n:void 0),je.add("edge",parseFloat(r.split("Edge/")[1])||void 0),je.add("opr",parseFloat(r.split("OPR/")[1])||void 0),je.add("webkit",!je("wp")&&!je("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),je.add("chrome",!je("edge")&&!je("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),je.add("android",!je("wp")&&parseFloat(r.split("Android ")[1])||void 0),je.add("safari",!s.includes("Safari")||je("wp")||je("chrome")||je("android")||je("edge")||je("opr")?void 0:parseFloat(s.split("Version/")[1])),je.add("mac",s.includes("Macintosh")),!je("wp")&&r.match(/(iPhone|iPod|iPad)/)){const a=RegExp.$1.replace(/P/,"p"),l=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",p=parseFloat(l.replace(/_/,".").replace(/_/g,""));je.add(a,p),je.add("ios",p)}je.add("trident",parseFloat(s.split("Trident/")[1])||void 0),je("webkit")||(!r.includes("Gecko")||je("wp")||je("khtml")||je("trident")||je("edge")||je.add("mozilla",n),je("mozilla")&&je.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&je.add("esri-mobile",t),i&&je.add("esri-iPhone",i),je.add("esri-geolocation",!!navigator.geolocation)}je.add("esri-canvas-svg-support",!je("trident")),je.add("esri-wasm","WebAssembly"in globalThis),je.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),je.add("esri-atomics","Atomics"in globalThis),je.add("esri-workers","Worker"in globalThis),je.add("web-feat:cache","caches"in globalThis),je.add("esri-workers-arraybuffer-transfer",!je("safari")||Number(je("safari"))>=12),je.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),je.add("featurelayer-simplify-payload-size-factors",[1,1,4]),je.add("featurelayer-snapshot-enabled",!0),je.add("featurelayer-snapshot-point-min-threshold",8e4),je.add("featurelayer-snapshot-point-max-threshold",4e5),je.add("featurelayer-snapshot-point-coverage",.1),je.add("featurelayer-advanced-symbols",!1),je.add("featurelayer-pbf",!0),je.add("featurelayer-pbf-statistics",!1),je.add("feature-layers-workers",!0),je.add("feature-polyline-generalization-factor",1),je.add("mapview-transitions-duration",200),je.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),je.add("mapserver-pbf-enabled",!1),je("host-webworker")||je("host-browser")&&(je.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),je.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{je.add("esri-image-decode",!0,!0,!0)}).catch(()=>{je.add("esri-image-decode",!1,!0,!0)})}return!1}),je.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function sMe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function $q(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function DE(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function nMe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function Ub(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function oMe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function aMe(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function V$(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function lMe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function G$(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function iue(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function rue(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function cMe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function N4(e){return J(e)?0:128+e.buffer.byteLength+64}function sue(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&sue(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function Fe(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=lue(e);if(L(t))return t;if(nue(e))return e.clone();if(oue(e))return e.map(Fe);if(aue(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=Fe(e[r]);return i}function gz(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=lue(e);if(L(t))return t;if(oue(e)){let i=!0;const r=e.map(s=>{const n=gz(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(nue(e))return e.clone();if(!aue(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=gz(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function nue(e){return typeof e.clone=="function"}function oue(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function aue(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function lue(e){if(nMe(e)||Ub(e)||oMe(e)||aMe(e)||V$(e)||lMe(e)||G$(e)||iue(e)||rue(e))return $q(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,Fe(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(Fe(i))}),t}return null}function yL(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function cue(e,t,i=!1){return uue(e,t,i)}function iE(e,t){if(t!=null)return t[e]||hue(e.split("."),!1,t)}function Kh(e,t,i){const r=e.split("."),s=r.pop(),n=hue(r,!0,i);n&&s&&(n[s]=t)}function hue(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function uue(e,t,i){return t?Object.keys(t).reduce(function(r,s){let n=r[s],a=t[s];return n===a?r:n===void 0?(r[s]=Fe(a),r):(Array.isArray(a)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],a&&(Array.isArray(a)||(a=[a]),i?a.forEach(l=>{n.indexOf(l)===-1&&n.push(l)}):r[s]=a.concat())):a&&typeof a=="object"?r[s]=uue(n,a,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=a),r)},e||{}):e}var gQ;const qr={apiKey:void 0,applicationUrl:(gQ=globalThis.location)==null?void 0:gQ.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(cue(qr,globalThis.esriConfig,!0),delete qr.has),!qr.assetsPath){const e="4.23.7";qr.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}qr.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(qr,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),qr.request.corsEnabledServers=[],qr.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const hMe=/\{([^\}]+)\}/g;function yQ(e){return e==null?"":e}function o0(e,t){return e.replace(hMe,typeof t=="object"?(i,r)=>yQ(iE(r,t)):(i,r)=>yQ(t(r)))}function Dq(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.indexOf(i)!==-1?i:`\\${i}`)}function Lq(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function Ext(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const vQ={info:0,warn:1,error:2,none:3};class Ge{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,Ge._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Ge.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=Ge._loggers;return Ge._loggers=t,i},set throttlingDisabled(t){Ge._throttlingDisabled=t}}}static getLogger(t){let i=Ge._loggers[t];return i||(i=new Ge({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!Ge._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Ge._tickCounter)return;this._loggedMessages[t].set(s,Ge._tickCounter),Ge._scheduleTickCounterIncrement()}for(const s of qr.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;L(r);){const s=r[t];if(L(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=qr.log.level?qr.log.level:"warn";return vQ[this._parentWithMember("level",i)]<=vQ[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return Lq(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){Ge._tickCounterScheduled||(Ge._tickCounterScheduled=!0,Promise.resolve().then(()=>{Ge._tickCounter++,Ge._tickCounterScheduled=!1}))}}Ge._loggers={},Ge._tickCounter=0,Ge._tickCounterScheduled=!1,Ge._throttlingDisabled=!1;function uMe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(i,r){if(r==="")return"$";const s=iE(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class vL{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof vL&&(this.message=i&&uMe(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class Se extends vL{constructor(t,i,r){if(super(t,i,r),!(this instanceof Se))return new Se(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Fe(i)}catch{return"[object]"}}))}}catch(t){throw Ge.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new Se(t.name,t.message,t.details)}}Se.prototype.type="error";function eR(e){return Promise.all(e)}function Nq(e){return new Promise((t,i)=>{try{e(t,i)}catch(r){Promise.resolve().then(()=>i(r))}})}function rr(e="Aborted"){return new Se("AbortError",e)}function Gi(e,t="Aborted"){if(zn(e))throw rr(t)}function _L(e){return L(e)?"aborted"in e?e:e.signal:e}function zn(e){const t=_L(e);return L(t)&&t.aborted}function Fg(e){if(Cs(e))throw e}function yz(e){if(!Cs(e))throw e}function ka(e,t){const i=_L(e);if(!J(i)){if(!i.aborted)return Khe(i,"abort",()=>t());t()}}function TO(e,t){const i=_L(e);if(!J(i))return Gi(i),Khe(i,"abort",()=>t(rr()))}function Fq(e,t){const i=_L(t);return J(i)?e:new Promise((r,s)=>{let n=ka(t,()=>s(rr()));const a=()=>n=_o(n);e.then(a,a),e.then(r,s)})}function Cs(e){return e&&e.name==="AbortError"}function vz(e){return e.catch(t=>{if(!Cs(t))throw t})}function Axt(e,t=Ge.getLogger("esri")){return e.catch(i=>{Cs(i)||t.error(i)})}function gv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}function bo(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e);return bo(i.map(r=>e[r])).then(r=>{const s={};return i.forEach((n,a)=>s[n]=r[a]),s})}const t=e;return Nq(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const a={promise:n||Promise.resolve(n)};r.push(a),a.promise.then(l=>{a.value=l}).catch(l=>{a.error=l}).then(()=>{--s,s===0&&i(r)})})})}function due(e){return bo(e).then(t=>t.filter(i=>!!i.value).map(i=>i.value))}function _Q(e){return Promise.reject(e)}function G3(e){return Promise.resolve(e)}function jT(e,t,i){const r=new AbortController;return ka(i,()=>r.abort()),new Promise((s,n)=>{let a=setTimeout(()=>{a=0,s(t)},e);ka(r,()=>{a&&(clearTimeout(a),n(rr()))})})}function au(e){return e&&typeof e.then=="function"}function _z(e){return au(e)?e:Promise.resolve(e)}function kq(e,t=-1){let i,r,s,n,a=null;const l=(...p)=>{if(i){r=p,n&&n.reject(rr()),n=gv();const A=n.promise;if(a){const M=a;a=null,M.abort()}return A}if(s=n||gv(),n=null,t>0){const A=new AbortController;i=_z(e(...p,A.signal));const M=i;jT(t).then(()=>{i===M&&(n?A.abort():a=A)})}else i=1,i=_z(e(...p));const y=()=>{const A=r;r=s=i=a=null,A!=null&&l(...A)},b=i,x=s;return b.then(y,y),b.then(x.resolve,x.reject),x.promise};return l}function bg(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>fL.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Cxt(e,t){return e.then(t,t)}function SO(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const a=()=>{n&&(n.finished=!0,n=null),L(i)&&(i.remove(),i=null),r=null};return s.then(a,a),i=ka(t,()=>{L(n)&&n.abort()}),n}function Mxt(e){return Promise.resolve().then(()=>{Gi(e)})}function dMe(e){return e&&e.release&&typeof e.release=="function"}function pMe(e){return e&&e.acquire&&typeof e.acquire=="function"}class mn{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let a=0;a<n;a++)this._pool[a]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(mn.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):pMe(i)&&i.acquire(...t),i}release(t){t&&!mn.test.disabled&&(this.releaseFunction?this.releaseFunction(t):dMe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}mn.test={disabled:!1};function fMe(e){e.length=0}class Uc{constructor(t=50,i=50){this._pool=new mn(Array,void 0,fMe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return xF.acquire()}static release(t){return xF.release(t)}static prune(){xF.prune()}}const xF=new Uc(100);class pue extends mn{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=XCe(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const F4=[];function HT(e){F4.push(e),F4.length===1&&queueMicrotask(()=>{const t=F4.slice();F4.length=0;for(const i of t)i()})}const mMe=29;class ov{constructor(t,i=mMe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var bz;(function(e){const t=(n,a,l,p)=>{let y=a,b=a;const x=l>>>1,A=n[y-1];for(;b<=x;){b=y<<1,b<l&&p(n[b-1],n[b])<0&&++b;const M=n[b-1];if(p(M,A)<=0)break;n[y-1]=M,y=b}n[y-1]=A},i=(n,a)=>n<a?-1:n>a?1:0;function r(n,a,l,p){a===void 0&&(a=0),l===void 0&&(l=n.length),p===void 0&&(p=i);for(let b=l>>>1;b>a;b--)t(n,b,l,p);const y=a+1;for(let b=l-1;b>a;b--){const x=n[a];n[a]=n[b],n[b]=x,t(n,y,b,p)}}function*s(n,a,l,p){a===void 0&&(a=0),l===void 0&&(l=n.length),p===void 0&&(p=i);for(let b=l>>>1;b>a;b--)t(n,b,l,p),yield;const y=a+1;for(let b=l-1;b>a;b--){const x=n[a];n[a]=n[b],n[b]=x,t(n,y,b,p),yield}}e.sort=r,e.iterableSort=s})(bz||(bz={}));const bQ=bz,gMe=1.5,yMe=1.1;class Ci{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Qhe,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>wQ(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,wQ(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=tue(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=gL(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=iMe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){bQ.sort(this.data,0,this.length,t)}iterableSort(t){return bQ.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function wQ(e){e.data.length>gMe*e.length&&(e.data.length=Math.floor(e.length*yMe))}function fue(e){return 1e3*e}function mue(e){return .001*e}class vMe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class _Me{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let wz=0,xz=0;const LE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},Tz=["prepare","preRender","render","postRender","update","finish"],Sz=[],D2=new Ci;class bMe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const j$={frameTasks:D2,willDispatch:!1,clearFrameTasks:wMe,dispatch:vue,executeFrameTasks:TMe};function EO(e){const t=new _Me(e);return Sz.push(t),j$.willDispatch||(j$.willDispatch=!0,HT(vue)),t}function L2(e){const t=new vMe(e);return D2.push(t),H$==null&&(wz=performance.now(),H$=requestAnimationFrame(gue)),new bMe(t)}let H$=null;function wMe(e=!1){D2.forAll(t=>{t.removed=!0}),e&&yue()}function xMe(e){xz=Math.max(0,e)}function gue(){const e=performance.now();H$=null,H$=D2.length>0?requestAnimationFrame(gue):null,j$.executeFrameTasks(e)}function TMe(e){const t=e-wz;wz=e;const i=xz>0?xz:1e3/60,r=Math.max(0,t-i);for(let s=0;s<Tz.length;s++){const n=performance.now(),a=Tz[s];D2.forAll(l=>{var p;l.paused||l.removed||(s===0&&l.ticks++,l.phases[a]&&(LE.time=e,LE.deltaTime=l.ticks===0?0:t,LE.elapsedFrameTime=performance.now()-e,LE.frameDuration=i-r,(p=l.phases[a])==null||p.call(l,LE)))}),SMe[s].record(performance.now()-n)}yue(),EMe.record(performance.now()-e)}const k4=new Ci;function yue(){D2.forAll(e=>{e.removed&&k4.push(e)}),D2.removeUnorderedMany(k4.data,k4.length),k4.clear()}function vue(){for(;Sz.length;){const e=Sz.shift();e.isActive&&e.callback()}j$.willDispatch=!1}function Rxt(e=1,t){const i=bg(),r=()=>{zn(t)?i.reject(rr()):e===0?i():(--e,HT(()=>r()))};return r(),i.promise}const SMe=Tz.map(e=>new ov(e)),EMe=new ov("total");function _ue(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let AMe=0;const CMe=0;function ec(){return++AMe}function nc(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function MMe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function UI(e,t,i){return i?q$(e,t,{policy:i,path:""}):q$(e,t,null)}function q$(e,t,i){return t?Object.keys(t).reduce(function(r,s){let n=null,a="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,a=i.policy(n)),a==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=Fe(t[s]),r;let l=r[s],p=t[s];if(l===p)return r;if(Array.isArray(p)||Array.isArray(r))l=l?Array.isArray(l)?r[s]=l.concat():r[s]=[l]:r[s]=[],p&&(Array.isArray(p)||(p=[p]),p.forEach(y=>{l.indexOf(y)===-1&&l.push(y)}));else if(p&&typeof p=="object")if(i){const y=i.path;i.path=n,r[s]=q$(l,p,i),i.path=y}else r[s]=q$(l,p,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=p);return r},e||{}):e}function bue(e){return Array.isArray(e)?e:e.split(".")}function xQ(e){return e.indexOf(",")>-1?e.split(",").map(t=>t.trim()):[e.trim()]}function RMe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...xQ(i));return t}return xQ(e)}function wue(e,t,i,r){const s=RMe(t);if(s.length!==1){const n=s.map(a=>r(e,a,i));return GT(n)}return r(e,s[0],i)}function Uq(e){let t=!1;return()=>{t||(t=!0,e())}}function xue(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=nc(t);return MMe(r,i)?r.get(i):t[i]}function Tue(e,t,i){if(e==null)return e;const r=xue(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Tue(r,t,i+1)}function AO(e,t,i=0){return typeof t=="string"&&t.indexOf(".")===-1?xue(t,e):Tue(e,bue(t),i)}function W$(e,t){return AO(e,t)}function TQ(e,t){return AO(t,e)!==void 0}var hs;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(hs||(hs={}));let X$,YA=[];const OMe=Ge.getLogger("esri.core.Accessor");function Li(e){X$!==void 0&&X$.onObservableAccessed(e)}let zI=!1,BI=!1;function wg(e,t,i){if(zI)return zq(e,t,i);Sue(e);const r=t.call(i);return Eue(),r}function PMe(e,t){return wg(void 0,e,t)}function zq(e,t,i){const r=zI;zI=!0,Sue(e);let s=null;try{s=t.call(i)}catch(n){BI&&OMe.error(n)}return Eue(),zI=r,s}function Sue(e){X$=e,YA.push(e)}function Eue(){const e=YA.pop();X$=YA.length>0?YA[YA.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function Aue(e,t){if(t.flags&hs.DepTrackingInitialized)return;const i=BI;BI=!1,t.flags&hs.AutoTracked?zq(t,t.metadata.get,e):Cue(e,t),BI=i}const IMe=[];function Cue(e,t){t.flags&hs.ExplicitlyTracking||(t.flags|=hs.ExplicitlyTracking,zq(t,()=>{const i=t.metadata.dependsOn||IMe;for(const r of i)if(typeof r=="string"&&r.indexOf(".")===-1)SQ(e,r,!1);else{const s=bue(r);for(let n=0,a=e;n<s.length&&a!=null&&typeof a=="object";++n)a=SQ(a,s[n],n!==s.length-1)}}),t.flags&=~hs.ExplicitlyTracking)}function SQ(e,t,i){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const a=parseInt(r,10);if(!isNaN(a))return Array.isArray(e)?e[a]:e.getItemAt(a)}const s=nc(e),n=s==null?void 0:s.properties.get(r);return n&&(Li(n),Aue(e,n)),i?e[r]:void 0}class bL{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let gT=!1;const Y$=[];function Mue(e,t){let i=new bL(n),r=null,s=!1;function n(){if(!i||s)return;if(gT)return void Pue(n);const l=r;i.clear(),gT=!0,s=!0,r=wg(i,e),s=!1,gT=!1,t(r,l),Iue()}function a(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=wg(i,e),s=!1,{remove:a}}function Rue(e,t){let i=new bL(s),r=null;function s(){t(r,a)}function n(){i&&(i.destroy(),i=null),r=null}function a(){return i?(i.clear(),r=wg(i,e),r):null}return a(),{remove:n}}function Oue(e){let t=new bL(r),i=!1;function r(){t&&!i&&(gT?Pue(r):(t.clear(),gT=!0,i=!0,wg(t,e),i=!1,gT=!1,Iue()))}function s(){t&&(t.destroy(),t=null)}return i=!0,wg(t,e),i=!1,{remove:s}}function Pue(e){Y$.includes(e)||Y$.unshift(e)}function Iue(){for(;Y$.length;)Y$.pop()()}var cM;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(cM||(cM={}));class tR{constructor(){this.uid=ec(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(cM.Untracked,t,i,r,s,n,yL)}static acquireTracked(t,i,r,s){return this.pool.acquire(cM.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===cM.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,a,l){this.uid=ec(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=a,this.equals=l}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=ec(),this.removed=!0}}tR.pool=new pue(tR);const VI=new Uc,ag=new Set;let J$;function Z$(e){ag.delete(e),ag.add(e),J$||(J$=EO(LMe))}function $Me(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function DMe(e){for(const t of ag.values())t.target===e&&(t.removed=!0)}function LMe(){let e=10;for(;J$&&e--;){J$=null;const t=NMe(),i=VI.acquire();for(const r of t){const s=r.uid;$Me(r),s===r.uid&&r.removed&&i.push(r)}for(const r of ag)r.removed&&(i.push(r),ag.delete(r));for(const r of i)tR.pool.release(r);VI.release(i),VI.release(t),Ez.forEach(r=>r())}}function NMe(){const e=VI.acquire();e.length=ag.size;let t=0;for(const i of ag)e[t]=i,++t;return ag.clear(),e}const Ez=new Set;function $ue(e){return Ez.add(e),{remove(){Ez.delete(e)}}}function FMe(e,t,i){let r=wue(e,t,i,(s,n,a)=>{let l,p,y=Rue(()=>AO(s,n),(b,x)=>{s.__accessor__.destroyed||l&&l.uid!==p?r.remove():(l||(l=tR.acquireUntracked(b,a,x,s,n),p=l.uid),Z$(l))});return{remove:Uq(()=>{y.remove(),l&&(l.uid!==p||l.removed||(l.removed=!0,Z$(l)),l=null),r=y=null})}});return r}function kMe(e,t,i){const r=wue(e,t,i,(s,n,a)=>{let l=!1;return Mue(()=>AO(s,n),(p,y)=>{s.__accessor__.destroyed?r.remove():l||(l=!0,yL(y,p)||a.call(s,p,y,n,s),l=!1)})});return r}function UMe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?kMe(e,t,i):FMe(e,t,i)}function zMe(e,t,i){let r,s,n=Rue(e,(a,l)=>{r&&r.uid!==s?n.remove():(r||(r=tR.acquireTracked(a,t,l,i),s=r.uid),Z$(r))});return{remove:Uq(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,Z$(r)),r=null),n=null})}}function BMe(e,t,i){let r=!1;return Mue(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function VMe(e,t,i=!1,r=yL){return i?BMe(e,t,r):zMe(e,t,r)}function EQ(e){return _ue(ag,t=>t.oldValue===e)}function vi(e,t,i={}){return Bq(e,t,i,Due)}function CO(e,t,i={}){return Bq(e,t,i,Lue)}function Bq(e,t,i={},r){let s=null;const n=i.once?(a,l)=>{r(a)&&(_o(s),t(a,l))}:(a,l)=>{r(a)&&t(a,l)};if(s=VMe(e,n,i.sync,i.equals),i.initial){const a=e();n(a,a)}return s}function av(e,t,i,r={}){let s=null,n=null,a=null;function l(){s&&n&&(n.remove(),r.onListenerRemove==null||r.onListenerRemove(s),s=null,n=null)}function p(b){r.once&&r.once&&_o(a),i(b)}const y=vi(e,(b,x)=>{l(),pL(b)&&(s=b,n=xO(b,t,p),r.onListenerAdd==null||r.onListenerAdd(b))},{sync:r.sync,initial:!0});return a=Hp(()=>{y.remove(),l()}),a}function qT(e,t){return GMe(e,Lue,t)}function GMe(e,t,i){if(zn(i))return Promise.reject(rr());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function n(){s=_o(s)}return new Promise((a,l)=>{s=GT([ka(i,()=>{n(),l(rr())}),Bq(e,p=>{n(),a(p)},{sync:!1,once:!0},t!=null?t:Due)])})}function Due(e){return!0}function Lue(e){return!!e}const Pc={sync:!0},No={initial:!0},Oa={sync:!0,initial:!0},fn={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let zx,Nue,wL,Fue=!1,K$=!1,Vq=!1,Oh=!1,AQ=null,Az=!1;const MO=typeof window!="undefined"?window:{};fn.cssVarShim&&MO.CSS;const Ap=MO.document||{head:{}},jMe=MO.HTMLElement||class{},eh={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},Q$=fn.shadowDomShim&&fn.shadowDom?(()=>(Ap.head.attachShadow+"").indexOf("[native")>-1)():!0,HMe=(()=>{let e=!1;try{Ap.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),qMe=e=>Promise.resolve(e),WMe=fn.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,kue=(e,t,i,r)=>{i&&i.map(([s,n,a])=>{const l=YMe(e,s),p=XMe(t,a),y=JMe(s);eh.ael(l,n,p,y),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>eh.rel(l,n,p,y))})},XMe=(e,t)=>i=>{try{fn.lazyLoad||e.$hostElement$[t](i)}catch(r){RO(r)}},YMe=(e,t)=>t&4?Ap:t&8?MO:t&16?Ap.body:e,JMe=e=>HMe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,CQ="http://www.w3.org/1999/xlink",N2=(e,t="")=>()=>{},MQ=new WeakMap,ZMe=(e,t,i)=>{let r=i6.get(e);WMe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,i6.set(e,r)},KMe=(e,t,i,r)=>{let s=Uue(t,i),n=i6.get(s);if(e=e.nodeType===11?e:Ap,n)if(typeof n=="string"){e=e.head||e;let a=MQ.get(e),l;a||MQ.set(e,a=new Set),a.has(s)||(l=Ap.createElement("style"),l.innerHTML=n,e.insertBefore(l,e.querySelector("link")),a&&a.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},QMe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=N2("attachStyles",t.$tagName$),n=KMe(Q$&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Uue=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),eRe=e=>MRe.map(t=>t(e)).find(t=>!!t),RQ={},tRe="http://www.w3.org/2000/svg",iRe="http://www.w3.org/1999/xhtml",rRe=e=>e!=null,Gq=e=>(e=typeof e,e==="object"||e==="function"),Du=(e,t,...i)=>{let r=null,s=null,n=null,a=!1,l=!1,p=[];const y=x=>{for(let A=0;A<x.length;A++)r=x[A],Array.isArray(r)?y(r):r!=null&&typeof r!="boolean"&&((a=typeof e!="function"&&!Gq(r))&&(r=String(r)),a&&l?p[p.length-1].$text$+=r:p.push(a?e6(null,r):r),l=a)};if(y(i),t&&(fn.isDev&&e==="input"&&oRe(t),fn.vdomKey&&t.key&&(s=t.key),fn.slotRelocation&&t.name&&(n=t.name),fn.vdomClass)){const x=t.className||t.class;x&&(t.class=typeof x!="object"?x:Object.keys(x).filter(A=>x[A]).join(" "))}if(fn.isDev&&p.some(Bue)&&ARe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),fn.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,p,sRe);const b=e6(e,null);return b.$attrs$=t,p.length>0&&(b.$children$=p),fn.vdomKey&&(b.$key$=s),fn.slotRelocation&&(b.$name$=n),b},e6=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return fn.vdomAttribute&&(i.$attrs$=null),fn.vdomKey&&(i.$key$=null),fn.slotRelocation&&(i.$name$=null),i},zue={},Bue=e=>e&&e.$tag$===zue,sRe={forEach:(e,t)=>e.map(OQ).forEach(t),map:(e,t)=>e.map(OQ).map(t).map(nRe)},OQ=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),nRe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Du(e.vtag,i,...e.vchildren||[])}const t=e6(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},oRe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),a=t.indexOf("step");(i<r||i<s||i<n||i<a)&&CRe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},PQ=(e,t,i,r,s,n)=>{if(i!==r){let a=LQ(e,t),l=t.toLowerCase();if(t==="class"){const p=e.classList,y=IQ(i),b=IQ(r);p.remove(...y.filter(x=>x&&!b.includes(x))),p.add(...b.filter(x=>x&&!y.includes(x)))}else if(t==="style"){for(const p in i)(!r||r[p]==null)&&(p.includes("-")?e.style.removeProperty(p):e.style[p]="");for(const p in r)(!i||r[p]!==i[p])&&(p.includes("-")?e.style.setProperty(p,r[p]):e.style[p]=r[p])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):LQ(MO,l)?t=l.slice(2):t=l[2]+t.slice(3),i&&eh.rel(e,t,i,!1),r&&eh.ael(e,t,r,!1);else{const p=Gq(r);if((a||p&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let b=r==null?"":r;t==="list"?a=!1:(i==null||e[t]!=b)&&(e[t]=b)}}catch{}let y=!1;l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,y=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(y?e.removeAttributeNS(CQ,t):e.removeAttribute(t)):(!a||n&4||s)&&!p&&(r=r===!0?"":r,y?e.setAttributeNS(CQ,t,r):e.setAttribute(t,r))}}},aRe=/\s/,IQ=e=>e?e.split(aRe):[],Vue=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||RQ,a=t.$attrs$||RQ;for(r in n)r in a||PQ(s,r,n[r],void 0,i,t.$flags$);for(r in a)PQ(s,r,n[r],a[r],i,t.$flags$)},t6=(e,t,i,r)=>{let s=t.$children$[i],n=0,a,l,p;if(Fue||(Vq=!0,s.$tag$==="slot"&&(zx&&r.classList.add(zx+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)a=s.$elm$=Ap.createTextNode(s.$text$);else if(s.$flags$&1)a=s.$elm$=Ap.createTextNode("");else{if(Oh||(Oh=s.$tag$==="svg"),a=s.$elm$=Ap.createElementNS(Oh?tRe:iRe,s.$flags$&2?"slot-fb":s.$tag$),Oh&&s.$tag$==="foreignObject"&&(Oh=!1),Vue(null,s,Oh),rRe(zx)&&a["s-si"]!==zx&&a.classList.add(a["s-si"]=zx),s.$children$)for(n=0;n<s.$children$.length;++n)l=t6(e,s,n,a),l&&a.appendChild(l);s.$tag$==="svg"?Oh=!1:a.tagName==="foreignObject"&&(Oh=!0)}return a["s-hn"]=wL,s.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=Nue,a["s-sn"]=s.$name$||"",p=e&&e.$children$&&e.$children$[i],p&&p.$tag$===s.$tag$&&e.$elm$&&iR(e.$elm$,!1)),a},iR=(e,t)=>{eh.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==wL&&s["s-ol"]&&(Hue(s).insertBefore(s,jq(s)),s["s-ol"].remove(),s["s-ol"]=void 0,Vq=!0),t&&iR(s,t)}eh.$flags$&=-2},Gue=(e,t,i,r,s,n)=>{let a=e["s-cr"]&&e["s-cr"].parentNode||e,l;for(a.shadowRoot&&a.tagName===wL&&(a=a.shadowRoot);s<=n;++s)r[s]&&(l=t6(null,i,s,e),l&&(r[s].$elm$=l,a.insertBefore(l,jq(t))))},jue=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Xue(r),K$=!0,s["s-ol"]?s["s-ol"].remove():iR(s,!0),s.remove())},lRe=(e,t,i,r)=>{let s=0,n=0,a=0,l=0,p=t.length-1,y=t[0],b=t[p],x=r.length-1,A=r[0],M=r[x],P,$;for(;s<=p&&n<=x;)if(y==null)y=t[++s];else if(b==null)b=t[--p];else if(A==null)A=r[++n];else if(M==null)M=r[--x];else if(U4(y,A))Bx(y,A),y=t[++s],A=r[++n];else if(U4(b,M))Bx(b,M),b=t[--p],M=r[--x];else if(U4(y,M))(y.$tag$==="slot"||M.$tag$==="slot")&&iR(y.$elm$.parentNode,!1),Bx(y,M),e.insertBefore(y.$elm$,b.$elm$.nextSibling),y=t[++s],M=r[--x];else if(U4(b,A))(y.$tag$==="slot"||M.$tag$==="slot")&&iR(b.$elm$.parentNode,!1),Bx(b,A),e.insertBefore(b.$elm$,y.$elm$),b=t[--p],A=r[++n];else{for(a=-1,l=s;l<=p;++l)if(t[l]&&t[l].$key$!==null&&t[l].$key$===A.$key$){a=l;break}a>=0?($=t[a],$.$tag$!==A.$tag$?P=t6(t&&t[n],i,a,e):(Bx($,A),t[a]=void 0,P=$.$elm$),A=r[++n]):(P=t6(t&&t[n],i,n,e),A=r[++n]),P&&Hue(y.$elm$).insertBefore(P,jq(y.$elm$))}s>p?Gue(e,r[x+1]==null?null:r[x+1].$elm$,i,r,n,x):n>x&&jue(t,s,p)},U4=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,jq=e=>e&&e["s-ol"]||e,Hue=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Bx=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,a=t.$text$;let l;a===null?(Oh=n==="svg"?!0:n==="foreignObject"?!1:Oh,n==="slot"||Vue(e,t,Oh),r!==null&&s!==null?lRe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Gue(i,null,t,s,0,s.length-1)):r!==null&&jue(r,0,r.length-1),Oh&&n==="svg"&&(Oh=!1)):(l=i["s-cr"])?l.parentNode.textContent=a:e.$text$!==a&&(i.data=a)},que=e=>{let t=e.childNodes,i,r,s,n,a,l;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(a=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(l=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||a!==""){if(l===1&&a===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(l===1||l===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}que(i)}},hp=[],Wue=e=>{let t,i,r,s,n,a,l=0,p=e.childNodes,y=p.length;for(;l<y;l++){if(t=p[l],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],a=r.length-1;a>=0;a--)i=r[a],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&($Q(i,s)?(n=hp.find(b=>b.$nodeToRelocate$===i),K$=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:hp.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&hp.map(b=>{$Q(b.$nodeToRelocate$,i["s-sn"])&&(n=hp.find(x=>x.$nodeToRelocate$===i),n&&!b.$slotRefNode$&&(b.$slotRefNode$=n.$slotRefNode$))})):hp.some(b=>b.$nodeToRelocate$===i)||hp.push({$nodeToRelocate$:i}));t.nodeType===1&&Wue(t)}},$Q=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Xue=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Xue)},cRe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||e6(null,null),n=Bue(t)?t:Du(null,null,t);wL=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([a,l])=>n.$attrs$[l]=i[a])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,zx=i["s-sc"],Nue=i["s-cr"],Fue=Q$&&(r.$flags$&1)!==0,K$=!1,Bx(s,n);{if(eh.$flags$|=1,Vq){Wue(n.$elm$);let a,l,p,y,b,x,A=0;for(;A<hp.length;A++)a=hp[A],l=a.$nodeToRelocate$,l["s-ol"]||(p=Ap.createTextNode(""),p["s-nr"]=l,l.parentNode.insertBefore(l["s-ol"]=p,l));for(A=0;A<hp.length;A++)if(a=hp[A],l=a.$nodeToRelocate$,a.$slotRefNode$){for(y=a.$slotRefNode$.parentNode,b=a.$slotRefNode$.nextSibling,p=l["s-ol"];p=p.previousSibling;)if(x=p["s-nr"],x&&x["s-sn"]===l["s-sn"]&&y===x.parentNode&&(x=x.nextSibling,!x||!x["s-nr"])){b=x;break}(!b&&y!==l.parentNode||l.nextSibling!==b)&&l!==b&&(!l["s-hn"]&&l["s-ol"]&&(l["s-hn"]=l["s-ol"].parentNode.nodeName),y.insertBefore(l,b))}else l.nodeType===1&&(l.hidden=!0)}K$&&que(n.$elm$),eh.$flags$&=-2,hp.length=0}},hRe=(e,t)=>{},Yue=(e,t)=>(e.$flags$|=16,hRe(e,e.$ancestorComponent$),PRe(()=>uRe(e,t))),uRe=(e,t)=>{const i=e.$hostElement$,r=N2("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=yT(s,"componentWillLoad"):n=yT(s,"componentWillUpdate"),n=DQ(n,()=>yT(s,"componentWillRender")),r(),DQ(n,()=>dRe(e,s,t))},dRe=async(e,t,i)=>{const r=e.$hostElement$,s=N2("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&QMe(e);const n=N2("render",e.$cmpMeta$.$tagName$);pRe(e,t,r),n(),s(),fRe(e)},pRe=(e,t,i)=>{try{AQ=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(fn.hasRenderFn||fn.reflect)&&(fn.vdomRender||fn.reflect)&&(fn.hydrateServerSide||cRe(e,t))}catch(l){RO(l,e.$hostElement$)}return AQ=null,null},fRe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=N2("postUpdate",t),s=i;e.$ancestorComponent$,yT(s,"componentDidRender"),e.$flags$&64?(yT(s,"componentDidUpdate"),r()):(e.$flags$|=64,yT(s,"componentDidLoad"),r())},yT=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){RO(r)}},DQ=(e,t)=>e&&e.then?e.then(t):t(),mRe=(e,t)=>e!=null&&!Gq(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,gRe=(e,t)=>xL(e).$instanceValues$.get(t),yRe=(e,t,i,r)=>{const s=xL(e),n=e,a=s.$instanceValues$.get(t),l=s.$flags$,p=n;if(i=mRe(i,r.$members$[t][0]),i!==a){s.$instanceValues$.set(t,i);{if(r.$watchers$&&l&128){const y=r.$watchers$[t];y&&y.map(b=>{try{p[b](i,a,t)}catch(x){RO(x,n)}})}if((l&18)===2){if(p.componentShouldUpdate&&p.componentShouldUpdate(i,a,t)===!1)return;Yue(s,!1)}}}},vRe=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,n,{get(){return gRe(this,n)},set(l){yRe(this,n,l,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(a,l,p){eh.jmp(()=>{const y=n.get(a);if(this.hasOwnProperty(y))p=this[y],delete this[y];else if(s.hasOwnProperty(y)&&typeof this[y]=="number"&&this[y]==p)return;this[y]=p===null&&typeof this[y]=="boolean"?!1:p})},e.observedAttributes=r.filter(([a,l])=>l[0]&15).map(([a,l])=>{const p=l[1]||a;return n.set(p,a),l[0]&512&&t.$attrsToReflect$.push([a,p]),p})}}return e},_Re=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let a=s.style;typeof a!="string"&&(a=a[t.$modeName$=eRe(e)]);const l=Uue(i,t.$modeName$);if(!i6.has(l)){const p=N2("registerStyles",i.$tagName$);ZMe(l,a,!!(i.$flags$&1)),p()}}t.$ancestorComponent$,(()=>Yue(t,!0))()},bRe=e=>{},wRe=e=>{if((eh.$flags$&1)===0){const t=xL(e),i=t.$cmpMeta$,r=N2("connectedCallback",i.$tagName$);t.$flags$&1?(kue(e,t,i.$listeners$),bRe(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&xRe(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const a=e[s];delete e[s],e[s]=a}}),_Re(e,t,i)),r()}},xRe=e=>{const t=e["s-cr"]=Ap.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},TRe=e=>{if((eh.$flags$&1)===0){const t=xL(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},SRe=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};i.$members$=t[2],i.$listeners$=t[3],i.$watchers$=e.$watchers$,i.$attrsToReflect$=[],!Q$&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){ERe(this,i)},connectedCallback(){wRe(this),r&&r.call(this)},disconnectedCallback(){TRe(this),s&&s.call(this)},__attachShadow(){Q$?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.shadowRoot=this}}),e.is=i.$tagName$,vRe(e,i)},Jue=new WeakMap,xL=e=>Jue.get(e),ERe=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return kue(e,i,t.$listeners$),Jue.set(e,i)},LQ=(e,t)=>t in e,RO=(e,t)=>(0,console.error)(e,t),Zue=fn.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],ARe=(...e)=>console.error(...Zue,...e),CRe=(...e)=>console.warn(...Zue,...e),i6=new Map,MRe=[],NQ=[],Kue=[],RRe=(e,t)=>i=>{e.push(i),Az||(Az=!0,t&&eh.$flags$&4?ORe(Cz):eh.raf(Cz))},FQ=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){RO(i)}e.length=0},Cz=()=>{FQ(NQ),FQ(Kue),(Az=NQ.length>0)&&eh.raf(Cz)},ORe=e=>qMe().then(e),PRe=RRe(Kue,!0);fn.isDev,fn.isTesting;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */function IRe(e){return e.map(t=>{let i="";for(let r=0;r<t;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const $Re=()=>IRe([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */const DRe='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}';let Mz=class extends jMe{constructor(){super();this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:i,scale:r,text:s,type:n,value:a}=this,l=e.id||$Re(),p=.45,y=t?this.getInlineSize(r):this.getSize(r),b=y*p,x=`0 0 ${y} ${y}`,A=n==="determinate",M=2*b*Math.PI,P=a/100*M,$=M-P,k=Math.floor(a),z={"aria-valuenow":k,"aria-valuemin":0,"aria-valuemax":100,complete:k===100},G={r:b,cx:y/2,cy:y/2},B={"stroke-dasharray":`${P} ${$}`};return Du(zue,Object.assign({"aria-label":i,id:l,role:"progressbar"},A?z:{}),Du("div",{class:"loader__svgs"},Du("svg",{class:"loader__svg loader__svg--1",viewBox:x},Du("circle",Object.assign({},G))),Du("svg",{class:"loader__svg loader__svg--2",viewBox:x},Du("circle",Object.assign({},G))),Du("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:x},A?{style:B}:{}),Du("circle",Object.assign({},G)))),s&&Du("div",{class:"loader__text"},s),A&&Du("div",{class:"loader__percentage"},a))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return DRe}};Mz=SRe(Mz,[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function LRe(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,Mz);break}})}LRe();const r6={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Que(e){return r6[e]||r6[e.toLowerCase()]}function Hq(e){var t;return(t=r6[e])!=null?t:r6[e.toLowerCase()]}function NRe(e){return[...Hq(e)]}function TF(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function ede(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,a=2*i-n;return[Math.round(255*TF(a,n,s+1/3)),Math.round(255*TF(a,n,s)),Math.round(255*TF(a,n,s-1/3)),r]}function FRe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let a=Number("0x"+e.substr(1));if(isNaN(a))return null;const l=[0,0,0,1];let p;return n&&(p=a&r,a>>=i,l[3]=s*p/255),p=a&r,a>>=i,l[2]=s*p,p=a&r,a>>=i,l[1]=s*p,p=a&r,a>>=i,l[0]=s*p,l}function Q(){return[0,0,0]}function qn(e){return[e[0],e[1],e[2]]}function $t(e,t,i){return[e,t,i]}function zl(e){const t=Q(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function qq(e,t){return new Float64Array(e,t,3)}function tde(){return Q()}function ide(){return $t(1,1,1)}function rde(){return $t(1,0,0)}function sde(){return $t(0,1,0)}function Wq(){return $t(0,0,1)}const Jc=tde(),Jf=ide(),kRe=rde(),URe=sde(),nde=Wq();Object.freeze({__proto__:null,create:Q,clone:qn,fromValues:$t,fromArray:zl,createView:qq,zeros:tde,ones:ide,unitX:rde,unitY:sde,unitZ:Wq,ZEROS:Jc,ONES:Jf,UNIT_X:kRe,UNIT_Y:URe,UNIT_Z:nde});const pi=1e-6,mp=Math.random,zRe=Math.PI/180,BRe=180/Math.PI;function TL(e){return e*zRe}function VRe(e){return e*BRe}function GRe(e,t){return Math.abs(e-t)<=pi*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze({__proto__:null,EPSILON:pi,RANDOM:mp,toRadian:TL,toDegree:VRe,equals:GRe});function yt(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function ke(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ze(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function Xe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function We(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Xq(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function s6(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function jRe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function HRe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ode(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function ade(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function qRe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ue(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Rz(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Er(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function wo(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function dl(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Na(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function WRe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function ot(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function rt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function si(e,t,i){const r=t[0],s=t[1],n=t[2],a=i[0],l=i[1],p=i[2];return e[0]=s*p-n*l,e[1]=n*a-r*p,e[2]=r*l-s*a,e}function Wn(e,t,i,r){const s=t[0],n=t[1],a=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=a+r*(i[2]-a),e}function XRe(e,t,i,r,s,n){const a=n*n,l=a*(2*n-3)+1,p=a*(n-2)+n,y=a*(n-1),b=a*(3-2*n);return e[0]=t[0]*l+i[0]*p+r[0]*y+s[0]*b,e[1]=t[1]*l+i[1]*p+r[1]*y+s[1]*b,e[2]=t[2]*l+i[2]*p+r[2]*y+s[2]*b,e}function YRe(e,t,i,r,s,n){const a=1-n,l=a*a,p=n*n,y=l*a,b=3*n*l,x=3*p*a,A=p*n;return e[0]=t[0]*y+i[0]*b+r[0]*x+s[0]*A,e[1]=t[1]*y+i[1]*b+r[1]*x+s[1]*A,e[2]=t[2]*y+i[2]*b+r[2]*x+s[2]*A,e}function JRe(e,t){t=t||1;const i=2*mp()*Math.PI,r=2*mp()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function Ct(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function Gc(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function yv(e,t,i){const r=i[0],s=i[1],n=i[2],a=i[3],l=t[0],p=t[1],y=t[2];let b=s*y-n*p,x=n*l-r*y,A=r*p-s*l,M=s*A-n*x,P=n*b-r*A,$=r*x-s*b;const k=2*a;return b*=k,x*=k,A*=k,M*=2,P*=2,$*=2,e[0]=l+b+M,e[1]=p+x+P,e[2]=y+A+$,e}function ZRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function KRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function QRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function eOe(e,t){ke(z4,e),ke(B4,t),ot(z4,z4),ot(B4,B4);const i=rt(z4,B4);return i>1?0:i<-1?Math.PI:Math.acos(i)}const z4=Q(),B4=Q();function tOe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function jc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function WT(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],a=t[1],l=t[2];return Math.abs(i-n)<=pi*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=pi*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=pi*Math.max(1,Math.abs(s),Math.abs(l))}function kg(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let a=r*r+s*s+n*n;return a>0?(a=1/Math.sqrt(a),e[0]=r*a,e[1]=s*a,e[2]=n*a,e):(e[0]=0,e[1]=0,e[2]=0,e)}const a0=We,iOe=Xq,rOe=s6,Yq=Er,Jq=wo,Zq=yt,Oz=dl,kQ=Object.freeze({__proto__:null,length:yt,copy:ke,set:ze,add:Xe,subtract:We,multiply:Xq,divide:s6,ceil:jRe,floor:HRe,min:ode,max:ade,round:qRe,scale:Ue,scaleAndAdd:Rz,distance:Er,squaredDistance:wo,squaredLength:dl,negate:Na,inverse:WRe,normalize:ot,dot:rt,cross:si,lerp:Wn,hermite:XRe,bezier:YRe,random:JRe,transformMat4:Ct,transformMat3:Gc,transformQuat:yv,rotateX:ZRe,rotateY:KRe,rotateZ:QRe,angle:eOe,str:tOe,exactEquals:jc,equals:WT,direction:kg,sub:a0,mul:iOe,div:rOe,dist:Yq,sqrDist:Jq,len:Zq,sqrLen:Oz});function Yl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function fl(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function Kq(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function lde(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function cde(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function hde(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function sOe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function nOe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function oOe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function aOe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function lOe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function OO(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function cOe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function ude(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function n6(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function Qq(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function eW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function hOe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function uOe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function dde(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let a=i*i+r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=r*a,e[2]=s*a,e[3]=n*a),e}function pde(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function tW(e,t,i,r){const s=t[0],n=t[1],a=t[2],l=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=a+r*(i[2]-a),e[3]=l+r*(i[3]-l),e}function dOe(e,t){let i,r,s,n,a,l;t=t||1;do i=2*mp()-1,r=2*mp()-1,a=i*i+r*r;while(a>=1);do s=2*mp()-1,n=2*mp()-1,l=s*s+n*n;while(l>=1);const p=Math.sqrt((1-a)/l);return e[0]=t*i,e[1]=t*r,e[2]=t*s*p,e[3]=t*n*p,e}function ld(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*a,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*a,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*a,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*a,e}function pOe(e,t,i){const r=t[0],s=t[1],n=t[2],a=i[0],l=i[1],p=i[2],y=i[3],b=y*r+l*n-p*s,x=y*s+p*r-a*n,A=y*n+a*s-l*r,M=-a*r-l*s-p*n;return e[0]=b*y+M*-a+x*-p-A*-l,e[1]=x*y+M*-l+A*-a-b*-p,e[2]=A*y+M*-p+b*-l-x*-a,e[3]=t[3],e}function fOe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function F2(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function fde(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],a=t[0],l=t[1],p=t[2],y=t[3];return Math.abs(i-a)<=pi*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=pi*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-p)<=pi*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(n-y)<=pi*Math.max(1,Math.abs(n),Math.abs(y))}const mOe=lde,gOe=cde,yOe=hde,vOe=ude,_Oe=n6,bOe=Qq,wOe=eW,mde=Object.freeze({__proto__:null,copy:Yl,set:fl,add:Kq,subtract:lde,multiply:cde,divide:hde,ceil:sOe,floor:nOe,min:oOe,max:aOe,round:lOe,scale:OO,scaleAndAdd:cOe,distance:ude,squaredDistance:n6,length:Qq,squaredLength:eW,negate:hOe,inverse:uOe,normalize:dde,dot:pde,lerp:tW,random:dOe,transformMat4:ld,transformQuat:pOe,str:fOe,exactEquals:F2,equals:fde,sub:mOe,mul:gOe,div:yOe,dist:vOe,sqrDist:_Oe,len:bOe,sqrLen:wOe}),UQ=new Float32Array(1);function XT(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Ot(e,t,i){return Math.min(Math.max(e,t),i)}function YT(e){return(e&e-1)==0}function Oxt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Pxt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Vi(e,t,i){return e+(t-e)*i}function xi(e){return e*Math.PI/180}function th(e){return 180*e/Math.PI}function Pz(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Xn(e){return Math.acos(Ot(e,-1,1))}function $p(e){return Math.asin(Ot(e,-1,1))}function xOe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function _2(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function TOe(e){return gde(Math.max(-Iz,Math.min(e,Iz)))}function gde(e){return UQ[0]=e,UQ[0]}function JT(e,t,i){const r=Ot((i-e)/(t-e),0,1);return r*r*(3-2*r)}function zQ(e,t){const i=yt(e),r=$p(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return ze(t,i,r,s),t}function Ixt(e,t,i){return fl(e,t[0],t[1],t[2],t[3]*i)}const Iz=gde(34028234663852886e22);function rn(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function $xt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function yde(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const vT=Ge.getLogger("esri.core.Accessor");function SOe(e){return e==null?e:new Date(e)}function EOe(e){return e==null?e:!!e}function PO(e){return e==null?e:e.toString()}function Xu(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function iW(e){return e==null?e:Math.round(parseFloat(e))}function vde(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function o6(e,t){return t!=null&&e&&!(t instanceof e)}function _de(e){return e&&"isCollection"in e}function BQ(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function AOe(e,t){if(!t||!t.constructor||!_de(t.constructor))return $z(e,t)?t:new e(t);const i=BQ(e.prototype.itemType),r=BQ(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):($z(e,t),t):new e(t):t}function $z(e,t){return!!vde(t)&&(vT.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+SL(e)+"'"),!0)}function ZT(e,t){return t==null?t:_de(e)?AOe(e,t):o6(e,t)?$z(e,t)?t:new e(t):t}function SL(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const COe=new WeakMap;function MOe(e){switch(e){case Number:return Xu;case us:return iW;case Boolean:return EOe;case String:return PO;case Date:return SOe;default:return yde(COe,e,()=>ZT.bind(null,e))}}function Ys(e,t){const i=MOe(e);return arguments.length===1?i:i(t)}function rR(e,t,i){return arguments.length===1?rR.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function ROe(e,t){return arguments.length===1?rR(Ys.bind(null,e)):rR(Ys.bind(null,e),t)}function bde(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>bde(e,t-1,r)):e(i)}function a6(e,t,i){if(arguments.length===2)return a6.bind(null,e,t);if(!i)return i;let r=t,s=i=bde(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function OOe(e,t,i){return arguments.length===2?a6(Ys.bind(null,e),t):a6(Ys.bind(null,e),t,i)}function wde(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function Dz(e,t){if(arguments.length===2)return Dz(e).call(null,t);const i=new Set,r=e.filter(l=>typeof l!="function"),s=e.filter(l=>typeof l=="function");for(const l of e)typeof l!="string"&&typeof l!="number"||i.add(l);let n=null,a=null;return(l,p)=>{if(l==null)return l;const y=typeof l,b=y==="string"||y==="number";return b&&(i.has(l)||s.some(x=>y==="string"&&x===String||y==="number"&&x===Number))||y==="object"&&s.some(x=>!o6(l,x))?l:(b&&r.length?(n||(n=r.map(x=>typeof x=="string"?`'${x}'`:`${x}`).join(", ")),vT.error("Accessor#set",`'${l}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof l=="object"&&s.length?(a||(a=s.map(x=>SL(x)).join(", ")),vT.error("Accessor#set",`'${l}' is not a valid value for this property, value must be one of ${a}`)):vT.error("Accessor#set",`'${l}' is not a valid value for this property`),p&&(p.valid=!1),null)}}function Dp(e,t){if(arguments.length===2)return Dp(e).call(null,t);const i={},r=[],s=[];for(const p in e.typeMap){const y=e.typeMap[p];i[p]=Ys(y),r.push(SL(y)),s.push(p)}const n=()=>`'${r.join("', '")}'`,a=()=>`'${s.join("', '")}'`,l=typeof e.key=="string"?p=>p[e.key]:e.key;return p=>{if(e.base&&!o6(e.base,p)||p==null)return p;const y=l(p)||e.defaultKeyValue,b=i[y];if(!b)return vT.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!o6(e.typeMap[y],p))return p;if(typeof e.key=="string"&&!vde(p)){const x={};for(const A in p)A!==e.key&&(x[A]=p[A]);return b(x)}return b(p)}}class us{}const Dxt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function POe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function xde(e){switch(e.type){case"native":return Ys(e.value);case"array":return rR(xde(e.value));case"one-of":return IOe(e);default:return null}}function IOe(e){let t=null;return(i,r)=>Nz(i,e)?i:(t==null&&(t=Lz(e)),vT.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function Lz(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case us:return"integer";case Date:return"date";default:return SL(e.value)}case"array":return`array of ${Lz(e.value)}`;case"one-of":{const t=e.values.map(i=>Lz(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function Nz(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case us:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!Nz(i,t.value));case"one-of":return t.values.some(i=>Nz(e,i))}}function V4(e){return Ot(iW(e),0,255)}function G4(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class io{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new io){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const a=s[0];if(a.charAt(a.length-1)==="%"){const l=s.map(p=>2.56*parseFloat(p));return s.length===4&&(l[3]=parseFloat(s[3])),io.fromArray(l,i)}return io.fromArray(s.map(l=>parseFloat(l)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return io.fromArray(ede(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new io){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(a=>{const l=n&s;n>>=r,i[a]=r===4?17*l:l}),i.a=1,i)}static fromArray(t,i=new io){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=Que(t)?Hq(t):null;return r&&io.fromArray(r,i)||io.fromRgb(t,i)||io.fromHex(t,i)}static fromJSON(t){return t&&new io([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return L(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return L(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){if(typeof t=="string")io.fromString(t,this);else if(Array.isArray(t))io.fromArray(t,this);else{var i,r,s,n;this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof io||this._sanitize()}return this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=io.AlphaMode.ALWAYS){const i=V4(this.r),r=V4(this.g),s=V4(this.b);return t===io.AlphaMode.ALWAYS||this.a!==1?[i,r,s,V4(255*this.a)]:[i,r,s]}clone(){return new io(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return L(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(G4(this.r,0,255)),this.g=Math.round(G4(this.g,0,255)),this.b=Math.round(G4(this.b,0,255)),this.a=G4(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}io.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(io||(io={}));const Ft=io;class VQ{constructor(t){this.autoDestroy=!1,this.properties=t}}function IO(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=Fe(r[n]);t=new VQ(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new VQ({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function $Oe(e){return IO(e).properties}function EL(e,t){const i=$Oe(e);let r=i[t];return r||(r=i[t]={}),r}function DOe(e,t){return UI(e,t,NOe)}const LOe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function NOe(e){return LOe.test(e)?"replace":"merge"}function l6(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))l6(e,r,t[r]);else{if(t.indexOf(".")!==-1){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void l6(W$(e,s),n,i)}const r=e.__accessor__;r!=null&&FOe(t,r),e[t]=i}}function FOe(e,t){if(je("esri-unknown-property-errors")&&!kOe(e,t))throw new Se("set:unknown-property",UOe(e,t))}function kOe(e,t){return t.metadatas[e]!=null}function UOe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}Ge.getLogger("esri.core.accessorSupport.set");function S(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=EL(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&Ge.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const p=typeof n=="string"?n:n.source,y=typeof n=="string"?null:n.overridable===!0;let b;s.dependsOn=[p],s.get=function(){let x=W$(this,p);if(typeof x=="function"){b||(b=p.split(".").slice(0,-1).join("."));const A=W$(this,b);A&&(x=x.bind(A))}return x},s.readOnly||(s.set=y?function(x){x!==void 0?this._override(i,x):this._clearOverride(i)}:function(x){l6(this,p,x)})}const a=e.type,l=e.types;s.cast||(a?s.cast=zOe(a):l&&(Array.isArray(l)?s.cast=rR(Dp(l[0])):s.cast=Dp(l))),e.range&&(s.cast=BOe(s.cast,e.range)),DOe(s,e)}}function Tde(e,t,i){const r=EL(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function zOe(e){let t=0,i=e;if(POe(e))return xde(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(wde(r))return t===0?Dz(r):a6(Dz(r),t);if(t===1)return ROe(r);if(t>1)return OOe(r,t);const s=e;return s.from?s.from:Ys(s)}function BOe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function oi(e,t){const i=t?qe(ie({},t),{source:e}):e;return S({aliasOf:i})}const VOe=Object.prototype.toString;function GOe(e){const t="__accessorMetadata__"in e?Ys(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return jOe.apply(this,i)}}function jOe(e,t,i,r){EL(e,t).cast=r}function HOe(e){return function(t,i){EL(t,e).cast=t[i]}}function _i(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&VOe.call(e[0])==="[object Function]"?GOe(e[0]):e.length===1&&typeof e[0]=="string"?HOe(e[0]):void 0}class Ui{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const a=this.toJSON(r);a!==void 0&&Kh(n,a,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function Va(){return function(e,t){return new Ui(e,ie({ignoreUnknown:!0},t))}}function ti(e,t={}){var i;const r=e instanceof Ui?e:new Ui(e,t),s={type:(i=t==null?void 0:t.ignoreUnknown)==null||i?r.apiValues:String,json:{type:r.jsonValues,read:(t==null||!t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(s.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(s.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(s.json.name=t.name),S(s)}function wt(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,a)=>{const l=n.constructor.prototype;r.forEach(p=>{const y=Tde(n,p,s);y.read&&typeof y.read=="object"||(y.read={}),y.read.reader=l[a],i&&(y.read.source=(y.read.source||[]).concat(i))})}}function rW(e){return(t,i)=>{t[i]=e}}var Wf;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Wf||(Wf={}));function qOe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Qh extends vL{constructor(t,i,r){if(super(t,i,r),!(this instanceof Qh))return new Qh(t,i,r)}}Qh.prototype.type="warning";function Sde(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Fz=Ge.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function GQ(e,t,i){var r,s;e&&(!i&&!t.read||(r=t.read)!=null&&r.reader||((s=t.read)==null?void 0:s.enabled)===!1||YOe(e)&&Kh("read.reader",rE(e),t))}function rE(e){var t;const i=(t=e.ndimArray)!=null?t:0;if(i>1)return XOe(e);if(i===1)return jQ(e);if("type"in e&&Ade(e.type)){var r,s;const n=(r=e.type.prototype)==null||(s=r.itemType)==null?void 0:s.Type,a=jQ(typeof n=="function"?{type:n}:{types:n});return(l,p,y)=>{const b=a(l,p,y);return b&&new e.type(b)}}return sW(e)}function sW(e){return"type"in e?WOe(e.type):JOe(e.types)}function WOe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void Fz.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function Ede(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>Ede(e,s,i,r-1)):e(t,void 0,i)}function XOe(e){var t;const i=sW(e),r=Ede.bind(null,i),s=(t=e.ndimArray)!=null?t:0;return(n,a,l)=>{if(n==null)return n;n=r(n,l,s);let p=s,y=n;for(;p>0&&Array.isArray(y);)p--,y=y[0];if(y!==void 0)for(let b=0;b<p;b++)n=[n];return n}}function jQ(e){const t=sW(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const a=[];for(const l of i){const p=t(l,void 0,s);p!==void 0&&a.push(p)}return a}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Ade(e){if(!Sde(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?nW(t.Type):Cde(t.Type))}function YOe(e){return"types"in e?Cde(e.types):nW(e.type)}function nW(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Ade(e))}function Cde(e){for(const t in e.typeMap)if(!nW(e.typeMap[t]))return!1;return!0}function JOe(e){var t;let i=null;const r=(t=e.errorContext)!=null?t:"type";return(s,n,a)=>{if(s==null)return s;const l=typeof s;if(l!=="object")return void Fz.error(`Expected JSON value of type 'object' to deserialize, but got '${l}'`);i||(i=ZOe(e));const p=e.key;if(typeof p!="string")return;const y=s[p],b=y?i[y]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!b){const A=`Type '${y||"unknown"}' is not supported`;return a&&a.messages&&s&&a.messages.push(new Qh(`${r}:unsupported`,A,{definition:s,context:a})),void Fz.error(A)}const x=new b;return x.read(s,a),x}}function ZOe(e){const t={};for(const s in e.typeMap){var i,r;const n=e.typeMap[s],a=IO(n.prototype);if(typeof e.key=="function")continue;const l=a.properties[e.key];if(!l)continue;(i=l.json)!=null&&i.type&&Array.isArray(l.json.type)&&l.json.type.length===1&&typeof l.json.type[0]=="string"&&(t[l.json.type[0]]=n);const p=(r=l.json)==null?void 0:r.write;if(!p||!p.writer){t[s]=n;continue}const y=p.target,b=typeof y=="string"?y:e.key,x={};p.writer(s,x,b),x[b]&&(t[x[b]]=n)}return t}function KOe(e){if(e.json||(e.json={}),qQ(e.json),WQ(e.json),HQ(e.json),e.json.origins)for(const t in e.json.origins)qQ(e.json.origins[t]),WQ(e.json.origins[t]),HQ(e.json.origins[t]);return!0}function HQ(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function qQ(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function WQ(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const QOe=Ge.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function XQ(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&Sde(e.type))?t.write.writer=i4e:r>1?t.write.writer=r4e(r):t.types?Array.isArray(t.types)?t.write.writer=t4e(t.types[0]):t.write.writer=e4e(t.types):t.write.writer=sR}function e4e(e){return(t,i,r,s)=>t?Mde(t,e,s)?sR(t,i,r,s):void 0:sR(t,i,r,s)}function Mde(e,t,i){for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i!=null&&i.messages){var r,s;const n=(r=t.errorContext)!=null?r:"type",a=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new Se(`${n}:unsupported`,a,{definition:e,context:i})),QOe.error(a)}return!1}function t4e(e){return(t,i,r,s)=>!t||!Array.isArray(t)?sR(t,i,r,s):sR(t.filter(n=>Mde(n,e,s)),i,r,s)}function sR(e,t,i,r){Kh(i,c6(e,r),t)}function c6(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?h6(e):e}function h6(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function i4e(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>c6(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[c6(e,r)],Kh(i,s,t)}function Rde(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Rde(r,t,i-1)):c6(e,t)}function r4e(e){return function(t,i,r,s){let n;if(t===null)n=null;else{n=Rde(t,s,e);let a=e,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let p=0;p<a;p++)n=[n]}Kh(r,n,i)}}function kz(e,t){return oW(e,"read",t)}function Ode(e,t){return oW(e,"write",t)}function oW(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function s4e(e){const t=n4e(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?o4e(r):t;GQ(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=ie({},e.json.write)),XQ(s,r)}GQ(t,e.json,!0),XQ(t,e.json)}function n4e(e){return e.json.types?Uz(e.json):e.type?Pde(e):Uz(e)}function o4e(e){return e.type?Pde(e):Uz(e)}function Pde(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!wde(i);)i=i[0],t++;return{type:i,ndimArray:t}}function Uz(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function a4e(e){KOe(e)&&(qOe(e),s4e(e))}const SF=new Set,EF=new Set;function re(e){return t=>{t.prototype.declaredClass=e,c4e(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!SF.has(s.initialize)&&(SF.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!EF.has(s.destroy)&&(EF.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);SF.clear(),EF.clear();class n extends t{constructor(...l){if(super(...l),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let p=i.length-1;p>=0;p--)i[p].call(this)}}),r.length){let p=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!p){p=!0;for(let y=0;y<r.length;y++)r[y].call(this)}}})}this.postscript(...l)}}}return n.__accessorMetadata__=IO(t.prototype),n.prototype.declaredClass=e,n}}function l4e(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;Li(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function c4e(e){const t=e.prototype,i=IO(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];a4e(n),r[s]={enumerable:!0,configurable:!0,get:l4e(s,n),set(a){const l=this.__accessor__;if(l!==void 0){if(!Object.isFrozen(this)){if(l.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(l.lifecycle===Wf.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);l.set(s,a)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:a})}}}Object.defineProperties(e.prototype,r)}function Et(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,a)=>{const l=n.constructor.prototype;for(const p of r){const y=Tde(n,p,s);y.write&&typeof y.write=="object"||(y.write={}),i&&(y.write.target=i),y.write.writer=l[a]}}}/*!
 * @esri/arcgis-html-sanitizer - v2.9.0 - Mon Dec 13 2021 15:07:01 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var h4e="[object Object]";function u4e(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function d4e(e,t){return function(i){return e(t(i))}}var p4e=Function.prototype,Ide=Object.prototype,$de=p4e.toString,f4e=Ide.hasOwnProperty,m4e=$de.call(Object),g4e=Ide.toString,y4e=d4e(Object.getPrototypeOf,Object);function v4e(e){return!!e&&typeof e=="object"}function _4e(e){if(!v4e(e)||g4e.call(e)!=h4e||u4e(e))return!1;var t=y4e(e);if(t===null)return!0;var i=f4e.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&$de.call(i)==m4e}var b4e=_4e,j3={exports:{}},$n={},nR={exports:{}},xw={};function Dde(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function w4e(e,t,i){}function x4e(e,t,i){}var T4e=/javascript\s*\:/img;function S4e(e,t){return T4e.test(t)?"":t}xw.whiteList=Dde();xw.getDefaultWhiteList=Dde;xw.onAttr=w4e;xw.onIgnoreAttr=x4e;xw.safeAttrValue=S4e;var E4e={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},NE=E4e;function A4e(e,t){e=NE.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,a="";function l(){if(!r){var b=NE.trim(e.slice(s,n)),x=b.indexOf(":");if(x!==-1){var A=NE.trim(b.slice(0,x)),M=NE.trim(b.slice(x+1));if(A){var P=t(s,a.length,A,M,b);P&&(a+=P+"; ")}}}s=n+1}for(;n<i;n++){var p=e[n];if(p==="/"&&e[n+1]==="*"){var y=e.indexOf("*/",n+2);if(y===-1)break;n=y+1,s=n+1,r=!1}else p==="("?r=!0:p===")"?r=!1:p===";"?r||l():p===`
`&&l()}return NE.trim(a)}var C4e=A4e,j4=xw,M4e=C4e;function YQ(e){return e==null}function R4e(e){var t={};for(var i in e)t[i]=e[i];return t}function Lde(e){e=R4e(e||{}),e.whiteList=e.whiteList||j4.whiteList,e.onAttr=e.onAttr||j4.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||j4.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||j4.safeAttrValue,this.options=e}Lde.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,a=i.safeAttrValue,l=M4e(e,function(p,y,b,x,A){var M=r[b],P=!1;if(M===!0?P=M:typeof M=="function"?P=M(x):M instanceof RegExp&&(P=M.test(x)),P!==!0&&(P=!1),x=a(b,x),!!x){var $={position:y,sourcePosition:p,source:A,isWhite:P};if(P){var k=s(b,x,$);return YQ(k)?b+":"+x:k}else{var k=n(b,x,$);if(!YQ(k))return k}}});return l};var O4e=Lde;(function(e,t){var i=xw,r=O4e;function s(a,l){var p=new r(l);return p.process(a)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(nR,nR.exports);var aW={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},P4e=nR.exports.FilterCSS,I4e=nR.exports.getDefaultWhiteList,u6=aW;function Nde(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Fde=new P4e;function $4e(e,t,i){}function D4e(e,t,i){}function L4e(e,t,i){}function N4e(e,t,i){}function kde(e){return e.replace(k4e,"&lt;").replace(U4e,"&gt;")}function F4e(e,t,i,r){if(i=jde(i),t==="href"||t==="src"){if(i=u6.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(H4.lastIndex=0,H4.test(i))return""}else if(t==="style"){if(JQ.lastIndex=0,JQ.test(i)||(ZQ.lastIndex=0,ZQ.test(i)&&(H4.lastIndex=0,H4.test(i))))return"";r!==!1&&(r=r||Fde,i=r.process(i))}return i=Hde(i),i}var k4e=/</g,U4e=/>/g,z4e=/"/g,B4e=/&quot;/g,V4e=/&#([a-zA-Z0-9]*);?/gim,G4e=/&colon;?/gim,j4e=/&newline;?/gim,H4=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,JQ=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ZQ=/u\s*r\s*l\s*\(.*/gi;function Ude(e){return e.replace(z4e,"&quot;")}function zde(e){return e.replace(B4e,'"')}function Bde(e){return e.replace(V4e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Vde(e){return e.replace(G4e,":").replace(j4e," ")}function Gde(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return u6.trim(t)}function jde(e){return e=zde(e),e=Bde(e),e=Vde(e),e=Gde(e),e}function Hde(e){return e=Ude(e),e=kde(e),e}function H4e(){return""}function q4e(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(a){return i?!0:u6.indexOf(e,a)!==-1}var s=[],n=!1;return{onIgnoreTag:function(a,l,p){if(r(a))if(p.isClosing){var y="[/removed]",b=p.position+y.length;return s.push([n!==!1?n:p.position,b]),n=!1,y}else return n||(n=p.position),"[removed]";else return t(a,l,p)},remove:function(a){var l="",p=0;return u6.forEach(s,function(y){l+=a.slice(p,y[0]),p=y[1]}),l+=a.slice(p),l}}}function W4e(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function X4e(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}$n.whiteList=Nde();$n.getDefaultWhiteList=Nde;$n.onTag=$4e;$n.onIgnoreTag=D4e;$n.onTagAttr=L4e;$n.onIgnoreTagAttr=N4e;$n.safeAttrValue=F4e;$n.escapeHtml=kde;$n.escapeQuote=Ude;$n.unescapeQuote=zde;$n.escapeHtmlEntities=Bde;$n.escapeDangerHtml5Entities=Vde;$n.clearNonPrintableCharacter=Gde;$n.friendlyAttrValue=jde;$n.escapeAttrValue=Hde;$n.onIgnoreTagStripAll=H4e;$n.StripTagBody=q4e;$n.stripCommentTag=W4e;$n.stripBlankChar=X4e;$n.cssFilter=Fde;$n.getDefaultCSSWhiteList=I4e;var AL={},vy=aW;function Y4e(e){var t=vy.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=vy.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function J4e(e){return e.slice(0,2)==="</"}function Z4e(e,t,i){var r="",s=0,n=!1,a=!1,l=0,p=e.length,y="",b="";e:for(l=0;l<p;l++){var x=e.charAt(l);if(n===!1){if(x==="<"){n=l;continue}}else if(a===!1){if(x==="<"){r+=i(e.slice(s,l)),n=l,s=l;continue}if(x===">"){r+=i(e.slice(s,n)),b=e.slice(n,l+1),y=Y4e(b),r+=t(n,r.length,y,b,J4e(b)),s=l+1,n=!1;continue}if(x==='"'||x==="'")for(var A=1,M=e.charAt(l-A);M.trim()===""||M==="=";){if(M==="="){a=x;continue e}M=e.charAt(l-++A)}}else if(x===a){a=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var K4e=/[^a-zA-Z0-9_:\.\-]/gim;function Q4e(e,t){var i=0,r=[],s=!1,n=e.length;function a(x,A){if(x=vy.trim(x),x=x.replace(K4e,"").toLowerCase(),!(x.length<1)){var M=t(x,A||"");M&&r.push(M)}}for(var l=0;l<n;l++){var p=e.charAt(l),y,b;if(s===!1&&p==="="){s=e.slice(i,l),i=l+1;continue}if(s!==!1&&l===i&&(p==='"'||p==="'")&&e.charAt(l-1)==="="){if(b=e.indexOf(p,l+1),b===-1)break;y=vy.trim(e.slice(i+1,b)),a(s,y),s=!1,l=b,i=l+1;continue}if(/\s|\n|\t/.test(p))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(b=e5e(e,l),b===-1){y=vy.trim(e.slice(i,l)),a(y),s=!1,i=l+1;continue}else{l=b-1;continue}else if(b=t5e(e,l-1),b===-1){y=vy.trim(e.slice(i,l)),y=KQ(y),a(s,y),s=!1,i=l+1;continue}else continue}return i<e.length&&(s===!1?a(e.slice(i)):a(s,KQ(vy.trim(e.slice(i))))),vy.trim(r.join(" "))}function e5e(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function t5e(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function i5e(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function KQ(e){return i5e(e)?e.substr(1,e.length-2):e}AL.parseTag=Z4e;AL.parseAttr=Q4e;var r5e=nR.exports.FilterCSS,op=$n,qde=AL,s5e=qde.parseTag,n5e=qde.parseAttr,GI=aW;function q4(e){return e==null}function o5e(e){var t=GI.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=GI.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=GI.trim(e.slice(0,-1))),{html:e,closing:i}}function a5e(e){var t={};for(var i in e)t[i]=e[i];return t}function Wde(e){e=a5e(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=op.onIgnoreTagStripAll),e.whiteList=e.whiteList||op.whiteList,e.onTag=e.onTag||op.onTag,e.onTagAttr=e.onTagAttr||op.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||op.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||op.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||op.safeAttrValue,e.escapeHtml=e.escapeHtml||op.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new r5e(e.css))}Wde.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,a=i.onTagAttr,l=i.onIgnoreTagAttr,p=i.safeAttrValue,y=i.escapeHtml,b=t.cssFilter;i.stripBlankChar&&(e=op.stripBlankChar(e)),i.allowCommentTag||(e=op.stripCommentTag(e));var x=!1;if(i.stripIgnoreTagBody){var x=op.StripTagBody(i.stripIgnoreTagBody,n);n=x.onIgnoreTag}var A=s5e(e,function(M,P,$,k,z){var G={sourcePosition:M,position:P,isClosing:z,isWhite:r.hasOwnProperty($)},B=s($,k,G);if(!q4(B))return B;if(G.isWhite){if(G.isClosing)return"</"+$+">";var W=o5e(k),q=r[$],X=n5e(W.html,function(de,he){var fe=GI.indexOf(q,de)!==-1,me=a($,de,he,fe);if(!q4(me))return me;if(fe)return he=p($,de,he,b),he?de+'="'+he+'"':de;var me=l($,de,he,fe);return q4(me)?void 0:me}),k="<"+$;return X&&(k+=" "+X),W.closing&&(k+=" /"),k+=">",k}else{var B=n($,k,G);return q4(B)?y(k):B}},y);return x&&(A=x.remove(A)),A};var l5e=Wde;(function(e,t){var i=$n,r=AL,s=l5e;function n(p,y){var b=new s(y);return b.process(p)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var a in i)t[a]=i[a];for(var a in r)t[a]=r[a];function l(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}l()&&(self.filterXSS=e.exports)})(j3,j3.exports);var c5e=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,a,l,p){return n==="a"&&a==="href"||(n==="img"||n==="source")&&a==="src"?r.sanitizeUrl(l):j3.exports.safeAttrValue(n,a,l,p)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new j3.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t){var i=this._trim(t.substring(0,t.indexOf(":")));return t==="/"||t==="#"||t[0]==="#"||this.allowedProtocols.indexOf(i.toLowerCase())>-1?j3.exports.escapeAttrValue(t):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):j3.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(l,p){var y=r.validate(p,i);return y.isValid?l.concat([p]):(s=!0,l.concat([y.sanitized]))},[]);else if(b4e(t)){var a=Object.keys(t);n=a.reduce(function(l,p){var y=t[p],b=r.validate(y,i);return b.isValid?l[p]=y:(s=!0,l[p]=b.sanitized),l},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const CL=new Map;function Xde(){CL.clear()}function h5e(e){return CL.get(e)}function u5e(e,t){CL.set(e,t)}function AF(e){CL.delete(e)}var k2,KT,d5e=function(e){if("WebkitTransition"in e.style)k2="webkitTransitionEnd",KT="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");k2="transitionend",KT="animationend"}},Yde=function(e){k2||d5e(e)},p5e=function(e,t){return t===void 0&&(t=e+"-active"),function(i){Yde(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(k2,s),i.removeEventListener(KT,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(k2,s),i.addEventListener(KT,s),requestAnimationFrame(function(){i.classList.add(t)})}},f5e=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){Yde(i);var s=!1,n=function(a){s||(s=!0,i.removeEventListener(k2,n),i.removeEventListener(KT,n),r())};i.classList.add(e),i.addEventListener(k2,n),i.addEventListener(KT,n),requestAnimationFrame(function(){i.classList.add(t)})}};const m5e=Ge.getLogger("esri.widgets.support.widgetUtils");function Jde(e){const t=Uc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const a in s)s[a]&&t.push(a)}const i=t.join(" ");return Uc.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{Xde();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&m5e.error("Already observing element",i),e.set(i,r),t.observe(i,s),Hp(()=>{t.unobserve(i),e.delete(i)}))})();function Uy(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function QQ(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function zz(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function g5e(e,t){return(e==="enter"?p5e:f5e)(t)}const y5e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],v5e=y5e.reduce((e,t)=>(e[t]=[],e),{}),_5e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Zde=new c5e({whiteList:v5e,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(_5e.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function b5e(e){return e==="Enter"||e===" "}function zu(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:x5e(e[t])}}}function w5e(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function x5e(e){return function(t,...i){w5e(t)?b5e(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function Zc(e){return function(t,i){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}const eee=new Set;function T5e(e,t,i=!1){i&&eee.has(t)||(i&&eee.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function Vx(e,t,i={}){if(je("esri-deprecation-warnings")){const{moduleName:r}=i;QT(e,`Function: ${(r?r+"::":"")+t+"()"}`,i)}}function S5e(e,t,i={}){if(je("esri-deprecation-warnings")){const{moduleName:r}=i;QT(e,`Property: ${(r?r+"::":"")+t}`,i)}}function QT(e,t,i={}){if(je("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:a}=i;let l=t;r&&(l+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(l+=`
	\u2699\uFE0F Version: ${s}`),n&&(l+=`
	\u{1F517} See ${n} for more details.`),T5e(e,l,a)}}function E5e(e){return e.split(",").map(t=>t.trim())}function A5e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:E5e(e);i.push(...r)}}const Kde=Symbol("widget"),C5e=[],M5e={},d6=new WeakMap;function Qde(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=Qde(e,i[s]);else i=C5e;const r=t.vnodeSelector;if(lW(r)){const s=t.properties||M5e,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:R5e,afterUpdate:O5e,afterRemoved:epe,parentWidget:e,widgetConstructor:r,widgetProperties:qe(ie({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function R5e(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const a=new s(n);a.container=e,d6.set(e,a),a.afterCreate==null||a.afterCreate(a,e),r._internalHandles.add(Hp(()=>epe(e)))}function O5e(e,t,i,{widgetProperties:r}){const s=d6.get(e);s&&(s.set(r),s.afterUpdate==null||s.afterUpdate(s,e))}function epe(e){const t=d6.get(e);t&&(t.destroy(),d6.delete(e))}function lW(e){return typeof e=="function"&&e[Kde]}var P5e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},tpe=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?tpe(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=P5e(s)),t.push(s))}},I5e=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return tpe(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function Ve(e,t,...i){return typeof e!="function"||lW(e)?I5e(e,t,...i):e(t,...i)}function ipe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function rpe(){return ipe().startsWith("dark")}function $5e(){return"calcite-theme-"+(rpe()?"dark":"light")}function spe(e){return e&&typeof e.render=="function"}function D5e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function _(e,t,i,r){var s,n=arguments.length,a=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}var tee,iee,ree;let L5e,hM;const see=(tee=(iee=globalThis.esriConfig)==null?void 0:iee.locale)!=null?tee:(ree=globalThis.dojoConfig)==null?void 0:ree.locale;function npe(){var e,t;return(e=see!=null?see:(t=globalThis.navigator)==null?void 0:t.language)!=null?e:"en"}function Wh(){return hM===void 0&&(hM=npe()),hM}const uM=[];function N5e(e){return uM.push(e),{remove(){uM.splice(uM.indexOf(e),1)}}}const Bz=[];function cW(e){return Bz.push(e),{remove(){uM.splice(Bz.indexOf(e),1)}}}function F5e(){var e;const t=(e=L5e)!=null?e:npe();hM!==t&&(hM=t,[...Bz].forEach(i=>{i.call(null,t)}),[...uM].forEach(i=>{i.call(null,t)}))}globalThis.addEventListener==null||globalThis.addEventListener("languagechange",F5e);const Jp={year:"numeric",month:"numeric",day:"numeric"},FE={year:"numeric",month:"long",day:"numeric"},kE={year:"numeric",month:"short",day:"numeric"},UE={year:"numeric",month:"long",weekday:"long",day:"numeric"},Tu={hour:"numeric",minute:"numeric"},Ad=qe(ie({},Tu),{second:"numeric"}),hW={"short-date":Jp,"short-date-short-time":ie(ie({},Jp),Tu),"short-date-short-time-24":qe(ie(ie({},Jp),Tu),{hour12:!1}),"short-date-long-time":ie(ie({},Jp),Ad),"short-date-long-time-24":qe(ie(ie({},Jp),Ad),{hour12:!1}),"short-date-le":Jp,"short-date-le-short-time":ie(ie({},Jp),Tu),"short-date-le-short-time-24":qe(ie(ie({},Jp),Tu),{hour12:!1}),"short-date-le-long-time":ie(ie({},Jp),Ad),"short-date-le-long-time-24":qe(ie(ie({},Jp),Ad),{hour12:!1}),"long-month-day-year":FE,"long-month-day-year-short-time":ie(ie({},FE),Tu),"long-month-day-year-short-time-24":qe(ie(ie({},FE),Tu),{hour12:!1}),"long-month-day-year-long-time":ie(ie({},FE),Ad),"long-month-day-year-long-time-24":qe(ie(ie({},FE),Ad),{hour12:!1}),"day-short-month-year":kE,"day-short-month-year-short-time":ie(ie({},kE),Tu),"day-short-month-year-short-time-24":qe(ie(ie({},kE),Tu),{hour12:!1}),"day-short-month-year-long-time":ie(ie({},kE),Ad),"day-short-month-year-long-time-24":qe(ie(ie({},kE),Ad),{hour12:!1}),"long-date":UE,"long-date-short-time":ie(ie({},UE),Tu),"long-date-short-time-24":qe(ie(ie({},UE),Tu),{hour12:!1}),"long-date-long-time":ie(ie({},UE),Ad),"long-date-long-time-24":qe(ie(ie({},UE),Ad),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Tu,"long-time":Ad},oR=Va()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});oR.apiValues;oR.toJSON.bind(oR);oR.fromJSON.bind(oR);const k5e={ar:"ar-u-nu-latn-ca-gregory"};let jI=new WeakMap,ope=hW["short-date-short-time"];function U5e(e){const t=e||ope;if(!jI.has(t)){const i=Wh(),r=k5e[Wh()]||i;jI.set(t,new Intl.DateTimeFormat(r,t))}return jI.get(t)}function uW(e){return hW[e]||null}function xg(e,t){return U5e(t).format(e)}cW(()=>{jI=new WeakMap,ope=hW["short-date-short-time"]});const z5e={ar:"ar-u-nu-latn"};let HI=new WeakMap,ape={};function B5e(e){const t=e||ape;if(!HI.has(t)){const i=Wh(),r=z5e[Wh()]||i;HI.set(t,new Intl.NumberFormat(r,e))}return HI.get(t)}function lpe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Tg(e,t){return B5e(t).format(e)}cW(()=>{HI=new WeakMap,ape={}});const cpe=Ge.getLogger("esri.intl");function om(e,t,i={}){const{format:r={}}=i;return o0(e,s=>V5e(s,t,r))}function V5e(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const a=iE(r,t);if(a==null)return"";const l=i[s]||i[r];return l?G5e(a,l):s?j5e(a,s):dW(a)}function G5e(e,t){switch(t.type){case"date":return xg(e,t.intlOptions);case"number":return Tg(e,t.intlOptions);default:return cpe.warn("missing format descriptor for key {key}"),dW(e)}}function j5e(e,t){switch(t.toLowerCase()){case"dateformat":return xg(e);case"numberformat":return Tg(e);default:return cpe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?xg(e):/^numberformat/i.test(t)?Tg(e):dW(e)}}function dW(e){switch(typeof e){case"string":return e;case"number":return Tg(e);case"boolean":return""+e;default:return e instanceof Date?xg(e):""}}const nee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,H5e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function oee(e){var t;return(t=H5e[e])!=null&&t}const JA=[],_T=new Map;function aee(e){for(const t of _T.keys())upe(e.pattern,t)&&_T.delete(t)}function q5e(e){return JA.includes(e)||(aee(e),JA.unshift(e)),{remove(){const t=JA.indexOf(e);t>-1&&(JA.splice(t,1),aee(e))}}}async function hpe(e){const t=Wh();_T.has(e)||_T.set(e,X5e(e,t));const i=_T.get(e);return await Y5e.add(i),i}function W5e(e){if(!nee.test(e))return null;const[,t,i]=nee.exec(e),r=t+(i?"-"+i.toUpperCase():"");return oee(r)?r:oee(t)?t:null}async function X5e(e,t){const i=[];for(const r of JA)if(upe(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new Se("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new Se("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function upe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}cW(()=>{_T.clear()});const Y5e=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=gv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},J5e=Ge.getLogger("esri.core.urlUtils"),sE=qr.request,lee="esri/config: esriConfig.request.proxyUrl is not set.",dpe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,ppe=/^\s*http:/i,Z5e=/^\s*https:/i,K5e=/^\s*file:/i,Q5e=/:\d+$/,ePe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,tPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),iPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class bT{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(tPe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(iPe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const W4={},rPe=new bT(qr.applicationUrl);let pl=rPe;const sPe=nPe();let pW=sPe;const fpe=()=>pl,Lxt=()=>pW;function nPe(){const e=pl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${pl.scheme}://${pl.host}${pl.port!=null?`:${pl.port}`:""}`}${t}`}function Gn(e){const t={path:null,query:null},i=new bT(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=mpe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function mpe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,a;s<0?(n=decodeURIComponent(r),a=""):(n=decodeURIComponent(r.slice(0,s)),a=decodeURIComponent(r.slice(s+1)));let l=i[n];typeof l=="string"&&(l=i[n]=[l]),Array.isArray(l)?l.push(a):i[n]=a}return i}function cee(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function aR(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(a=>cee(a)?s+encodeURIComponent(JSON.stringify(a)):s+encodeURIComponent(a)).join("&"):cee(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function oPe(e=!1){let t,i=sE.proxyUrl;if(typeof e=="string"){t=pPe(e);const r=ML(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw J5e.warn(lee),new Se("urlutils:proxy-not-set",lee);return t&&Vz()&&(i=vW(i)),Gn(i)}function aPe(e){const t=ML(e);let i,r;if(t){const s=fW(t.proxyUrl);i=s.path,r=s.query?mpe(s.query):null}if(i){const s=Gn(e);e=i+"?"+s.path;const n=aR(ie(ie({},r),s.query));n&&(e=`${e}?${n}`)}return e}const zE={path:"",query:""};function fW(e){const t=e.indexOf("?");return t!==-1?(zE.path=e.slice(0,t),zE.query=e.slice(t+1)):(zE.path=e,zE.query=null),zE}function gpe(e){return e=(e=f6(e=_Pe(e=fW(e).path),!0)).toLowerCase()}function lPe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:gpe(e.urlPrefix)},i=sE.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const a=i[n].urlPrefix;if(r.indexOf(a)===0){if(r.length===a.length)return-1;s=n;break}a.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function ML(e){const t=sE.proxyRules,i=gpe(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function ype(e,t){return e=hee(e),t=hee(t),f6(e)===f6(t)}function hee(e){const t=(e=cd(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function vpe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=sE.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function p6(e,t,i=!1){const r=jz(e),s=jz(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function mW(e){if(typeof e=="string"){if(!Xh(e))return!0;e=jz(e)}if(p6(e,pl))return!0;const t=sE.trustedServers||[];for(let i=0;i<t.length;i++){const r=cPe(t[i]);for(let s=0;s<r.length;s++)if(p6(e,r[s]))return!0}return!1}function cPe(e){return W4[e]||(yW(e)||l0(e)?W4[e]=[new bT(nd(e))]:W4[e]=[new bT(`http://${e}`),new bT(`https://${e}`)]),W4[e]}function nd(e,t=pW,i){return l0(e)?i&&i.preserveProtocolRelative?e:pl.scheme==="http"&&pl.authority===nE(e).slice(2)?`http:${e}`:`https:${e}`:yW(e)?e:ih(e[0]==="/"?yPe(t):t,e)}function gW(e,t=pW,i){if(!Xh(e))return e;const r=cd(e),s=r.toLowerCase(),n=cd(t).toLowerCase().replace(/\/+$/,""),a=i?cd(i).toLowerCase().replace(/\/+$/,""):null;if(a&&n.indexOf(a)!==0)return e;const l=(x,A,M)=>(M=x.indexOf(A,M))===-1?x.length:M;let p=l(s,"/",s.indexOf("//")+2),y=-1;for(;s.slice(0,p+1)===n.slice(0,p)+"/"&&(y=p+1,p!==s.length);)p=l(s,"/",p+1);if(y===-1||a&&y<a.length)return e;e=r.slice(y);const b=n.slice(y-1).replace(/[^/]+/g,"").length;if(b>0)for(let x=0;x<b;x++)e=`../${e}`;else e=`./${e}`;return e}function cd(e){return e=xPe(e=wPe(e=bPe(e=nd(e=e.trim()))))}function ih(...e){const t=e.filter(L);if(!t||!t.length)return;const i=[];if(Xh(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),mPe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function nE(e,t=!1){if(eS(e)||x0(e))return null;let i=e.indexOf("://");if(i===-1&&l0(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=f6(e,!0)),e}function Xh(e){return l0(e)||yW(e)}function eS(e){return e!=null&&e.slice(0,5)==="blob:"}function x0(e){return e.slice(0,5)==="data:"}function _pe(e){const t=RL(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function Nxt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const hPe=/^data:(.*?)(;base64)?,(.*)$/;function RL(e){const t=e.match(hPe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function bpe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Fxt(e,t){uPe(e,t)||dPe(e,t)}function uPe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function dPe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function l0(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function yW(e){return dpe.test(e)}function pPe(e){return Z5e.test(e)||pl.scheme==="https"&&l0(e)}function fPe(e){return ppe.test(e)||pl.scheme==="http"&&l0(e)}function mPe(e){return K5e.test(e)}function vW(e){return l0(e)?`https:${e}`:e.replace(ppe,"https:")}function gPe(){return pl.scheme==="http"}function Vz(){return pl.scheme==="https"}function f6(e,t=!1){return l0(e)?e.slice(2):(e=e.replace(dpe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function yPe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function vPe(e){let t=0;if(Xh(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function kxt(e,t){if(!e)return"";const i=Gn(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(t==null||!t.length)return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function _Pe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function wpe(e){return e.replace(/\/+$/,"")}function bPe(e){if(/^https?:\/\//i.test(e)){const t=fW(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function wPe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function xPe(e){const t=sE.httpsDomains;if(!fPe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),Q5e.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return gPe()&&r===pl.authority&&!ePe.test(e)||(Vz()&&r===pl.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||Vz()&&!ML(e))&&(e=vW(e)),e}function Gz(e,t,i){if(!(t&&i&&e&&Xh(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),a=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,a).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(a)}`}function jz(e){return typeof e=="string"?new bT(nd(e)):(e.scheme||(e.scheme=pl.scheme),e)}function _W(e){return EPe.test(e)}function xpe(e,t){const i=Gn(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function bW(e,t,i){const r=Gn(e),s=r.query||{};return s[t]=String(i),`${r.path}?${aR(s)}`}function uee(e,t){const i=Gn(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=aR(r);return s?`${i.path}?${s}`:i.path}function TPe(e){if(J(e))return null;const t=e.match(SPe);return t?t[1]:null}const SPe=/.*?\.([^\/]*)$/,EPe=/(^data:image\/svg|\.svg$)/i,Tpe="20220404",Spe="ecb69ff5e08a61c162de0ddc0b1f397ed5d4071b",wW="4.23",APe={async request(e,t){var i;const{default:r}=await Promise.resolve().then(function(){return zPe}),s=e.options,n=s.responseType;s.signal=t==null?void 0:t.signal,s.responseType=n==="native"||n==="native-request-init"?"native-request-init":["blob","json","text"].includes(n)&&(i=vpe(e.url))!=null&&i.after?n:"array-buffer";const a=await r(e.url,s),l={data:a.data,ssl:a.ssl};switch(a.requestOptions.responseType){case"native-request-init":return delete l.data.signal,l;case"blob":l.data=await l.data.arrayBuffer();break;case"json":l.data=new TextEncoder().encode(JSON.stringify(l.data)).buffer;break;case"text":l.data=new TextEncoder().encode(l.data).buffer}return{result:l,transferList:[l.data]}}};let jn;function Uxt(e){jn=e}function CPe(e){const t=jn&&jn.findCredential(e);return t&&t.token?bW(e,"token",t.token):e}je("host-webworker")||(je("edge")||je("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const MPe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Epe(e){const t=nE(e,!0);return t&&t.endsWith(".arcgis.com")&&!MPe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Ape(e,t,i=!1,r){return new Promise((s,n)=>{if(zn(r))return void n(dee());let a=()=>{y(),n(new Error(`Unable to load ${t}`))},l=()=>{const b=e;y(),s(b)},p=()=>{if(!e)return;const b=e;y(),b.src="",n(dee())};const y=()=>{je("esri-image-decode")||(e.removeEventListener("error",a),e.removeEventListener("load",l)),a=null,l=null,e=null,L(r)&&r.removeEventListener("abort",p),p=null,i&&URL.revokeObjectURL(t)};L(r)&&r.addEventListener("abort",p),je("esri-image-decode")?e.decode().then(l,a):(e.addEventListener("error",a),e.addEventListener("load",l))})}function dee(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}async function Ar(e,t){var i;const r=x0(e),s=eS(e);s||r||(e=cd(e));const n={url:e,requestOptions:ie({},t)};let a=vpe(e);if(a){const b=await NPe(a,n);if(b!=null)return{data:b,getHeader:xW,requestOptions:n.requestOptions,url:n.url};a.after||a.error||(a=null)}if(e=n.url,(t=n.requestOptions).responseType==="image"){if(je("host-webworker")||je("host-node"))throw gp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(r)throw gp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),n);if(t.method==="head"){if(t.body)throw gp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||s)throw gp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await $Pe(),m6)return m6.execute(e,t);const l=new AbortController;ka(t,()=>l.abort());const p={controller:l,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:a,params:n,redoRequest:!1,useIdentity:Um.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},y=await kPe(p);return(i=a)==null||i.after==null||i.after(y),y}let m6;const Um=qr.request,Cpe="FormData"in globalThis,RPe=[499,498,403,401],OPe=["COM_0056","COM_0057","SB_0008"],PPe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],xW=()=>null,Hz=Symbol();function IPe(e){const t=nE(e);t&&!Ar._corsServers.includes(t)&&Ar._corsServers.push(t)}function pee(e){const t=nE(e);return!t||t.endsWith(".arcgis.com")||Ar._corsServers.includes(t)||mW(t)}function gp(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:xW,ssl:!1};if(t instanceof Se)return t.details?(t.details=Fe(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const a=r&&(y=>r.headers.get(y)),l=r&&r.status,p=t.message;p&&(s=p),a&&(n.getHeader=a),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||l||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=Hz in t?t[Hz]:t}return Cs(t)?rr():new Se(e,s,n)}async function $Pe(){je("host-webworker")?m6||(m6=await import("./request.35c235a2.js")):Ar._abortableFetch||(Ar._abortableFetch=globalThis.fetch.bind(globalThis))}async function qz(){jn||await import("./IdentityManager.ceb65dbc.js")}async function DPe(e){const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,a=null,l=null;if(Cpe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(a=s,n=new FormData(a))),typeof s=="string"&&(l=s),e.fetchOptions={cache:i.cacheBust&&!Ar._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",redirect:"follow",signal:r},(n||l)&&(e.fetchOptions.body=n||l),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||i.query&&i.query.token||n&&n.get&&n.get("token")||a&&a.elements.token),!e.hasToken&&qr.apiKey&&Epe(t)&&(i.query||(i.query={}),i.query.token=qr.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Mpe(t)&&!zn(r)){let p;i.authMode==="immediate"?(await qz(),p=await jn.getCredential(t,{signal:r}),e.credential=p):i.authMode==="no-prompt"?(await qz(),p=await jn.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=p):jn&&(p=jn.findCredential(t)),p&&(e.credentialToken=p.token,e.useSSL=!!p.ssl)}}function Mpe(e){return PPe.some(t=>t.test(e))}async function LPe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=eS(t)||x0(t),n=i.responseType||"json",a=s?0:i.timeout!=null?i.timeout:Um.timeout;let l=!1;if(!s){e.useSSL&&(t=vW(t)),i.cacheBust&&r.cache==="default"&&(t=bW(t,"request.preventCache",Date.now()));let A=ie({},i.query);e.credentialToken&&(A.token=e.credentialToken);let M=aR(A);je("esri-url-encodes-apostrophe")&&(M=M.replace(/'/g,"%27"));const P=t.length+1+M.length;let $;l=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||P>Um.maxUrlLength;const k=i.useProxy||!!ML(t);if(k){const z=oPe(t);$=z.path,!l&&$.length+1+P>Um.maxUrlLength&&(l=!0),z.query&&(A=ie(ie({},z.query),A))}if(r.method==="HEAD"&&(l||k)){if(l)throw P>Um.maxUrlLength?gp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):gp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(k)throw gp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(l?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=uee(t,A):(r.body=aR(A),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=uee(t,A),k&&(e.useProxy=!0,t=`${$}?${t}`),A.token&&Cpe&&r.body instanceof FormData){const z=r.body;z.set?z.set("token",A.token):z.append("token",A.token)}if(i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!p6(t,fpe())){if(mW(t))e.withCredentials=!0;else if(jn){const z=jn.findServerInfo(t);z&&z.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include")}let p,y,b=0,x=!1;a>0&&(b=setTimeout(()=>{x=!0,e.controller.abort()},a));try{if(i.responseType==="native-request-init")y=r,y.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||l||FPe(i.headers)||!s&&!e.useProxy&&Um.proxyUrl&&!pee(t)){if(p=await Ar._abortableFetch(t,r),e.useProxy||IPe(t),i.responseType==="native")y=p;else if(r.method!=="HEAD")if(p.ok){switch(n){case"array-buffer":y=await p.arrayBuffer();break;case"blob":case"image":y=await p.blob();break;default:y=await p.text()}if(b&&(clearTimeout(b),b=0),n==="json"||n==="xml"||n==="document")if(y)switch(n){case"json":y=JSON.parse(y);break;case"xml":y=fee(y,"application/xml");break;case"document":y=fee(y,"text/html")}else y=null;if(y){if(n==="array-buffer"||n==="blob"){const A=p.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(A)&&y[n==="blob"?"size":"byteLength"]<=750)try{const M=await new Response(y).json();M.error&&(y=M)}catch{}}n==="image"&&y instanceof Blob&&(y=await mee(URL.createObjectURL(y),e,!0))}}else y=await p.text()}else y=await mee(t,e)}catch(A){if(A.name==="AbortError")throw x?new Error("Timeout exceeded"):rr("Request canceled");if(!(!p&&A instanceof TypeError&&Um.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||pee(t))throw A;e.redoRequest=!0,lPe({proxyUrl:Um.proxyUrl,urlPrefix:nE(t)})}finally{b&&clearTimeout(b)}return[p,y]}async function NPe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=ie(ie({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=ie(ie({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=gp("request:interceptor",s,t)}if((r instanceof Error||r instanceof Se)&&(i=gp("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function FPe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function fee(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function kPe(e){var t,i;let r,s;await DPe(e);try{do[r,s]=await LPe(e);while(!await UPe(e,r,s))}catch(l){const p=gp("request:server",l,e.params,r);throw p.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(p),p}const n=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)&&!e.hasToken&&!e.credentialToken&&(t=s)!=null&&(i=t.user)!=null&&i.username&&!mW(n)){const l=nE(n,!0);l&&Um.trustedServers.push(l)}const a=e.credential;if(a&&jn){const l=jn.findServerInfo(a.server);let p=l&&l.owningSystemUrl;if(p){p=p.replace(/\/?$/,"/sharing");const y=jn.findCredential(p,a.userId);y&&jn._getIdenticalSvcIdx(p,y)===-1&&y.resources.unshift(p)}}return{data:s,getHeader:r?l=>r.headers.get(l):xW,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function UPe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,a,l;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[Hz]=i,s;i!=null&&i.error&&(s=i.error),s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,l=s.messageCode,l=l&&l.toUpperCase());const p=r.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().indexOf("ssl")>-1&&s.message.toLowerCase().indexOf("permission")===-1)){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(p!=="no-prompt"||n===498)&&RPe.indexOf(n)!==-1&&!Mpe(e.params.url)&&(n!==403||OPe.indexOf(l)===-1&&(a==null||a===2&&e.credentialToken))){await qz();try{const y=await jn.getCredential(e.params.url,{error:gp("request:server",s,e.params),prompt:p!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=y,e.credentialToken=y.token,e.useSSL=e.useSSL||y.ssl,!1}catch(y){if(p==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=y}}if(s)throw s;return!0}function mee(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.src=e,Ape(s,e,i,r)}Ar._abortableFetch=null,Ar._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var zPe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Ar});async function BPe(e,t,i,r){const s=t.exec(i);if(!s)throw new Se("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",a=s[2],l=W5e(r),p=`${n}${a}.json`,y=l?`${n}${a}_${l}.json`:p;let b;try{b=await gee(e(y))}catch(x){if(y===p)throw new Se("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:x});try{b=await gee(e(p))}catch(A){throw new Se("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:A})}}return b}async function gee(e){if(L(yee.fetchBundleAsset))return yee.fetchBundleAsset(e);const t=await Ar(e,{responseType:"text"});return JSON.parse(t.data)}class VPe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return BPe(this.getAssetUrl,this.matcher,t,i)}}function GPe(e){return new VPe(e)}const yee={},jPe=Ge.getLogger("esri.assets");function HPe(e,t){return Ar(hr(e),t)}function hr(e){if(!qr.assetsPath)throw jPe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Se("assets:path-not-set","config.assetsPath is not set");return ih(qr.assetsPath,e)}q5e(GPe({pattern:"esri/",location:hr}));function OL(e){return typeof e=="string"?document.getElementById(e):e}function Rpe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function vee(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function _ee(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}var or;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(or||(or={}));const Wz=or.USER+1;function zy(e){switch(e){case"defaults":return or.DEFAULTS;case"service":return or.SERVICE;case"portal-item":return or.PORTAL_ITEM;case"web-scene":return or.WEB_SCENE;case"web-map":return or.WEB_MAP;case"user":return or.USER}}function g6(e){switch(e){case or.DEFAULTS:return"defaults";case or.SERVICE:return"service";case or.PORTAL_ITEM:return"portal-item";case or.WEB_SCENE:return"web-scene";case or.WEB_MAP:return"web-map";case or.USER:return"user"}return void 0}function qPe(e){return g6(e)}class Ope{constructor(t,i){this._observers=t,this._observer=i}remove(){Iq(this._observers,this._observer)}}class bee{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=hs.Dirty|(r.nonNullable?hs.NonNullable:0)|(r.hasOwnProperty("value")?hs.HasDefaultValue:0)|(r.get===void 0?hs.DepTrackingInitialized:0)|(r.dependsOn===void 0?hs.AutoTracked:0)}destroy(){this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Li(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&hs.Computing||~r&hs.Dirty&&t.has(i))return s;this.flags|=hs.Computing;const n=this.properties.host;let a;r&hs.AutoTracked?a=wg(this,this.metadata.get,n):(Cue(n,this),a=this.metadata.get.call(n)),t.set(i,a,or.COMPUTED);const l=t.get(i);return l===s?this.flags&=~hs.Dirty:PMe(this.commit,this),this.flags&=~hs.Computing,l}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=hs.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new Ope(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&hs.Overriden&&(this.flags|=hs.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~hs.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class TW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new TW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,Fe(r))}),i}get(t){return this._values.get(t)}originOf(){return or.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function X4(e,t,i){return e!==void 0}function wee(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&hs.NonNullable)||(r.lifecycle,Wf.INITIALIZING,!1))}function WPe(e){return e&&typeof e.destroy=="function"}Ge.getLogger("esri.core.accessorSupport.Properties");class XPe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Wf.INITIALIZING,this.store=new TW,this._origin=or.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new bee(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=Wf.CONSTRUCTING}constructed(){this.lifecycle=Wf.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&WPe(r)&&(r.destroy(),~i.flags&hs.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==Wf.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();Li(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&hs.HasDefaultValue)return"defaults"}return g6(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(X4(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);X4(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!X4(s))return"";const n=new Set,a=wg({onObservableAccessed:p=>n.add(p),onTrackingEnd:()=>{}},()=>{var p;return(p=s.metadata.get)==null?void 0:p.call(t)});let l=`${r}${t.declaredClass.split(".").pop()}.${i}: ${a}
`;if(n.size===0)return l;r+="  ";for(const p of n){if(!(p instanceof bee))continue;const y=p.properties.host,b=p.propertyName,x=nc(y);l+=x?x.getDependsInfo(y,b,r):`${r}${b}: undefined
`}return l}setAtOrigin(t,i,r){const s=this.properties.get(t);if(X4(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&hs.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&hs.Overriden&&(i.flags&=~hs.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!wee(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:a,value:l}=n;if(CF.release(n),!a)return;i=l}r.flags|=hs.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!wee(r,t,i,this))return;const s=r.metadata.cast;if(s){const a=this._cast(s,i),{valid:l,value:p}=a;if(CF.release(a),!l)return;i=p}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=zy(t)}getDefaultOrigin(){return g6(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==Wf.INITIALIZING?this._origin:or.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&yL(i,s.get(n))&&~t.flags&hs.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),Aue(this.host,t))}_cast(t,i){const r=CF.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class YPe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const CF=new mn(YPe);function JPe(e){if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor&&e.constructor.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}class st{constructor(...t){if(this.constructor===st)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new XPe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class a extends n{constructor(...p){super(...p),this.inherited=null,s&&s.apply(this,p)}}IO(a.prototype);for(const l in t){const p=t[l];a.prototype[l]=typeof p=="function"?function(...y){const b=this.inherited;let x;this.inherited=function(...A){if(n.prototype[l])return n.prototype[l].apply(this,A)};try{x=p.apply(this,y)}catch(A){throw this.inherited=b,A}return this.inherited=b,x}:t[l]}for(const l in i){const p=JPe(i[l]);S(p)(a.prototype,l)}return re(r)(a)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(DMe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Wf.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return W$(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}isInstanceOf(t){return Vx(Ge.getLogger(this.declaredClass),"isInstanceOf",{replacement:"Use instanceof directly",version:"4.16"}),this instanceof t}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return l6(this,t,i),this}watch(t,i,r){return UMe(this,t,i,r)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}class wT{constructor(){this._emitter=new wT.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const a=this._listenersMap&&this._listenersMap.get(s);if(!a)return!1;const l=this.target||this;return[...a].forEach(p=>{p.call(l,n)}),a.length>0}on(s,n){if(Array.isArray(s)){const l=s.map(p=>this.on(p,n));return GT(l)}if(s.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const a=this._listenersMap.get(s)||[];return a.push(n),this._listenersMap.set(s,a),{remove:()=>{const l=this._listenersMap&&this._listenersMap.get(s)||[],p=l.indexOf(n);p>=0&&l.splice(p,1)}}}once(s,n){const a=this.on(s,l=>{a.remove(),n.call(null,l)});return a}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,a){return this._emitter.emit(n,a)}on(n,a){return this._emitter.on(n,a)}once(n,a){return this._emitter.once(n,a)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=_([re("esri.core.Evented")],s),s};let i=class extends st{constructor(){super(...arguments),this._emitter=new wT.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=_([re("esri.core.Evented")],i),e.EventedAccessor=i})(wT||(wT={}));const ps=wT;var Rr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Rr||(Rr={}));class ZPe{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new Ope(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var jm;class KPe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const hu=new mn(KPe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),QPe=()=>{};function MF(e){return e?e instanceof zb?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function RF(e){if(e&&e.length)return e[0]}function eIe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function Ppe(e,t,i,r){t&&t.forEach((s,n,a)=>{e.push(s),Ppe(e,i.call(r,s,n,a),i,r)})}const r1=new Set,s1=new Set,n1=new Set,OF=new Map;let tIe=0,zb=jm=class extends ps.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new ZPe,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:tIe++})}static isCollection(e){return e!=null&&e instanceof jm}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof jm?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Li(this._observable),this._items}set items(e){this._emitBeforeChanges(Rr.ADD)||(this._splice(0,this.length,MF(e)),this._emitAfterChanges(Rr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=QPe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(Li(this._observable),this._emitBeforeChanges(Rr.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Rr.ADD),this}addMany(e,t=this._items.length){if(Li(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Rr.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,MF(e)),this._emitAfterChanges(Rr.ADD),this}at(e){if(Li(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Li(this._observable),!this.length||this._emitBeforeChanges(Rr.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Rr.REMOVE),e}clone(){return Li(this._observable),this._createNewInstance({items:this._items.map(Fe)})}concat(...e){Li(this._observable);const t=e.map(MF);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Li(this._observable),!this.length||this._emitBeforeChanges(Rr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Rr.REMOVE)}every(e,t){return Li(this._observable),this._items.every(e,t)}filter(e,t){let i;return Li(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Li(this._observable),this._items.find(e,t)}findIndex(e,t){return Li(this._observable),this._items.findIndex(e,t)}flatten(e,t){Li(this._observable);const i=[];return Ppe(i,this,e,t),new jm(i)}forEach(e,t){return Li(this._observable),this._items.forEach(e,t)}getItemAt(e){return Li(this._observable),this._items[e]}getNextIndex(e){Li(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Li(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Li(this._observable),this._items.indexOf(e,t)}join(e=","){return Li(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Li(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Li(this._observable);const i=this._items.map(e,t);return new jm({items:i})}reorder(e,t=this.length-1){Li(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Rr.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Rr.MOVE)}return e}}pop(){if(Li(this._observable),!this.length||this._emitBeforeChanges(Rr.REMOVE))return;const e=RF(this._splice(this.length-1,1));return this._emitAfterChanges(Rr.REMOVE),e}push(...e){return Li(this._observable),this._emitBeforeChanges(Rr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Rr.ADD)),this.length}reduce(e,t){Li(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Li(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Li(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Li(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Rr.REMOVE))return;const t=RF(this._splice(e,1));return this._emitAfterChanges(Rr.REMOVE),t}removeMany(e){if(Li(this._observable),!e||!e.length||this._emitBeforeChanges(Rr.REMOVE))return[];const t=e instanceof jm?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const a=t[n],l=i.indexOf(a);if(l>-1){const p=1+eIe(t,i,n+1,l+1),y=this._splice(l,p);y&&y.length>0&&r.push.apply(r,y),n+=p-1}}return this._emitAfterChanges(Rr.REMOVE),r}reverse(){if(Li(this._observable),this._emitBeforeChanges(Rr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Rr.MOVE),this}shift(){if(Li(this._observable),!this.length||this._emitBeforeChanges(Rr.REMOVE))return;const e=RF(this._splice(0,1));return this._emitAfterChanges(Rr.REMOVE),e}slice(e=0,t=this.length){return Li(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Li(this._observable),this._items.some(e,t)}sort(e){if(Li(this._observable),!this.length||this._emitBeforeChanges(Rr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Rr.MOVE),this}splice(e,t,...i){Li(this._observable);const r=(t?Rr.REMOVE:0)|(i.length?Rr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return Li(this._observable),this._items.slice()}toJSON(){return Li(this._observable),this.toArray()}toLocaleString(){return Li(this._observable),this._items.toLocaleString()}toString(){return Li(this._observable),this._items.toString()}unshift(...e){return Li(this._observable),!e.length||this._emitBeforeChanges(Rr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Rr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=EO(()=>this._dispatchChange())),t){if(a=r.splice(e,t),this.hasEventListener("before-remove")){const l=hu.acquire();l.target=this,l.cancellable=!0;for(let p=0,y=a.length;p<y;p++)n=a[p],l.reset(n),this.emit("before-remove",l),l.defaultPrevented&&(a.splice(p,1),r.splice(e,0,n),e+=1,p-=1,y-=1);hu.release(l)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const l=hu.acquire();l.target=this,l.cancellable=!1;const p=a.length;for(let y=0;y<p;y++)l.reset(a[y]),this.emit("after-remove",l);hu.release(l)}}if(i&&i.length){if(s){const b=[];for(const x of i){const A=s.ensureType(x);A==null&&x!=null||b.push(A)}i=b}const l=this.hasEventListener("before-add"),p=this.hasEventListener("after-add"),y=e===this.length;if(l||p){const b=hu.acquire();b.target=this,b.cancellable=!0;const x=hu.acquire();x.target=this,x.cancellable=!1;for(const A of i)l?(b.reset(A),this.emit("before-add",b),b.defaultPrevented||(y?r.push(A):r.splice(e++,0,A),this._set("length",r.length),p&&(x.reset(A),this.emit("after-add",x)))):(y?r.push(A):r.splice(e++,0,A),this._set("length",r.length),x.reset(A),this.emit("after-add",x));hu.release(x),hu.release(b)}else{if(y)for(const b of i)r.push(b);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||a&&a.length)&&this._notifyChangeEvent(i,a),a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=hu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,hu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=hu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),hu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;r1.clear(),s1.clear(),n1.clear();for(const{added:p,removed:y}of i){if(p)if(n1.size===0&&s1.size===0)for(const b of p)r1.add(b);else for(const b of p)s1.has(b)?(n1.add(b),s1.delete(b)):n1.has(b)||r1.add(b);if(y)if(n1.size===0&&r1.size===0)for(const b of y)s1.add(b);else for(const b of y)r1.has(b)?r1.delete(b):(n1.delete(b),s1.add(b))}const r=Uc.acquire();r1.forEach(p=>{r.push(p)});const s=Uc.acquire();s1.forEach(p=>{s.push(p)});const n=this._items,a=t.items,l=Uc.acquire();if(n1.forEach(p=>{a.indexOf(p)!==n.indexOf(p)&&l.push(p)}),t.listeners&&(r.length||s.length||l.length)){const p={target:this,added:r,removed:s,moved:l},y=t.listeners.length;for(let b=0;b<y;b++){const x=t.listeners[b];x.removed||x.callback.call(this,p)}}Uc.release(r),Uc.release(s),Uc.release(l)}r1.clear(),s1.clear(),n1.clear()}};zb.ofType=e=>{if(!e)return jm;if(OF.has(e))return OF.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends jm{};return _([rW({Type:e,ensureType:typeof e=="function"?Ys(e):Dp(e)})],i.prototype,"itemType",void 0),i=_([re(`esri.core.Collection<${t}>`)],i),OF.set(e,i),i},_([S()],zb.prototype,"length",void 0),_([S()],zb.prototype,"items",null),zb=jm=_([re("esri.core.Collection")],zb);const kt=zb;let qI=class extends st{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!kt.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||kt.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||kt.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};_([S({readOnly:!0})],qI.prototype,"size",null),qI=_([re("esri.core.Handles")],qI);const Ei=qI;var _y;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(_y||(_y={}));class iIe{constructor(t){this.instance=t,this._resolver=gv(),this._status=_y.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=_y.RESOLVED,this._cleanUp()},()=>{this._status=_y.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===_y.RESOLVED}isRejected(){return this._status===_y.REJECTED}isFulfilled(){return this._status!==_y.PENDING}abort(){this._resolver.reject(rr())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=gv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Cs(s)||this._resolver.reject(s)}),t.resolve()}}const oE=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new iIe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=_([re("esri.core.Promise")],t),t};let y6=class extends oE(st){};y6=_([re("esri.core.Promise")],y6);function Ipe(){const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const $pe="http://www.w3.org/",PL=`${$pe}2000/svg`,Dpe=`${$pe}1999/xlink`;let v6,xee=[],SW=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},EW=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Lpe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},rIe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(EW(e[r],t))return r}return-1},PF=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n?n.key===void 0?n.bind:n.key:void 0)){for(let a=0;a<e.length;a++)if(a!==t){let l=e[a];if(EW(l,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},sIe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},Xz=[],Yz=!1,Npe=e=>{(e.children||[]).forEach(Npe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Tee=()=>{Yz=!1,Xz.forEach(Npe),Xz.length=0},See=e=>{Xz.push(e),Yz||(Yz=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(Tee,{timeout:16}):setTimeout(Tee,16))},Eee=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),See(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),See(e))},nIe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let a=0;a<n;a++){let l=s[a],p=t[l];if(l==="className")throw new Error('Property "className" is not supported, use "class".');if(l==="class")Jz(e,p,!0);else if(l==="classes"){let y=Object.keys(p),b=y.length;for(let x=0;x<b;x++){let A=y[x];p[A]&&e.classList.add(A)}}else if(l==="styles"){let y=Object.keys(p),b=y.length;for(let x=0;x<b;x++){let A=y[x],M=p[A];M&&(Lpe(M),i.styleApplyer(e,A,M))}}else if(l!=="key"&&p!=null){let y=typeof p;y==="function"?(l.lastIndexOf("on",0)===0&&(r&&(p=r(l,p,e,t)),l==="oninput"&&function(){let b=p;p=function(x){b.apply(this,[x]),x.target["oninput-value"]=x.target.value}}()),e[l]=p):i.namespace===PL?l==="href"?e.setAttributeNS(Dpe,l,p):e.setAttribute(l,p):y==="string"&&l!=="value"?l==="innerHTML"?e[l]=Zde.sanitize(p):e.setAttribute(l,p):e[l]=p}}},oIe=(e,t,i)=>{if(t)for(let r of t)H3(r,e,void 0,i)},Fpe=(e,t,i)=>{oIe(e,t.children,i),t.text&&(e.textContent=t.text),nIe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},H3=(e,t,i,r)=>{let s,n=0,a=e.vnodeSelector,l=t.ownerDocument;if(a==="")s=e.domNode=l.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let p=0;p<=a.length;++p){let y=a.charAt(p);if(p===a.length||y==="."||y==="#"){let b=a.charAt(n-1),x=a.slice(n,p);b==="."?s.classList.add(x):b==="#"?s.id=x:(x==="svg"&&(r=SW(r,{namespace:PL})),r.namespace!==void 0?s=e.domNode=l.createElementNS(r.namespace,x):(s=e.domNode=e.domNode||l.createElement(x),x==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=p+1}}Fpe(s,e,r)}},Jz=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},aIe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),a=n.length;for(let l=0;l<a;l++){let p=n[l],y=i[p],b=t[p];if(p==="class")b!==y&&(Jz(e,b,!1),Jz(e,y,!0));else if(p==="classes"){let x=e.classList,A=Object.keys(y),M=A.length;for(let P=0;P<M;P++){let $=A[P],k=!!y[$];k!==!!b[$]&&(s=!0,k?x.add($):x.remove($))}}else if(p==="styles"){let x=Object.keys(y),A=x.length;for(let M=0;M<A;M++){let P=x[M],$=y[P];$!==b[P]&&(s=!0,$?(Lpe($),r.styleApplyer(e,P,$)):r.styleApplyer(e,P,""))}}else if(y||typeof b!="string"||(y=""),p==="value"){let x=e[p];x!==y&&(e["oninput-value"]?x===e["oninput-value"]:y!==b)&&(e[p]=y,e["oninput-value"]=void 0),y!==b&&(s=!0)}else if(y!==b){let x=typeof y;x==="function"&&r.eventHandlerInterceptor||(r.namespace===PL?p==="href"?e.setAttributeNS(Dpe,p,y):e.setAttribute(p,y):x==="string"?p==="innerHTML"?e[p]=Zde.sanitize(y):p==="role"&&y===""?e.removeAttribute(p):e.setAttribute(p,y):e[p]!==y&&(e[p]=y),s=!0)}}return s},lIe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||xee;let n,a=(i=i||xee).length,l=r.length,p=0,y=0,b=!1;for(;y<l;){let x=p<a?i[p]:void 0,A=r[y];if(x!==void 0&&EW(x,A))b=v6(x,A,s)||b,p++;else{let M=rIe(i,A,p+1);if(M>=0){for(n=p;n<M;n++)Eee(i[n]),PF(i,n,e,"removed");b=v6(i[M],A,s)||b,p=M+1}else H3(A,t,p<a?i[p].domNode:void 0,s),sIe(A),PF(r,y,e,"added")}y++}if(a>p)for(n=p;n<a;n++)Eee(i[n]),PF(i,n,e,"removed");return b};v6=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let a=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(a,r),t.domNode=a,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=SW(i,{namespace:PL})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=lIe(t,r,e.children,t.children,i)||n,n=aIe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let BE=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,v6(r,i,t)},domNode:e.domNode});const cIe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let Gx=e=>SW(cIe,e),By={create:(e,t)=>(t=Gx(t),H3(e,document.createElement("div"),void 0,t),BE(e,t)),append:(e,t,i)=>(i=Gx(i),H3(t,e,void 0,i),BE(t,i)),insertBefore:(e,t,i)=>(i=Gx(i),H3(t,e.parentNode,e,i),BE(t,i)),merge:(e,t,i)=>(i=Gx(i),t.domNode=e,Fpe(e,t,i),BE(t,i)),replace:(e,t,i)=>(i=Gx(i),H3(t,e.parentNode,e,i),e.parentNode.removeChild(e),BE(t,i))},kpe,hIe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};kpe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let uIe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?kpe(i.children,s=>s.domNode===r):void 0}),i},dIe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),a=hIe(s.currentTarget,n.domNode);a.reverse();let l,p=uIe(n.getLastRender(),a);return e.scheduleRender(),p&&(l=p.properties[`on${s.type}`].apply(p.properties.bind||this,arguments)),i("domEventProcessed",s),l};return(s,n,a,l)=>r},Aee=e=>{let t,i,r=Gx(e),s=r.performanceLogger,n=!0,a=!1,l=[],p=[],y=(x,A,M)=>{let P,$=()=>P;r.eventHandlerInterceptor=dIe(t,$,s),P=x(A,M(),r),l.push(P),p.push(M)},b=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let x=0;x<l.length;x++){let A=p[x]();s("rendered",void 0),l[x].update(A),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:b,scheduleRender:()=>{i||a||(i=requestAnimationFrame(b))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),a=!0},resume:()=>{a=!1,n=!0,t.scheduleRender()},append:(x,A)=>{y(By.append,x,A)},insertBefore:(x,A)=>{y(By.insertBefore,x,A)},merge:(x,A)=>{y(By.merge,x,A)},replace:(x,A)=>{y(By.replace,x,A)},detach:x=>{for(let A=0;A<p.length;A++)if(p[A]===x)return p.splice(A,1),l.splice(A,1)[0];throw new Error("renderFunction was not found")}},t};const pIe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},fIe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},mIe=e=>ie(ie({},fIe),e),gIe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},yIe=(e,t)=>e.find(t),Cee=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{var a;const l=(a=r)!=null&&a.children?yIe(r.children,p=>p.domNode===s):void 0;i&&!l&&n!==t.length-1||(r=l)}),r},vIe=e=>{let t;const i=ie(ie({},pIe),e),r=mIe(i),s=r.performanceLogger;let n,a=!0,l=!1;const p=[],y=[],b=(A,M,P)=>{let $;r.eventHandlerInterceptor=(z,G,B,W)=>function(q){let X;s("domEvent",q);const oe=gIe(q.currentTarget,$.domNode),de=oe.some(fe=>{var me;return customElements.get(fe==null||(me=fe.tagName)==null?void 0:me.toLowerCase())});if(q.eventPhase===Event.CAPTURING_PHASE||!de)oe.reverse(),X=Cee($.getLastRender(),oe);else{const fe=q.composedPath(),me=fe.slice(fe.indexOf(q.currentTarget),fe.indexOf($.domNode)).filter(ge=>ge.getRootNode()===ge.ownerDocument).reverse();X=Cee($.getLastRender(),me,!0)}let he;return X&&(he=i.handleInterceptedEvent(t,X,this,q)),s("domEventProcessed",q),he},i.postProcessProjectionOptions==null||i.postProcessProjectionOptions(r);const k=P();$=A(M,k,r),p.push($),y.push(P),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered($,k)};let x=()=>{if(n=void 0,a){a=!1,s("renderStart",void 0);for(let A=0;A<p.length;A++){const M=y[A]();s("rendered",void 0),p[A].update(M),s("patched",void 0)}s("renderDone",void 0),a=!0}};return i.modifyDoRenderImplementation&&(x=i.modifyDoRenderImplementation(x,p,y)),t={renderNow:x,scheduleRender:()=>{n||l||(n=requestAnimationFrame(x))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(A,M)=>{b(By.append,A,M)},insertBefore:(A,M)=>{b(By.insertBefore,A,M)},merge:(A,M)=>{b(By.merge,A,M)},replace:(A,M)=>{b(By.replace,A,M)},detach:A=>{for(let M=0;M<y.length;M++)if(y[M]===A)return y.splice(M,1),p.splice(M,1)[0];throw new Error("renderFunction was not found")}},t},Ls={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let jx,Upe,IL,zpe=!1,_6=!1,AW=!1,Ph=!1,Mee=null,Zz=!1;const aE=typeof window!="undefined"?window:{};Ls.cssVarShim&&aE.CSS;const Cp=aE.document||{head:{}},zxt=aE.HTMLElement||class{},Ua={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},b6=Ls.shadowDomShim&&Ls.shadowDom?(()=>(Cp.head.attachShadow+"").indexOf("[native")>-1)():!0,_Ie=(()=>{let e=!1;try{Cp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),bIe=e=>Promise.resolve(e),wIe=Ls.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,Bpe=(e,t,i,r)=>{i&&i.map(([s,n,a])=>{const l=TIe(e,s),p=xIe(t,a),y=SIe(s);Ua.ael(l,n,p,y),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Ua.rel(l,n,p,y))})},xIe=(e,t)=>i=>{try{Ls.lazyLoad||e.$hostElement$[t](i)}catch(r){$O(r)}},TIe=(e,t)=>t&4?Cp:t&8?aE:t&16?Cp.body:e,SIe=e=>_Ie?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Ree="http://www.w3.org/1999/xlink",U2=(e,t="")=>()=>{},Oee=new WeakMap,EIe=(e,t,i)=>{let r=T6.get(e);wIe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,T6.set(e,r)},AIe=(e,t,i,r)=>{let s=Vpe(t,i),n=T6.get(s);if(e=e.nodeType===11?e:Cp,n)if(typeof n=="string"){e=e.head||e;let a=Oee.get(e),l;a||Oee.set(e,a=new Set),a.has(s)||(l=Cp.createElement("style"),l.innerHTML=n,e.insertBefore(l,e.querySelector("link")),a&&a.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},CIe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=U2("attachStyles",t.$tagName$),n=AIe(b6&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Vpe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),MIe=e=>s9e.map(t=>t(e)).find(t=>!!t),Pee={},RIe="http://www.w3.org/2000/svg",OIe="http://www.w3.org/1999/xhtml",PIe=e=>e!=null,CW=e=>(e=typeof e,e==="object"||e==="function"),Gpe=(e,t,...i)=>{let r=null,s=null,n=null,a=!1,l=!1,p=[];const y=x=>{for(let A=0;A<x.length;A++)r=x[A],Array.isArray(r)?y(r):r!=null&&typeof r!="boolean"&&((a=typeof e!="function"&&!CW(r))&&(r=String(r)),a&&l?p[p.length-1].$text$+=r:p.push(a?w6(null,r):r),l=a)};if(y(i),t&&(Ls.isDev&&e==="input"&&LIe(t),Ls.vdomKey&&t.key&&(s=t.key),Ls.slotRelocation&&t.name&&(n=t.name),Ls.vdomClass)){const x=t.className||t.class;x&&(t.class=typeof x!="object"?x:Object.keys(x).filter(A=>x[A]).join(" "))}if(Ls.isDev&&p.some(jpe)&&r9e(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ls.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,p,$Ie);const b=w6(e,null);return b.$attrs$=t,p.length>0&&(b.$children$=p),Ls.vdomKey&&(b.$key$=s),Ls.slotRelocation&&(b.$name$=n),b},w6=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ls.vdomAttribute&&(i.$attrs$=null),Ls.vdomKey&&(i.$key$=null),Ls.slotRelocation&&(i.$name$=null),i},IIe={},jpe=e=>e&&e.$tag$===IIe,$Ie={forEach:(e,t)=>e.map(Iee).forEach(t),map:(e,t)=>e.map(Iee).map(t).map(DIe)},Iee=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),DIe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Gpe(e.vtag,i,...e.vchildren||[])}const t=w6(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},LIe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),a=t.indexOf("step");(i<r||i<s||i<n||i<a)&&efe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},$ee=(e,t,i,r,s,n)=>{if(i!==r){let a=Fee(e,t),l=t.toLowerCase();if(t==="class"){const p=e.classList,y=Dee(i),b=Dee(r);p.remove(...y.filter(x=>x&&!b.includes(x))),p.add(...b.filter(x=>x&&!y.includes(x)))}else if(t==="style"){for(const p in i)(!r||r[p]==null)&&(p.includes("-")?e.style.removeProperty(p):e.style[p]="");for(const p in r)(!i||r[p]!==i[p])&&(p.includes("-")?e.style.setProperty(p,r[p]):e.style[p]=r[p])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Fee(aE,l)?t=l.slice(2):t=l[2]+t.slice(3),i&&Ua.rel(e,t,i,!1),r&&Ua.ael(e,t,r,!1);else{const p=CW(r);if((a||p&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let b=r==null?"":r;t==="list"?a=!1:(i==null||e[t]!=b)&&(e[t]=b)}}catch{}let y=!1;l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,y=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(y?e.removeAttributeNS(Ree,t):e.removeAttribute(t)):(!a||n&4||s)&&!p&&(r=r===!0?"":r,y?e.setAttributeNS(Ree,t,r):e.setAttribute(t,r))}}},NIe=/\s/,Dee=e=>e?e.split(NIe):[],Hpe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Pee,a=t.$attrs$||Pee;for(r in n)r in a||$ee(s,r,n[r],void 0,i,t.$flags$);for(r in a)$ee(s,r,n[r],a[r],i,t.$flags$)},x6=(e,t,i,r)=>{let s=t.$children$[i],n=0,a,l,p;if(zpe||(AW=!0,s.$tag$==="slot"&&(jx&&r.classList.add(jx+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)a=s.$elm$=Cp.createTextNode(s.$text$);else if(s.$flags$&1)a=s.$elm$=Cp.createTextNode("");else{if(Ph||(Ph=s.$tag$==="svg"),a=s.$elm$=Cp.createElementNS(Ph?RIe:OIe,s.$flags$&2?"slot-fb":s.$tag$),Ph&&s.$tag$==="foreignObject"&&(Ph=!1),Hpe(null,s,Ph),PIe(jx)&&a["s-si"]!==jx&&a.classList.add(a["s-si"]=jx),s.$children$)for(n=0;n<s.$children$.length;++n)l=x6(e,s,n,a),l&&a.appendChild(l);s.$tag$==="svg"?Ph=!1:a.tagName==="foreignObject"&&(Ph=!0)}return a["s-hn"]=IL,s.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=Upe,a["s-sn"]=s.$name$||"",p=e&&e.$children$&&e.$children$[i],p&&p.$tag$===s.$tag$&&e.$elm$&&lR(e.$elm$,!1)),a},lR=(e,t)=>{Ua.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==IL&&s["s-ol"]&&(Xpe(s).insertBefore(s,MW(s)),s["s-ol"].remove(),s["s-ol"]=void 0,AW=!0),t&&lR(s,t)}Ua.$flags$&=-2},qpe=(e,t,i,r,s,n)=>{let a=e["s-cr"]&&e["s-cr"].parentNode||e,l;for(a.shadowRoot&&a.tagName===IL&&(a=a.shadowRoot);s<=n;++s)r[s]&&(l=x6(null,i,s,e),l&&(r[s].$elm$=l,a.insertBefore(l,MW(t))))},Wpe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Zpe(r),_6=!0,s["s-ol"]?s["s-ol"].remove():lR(s,!0),s.remove())},FIe=(e,t,i,r)=>{let s=0,n=0,a=0,l=0,p=t.length-1,y=t[0],b=t[p],x=r.length-1,A=r[0],M=r[x],P,$;for(;s<=p&&n<=x;)if(y==null)y=t[++s];else if(b==null)b=t[--p];else if(A==null)A=r[++n];else if(M==null)M=r[--x];else if(Y4(y,A))Hx(y,A),y=t[++s],A=r[++n];else if(Y4(b,M))Hx(b,M),b=t[--p],M=r[--x];else if(Y4(y,M))(y.$tag$==="slot"||M.$tag$==="slot")&&lR(y.$elm$.parentNode,!1),Hx(y,M),e.insertBefore(y.$elm$,b.$elm$.nextSibling),y=t[++s],M=r[--x];else if(Y4(b,A))(y.$tag$==="slot"||M.$tag$==="slot")&&lR(b.$elm$.parentNode,!1),Hx(b,A),e.insertBefore(b.$elm$,y.$elm$),b=t[--p],A=r[++n];else{for(a=-1,l=s;l<=p;++l)if(t[l]&&t[l].$key$!==null&&t[l].$key$===A.$key$){a=l;break}a>=0?($=t[a],$.$tag$!==A.$tag$?P=x6(t&&t[n],i,a,e):(Hx($,A),t[a]=void 0,P=$.$elm$),A=r[++n]):(P=x6(t&&t[n],i,n,e),A=r[++n]),P&&Xpe(y.$elm$).insertBefore(P,MW(y.$elm$))}s>p?qpe(e,r[x+1]==null?null:r[x+1].$elm$,i,r,n,x):n>x&&Wpe(t,s,p)},Y4=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,MW=e=>e&&e["s-ol"]||e,Xpe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Hx=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,a=t.$text$;let l;a===null?(Ph=n==="svg"?!0:n==="foreignObject"?!1:Ph,n==="slot"||Hpe(e,t,Ph),r!==null&&s!==null?FIe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),qpe(i,null,t,s,0,s.length-1)):r!==null&&Wpe(r,0,r.length-1),Ph&&n==="svg"&&(Ph=!1)):(l=i["s-cr"])?l.parentNode.textContent=a:e.$text$!==a&&(i.data=a)},Ype=e=>{let t=e.childNodes,i,r,s,n,a,l;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(a=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(l=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||a!==""){if(l===1&&a===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(l===1||l===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Ype(i)}},up=[],Jpe=e=>{let t,i,r,s,n,a,l=0,p=e.childNodes,y=p.length;for(;l<y;l++){if(t=p[l],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],a=r.length-1;a>=0;a--)i=r[a],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Lee(i,s)?(n=up.find(b=>b.$nodeToRelocate$===i),_6=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:up.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&up.map(b=>{Lee(b.$nodeToRelocate$,i["s-sn"])&&(n=up.find(x=>x.$nodeToRelocate$===i),n&&!b.$slotRefNode$&&(b.$slotRefNode$=n.$slotRefNode$))})):up.some(b=>b.$nodeToRelocate$===i)||up.push({$nodeToRelocate$:i}));t.nodeType===1&&Jpe(t)}},Lee=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Zpe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Zpe)},kIe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||w6(null,null),n=jpe(t)?t:Gpe(null,null,t);IL=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([a,l])=>n.$attrs$[l]=i[a])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,jx=i["s-sc"],Upe=i["s-cr"],zpe=b6&&(r.$flags$&1)!==0,_6=!1,Hx(s,n);{if(Ua.$flags$|=1,AW){Jpe(n.$elm$);let a,l,p,y,b,x,A=0;for(;A<up.length;A++)a=up[A],l=a.$nodeToRelocate$,l["s-ol"]||(p=Cp.createTextNode(""),p["s-nr"]=l,l.parentNode.insertBefore(l["s-ol"]=p,l));for(A=0;A<up.length;A++)if(a=up[A],l=a.$nodeToRelocate$,a.$slotRefNode$){for(y=a.$slotRefNode$.parentNode,b=a.$slotRefNode$.nextSibling,p=l["s-ol"];p=p.previousSibling;)if(x=p["s-nr"],x&&x["s-sn"]===l["s-sn"]&&y===x.parentNode&&(x=x.nextSibling,!x||!x["s-nr"])){b=x;break}(!b&&y!==l.parentNode||l.nextSibling!==b)&&l!==b&&(!l["s-hn"]&&l["s-ol"]&&(l["s-hn"]=l["s-ol"].parentNode.nodeName),y.insertBefore(l,b))}else l.nodeType===1&&(l.hidden=!0)}_6&&Ype(n.$elm$),Ua.$flags$&=-2,up.length=0}},UIe=e=>Ls.lazyLoad?lE(e).$hostElement$:e,Bxt=(e,t,i)=>{const r=UIe(e);return{emit:s=>(Ls.isDev&&!r.isConnected&&efe(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),zIe(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},zIe=(e,t,i)=>{const r=Ua.ce(t,i);return e.dispatchEvent(r),r},BIe=(e,t)=>{},RW=(e,t)=>(e.$flags$|=16,BIe(e,e.$ancestorComponent$),a9e(()=>VIe(e,t))),VIe=(e,t)=>{const i=e.$hostElement$,r=U2("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=xT(s,"componentWillLoad"):n=xT(s,"componentWillUpdate"),n=Nee(n,()=>xT(s,"componentWillRender")),r(),Nee(n,()=>GIe(e,s,t))},GIe=async(e,t,i)=>{const r=e.$hostElement$,s=U2("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&CIe(e);const n=U2("render",e.$cmpMeta$.$tagName$);jIe(e,t,r),n(),s(),HIe(e)},jIe=(e,t,i)=>{try{Mee=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ls.hasRenderFn||Ls.reflect)&&(Ls.vdomRender||Ls.reflect)&&(Ls.hydrateServerSide||kIe(e,t))}catch(l){$O(l,e.$hostElement$)}return Mee=null,null},HIe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=U2("postUpdate",t),s=i;e.$ancestorComponent$,xT(s,"componentDidRender"),e.$flags$&64?(xT(s,"componentDidUpdate"),r()):(e.$flags$|=64,xT(s,"componentDidLoad"),r())},Vxt=e=>{if(Ls.updatable){const t=lE(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&RW(t,!1),i}return!1},xT=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){$O(r)}},Nee=(e,t)=>e&&e.then?e.then(t):t(),qIe=(e,t)=>e!=null&&!CW(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,WIe=(e,t)=>lE(e).$instanceValues$.get(t),XIe=(e,t,i,r)=>{const s=lE(e),n=e,a=s.$instanceValues$.get(t),l=s.$flags$,p=n;if(i=qIe(i,r.$members$[t][0]),i!==a){s.$instanceValues$.set(t,i);{if(r.$watchers$&&l&128){const y=r.$watchers$[t];y&&y.map(b=>{try{p[b](i,a,t)}catch(x){$O(x,n)}})}if((l&18)===2){if(p.componentShouldUpdate&&p.componentShouldUpdate(i,a,t)===!1)return;RW(s,!1)}}}},YIe=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,n,{get(){return WIe(this,n)},set(l){XIe(this,n,l,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(a,l,p){Ua.jmp(()=>{const y=n.get(a);if(this.hasOwnProperty(y))p=this[y],delete this[y];else if(s.hasOwnProperty(y)&&typeof this[y]=="number"&&this[y]==p)return;this[y]=p===null&&typeof this[y]=="boolean"?!1:p})},e.observedAttributes=r.filter(([a,l])=>l[0]&15).map(([a,l])=>{const p=l[1]||a;return n.set(p,a),l[0]&512&&t.$attrsToReflect$.push([a,p]),p})}}return e},JIe=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let a=s.style;typeof a!="string"&&(a=a[t.$modeName$=MIe(e)]);const l=Vpe(i,t.$modeName$);if(!T6.has(l)){const p=U2("registerStyles",i.$tagName$);EIe(l,a,!!(i.$flags$&1)),p()}}t.$ancestorComponent$,(()=>RW(t,!0))()},ZIe=e=>{},KIe=e=>{if((Ua.$flags$&1)===0){const t=lE(e),i=t.$cmpMeta$,r=U2("connectedCallback",i.$tagName$);t.$flags$&1?(Bpe(e,t,i.$listeners$),ZIe(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&QIe(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const a=e[s];delete e[s],e[s]=a}}),JIe(e,t,i)),r()}},QIe=e=>{const t=e["s-cr"]=Cp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},e9e=e=>{if((Ua.$flags$&1)===0){const t=lE(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},Gxt=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};i.$members$=t[2],i.$listeners$=t[3],i.$watchers$=e.$watchers$,i.$attrsToReflect$=[],!b6&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){i9e(this,i)},connectedCallback(){KIe(this),r&&r.call(this)},disconnectedCallback(){e9e(this),s&&s.call(this)},__attachShadow(){b6?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.shadowRoot=this}}),e.is=i.$tagName$,YIe(e,i)},jxt=e=>{const t=new URL(e,Ua.$resourcesUrl$);return t.origin!==aE.location.origin?t.href:t.pathname},t9e=e=>Ua.$resourcesUrl$=e,Kpe=new WeakMap,lE=e=>Kpe.get(e),i9e=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Bpe(e,i,t.$listeners$),Kpe.set(e,i)},Fee=(e,t)=>t in e,$O=(e,t)=>(0,console.error)(e,t),Qpe=Ls.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],r9e=(...e)=>console.error(...Qpe,...e),efe=(...e)=>console.warn(...Qpe,...e),T6=new Map,s9e=[],kee=[],tfe=[],n9e=(e,t)=>i=>{e.push(i),Zz||(Zz=!0,t&&Ua.$flags$&4?o9e(Kz):Ua.raf(Kz))},Uee=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){$O(i)}e.length=0},Kz=()=>{Uee(kee),Uee(tfe),(Zz=kee.length>0)&&Ua.raf(Kz)},o9e=e=>bIe().then(e),a9e=n9e(tfe,!0),Hxt={isDev:!!Ls.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ls.isTesting};let ife;function l9e(){t9e(nd(hr(ife)))}ife="components/assets";const rfe="esri.widgets.Widget",zee=Ge.getLogger(rfe);let c9e=0;const h9e={widgetIcon:"esri-icon-checkbox-unchecked"};function sfe(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?sfe(e[i],t[i]):e[i]=t[i]);return e}const u9e=vIe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,a)=>{const l=t(r,s,n,a),p=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||p){const y=r[2].toLowerCase()+r.slice(3),b=M=>l.call(n,M);n.addEventListener(y,b,p);const x=()=>n.removeEventListener(y,b,p),A=a.afterRemoved;a.afterRemoved=M=>{A==null||A(M),x()}}return l}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,a=s===Event.CAPTURING_PHASE;let l=`on${n}${a?"capture":""}`;const p=t.properties;(l in p||(l=`on${n[0].toUpperCase()}${n.slice(1)}${a?"Capture":""}`,l in p))&&(Xde(),e.scheduleRender(),p[l].call(p.bind||i,r))}});let IF=!1,oo=class extends oE(ps.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Ei,this._projector=u9e,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=h9e.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=kq(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const l=await bo(this._messageBundleProps.map(async({bundlePath:p,propertyName:y})=>{let b=await hpe(p);this.uiStrings&&Object.keys(this.uiStrings)&&(b=sfe(Fe(b),this.uiStrings)),this[y]=b}));for(const p of l)p.error&&zee.error("widget-intl:locale-error",this.declaredClass,p.error)}await this.loadLocale()}),l9e();const i=["light","dark"],r=ipe()||"light";i.includes(r)||QT(zee,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const s="esri-widget-uid-"+Ipe(),n=this.render.bind(this);this._trackingTarget=new bL(()=>this.scheduleRender());const a=()=>{var l;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:s,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const p=n();let{properties:y}=p;y||(p.properties=y={});let{key:b,styles:x}=y;b||(y.key=s),x||(y.styles=x={}),x.display||(x.display="");let A=0;return(l=p.children)==null||l.forEach(M=>{if(lW(M.vnodeSelector))return;let{properties:P}=M;P||(M.properties=P={}),P.key||(P.key=`${this.id}--${A++}`)}),Qde(this,p)};this.render=()=>{if(IF)return a();let l=h5e(this);if(l)return l;this._trackingTarget.clear(),IF=!0;try{l=wg(this._trackingTarget,a)}finally{IF=!1}return u5e(this,l),l},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()}))}normalizeCtorArgs(e,t){const i=ie({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(yz)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget=Ht(this._trackingTarget),this.viewModel=Ht(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,AF(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return OL(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+c9e++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(AF(this),this._projector.scheduleRender())}classes(...e){return Jde.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){AF(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this._internalHandles.add(vi(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&this._internalHandles.add(this._delegatedEventNames.map(s=>i.on(s,n=>{this.emit(s,n)})),"delegated-events")},No)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(yz),this.scheduleRender()};this._internalHandles.add([N5e(t),vi(()=>this.uiStrings,t),CO(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};oo[Kde]=!0,_([S()],oo.prototype,"_readyForTrueRender",void 0),_([S({value:null})],oo.prototype,"container",null),_([_i("container")],oo.prototype,"castContainer",null),_([S({aliasOf:"container"})],oo.prototype,"domNode",void 0),_([S()],oo.prototype,"iconClass",void 0),_([S()],oo.prototype,"id",null),_([S()],oo.prototype,"label",void 0),_([S()],oo.prototype,"renderable",null),_([S()],oo.prototype,"uiStrings",void 0),_([S()],oo.prototype,"viewModel",void 0),_([S()],oo.prototype,"visible",void 0),_([S()],oo.prototype,"key",void 0),_([S()],oo.prototype,"children",void 0),_([S()],oo.prototype,"afterCreate",void 0),_([S()],oo.prototype,"afterUpdate",void 0),_([S()],oo.prototype,"afterRemoved",void 0),oo=_([re(rfe)],oo);const cc=oo;Ge.getLogger("esri.core.Clonable");const T0=e=>{let t=class extends e{clone(){const i=WCe(nc(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},a=new Map;for(const y in r){const b=r[y],x=s==null?void 0:s.originOf(y),A=b.clonable;if(b.readOnly||A===!1||x!==or.USER&&x!==or.DEFAULTS&&x!==or.WEB_MAP&&x!==or.WEB_SCENE)continue;const M=this[y];let P=null;P=typeof A=="function"?A(M):A==="reference"?M:gz(M),M!=null&&P==null||(x===or.DEFAULTS?a.set(y,P):n[y]=P)}const l=new(Object.getPrototypeOf(this)).constructor(n);if(a.size){var p;const y=(p=nc(l))==null?void 0:p.store;if(y)for(const[b,x]of a)y.set(b,x,or.DEFAULTS)}return l}};return t=_([re("esri.core.Clonable")],t),t};let Bee=class extends T0(st){};Bee=_([re("esri.core.Clonable")],Bee);class OW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new OW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,Fe(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:or.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===or.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new d9e(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===or.DEFAULTS?t:or.USER}}class d9e{constructor(t,i){this.value=t,this.origin=i}}function nfe(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),or.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),or.DEFAULTS)})}function p9e(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.indexOf(".")>-1&&r.indexOf(t)===0&&TQ(r,i))return!0}else for(const s of r)if(s===t||s.indexOf(".")>-1&&s.indexOf(t)===0&&TQ(s,i))return!0;return!1}function f9e(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function m9e(e,t,i,r,s){let n=kz(t[i],s);f9e(n)&&(e[i]=!0);for(const a of Object.getOwnPropertyNames(t))n=kz(t[a],s),p9e(n,i,r)&&(e[a]=!0)}function g9e(e,t,i,r){const s=i.metadatas,n=oW(s[t],"any",r),a=n&&n.default;if(a===void 0)return;const l=typeof a=="function"?a.call(e,t,r):a;l!==void 0&&i.set(t,l)}const ofe={origin:"service"};function afe(e,t,i=ofe){if(!t||typeof t!="object")return;const r=nc(e),s=r.metadatas,n={};for(const a of Object.getOwnPropertyNames(t))m9e(n,s,a,t,i);r.setDefaultOrigin(i.origin);for(const a of Object.getOwnPropertyNames(n)){const l=kz(s[a],i).read,p=l&&l.source;let y;y=p&&typeof p=="string"?AO(t,p):t[a],l&&l.reader&&(y=l.reader.call(e,y,t,i)),y!==void 0&&r.set(a,y)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const a of Object.getOwnPropertyNames(s))n[a]||g9e(e,a,r,i)}r.setDefaultOrigin("user")}function lfe(e,t,i,r=ofe){var s;const n=qe(ie({},r),{messages:[]});i(n),(s=n.messages)==null||s.forEach(a=>{a.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(a):e.loadWarnings.push(a)})}const y9e=Ge.getLogger("esri.core.accessorSupport.write");function v9e(e,t,i,r,s){var n,a;const l={};return(n=t.write)==null||(a=n.writer)==null||a.call(e,r,l,i,s),l}function cfe(e,t,i,r,s,n){if(!r||!r.write)return!1;const a=e.get(i);if(!s&&r.write.overridePolicy){const l=r.write.overridePolicy.call(e,a,i,n);l!==void 0&&(s=l)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((a===null&&!s.allowNull&&!s.writerEnsuresNonNull||a===void 0)&&s.isRequired){const l=new Se("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return l&&n&&n.messages?n.messages.push(l):l&&!n&&y9e.error(l.name,l.message),!1}return!(a===void 0||a===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===or.DEFAULTS)&&_9e(e,i,n,r,a)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<zy(n.origin))}function _9e(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const a=n.call(e,t,i);return $2(a,s)}return!1}return n===s}function b9e(e,t,i,r){const s=nc(e),n=s.metadatas,a=Ode(n[t],r);return!!a&&cfe(e,s,t,a,i,r)}function hfe(e,t,i){if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return UI(t,e.toJSON());const r=nc(e),s=r.metadatas;for(const l in s){const p=Ode(s[l],i);if(!cfe(e,r,l,p,void 0,i))continue;const y=e.get(l),b=v9e(e,p,p.write&&typeof p.write.target=="string"?p.write.target:l,y,i);var n,a;Object.keys(b).length>0&&(t=UI(t,b),i!=null&&(n=i.resources)!=null&&(a=n.pendingOperations)!=null&&a.length&&Promise.all(i.resources.pendingOperations).then(()=>UI(t,b)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:l,oldOrigin:qPe(r.store.originOf(l)),newOrigin:i.origin}))}return t}const DO=e=>{let t=class extends e{constructor(...i){super(...i);const r=nc(this),s=r.store,n=new OW;r.store=n,nfe(r,s,n)}read(i,r){afe(this,i,r)}write(i={},r){return hfe(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return w9e.call(this,i,r)}};return t=_([re("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function w9e(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let Ye=class extends DO(st){};Ye=_([re("esri.core.JSONSupport")],Ye);var td;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(td||(td={}));let O;const ce={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(O=2e3;O<=2045;O++)ce[O]=0;for(O=2056;O<=2065;O++)ce[O]=0;for(O=2067;O<=2135;O++)ce[O]=0;for(O=2137;O<=2154;O++)ce[O]=0;for(O=2161;O<=2170;O++)ce[O]=0;for(O=2172;O<=2193;O++)ce[O]=0;for(O=2195;O<=2198;O++)ce[O]=0;for(O=2200;O<=2203;O++)ce[O]=0;for(O=2205;O<=2217;O++)ce[O]=0;for(O=2222;O<=2224;O++)ce[O]=1;for(O=2225;O<=2250;O++)ce[O]=2;for(O=2251;O<=2253;O++)ce[O]=1;for(O=2257;O<=2264;O++)ce[O]=2;for(O=2274;O<=2279;O++)ce[O]=2;for(O=2280;O<=2282;O++)ce[O]=1;for(O=2283;O<=2289;O++)ce[O]=2;for(O=2290;O<=2292;O++)ce[O]=0;for(O=2308;O<=2313;O++)ce[O]=0;for(O=2315;O<=2491;O++)ce[O]=0;for(O=2494;O<=2866;O++)ce[O]=0;for(O=2867;O<=2869;O++)ce[O]=1;for(O=2870;O<=2888;O++)ce[O]=2;for(O=2891;O<=2895;O++)ce[O]=2;for(O=2896;O<=2898;O++)ce[O]=1;for(O=2902;O<=2908;O++)ce[O]=2;for(O=2915;O<=2920;O++)ce[O]=2;for(O=2921;O<=2923;O++)ce[O]=1;for(O=2924;O<=2930;O++)ce[O]=2;for(O=2931;O<=2962;O++)ce[O]=0;for(O=2964;O<=2968;O++)ce[O]=2;for(O=2969;O<=2973;O++)ce[O]=0;for(O=2975;O<=2991;O++)ce[O]=0;for(O=2995;O<=3051;O++)ce[O]=0;for(O=3054;O<=3079;O++)ce[O]=0;for(O=3081;O<=3088;O++)ce[O]=0;for(O=3092;O<=3101;O++)ce[O]=0;for(O=3106;O<=3138;O++)ce[O]=0;for(O=3146;O<=3151;O++)ce[O]=0;for(O=3153;O<=3166;O++)ce[O]=0;for(O=3168;O<=3172;O++)ce[O]=0;for(O=3174;O<=3203;O++)ce[O]=0;for(O=3294;O<=3358;O++)ce[O]=0;for(O=3367;O<=3403;O++)ce[O]=0;for(O=3408;O<=3416;O++)ce[O]=0;for(O=3417;O<=3438;O++)ce[O]=2;for(O=3441;O<=3446;O++)ce[O]=2;for(O=3447;O<=3450;O++)ce[O]=0;for(O=3451;O<=3459;O++)ce[O]=2;for(O=3460;O<=3478;O++)ce[O]=0;for(O=3554;O<=3559;O++)ce[O]=0;for(O=3560;O<=3570;O++)ce[O]=2;for(O=3571;O<=3581;O++)ce[O]=0;for(O=3594;O<=3597;O++)ce[O]=0;for(O=3601;O<=3604;O++)ce[O]=0;for(O=3637;O<=3639;O++)ce[O]=0;for(O=3665;O<=3667;O++)ce[O]=0;for(O=3693;O<=3695;O++)ce[O]=0;for(O=3701;O<=3727;O++)ce[O]=0;for(O=3728;O<=3739;O++)ce[O]=2;for(O=3740;O<=3751;O++)ce[O]=0;for(O=3753;O<=3760;O++)ce[O]=2;for(O=3761;O<=3773;O++)ce[O]=0;for(O=3775;O<=3777;O++)ce[O]=0;for(O=3779;O<=3781;O++)ce[O]=0;for(O=3783;O<=3785;O++)ce[O]=0;for(O=3788;O<=3791;O++)ce[O]=0;for(O=3797;O<=3802;O++)ce[O]=0;for(O=3814;O<=3816;O++)ce[O]=0;for(O=3825;O<=3829;O++)ce[O]=0;for(O=3832;O<=3841;O++)ce[O]=0;for(O=3844;O<=3852;O++)ce[O]=0;for(O=3873;O<=3885;O++)ce[O]=0;for(O=3890;O<=3893;O++)ce[O]=0;for(O=3907;O<=3912;O++)ce[O]=0;for(O=3942;O<=3950;O++)ce[O]=0;for(O=3968;O<=3970;O++)ce[O]=0;for(O=3973;O<=3976;O++)ce[O]=0;for(O=3986;O<=3989;O++)ce[O]=0;for(O=3994;O<=3997;O++)ce[O]=0;for(O=4048;O<=4051;O++)ce[O]=0;for(O=4056;O<=4063;O++)ce[O]=0;for(O=4093;O<=4096;O++)ce[O]=0;for(O=4390;O<=4398;O++)ce[O]=0;for(O=4399;O<=4413;O++)ce[O]=2;for(O=4418;O<=4433;O++)ce[O]=2;for(O=4455;O<=4457;O++)ce[O]=2;for(O=4484;O<=4489;O++)ce[O]=0;for(O=4491;O<=4554;O++)ce[O]=0;for(O=4568;O<=4589;O++)ce[O]=0;for(O=4652;O<=4656;O++)ce[O]=0;for(O=4766;O<=4800;O++)ce[O]=0;for(O=5014;O<=5016;O++)ce[O]=0;for(O=5069;O<=5072;O++)ce[O]=0;for(O=5105;O<=5130;O++)ce[O]=0;for(O=5173;O<=5188;O++)ce[O]=0;for(O=5253;O<=5259;O++)ce[O]=0;for(O=5269;O<=5275;O++)ce[O]=0;for(O=5292;O<=5311;O++)ce[O]=0;for(O=5329;O<=5331;O++)ce[O]=0;for(O=5343;O<=5349;O++)ce[O]=0;for(O=5355;O<=5357;O++)ce[O]=0;for(O=5387;O<=5389;O++)ce[O]=0;for(O=5459;O<=5463;O++)ce[O]=0;for(O=5479;O<=5482;O++)ce[O]=0;for(O=5518;O<=5520;O++)ce[O]=0;for(O=5530;O<=5539;O++)ce[O]=0;for(O=5550;O<=5552;O++)ce[O]=0;for(O=5562;O<=5583;O++)ce[O]=0;for(O=5623;O<=5625;O++)ce[O]=2;for(O=5631;O<=5639;O++)ce[O]=0;for(O=5649;O<=5653;O++)ce[O]=0;for(O=5663;O<=5680;O++)ce[O]=0;for(O=5682;O<=5685;O++)ce[O]=0;for(O=5875;O<=5877;O++)ce[O]=0;for(O=5896;O<=5899;O++)ce[O]=0;for(O=5921;O<=5940;O++)ce[O]=0;for(O=6050;O<=6125;O++)ce[O]=0;for(O=6244;O<=6275;O++)ce[O]=0;for(O=6328;O<=6348;O++)ce[O]=0;for(O=6350;O<=6356;O++)ce[O]=0;for(O=6366;O<=6372;O++)ce[O]=0;for(O=6381;O<=6387;O++)ce[O]=0;for(O=6393;O<=6404;O++)ce[O]=0;for(O=6480;O<=6483;O++)ce[O]=0;for(O=6511;O<=6514;O++)ce[O]=0;for(O=6579;O<=6581;O++)ce[O]=0;for(O=6619;O<=6624;O++)ce[O]=0;for(O=6625;O<=6627;O++)ce[O]=2;for(O=6628;O<=6632;O++)ce[O]=0;for(O=6634;O<=6637;O++)ce[O]=0;for(O=6669;O<=6692;O++)ce[O]=0;for(O=6707;O<=6709;O++)ce[O]=0;for(O=6720;O<=6723;O++)ce[O]=0;for(O=6732;O<=6738;O++)ce[O]=0;for(O=6931;O<=6933;O++)ce[O]=0;for(O=6956;O<=6959;O++)ce[O]=0;for(O=7005;O<=7007;O++)ce[O]=0;for(O=7057;O<=7070;O++)ce[O]=2;for(O=7074;O<=7082;O++)ce[O]=0;for(O=7109;O<=7118;O++)ce[O]=0;for(O=7119;O<=7127;O++)ce[O]=1;for(O=7374;O<=7376;O++)ce[O]=0;for(O=7528;O<=7586;O++)ce[O]=0;for(O=7587;O<=7645;O++)ce[O]=2;for(O=7692;O<=7696;O++)ce[O]=0;for(O=7755;O<=7787;O++)ce[O]=0;for(O=7791;O<=7795;O++)ce[O]=0;for(O=7799;O<=7801;O++)ce[O]=0;for(O=7803;O<=7805;O++)ce[O]=0;for(O=7825;O<=7831;O++)ce[O]=0;for(O=7845;O<=7859;O++)ce[O]=0;for(O=8013;O<=8032;O++)ce[O]=0;for(O=8065;O<=8068;O++)ce[O]=1;for(O=8518;O<=8529;O++)ce[O]=2;for(O=8533;O<=8536;O++)ce[O]=2;for(O=8538;O<=8540;O++)ce[O]=2;for(O=8677;O<=8679;O++)ce[O]=0;for(O=8836;O<=8840;O++)ce[O]=0;for(O=8857;O<=8859;O++)ce[O]=0;for(O=8908;O<=8910;O++)ce[O]=0;for(O=9154;O<=9159;O++)ce[O]=0;for(O=9205;O<=9218;O++)ce[O]=0;for(O=9271;O<=9273;O++)ce[O]=0;for(O=9295;O<=9297;O++)ce[O]=0;for(O=9356;O<=9360;O++)ce[O]=0;for(O=9404;O<=9407;O++)ce[O]=0;for(O=9476;O<=9482;O++)ce[O]=0;for(O=9487;O<=9494;O++)ce[O]=0;for(O=9697;O<=9699;O++)ce[O]=0;for(O=20002;O<=20032;O++)ce[O]=0;for(O=20062;O<=20092;O++)ce[O]=0;for(O=20135;O<=20138;O++)ce[O]=0;for(O=20248;O<=20258;O++)ce[O]=0;for(O=20348;O<=20358;O++)ce[O]=0;for(O=20436;O<=20440;O++)ce[O]=0;for(O=20822;O<=20824;O++)ce[O]=0;for(O=20904;O<=20932;O++)ce[O]=0;for(O=20934;O<=20936;O++)ce[O]=0;for(O=21004;O<=21032;O++)ce[O]=0;for(O=21035;O<=21037;O++)ce[O]=0;for(O=21095;O<=21097;O++)ce[O]=0;for(O=21148;O<=21150;O++)ce[O]=0;for(O=21207;O<=21264;O++)ce[O]=0;for(O=21307;O<=21364;O++)ce[O]=0;for(O=21413;O<=21423;O++)ce[O]=0;for(O=21453;O<=21463;O++)ce[O]=0;for(O=21473;O<=21483;O++)ce[O]=0;for(O=21780;O<=21782;O++)ce[O]=0;for(O=21891;O<=21894;O++)ce[O]=0;for(O=21896;O<=21899;O++)ce[O]=0;for(O=22171;O<=22177;O++)ce[O]=0;for(O=22181;O<=22187;O++)ce[O]=0;for(O=22191;O<=22197;O++)ce[O]=0;for(O=22234;O<=22236;O++)ce[O]=0;for(O=22521;O<=22525;O++)ce[O]=0;for(O=22991;O<=22994;O++)ce[O]=0;for(O=23028;O<=23038;O++)ce[O]=0;for(O=23830;O<=23853;O++)ce[O]=0;for(O=23866;O<=23872;O++)ce[O]=0;for(O=23877;O<=23884;O++)ce[O]=0;for(O=23886;O<=23894;O++)ce[O]=0;for(O=23946;O<=23948;O++)ce[O]=0;for(O=24311;O<=24313;O++)ce[O]=0;for(O=24342;O<=24347;O++)ce[O]=0;for(O=24370;O<=24374;O++)ce[O]=10;for(O=24375;O<=24381;O++)ce[O]=0;for(O=24718;O<=24721;O++)ce[O]=0;for(O=24817;O<=24821;O++)ce[O]=0;for(O=24877;O<=24882;O++)ce[O]=0;for(O=24891;O<=24893;O++)ce[O]=0;for(O=25391;O<=25395;O++)ce[O]=0;for(O=25828;O<=25838;O++)ce[O]=0;for(O=26191;O<=26195;O++)ce[O]=0;for(O=26391;O<=26393;O++)ce[O]=0;for(O=26701;O<=26722;O++)ce[O]=0;for(O=26729;O<=26799;O++)ce[O]=2;for(O=26801;O<=26803;O++)ce[O]=2;for(O=26811;O<=26813;O++)ce[O]=2;for(O=26847;O<=26870;O++)ce[O]=2;for(O=26891;O<=26899;O++)ce[O]=0;for(O=26901;O<=26923;O++)ce[O]=0;for(O=26929;O<=26946;O++)ce[O]=0;for(O=26948;O<=26998;O++)ce[O]=0;for(O=27037;O<=27040;O++)ce[O]=0;for(O=27205;O<=27232;O++)ce[O]=0;for(O=27258;O<=27260;O++)ce[O]=0;for(O=27391;O<=27398;O++)ce[O]=0;for(O=27561;O<=27564;O++)ce[O]=0;for(O=27571;O<=27574;O++)ce[O]=0;for(O=27581;O<=27584;O++)ce[O]=0;for(O=27591;O<=27594;O++)ce[O]=0;for(O=28191;O<=28193;O++)ce[O]=0;for(O=28348;O<=28358;O++)ce[O]=0;for(O=28402;O<=28432;O++)ce[O]=0;for(O=28462;O<=28492;O++)ce[O]=0;for(O=29118;O<=29122;O++)ce[O]=0;for(O=29168;O<=29172;O++)ce[O]=0;for(O=29177;O<=29185;O++)ce[O]=0;for(O=29187;O<=29195;O++)ce[O]=0;for(O=29900;O<=29903;O++)ce[O]=0;for(O=30161;O<=30179;O++)ce[O]=0;for(O=30491;O<=30494;O++)ce[O]=0;for(O=30729;O<=30732;O++)ce[O]=0;for(O=31251;O<=31259;O++)ce[O]=0;for(O=31265;O<=31268;O++)ce[O]=0;for(O=31275;O<=31279;O++)ce[O]=0;for(O=31281;O<=31297;O++)ce[O]=0;for(O=31461;O<=31469;O++)ce[O]=0;for(O=31491;O<=31495;O++)ce[O]=0;for(O=31917;O<=31922;O++)ce[O]=0;for(O=31965;O<=32e3;O++)ce[O]=0;for(O=32001;O<=32003;O++)ce[O]=2;for(O=32005;O<=32031;O++)ce[O]=2;for(O=32033;O<=32060;O++)ce[O]=2;for(O=32064;O<=32067;O++)ce[O]=2;for(O=32074;O<=32077;O++)ce[O]=2;for(O=32081;O<=32086;O++)ce[O]=0;for(O=32107;O<=32130;O++)ce[O]=0;for(O=32133;O<=32158;O++)ce[O]=0;for(O=32164;O<=32167;O++)ce[O]=2;for(O=32180;O<=32199;O++)ce[O]=0;for(O=32201;O<=32260;O++)ce[O]=0;for(O=32301;O<=32360;O++)ce[O]=0;for(O=32601;O<=32662;O++)ce[O]=0;for(O=32664;O<=32667;O++)ce[O]=2;for(O=32701;O<=32761;O++)ce[O]=0;for(O=53001;O<=53004;O++)ce[O]=0;for(O=53008;O<=53019;O++)ce[O]=0;for(O=53021;O<=53032;O++)ce[O]=0;for(O=53034;O<=53037;O++)ce[O]=0;for(O=53042;O<=53046;O++)ce[O]=0;for(O=53074;O<=53080;O++)ce[O]=0;for(O=54001;O<=54004;O++)ce[O]=0;for(O=54008;O<=54019;O++)ce[O]=0;for(O=54021;O<=54032;O++)ce[O]=0;for(O=54034;O<=54037;O++)ce[O]=0;for(O=54042;O<=54046;O++)ce[O]=0;for(O=54048;O<=54053;O++)ce[O]=0;for(O=54074;O<=54080;O++)ce[O]=0;for(O=54098;O<=54101;O++)ce[O]=0;for(O=102001;O<=102040;O++)ce[O]=0;for(O=102042;O<=102063;O++)ce[O]=0;for(O=102065;O<=102067;O++)ce[O]=0;for(O=102070;O<=102117;O++)ce[O]=0;for(O=102122;O<=102216;O++)ce[O]=0;for(O=102221;O<=102377;O++)ce[O]=0;for(O=102382;O<=102388;O++)ce[O]=0;for(O=102389;O<=102398;O++)ce[O]=2;for(O=102399;O<=102444;O++)ce[O]=0;for(O=102445;O<=102447;O++)ce[O]=2;for(O=102448;O<=102458;O++)ce[O]=0;for(O=102459;O<=102468;O++)ce[O]=2;for(O=102469;O<=102499;O++)ce[O]=0;for(O=102500;O<=102519;O++)ce[O]=1;for(O=102520;O<=102524;O++)ce[O]=0;for(O=102525;O<=102529;O++)ce[O]=2;for(O=102530;O<=102588;O++)ce[O]=0;for(O=102590;O<=102598;O++)ce[O]=0;for(O=102601;O<=102603;O++)ce[O]=0;for(O=102605;O<=102628;O++)ce[O]=0;for(O=102629;O<=102646;O++)ce[O]=2;for(O=102648;O<=102700;O++)ce[O]=2;for(O=102701;O<=102703;O++)ce[O]=0;for(O=102707;O<=102730;O++)ce[O]=2;for(O=102733;O<=102758;O++)ce[O]=2;for(O=102767;O<=102900;O++)ce[O]=0;for(O=102901;O<=102933;O++)ce[O]=2;for(O=102934;O<=102950;O++)ce[O]=13;for(O=102951;O<=102960;O++)ce[O]=0;for(O=102965;O<=102969;O++)ce[O]=0;for(O=102971;O<=102973;O++)ce[O]=0;for(O=102975;O<=102989;O++)ce[O]=0;for(O=102990;O<=102992;O++)ce[O]=1;for(O=102997;O<=103002;O++)ce[O]=0;for(O=103003;O<=103008;O++)ce[O]=2;for(O=103009;O<=103011;O++)ce[O]=0;for(O=103012;O<=103014;O++)ce[O]=2;for(O=103019;O<=103021;O++)ce[O]=0;for(O=103022;O<=103024;O++)ce[O]=2;for(O=103029;O<=103031;O++)ce[O]=0;for(O=103032;O<=103034;O++)ce[O]=2;for(O=103065;O<=103068;O++)ce[O]=0;for(O=103074;O<=103076;O++)ce[O]=0;for(O=103077;O<=103079;O++)ce[O]=1;for(O=103080;O<=103082;O++)ce[O]=0;for(O=103083;O<=103085;O++)ce[O]=2;for(O=103090;O<=103093;O++)ce[O]=0;for(O=103097;O<=103099;O++)ce[O]=0;for(O=103100;O<=103102;O++)ce[O]=2;for(O=103107;O<=103109;O++)ce[O]=0;for(O=103110;O<=103112;O++)ce[O]=2;for(O=103113;O<=103116;O++)ce[O]=0;for(O=103117;O<=103120;O++)ce[O]=2;for(O=103153;O<=103157;O++)ce[O]=0;for(O=103158;O<=103162;O++)ce[O]=2;for(O=103163;O<=103165;O++)ce[O]=0;for(O=103166;O<=103168;O++)ce[O]=1;for(O=103169;O<=103171;O++)ce[O]=2;for(O=103186;O<=103188;O++)ce[O]=0;for(O=103189;O<=103191;O++)ce[O]=2;for(O=103192;O<=103195;O++)ce[O]=0;for(O=103196;O<=103199;O++)ce[O]=2;for(O=103200;O<=103224;O++)ce[O]=0;for(O=103225;O<=103227;O++)ce[O]=1;for(O=103232;O<=103237;O++)ce[O]=0;for(O=103238;O<=103243;O++)ce[O]=2;for(O=103244;O<=103246;O++)ce[O]=0;for(O=103247;O<=103249;O++)ce[O]=2;for(O=103254;O<=103256;O++)ce[O]=0;for(O=103257;O<=103259;O++)ce[O]=2;for(O=103264;O<=103266;O++)ce[O]=0;for(O=103267;O<=103269;O++)ce[O]=2;for(O=103300;O<=103375;O++)ce[O]=0;for(O=103381;O<=103383;O++)ce[O]=0;for(O=103384;O<=103386;O++)ce[O]=1;for(O=103387;O<=103389;O++)ce[O]=0;for(O=103390;O<=103392;O++)ce[O]=2;for(O=103397;O<=103399;O++)ce[O]=0;for(O=103400;O<=103471;O++)ce[O]=2;for(O=103476;O<=103478;O++)ce[O]=0;for(O=103479;O<=103481;O++)ce[O]=2;for(O=103486;O<=103488;O++)ce[O]=0;for(O=103489;O<=103491;O++)ce[O]=2;for(O=103492;O<=103495;O++)ce[O]=0;for(O=103496;O<=103499;O++)ce[O]=2;for(O=103528;O<=103543;O++)ce[O]=0;for(O=103544;O<=103548;O++)ce[O]=2;for(O=103549;O<=103551;O++)ce[O]=0;for(O=103552;O<=103554;O++)ce[O]=1;for(O=103555;O<=103557;O++)ce[O]=2;for(O=103558;O<=103560;O++)ce[O]=0;for(O=103571;O<=103573;O++)ce[O]=0;for(O=103574;O<=103576;O++)ce[O]=2;for(O=103577;O<=103580;O++)ce[O]=0;for(O=103581;O<=103583;O++)ce[O]=2;for(O=103595;O<=103694;O++)ce[O]=0;for(O=103696;O<=103699;O++)ce[O]=0;for(O=103700;O<=103793;O++)ce[O]=2;for(O=103794;O<=103872;O++)ce[O]=0;for(O=103900;O<=103971;O++)ce[O]=2;const x9e={102113:!0,102100:!0,3857:!0,3785:!0},T9e={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0},Vee='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',J4=[-20037508342788905e-9,20037508342788905e-9],Z4=[-20037508342787e-6,20037508342787e-6],ufe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:J4,origin:Z4,dx:1e-5},102100:{wkTemplate:Vee,valid:J4,origin:Z4,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:J4,origin:Z4,dx:1e-5},3857:{wkTemplate:Vee,valid:J4,origin:Z4,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Vo(e,t){return!J(e)&&!J(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||c0(e)&&c0(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function lg(e){return ml(e)&&e.wkid?ufe[e.wkid]:null}function PW(e){return!!ml(e)&&(e.wkid?ce[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function tS(e){return!(S0(e)||E0(e))}function cR(e){return ml(e)&&e.wkid===4326}function dfe(e){return ml(e)&&e.wkid===td.CGCS2000}function c0(e){return ml(e)&&e.wkid!=null&&x9e[e.wkid]===!0}function pfe(e){return ml(e)&&e.wkid===32662}function IW(e){return e===td.GCSMARS2000||e===td.GCSMARS2000_SPHERE}function S0(e){return ml(e)&&e.wkid!=null&&IW(e.wkid)}function $W(e){return e===td.GCSMOON2000}function E0(e){return ml(e)&&e.wkid!=null&&$W(e.wkid)}function S9e(e){return ml(e)&&e.wkid!=null&&T9e[e.wkid]===!0}function ml(e){return L(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const Qz={wkid:4326,wkt:o0(ufe[4326].wkTemplate,{Central_Meridian:"0.0"})},E9e={wkid:102100,latestWkid:3857},A9e={wkid:32662};var gf;let os=gf=class extends Ye{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return gf.WebMercator;if(e.wkid===4326)return gf.WGS84}const t=new gf;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return cR(this)}get isWebMercator(){return c0(this)}get isGeographic(){return PW(this)}get isWrappable(){return S9e(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===gf.WGS84)return gf.WGS84;if(this===gf.WebMercator)return gf.WebMercator;const e=new gf;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=Fe(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return Vo(this,e)}toJSON(e){return this.write(void 0,e)}};os.GCS_NAD_1927=null,os.WGS84=null,os.WebMercator=null,os.PlateCarree=null,_([S({readOnly:!0})],os.prototype,"isWGS84",null),_([S({readOnly:!0})],os.prototype,"isWebMercator",null),_([S({readOnly:!0})],os.prototype,"isGeographic",null),_([S({readOnly:!0})],os.prototype,"isWrappable",null),_([S({type:us,json:{write:!0}})],os.prototype,"latestWkid",void 0),_([S({type:us,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],os.prototype,"wkid",void 0),_([S({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],os.prototype,"wkt",void 0),_([Et("wkt"),Et("web-scene","wkt")],os.prototype,"writeWkt",null),_([S({type:us,json:{write:!0}})],os.prototype,"vcsWkid",void 0),_([S({type:us,json:{write:!0}})],os.prototype,"latestVcsWkid",void 0),_([S()],os.prototype,"imageCoordinateSystem",void 0),os=gf=_([re("esri.geometry.SpatialReference")],os),os.prototype.toJSON.isDefaultToJSON=!0,os.GCS_NAD_1927=new os({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),os.WGS84=new os(Qz),os.WebMercator=new os(E9e),os.PlateCarree=new os(A9e),Object.freeze&&(Object.freeze(os.GCS_NAD_1927),Object.freeze(os.WGS84),Object.freeze(os.WebMercator));const It=os;let yf=class extends Ye{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=It.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof It)return e;if(e!=null){const i=new It;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};_([S()],yf.prototype,"type",void 0),_([S({readOnly:!0})],yf.prototype,"cache",null),_([S({readOnly:!0})],yf.prototype,"extent",null),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],yf.prototype,"hasM",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],yf.prototype,"hasZ",void 0),_([S({type:It,json:{write:!0}})],yf.prototype,"spatialReference",void 0),_([wt("spatialReference")],yf.prototype,"readSpatialReference",null),yf=_([re("esri.geometry.Geometry")],yf);const rh=yf;function C9e(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function M9e(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class DW{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const ar=new DW(6378137,1/298.257223563,3e5,.006694379990137799),Qf=new DW(3396190,1/169.8944472236118,23e4),Sg=new DW(1737400,0,0),R9e=57.29577951308232,O9e=.017453292519943;function Gee(e){return e*R9e}function jee(e){return e*O9e}function Hee(e){return e/ar.radius}function S6(e){return Math.PI/2-2*Math.atan(Math.exp(-e/ar.radius))}function eB(e){return e.wkid!=null||e.wkt!=null}const $F=[0,0];function E6(e,t,i,r,s){const n=e,a=s;if(a.spatialReference=i,"x"in n&&"x"in a)[a.x,a.y]=t(n.x,n.y,$F,r);else if("xmin"in n&&"xmin"in a)[a.xmin,a.ymin]=t(n.xmin,n.ymin,$F,r),[a.xmax,a.ymax]=t(n.xmax,n.ymax,$F,r);else if("paths"in n&&"paths"in a||"rings"in n&&"rings"in a){const l="paths"in n?n.paths:n.rings,p=[];let y;for(let b=0;b<l.length;b++){const x=l[b];y=[],p.push(y);for(let A=0;A<x.length;A++)y.push(t(x[A][0],x[A][1],[0,0],r)),x[A].length>2&&y[A].push(x[A][2]),x[A].length>3&&y[A].push(x[A][3])}"paths"in a?a.paths=p:a.rings=p}else if("points"in n&&"points"in a){const l=n.points,p=[];for(let y=0;y<l.length;y++)p[y]=t(l[y][0],l[y][1],[0,0],r),l[y].length>2&&p[y].push(l[y][2]),l[y].length>3&&p[y].push(l[y][3]);a.points=p}return s}function Mp(e,t){const i=e&&(eB(e)?e:e.spatialReference),r=t&&(eB(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!Vo(r,i)||c0(r)&&cR(i)||c0(i)&&cR(r))}function Tw(e,t){if(J(e))return null;const i=e.spatialReference,r=t&&(eB(t)?t:t.spatialReference);return Mp(i,r)?Vo(i,r)?Fe(e):c0(r)?E6(e,i2,It.WebMercator,!1,Fe(e)):cR(r)?E6(e,TT,It.WGS84,!1,Fe(e)):null:null}function i2(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=jee(t);return i[0]=jee(e)*ar.radius,i[1]=ar.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function TT(e,t,i=[0,0],r=!1){const s=Gee(e/ar.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Gee(Math.PI/2-2*Math.atan(Math.exp(-t/ar.radius))),i}function e0(e,t=!1,i=Fe(e)){return E6(e,i2,It.WebMercator,t,i)}function q3(e,t=!1,i=Fe(e)){return E6(e,TT,It.WGS84,t,i)}var WI;const VE=[0,0];function qee(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const K4=Ge.getLogger("esri.geometry.Point");let Ol=WI=class extends rh{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new It(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)K4.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)K4.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const l=i2(n.longitude,n.latitude,VE);e=l[0],t=l[1]}}}else qee(i)?(s=i,i=null):qee(r)&&(s=r,r=null);const a={x:e,y:t};return a.x==null&&a.y!=null?K4.warn(".y=","Y coordinate was defined without an X coordinate"):a.y==null&&a.x!=null&&K4.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(a.spatialReference=s),i!=null&&(a.z=i),r!=null&&(a.m=r),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return TT(t,i,VE)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",i2(i,e,VE)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return TT(e,t,VE)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",i2(e,t,VE)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new WI;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return WI.copy(e,this),this}equals(e){if(J(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:a,m:l}=e;let{x:p,y,spatialReference:b}=e;if(!n.equals(b))if(n.isWebMercator&&b.isWGS84)[p,y]=i2(p,y),b=n;else{if(!n.isWGS84||!b.isWebMercator)return!1;[p,y]=TT(p,y),b=n}return t===p&&i===y&&r===a&&s===l&&n.wkid===b.wkid}offset(e,t,i){return C9e(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=lg(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return M9e(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};_([S({readOnly:!0})],Ol.prototype,"cache",null),_([S({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ol.prototype,"hasM",null),_([S({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ol.prototype,"hasZ",null),_([S({type:Number})],Ol.prototype,"latitude",null),_([S({type:Number})],Ol.prototype,"longitude",null),_([S({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),_i(e=>isNaN(e)?e:Xu(e))],Ol.prototype,"x",void 0),_([Et("x")],Ol.prototype,"writeX",null),_([wt("x")],Ol.prototype,"readX",null),_([S({type:Number,json:{write:!0}})],Ol.prototype,"y",void 0),_([S({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ol.prototype,"z",void 0),_([S({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ol.prototype,"m",void 0),Ol=WI=_([re("esri.geometry.Point")],Ol),Ol.prototype.toJSON.isDefaultToJSON=!0;const Gt=Ol;function z2(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function P9e(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ze(e,i,r,s),e}function qxt(e,t,i){i=i||e;const r=rt(e,t);ze(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),ot(i,i)}function Wxt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?ze(t,0,1,0):ze(t,1,0,0),si(i,e,t),ot(t,t),si(t,i,e),ot(i,i)}function I9e(e,t){return(e%t+t)%t}function Q4(e,t,i,r,s,n){const a=e+(t-e)*s;return a+(i+(r-i)*s-a)*n}function $9e(e,t,i,r=Q()){const s=yt(e),n=yt(t),a=rt(e,t)/(s*n);if(a<.9999999999999999){const l=Math.acos(a),p=((1-i)*s+i*n)/Math.sin(l),y=p/s*Math.sin((1-i)*l),b=p/n*Math.sin(i*l);return Ue(r2,e,y),Ue(s2,t,b),Xe(r,r2,s2)}return Wn(r,e,t,i)}function Xxt(e,t,i,r=Q(),s=Q()){const n=yt(e),a=yt(t),l=rt(e,t)/(n*a);if(l<.9999999999999999){const p=Math.acos(l),y=Math.sin(p),b=Math.sin(i*p),x=Math.sin((1-i)*p),A=(1-i)*n+i*a;{const M=A/y,P=M/a*b;Ue(r2,e,M/n*x),Ue(s2,t,P),Xe(r,r2,s2)}{const M=1/n*(-Math.cos((1-i)*p)*p*A+x*(-n+a));Ue(r2,e,M);const P=1/a*(Math.cos(i*p)*p*A+b*(-n+a));Ue(s2,t,P),Xe(s,r2,s2),Ue(s,s,1/y)}return s}return Wn(r,e,t,i),We(s,t,e),ot(s,s),s}function DF(e,t,i){e=ot(r2,e),t=ot(s2,t);const r=Xn(rt(e,t));if(i){const s=si(L9e,e,t);if(rt(s,i)<0)return-r}return r}function XI(e){const t=e.length;return function(i){if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],a=(n-i)/(n-s);return a*e[r-1][1]+(1-a)*e[r][1]}}class vv{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return Ot(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function Yxt(e,t,i,r){We(Wee,t,e),We(Xee,i,e),si(r,Wee,Xee),ot(r,r),r[3]=-rt(e,r)}const Wee=Q(),Xee=Q();function LW(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const D9e=LW(new vv(0,2*Math.PI)),_v=LW(new vv(-Math.PI,Math.PI)),NW=LW(new vv(0,360)),L9e=Q(),r2=Q(),s2=Q();let am=class extends T0(Ye){constructor(...e){super(...e),this.position=new Gt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Xu(e.x||0),s.y=Xu(e.y||0),s.z=e.hasZ?Xu(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new Gt;return i.read(e,t),i.x=Xu(i.x||0),i.y=Xu(i.y||0),i.z=i.hasZ?Xu(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};_([S({type:Gt,json:{write:{isRequired:!0}}})],am.prototype,"position",void 0),_([Et("position")],am.prototype,"writePosition",null),_([wt("position")],am.prototype,"readPosition",null),_([S({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),_i(e=>NW.normalize(Xu(e)))],am.prototype,"heading",void 0),_([S({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),_i(e=>Ot(Xu(e),-180,180))],am.prototype,"tilt",void 0),_([S({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],am.prototype,"fov",void 0),am=_([re("esri.Camera")],am);const sh=am,LF=[0,0];function LO(e,t){return!!L(t)&&Fl(e,t.x,t.y,t.z)}function Jxt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!iS(e,i))return!1;return!0}function N9e(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:a,zmax:l}=t;return e.hasZ&&t.hasZ?Fl(e,i,r,s)&&Fl(e,i,a,s)&&Fl(e,n,a,s)&&Fl(e,n,r,s)&&Fl(e,i,r,l)&&Fl(e,i,a,l)&&Fl(e,n,a,l)&&Fl(e,n,r,l):Fl(e,i,r)&&Fl(e,i,a)&&Fl(e,n,a)&&Fl(e,n,r)}function iS(e,t){return Fl(e,t[0],t[1])}function F9e(e,t){return Fl(e,t[0],t[1],t[2])}function Fl(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function k9e(e,t){return LF[1]=t.y,LF[0]=t.x,ffe(e,LF)}function ffe(e,t){return U9e(e.rings,t)}function U9e(e,t){if(!e)return!1;if(z9e(e))return Yee(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=Yee(i,e[r],t);return i}function z9e(e){return!Array.isArray(e[0][0])}function Yee(e,t,i){const[r,s]=i;let n=e,a=0;for(let l=0,p=t.length;l<p;l++){a++,a===p&&(a=0);const[y,b]=t[l],[x,A]=t[a];(b<s&&A>=s||A<s&&b>=s)&&y+(s-b)/(A-b)*(x-y)<r&&(n=!n)}return n}function B9e(e,t){return LO(e,t)}function V9e(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function G9e(e,t){const{points:i,hasZ:r}=t,s=r?F9e:iS;for(const n of i)if(s(e,n))return!0;return!1}const B2=[0,0],V2=[0,0],G2=[0,0],j2=[0,0],j9e=[B2,V2,G2,j2],mfe=[[G2,B2],[B2,V2],[V2,j2],[j2,G2]];function H9e(e,t){B2[0]=e.xmin,B2[1]=e.ymax,V2[0]=e.xmax,V2[1]=e.ymax,G2[0]=e.xmin,G2[1]=e.ymin,j2[0]=e.xmax,j2[1]=e.ymin;for(const i of j9e)if(ffe(t,i))return!0;for(const i of t.rings){if(!i.length)continue;let r=i[0];if(iS(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(iS(e,n)||gfe(r,n,mfe))return!0;r=n}}return!1}function q9e(e,t){B2[0]=e.xmin,B2[1]=e.ymax,V2[0]=e.xmax,V2[1]=e.ymax,G2[0]=e.xmin,G2[1]=e.ymin,j2[0]=e.xmax,j2[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(iS(e,s))return!0;for(let n=1;n<r.length;n++){const a=r[n];if(iS(e,a)||gfe(s,a,mfe))return!0;s=a}}return!1}const Wo=[0,0];function W9e(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],a=i[s+1];for(let l=t+1;l<e.length;l++)for(let p=0;p<e[l].length-1;p++){const y=e[l][p],b=e[l][p+1];if(tB(n,a,y,b,Wo)&&!(Wo[0]===n[0]&&Wo[1]===n[1]||Wo[0]===y[0]&&Wo[1]===y[1]||Wo[0]===a[0]&&Wo[1]===a[1]||Wo[0]===b[0]&&Wo[1]===b[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const a=i[s],l=i[s+1];for(let p=s+2;p<n;p++){const y=i[p],b=i[p+1];if(tB(a,l,y,b,Wo)&&!(Wo[0]===a[0]&&Wo[1]===a[1]||Wo[0]===y[0]&&Wo[1]===y[1]||Wo[0]===l[0]&&Wo[1]===l[1]||Wo[0]===b[0]&&Wo[1]===b[1]))return!0}}}return!1}function gfe(e,t,i){for(let r=0;r<i.length;r++)if(tB(e,t,i[r][0],i[r][1]))return!0;return!1}function tB(e,t,i,r,s){const[n,a]=e,[l,p]=t,[y,b]=i,[x,A]=r,M=x-y,P=n-y,$=l-n,k=A-b,z=a-b,G=p-a,B=k*$-M*G;if(B===0)return!1;const W=(M*z-k*P)/B,q=($*z-G*P)/B;return W>=0&&W<=1&&q>=0&&q<=1&&(s&&(s[0]=n+W*(l-n),s[1]=a+W*(p-a)),!0)}function X9e(e){switch(e){case"esriGeometryEnvelope":case"extent":return V9e;case"esriGeometryMultipoint":case"multipoint":return G9e;case"esriGeometryPoint":case"point":return B9e;case"esriGeometryPolygon":case"polygon":return H9e;case"esriGeometryPolyline":case"polyline":return q9e}}var Su;function Y9e(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function o1(e,t,i){return t==null?i:i==null?t:e(t,i)}let Mo=Su=class extends rh{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return Y9e(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?It.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?It.WGS84:s}}static fromBounds(e,t){return new Su({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new Su({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new Gt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new Su;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Mp(t,i)&&(e=t.isWebMercator?e0(e):q3(e,!0)),e.type==="point"?LO(this,e):e.type==="extent"&&N9e(this,e)}equals(e){if(this===e)return!0;if(J(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Mp(t,i)&&(e=t.isWebMercator?e0(e):q3(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(J(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Mp(t,i)&&(e=t.isWebMercator?e0(e):q3(e,!0)),X9e(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=o1(Math.min,this.zmin,e.zmin),this.zmax=o1(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=o1(Math.min,this.mmin,e.mmin),this.mmax=o1(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:J(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=o1(Math.max,this.zmin,e.zmin),this.zmax=o1(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=o1(Math.max,this.mmin,e.mmin),this.mmax=o1(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=lg(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?q3(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new It(o0(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||lg(r)))return this;const s=this._getParts(i).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,a=!0;return s.forEach(l=>{l.hasZ||(n=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const p=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(n){const y=(l.zmax-l.zmin)/2;for(let b=0;b<p.length;b++)p[b].push(y)}if(a){const y=(l.mmax-l.mmin)/2;for(let b=0;b<p.length;b++)p[b].push(y)}return p}),hasZ:n,hasM:a,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:a}=this,l=this.width,p=this.xmin,y=this.xmax;let b;e=e||lg(a);const[x,A]=e.valid;b=this._normalizeX(this.xmin,e);const M=b.x,P=b.frameId;b=this._normalizeX(this.xmax,e);const $=b.x,k=b.frameId,z=M===$&&l>0;if(l>2*A){const G=new Su(p<y?M:$,s,A,n,a),B=new Su(x,s,p<y?$:M,n,a),W=new Su(0,s,A,n,a),q=new Su(x,s,0,n,a),X=[],oe=[];G.contains(W)&&X.push(P),G.contains(q)&&oe.push(P),B.contains(W)&&X.push(k),B.contains(q)&&oe.push(k);for(let de=P+1;de<k;de++)X.push(de),oe.push(de);t.push({extent:G,frameIds:[P]},{extent:B,frameIds:[k]},{extent:W,frameIds:X},{extent:q,frameIds:oe})}else M>$||z?t.push({extent:new Su(M,s,A,n,a),frameIds:[P]},{extent:new Su(x,s,$,n,a),frameIds:[k]}):t.push({extent:new Su(M,s,$,n,a),frameIds:[P]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,a=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,a=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,a=-n),{x:e,frameId:a}}};_([S({readOnly:!0})],Mo.prototype,"cache",null),_([S({readOnly:!0})],Mo.prototype,"center",null),_([S({readOnly:!0})],Mo.prototype,"extent",null),_([S({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Mo.prototype,"hasM",null),_([S({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Mo.prototype,"hasZ",null),_([S({readOnly:!0})],Mo.prototype,"height",null),_([S({readOnly:!0})],Mo.prototype,"width",null),_([S({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Mo.prototype,"xmin",void 0),_([S({type:Number,json:{write:!0}})],Mo.prototype,"ymin",void 0),_([S({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Mo.prototype,"mmin",void 0),_([S({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Mo.prototype,"zmin",void 0),_([S({type:Number,json:{write:!0}})],Mo.prototype,"xmax",void 0),_([S({type:Number,json:{write:!0}})],Mo.prototype,"ymax",void 0),_([S({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Mo.prototype,"mmax",void 0),_([S({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Mo.prototype,"zmax",void 0),Mo=Su=_([re("esri.geometry.Extent")],Mo),Mo.prototype.toJSON.isDefaultToJSON=!0;const ki=Mo;function rS(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var iB;function Jee(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function J9e(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let k1=iB=class extends rh{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):J9e(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new ki,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],a=Jee(Math.min),l=Jee(Math.max);let p,y,b,x,[A,M]=n,[P,$]=n;for(let k=0,z=e.length;k<z;k++){const G=e[k],[B,W]=G;if(A=a(A,B),M=a(M,W),P=l(P,B),$=l($,W),i&&G.length>2){const q=G[2];p=a(p,q),b=l(b,q)}if(r&&G.length>s){const q=G[s];y=a(y,q),x=l(x,q)}}return t.xmin=A,t.ymin=M,t.xmax=P,t.ymax=$,t.spatialReference=this.spatialReference,i?(t.zmin=p,t.zmax=b):(t.zmin=null,t.zmax=null),r?(t.mmin=y,t.mmax=x):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=Fe(this.points)}addPoint(e){return rS(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:Fe(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new iB(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new Gt(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new Gt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(rS(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};_([S({readOnly:!0})],k1.prototype,"cache",null),_([S()],k1.prototype,"extent",null),_([S({type:[[Number]],json:{write:{isRequired:!0}}})],k1.prototype,"points",void 0),_([Et("points")],k1.prototype,"writePoints",null),k1=iB=_([re("esri.geometry.Multipoint")],k1),k1.prototype.toJSON.isDefaultToJSON=!0;const Bv=k1;function Zee(e){if(!e)return null;if(Array.isArray(e))return e;const t=e.hasZ,i=e.hasM;if(e.type==="point")return i&&t?[e.x,e.y,e.z,e.m]:t?[e.x,e.y,e.z]:i?[e.x,e.y,e.m]:[e.x,e.y];if(e.type==="polygon")return e.rings.slice(0);if(e.type==="polyline")return e.paths.slice(0);if(e.type==="multipoint")return e.points.slice(0);if(e.type==="extent"){const r=e.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(a=>{a.hasZ&&(s=!0),a.hasM&&(n=!0)}),r.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(s&&a.hasZ){const p=.5*(a.zmax-a.zmin);for(let y=0;y<l.length;y++)l[y].push(p)}if(n&&a.hasM){const p=.5*(a.mmax-a.mmin);for(let y=0;y<l.length;y++)l[y].push(p)}return l})}return null}function FW(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function yfe(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function Z9e(e,t){return yfe(e,t,.5)}function vfe(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=FW(e[r],e[r+1]);return i}function _fe(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=FW(e[s],e[s+1]);if(t-r<n){const a=(t-r)/n;return yfe(e[s],e[s+1],a)}r+=n}return e[i-1]}function kW(e,t,i){const r=e.length;let s=0,n=0,a=0;for(let l=0;l<r;l++){const p=e[l],y=e[(l+1)%r];let b=2;s+=p[0]*y[1]-y[0]*p[1],p.length>2&&y.length>2&&i&&(n+=p[0]*y[2]-y[0]*p[2],b=3),p.length>b&&y.length>b&&t&&(a+=p[0]*y[b]-y[0]*p[b])}return s<=0&&n<=0&&a<=0}function Zxt(e){return e.type!=="polygon"&&e.type!=="polyline"||K9e(e.type==="polygon"?e.rings:e.paths,e.spatialReference),e}function K9e(e,t){const i=lg(t);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const a of e){let l=1/0,p=-1/0;a.forEach(b=>{let x=b[0];for(;x<r;)x+=n;for(;x>s;)x-=n;l=Math.min(l,x),p=Math.max(p,x),b[0]=x});const y=p-l;n-y<y&&a.forEach(b=>{b[0]<0&&(b[0]+=n)})}}function Q9e(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function bfe(e){return e?wfe(e.rings,e.hasZ):null}function wfe(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,a=e.length;n<a;n++){const l=e$e(e[n],t,s);l&&r.push(l)}if(r.sort((n,a)=>{let l=n[2]-a[2];return l===0&&t&&(l=n[4]-a[4]),l}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?t$e(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function e$e(e,t,i){let r=0,s=0,n=0,a=0,l=0;const p=e.length?e[0][0]:0,y=e.length?e[0][1]:0,b=e.length&&t?e[0][2]:0;for(let A=0;A<e.length;A++){const M=e[A],P=e[(A+1)%e.length],[$,k,z]=M,G=$-p,B=k-y,W=t?z-b:void 0,[q,X,oe]=P,de=q-p,he=X-y,fe=t?oe-b:void 0,me=G*he-de*B;if(a+=me,r+=(G+de)*me,s+=(B+he)*me,t&&M.length>2&&P.length>2){const ge=G*fe-de*W;n+=(W+fe)*ge,l+=ge}$<i[0]&&(i[0]=$),$>i[1]&&(i[1]=$),k<i[2]&&(i[2]=k),k>i[3]&&(i[3]=k),t&&(z<i[4]&&(i[4]=z),z>i[5]&&(i[5]=z))}if(a>0&&(a*=-1),l>0&&(l*=-1),!a)return null;a*=.5,l*=.5;const x=[r/(6*a)+p,s/(6*a)+y,a];return t&&(i[4]===i[5]||l===0?(x[3]=(i[4]+i[5])/2,x[4]=0):(x[3]=n/(6*l)+b,x[4]=l)),x}function t$e(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,a=0,l=0;for(let p=0,y=e.length;p<y-1;p++){const b=e[p],x=e[p+1];if(b&&x){i[0]=b[0],i[1]=b[1],r[0]=x[0],r[1]=x[1],t&&b.length>2&&x.length>2&&(i[2]=b[2],r[2]=x[2]);const A=FW(i,r);if(A){s+=A;const M=Z9e(b,x);n+=A*M[0],a+=A*M[1],t&&M.length>2&&(l+=A*M[2])}}}return s>0?t?[n/s,a/s,l/s]:[n/s,a/s]:e.length?e[0]:null}function xfe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Tfe(e){return e.points!==void 0}function Sfe(e){return e.x!==void 0&&e.y!==void 0}function Efe(e){return e.paths!==void 0}function Afe(e){return e.rings!==void 0}function Cfe(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const Vy=Cfe(Math.min),Gy=Cfe(Math.max);function Kxt(e,t){return Efe(t)?sS(e,t.paths,!1,!1):Afe(t)?sS(e,t.rings,!1,!1):Tfe(t)?UW(e,t.points,!1,!1,!1,!1):xfe(t)?Mfe(e,t):(Sfe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Qxt(e,t){return Efe(t)?sS(e,t.paths,!0,!1):Afe(t)?sS(e,t.rings,!0,!1):Tfe(t)?UW(e,t.points,!0,!1,!0,!1):xfe(t)?Mfe(e,t,!0,!1,!0,!1):(Sfe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function sS(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,a,l,p,[y,b]=t[0][0],[x,A]=t[0][0];for(let M=0;M<t.length;M++){const P=t[M];for(let $=0;$<P.length;$++){const k=P[$],[z,G]=k;if(y=Vy(y,z),b=Vy(b,G),x=Gy(x,z),A=Gy(A,G),i&&k.length>2){const B=k[2];n=Vy(n,B),a=Gy(a,B)}if(r&&k.length>s){const B=k[s];l=Vy(n,B),p=Gy(a,B)}}}return i?r?(e[0]=y,e[1]=b,e[2]=n,e[3]=l,e[4]=x,e[5]=A,e[6]=a,e[7]=p,e.length=8,e):(e[0]=y,e[1]=b,e[2]=n,e[3]=x,e[4]=A,e[5]=a,e.length=6,e):r?(e[0]=y,e[1]=b,e[2]=l,e[3]=x,e[4]=A,e[5]=p,e.length=6,e):(e[0]=y,e[1]=b,e[2]=x,e[3]=A,e.length=4,e)}function Mfe(e,t,i,r,s,n){const a=t.xmin,l=t.xmax,p=t.ymin,y=t.ymax;let b=t.zmin,x=t.zmax,A=t.mmin,M=t.mmax;return s?(b=b||0,x=x||0,n?(A=A||0,M=M||0,e[0]=a,e[1]=p,e[2]=b,e[3]=A,e[4]=l,e[5]=y,e[6]=x,e[7]=M,e):(e[0]=a,e[1]=p,e[2]=b,e[3]=l,e[4]=y,e[5]=x,e)):n?(A=A||0,M=M||0,e[0]=a,e[1]=p,e[2]=A,e[3]=l,e[4]=y,e[5]=M,e):(e[0]=a,e[1]=p,e[2]=l,e[3]=y,e)}function UW(e,t,i,r,s,n){const a=i?3:2,l=r&&n,p=i&&s;if(!t.length||!t[0].length)return null;let y,b,x,A,[M,P]=t[0],[$,k]=t[0];for(let z=0;z<t.length;z++){const G=t[z],[B,W]=G;if(M=Vy(M,B),P=Vy(P,W),$=Gy($,B),k=Gy(k,W),p&&G.length>2){const q=G[2];y=Vy(y,q),b=Gy(b,q)}if(l&&G.length>a){const q=G[a];x=Vy(y,q),A=Gy(b,q)}}return s?(y=y||0,b=b||0,n?(x=x||0,A=A||0,e[0]=M,e[1]=P,e[2]=y,e[3]=x,e[4]=$,e[5]=k,e[6]=b,e[7]=A,e):(e[0]=M,e[1]=P,e[2]=y,e[3]=$,e[4]=k,e[5]=b,e)):n?(x=x||0,A=A||0,e[0]=M,e[1]=P,e[2]=x,e[3]=$,e[4]=k,e[5]=A,e):(e[0]=M,e[1]=P,e[2]=$,e[3]=k,e)}function i$e(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function r$e(e){return e.points!==void 0}function s$e(e){return e.x!==void 0&&e.y!==void 0}function n$e(e){return e.paths!==void 0}function o$e(e){return e.rings!==void 0}const zW=[];function Rfe(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Ofe(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Pfe(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Ife(e,t,i,r,s,n,a,l){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:a,mmax:l}}function BW(e,t=!1,i=!1){return t?i?Ife(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Ofe(e[0],e[1],e[2],e[3],e[4],e[5]):i?Pfe(e[0],e[1],e[2],e[3],e[4],e[5]):Rfe(e[0],e[1],e[2],e[3])}function rB(e){return e?i$e(e)?e:s$e(e)?l$e(e):o$e(e)?VW(e):n$e(e)?$fe(e):r$e(e)?a$e(e):null:null}function a$e(e){const{hasZ:t,hasM:i,points:r}=e;return BW(UW(zW,r,t,i),t,i)}function l$e(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Ife(t,i,r,s,t,i,r,s):Ofe(t,i,r,t,i,r):n?Pfe(t,i,s,t,i,s):Rfe(t,i,t,i)}function VW(e){const{hasZ:t,hasM:i,rings:r}=e,s=sS(zW,r,t,i);return s?BW(s,t,i):null}function $fe(e){const{hasZ:t,hasM:i,paths:r}=e,s=sS(zW,r,t,i);return s?BW(s,t,i):null}var YI;function Kee(e){return!Array.isArray(e[0])}let vf=YI=class extends rh{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const a of t)a.hasZ&&(r=!0),a.hasM&&(s=!0);const n={rings:t.map(function(a){const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(r&&a.hasZ){const p=a.zmin+.5*(a.zmax-a.zmin);for(let y=0;y<l.length;y++)l[y].push(p)}if(s&&a.hasM){const p=a.mmin+.5*(a.mmax-a.mmin);for(let y=0;y<l.length;y++)l[y].push(p)}return l}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new YI(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||It.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=bfe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new Gt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=VW(this);if(!t)return null;const i=new ki(t);return i.spatialReference=e,i}get isSelfIntersecting(){return W9e(this.rings)}writeRings(e,t){t.rings=Fe(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(Kee(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new YI;return e.spatialReference=this.spatialReference,e.rings=Fe(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(J(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(L(t)!==L(i)||L(t)&&L(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,a,l],[p,y,b,x])=>s===p&&n===y&&(a==null&&b==null||a===b)&&(l==null&&x==null||l===x);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],a=e.rings[s];if(!$2(n,a,r))return!1}return!0}contains(e){if(!e)return!1;const t=Tw(e,this.spatialReference);return k9e(this,L(t)?t:e)}isClockwise(e){let t;return t=Kee(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,kW(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new Gt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Gt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Gt(i[0],i[1],i[2],i[3],this.spatialReference):new Gt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(rS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new Gt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new Gt(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(rS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};_([S({readOnly:!0})],vf.prototype,"cache",null),_([S({readOnly:!0})],vf.prototype,"centroid",null),_([S({readOnly:!0})],vf.prototype,"extent",null),_([S({readOnly:!0})],vf.prototype,"isSelfIntersecting",null),_([S({type:[[[Number]]],json:{write:{isRequired:!0}}})],vf.prototype,"rings",void 0),_([Et("rings")],vf.prototype,"writeRings",null),vf=YI=_([re("esri.geometry.Polygon")],vf),vf.prototype.toJSON.isDefaultToJSON=!0;const Fa=vf;var sB;function c$e(e){return!Array.isArray(e[0])}let U1=sB=class extends rh{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||It.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=$fe(this);if(!t)return null;const i=new ki(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=Fe(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(c$e(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new sB;return e.spatialReference=this.spatialReference,e.paths=Fe(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new Gt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Gt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Gt(i[0],i[1],i[2],i[3],this.spatialReference):new Gt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(rS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new Gt(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new Gt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(rS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};_([S({readOnly:!0})],U1.prototype,"cache",null),_([S({readOnly:!0})],U1.prototype,"extent",null),_([S({type:[[[Number]]],json:{write:{isRequired:!0}}})],U1.prototype,"paths",void 0),_([Et("paths")],U1.prototype,"writePaths",null),U1=sB=_([re("esri.geometry.Polyline")],U1),U1.prototype.toJSON.isDefaultToJSON=!0;const Hc=U1,Dfe=Va()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Qee=Va()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Lfe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function GW(e){return e.points!==void 0}function jW(e){return e.x!==void 0&&e.y!==void 0}function HW(e){return e.paths!==void 0}function b2(e){return e.rings!==void 0}function Lp(e){return J(e)?null:e instanceof rh?e:jW(e)?Gt.fromJSON(e):HW(e)?Hc.fromJSON(e):b2(e)?Fa.fromJSON(e):GW(e)?Bv.fromJSON(e):Lfe(e)?ki.fromJSON(e):null}function Vv(e){return e?jW(e)?"esriGeometryPoint":HW(e)?"esriGeometryPolyline":b2(e)?"esriGeometryPolygon":Lfe(e)?"esriGeometryEnvelope":GW(e)?"esriGeometryMultipoint":null:null}const h$e={esriGeometryPoint:Gt,esriGeometryPolyline:Hc,esriGeometryPolygon:Fa,esriGeometryEnvelope:ki,esriGeometryMultipoint:Bv};function Nfe(e){return e&&h$e[e]||null}const Sw={base:rh,key:"type",typeMap:{extent:ki,multipoint:Bv,point:Gt,polyline:Hc,polygon:Fa}};Dp(Sw);var nS;function u$e(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return nS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return nS.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(nS||(nS={}));let NF;function Np(){return NF||(NF=(async()=>{const e=await import("./arcadeUtils.5e9a5423.js").then(function(t){return t.q});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),NF}const d$e=(e,t,i)=>NO.create(e,t,i,null,["$feature"]),p$e=(e,t,i)=>NO.create(e,t,i,null,["$feature","$view"]),f$e=(e,t,i,r)=>NO.create(e,t,i,r,["$feature","$view"]);class NO{constructor(t,i,r,s,n,a,l,p){this.script=t,this.evaluate=n;const y=Array.isArray(l)?l:l.fields;this.fields=y,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=a,this._spatialReference=p,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,a){const{arcade:l,Feature:p,Dictionary:y}=await Np(),b=It.fromJSON(i),x=l.parseScript(t,a),A=n.reduce((q,X)=>qe(ie({},q),{[X]:null}),{});let M=null;L(s)&&(M=new y(s),M.immutable=!0,A.$config=null);const P=l.scriptUsesGeometryEngine(x)&&l.enableGeometrySupport(),$=l.scriptUsesFeatureSet(x)&&l.enableFeatureSetSupport(),k=l.scriptIsAsync(x)&&l.enableAsyncSupport(),z={vars:A,spatialReference:b,useAsync:!!k},G=new y;G.immutable=!1,G.setField("scale",0);const B=l.compileScript(x,z),W=q=>("$view"in q&&q.$view&&(G.setField("scale",q.$view.scale),q.$view=G),M&&(q.$config=M),B({vars:q,spatialReference:b}));return await Promise.all([P,$,k]),new NO(t,l,y,x,W,new p,r,b)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const m$e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],g$e=["field","normalizationField"];function ete(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(tte(m$e,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)tte(g$e,r,t)}}function tte(e,t,i){if(e)for(const r of e){const s=iE(r,t),n=s&&typeof s!="function"&&i.get(s);n&&Kh(r,n.name,t)}}function Ffe(e,t){if(e!=null&&t!=null&&t.fields.length)if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const FF=new Set;function kfe(e,t){return e&&t?(FF.clear(),hR(FF,e,t),Array.from(FF).sort()):[]}function hR(e,t,i){var r;if(i)if(t!=null&&(r=t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)hd(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function hd(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function e3t(e,t){return J(t)||J(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function eu(e,t,i){var r;if(!i)return;const{arcadeUtils:s}=await Np(),n=s.extractFieldNames(i,t==null||(r=t.fields)==null?void 0:r.map(a=>a.name));for(const a of n)hd(e,t,a)}async function Ufe(e,t,i){if(i&&i!=="1=1"){const r=(await Promise.resolve().then(function(){return uK})).WhereClause.create(i,t);if(!r.isStandardized)throw new Se("fieldUtils:collectFilterFields","Where clause is not standardized");hR(e,t,r.fieldNames)}}function y$e({displayField:e,fields:t}){return e||(t&&t.length?kF(t,"name-or-title")||kF(t,"unique-identifier")||kF(t,"type-or-category")||v$e(t):null)}function v$e(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.indexOf("name")>-1||i.indexOf("title")>-1)return t.name}return null}function kF(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function t3t(e,t){if(!t)return;const i=iE("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function _$e(e,t,i){i.outStatistic.onStatisticValueExpression?eu(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function i3t(e,t,i){var r,s;if(!t||!i||i.type!=="cluster")return;const n=[];if((r=i.popupTemplate)!=null&&r.expressionInfos&&n.push(...i.popupTemplate.expressionInfos.map(a=>eu(e,t.fieldsIndex,a.expression))),Array.isArray((s=i.popupTemplate)==null?void 0:s.content)){const a=i.popupTemplate.content;for(const l of a)l.type==="expression"&&l.expressionInfo&&n.push(eu(e,t.fieldsIndex,l.expressionInfo.expression))}i.fields&&n.push(...i.fields.map(a=>_$e(e,t.fieldsIndex,a))),await Promise.all(n)}async function r3t(e,t,i){t&&(t.timeInfo&&L(i)&&i.timeExtent&&hR(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&hR(e,t.fieldsIndex,[t.floorInfo.floorField]),L(i)&&L(i.where)&&await Ufe(e,t.fieldsIndex,i.where))}async function s3t(e,t,i){t&&i&&await Promise.all(i.map(r=>b$e(e,t,r)))}async function b$e(e,t,i){t&&i&&(i.valueExpression?await eu(e,t.fieldsIndex,i.valueExpression):i.field&&hd(e,t.fieldsIndex,i.field))}function n3t(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?kfe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function o3t(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>w$e(e,r,s)))}async function w$e(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await eu(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(a=>{hd(e,t,a.slice(1,-1))})}await Ufe(e,t,s)}function x$e(e){const t=e.defaultValue;return t!==void 0&&Vfe(e,t)?t:e.nullable?null:void 0}function zfe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function T$e(e){return e===null||zfe(e)}const qW="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function S$e(e){return e===null||qW(e)}function Bfe(e){return e!=null&&typeof e=="string"}function E$e(e){return e===null||Bfe(e)}function A$e(){return!0}function Vfe(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?S$e:qW;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?T$e:zfe;break;case"string":case"esriFieldTypeString":i=e.nullable?E$e:Bfe;break;default:i=A$e}return arguments.length===1?i:i(t)}const C$e=["integer","small-integer","single","double"],M$e=new Set([...C$e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function $L(e){return e!=null&&M$e.has(e.type)}function ite(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var A6,C6;function a3t(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function l3t(e,t){return e.nullable&&t===null?null:$L(e)&&!R$e(e.type,Number(t))?A6.OUT_OF_RANGE:Vfe(e,t)?e.domain?u$e(e.domain,t):null:C6.INVALID_TYPE}function R$e(e,t){const i=typeof e=="string"?Gfe(e):e;return!!i&&(i.isInteger?qW(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function Gfe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return O$e;case"esriFieldTypeInteger":case"integer":return P$e;case"esriFieldTypeSingle":case"single":return I$e;case"esriFieldTypeDouble":case"double":return $$e}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(A6||(A6={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(C6||(C6={}));const O$e={min:-32768,max:32767,isInteger:!0},P$e={min:-2147483648,max:2147483647,isInteger:!0},I$e={min:-34e37,max:12e37,isInteger:!1},$$e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function c3t(e,t,i){switch(e){case nS.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case nS.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case C6.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case A6.OUT_OF_RANGE:{const{min:r,max:s}=Gfe(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function D$e(e,t){return!L$e(e,t,null)}function L$e(e,t,i){if(!t||!t.attributes||!e){if(L(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!L(i))break;i.add(n)}return s}let JI=class extends Ye{constructor(e){super(e),this.type=null}};_([S({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],JI.prototype,"type",void 0),JI=_([re("esri.popup.content.Content")],JI);const Ew=JI;var nB;let z_=nB=class extends Ew{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new nB({description:this.description,displayType:this.displayType,title:this.title})}};_([S({type:String,json:{write:!0}})],z_.prototype,"description",void 0),_([S({type:["auto","preview","list"],json:{write:!0}})],z_.prototype,"displayType",void 0),_([S({type:String,json:{write:!0}})],z_.prototype,"title",void 0),_([S({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],z_.prototype,"type",void 0),z_=nB=_([re("esri.popup.content.AttachmentsContent")],z_);const uR=z_;var oB;let B_=oB=class extends Ew{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new oB({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Fe(this.outFields):null})}};_([S()],B_.prototype,"creator",void 0),_([S()],B_.prototype,"destroyer",void 0),_([S()],B_.prototype,"outFields",void 0),_([S({type:["custom"],readOnly:!0})],B_.prototype,"type",void 0),B_=oB=_([re("esri.popup.content.CustomContent")],B_);const N$e=B_;var aB;let qx=aB=class extends Ye{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new aB({title:this.title,expression:this.expression})}};_([S({type:String,json:{write:!0}})],qx.prototype,"title",void 0),_([S({type:String,json:{write:!0}})],qx.prototype,"expression",void 0),_([S({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],qx.prototype,"returnType",void 0),qx=aB=_([re("esri.popup.ElementExpressionInfo")],qx);const jfe=qx;var lB;let ZA=lB=class extends Ew{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new lB({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};_([S({type:jfe,json:{write:!0}})],ZA.prototype,"expressionInfo",void 0),_([S({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],ZA.prototype,"type",void 0),ZA=lB=_([re("esri.popup.content.ExpressionContent")],ZA);const WW=ZA,dR=Va()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});dR.toJSON.bind(dR);dR.fromJSON.bind(dR);var cB;let V_=cB=class extends Ye{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new cB({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?xg(e,ie(ie({},uW(this.dateFormat)),this.dateTimeFormatOptions)):Tg(e,lpe(this))}};_([ti(dR)],V_.prototype,"dateFormat",void 0),_([S({type:Object,json:{read:!1}})],V_.prototype,"dateTimeFormatOptions",void 0),_([S({type:Boolean,json:{write:!0}})],V_.prototype,"digitSeparator",void 0),_([S({type:us,json:{write:!0}})],V_.prototype,"places",void 0),V_=cB=_([re("esri.popup.support.FieldInfoFormat")],V_);const dM=V_;var hB;let Fd=hB=class extends Ye{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new hB({fieldName:this.fieldName,format:this.format?Fe(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};_([S({type:String,json:{write:!0}})],Fd.prototype,"fieldName",void 0),_([S({type:dM,json:{write:!0}})],Fd.prototype,"format",void 0),_([S({type:Boolean,json:{write:!0,default:!1}})],Fd.prototype,"isEditable",void 0),_([S({type:String,json:{write:!0}})],Fd.prototype,"label",void 0),_([ti(new Ui({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Fd.prototype,"stringFieldOption",void 0),_([S({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Fd.prototype,"statisticType",void 0),_([S({type:String,json:{write:!0}})],Fd.prototype,"tooltip",void 0),_([S({type:Boolean,json:{write:!0}})],Fd.prototype,"visible",void 0),Fd=hB=_([re("esri.popup.FieldInfo")],Fd);const FO=Fd;var uB;let lm=uB=class extends Ew{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new uB(Fe({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};_([S({type:Object,json:{write:!0}})],lm.prototype,"attributes",void 0),_([S({type:String,json:{write:!0}})],lm.prototype,"description",void 0),_([S({type:[FO]})],lm.prototype,"fieldInfos",void 0),_([Et("fieldInfos")],lm.prototype,"writeFieldInfos",null),_([S({type:String,json:{write:!0}})],lm.prototype,"title",void 0),_([S({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],lm.prototype,"type",void 0),lm=uB=_([re("esri.popup.content.FieldsContent")],lm);const oS=lm;let G_=class extends Ye{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};_([S({type:String,json:{write:!0}})],G_.prototype,"altText",void 0),_([S({type:String,json:{write:!0}})],G_.prototype,"caption",void 0),_([S({type:String,json:{write:!0}})],G_.prototype,"title",void 0),_([S({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],G_.prototype,"type",void 0),G_=_([re("esri.popup.content.mixins.MediaInfo")],G_);const XW=G_;var dB;let KA=dB=class extends st{constructor(e){super(e),this.tooltip=null,this.value=null}clone(){return new dB({tooltip:this.tooltip,value:this.value})}};_([S()],KA.prototype,"tooltip",void 0),_([S()],KA.prototype,"value",void 0),KA=dB=_([re("esri.popup.content.support.ChartMediaInfoValueSeries")],KA);const Hfe=KA;var pB;let j_=pB=class extends Ye{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new pB({fields:Fe(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};_([S({type:[String],json:{write:!0}})],j_.prototype,"fields",void 0),_([S({type:String,json:{write:!0}})],j_.prototype,"normalizeField",void 0),_([S({type:[Hfe],json:{read:!1}})],j_.prototype,"series",void 0),_([S({type:String,json:{write:!0}})],j_.prototype,"tooltipField",void 0),j_=pB=_([re("esri.popup.content.support.ChartMediaInfoValue")],j_);const F$e=j_;let QA=class extends XW{constructor(e){super(e),this.type=null,this.value=null}};_([S({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],QA.prototype,"type",void 0),_([S({type:F$e,json:{write:!0}})],QA.prototype,"value",void 0),QA=_([re("esri.popup.content.mixins.ChartMediaInfo")],QA);const DL=QA,LL=Va()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var fB;let ZI=fB=class extends DL{constructor(e){super(e),this.type="bar-chart"}clone(){return new fB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([S({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:LL.write}})],ZI.prototype,"type",void 0),ZI=fB=_([re("esri.popup.content.BarChartMediaInfo")],ZI);const qfe=ZI;var mB;let KI=mB=class extends DL{constructor(e){super(e),this.type="column-chart"}clone(){return new mB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([S({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:LL.write}})],KI.prototype,"type",void 0),KI=mB=_([re("esri.popup.content.ColumnChartMediaInfo")],KI);const Wfe=KI;var gB;let eC=gB=class extends Ye{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new gB({linkURL:this.linkURL,sourceURL:this.sourceURL})}};_([S({type:String,json:{write:!0}})],eC.prototype,"linkURL",void 0),_([S({type:String,json:{write:!0}})],eC.prototype,"sourceURL",void 0),eC=gB=_([re("esri.popup.content.support.ImageMediaInfoValue")],eC);const k$e=eC;var yB;let Wx=yB=class extends XW{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new yB({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};_([S({type:Number,json:{write:!0}})],Wx.prototype,"refreshInterval",void 0),_([S({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Wx.prototype,"type",void 0),_([S({type:k$e,json:{write:!0}})],Wx.prototype,"value",void 0),Wx=yB=_([re("esri.popup.content.ImageMediaInfo")],Wx);const Xfe=Wx;var vB;let QI=vB=class extends DL{constructor(e){super(e),this.type="line-chart"}clone(){return new vB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([S({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:LL.write}})],QI.prototype,"type",void 0),QI=vB=_([re("esri.popup.content.LineChartMediaInfo")],QI);const Yfe=QI;var _B;let e9=_B=class extends DL{constructor(e){super(e),this.type="pie-chart"}clone(){return new _B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([S({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:LL.write}})],e9.prototype,"type",void 0),e9=_B=_([re("esri.popup.content.PieChartMediaInfo")],e9);const Jfe=e9,Zfe={base:XW,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":qfe,"column-chart":Wfe,"line-chart":Yfe,"pie-chart":Jfe,image:Xfe}};var bB;let kd=bB=class extends Ew{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?Xfe.fromJSON(t):t.type==="barchart"?qfe.fromJSON(t):t.type==="columnchart"?Wfe.fromJSON(t):t.type==="linechart"?Yfe.fromJSON(t):t.type==="piechart"?Jfe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new bB(Fe({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};_([S()],kd.prototype,"activeMediaInfoIndex",void 0),_([S({type:Object,json:{write:!0}})],kd.prototype,"attributes",void 0),_([S({type:String,json:{write:!0}})],kd.prototype,"description",void 0),_([S({types:[Zfe]})],kd.prototype,"mediaInfos",void 0),_([wt("mediaInfos")],kd.prototype,"readMediaInfos",null),_([Et("mediaInfos")],kd.prototype,"writeMediaInfos",null),_([S({type:String,json:{write:!0}})],kd.prototype,"title",void 0),_([S({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],kd.prototype,"type",void 0),kd=bB=_([re("esri.popup.content.MediaContent")],kd);const pR=kd;var wB;let tC=wB=class extends Ew{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new wB({text:this.text})}};_([S({type:String,json:{write:!0}})],tC.prototype,"text",void 0),_([S({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],tC.prototype,"type",void 0),tC=wB=_([re("esri.popup.content.TextContent")],tC);const aS=tC,U$e={base:null,key:"type",typeMap:{attachment:uR,media:pR,text:aS,expression:WW,field:oS}};var xB;let H_=xB=class extends Ye{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new xB({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};_([S({type:String,json:{write:!0}})],H_.prototype,"name",void 0),_([S({type:String,json:{write:!0}})],H_.prototype,"title",void 0),_([S({type:String,json:{write:!0}})],H_.prototype,"expression",void 0),_([S({type:["string","number"],json:{write:!0}})],H_.prototype,"returnType",void 0),H_=xB=_([re("esri.popup.ExpressionInfo")],H_);const Kfe=H_;var TB;let iC=TB=class extends Ye{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new TB({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};_([S({type:Boolean,json:{write:!0}})],iC.prototype,"returnTopmostRaster",void 0),_([S({type:Boolean,json:{write:!0}})],iC.prototype,"showNoDataRecords",void 0),iC=TB=_([re("esri.popup.LayerOptions")],iC);const z$e=iC;var SB;let rC=SB=class extends Ye{constructor(e){super(e),this.field=null,this.order=null}clone(){return new SB({field:this.field,order:this.order})}};_([S({type:String,json:{write:!0}})],rC.prototype,"field",void 0),_([S({type:["asc","desc"],json:{write:!0}})],rC.prototype,"order",void 0),rC=SB=_([re("esri.popup.support.RelatedRecordsInfoFieldOrder")],rC);const Qfe=rC;var EB;let sC=EB=class extends Ye{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new EB({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Fe(this.orderByFields):null})}};_([S({type:Boolean,json:{write:!0}})],sC.prototype,"showRelatedRecords",void 0),_([S({type:[Qfe],json:{write:!0}})],sC.prototype,"orderByFields",void 0),sC=EB=_([re("esri.popup.RelatedRecordsInfo")],sC);const B$e=sC;let V$e=0;const NL=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+V$e++})}};return t=_([re("esri.core.Identifiable")],t),t};let rte=class extends NL(class{}){};rte=_([re("esri.core.Identifiable")],rte);var AB;let Ud=AB=class extends NL(st){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new AB({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};_([S()],Ud.prototype,"active",void 0),_([S()],Ud.prototype,"className",void 0),_([S()],Ud.prototype,"disabled",void 0),_([S()],Ud.prototype,"id",void 0),_([S()],Ud.prototype,"indicator",void 0),_([S()],Ud.prototype,"title",void 0),_([S()],Ud.prototype,"type",void 0),_([S()],Ud.prototype,"visible",void 0),Ud=AB=_([re("esri.support.actions.ActionBase")],Ud);const FL=Ud;var CB;let t9=CB=class extends FL{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new CB({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};_([S()],t9.prototype,"image",void 0),t9=CB=_([re("esri.support.Action.ActionButton")],t9);const cE=t9;var MB;let nC=MB=class extends FL{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new MB({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};_([S()],nC.prototype,"image",void 0),_([S()],nC.prototype,"value",void 0),nC=MB=_([re("esri.support.Action.ActionToggle")],nC);const e0e=nC;var RB;const G$e=kt.ofType({key:"type",defaultKeyValue:"button",base:FL,typeMap:{button:cE,toggle:e0e}}),j$e={base:Ew,key:"type",typeMap:{media:pR,custom:N$e,text:aS,attachments:uR,fields:oS,expression:WW}},t0e="esri.PopupTemplate",H$e=Ge.getLogger(t0e),q$e=["attachments","fields","media","text","expression"];let ao=RB=class extends Ye{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>Dp(j$e,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||au(e)?e:(H$e.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>q$e.indexOf(s.type)!==-1).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const a=n?n.filter(p=>p.type==="fields"):[],l=a.length&&a.every(p=>{var y;return(y=p.fieldInfos)==null?void 0:y.length});t.fieldInfos=e.filter(Boolean).map(p=>{const y=p.toJSON(r);return l&&(y.visible=!1),y})}if(n)for(const a of n)a.type==="fields"&&this._writeFieldsContent(a,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?Fe(e.toArray()):[];return new RB({actions:t,content:Array.isArray(this.content)?Fe(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?Fe(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?Fe(this.fieldInfos):null,layerOptions:this.layerOptions?Fe(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?Fe(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?Fe(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),hR(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=Fe(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=Fe(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),pR.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),aS.fromJSON(s)):s.type==="attachments"?uR.fromJSON(s):s.type==="fields"?oS.fromJSON(s):s.type==="expression"?WW.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new aS({text:e})):r.push(new oS),Array.isArray(t)&&t.length&&r.push(pR.fromJSON({mediaInfos:t})),i&&r.push(uR.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:a,tooltipField:l,sourceURL:p,linkURL:y}=s,b=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(p),...this._extractFieldNames(y),...n];return a&&b.push(a),l&&b.push(l),b}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>eu(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>t.indexOf("relationships/")===-1&&t.indexOf("expression/")===-1):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};_([S({type:G$e})],ao.prototype,"actions",void 0),_([S()],ao.prototype,"content",void 0),_([_i("content")],ao.prototype,"castContent",null),_([wt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],ao.prototype,"readContent",null),_([Et("content",{popupElements:{type:kt.ofType(U$e)},showAttachments:{type:Boolean},mediaInfos:{type:kt.ofType(Zfe)},description:{type:String}})],ao.prototype,"writeContent",null),_([S({type:[Kfe],json:{write:!0}})],ao.prototype,"expressionInfos",void 0),_([S({type:[FO]})],ao.prototype,"fieldInfos",void 0),_([Et("fieldInfos")],ao.prototype,"writeFieldInfos",null),_([S({type:z$e})],ao.prototype,"layerOptions",void 0),_([Et("layerOptions")],ao.prototype,"writeLayerOptions",null),_([S({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ao.prototype,"lastEditInfoEnabled",void 0),_([S()],ao.prototype,"outFields",void 0),_([S()],ao.prototype,"overwriteActions",void 0),_([S()],ao.prototype,"returnGeometry",void 0),_([S({json:{type:String}})],ao.prototype,"title",void 0),_([Et("title")],ao.prototype,"writeTitle",null),_([S({type:B$e,json:{write:!0}})],ao.prototype,"relatedRecordsInfo",void 0),ao=RB=_([re(t0e)],ao);const kL=ao,ste=new Ui({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let W$e=0,Xx=class extends Ye{constructor(e){super(e),this.id="sym"+W$e++,this.type=null,this.color=new Ft([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};_([S({type:ste.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:ste.write}}})],Xx.prototype,"type",void 0),_([S({type:Ft,json:{write:{allowNull:!0}}})],Xx.prototype,"color",void 0),_([wt("color")],Xx.prototype,"readColor",null),Xx=_([re("esri.symbols.Symbol")],Xx);const hc=Xx;var OB;let z1=OB=class extends hc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return eu(e,t,n.expression)});await Promise.all(r)}}}clone(){return new OB({data:Fe(this.data)})}hash(){return Lq(JSON.stringify(this.data)).toString()}};_([S({json:{write:!1}})],z1.prototype,"color",void 0),_([S({json:{write:!0}})],z1.prototype,"data",void 0),_([wt("data",["symbol"])],z1.prototype,"readData",null),_([Et("data",{})],z1.prototype,"writeData",null),_([ti({CIMSymbolReference:"cim"},{readOnly:!0})],z1.prototype,"type",void 0),z1=OB=_([re("esri.symbols.CIMSymbol")],z1);const hE=z1;let Yx=class extends Ye{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};_([S({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Yx.prototype,"enabled",void 0),_([Et("enabled")],Yx.prototype,"writeEnabled",null),_([S({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Yx.prototype,"type",void 0),Yx=_([re("esri.symbols.Symbol3DLayer")],Yx);const A0=Yx,X$e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Y$e="screenUtils.toPt: input not recognized!",i0e=96;function La(e){return e?e/72*i0e:0}function Fp(e){return e?72*e/i0e:0}function Wr(e){if(typeof e=="string"){const t=e.match(X$e);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Fp(i):i;return s?-n:n}return console.warn(Y$e),null}return e}function dd(e=0,t=0){return{x:e,y:t}}function Ns(e=0,t=0){return[e,t]}function J$e(e=0,t=0){return[e,t]}function ca(e=0,t=0,i=0){return[e,t,i]}function h3t(e){return e}function u3t(e){return e}function Ym(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function UL(e){const t=iW(100*(1-e));return Math.max(0,Math.min(t,100))}function lS(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function Z$e(e,t){const i=t.transparency!=null?lS(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new Ft([r[0]||0,r[1]||0,r[2]||0,i]):null}function K$e(e,t){t.color=e.toJSON().slice(0,3);const i=UL(e.a);i!==0&&(t.transparency=i)}const Ug={type:Ft,json:{type:[us],default:null,read:{source:["color","transparency"],reader:Z$e},write:{target:{color:{type:[us]},transparency:{type:us}},writer:K$e}}},h0={type:Number,cast:Wr,json:{write:!0}};let q_=class extends Ye{constructor(e){super(e),this.color=new Ft([0,0,0,1]),this.extensionLength=0,this.size=Fp(1)}clone(){}cloneProperties(){return{color:Fe(this.color),size:this.size,extensionLength:this.extensionLength}}};_([S({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],q_.prototype,"type",void 0),_([S(Ug)],q_.prototype,"color",void 0),_([S(qe(ie({},h0),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],q_.prototype,"extensionLength",void 0),_([S(h0)],q_.prototype,"size",void 0),q_=_([re("esri.symbols.edges.Edges3D")],q_);const YW=q_;var PB;let i9=PB=class extends YW{constructor(e){super(e),this.type="sketch"}clone(){return new PB(this.cloneProperties())}};_([ti({sketch:"sketch"},{readOnly:!0})],i9.prototype,"type",void 0),i9=PB=_([re("esri.symbols.edges.SketchEdges3D")],i9);const Q$e=i9;var IB;let r9=IB=class extends YW{constructor(e){super(e),this.type="solid"}clone(){return new IB(this.cloneProperties())}};_([ti({solid:"solid"},{readOnly:!0})],r9.prototype,"type",void 0),r9=IB=_([re("esri.symbols.support.SolidEdges3D")],r9);const e6e=r9,r0e={types:{key:"type",base:YW,typeMap:{solid:e6e,sketch:Q$e}},json:{write:!0}};var $B;let Yh=$B=class extends Ye{constructor(e){super(e),this.color=null}clone(){const e={color:L(this.color)?this.color.clone():null};return new $B(e)}};_([S(Ug)],Yh.prototype,"color",void 0),Yh=$B=_([re("esri.symbols.support.Symbol3DMaterial")],Yh);var DB;let B1=DB=class extends A0{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new DB({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:L(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};_([ti({Extrude:"extrude"},{readOnly:!0})],B1.prototype,"type",void 0),_([S({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],B1.prototype,"size",void 0),_([S({type:Yh,json:{write:!0}})],B1.prototype,"material",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],B1.prototype,"castShadows",void 0),_([S(r0e)],B1.prototype,"edges",void 0),B1=DB=_([re("esri.symbols.ExtrudeSymbol3DLayer")],B1);const JW=B1;let oC=class extends hc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};_([ti({esriSLS:"simple-line"},{readOnly:!0})],oC.prototype,"type",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],oC.prototype,"width",void 0),oC=_([re("esri.symbols.LineSymbol")],oC);const t6e=oC,i6e=["begin","end","begin-end"],s0e=["arrow","circle","square","diamond","cross","x"];var LB;let _f=LB=class extends Ye{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){(r==null?void 0:r.origin)==="web-map"?t[i]="arrow":t[i]=e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new LB({color:Fe(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};_([S({type:["begin","end","begin-end"],json:{write:!0}})],_f.prototype,"placement",void 0),_([ti({"line-marker":"line-marker"},{readOnly:!0}),S({json:{origins:{"web-map":{write:!1}}}})],_f.prototype,"type",void 0),_([S({type:s0e})],_f.prototype,"style",void 0),_([Et("style")],_f.prototype,"writeStyle",null),_([S({type:Ft,value:null,json:{write:{allowNull:!0}}})],_f.prototype,"color",null),_([wt("color")],_f.prototype,"readColor",null),_([Et("color")],_f.prototype,"writeColor",null),_f=LB=_([re("esri.symbols.LineSymbolMarker")],_f);const r6e=_f;var NB;const UF=new Ui({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let cm=NB=class extends t6e{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const a={};return e!=null&&(a.style=e),t!=null&&(a.color=t),i!=null&&(a.width=Wr(i)),r!=null&&(a.cap=r),s!=null&&(a.join=s),n!=null&&(a.miterLimit=Wr(n)),a}clone(){var e;return new NB({color:Fe(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};_([ti({esriSLS:"simple-line"},{readOnly:!0})],cm.prototype,"type",void 0),_([S({type:UF.apiValues,json:{read:UF.read,write:UF.write}})],cm.prototype,"style",void 0),_([S({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],cm.prototype,"cap",void 0),_([S({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],cm.prototype,"join",void 0),_([S({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":r6e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],cm.prototype,"marker",void 0),_([S({type:Number,json:{read:!1,write:!1}})],cm.prototype,"miterLimit",void 0),cm=NB=_([re("esri.symbols.SimpleLineSymbol")],cm);const tu=cm;let aC=class extends hc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};_([S({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":tu}},json:{default:null,write:!0}})],aC.prototype,"outline",void 0),_([S({type:["simple-fill","picture-fill"],readOnly:!0})],aC.prototype,"type",void 0),aC=_([re("esri.symbols.FillSymbol")],aC);const n0e=aC;let s9=class extends Ye{constructor(e){super(e)}clone(){}};_([S({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],s9.prototype,"type",void 0),s9=_([re("esri.symbols.patterns.LinePattern3D")],s9);const o0e=s9,s6e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var FB;const n6e=Va()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let lC=FB=class extends o0e{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new FB(e)}};_([S({type:["style"]})],lC.prototype,"type",void 0),_([ti(n6e),S({type:s6e})],lC.prototype,"style",void 0),lC=FB=_([re("esri.symbols.patterns.LineStylePattern3D")],lC);const ZW=lC;let n9=class extends Ye{constructor(e){super(e)}clone(){}};_([S({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],n9.prototype,"type",void 0),n9=_([re("esri.symbols.patterns.Pattern3D")],n9);const a0e=n9,o6e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var kB;let cC=kB=class extends a0e{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new kB(e)}};_([S({type:["style"]})],cC.prototype,"type",void 0),_([S({type:o6e,json:{read:!0,write:!0}})],cC.prototype,"style",void 0),cC=kB=_([re("esri.symbols.patterns.StylePattern3D")],cC);const l0e=cC,a6e={types:{key:"type",base:a0e,typeMap:{style:l0e}},json:{write:!0}},c0e={types:{key:"type",base:o0e,typeMap:{style:ZW}},json:{write:!0}},pM=new Ft("white");new Ft("black");const l6e=new Ft([255,255,255,0]);function c6e(e){return e.r===0&&e.g===0&&e.b===0}var UB;let fM=UB=class extends Yh{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:L(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new UB(e)}};_([ti({multiply:"multiply",replace:"replace",tint:"tint"})],fM.prototype,"colorMixMode",void 0),fM=UB=_([re("esri.symbols.support.Symbol3DFillMaterial")],fM);function Mi(e=m6e){return[e[0],e[1],e[2],e[3]]}function d3t(e){return[e[0],e[1],e[2],e[3]]}function bv(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function h6e(e,t,i,r,s=Mi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function h0e(e,t=Mi()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function zL(e,t){return new ki({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function u0e(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function lv(e,t,i){if(J(t))bv(i,e);else if("length"in t)BB(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function zF(e,t,i=e){const r=t.length;let s=e[0],n=e[1],a=e[2],l=e[3];for(let p=0;p<r;p++){const y=t[p];s=Math.min(s,y[0]),n=Math.min(n,y[1]),a=Math.max(a,y[0]),l=Math.max(l,y[1])}return i[0]=s,i[1]=n,i[2]=a,i[3]=l,i}function zB(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Jm(e){return J(e)||e[0]>=e[2]?0:e[2]-e[0]}function H2(e){return e[1]>=e[3]?0:e[3]-e[1]}function p3t(e){return Jm(e)*H2(e)}function KW(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function QW(e,t){return d0e(e,t[0],t[1])}function u6e(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const a=.5*(e[1]+e[3]),l=.5*(e[3]-e[1]),p=Math.abs(t[1]-a);if(p>i+l)return!1;if(s<n||p<l)return!0;const y=s-n,b=p-l;return y*y+b*b<=i*i}function f3t(e,t,i){const r=e[0],s=e[1],n=e[2],a=e[3],{x:l,y:p}=t,{x:y,y:b}=i,x=(k,z)=>(b-p)*k+(l-y)*z+(y*p-l*b)<0,A=x(r,a),M=x(n,a),P=x(n,s),$=x(r,s);return!(A===M&&M===P&&P===$&&$===A||l<r&&y<r||l>n&&y>n||p>a&&b>a||p<s&&b<s)}function m3t(e,t){return d0e(e,t.x,t.y)}function d0e(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function d6e(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function BL(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function nte(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function o9(e,t,i){if(J(t))return bv(i,e);const r=t[0],s=t[1],n=t[2],a=t[3];return i[0]=Ot(e[0],r,n),i[1]=Ot(e[1],s,a),i[2]=Ot(e[2],r,n),i[3]=Ot(e[3],s,a),i}function p6e(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-Jm(e)/2,0),n=Math.max(Math.abs(t[1]-r)-H2(e)/2,0);return Math.sqrt(s*s+n*n)}function M6(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function pd(e){return e?bv(e,ote):Mi(ote)}function BB(e){return e!=null&&e.length===4}function f6e(e){return!(Jm(e)!==0&&isFinite(e[0])||H2(e)!==0&&isFinite(e[1]))}function w2(e,t){return BB(e)&&BB(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const g3t=[-1/0,-1/0,1/0,1/0],ote=[1/0,1/0,-1/0,-1/0],m6e=[0,0,0,0];function On(e=g0e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function q2(e,t,i,r,s,n,a=On()){return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function cS(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function g6e(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function u0(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Hh(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],a=e[2],l=e[3],p=e[4],y=e[5];for(let b=0;b<r;b++)s=Math.min(s,t[i+3*b]),n=Math.min(n,t[i+3*b+1]),a=Math.min(a,t[i+3*b+2]),l=Math.max(l,t[i+3*b]),p=Math.max(p,t[i+3*b+1]),y=Math.max(y,t[i+3*b+2]);e[0]=s,e[1]=n,e[2]=a,e[3]=l,e[4]=p,e[5]=y}function y6e(e,t,i,r){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+i),e[4]=Math.max(e[4],e[4]+i),e[2]=Math.min(e[2],e[2]+r),e[5]=Math.max(e[5],e[5]+r)}function BF(e,t,i){const r=t.length;let s=e[0],n=e[1],a=e[2],l=e[3],p=e[4],y=e[5];if(i)for(let b=0;b<r;b++){const x=t[b];s=Math.min(s,x[0]),n=Math.min(n,x[1]),a=Math.min(a,x[2]),l=Math.max(l,x[0]),p=Math.max(p,x[1]),y=Math.max(y,x[2])}else for(let b=0;b<r;b++){const x=t[b];s=Math.min(s,x[0]),n=Math.min(n,x[1]),l=Math.max(l,x[0]),p=Math.max(p,x[1])}e[0]=s,e[1]=n,e[2]=a,e[3]=l,e[4]=p,e[5]=y}function v6e(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function Aw(e){return e[0]>=e[3]?0:e[3]-e[0]}function Cw(e){return e[1]>=e[4]?0:e[4]-e[1]}function Gv(e){return e[2]>=e[5]?0:e[5]-e[2]}function _6e(e){const t=Aw(e),i=Gv(e),r=Cw(e);return Math.sqrt(t*t+i*i+r*r)}function yp(e,t=[0,0,0]){return t[0]=e[0]+Aw(e)/2,t[1]=e[1]+Cw(e)/2,t[2]=e[2]+Gv(e)/2,t}function e5(e,t=[0,0,0]){return t[0]=Aw(e),t[1]=Cw(e),t[2]=Gv(e),t}function b6e(e){return Math.max(Aw(e),Gv(e),Cw(e))}function eX(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function y3t(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function w6e(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function vp(e,t){return!!J(t)||w6e(e,t)}function p0e(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function v3t(e,t,i=e){const r=e[0]+Aw(e)/2,s=e[1]+Cw(e)/2,n=e[2]+Gv(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function _3t(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function f0e(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function m0e(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function VL(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function jr(e){return e?VL(e,lte):On(lte)}function tX(e,t){return t||(t=Mi()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function b3t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function ate(e){return e.length===6}function GL(e){return Aw(e)===0&&Cw(e)===0&&Gv(e)===0}function w3t(e,t,i){if(J(e)||J(t))return e===t;if(!ate(e)||!ate(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function x6e(e,t,i,r,s,n){return q2(e,t,i,r,s,n,T6e)}const x3t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],lte=[1/0,1/0,1/0,-1/0,-1/0,-1/0],g0e=[0,0,0,0,0,0],T6e=On();function VF(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const a=$t(i,r,s);let l;for(let p=0;p<3;p++){const y=a[p];if(y!=null){l=y/e[p];break}}for(let p=0;p<3;p++)a[p]==null&&(a[p]=e[p]*l);return a}const S6e=q2(-.5,-.5,-.5,.5,.5,.5),E6e=q2(-.5,-.5,0,.5,.5,1),A6e=q2(-.5,-.5,0,.5,.5,.5);function C6e(e){switch(e){case"sphere":case"cube":case"diamond":return S6e;case"cylinder":case"cone":case"inverted-cone":return E6e;case"tetrahedron":return A6e;default:return}}const iX=["butt","square","round"],M6e=[...iX,"none"],y0e=["miter","bevel","round"];var VB;let W_=VB=class extends Ye{constructor(e){super(e),this.color=new Ft([0,0,0,1]),this.size=Fp(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:L(this.color)?this.color.clone():null,size:this.size,pattern:L(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new VB(e)}};_([S(Ug)],W_.prototype,"color",void 0),_([S(h0)],W_.prototype,"size",void 0),_([S(c0e)],W_.prototype,"pattern",void 0),_([S({type:iX,json:{default:"butt",write:{overridePolicy(){return{enabled:L(this.pattern)}}}}})],W_.prototype,"patternCap",void 0),W_=VB=_([re("esri.symbols.support.Symbol3DOutline")],W_);var a9;let hm=a9=class extends A0{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:L(this.edges)?this.edges.clone():null,enabled:this.enabled,material:L(this.material)?this.material.clone():null,pattern:L(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:L(this.outline)?this.outline.clone():null};return new a9(e)}static fromSimpleFillSymbol(e){var t,i,r,s,n,a;const l=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new ZW({style:e.outline.style}):null,p={size:(t=(i=e.outline)==null?void 0:i.width)!=null?t:0,color:((r=(s=e.outline)==null?void 0:s.color)!=null?r:pM).clone(),pattern:l};return l&&(n=e.outline)!=null&&n.cap&&(p.patternCap=e.outline.cap),new a9({material:new fM({color:((a=e.color)!=null?a:l6e).clone()}),pattern:e.style&&e.style!=="solid"?new l0e({style:e.style}):null,outline:p})}};_([ti({Fill:"fill"},{readOnly:!0})],hm.prototype,"type",void 0),_([S({type:fM,json:{write:!0}})],hm.prototype,"material",void 0),_([S(a6e)],hm.prototype,"pattern",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],hm.prototype,"castShadows",void 0),_([S({type:W_,json:{write:!0}})],hm.prototype,"outline",void 0),_([S(r0e)],hm.prototype,"edges",void 0),hm=a9=_([re("esri.symbols.FillSymbol3DLayer")],hm);const kO=hm,R6e=["none","underline","line-through"],O6e=["normal","italic","oblique"],P6e=["normal","lighter","bold","bolder"],v0e={type:Number,cast:e=>{const t=Xu(e);return t===0?1:Ot(t,.1,4)},nonNullable:!0},I6e=["left","right","center","justify"],$6e=["left","right","center"],D6e=["baseline","top","middle","bottom"],L6e={type:I6e,nonNullable:!0},N6e={type:$6e,nonNullable:!0},_0e={type:D6e,nonNullable:!0};var GB;let um=GB=class extends Ye{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Wr(e)}clone(){return new GB({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};_([S({type:R6e,json:{default:"none",write:!0}})],um.prototype,"decoration",void 0),_([S({type:String,json:{write:!0}})],um.prototype,"family",void 0),_([S({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],um.prototype,"size",void 0),_([_i("size")],um.prototype,"castSize",null),_([S({type:O6e,json:{default:"normal",write:!0}})],um.prototype,"style",void 0),_([S({type:P6e,json:{default:"normal",write:!0}})],um.prototype,"weight",void 0),um=GB=_([re("esri.symbols.Font")],um);const jL=um;function uE(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=nd(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=gW(e,t.portalItem.itemUrl);k6e.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return jB(e,t&&t.portal)}function W2(e,t,i=fR.YES){if(!e)return e;!Xh(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=nd(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=jB(s,t.portal);r=gW(jB(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=z6e(r,t&&t.portal),Xh(r)&&(r=cd(r)),t!=null&&t.resources&&t!=null&&t.portalItem&&!Xh(r)&&!x0(r)&&i===fR.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function rX(e,t,i){return uE(e,i)}function wv(e,t,i,r){const s=W2(e,r);s!==void 0&&(t[i]=s)}const F6e=/\/items\/([^\/]+)\/resources\//,k6e=/^\.\/resources\//;function U6e(e){const t=L(e)?e.match(F6e):null;return L(t)?t[1]:null}function z6e(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Gz(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function jB(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=fpe();return p6(r,`${r.scheme}://${i}`)?Gz(e,t.portalHostname,i):Gz(e,i,t.portalHostname)}var fR;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(fR||(fR={}));const T3t=Object.freeze({__proto__:null,fromJSON:uE,toJSON:W2,read:rX,write:wv,itemIdFromResourceUrl:U6e,get MarkKeep(){return fR}});var HB;const B6e=Va()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let X_=HB=class extends Ye{constructor(e){super(e)}readHref(e,t,i){return e?uE(e,i):t.dataURI}writeHref(e,t,i,r){e&&(x0(e)?t.dataURI=e:(t.href=W2(e,r),Xh(t.href)&&(t.href=cd(t.href))))}clone(){return new HB({href:this.href,primitive:this.primitive})}};_([S({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],X_.prototype,"href",void 0),_([wt("href")],X_.prototype,"readHref",null),_([Et("href",{href:{type:String},dataURI:{type:String}})],X_.prototype,"writeHref",null),_([ti(B6e)],X_.prototype,"primitive",void 0),X_=HB=_([re("esri.symbols.support.IconSymbol3DLayerResource")],X_);const V6e="circle";var qB;let W3=qB=class extends st{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new qB({x:this.x,y:this.y})}};_([S({type:Number})],W3.prototype,"x",void 0),_([S({type:Number})],W3.prototype,"y",void 0),W3=qB=_([re("esri.symbols.support.Symbol3DAnchorPosition2D")],W3);var WB;let hC=WB=class extends Ye{constructor(e){super(e),this.color=new Ft([0,0,0,1]),this.size=Fp(1)}clone(){const e={color:L(this.color)?this.color.clone():null,size:this.size};return new WB(e)}};_([S(Ug)],hC.prototype,"color",void 0),_([S(h0)],hC.prototype,"size",void 0),hC=WB=_([re("esri.symbols.support.Symbol3DIconOutline")],hC);var Jx;const G6e=Ge.getLogger("esri.symbols.IconSymbol3DLayer");let bf=Jx=class extends A0{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new Jx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:L(this.material)?this.material.clone():null,outline:L(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||pM,i=cte(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||pM).clone()}:null;return new Jx({size:e.size,resource:{primitive:H6e(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||c6e(e.color)?pM:e.color,i=cte(e);return new Jx({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new Jx({resource:{href:bpe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function cte(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=hte(e.xoffset),s=hte(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function hte(e){return isFinite(e)?e:0}_([S({type:Yh,json:{write:!0}})],bf.prototype,"material",void 0),_([S({type:X_,json:{write:!0}})],bf.prototype,"resource",void 0),_([ti({Icon:"icon"},{readOnly:!0})],bf.prototype,"type",void 0),_([S(h0)],bf.prototype,"size",void 0),_([ti({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),S({json:{default:"center"}})],bf.prototype,"anchor",void 0),_([S({type:W3,json:{type:[Number],read:{reader:e=>new W3({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],bf.prototype,"anchorPosition",void 0),_([S({type:hC,json:{write:!0}})],bf.prototype,"outline",void 0),bf=Jx=_([re("esri.symbols.IconSymbol3DLayer")],bf);const j6e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function H6e(e){return j6e[e]||(G6e.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const tg=bf;function Eg(e,t,i=kt){return t||(t=new i),t===e||(t.removeAll(),q6e(e)?t.addMany(e):e&&t.add(e)),t}function sX(e){return e}function q6e(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const W6e="not-loaded",X6e="loading",Y6e="failed",ute="loaded",b0e=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const a=new Promise((l,p)=>{const y=TO(n,p);this.destroyed&&p(new Se("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(l,p).finally(()=>{y&&y.remove()})});if(this.loadStatus===W6e){this._set("loadStatus",X6e);const l=this._loadController=new AbortController;s({signal:l.signal}),ka(l.signal,()=>{this._promiseProps.abort()})}return r(),a}})),this.when(()=>{this._set("loadStatus",ute),this._loadController=null},r=>{this._set("loadStatus",Y6e),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===ute}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new Se("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return _([S({readOnly:!0})],t.prototype,"loaded",null),_([S({readOnly:!0})],t.prototype,"loadError",void 0),_([S({clonable:!1})],t.prototype,"loadStatus",void 0),_([S({type:[Qh],readOnly:!0})],t.prototype,"loadWarnings",null),t=_([re("esri.core.Loadable")],t),t};let uC=class extends b0e(y6){};uC=_([re("esri.core.Loadable")],uC),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=b0e,e.isLoadable=t}(uC||(uC={}));const d0=uC;var XB;const J6e=new Ui({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Eu=XB=class extends st{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new XB({categories:this.categories?Fe(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(a=>Array.isArray(a)?JSON.stringify(a):a)),this.extent){const a=Tw(this.extent,It.WGS84);L(a)&&(r=`${a.xmin},${a.ymin},${a.xmax},${a.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(a=>J6e.toJSON(a.trim())).join(","),n.sortOrder=this.sortOrder),{query:ie(ie({},t),n)}}};_([S()],Eu.prototype,"categories",void 0),_([S()],Eu.prototype,"disableExtraQuery",void 0),_([S({type:ki})],Eu.prototype,"extent",void 0),_([S()],Eu.prototype,"filter",void 0),_([S()],Eu.prototype,"num",void 0),_([S()],Eu.prototype,"query",void 0),_([S()],Eu.prototype,"sortField",void 0),_([S()],Eu.prototype,"sortOrder",null),_([S()],Eu.prototype,"start",void 0),Eu=XB=_([re("esri.portal.PortalQueryParams")],Eu);const Zm=Eu;let Y_=class extends st{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};_([S()],Y_.prototype,"nextQueryParams",void 0),_([S()],Y_.prototype,"queryParams",void 0),_([S()],Y_.prototype,"results",void 0),_([S()],Y_.prototype,"total",void 0),Y_=_([re("esri.portal.PortalQueryResult")],Y_);const Z6e=Y_;let dm=class extends Ye{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Se("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};_([S({type:Date})],dm.prototype,"created",void 0),_([S()],dm.prototype,"id",void 0),_([S()],dm.prototype,"portal",void 0),_([S()],dm.prototype,"title",void 0),_([S({readOnly:!0})],dm.prototype,"url",null),_([S()],dm.prototype,"username",void 0),dm=_([re("esri.portal.PortalFolder")],dm);const K6e=dm;let Ro=class extends Ye{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new Se("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=Ys(Zm,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new Zm,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Zm,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new Zm;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new Se("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new Zm;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new Se("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};_([S()],Ro.prototype,"access",void 0),_([S({type:Date})],Ro.prototype,"created",void 0),_([S()],Ro.prototype,"description",void 0),_([S()],Ro.prototype,"id",void 0),_([S()],Ro.prototype,"isInvitationOnly",void 0),_([S({type:Date})],Ro.prototype,"modified",void 0),_([S()],Ro.prototype,"owner",void 0),_([S()],Ro.prototype,"portal",void 0),_([S()],Ro.prototype,"snippet",void 0),_([S()],Ro.prototype,"sortField",void 0),_([S()],Ro.prototype,"sortOrder",void 0),_([S()],Ro.prototype,"tags",void 0),_([S()],Ro.prototype,"thumbnail",void 0),_([S({readOnly:!0})],Ro.prototype,"thumbnailUrl",null),_([S()],Ro.prototype,"title",void 0),_([S({readOnly:!0})],Ro.prototype,"url",null),Ro=_([re("esri.portal.PortalGroup")],Ro);const YB=Ro;var Q6e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:YB}),JB;let Vs=JB=class extends Ye{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(a=>(t.id=a.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=K6e.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=YB.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return lve}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const a=t.fromJSON(n);return a.portal=this.portal,a}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new YB({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new Se("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new Se("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new JB;return t.sourceJSON=e,t.read(e),t}};_([S()],Vs.prototype,"access",void 0),_([S({type:Date})],Vs.prototype,"created",void 0),_([S()],Vs.prototype,"culture",void 0),_([S()],Vs.prototype,"description",void 0),_([S()],Vs.prototype,"email",void 0),_([S()],Vs.prototype,"favGroupId",void 0),_([S()],Vs.prototype,"fullName",void 0),_([S({type:Date})],Vs.prototype,"modified",void 0),_([S()],Vs.prototype,"orgId",void 0),_([S()],Vs.prototype,"portal",void 0),_([S()],Vs.prototype,"preferredView",void 0),_([S()],Vs.prototype,"privileges",void 0),_([S()],Vs.prototype,"region",void 0),_([S()],Vs.prototype,"role",void 0),_([S()],Vs.prototype,"roleId",void 0),_([S()],Vs.prototype,"sourceJSON",void 0),_([S()],Vs.prototype,"thumbnail",void 0),_([S({readOnly:!0})],Vs.prototype,"thumbnailUrl",null),_([S()],Vs.prototype,"units",void 0),_([S({readOnly:!0})],Vs.prototype,"userContentUrl",null),_([S({readOnly:!0})],Vs.prototype,"url",null),_([S()],Vs.prototype,"username",void 0),_([S()],Vs.prototype,"userType",void 0),Vs=JB=_([re("esri.portal.PortalUser")],Vs);const nX=Vs;var eDe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:nX}),vh;let GF;const dte={PortalGroup:()=>Promise.resolve().then(function(){return Q6e}),PortalItem:()=>Promise.resolve().then(function(){return lve}),PortalUser:()=>Promise.resolve().then(function(){return eDe})};let At=vh=class extends DO(d0){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=qr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)qr.request.trustedServers.indexOf(t)===-1&&qr.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get stylesGroupQuery(){return S5e(Ge.getLogger(this.declaredClass),"stylesGroupQuery",{replacement:"stylesGroupQuery3d",version:"4.21"}),this.stylesGroupQuery3d}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=nX.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return Qqe}).then(({default:i})=>{Gi(e),GF=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(jn){const r=jn;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==vh.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createClosestFacilityTask(){Vx(Ge.getLogger(this.declaredClass),null,{replacement:"Use helperServices url with esri/rest/closestFacility",version:"4.21"}),await this.load();const e=this._getHelperServiceUrl("closestFacility");return new(await import("./ClosestFacilityTask.a7120514.js")).default(e)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.a91980cf.js")).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}async createGeometryService(){Vx(Ge.getLogger(this.declaredClass),null,{replacement:"Use helperServices url with esri/rest/geometryService",version:"4.21"}),await this.load();const e=this._getHelperServiceUrl("geometry");return new(await import("./GeometryService.5916ef0d.js")).default({url:e})}async createPrintTask(){Vx(Ge.getLogger(this.declaredClass),null,{replacement:"Use helperServices url with esri/rest/print",version:"4.21"}),await this.load();const e=this._getHelperServiceUrl("printTask");return new(await import("./PrintTask.e4900206.js")).default(e)}async createRouteTask(){Vx(Ge.getLogger(this.declaredClass),null,{replacement:"Use helperServices url with esri/rest/route",version:"4.21"}),await this.load();const e=this._getHelperServiceUrl("route");return new(await import("./RouteTask.bfbadb14.js")).default(e)}async createServiceAreaTask(){Vx(Ge.getLogger(this.declaredClass),null,{replacement:"Use helperServices url with esri/rest/serviceArea",version:"4.21"}),await this.load();const e=this._getHelperServiceUrl("serviceArea");return new(await import("./ServiceAreaTask.801cab54.js")).default(e)}fetchBasemaps(e,t){const i=new Zm;return i.query=e||(qr.apiKey&&Epe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new GF({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):zn(e)?Promise.reject(rr()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Zm;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return zn(e)?Promise.reject(rr()):Promise.resolve([])}fetchRegions(e){var t;const i=((t=this.user)==null?void 0:t.culture)||this.culture||Wh();return this._request(this.restUrl+"/portals/regions",qe(ie({},e),{query:{culture:i}}))}fetchSettings(e){var t;const i=((t=this.user)==null?void 0:t.culture)||this.culture||Wh();return this._request(this.restUrl+"/portals/self/settings",qe(ie({},e),{query:{culture:i}}))}static getDefault(){return vh._default&&!vh._default.destroyed||(vh._default=new vh),vh._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new Se("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new vh({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new Se("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new Se("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=ie({authMode:e,query:{culture:Wh().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=Ys(Zm,t),n=a=>this._request(this.restUrl+e,ie(ie({},s.toRequestOptions(this)),r)).then(l=>{const p=s.clone();return p.start=l.nextStart,new Z6e({nextQueryParams:p,queryParams:s,total:l.total,results:vh._resultsToTypedArray(a,{portal:this},l,r)})}).then(l=>Promise.all(l.results.map(p=>typeof p.when=="function"?p.when():l)).then(()=>l,p=>(Fg(p),l)));return i&&dte[i]?dte[i]().then(({default:a})=>(Gi(r),n(a))):n()}_signIn(){if(this.authMode===vh.AUTH_MODE_ANONYMOUS)return Promise.reject(new Se("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return jn?jn.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.indexOf("?")>-1?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=vh._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=GF.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=ie({f:"json"},t.query),{authMode:r=this.authMode===vh.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:a="auto",responseType:l="json",signal:p}=t,y={authMode:r,body:s,cacheBust:n,method:a,query:i,responseType:l,timeout:0,signal:p};return Ar(this._normalizeSSL(e),y).then(b=>b.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=L(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(a=>{const l=Object.assign(e?e.fromJSON(a):a,t);return typeof l.load=="function"&&l.load(n),l}))}else s=[];return s}};At.AUTH_MODE_ANONYMOUS="anonymous",At.AUTH_MODE_AUTO="auto",At.AUTH_MODE_IMMEDIATE="immediate",_([S()],At.prototype,"access",void 0),_([S()],At.prototype,"allSSL",void 0),_([S()],At.prototype,"authMode",void 0),_([S()],At.prototype,"authorizedCrossOriginDomains",void 0),_([wt("authorizedCrossOriginDomains")],At.prototype,"readAuthorizedCrossOriginDomains",null),_([S()],At.prototype,"basemapGalleryGroupQuery",void 0),_([S()],At.prototype,"bingKey",void 0),_([S()],At.prototype,"canListApps",void 0),_([S()],At.prototype,"canListData",void 0),_([S()],At.prototype,"canListPreProvisionedItems",void 0),_([S()],At.prototype,"canProvisionDirectPurchase",void 0),_([S()],At.prototype,"canSearchPublic",void 0),_([S()],At.prototype,"canShareBingPublic",void 0),_([S()],At.prototype,"canSharePublic",void 0),_([S()],At.prototype,"canSignInArcGIS",void 0),_([S()],At.prototype,"canSignInIDP",void 0),_([S()],At.prototype,"colorSetsGroupQuery",void 0),_([S()],At.prototype,"commentsEnabled",void 0),_([S({type:Date})],At.prototype,"created",void 0),_([S()],At.prototype,"credential",void 0),_([S()],At.prototype,"culture",void 0),_([S()],At.prototype,"currentVersion",void 0),_([S()],At.prototype,"customBaseUrl",void 0),_([S()],At.prototype,"defaultBasemap",void 0),_([wt("defaultBasemap")],At.prototype,"readDefaultBasemap",null),_([S()],At.prototype,"defaultDevBasemap",void 0),_([wt("defaultDevBasemap")],At.prototype,"readDefaultDevBasemap",null),_([S({type:ki})],At.prototype,"defaultExtent",void 0),_([S()],At.prototype,"defaultVectorBasemap",void 0),_([wt("defaultVectorBasemap")],At.prototype,"readDefaultVectorBasemap",null),_([S()],At.prototype,"description",void 0),_([S()],At.prototype,"devBasemapGalleryGroupQuery",void 0),_([S()],At.prototype,"eueiEnabled",void 0),_([S({readOnly:!0})],At.prototype,"extraQuery",null),_([S()],At.prototype,"featuredGroups",void 0),_([S()],At.prototype,"featuredItemsGroupQuery",void 0),_([S()],At.prototype,"galleryTemplatesGroupQuery",void 0),_([S()],At.prototype,"livingAtlasGroupQuery",void 0),_([S()],At.prototype,"hasCategorySchema",void 0),_([S()],At.prototype,"helpBase",void 0),_([S()],At.prototype,"helperServices",void 0),_([S()],At.prototype,"helpMap",void 0),_([S()],At.prototype,"homePageFeaturedContent",void 0),_([S()],At.prototype,"homePageFeaturedContentCount",void 0),_([S()],At.prototype,"httpPort",void 0),_([S()],At.prototype,"httpsPort",void 0),_([S()],At.prototype,"id",void 0),_([S()],At.prototype,"ipCntryCode",void 0),_([S({readOnly:!0})],At.prototype,"isOrganization",null),_([S()],At.prototype,"isPortal",void 0),_([S()],At.prototype,"isReadOnly",void 0),_([S()],At.prototype,"layerTemplatesGroupQuery",void 0),_([S()],At.prototype,"maxTokenExpirationMinutes",void 0),_([S({type:Date})],At.prototype,"modified",void 0),_([S()],At.prototype,"name",void 0),_([S()],At.prototype,"portalHostname",void 0),_([S()],At.prototype,"portalMode",void 0),_([S()],At.prototype,"portalProperties",void 0),_([S()],At.prototype,"region",void 0),_([S({readOnly:!0})],At.prototype,"restUrl",null),_([S()],At.prototype,"rotatorPanels",void 0),_([S()],At.prototype,"showHomePageDescription",void 0),_([S()],At.prototype,"sourceJSON",void 0),_([S()],At.prototype,"staticImagesUrl",void 0),_([S({readOnly:!0,json:{read:!1}})],At.prototype,"stylesGroupQuery",null),_([S({json:{name:"2DStylesGroupQuery"}})],At.prototype,"stylesGroupQuery2d",void 0),_([S({json:{name:"stylesGroupQuery"}})],At.prototype,"stylesGroupQuery3d",void 0),_([S()],At.prototype,"supportsHostedServices",void 0),_([S()],At.prototype,"symbolSetsGroupQuery",void 0),_([S()],At.prototype,"templatesGroupQuery",void 0),_([S()],At.prototype,"thumbnail",void 0),_([S({readOnly:!0})],At.prototype,"thumbnailUrl",null),_([S()],At.prototype,"units",void 0),_([S()],At.prototype,"url",void 0),_([S()],At.prototype,"urlKey",void 0),_([wt("urlKey")],At.prototype,"readUrlKey",null),_([S()],At.prototype,"user",void 0),_([wt("user")],At.prototype,"readUser",null),_([S()],At.prototype,"useStandardizedQuery",void 0),_([S()],At.prototype,"useVectorBasemaps",void 0),_([S()],At.prototype,"vectorBasemapGalleryGroupQuery",void 0),At=vh=_([re("esri.portal.Portal")],At);const ha=At;let J_=class extends T0(Ye){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return L(e)&&e.placement===this.placement&&e.style===this.style&&(J(this.color)&&J(e.color)||L(this.color)&&L(e.color)&&this.color.toJSON()===e.color.toJSON())}};_([S({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],J_.prototype,"type",void 0),_([S({type:i6e,json:{default:"begin-end",write:!0}})],J_.prototype,"placement",void 0),_([S({type:s0e,json:{default:"arrow",write:!0}})],J_.prototype,"style",void 0),_([S({type:Ft,json:{type:[us],default:null,write:!0}})],J_.prototype,"color",void 0),J_=_([re("esri.symbols.LineStyleMarker3D")],J_);const ZB=J_;var l9;let wf=l9=class extends A0{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Fp(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:L(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:L(this.pattern)?this.pattern.clone():null,marker:L(this.marker)?this.marker.clone():null};return new l9(e)}static fromSimpleLineSymbol(e){var t,i,r;const s={enabled:!0,size:(t=e.width)!=null?t:Fp(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new ZW({style:e.style}):null,material:new Yh({color:(e.color||pM).clone()}),marker:e.marker?new ZB({placement:e.marker.placement,style:e.marker.style,color:(i=(r=e.marker.color)==null?void 0:r.clone())!=null?i:null}):null};return new l9(s)}};_([S({type:Yh,json:{write:!0}})],wf.prototype,"material",void 0),_([ti({Line:"line"},{readOnly:!0})],wf.prototype,"type",void 0),_([S({type:y0e,json:{write:!0,default:"miter"}})],wf.prototype,"join",void 0),_([S({type:iX,json:{write:!0,default:"butt"}})],wf.prototype,"cap",void 0),_([S(h0)],wf.prototype,"size",void 0),_([S(c0e)],wf.prototype,"pattern",void 0),_([S({types:{key:"type",base:ZB,typeMap:{style:ZB}},json:{write:!0}})],wf.prototype,"marker",void 0),wf=l9=_([re("esri.symbols.LineSymbol3DLayer")],wf);const dE=wf;var KB;const tDe=Va()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let dC=KB=class extends Ye{clone(){return new KB({href:this.href,primitive:this.primitive})}};_([S({type:String,json:{read:rX,write:wv}})],dC.prototype,"href",void 0),_([ti(tDe)],dC.prototype,"primitive",void 0),dC=KB=_([re("esri.symbols.support.ObjectSymbol3DLayerResource")],dC);const w0e="sphere";var QB;let Bb=QB=class extends st{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new QB({x:this.x,y:this.y,z:this.z})}};_([S({type:Number})],Bb.prototype,"x",void 0),_([S({type:Number})],Bb.prototype,"y",void 0),_([S({type:Number})],Bb.prototype,"z",void 0),Bb=QB=_([re("esri.symbols.support.Symbol3DAnchorPosition3D")],Bb);var eV;let Xa=eV=class extends A0{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new eV({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:L(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};_([S({type:Yh,json:{write:!0}})],Xa.prototype,"material",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Xa.prototype,"castShadows",void 0),_([S({type:dC,json:{write:!0}})],Xa.prototype,"resource",void 0),_([ti({Object:"object"},{readOnly:!0})],Xa.prototype,"type",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"width",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"height",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"depth",void 0),_([ti({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),S({json:{default:"origin"}})],Xa.prototype,"anchor",void 0),_([S({type:Bb,json:{type:[Number],read:{reader:e=>new Bb({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Xa.prototype,"anchorPosition",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"heading",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"tilt",void 0),_([S({type:Number,json:{write:!0}})],Xa.prototype,"roll",void 0),_([S({readOnly:!0})],Xa.prototype,"isPrimitive",null),Xa=eV=_([re("esri.symbols.ObjectSymbol3DLayer")],Xa);const HL=Xa;var tV;let Pl=tV=class extends A0{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new tV({enabled:this.enabled,material:L(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};_([S({type:Yh,json:{write:!0}})],Pl.prototype,"material",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pl.prototype,"castShadows",void 0),_([ti({Path:"path"},{readOnly:!0})],Pl.prototype,"type",void 0),_([S({type:["circle","quad"],json:{write:!0,default:"circle"}})],Pl.prototype,"profile",void 0),_([S({type:y0e,json:{write:!0,default:"miter"}})],Pl.prototype,"join",void 0),_([S({type:M6e,json:{write:!0,default:"butt"}})],Pl.prototype,"cap",void 0),_([S({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Pl.prototype,"width",void 0),_([wt("width",["width","size","height"])],Pl.prototype,"readWidth",null),_([S({type:Number,json:{write:!0}})],Pl.prototype,"height",void 0),_([wt("height",["height","size","width"])],Pl.prototype,"readHeight",null),_([S({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Pl.prototype,"anchor",void 0),_([S({type:["heading","all"],json:{write:!0,default:"all"}})],Pl.prototype,"profileRotation",void 0),Pl=tV=_([re("esri.symbols.PathSymbol3DLayer")],Pl);const oX=Pl;var iV;let X3=iV=class extends Ye{constructor(){super(...arguments),this.color=new Ft([0,0,0,1]),this.size=0}clone(){const e={color:Fe(this.color),size:this.size};return new iV(e)}};_([S(Ug)],X3.prototype,"color",void 0),_([S(h0)],X3.prototype,"size",void 0),X3=iV=_([re("esri.symbols.support.Symbol3DHalo")],X3);let mM=class extends T0(Ye){constructor(e){super(e),this.color=null}};_([S(Ug)],mM.prototype,"color",void 0),mM=_([re("esri.symbols.support.Symbol3DTextBackground")],mM);var c9;let bc=c9=class extends A0{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){L(e)&&L(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=qe(ie({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return L(this._userSize)?this._userSize:L(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,L(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new c9({enabled:this.enabled,font:this.font&&Fe(this.font),halo:this.halo&&Fe(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:L(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Fe(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new c9({font:L(e.font)?e.font.clone():new jL,halo:iDe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Yh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new mM({color:e.backgroundColor.clone()}):null})}};function iDe(e,t){return e&&t>0?new X3({color:Fe(e),size:t}):null}_([S({type:jL,json:{write:!0}})],bc.prototype,"font",null),_([Et("font")],bc.prototype,"writeFont",null),_([S({type:X3,json:{write:!0}})],bc.prototype,"halo",void 0),_([S(qe(ie({},N6e),{json:{default:"center",write:!0}}))],bc.prototype,"horizontalAlignment",void 0),_([S(qe(ie({},v0e),{json:{default:1,write:!0}}))],bc.prototype,"lineHeight",void 0),_([S({type:Yh,json:{write:!0}})],bc.prototype,"material",void 0),_([S({type:mM,json:{write:!0}})],bc.prototype,"background",void 0),_([S(h0)],bc.prototype,"size",null),_([S({type:String,json:{write:!0}})],bc.prototype,"text",void 0),_([ti({Text:"text"},{readOnly:!0})],bc.prototype,"type",void 0),_([S(qe(ie({},_0e),{json:{default:"baseline",write:!0}}))],bc.prototype,"verticalAlignment",void 0),bc=c9=_([re("esri.symbols.TextSymbol3DLayer")],bc);const Mw=bc;var rV;let V1=rV=class extends A0{constructor(e){super(e),this.color=sV.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new rV({color:Fe(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};_([S({type:Ft,nonNullable:!0,json:{type:[us],write:(e,t,i)=>t[i]=e.toArray(Ft.AlphaMode.UNLESS_OPAQUE),default:()=>sV.clone(),defaultEquals:e=>e.toCss(!0)===sV.toCss(!0)}})],V1.prototype,"color",void 0),_([ti({Water:"water"},{readOnly:!0})],V1.prototype,"type",void 0),_([S({type:["small","medium","large"],json:{write:!0,default:"medium"}})],V1.prototype,"waterbodySize",void 0),_([S({type:Number,json:{write:!0,default:null}})],V1.prototype,"waveDirection",void 0),_([S({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],V1.prototype,"waveStrength",void 0),V1=rV=_([re("esri.symbols.WaterSymbol3DLayer")],V1);const sV=new Ft([0,119,190]),aX=V1;var nV;let Z_=nV=class extends st{constructor(){super(...arguments),this.portal=null}clone(){return new nV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};_([S({type:String})],Z_.prototype,"name",void 0),_([S({type:String})],Z_.prototype,"styleUrl",void 0),_([S({type:String})],Z_.prototype,"styleName",void 0),_([S({type:ha})],Z_.prototype,"portal",void 0),Z_=nV=_([re("esri.symbols.support.StyleOrigin")],Z_);const oV=Z_;var aV;let gM=aV=class extends st{clone(){return new aV({url:this.url})}};_([S({type:String})],gM.prototype,"url",void 0),gM=aV=_([re("esri.symbols.support.Thumbnail")],gM);const x0e={icon:tg,object:HL,line:dE,path:oX,fill:kO,extrude:JW,text:Mw,water:aX},rDe=kt.ofType({base:A0,key:"type",typeMap:x0e,errorContext:"symbol-layer"}),sDe=Ge.getLogger("esri.symbols.Symbol3D");let xf=class extends hc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||kt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&sDe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Eg(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=uE(e.styleUrl,i);return new oV({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new oV({portal:i&&i.portal||ha.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Qh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=W2(e.styleUrl,r);Xh(s)&&(s=cd(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!ype(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Qh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof A0||e&&x0e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};_([S({json:{read:!1,write:!1}})],xf.prototype,"color",null),_([S({type:rDe,nonNullable:!0,json:{write:!0}}),_i(sX)],xf.prototype,"symbolLayers",null),_([S({type:oV})],xf.prototype,"styleOrigin",void 0),_([wt("styleOrigin")],xf.prototype,"readStyleOrigin",null),_([Et("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],xf.prototype,"writeStyleOrigin",null),_([S({type:gM,json:{read:!1}})],xf.prototype,"thumbnail",void 0),_([S({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],xf.prototype,"type",void 0),xf=_([re("esri.symbols.Symbol3D")],xf);const pE=xf;let pC=class extends Ye{constructor(e){super(e),this.visible=!0}clone(){}};_([S({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],pC.prototype,"type",void 0),_([S({readOnly:!0})],pC.prototype,"visible",void 0),pC=_([re("esri.symbols.callouts.Callout3D")],pC);const T0e=pC;var lV;let yM=lV=class extends Ye{constructor(){super(...arguments),this.color=new Ft("white")}clone(){return new lV({color:Fe(this.color)})}};_([S(Ug)],yM.prototype,"color",void 0),yM=lV=_([re("esri.symbols.callouts.LineCallout3DBorder")],yM);const S0e=yM;Object.freeze({__proto__:null,get LineCallout3DBorder(){return yM},default:S0e});var cV;let G1=cV=class extends T0e{constructor(e){super(e),this.type="line",this.color=new Ft([0,0,0,1]),this.size=Fp(1),this.border=null}get visible(){return this.size>0&&L(this.color)&&this.color.a>0}clone(){return new cV({color:Fe(this.color),size:this.size,border:Fe(this.border)})}};_([ti({line:"line"},{readOnly:!0})],G1.prototype,"type",void 0),_([S(Ug)],G1.prototype,"color",void 0),_([S(h0)],G1.prototype,"size",void 0),_([S({type:S0e,json:{write:!0}})],G1.prototype,"border",void 0),_([S({readOnly:!0})],G1.prototype,"visible",null),G1=cV=_([re("esri.symbols.callouts.LineCallout3D")],G1);const nDe=G1;function lX(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function E0e(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!lX(e)}function cX(e){return e.type==="point-3d"||e.type==="label-3d"}function A0e(e){const{horizontalAlignment:t}=e;return t==="center"||t==="justify"}const C0e={types:{key:"type",base:T0e,typeMap:{line:nDe}},json:{write:!0}};var hV;let Vb=hV=class extends Ye{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new hV({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};_([S(h0)],Vb.prototype,"screenLength",void 0),_([S({type:Number,json:{write:!0,default:0}})],Vb.prototype,"minWorldLength",void 0),_([S({type:Number,json:{write:!0}})],Vb.prototype,"maxWorldLength",void 0),Vb=hV=_([re("esri.symbols.support.Symbol3DVerticalOffset")],Vb);var h9;const M0e=kt.ofType({base:null,key:"type",typeMap:{text:Mw}});let j1=h9=class extends pE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new M0e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return E0e(this)}hasVisibleVerticalOffset(){return lX(this)}clone(){return new h9({styleOrigin:Fe(this.styleOrigin),symbolLayers:Fe(this.symbolLayers),thumbnail:Fe(this.thumbnail),callout:Fe(this.callout),verticalOffset:Fe(this.verticalOffset)})}static fromTextSymbol(e){return new h9({symbolLayers:[Mw.fromTextSymbol(e)]})}};_([S({type:Vb,json:{write:!0}})],j1.prototype,"verticalOffset",void 0),_([S(C0e)],j1.prototype,"callout",void 0),_([S({json:{read:!1,write:!1}})],j1.prototype,"styleOrigin",void 0),_([S({type:M0e})],j1.prototype,"symbolLayers",void 0),_([ti({LabelSymbol3D:"label-3d"},{readOnly:!0})],j1.prototype,"type",void 0),j1=h9=_([re("esri.symbols.LabelSymbol3D")],j1);const qL=j1;var u9;const R0e=kt.ofType({base:null,key:"type",typeMap:{line:dE,path:oX}}),oDe=kt.ofType({base:null,key:"type",typeMap:{line:dE,path:oX}});let fC=u9=class extends pE{constructor(e){super(e),this.symbolLayers=new R0e,this.type="line-3d"}clone(){return new u9({styleOrigin:Fe(this.styleOrigin),symbolLayers:Fe(this.symbolLayers),thumbnail:Fe(this.thumbnail)})}static fromSimpleLineSymbol(e){return new u9({symbolLayers:[dE.fromSimpleLineSymbol(e)]})}};_([S({type:R0e,json:{type:oDe}})],fC.prototype,"symbolLayers",void 0),_([ti({LineSymbol3D:"line-3d"},{readOnly:!0})],fC.prototype,"type",void 0),fC=u9=_([re("esri.symbols.LineSymbol3D")],fC);const WL=fC;let H1=class extends hc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};_([S({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],H1.prototype,"angle",void 0),_([S({type:["simple-marker","picture-marker"],readOnly:!0})],H1.prototype,"type",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],H1.prototype,"xoffset",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],H1.prototype,"yoffset",void 0),_([S({type:Number,cast:e=>e==="auto"?e:Wr(e),json:{write:!0}})],H1.prototype,"size",void 0),H1=_([re("esri.symbols.MarkerSymbol")],H1);const O0e=H1;var uV;const P0e=kt.ofType({base:null,key:"type",typeMap:{fill:kO}});let mC=uV=class extends pE{constructor(e){super(e),this.symbolLayers=new P0e,this.type="mesh-3d"}clone(){return new uV({styleOrigin:Fe(this.styleOrigin),symbolLayers:Fe(this.symbolLayers),thumbnail:Fe(this.thumbnail)})}};_([S({type:P0e})],mC.prototype,"symbolLayers",void 0),_([ti({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],mC.prototype,"type",void 0),mC=uV=_([re("esri.symbols.MeshSymbol3D")],mC);const hX=mC;function aDe(e,t,i){return t.imageData?bpe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):I0e(t.url,i)}function I0e(e,t){return cDe(t)&&!Xh(e)&&t.layer.parsedUrl?ih(t.layer.parsedUrl.path,"images",e):uE(e,t)}function lDe(e,t,i,r){if(x0(e)){const s=RL(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&wv(i.url,t,"url",r)}else wv(e,t,"url",r)}const $0e={json:{read:{source:["imageData","url"],reader:aDe},write:{writer(e,t,i,r){lDe(e,t,this.source,r)}}}},D0e={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=I0e(t.url,i)),r}}}};function cDe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var dV;let Au=dV=class extends n0e{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=Wr(i)),r!=null&&(s.height=Wr(r)),s}clone(){const e=new dV({color:Fe(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",Fe(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};_([ti({esriPFS:"picture-fill"},{readOnly:!0})],Au.prototype,"type",void 0),_([S($0e)],Au.prototype,"url",void 0),_([S({type:Number,json:{write:!0}})],Au.prototype,"xscale",void 0),_([S({type:Number,json:{write:!0}})],Au.prototype,"yscale",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Au.prototype,"width",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Au.prototype,"height",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Au.prototype,"xoffset",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Au.prototype,"yoffset",void 0),_([S(D0e)],Au.prototype,"source",void 0),Au=dV=_([re("esri.symbols.PictureFillSymbol")],Au);const L0e=Au;var pV;let zd=pV=class extends O0e{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=Wr(t)),i!=null&&(r.height=Wr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new pV({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",Fe(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};_([S({json:{write:!1}})],zd.prototype,"color",void 0),_([ti({esriPMS:"picture-marker"},{readOnly:!0})],zd.prototype,"type",void 0),_([S($0e)],zd.prototype,"url",void 0),_([S(D0e)],zd.prototype,"source",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],zd.prototype,"height",void 0),_([wt("height",["height","size"])],zd.prototype,"readHeight",null),_([S({type:Number,cast:Wr,json:{write:!0}})],zd.prototype,"width",void 0),_([S({json:{write:!1}})],zd.prototype,"size",void 0),zd=pV=_([re("esri.symbols.PictureMarkerSymbol")],zd);const XL=zd;var q1;const N0e=kt.ofType({base:null,key:"type",typeMap:{icon:tg,object:HL,text:Mw}});let K_=q1=class extends pE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new N0e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return E0e(this)}hasVisibleVerticalOffset(){return lX(this)}clone(){return new q1({verticalOffset:Fe(this.verticalOffset),callout:Fe(this.callout),styleOrigin:Fe(this.styleOrigin),symbolLayers:Fe(this.symbolLayers),thumbnail:Fe(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new q1({symbolLayers:[tg.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new q1({symbolLayers:[tg.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var t,i;return((t=e.data)==null||(i=t.symbol)==null?void 0:i.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new q1({symbolLayers:[tg.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new q1({symbolLayers:[tg.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new q1({symbolLayers:[Mw.fromTextSymbol(e)]})}};_([S({type:Vb,json:{write:!0}})],K_.prototype,"verticalOffset",void 0),_([S(C0e)],K_.prototype,"callout",void 0),_([S({type:N0e,json:{origins:{"web-scene":{write:!0}}}})],K_.prototype,"symbolLayers",void 0),_([ti({PointSymbol3D:"point-3d"},{readOnly:!0})],K_.prototype,"type",void 0),K_=q1=_([re("esri.symbols.PointSymbol3D")],K_);const jy=K_;var gC;const F0e=kt.ofType({base:null,key:"type",typeMap:{extrude:JW,fill:kO,icon:tg,line:dE,object:HL,text:Mw,water:aX}}),hDe=kt.ofType({base:null,key:"type",typeMap:{extrude:JW,fill:kO,icon:tg,line:dE,object:HL,water:aX}});let Zx=gC=class extends pE{constructor(e){super(e),this.symbolLayers=new F0e,this.type="polygon-3d"}writeSymbolLayers(e,t,i,r){const s=e.filter(n=>n.type!=="text");if(r&&r.messages&&s.length<e.length){const n=e.find(a=>a.type==="text");r.messages.push(new Se("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PolygonSymbol3D",{symbolLayer:n}))}t[i]=s.map(n=>n.write({},r)).toArray()}clone(){return new gC({styleOrigin:Fe(this.styleOrigin),symbolLayers:Fe(this.symbolLayers),thumbnail:Fe(this.thumbnail)})}static fromJSON(e){const t=new gC;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:L(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new gC({symbolLayers:[kO.fromSimpleFillSymbol(e)]})}};_([S({type:F0e,json:{type:hDe}})],Zx.prototype,"symbolLayers",void 0),_([Et("web-scene","symbolLayers")],Zx.prototype,"writeSymbolLayers",null),_([ti({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],Zx.prototype,"type",void 0),Zx=gC=_([re("esri.symbols.PolygonSymbol3D")],Zx);const UO=Zx;var fV;const jF=new Ui({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Q_=fV=class extends n0e{constructor(...e){super(...e),this.color=new Ft([0,0,0,.25]),this.outline=new tu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new fV({color:Fe(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};_([S()],Q_.prototype,"color",void 0),_([S()],Q_.prototype,"outline",void 0),_([ti({esriSFS:"simple-fill"},{readOnly:!0})],Q_.prototype,"type",void 0),_([S({type:jF.apiValues,json:{read:jF.read,write:jF.write}})],Q_.prototype,"style",void 0),Q_=fV=_([re("esri.symbols.SimpleFillSymbol")],Q_);const Ag=Q_;var mV;const HF=new Ui({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Tf=mV=class extends O0e{constructor(...e){super(...e),this.color=new Ft([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new tu}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Wr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new mV({angle:this.angle,color:Fe(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};_([S()],Tf.prototype,"color",void 0),_([Et("color")],Tf.prototype,"writeColor",null),_([ti({esriSMS:"simple-marker"},{readOnly:!0})],Tf.prototype,"type",void 0),_([S()],Tf.prototype,"size",void 0),_([S({type:HF.apiValues,json:{read:HF.read,write:HF.write}})],Tf.prototype,"style",void 0),_([S({type:String,json:{write:!0}})],Tf.prototype,"path",null),_([S({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":tu}},json:{default:null,write:!0}})],Tf.prototype,"outline",void 0),Tf=mV=_([re("esri.symbols.SimpleMarkerSymbol")],Tf);const cg=Tf;var gV;let Ks=gV=class extends hc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new jL,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return Wr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new gV({angle:this.angle,backgroundColor:Fe(this.backgroundColor),borderLineColor:Fe(this.borderLineColor),borderLineSize:this.borderLineSize,color:Fe(this.color),font:this.font&&this.font.clone(),haloColor:Fe(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};_([S({type:Ft,json:{write:!0}})],Ks.prototype,"backgroundColor",void 0),_([S({type:Ft,json:{write:!0}})],Ks.prototype,"borderLineColor",void 0),_([S({type:Number,json:{write:!0}})],Ks.prototype,"borderLineSize",void 0),_([S({type:jL,json:{write:!0}})],Ks.prototype,"font",void 0),_([S(qe(ie({},L6e),{json:{write:!0}}))],Ks.prototype,"horizontalAlignment",void 0),_([S({type:Boolean,json:{write:!0}})],Ks.prototype,"kerning",void 0),_([S({type:Ft,json:{write:!0}})],Ks.prototype,"haloColor",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Ks.prototype,"haloSize",void 0),_([S({type:Boolean,json:{write:!0}})],Ks.prototype,"rightToLeft",void 0),_([S({type:Boolean,json:{write:!0}})],Ks.prototype,"rotated",void 0),_([S({type:String,json:{write:!0}})],Ks.prototype,"text",void 0),_([ti({esriTS:"text"},{readOnly:!0})],Ks.prototype,"type",void 0),_([S(qe(ie({},_0e),{json:{write:!0}}))],Ks.prototype,"verticalAlignment",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Ks.prototype,"xoffset",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],Ks.prototype,"yoffset",void 0),_([S({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Ks.prototype,"angle",void 0),_([S({type:Number,json:{write:!0}})],Ks.prototype,"width",void 0),_([S({type:Number})],Ks.prototype,"lineWidth",void 0),_([Et("lineWidth")],Ks.prototype,"writeLineWidth",null),_([_i("lineWidth")],Ks.prototype,"castLineWidth",null),_([S(v0e)],Ks.prototype,"lineHeight",void 0),_([Et("lineHeight")],Ks.prototype,"writeLineHeight",null),Ks=gV=_([re("esri.symbols.TextSymbol")],Ks);const fE=Ks;var yV;const uDe=Ge.getLogger("esri.symbols.WebStyleSymbol");let Sf=yV=class extends hc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new yV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=await dDe();Gi(t);const r=i.resolveWebStyleSymbol(this,{portal:this.portal},e,t);return r.catch(s=>{uDe.error("#fetchSymbol()","Failed to create symbol from style",s)}),r}};function dDe(){return import("./webStyleSymbolUtils.bfb39f4d.js")}_([S({json:{write:!1}})],Sf.prototype,"color",void 0),_([S({type:String,json:{write:!0}})],Sf.prototype,"styleName",void 0),_([S({type:ha,json:{write:!1}})],Sf.prototype,"portal",void 0),_([S({type:String,json:{read:rX,write:wv}})],Sf.prototype,"styleUrl",void 0),_([S({type:gM,json:{read:!1}})],Sf.prototype,"thumbnail",void 0),_([S({type:String,json:{write:!0}})],Sf.prototype,"name",void 0),_([ti({styleSymbolReference:"web-style"},{readOnly:!0})],Sf.prototype,"type",void 0),Sf=yV=_([re("esri.symbols.WebStyleSymbol")],Sf);const Rw=Sf;function uX(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function mR(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Lc={base:hc,key:"type",typeMap:{"simple-fill":Ag,"picture-fill":L0e,"picture-marker":XL,"simple-line":tu,"simple-marker":cg,text:fE,"label-3d":qL,"line-3d":WL,"mesh-3d":hX,"point-3d":jy,"polygon-3d":UO,"web-style":Rw,cim:hE},errorContext:"symbol"},pDe={base:hc,key:"type",typeMap:{"picture-marker":XL,"simple-marker":cg,text:fE,"web-style":Rw,cim:hE},errorContext:"symbol"},fDe=rE({types:Lc}),k0e={base:hc,key:"type",typeMap:{"simple-fill":Ag,"picture-fill":L0e,"picture-marker":XL,"simple-line":tu,"simple-marker":cg,text:fE,"line-3d":WL,"mesh-3d":hX,"point-3d":jy,"polygon-3d":UO,"web-style":Rw,cim:hE},errorContext:"symbol"},mDe={base:hc,key:"type",typeMap:{text:fE,"label-3d":qL},errorContext:"symbol"},pte={base:hc,key:"type",typeMap:{"line-3d":WL,"mesh-3d":hX,"point-3d":jy,"polygon-3d":UO,"web-style":Rw,cim:hE},errorContext:"symbol"},gDe={base:hc,key:"type",typeMap:{"label-3d":qL},errorContext:"symbol"},U0e=Dp(Lc);function yDe(e){if(!e)return null;const t={};for(const i in e){const r=Lp(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function vDe(e){if(!L(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let wc=class extends T0(Ye){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:ec(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&L(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:vDe(this.aggregateGeometries),geometry:L(this.geometry)?this.geometry.toJSON():null,symbol:L(this.symbol)?this.symbol.toJSON():null,attributes:ie({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){L(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};_([S({value:null,json:{read:yDe}})],wc.prototype,"aggregateGeometries",null),_([S({value:null})],wc.prototype,"attributes",null),_([S({value:null,types:Sw,json:{read:Lp}})],wc.prototype,"geometry",null),_([S({type:Boolean})],wc.prototype,"isAggregate",void 0),_([S({clonable:"reference"})],wc.prototype,"layer",void 0),_([S({type:kL})],wc.prototype,"popupTemplate",void 0),_([S({clonable:"reference"})],wc.prototype,"sourceLayer",void 0),_([S({value:null,types:Lc})],wc.prototype,"symbol",null),_([S({type:Boolean,value:!0})],wc.prototype,"visible",null),wc=_([re("esri.Graphic")],wc),function(e){e.generateUID=ec}(wc||(wc={}));const gl=wc;function S3t(e){}function _De(e){return()=>e}function YL(e,t,i){return bo(e.map((r,s)=>t.apply(i,[r,s])))}function bDe(e,t,i){return bo(e.map((r,s)=>t.apply(i,[r,s]))).then(r=>r.map(s=>s.value))}function nh(e){return J(e)?G3():e.then(t=>({ok:!0,value:t})).catch(t=>({ok:!1,error:t}))}function E3t(e){return e.then(t=>({ok:!0,value:t})).catch(t=>(Fg(t),{ok:!1,error:t}))}function A3t(e){if(e.ok===!0)return e.value;throw e.error}async function dX(e,t){return await e.load(),wDe(e,t)}async function wDe(e,t){const i=[],r=(...n)=>{for(const a of n)J(a)||(Array.isArray(a)?r(...a):kt.isCollection(a)?a.forEach(l=>r(l)):d0.isLoadable(a)&&i.push(a))};t(r);let s=null;if(await bDe(i,async n=>{(await nh(xDe(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function xDe(e){return"loadAll"in e&&typeof e.loadAll=="function"}var vV;let d9=vV=class extends Ye{constructor(e){super(e),this.type="none"}clone(){return new vV({type:this.type})}};_([ti({none:"none",stayAbove:"stay-above"})],d9.prototype,"type",void 0),d9=vV=_([re("esri.ground.NavigationConstraint")],d9);var _V;const fte=Ge.getLogger("esri.Ground");let pm=_V=class extends DO(d0){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new kt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&fte.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{fte.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=ie({},e)).resourceInfo),e}set layers(e){this._set("layers",Eg(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=qe(ie({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const a={};_De(n)().write(a,r)&&s.push(a)}else r&&r.messages&&r.messages.push(new Se("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return dX(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.bfe764b7.js");Gi(t);const r=new i,s=this.layers.filter(mte).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.bfe764b7.js");Gi(t);const r=new i,s=this.layers.filter(mte).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:Fe(this.surfaceColor),navigationConstraint:Fe(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new _V({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.589b64ff.js").then(({populateOperationalLayers:a})=>{Gi(i);const l=[];if(e.layers&&Array.isArray(e.layers)){const p={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(a(this.layers,e.layers,p))}return bo(l)}).then(()=>{})}};function TDe(e){return e&&"createElevationSampler"in e}function mte(e){return e.type==="elevation"||TDe(e)}_([S({json:{read:!1}})],pm.prototype,"layers",null),_([Et("layers")],pm.prototype,"writeLayers",null),_([S({readOnly:!0})],pm.prototype,"resourceInfo",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:us,read:{reader:lS,source:"transparency"},write:{writer:(e,t)=>{t.transparency=UL(e)},target:"transparency"}}})],pm.prototype,"opacity",void 0),_([S({type:Ft,json:{type:[us],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],pm.prototype,"surfaceColor",void 0),_([S({type:d9,json:{write:!0}})],pm.prototype,"navigationConstraint",void 0),pm=_V=_([re("esri.Ground")],pm);const hS=pm;var bV;let W1=bV=class extends Ye{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new bV({rotation:this.rotation,scale:this.scale,targetGeometry:L(this.targetGeometry)?this.targetGeometry.clone():null,camera:L(this.camera)?this.camera.clone():null})}};function qF(){return{enabled:!this.camera}}_([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qF}}}}})],W1.prototype,"rotation",void 0),_([_i("rotation")],W1.prototype,"castRotation",null),_([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qF}}}}})],W1.prototype,"scale",void 0),_([S({types:Sw,json:{read:Lp,write:!0,origins:{"web-scene":{read:Lp,write:{overridePolicy:qF}}}}})],W1.prototype,"targetGeometry",void 0),_([S({type:sh,json:{write:!0}})],W1.prototype,"camera",void 0),W1=bV=_([re("esri.Viewpoint")],W1);const oh=W1;function C3t(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function M3t(e,t){for(const i of e)if(i!=null&&t(i))return i}function SDe(e){return e!=null&&typeof e[Symbol.iterator]=="function"}var tc;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(tc||(tc={}));let EDe=0;function z0e(){return EDe++}function ADe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function R6(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function B0e(e,t,i,r){if(t.type===tc.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==tc.INVOKE&&t.type!==tc.RESPONSE)return void e.postMessage(t);let s;ADe(i)?(s=gte(i.transferList),t.data=i.result):(s=gte(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function gR(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function gte(e){if(!e||!e.length)return null;if(je("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!CDe(i));return t.length?t:null}function CDe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const MDe={statsWorker:()=>import("./statsWorker.14486d79.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.562d1d4e.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.54adb334.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return Vyt}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.b6addcf1.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.8f9e5fb7.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.a2ba6a39.js"),LercWorker:()=>import("./LercWorker.c61e3fe5.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.23cbf6ea.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.52845a92.js"),Pipeline:()=>import("./Pipeline.1ad389a0.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.d05fa405.js"),RasterWorker:()=>import("./RasterWorker.cf8c55aa.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.ee8c50fe.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.f325a0c0.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.f8ad54c9.js")},{CLOSE:yte,ABORT:vte,INVOKE:_te,RESPONSE:GE,OPEN_PORT:bte,ON:RDe}=tc;class ODe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===tc.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Bc{constructor(t,i){this._port=t,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new ODe(r=>this._onInvokeMessage(r)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Bc(i.port1,{channel:i,client:r});return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Bc.clients.set(s,r),i.port2}static loadWorker(t){const i=MDe[t];return i?i():Promise.resolve(null)}close(){this._post({type:yte}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new Se("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const a=z0e();return new Promise((l,p)=>{const y=TO(s,()=>{var x;const A=this._outJobs.get(a);A&&(this._outJobs.delete(a),(x=A.abortHandle)==null||x.remove(),this._post({type:vte,jobId:a}),p(rr()))}),b={resolve:l,reject:p,abortHandle:y,debugInfo:t};this._outJobs.set(a,b),this._post({type:_te,jobId:a,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:tc.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:tc.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}openPort(){const t=new MessageChannel;return this._post({type:bte,port:t.port2}),t.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{var i;(i=t.abortHandle)==null||i.remove(),t.reject(rr(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){L(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=gR(t);if(i)switch(i.type){case GE:this._onResponseMessage(i);break;case _te:this._invokeQueue.push(i);break;case vte:this._onAbortMessage(i);break;case yte:this._onCloseMessage();break;case bte:this._onOpenPortMessage(i);break;case RDe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Bc.clients.get(this)===t&&t.destroy(),Bc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,a=n?new AbortController:null,l=this._inJobs;let p,y=this._client,b=y[i];try{if(!b&&i&&i.indexOf(".")!==-1){const x=i.split(".");for(let A=0;A<x.length-1;A++)y=y[x[A]],b=y[x[A+1]]}if(typeof b!="function")throw new TypeError(`${i} is not a function`);p=b.call(y,s,{client:this,signal:a?a.signal:null})}catch(x){return void this._post({type:GE,jobId:r,error:R6(x)})}au(p)?(l.set(r,{controller:a,promise:p}),p.then(x=>{l.has(r)&&(l.delete(r),this._post({type:GE,jobId:r},x))},x=>{l.has(r)&&(l.delete(r),Cs(x)||this._post({type:GE,jobId:r,error:R6(x||{message:`Error encountered at method ${i}`})}))})):this._post({type:GE,jobId:r},p)}_onOpenPortMessage(t){new Bc(t.port,{client:this._client})}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=xO(t.port,"message",n=>{gR(n).type===tc.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){var i;const{jobId:r,error:s,data:n}=t,a=this._outJobs;if(!a.has(r))return;const l=a.get(r);a.delete(r),(i=l.abortHandle)==null||i.remove(),s?l.reject(Se.fromJSON(JSON.parse(s))):l.resolve(n)}_post(t,i,r){return B0e(this._port,t,i,r)}}Bc.kernelInfo={revision:Spe,version:wW,buildDate:Tpe},Bc.clients=new Map;const PDe=Ge.getLogger("esri.core.workers.Connection");class IDe{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const a=l=>{Gi(i.signal),n&&(n=!1,l())};this._clients.length=t.length,this._clientPromises.length=t.length;for(let l=0;l<t.length;++l){const p=t[l];au(p)?this._clientPromises[l]=p.then(y=>(this._clients[l]=new Bc(y,i),a(r),this._clients[l]),()=>(a(s),null)):(this._clients[l]=new Bc(p,i),this._clientPromises[l]=Promise.resolve(this._clients[l]),a(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const a=this._clientPromises[n];s[n]=a.then(l=>l.invoke(t,i,r))}return s}close(){for(const t of this._clientPromises)t.then(i=>i.close());this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let t;for(let i=0;i<this._clients.length;++i){const r=this._clients[i];if(r){if(!r.isBusy())return Promise.resolve(r)}else t=t||[],t.push(this._clientPromises[i])}return t?Promise.race(t):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(t,i,r){let s=null;return Array.isArray(r)?(PDe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then(n=>n.invoke(t,i,s))}on(t,i){return Promise.all(this._clientPromises).then(()=>GT(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const wte={};function $De(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function DDe(e){var t;const i={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:ie({},e.has),map:ie({},e.map),packages:e.packages&&e.packages.concat()||[],paths:ie({},e.paths)};return e.hasOwnProperty("async")||(i.async=!0),e.hasOwnProperty("isDebug")||(i.isDebug=!1),e.baseUrl||(i.baseUrl=wte.baseUrl),(t=wte.packages)==null||t.forEach(r=>{$De(i.packages,r)}),i}class LDe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class p9{constructor(){this._dispatcher=new LDe,this._workerPostMessage({type:tc.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){HT(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){HT(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=gR(t);if(i&&i.type===tc.OPEN){const{modulePath:r,jobId:s}=i;let n=await Bc.loadWorker(r);n||(n=await import(r));const a=Bc.connect(n);this._workerPostMessage({type:tc.OPENED,jobId:s,data:a})}}}const wV=Ge.getLogger("esri.core.workers"),{HANDSHAKE:NDe}=tc,FDe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let t5,i5;const xte="Failed to create Worker. Fallback to execute module in main thread";async function kDe(){if(!je("esri-workers")||(je("mozilla"),0))return Tte(new p9);if(!t5&&!i5)try{const t=FDe.replace('"{CONFIGURATION}"',`'${UDe()}'`);t5=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){i5=t||{}}let e;if(t5)try{e=new Worker(t5,{name:"esri-worker-"+zDe++})}catch{wV.warn(xte,i5),e=new p9}else wV.warn(xte,i5),e=new p9;return Tte(e)}async function Tte(e){return new Promise(t=>{function i(s){const n=gR(s);n&&n.type===NDe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),wV.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new p9).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function UDe(){let e;if(qr.default!=null){const s=ie({},qr);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(qr));e.assetsPath=nd(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Wh(),e.has={"esri-csp-restrictions":je("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":je("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":je("esri-2d-query-centroid-enabled"),"featurelayer-pbf":je("featurelayer-pbf"),"featurelayer-simplify-thresholds":je("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":je("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":je("featurelayer-simplify-mobile-factor"),"esri-atomics":je("esri-atomics"),"esri-shared-array-buffer":je("esri-shared-array-buffer"),"esri-tiles-debug":je("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":je("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":je("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=nd(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=nd(e.workers.workerPath):e.workers.workerPath=nd(hr("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=qr.workers.loaderConfig,i=DDe({baseUrl:t==null?void 0:t.baseUrl,locale:Wh(),has:ie({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:ie({},t==null?void 0:t.map),paths:ie({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:wW,buildDate:Tpe,revision:Spe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let zDe=0;const BDe=Ge.getLogger("esri.core.workers"),{ABORT:Ste,INVOKE:VDe,OPEN:GDe,OPENED:jDe,RESPONSE:jE}=tc;class pX{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),BDe.error(r)})}static async create(t){const i=await kDe();return new pX(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=z0e();return new Promise((n,a)=>{const l={resolve:n,reject:a,abortHandle:TO(r,()=>{this._outJobs.delete(s),this._post({type:Ste,jobId:s})})};this._outJobs.set(s,l),this._post({type:GDe,jobId:s,modulePath:t})})}_onMessage(t){const i=gR(t);if(i)switch(i.type){case jDe:this._onOpenedMessage(i);break;case jE:this._onResponseMessage(i);break;case Ste:this._onAbortMessage(i);break;case VDe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,a=n?new AbortController:null,l=this._inJobs,p=APe[i];let y;try{if(typeof p!="function")throw new TypeError(`${i} is not a function`);y=p.call(null,s,{signal:a?a.signal:null})}catch(b){return void this._post({type:jE,jobId:r,error:R6(b)})}au(y)?(l.set(r,{controller:a,promise:y}),y.then(b=>{l.has(r)&&(l.delete(r),this._post({type:jE,jobId:r},b))},b=>{l.has(r)&&(l.delete(r),b||(b={message:"Error encountered at method"+i}),Cs(b)||this._post({type:jE,jobId:r,error:R6(b||{message:`Error encountered at method ${i}`})}))})):this._post({type:jE,jobId:r},y)}_onOpenedMessage(t){var i;const{jobId:r,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),(i=n.abortHandle)==null||i.remove(),n.resolve(s))}_onResponseMessage(t){var i;const{jobId:r,error:s,data:n}=t,a=this._outJobs.get(r);a&&(this._outJobs.delete(r),(i=a.abortHandle)==null||i.remove(),s?a.reject(Se.fromJSON(JSON.parse(s))):a.resolve(n))}_post(t,i,r){return B0e(this.worker,t,i,r)}}let n2=je("esri-workers-debug")?1:je("host-browser")?navigator.hardwareConcurrency-1:0;n2||(n2=je("safari")&&je("mac")||je("trident")?7:2);let Ete=0;const f9=[];function HDe(){G0e()}async function r5(e,t){const i=new IDe;return await i.open(e,t),i}async function V0e(e,t={}){if(typeof e!="string")throw new Se("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(je("host-webworker")&&!je("esri-workers")&&(i="local"),i==="local"){let r=await Bc.loadWorker(e);r||(r=await import(e)),Gi(t.signal);const s=t.client||r;return r5([Bc.connect(r)],qe(ie({},t),{client:s}))}if(await G0e(),Gi(t.signal),i==="dedicated"){const r=Ete++%n2;return r5([await f9[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,n2);if(r<n2){const s=new Array(r);for(let n=0;n<r;++n){const a=Ete++%n2;s[n]=f9[a].open(e,t)}return r5(s,t)}}return r5(f9.map(r=>r.open(e,t)),t)}let s5=null;async function G0e(){if(s5)return s5;new AbortController;const e=[];for(let t=0;t<n2;t++){const i=pX.create(t).then(r=>(f9[t]=r,r));e.push(i)}return s5=Promise.all(e),s5}let t0=class extends st{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Ei,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,vi)}addWhen(e,t,i={}){return this._installWatch(e,t,i,CO)}addOnCollectionChange(e,t,{initial:i=!1}={}){const r=++this.handleId;return this.handles.add([av(e,"after-changes",this._createSyncUpdatingCallback(),Pc),av(e,"change",t,{onListenerAdd:i?s=>t({added:s.toArray(),removed:[]}):void 0})],r),{remove:()=>this.handles.remove(r)}}addPromise(e){if(J(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(n5)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=vi(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(n5),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(EO(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(n5))}),n5)}}};_([S({readOnly:!0})],t0.prototype,"updating",void 0),t0=_([re("esri.views.support.WatchUpdatingTracking")],t0);const n5=-42;var Ate;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(Ate||(Ate={}));const zg=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Ei}get updatingHandles(){return this._get("updatingHandles")||new t0}};return _([S({readOnly:!0})],t.prototype,"handles",null),_([S({readOnly:!0})],t.prototype,"updatingHandles",null),t=_([re("esri.core.HandleOwner")],t),t};let xv=class extends zg(st){};xv=_([re("esri.core.HandleOwner")],xv);Ge.getLogger("esri.core.support.OwningCollection");let vM=class extends zg(kt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{J(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(kt.ofType(this.itemType.Type))(e):new kt(e)}};function O6(e,t){return{type:e,cast:sX,set(i){const r=Eg(i,this._get(t),e);r.owner=this,this._set(t,r)}}}_([S()],vM.prototype,"owner",null),vM=_([re("esri.core.support.OwningCollection")],vM);function fX(e){return new It({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const j0e=fX(ar),P6=fX(Qf),I6=fX(Sg),qDe=new It({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ar.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function JL(e){return e&&(S0(e)||e===P6)?P6:e&&(E0(e)||e===I6)?I6:j0e}function ir(e){return e&&(S0(e)||e===P6)?Qf:e&&(E0(e)||e===I6)?Sg:ar}function R3t(e){return IW(e)?Qf:$W(e)?Sg:ar}const H0e=39.37,WDe=ar.radius*Math.PI/200,q0e=/UNIT\[([^\]]+)\]\]$/i,x2=ce,W0e=/UNIT\[([^\]]+)\]/i,XDe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),YDe=Va()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Zp=e=>e*e,a1=e=>e*e*e,yR={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Zp(.001)},"square-centimeters":{inBaseUnits:Zp(.01)},"square-decimeters":{inBaseUnits:Zp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Zp(1e3)},"square-inches":{inBaseUnits:Zp(.0254)},"square-feet":{inBaseUnits:Zp(.3048)},"square-yards":{inBaseUnits:Zp(.9144)},"square-miles":{inBaseUnits:Zp(1609.344)},"square-us-feet":{inBaseUnits:Zp(1200/3937)},acres:{inBaseUnits:.0015625*Zp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*a1(.001)},"cubic-centimeters":{inBaseUnits:1e3*a1(.01)},"cubic-decimeters":{inBaseUnits:1e3*a1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*a1(1e3)},"cubic-inches":{inBaseUnits:1e3*a1(.0254)},"cubic-feet":{inBaseUnits:1e3*a1(.3048)},"cubic-yards":{inBaseUnits:1e3*a1(.9144)},"cubic-miles":{inBaseUnits:1e3*a1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},JDe=function(){const e={};for(const t in yR)for(const i in yR[t].units)e[i]=t;return e}();function ZDe(e,t,i){return e*yR[i].units[t].inBaseUnits}function KDe(e,t,i){return e/yR[i].units[t].inBaseUnits}function xV(e){const t=JDe[e];if(t)return t;throw new Error("unknown type")}function Cte(e,t=null){return t=t||xV(e),yR[t].baseUnit===e}function dn(e,t,i){if(t===i)return e;const r=xV(t);if(r!==xV(i))throw new Error("incompatible units");const s=Cte(t,r)?e:ZDe(e,t,r);return Cte(i,r)?s:KDe(s,i,r)}function QDe(e,t){return dn(e,t,"meters")<3e3?"meters":"kilometers"}function eLe(e,t){return dn(e,t,"meters")<1e5?"meters":"kilometers"}function tLe(e,t){return dn(e,t,"feet")<1e3?"feet":"miles"}function iLe(e,t){return dn(e,t,"feet")<1e5?"feet":"miles"}function O3t(e,t){return dn(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"}function P3t(e,t){return dn(e,t,"square-feet")<1e6?"square-feet":"square-miles"}function X0e(e,t,i){return dn(e,t,"meters")/(i*Math.PI/180)}function Y0e(e){return YDe.fromJSON(e.toLowerCase())||null}function uS(e){if(e&&typeof e=="object"&&!tS(e))return 1;const t=lh(e);return t>1e5?1:t}function rLe(e){return lh(e)>=(e instanceof It?ir(e).metersPerDegree:1e5)?"meters":mX(e)}function lh(e,t=ar.metersPerDegree){return sLe(e,!0)||t}function sLe(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(IW(i))return Qf.metersPerDegree;if($W(i))return Sg.metersPerDegree;s=x2.values[x2[i]],!s&&t&&XDe.has(i)&&(s=WDe)}else r&&(K0e(r)?s=Mte(q0e.exec(r),s):Z0e(r)&&(s=Mte(W0e.exec(r),s)));return s}function Mte(e,t){return e&&e[1]?J0e(e[1]):t}function J0e(e){return parseFloat(e.split(",")[1])}function mX(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=x2.units[x2[t]];else if(i){const s=K0e(i)?q0e:Z0e(i)?W0e:null;if(s){const n=s.exec(i);n&&n[1]&&(r=oLe(n[1]))}}return L(r)?Y0e(r):null}function Z0e(e){return/^GEOCCS/i.test(e)}function K0e(e){return/^PROJCS/i.test(e)}const nLe=1e-7;function oLe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||x2.units.indexOf(i)===-1){const r=J0e(e);i=null;const s=x2.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<nLe){i=x2.units[n];break}}return i}function I3t(e){if(!e)return null;switch(mX(e)){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null}return null}const Q0e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},eme={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},aLe=Va()(Q0e),lLe=Va()(eme);Va()(ie(ie({},Q0e),eme));var yC;const $6=Va()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),tme=$6.jsonValues.slice();gL(tme,"orthometric");const _M=Va()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Bd=yC=class extends Ye{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return $6.write(e,t,i)}readHeightModel(e,t,i){return $6.read(e)||(i&&i.messages&&i.messages.push(cLe(e,{context:i})),null)}readHeightUnit(e,t,i){return _M.read(e)||(i&&i.messages&&i.messages.push(Rte(e,{context:i})),null)}readHeightUnitService(e,t,i){return Y0e(e)||_M.read(e)||(i&&i.messages&&i.messages.push(Rte(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new yC({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=rLe(t);return new yC({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=ie({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new yC;return t.read(e,{origin:"web-scene"}),t}};function Rte(e,t){return new Qh("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function cLe(e,t){return new Qh("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}_([S({type:$6.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:tme,default:"ellipsoidal"}}}})],Bd.prototype,"heightModel",void 0),_([Et("web-scene","heightModel")],Bd.prototype,"writeHeightModel",null),_([wt(["web-scene","service"],"heightModel")],Bd.prototype,"readHeightModel",null),_([S({type:_M.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:_M.jsonValues,write:_M.write}}}})],Bd.prototype,"heightUnit",void 0),_([wt("web-scene","heightUnit")],Bd.prototype,"readHeightUnit",null),_([wt("service","heightUnit")],Bd.prototype,"readHeightUnitService",null),_([S({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Bd.prototype,"vertCRS",void 0),_([wt("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Bd.prototype,"readVertCRS",null),Bd=yC=_([re("esri.geometry.HeightModelInfo")],Bd);const jv=Bd;function nn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function C0(e,t,i,r,s,n,a,l,p,y,b,x,A,M,P,$,k){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=a,e[6]=l,e[7]=p,e[8]=y,e[9]=b,e[10]=x,e[11]=A,e[12]=M,e[13]=P,e[14]=$,e[15]=k,e}function p0(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oc(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],a=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=a,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Ms(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5],p=t[6],y=t[7],b=t[8],x=t[9],A=t[10],M=t[11],P=t[12],$=t[13],k=t[14],z=t[15],G=i*l-r*a,B=i*p-s*a,W=i*y-n*a,q=r*p-s*l,X=r*y-n*l,oe=s*y-n*p,de=b*$-x*P,he=b*k-A*P,fe=b*z-M*P,me=x*k-A*$,ge=x*z-M*$,Ce=A*z-M*k;let Ae=G*Ce-B*ge+W*me+q*fe-X*he+oe*de;return Ae?(Ae=1/Ae,e[0]=(l*Ce-p*ge+y*me)*Ae,e[1]=(s*ge-r*Ce-n*me)*Ae,e[2]=($*oe-k*X+z*q)*Ae,e[3]=(A*X-x*oe-M*q)*Ae,e[4]=(p*fe-a*Ce-y*he)*Ae,e[5]=(i*Ce-s*fe+n*he)*Ae,e[6]=(k*W-P*oe-z*B)*Ae,e[7]=(b*oe-A*W+M*B)*Ae,e[8]=(a*ge-l*fe+y*de)*Ae,e[9]=(r*fe-i*ge-n*de)*Ae,e[10]=(P*X-$*W+z*G)*Ae,e[11]=(x*W-b*X-M*G)*Ae,e[12]=(l*he-a*me-p*de)*Ae,e[13]=(i*me-r*he+s*de)*Ae,e[14]=($*B-P*q-k*G)*Ae,e[15]=(b*q-x*B+A*G)*Ae,e):null}function hLe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5],p=t[6],y=t[7],b=t[8],x=t[9],A=t[10],M=t[11],P=t[12],$=t[13],k=t[14],z=t[15];return e[0]=l*(A*z-M*k)-x*(p*z-y*k)+$*(p*M-y*A),e[1]=-(r*(A*z-M*k)-x*(s*z-n*k)+$*(s*M-n*A)),e[2]=r*(p*z-y*k)-l*(s*z-n*k)+$*(s*y-n*p),e[3]=-(r*(p*M-y*A)-l*(s*M-n*A)+x*(s*y-n*p)),e[4]=-(a*(A*z-M*k)-b*(p*z-y*k)+P*(p*M-y*A)),e[5]=i*(A*z-M*k)-b*(s*z-n*k)+P*(s*M-n*A),e[6]=-(i*(p*z-y*k)-a*(s*z-n*k)+P*(s*y-n*p)),e[7]=i*(p*M-y*A)-a*(s*M-n*A)+b*(s*y-n*p),e[8]=a*(x*z-M*$)-b*(l*z-y*$)+P*(l*M-y*x),e[9]=-(i*(x*z-M*$)-b*(r*z-n*$)+P*(r*M-n*x)),e[10]=i*(l*z-y*$)-a*(r*z-n*$)+P*(r*y-n*l),e[11]=-(i*(l*M-y*x)-a*(r*M-n*x)+b*(r*y-n*l)),e[12]=-(a*(x*k-A*$)-b*(l*k-p*$)+P*(l*A-p*x)),e[13]=i*(x*k-A*$)-b*(r*k-s*$)+P*(r*A-s*x),e[14]=-(i*(l*k-p*$)-a*(r*k-s*$)+P*(r*p-s*l)),e[15]=i*(l*A-p*x)-a*(r*A-s*x)+b*(r*p-s*l),e}function uLe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],l=e[6],p=e[7],y=e[8],b=e[9],x=e[10],A=e[11],M=e[12],P=e[13],$=e[14],k=e[15];return(t*a-i*n)*(x*k-A*$)-(t*l-r*n)*(b*k-A*P)+(t*p-s*n)*(b*$-x*P)+(i*l-r*a)*(y*k-A*M)-(i*p-s*a)*(y*$-x*M)+(r*p-s*l)*(y*P-b*M)}function As(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=t[6],b=t[7],x=t[8],A=t[9],M=t[10],P=t[11],$=t[12],k=t[13],z=t[14],G=t[15];let B=i[0],W=i[1],q=i[2],X=i[3];return e[0]=B*r+W*l+q*x+X*$,e[1]=B*s+W*p+q*A+X*k,e[2]=B*n+W*y+q*M+X*z,e[3]=B*a+W*b+q*P+X*G,B=i[4],W=i[5],q=i[6],X=i[7],e[4]=B*r+W*l+q*x+X*$,e[5]=B*s+W*p+q*A+X*k,e[6]=B*n+W*y+q*M+X*z,e[7]=B*a+W*b+q*P+X*G,B=i[8],W=i[9],q=i[10],X=i[11],e[8]=B*r+W*l+q*x+X*$,e[9]=B*s+W*p+q*A+X*k,e[10]=B*n+W*y+q*M+X*z,e[11]=B*a+W*b+q*P+X*G,B=i[12],W=i[13],q=i[14],X=i[15],e[12]=B*r+W*l+q*x+X*$,e[13]=B*s+W*p+q*A+X*k,e[14]=B*n+W*y+q*M+X*z,e[15]=B*a+W*b+q*P+X*G,e}function yl(e,t,i){const r=i[0],s=i[1],n=i[2];let a,l,p,y,b,x,A,M,P,$,k,z;return t===e?(e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15]):(a=t[0],l=t[1],p=t[2],y=t[3],b=t[4],x=t[5],A=t[6],M=t[7],P=t[8],$=t[9],k=t[10],z=t[11],e[0]=a,e[1]=l,e[2]=p,e[3]=y,e[4]=b,e[5]=x,e[6]=A,e[7]=M,e[8]=P,e[9]=$,e[10]=k,e[11]=z,e[12]=a*r+b*s+P*n+t[12],e[13]=l*r+x*s+$*n+t[13],e[14]=p*r+A*s+k*n+t[14],e[15]=y*r+M*s+z*n+t[15]),e}function ZL(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function qc(e,t,i,r){let s,n,a,l,p,y,b,x,A,M,P,$,k,z,G,B,W,q,X,oe,de,he,fe,me,ge=r[0],Ce=r[1],Ae=r[2],Pe=Math.sqrt(ge*ge+Ce*Ce+Ae*Ae);return Pe<pi?null:(Pe=1/Pe,ge*=Pe,Ce*=Pe,Ae*=Pe,s=Math.sin(i),n=Math.cos(i),a=1-n,l=t[0],p=t[1],y=t[2],b=t[3],x=t[4],A=t[5],M=t[6],P=t[7],$=t[8],k=t[9],z=t[10],G=t[11],B=ge*ge*a+n,W=Ce*ge*a+Ae*s,q=Ae*ge*a-Ce*s,X=ge*Ce*a-Ae*s,oe=Ce*Ce*a+n,de=Ae*Ce*a+ge*s,he=ge*Ae*a+Ce*s,fe=Ce*Ae*a-ge*s,me=Ae*Ae*a+n,e[0]=l*B+x*W+$*q,e[1]=p*B+A*W+k*q,e[2]=y*B+M*W+z*q,e[3]=b*B+P*W+G*q,e[4]=l*X+x*oe+$*de,e[5]=p*X+A*oe+k*de,e[6]=y*X+M*oe+z*de,e[7]=b*X+P*oe+G*de,e[8]=l*he+x*fe+$*me,e[9]=p*he+A*fe+k*me,e[10]=y*he+M*fe+z*me,e[11]=b*he+P*fe+G*me,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function dS(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],a=t[5],l=t[6],p=t[7],y=t[8],b=t[9],x=t[10],A=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+y*r,e[5]=a*s+b*r,e[6]=l*s+x*r,e[7]=p*s+A*r,e[8]=y*s-n*r,e[9]=b*s-a*r,e[10]=x*s-l*r,e[11]=A*s-p*r,e}function KL(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],a=t[1],l=t[2],p=t[3],y=t[8],b=t[9],x=t[10],A=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-y*r,e[1]=a*s-b*r,e[2]=l*s-x*r,e[3]=p*s-A*r,e[8]=n*r+y*s,e[9]=a*r+b*s,e[10]=l*r+x*s,e[11]=p*r+A*s,e}function pS(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],a=t[1],l=t[2],p=t[3],y=t[4],b=t[5],x=t[6],A=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+y*r,e[1]=a*s+b*r,e[2]=l*s+x*r,e[3]=p*s+A*r,e[4]=y*s-n*r,e[5]=b*s-a*r,e[6]=x*s-l*r,e[7]=A*s-p*r,e}function QL(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dLe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ah(e,t,i){let r,s,n,a=i[0],l=i[1],p=i[2],y=Math.sqrt(a*a+l*l+p*p);return y<pi?null:(y=1/y,a*=y,l*=y,p*=y,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=a*a*n+s,e[1]=l*a*n+p*r,e[2]=p*a*n-l*r,e[3]=0,e[4]=a*l*n-p*r,e[5]=l*l*n+s,e[6]=p*l*n+a*r,e[7]=0,e[8]=a*p*n+l*r,e[9]=l*p*n-a*r,e[10]=p*p*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ime(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pLe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rme(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sme(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=r+r,p=s+s,y=n+n,b=r*l,x=r*p,A=r*y,M=s*p,P=s*y,$=n*y,k=a*l,z=a*p,G=a*y;return e[0]=1-(M+$),e[1]=x+G,e[2]=A-z,e[3]=0,e[4]=x-G,e[5]=1-(b+$),e[6]=P+k,e[7]=0,e[8]=A+z,e[9]=P-k,e[10]=1-(b+M),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function fLe(e,t){const i=mLe,r=-t[0],s=-t[1],n=-t[2],a=t[3],l=t[4],p=t[5],y=t[6],b=t[7],x=r*r+s*s+n*n+a*a;return x>0?(i[0]=2*(l*a+b*r+p*n-y*s)/x,i[1]=2*(p*a+b*s+y*r-l*n)/x,i[2]=2*(y*a+b*n+l*s-p*r)/x):(i[0]=2*(l*a+b*r+p*n-y*s),i[1]=2*(p*a+b*s+y*r-l*n),i[2]=2*(y*a+b*n+l*s-p*r)),sme(e,t,i),e}const mLe=Q();function gLe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function yLe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],a=t[5],l=t[6],p=t[8],y=t[9],b=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+a*a+l*l),e[2]=Math.sqrt(p*p+y*y+b*b),e}function vLe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function _Le(e,t,i,r){const s=t[0],n=t[1],a=t[2],l=t[3],p=s+s,y=n+n,b=a+a,x=s*p,A=s*y,M=s*b,P=n*y,$=n*b,k=a*b,z=l*p,G=l*y,B=l*b,W=r[0],q=r[1],X=r[2];return e[0]=(1-(P+k))*W,e[1]=(A+B)*W,e[2]=(M-G)*W,e[3]=0,e[4]=(A-B)*q,e[5]=(1-(x+k))*q,e[6]=($+z)*q,e[7]=0,e[8]=(M+G)*X,e[9]=($-z)*X,e[10]=(1-(x+P))*X,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function bLe(e,t,i,r,s){const n=t[0],a=t[1],l=t[2],p=t[3],y=n+n,b=a+a,x=l+l,A=n*y,M=n*b,P=n*x,$=a*b,k=a*x,z=l*x,G=p*y,B=p*b,W=p*x,q=r[0],X=r[1],oe=r[2],de=s[0],he=s[1],fe=s[2],me=(1-($+z))*q,ge=(M+W)*q,Ce=(P-B)*q,Ae=(M-W)*X,Pe=(1-(A+z))*X,De=(k+G)*X,ne=(P+B)*oe,pe=(k-G)*oe,ye=(1-(A+$))*oe;return e[0]=me,e[1]=ge,e[2]=Ce,e[3]=0,e[4]=Ae,e[5]=Pe,e[6]=De,e[7]=0,e[8]=ne,e[9]=pe,e[10]=ye,e[11]=0,e[12]=i[0]+de-(me*de+Ae*he+ne*fe),e[13]=i[1]+he-(ge*de+Pe*he+pe*fe),e[14]=i[2]+fe-(Ce*de+De*he+ye*fe),e[15]=1,e}function wLe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=i+i,l=r+r,p=s+s,y=i*a,b=r*a,x=r*l,A=s*a,M=s*l,P=s*p,$=n*a,k=n*l,z=n*p;return e[0]=1-x-P,e[1]=b+z,e[2]=A-k,e[3]=0,e[4]=b-z,e[5]=1-y-P,e[6]=M+$,e[7]=0,e[8]=A+k,e[9]=M-$,e[10]=1-y-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nme(e,t,i,r,s,n,a){const l=1/(i-t),p=1/(s-r),y=1/(n-a);return e[0]=2*n*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*p,e[6]=0,e[7]=0,e[8]=(i+t)*l,e[9]=(s+r)*p,e[10]=(a+n)*y,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*y,e[15]=0,e}function xLe(e,t,i,r,s){const n=1/Math.tan(t/2);let a;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(a=1/(r-s),e[10]=(s+r)*a,e[14]=2*s*r*a):(e[10]=-1,e[14]=-2*r),e}function TLe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),p=2/(a+l),y=2/(s+n);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=y,e[6]=0,e[7]=0,e[8]=-(a-l)*p*.5,e[9]=(s-n)*y*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function gX(e,t,i,r,s,n,a){const l=1/(t-i),p=1/(r-s),y=1/(n-a);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*y,e[11]=0,e[12]=(t+i)*l,e[13]=(s+r)*p,e[14]=(a+n)*y,e[15]=1,e}function eN(e,t,i,r){let s,n,a,l,p,y,b,x,A,M;const P=t[0],$=t[1],k=t[2],z=r[0],G=r[1],B=r[2],W=i[0],q=i[1],X=i[2];return Math.abs(P-W)<pi&&Math.abs($-q)<pi&&Math.abs(k-X)<pi?p0(e):(b=P-W,x=$-q,A=k-X,M=1/Math.sqrt(b*b+x*x+A*A),b*=M,x*=M,A*=M,s=G*A-B*x,n=B*b-z*A,a=z*x-G*b,M=Math.sqrt(s*s+n*n+a*a),M?(M=1/M,s*=M,n*=M,a*=M):(s=0,n=0,a=0),l=x*a-A*n,p=A*s-b*a,y=b*n-x*s,M=Math.sqrt(l*l+p*p+y*y),M?(M=1/M,l*=M,p*=M,y*=M):(l=0,p=0,y=0),e[0]=s,e[1]=l,e[2]=b,e[3]=0,e[4]=n,e[5]=p,e[6]=x,e[7]=0,e[8]=a,e[9]=y,e[10]=A,e[11]=0,e[12]=-(s*P+n*$+a*k),e[13]=-(l*P+p*$+y*k),e[14]=-(b*P+x*$+A*k),e[15]=1,e)}function ome(e,t,i,r){const s=t[0],n=t[1],a=t[2],l=r[0],p=r[1],y=r[2];let b=s-i[0],x=n-i[1],A=a-i[2],M=b*b+x*x+A*A;M>0&&(M=1/Math.sqrt(M),b*=M,x*=M,A*=M);let P=p*A-y*x,$=y*b-l*A,k=l*x-p*b;return M=P*P+$*$+k*k,M>0&&(M=1/Math.sqrt(M),P*=M,$*=M,k*=M),e[0]=P,e[1]=$,e[2]=k,e[3]=0,e[4]=x*k-A*$,e[5]=A*P-b*k,e[6]=b*$-x*P,e[7]=0,e[8]=b,e[9]=x,e[10]=A,e[11]=0,e[12]=s,e[13]=n,e[14]=a,e[15]=1,e}function SLe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ELe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function ALe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function ame(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function CLe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function MLe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function RLe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function TV(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],l=e[5],p=e[6],y=e[7],b=e[8],x=e[9],A=e[10],M=e[11],P=e[12],$=e[13],k=e[14],z=e[15],G=t[0],B=t[1],W=t[2],q=t[3],X=t[4],oe=t[5],de=t[6],he=t[7],fe=t[8],me=t[9],ge=t[10],Ce=t[11],Ae=t[12],Pe=t[13],De=t[14],ne=t[15];return Math.abs(i-G)<=pi*Math.max(1,Math.abs(i),Math.abs(G))&&Math.abs(r-B)<=pi*Math.max(1,Math.abs(r),Math.abs(B))&&Math.abs(s-W)<=pi*Math.max(1,Math.abs(s),Math.abs(W))&&Math.abs(n-q)<=pi*Math.max(1,Math.abs(n),Math.abs(q))&&Math.abs(a-X)<=pi*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(l-oe)<=pi*Math.max(1,Math.abs(l),Math.abs(oe))&&Math.abs(p-de)<=pi*Math.max(1,Math.abs(p),Math.abs(de))&&Math.abs(y-he)<=pi*Math.max(1,Math.abs(y),Math.abs(he))&&Math.abs(b-fe)<=pi*Math.max(1,Math.abs(b),Math.abs(fe))&&Math.abs(x-me)<=pi*Math.max(1,Math.abs(x),Math.abs(me))&&Math.abs(A-ge)<=pi*Math.max(1,Math.abs(A),Math.abs(ge))&&Math.abs(M-Ce)<=pi*Math.max(1,Math.abs(M),Math.abs(Ce))&&Math.abs(P-Ae)<=pi*Math.max(1,Math.abs(P),Math.abs(Ae))&&Math.abs($-Pe)<=pi*Math.max(1,Math.abs($),Math.abs(Pe))&&Math.abs(k-De)<=pi*Math.max(1,Math.abs(k),Math.abs(De))&&Math.abs(z-ne)<=pi*Math.max(1,Math.abs(z),Math.abs(ne))}function yX(e){const t=pi,i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],l=e[6],p=e[8],y=e[9],b=e[10];return Math.abs(1-(i*i+n*n+p*p))<=t&&Math.abs(1-(r*r+a*a+y*y))<=t&&Math.abs(1-(s*s+l*l+b*b))<=t}const OLe=As,PLe=ame;Object.freeze({__proto__:null,copy:nn,set:C0,identity:p0,transpose:oc,invert:Ms,adjoint:hLe,determinant:uLe,multiply:As,translate:yl,scale:ZL,rotate:qc,rotateX:dS,rotateY:KL,rotateZ:pS,fromTranslation:QL,fromScaling:dLe,fromRotation:ah,fromXRotation:ime,fromYRotation:pLe,fromZRotation:rme,fromRotationTranslation:sme,fromQuat2:fLe,getTranslation:gLe,getScaling:yLe,getRotation:vLe,fromRotationTranslationScale:_Le,fromRotationTranslationScaleOrigin:bLe,fromQuat:wLe,frustum:nme,perspective:xLe,perspectiveFromFieldOfView:TLe,ortho:gX,lookAt:eN,targetTo:ome,str:SLe,frob:ELe,add:ALe,subtract:ame,multiplyScalar:CLe,multiplyScalarAndAdd:MLe,exactEquals:RLe,equals:TV,isOrthoNormal:yX,mul:OLe,sub:PLe});let WF,Ne=null;function lme(){return!!Ne}function ILe(){return!!je("esri-wasm")}function cme(){return WF||(WF=import("./pe-wasm.1d1b20e7.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>hr(`esri/geometry/support/${t}`)})).then(e=>{ume(e)}),WF)}var SV,en,EV;(function(e){function t(n,a,l){Ne.ensureCache.prepare();const p=Gb(l),y=l===p,b=Ne.ensureFloat64(p),x=Ne._pe_geog_to_proj(Ne.getPointer(n),a,b);return x&&Py(l,a,b,y),x}function i(n,a,l,p){switch(p){case en.PE_TRANSFORM_P_TO_G:return r(n,a,l);case en.PE_TRANSFORM_G_TO_P:return t(n,a,l)}return 0}function r(n,a,l){return s(n,a,l,0)}function s(n,a,l,p){Ne.ensureCache.prepare();const y=Gb(l),b=l===y,x=Ne.ensureFloat64(y),A=Ne._pe_proj_to_geog_center(Ne.getPointer(n),a,x,p);return A&&Py(l,a,x,b),A}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(SV||(SV={})),function(e){function t(){e.PE_BUFFER_MAX=Ne.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=Ne.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=Ne.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=Ne.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=Ne.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=Ne.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=Ne.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=Ne.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=Ne.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=Ne.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=Ne.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=Ne.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=Ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=Ne.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=Ne.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=Ne.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=Ne.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=Ne.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=Ne.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=Ne.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=Ne.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=Ne.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=Ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=Ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=Ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=Ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=Ne.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=Ne.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=Ne.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=Ne.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(en||(en={})),function(e){const t={},i={},r=M=>{if(M){const P=M.getType();switch(P){case en.PE_TYPE_GEOGCS:M=Ne.castObject(M,Ne.PeGeogcs);break;case en.PE_TYPE_PROJCS:M=Ne.castObject(M,Ne.PeProjcs);break;case en.PE_TYPE_GEOGTRAN:M=Ne.castObject(M,Ne.PeGeogtran);break;default:P&en.PE_TYPE_UNIT&&(M=Ne.castObject(M,Ne.PeUnit))}}return M};function s(){Ne.PeFactory.prototype.initialize(null)}function n(M){return a(en.PE_TYPE_COORDSYS,M)}function a(M,P){let $=null,k=t[M];if(k||(k={},t[M]=k),k.hasOwnProperty(String(P)))$=k[P];else{const z=Ne.PeFactory.prototype.factoryByType(M,P);Ne.compare(z,Ne.NULL)||($=z,k[P]=$)}return $=r($),$}function l(M,P){let $=null,k=i[M];if(k||(k={},i[M]=k),k.hasOwnProperty(P))$=k[P];else{const z=Ne.PeFactory.prototype.fromString(M,P);Ne.compare(z,Ne.NULL)||($=z,k[P]=$)}return $=r($),$}function p(M){return a(en.PE_TYPE_GEOGCS,M)}function y(M){return a(en.PE_TYPE_GEOGTRAN,M)}function b(M){return Ne.PeFactory.prototype.getCode(M)}function x(M){return a(en.PE_TYPE_PROJCS,M)}function A(M){return a(en.PE_TYPE_UNIT,M)}e.initialize=s,e.coordsys=n,e.factoryByType=a,e.fromString=l,e.geogcs=p,e.geogtran=y,e.getCode=b,e.projcs=x,e.unit=A}(EV||(EV={}));let hme=null;var D6,AV,CV,MV,L6,RV,N6,F6,OV;function ume(e){function t(n,a,l){n[a]=l(n[a])}Ne=e,en.init(),D6.init(),L6.init(),N6.init(),F6.init(),hme=class extends Ne.PeGCSExtent{destroy(){Ne.destroy(this)}};const i=[Ne.PeDatum,Ne.PeGeogcs,Ne.PeGeogtran,Ne.PeObject,Ne.PeParameter,Ne.PePrimem,Ne.PeProjcs,Ne.PeSpheroid,Ne.PeUnit];for(const n of i)t(n.prototype,"getName",a=>function(){return a.call(this,new Array(en.PE_NAME_MAX))});for(const n of[Ne.PeGeogtran,Ne.PeProjcs])t(n.prototype,"getParameters",a=>function(){const l=new Array(en.PE_PARM_MAX);let p=a.call(this);for(let y=0;y<l.length;y++){const b=Ne.getValue(p,"*");l[y]=b?Ne.wrapPointer(b,Ne.PeParameter):null,p+=Int32Array.BYTES_PER_ELEMENT}return l});t(Ne.PeHorizon.prototype,"getCoord",n=>function(){const a=this.getSize();if(!a)return null;const l=[];return Py(l,a,n.call(this)),l}),t(Ne.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const a=Ne._pe_getPeGTlistExtendedGTsSize();return function(){let l=null;const p=n.call(this);if(!Ne.compare(p,Ne.NULL)){l=[p];const y=this.getSteps();if(y>1){const b=Ne.getPointer(p);for(let x=1;x<y;x++)l.push(Ne.wrapPointer(b+a*x,Ne.PeGTlistExtendedGTs))}}return l}});const r=Ne._pe_getPeHorizonSize(),s=n=>function(){let a=this._cache;if(a||(a=new Map,this._cache=a),a.has(n))return a.get(n);let l=null;const p=n.call(this);if(!Ne.compare(p,Ne.NULL)){l=[p];const y=p.getNump();if(y>1){const b=Ne.getPointer(p);for(let x=1;x<y;x++)l.push(Ne.wrapPointer(b+r*x,Ne.PeHorizon))}}return a.set(n,l),l};t(Ne.PeProjcs.prototype,"horizonGcsGenerate",s),t(Ne.PeProjcs.prototype,"horizonPcsGenerate",s),Ne.PeObject.prototype.toString=function(n=en.PE_STR_OPTS_NONE){Ne.ensureCache.prepare();const a=Ne.getPointer(this),l=Ne.ensureInt8(new Array(en.PE_BUFFER_MAX));return Ne.UTF8ToString(Ne._pe_object_to_string_ext(a,n,l))}}function z0(e){if(!e)return;const t=Ne.getClass(e);if(!t)return;const i=Ne.getCache(t);if(!i)return;const r=Ne.getPointer(e);r&&delete i[r]}function o5(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(Ne.ensureInt8(r));return i}function Gb(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function Py(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=Ne.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=Ne.getValue(i,"double"),e[n][1]=Ne.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=Ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=Ne._pe_getPeGTlistExtendedEntrySize()}function r(s,n,a,l,p,y){let b=null;const x=new Ne.PeInteger(y);try{const A=Ne.PeGTlistExtended.prototype.getGTlist(s,n,a,l,p,x);if((y=x.val)&&(b=[A],y>1)){const M=Ne.getPointer(A);for(let P=1;P<y;P++)b.push(Ne.wrapPointer(M+t*P,Ne.PeGTlistExtendedEntry))}}finally{Ne.destroy(x)}return b}e.init=i,e.getGTlist=r})(D6||(D6={})),function(e){function t(i){if(i&&i.length){for(const r of i)z0(r),r.getEntries().forEach(s=>{z0(s);const n=s.getGeogtran();z0(n),n.getParameters().forEach(z0),[n.getGeogcs1(),n.getGeogcs2()].forEach(a=>{z0(a);const l=a.getDatum();z0(l),z0(l.getSpheroid()),z0(a.getPrimem()),z0(a.getUnit())})});Ne.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(AV||(AV={})),function(e){function t(i,r,s,n,a){Ne.ensureCache.prepare();const l=Gb(s),p=s===l,y=Ne.ensureFloat64(l);let b=0;n&&(b=Ne.ensureFloat64(n));const x=Ne._pe_geog_to_geog(Ne.getPointer(i),r,y,b,a);return x&&Py(s,r,y,p),x}e.geogToGeog=t}(CV||(CV={})),function(e){const t=(y,b,x,A,M,P)=>{let $,k;switch(Ne.ensureCache.prepare(),y){case"dd":$=Ne._pe_geog_to_dd,k=en.PE_DD_MAX;break;case"ddm":$=Ne._pe_geog_to_ddm,k=en.PE_DDM_MAX;break;case"dms":$=Ne._pe_geog_to_dms,k=en.PE_DMS_MAX}let z=0;b&&(z=Ne.getPointer(b));const G=Gb(A),B=Ne.ensureFloat64(G),W=o5(x,k),q=$(z,x,B,M,Ne.ensureInt32(W));if(q)for(let X=0;X<x;X++)P[X]=Ne.UTF8ToString(W[X]);return q},i=(y,b,x,A,M)=>{let P;switch(Ne.ensureCache.prepare(),y){case"dd":P=Ne._pe_dd_to_geog;break;case"ddm":P=Ne._pe_ddm_to_geog;break;case"dms":P=Ne._pe_dms_to_geog}let $=0;b&&($=Ne.getPointer(b));const k=A.map(W=>Ne.ensureString(W)),z=Ne.ensureInt32(k),G=Ne.ensureFloat64(new Array(2*x)),B=P($,x,z,G);return B&&Py(M,x,G),B};function r(y,b,x,A,M){return t("dms",y,b,x,A,M)}function s(y,b,x,A){return i("dms",y,b,x,A)}function n(y,b,x,A,M){return t("ddm",y,b,x,A,M)}function a(y,b,x,A){return i("ddm",y,b,x,A)}function l(y,b,x,A,M){return t("dd",y,b,x,A,M)}function p(y,b,x,A){return i("dd",y,b,x,A)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=a,e.geogToDd=l,e.ddToGeog=p}(MV||(MV={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=Ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=Ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=Ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=Ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=Ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,a,l,p,y,b){Ne.ensureCache.prepare();let x=0;s&&(x=Ne.getPointer(s));const A=Gb(a),M=Ne.ensureFloat64(A),P=o5(n,en.PE_MGRS_MAX),$=Ne.ensureInt32(P),k=Ne._pe_geog_to_mgrs_extended(x,n,M,l,p,y,$);if(k)for(let z=0;z<n;z++)b[z]=Ne.UTF8ToString(P[z]);return k}function r(s,n,a,l,p){Ne.ensureCache.prepare();let y=0;s&&(y=Ne.getPointer(s));const b=a.map(P=>Ne.ensureString(P)),x=Ne.ensureInt32(b),A=Ne.ensureFloat64(new Array(2*n)),M=Ne._pe_mgrs_to_geog_extended(y,n,x,l,A);return M&&Py(p,n,A),M}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(L6||(L6={})),function(e){function t(r,s,n,a,l,p,y){Ne.ensureCache.prepare();let b=0;r&&(b=Ne.getPointer(r));const x=Gb(n),A=Ne.ensureFloat64(x),M=o5(s,en.PE_MGRS_MAX),P=Ne.ensureInt32(M),$=Ne._pe_geog_to_usng(b,s,A,a,l,p,P);if($)for(let k=0;k<s;k++)y[k]=Ne.UTF8ToString(M[k]);return $}function i(r,s,n,a){Ne.ensureCache.prepare();let l=0;r&&(l=Ne.getPointer(r));const p=n.map(A=>Ne.ensureString(A)),y=Ne.ensureInt32(p),b=Ne.ensureFloat64(new Array(2*s)),x=Ne._pe_usng_to_geog(l,s,y,b);return x&&Py(a,s,b),x}e.geogToUsng=t,e.usngToGeog=i}(RV||(RV={})),function(e){function t(){e.PE_UTM_OPTS_NONE=Ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=Ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=Ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,a,l,p){Ne.ensureCache.prepare();let y=0;s&&(y=Ne.getPointer(s));const b=Gb(a),x=Ne.ensureFloat64(b),A=o5(n,en.PE_UTM_MAX),M=Ne.ensureInt32(A),P=Ne._pe_geog_to_utm(y,n,x,l,M);if(P)for(let $=0;$<n;$++)p[$]=Ne.UTF8ToString(A[$]);return P}function r(s,n,a,l,p){Ne.ensureCache.prepare();let y=0;s&&(y=Ne.getPointer(s));const b=a.map(P=>Ne.ensureString(P)),x=Ne.ensureInt32(b),A=Ne.ensureFloat64(new Array(2*n)),M=Ne._pe_utm_to_geog(y,n,x,l,A);return M&&Py(p,n,A),M}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(N6||(N6={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=Ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=Ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=Ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=Ne.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let a,l;return t.has(s)&&(l=t.get(s),l[n]&&(a=l[n])),a||(a=Ne.PePCSInfo.prototype.generate(s,n),l||(l=[],t.set(s,l)),l[n]=a),a}e.init=i,e.generate=r}(F6||(F6={})),function(e){function t(){return Ne.PeVersion.prototype.version_string()}e.versionString=t}(OV||(OV={}));const $Le=Object.freeze({__proto__:null,get _pe(){return Ne},isLoaded:lme,isSupported:ILe,load:cme,get PeCSTransformations(){return SV},get PeDefs(){return en},get PeFactory(){return EV},get PeGCSExtent(){return hme},get PeGTlistExtended(){return D6},get PeGTlistExtendedEntry(){return AV},get PeGTTransformations(){return CV},get PeNotationDms(){return MV},get PeNotationMgrs(){return L6},get PeNotationUsng(){return RV},get PeNotationUtm(){return N6},get PePCSInfo(){return F6},get PeVersion(){return OV},_init:ume}),Hu=Math.PI/180,DLe=/SPHEROID\[([^\]]+)]/i,l1=ar.radius,Cd=ar.eccentricitySquared,LLe={a1:l1*Cd,a2:l1*Cd*l1*Cd,a3:l1*Cd*Cd/2,a4:l1*Cd*l1*Cd*2.5,a5:l1*Cd+l1*Cd*Cd/2,a6:1-Cd},NLe={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ar.radius,f:ar.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Sg.radius,f:Sg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Qf.radius,f:Qf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Qf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let a5=0;class ST{constructor(t=null){this.uid=a5++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new ST;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=a5++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=a5++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=a5++}getInverse(){const t=new ST;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class Hy{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof ST?this.steps.push(i):this.steps.push(new ST({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new Hy;let r="";for(const s of t.steps){const n=ST.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new Hy;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[Hy.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[Hy.cacheKey(t,i)];return s===void 0?null:s}}function vX(e,t,i){if(J(t)||J(i)||i.vcsWkid||Vo(t,i))return null;const r=uS(t)/uS(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>FLe(s,r);case"polyline":case"esriGeometryPolyline":return s=>ULe(s,r);case"polygon":case"esriGeometryPolygon":return s=>kLe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>zLe(s,r);case"extent":case"esriGeometryExtent":return s=>BLe(s,r);default:return null}}function FLe(e,t){e&&e.z!=null&&(e.z*=t)}function kLe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function ULe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function zLe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function BLe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let X2=null,k6=null,XF=null,YF={};function _X(){return!!X2&&lme()}function U6(e){return J(XF)&&(XF=Promise.all([cme(),Promise.resolve().then(function(){return dbt}).then(t=>t.g),Promise.resolve().then(function(){return _bt})])),XF.then(([,t,{hydratedAdapter:i}])=>{Gi(e),k6=i,X2=t.default,X2._enableProjection($Le)})}function mE(e,t,i=null){return Array.isArray(e)?e.length===0?[]:z6(k6,e,e[0].spatialReference,t,i):z6(k6,[e],e.spatialReference,t,i)[0]}function z6(e,t,i,r,s=null){if(J(i)||J(r))return t;if(Tv(i,r,s))return t.map(n=>dme(n,i,r));if(J(s)){const n=Hy.cacheKey(i,r);YF[n]!==void 0?s=YF[n]:(s=VLe(i,r,null),J(s)&&(s=new Hy),YF[n]=s)}if(J(X2))throw new bX;return X2._project(e,t,i,r,s)}function VLe(e,t,i=null){if(J(X2))throw new bX;if(J(e)||J(t))return null;const r=X2._getTransformation(k6,e,t,i,i==null?void 0:i.spatialReference);return r!==null?Hy.fromGE(r):null}class bX extends Se{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var Re;function $3t(e,t){try{const i=mE(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=vX(i.type,e.spatialReference,t);return L(r)&&r(i),i}catch(i){if(!(i instanceof bX))throw i;return null}}function Tv(e,t,i){return!i&&(!!Vo(e,t)||ml(e)&&ml(t)&&!!SX(e,t,AX))}async function GLe(e,t,i,r){if(!_X()){if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:a}of e)if(!Tv(s,n,a))return U6(r)}else if(!Tv(e,t,i))return U6(r)}}function D3t(e,t){switch(SX(e,t,AX)){case Zr:return"copy3";case Wy:return"wgs84ToSphericalECEF";case Y2:return"wgs84ToWebMercator";case qy:return"wgs84ToPlateCarree";case Yy:return"wgs84ToWGS84ECEF";case T2:return"webMercatorToWGS84";case vme:return"webMercatorToSphericalECEF";case _me:return"webMercatorToWGS84ECEF";case bme:return"webMercatorToPlateCarree";case Jy:return"wgs84ECEFToWGS84";case Tme:return"wgs84ECEFToSphericalECEF";case Sme:return"wgs84ECEFToWebMercator";case Xy:return"sphericalECEFToWGS84";case wme:return"sphericalECEFToWebMercator";case DV:return"sphericalMarsPCPFToMars2000";case $V:return"sphericalMoonPCPFToMoon2000";case xme:return"sphericalECEFToWGS84ECEF";case IV:return"mars2000ToSphericalPCPF";case PV:return"moon2000ToSphericalPCPF";default:return null}}function dme(e,t,i){return e?"x"in e?pme(e,t,new Gt,i,0):"xmin"in e?WLe(e,t,new ki,i,0):"rings"in e?fme(e,t,new Fa,i,0):"paths"in e?qLe(e,t,new Hc,i,0):"points"in e?HLe(e,t,new Bv,i,0):null:null}function jLe(e,t,i=t.spatialReference,r=0){return!J(i)&&L(pme(e,e.spatialReference,t,i,r))}function pme(e,t,i,r,s){vr[0]=e.x,vr[1]=e.y;const n=e.z;return vr[2]=n!==void 0?n:s,ys(vr,t,0,vr,r,0,1)?(i.x=vr[0],i.y=vr[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=vr[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function HLe(e,t,i,r,s){const{points:n,hasZ:a,hasM:l}=e,p=[],y=n.length,b=[];for(const x of n)b.push(x[0],x[1],a?x[2]:s);if(!ys(b,t,0,b,r,0,y))return null;for(let x=0;x<y;++x){const A=3*x,M=b[A],P=b[A+1];a&&l?p.push([M,P,b[A+2],n[x][3]]):a?p.push([M,P,b[A+2]]):l?p.push([M,P,n[x][2]]):p.push([M,P])}return i.points=p,i.spatialReference=r,i.hasZ=a,i.hasM=l,i}function qLe(e,t,i,r,s){const{paths:n,hasZ:a,hasM:l}=e,p=[];return gme(n,a,l,t,p,r,s)?(i.paths=p,i.spatialReference=r,i.hasZ=a,i.hasM=l,i):null}function L3t(e,t,i=t.spatialReference,r=0){return L(i)&&L(fme(e,e.spatialReference,t,i,r))}function fme(e,t,i,r,s){const{rings:n,hasZ:a,hasM:l}=e,p=[];return gme(n,a,l,t,p,r,s)?(i.rings=p,i.spatialReference=r,i.hasZ=a,i.hasM=l,i):null}function WLe(e,t,i,r,s){const{xmin:n,ymin:a,xmax:l,ymax:p,hasZ:y,hasM:b}=e;return Ote(n,a,y?e.zmin:s,t,vr,r)?(i.xmin=vr[0],i.ymin=vr[1],y&&(i.zmin=vr[2]),Ote(l,p,y?e.zmax:s,t,vr,r)?(i.xmax=vr[0],i.ymax=vr[1],y&&(i.zmax=vr[2]),b&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function Sv(e,t,i){if(J(t)||J(i))return null;const r=new Gt({spatialReference:i});return ys(e,t,0,vr,i,0,1)?(r.x=vr[0],r.y=vr[1],r.z=vr[2],r):null}function mme(e,t,i){return ys(e,t,0,vr,i.spatialReference,0,1)?(i.x=vr[0],i.y=vr[1],i.z=vr[2],i):null}function To(e,t,i,r=0){vr[0]=e.x,vr[1]=e.y;const s=e.z;return vr[2]=s!==void 0?s:r,ys(vr,e.spatialReference,0,t,i,0,1)}function Ote(e,t,i,r,s,n){return Ds[0]=e,Ds[1]=t,Ds[2]=i,ys(Ds,r,0,s,n,0,1)}function Ho(e,t,i,r){return!(J(t)||J(r)||e.length<2)&&(e.length===2&&(Ds[0]=e[0],Ds[1]=e[1],Ds[2]=0,e=Ds),ys(e,t,0,i,r,0,1))}function XLe(e,t){vr[0]=e.x,vr[1]=e.y;const i=e.z;return vr[2]=i!==void 0?i:0,YLe(vr,e.spatialReference,t)}function YLe(e,t,i){return JLe(e,t,i)}function JLe(e,t,i){if(J(t))return!1;const r=Ev(t,iN),s=Zf[r][Re.WGS84_COMPARABLE_LON_LAT];return!J(s)&&(s(e,0,Ds,0),i!==Ds&&(i[0]=Ds[0],i[1]=Ds[1],i.length>2&&(i[2]=Ds[2])),!0)}function ys(e,t,i,r,s,n,a=1){const l=SX(t,s,AX);if(J(l))return!1;if(l===Zr){if(e===r&&i===n)return!0;const y=i+3*a;for(let b=i,x=n;b<y;b++,x++)r[x]=e[b];return!0}const p=i+3*a;for(let y=i,b=n;y<p;y+=3,b+=3)l(e,y,r,b);return!0}function N3t(e,t,i,r,s){ke(vr,e),Xe(l5,e,t),Ho(vr,i,vr,s),Ho(l5,i,l5,s),We(r,l5,vr),ot(r,r)}function gme(e,t,i,r,s,n,a=0){const l=new Array;for(const y of e)for(const b of y)l.push(b[0],b[1],t?b[2]:a);if(!ys(l,r,0,l,n,0,l.length/3))return!1;let p=0;s.length=0;for(const y of e){const b=new Array;for(const x of y)t&&i?b.push([l[p++],l[p++],l[p++],x[3]]):t?b.push([l[p++],l[p++],l[p++]]):i?(b.push([l[p++],l[p++],x[2]]),p++):(b.push([l[p++],l[p++]]),p++);s.push(b)}return!0}function F3t(e,t,i,r){if(J(t)||J(r))return!1;const s=Eme(t,r,sNe);if(s.projector===Zr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(J(s.projector))return!1;const{source:n,dest:a}=s;if(a.spatialReferenceId===Re.WEB_MERCATOR){const l=Zf[n.spatialReferenceId][Re.WGS84];return!J(l)&&(l(e,0,ap,0),Y2(ap,0,i,0),i[3]=Pte(ap[1],e[2],e[3],ar.radius),!0)}if(n.spatialReferenceId!==Re.WGS84&&n.spatialReferenceId!==Re.CGCS2000||a.spatialReferenceId!==Re.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/a.metersPerUnit;else{const l=Zf[n.spatialReferenceId][Re.SPHERICAL_ECEF],p=Zf[Re.SPHERICAL_ECEF][Re.PLATE_CARREE];let y=e[3];L(l)&&L(p)&&(y=Pte(e[1],e[2],e[3],ar.radius)),s.projector(e,0,i,0),i[3]=y}return!0}function Pte(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(_p*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function tN(e,t,i,r){return e!=null&&(Vo(t,r)?(bv(i,e),!0):(Ds[0]=e[0],Ds[1]=e[1],Ds[2]=0,!!ys(Ds,t,0,Ds,r,0,1)&&(i[0]=Ds[0],i[1]=Ds[1],Ds[0]=e[2],Ds[1]=e[3],Ds[2]=0,!!ys(Ds,t,0,Ds,r,0,1)&&(i[2]=Ds[0],i[3]=Ds[1],!0))))}function k3t(e,t,i,r){if(J(t)||J(r))return!1;const s=Ev(t,iN),n=Ev(r,Ame);if(s===n&&s!==Re.UNKNOWN||Vo(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===Re.SPHERICAL_ECEF){const a=yt(e),l=a/Math.sqrt(e[0]*e[0]+e[1]*e[1]),p=a/ar.radius;if(n===Re.WEB_MERCATOR)return i[0]=l*p,i[1]=l*p,i[2]=1,!0;if(n===Re.WGS84||n===Re.CGCS2000){const y=bM;return i[0]=y*l*p,i[1]=y*p,i[2]=1,!0}}else if(s===Re.PLATE_CARREE){if(n===Re.WGS84||n===Re.CGCS2000)return i[0]=bM,i[1]=bM,i[2]=1,!0;if(n===Re.WEB_MERCATOR){const a=e[1]/ar.radius;return i[0]=1,i[1]=1/Math.cos(a),i[2]=1,!0}}return!1}function kp(e,t,i,r){if(J(e)||J(r))return!1;const s=Ev(e,iN),n=Ev(r,Ame);if(s===n&&!Ite(n)&&(s!==Re.UNKNOWN||Vo(e,r)))return QL(i,t),!0;if(Ite(n)){const a=Zf[s][Re.LON_LAT],l=Zf[Re.LON_LAT][n];return!J(a)&&!J(l)&&(a(t,0,ap,0),l(ap,0,c1,0),yme(_p*ap[0],_p*ap[1],i),i[12]=c1[0],i[13]=c1[1],i[14]=c1[2],!0)}if((n===Re.WEB_MERCATOR||n===Re.PLATE_CARREE)&&(s===Re.WGS84||s===Re.CGCS2000&&n===Re.PLATE_CARREE||s===Re.SPHERICAL_ECEF||s===Re.WEB_MERCATOR)){const a=Zf[s][Re.LON_LAT],l=Zf[Re.LON_LAT][n];return!J(a)&&!J(l)&&(a(t,0,ap,0),l(ap,0,c1,0),s===Re.SPHERICAL_ECEF?ZLe(_p*ap[0],_p*ap[1],i):p0(i),i[12]=c1[0],i[13]=c1[1],i[14]=c1[2],!0)}return!1}function Ite(e){return e===Re.SPHERICAL_ECEF||e===Re.SPHERICAL_MARS_PCPF||e===Re.SPHERICAL_MOON_PCPF}function yme(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),a=Math.cos(t),l=i;return l[0]=-r,l[4]=-n*s,l[8]=a*s,l[12]=0,l[1]=s,l[5]=-n*r,l[9]=a*r,l[13]=0,l[2]=0,l[6]=a,l[10]=n,l[14]=0,l[3]=0,l[7]=0,l[11]=0,l[15]=1,l}function ZLe(e,t,i){return yme(e,t,i),oc(i,i),i}function Ev(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=lh(e,1)),e.wkt===j0e.wkt?t.spatialReferenceId=Re.SPHERICAL_ECEF:cR(e)?t.spatialReferenceId=Re.WGS84:c0(e)?t.spatialReferenceId=Re.WEB_MERCATOR:pfe(e)?t.spatialReferenceId=Re.PLATE_CARREE:e.wkt===qDe.wkt?t.spatialReferenceId=Re.WGS84_ECEF:e.wkid===td.CGCS2000?t.spatialReferenceId=Re.CGCS2000:e.wkt===P6.wkt?t.spatialReferenceId=Re.SPHERICAL_MARS_PCPF:e.wkt===I6.wkt?t.spatialReferenceId=Re.SPHERICAL_MOON_PCPF:S0(e)?t.spatialReferenceId=Re.GCSMARS2000:E0(e)?t.spatialReferenceId=Re.GCSMOON2000:t.spatialReferenceId=Re.UNKNOWN)}function Zr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function T2(e,t,i,r){i[r++]=fS*(e[t++]/ar.radius),i[r++]=fS*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/ar.radius))),i[r]=e[t]}function vme(e,t,i,r){T2(e,t,i,r),Wy(i,r,i,r)}function _me(e,t,i,r){T2(e,t,i,r),Yy(i,r,i,r)}function wX(e,t,i,r,s){const n=.4999999*Math.PI,a=Ot(_p*e[t+1],-n,n),l=Math.sin(a);i[r++]=_p*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),i[r]=e[t+2]}function Y2(e,t,i,r){wX(e,t,i,r,ar)}(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(Re||(Re={}));const $te=ar.radius*Math.PI/180,bM=180/(ar.radius*Math.PI);function qy(e,t,i,r){i[r]=e[t]*$te,i[r+1]=e[t+1]*$te,i[r+2]=e[t+2]}function o2(e,t,i,r){i[r]=e[t]*bM,i[r+1]=e[t+1]*bM,i[r+2]=e[t+2]}function bme(e,t,i,r){T2(e,t,i,r),qy(i,r,i,r)}function KLe(e,t,i,r){Jy(e,t,i,r),qy(i,r,i,r)}function QLe(e,t,i,r){Xy(e,t,i,r),qy(i,r,i,r)}function eNe(e,t,i,r){o2(e,t,i,r),Wy(i,r,i,r)}function tNe(e,t,i,r){o2(e,t,i,r),Y2(i,r,i,r)}function iNe(e,t,i,r){o2(e,t,i,r),Yy(i,r,i,r)}function J2(e){if(J(e))return!1;const t=Ev(e,iN);return!!Zf[t][Re.WGS84_COMPARABLE_LON_LAT]}function HE(e,t,i,r,s=0){const n=r+s,a=Math.cos(i);e[0]=Math.cos(t)*a*n,e[1]=Math.sin(t)*a*n,e[2]=Math.sin(i)*n}function xX(e,t,i,r,s){const n=s+e[t+2],a=_p*e[t+1],l=_p*e[t],p=Math.cos(a);i[r++]=Math.cos(l)*p*n,i[r++]=Math.sin(l)*p*n,i[r]=Math.sin(a)*n}function PV(e,t,i,r){xX(e,t,i,r,Sg.radius)}function IV(e,t,i,r){xX(e,t,i,r,Qf.radius)}function Wy(e,t,i,r){xX(e,t,i,r,ar.radius)}function TX(e,t,i,r,s){const n=e[t],a=e[t+1],l=e[t+2],p=Math.sqrt(n*n+a*a+l*l),y=$p(l/(p===0?1:p)),b=Math.atan2(a,n);i[r++]=fS*b,i[r++]=fS*y,i[r]=p-s}function $V(e,t,i,r){TX(e,t,i,r,Sg.radius)}function DV(e,t,i,r){TX(e,t,i,r,Qf.radius)}function Xy(e,t,i,r){TX(e,t,i,r,ar.radius)}function wme(e,t,i,r){Xy(e,t,i,r),Y2(i,r,i,r)}function xme(e,t,i,r){Xy(e,t,i,r),Yy(i,r,i,r)}function rNe(e,t,i,r,s){const n=_p*e[t],a=_p*e[t+1],l=e[t+2],p=Math.sin(a),y=Math.cos(a),b=s.radius/Math.sqrt(1-s.eccentricitySquared*p*p);i[r++]=(b+l)*y*Math.cos(n),i[r++]=(b+l)*y*Math.sin(n),i[r++]=(b*(1-s.eccentricitySquared)+l)*p}function Yy(e,t,i,r){rNe(e,t,i,r,ar)}function Jy(e,t,i,r){const s=LLe,n=e[t],a=e[t+1],l=e[t+2];let p,y,b,x,A,M,P,$,k,z,G,B,W,q,X,oe,de,he,fe,me,ge;p=Math.abs(l),y=n*n+a*a,b=Math.sqrt(y),x=y+l*l,A=Math.sqrt(x),me=Math.atan2(a,n),M=l*l/x,P=y/x,q=s.a2/A,X=s.a3-s.a4/A,P>.3?($=p/A*(1+P*(s.a1+q+M*X)/A),fe=Math.asin($),z=$*$,k=Math.sqrt(1-z)):(k=b/A*(1-M*(s.a5-q-P*X)/A),fe=Math.acos(k),z=1-k*k,$=Math.sqrt(z)),G=1-ar.eccentricitySquared*z,B=ar.radius/Math.sqrt(G),W=s.a6*B,q=b-B*k,X=p-W*$,de=k*q+$*X,oe=k*X-$*q,he=oe/(W/G+de),fe+=he,ge=de+oe*he/2,l<0&&(fe=-fe),i[r++]=fS*me,i[r++]=fS*fe,i[r]=ge}function Tme(e,t,i,r){Jy(e,t,i,r),Wy(i,r,i,r)}function Sme(e,t,i,r){Jy(e,t,i,r),Y2(i,r,i,r)}const Zf={[Re.WGS84]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:Zr,[Re.SPHERICAL_ECEF]:Wy,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:Y2,[Re.PLATE_CARREE]:qy,[Re.WGS84]:Zr,[Re.WGS84_ECEF]:Yy},[Re.CGCS2000]:{[Re.CGCS2000]:Zr,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:Zr,[Re.SPHERICAL_ECEF]:Wy,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:qy,[Re.WGS84]:null,[Re.WGS84_ECEF]:Yy},[Re.GCSMARS2000]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:Zr,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:null,[Re.SPHERICAL_ECEF]:null,[Re.SPHERICAL_MARS_PCPF]:IV,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:null,[Re.WGS84]:null,[Re.WGS84_ECEF]:null},[Re.GCSMOON2000]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:Zr,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:null,[Re.SPHERICAL_ECEF]:null,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:PV,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:null,[Re.WGS84]:null,[Re.WGS84_ECEF]:null},[Re.WEB_MERCATOR]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:T2,[Re.WGS84_COMPARABLE_LON_LAT]:T2,[Re.SPHERICAL_ECEF]:vme,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:Zr,[Re.PLATE_CARREE]:bme,[Re.WGS84]:T2,[Re.WGS84_ECEF]:_me},[Re.WGS84_ECEF]:{[Re.CGCS2000]:Jy,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Jy,[Re.WGS84_COMPARABLE_LON_LAT]:Jy,[Re.SPHERICAL_ECEF]:Tme,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:Sme,[Re.PLATE_CARREE]:KLe,[Re.WGS84]:Jy,[Re.WGS84_ECEF]:Zr},[Re.SPHERICAL_ECEF]:{[Re.CGCS2000]:Xy,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Xy,[Re.WGS84_COMPARABLE_LON_LAT]:Xy,[Re.SPHERICAL_ECEF]:Zr,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:wme,[Re.PLATE_CARREE]:QLe,[Re.WGS84]:Xy,[Re.WGS84_ECEF]:xme},[Re.SPHERICAL_MARS_PCPF]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:DV,[Re.GCSMOON2000]:null,[Re.LON_LAT]:DV,[Re.WGS84_COMPARABLE_LON_LAT]:null,[Re.SPHERICAL_ECEF]:null,[Re.SPHERICAL_MARS_PCPF]:Zr,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:null,[Re.WGS84]:null,[Re.WGS84_ECEF]:null},[Re.SPHERICAL_MOON_PCPF]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:$V,[Re.LON_LAT]:$V,[Re.WGS84_COMPARABLE_LON_LAT]:null,[Re.SPHERICAL_ECEF]:null,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:Zr,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:null,[Re.WGS84]:null,[Re.WGS84_ECEF]:null},[Re.UNKNOWN]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:null,[Re.WGS84_COMPARABLE_LON_LAT]:null,[Re.SPHERICAL_ECEF]:null,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:Zr,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:null,[Re.WGS84]:null,[Re.WGS84_ECEF]:null},[Re.LON_LAT]:{[Re.CGCS2000]:Zr,[Re.GCSMARS2000]:Zr,[Re.GCSMOON2000]:Zr,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:Zr,[Re.SPHERICAL_ECEF]:Wy,[Re.SPHERICAL_MARS_PCPF]:IV,[Re.SPHERICAL_MOON_PCPF]:PV,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:Y2,[Re.PLATE_CARREE]:qy,[Re.WGS84]:Zr,[Re.WGS84_ECEF]:Yy},[Re.WGS84_COMPARABLE_LON_LAT]:{[Re.CGCS2000]:null,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:Zr,[Re.WGS84_COMPARABLE_LON_LAT]:Zr,[Re.SPHERICAL_ECEF]:Wy,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:null,[Re.PLATE_CARREE]:qy,[Re.WGS84]:Zr,[Re.WGS84_ECEF]:Yy},[Re.PLATE_CARREE]:{[Re.CGCS2000]:o2,[Re.GCSMARS2000]:null,[Re.GCSMOON2000]:null,[Re.LON_LAT]:o2,[Re.WGS84_COMPARABLE_LON_LAT]:o2,[Re.SPHERICAL_ECEF]:eNe,[Re.SPHERICAL_MARS_PCPF]:null,[Re.SPHERICAL_MOON_PCPF]:null,[Re.UNKNOWN]:null,[Re.WEB_MERCATOR]:tNe,[Re.PLATE_CARREE]:Zr,[Re.WGS84]:o2,[Re.WGS84_ECEF]:iNe}};function SX(e,t,i=EX()){return J(e)||J(t)?null:Eme(e,t,i).projector}function Eme(e,t,i){if(J(e)||J(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=Ev(e,i.source),s=Ev(t,i.dest);return r===Re.UNKNOWN&&s===Re.UNKNOWN?Vo(e,t)?i.projector=Zr:i.projector=null:i.projector=Zf[r][s],i}function EX(){return{source:{spatialReference:null,spatialReferenceId:Re.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Re.UNKNOWN,metersPerUnit:1},projector:Zr}}const iN={spatialReference:null,spatialReferenceId:Re.UNKNOWN},Ame={spatialReference:null,spatialReferenceId:Re.UNKNOWN},AX=EX(),sNe=EX(),_p=xi(1),fS=th(1),Ds=Q(),ap=Q(),c1=Q(),vr=Q(),l5=Q();class Bg{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&HT(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Dte);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,Dte));t++)this._items.push(this.allocator())}}const Dte=1024;function lt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function S2(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function CX(e,t,i,r,s,n,a,l,p,y,b,x,A,M,P,$){return[e,t,i,r,s,n,a,l,p,y,b,x,A,M,P,$]}function Cme(e,t){return new Float64Array(e,t,16)}const Rn=lt();Object.freeze({__proto__:null,create:lt,clone:S2,fromValues:CX,createView:Cme,IDENTITY:Rn});var Jh;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Jh||(Jh={}));function nNe(e){return 32+e.length}function oNe(){return 16}function Mme(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=nNe(r);break;case"number":t+=oNe();break;case"boolean":t+=4}}return t}function U3t(e,t){return 32+e.length*t}var mS;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(mS||(mS={}));function zs(){return[1,0,0,0,1,0,0,0,1]}function aNe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function lNe(e,t,i,r,s,n,a,l,p){return[e,t,i,r,s,n,a,l,p]}function Rme(e,t){return new Float64Array(e,t,9)}Object.freeze({__proto__:null,create:zs,clone:aNe,fromValues:lNe,createView:Rme});function Hv(){return[0,0,0,1]}function cNe(e){return[e[0],e[1],e[2],e[3]]}function hNe(e,t,i,r){return[e,t,i,r]}function Ome(e,t){return new Float64Array(e,t,4)}const uNe=Hv();Object.freeze({__proto__:null,create:Hv,clone:cNe,fromValues:hNe,createView:Ome,IDENTITY:uNe});function St(){return[0,0]}function a2(e){return[e[0],e[1]]}function yr(e,t){return[e,t]}function dNe(e){const t=St(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Pme(e,t){return new Float64Array(e,t,2)}function Ime(){return St()}function $me(){return yr(1,1)}function Dme(){return yr(1,0)}function Lme(){return yr(0,1)}const LV=Ime(),pNe=$me(),fNe=Dme(),mNe=Lme();Object.freeze({__proto__:null,create:St,clone:a2,fromValues:yr,fromArray:dNe,createView:Pme,zeros:Ime,ones:$me,unitX:Dme,unitY:Lme,ZEROS:LV,ONES:pNe,UNIT_X:fNe,UNIT_Y:mNe});function nr(){return[0,0,0,0]}function rN(e){return[e[0],e[1],e[2],e[3]]}function _r(e,t,i,r){return[e,t,i,r]}function MX(e){const t=nr(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Nme(e,t){return new Float64Array(e,t,4)}function Fme(){return nr()}function kme(){return _r(1,1,1,1)}function Ume(){return _r(1,0,0,0)}function zme(){return _r(0,1,0,0)}function Bme(){return _r(0,0,1,0)}function Vme(){return _r(0,0,0,1)}const E2=Fme(),Xf=kme(),gNe=Ume(),yNe=zme(),vNe=Bme(),_Ne=Vme();Object.freeze({__proto__:null,create:nr,clone:rN,fromValues:_r,fromArray:MX,createView:Nme,zeros:Fme,ones:kme,unitX:Ume,unitY:zme,unitZ:Bme,unitW:Vme,ZEROS:E2,ONES:Xf,UNIT_X:gNe,UNIT_Y:yNe,UNIT_Z:vNe,UNIT_W:_Ne});class zh{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&HT(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=Gw){return new zh(16,Pme,t)}static createVec3f64(t=Gw){return new zh(24,qq,t)}static createVec4f64(t=Gw){return new zh(32,Nme,t)}static createMat3f64(t=Gw){return new zh(72,Rme,t)}static createMat4f64(t=Gw){return new zh(128,Cme,t)}static createQuatf64(t=Gw){return new zh(32,Ome,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const Gw=4*mS.KILOBYTES,z3t=zh.createVec2f64(),Tt=zh.createVec3f64(),RX=zh.createVec4f64();zh.createMat3f64();const zO=zh.createMat4f64(),B3t=zh.createQuatf64();function M0(e){return e?{origin:qn(e.origin),vector:qn(e.vector)}:{origin:Q(),vector:Q()}}function bNe(e,t){const i=xNe.get();return i.origin=e,i.vector=t,i}function V3t(e,t=M0()){return wNe(e.origin,e.vector,t)}function wNe(e,t,i=M0()){return ke(i.origin,e),ke(i.vector,t),i}function A2(e,t,i=M0()){return ke(i.origin,e),We(i.vector,t,e),i}function OX(e,t){const i=We(Tt.get(),t,e.origin),r=rt(e.vector,i),s=rt(e.vector,e.vector),n=Ot(r/s,0,1),a=We(Tt.get(),Ue(Tt.get(),e.vector,n),i);return rt(a,a)}function G3t(e,t,i){return Xe(i,e.origin,Ue(i,e.vector,t))}function Lte(e,t,i,r,s){const{vector:n,origin:a}=e,l=We(Tt.get(),t,a),p=rt(n,l)/dl(n);return Ue(s,n,Ot(p,i,r)),Xe(s,s,e.origin)}function j3t(e,t){if(jme(e,bNe(t.origin,t.direction),!1,B6)){const{tA:i,pB:r,distance2:s}=B6;if(i>=0&&i<=1)return s;if(i<0)return wo(e.origin,r);if(i>1)return wo(Xe(Tt.get(),e.origin,e.vector),r)}return null}function Gme(e,t,i){return!!jme(e,t,!0,B6)&&(ke(i,B6.pA),!0)}function jme(e,t,i,r){const n=e.origin,a=Xe(Tt.get(),n,e.vector),l=t.origin,p=Xe(Tt.get(),l,t.vector),y=Tt.get(),b=Tt.get();if(y[0]=n[0]-l[0],y[1]=n[1]-l[1],y[2]=n[2]-l[2],b[0]=p[0]-l[0],b[1]=p[1]-l[1],b[2]=p[2]-l[2],Math.abs(b[0])<1e-6&&Math.abs(b[1])<1e-6&&Math.abs(b[2])<1e-6)return!1;const x=Tt.get();if(x[0]=a[0]-n[0],x[1]=a[1]-n[1],x[2]=a[2]-n[2],Math.abs(x[0])<1e-6&&Math.abs(x[1])<1e-6&&Math.abs(x[2])<1e-6)return!1;const A=y[0]*b[0]+y[1]*b[1]+y[2]*b[2],M=b[0]*x[0]+b[1]*x[1]+b[2]*x[2],P=y[0]*x[0]+y[1]*x[1]+y[2]*x[2],$=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],k=(x[0]*x[0]+x[1]*x[1]+x[2]*x[2])*$-M*M;if(Math.abs(k)<1e-6)return!1;let z=(A*M-P*$)/k,G=(A+M*z)/$;i&&(z=Ot(z,0,1),G=Ot(G,0,1));const B=Tt.get(),W=Tt.get();return B[0]=n[0]+z*x[0],B[1]=n[1]+z*x[1],B[2]=n[2]+z*x[2],W[0]=l[0]+G*b[0],W[1]=l[1]+G*b[1],W[2]=l[2]+G*b[2],r.tA=z,r.tB=G,r.pA=B,r.pB=W,r.distance2=wo(B,W),!0}const B6={tA:0,tB:0,pA:Q(),pB:Q(),distance2:0},xNe=new Bg(()=>({origin:null,vector:null}));function ua(e){return e?{origin:qn(e.origin),direction:qn(e.direction)}:{origin:Q(),direction:Q()}}function H3t(e,t){return $2(e.origin,t.origin)&&$2(e.direction,t.direction)}function iu(e,t){const i=CNe.get();return i.origin=e,i.direction=t,i}function V6(e,t=ua()){return Hme(e.origin,e.direction,t)}function TNe(e,t,i=ua()){return ke(i.origin,e),We(i.direction,t,e),i}function Hme(e,t,i=ua()){return ke(i.origin,e),ke(i.direction,t),i}function SNe(e,t){const i=si(Tt.get(),ot(Tt.get(),e.direction),We(Tt.get(),t,e.origin));return rt(i,i)}function ENe(e,t,i){const r=rt(e.direction,We(i,t,e.origin));return Xe(i,e.origin,Ue(i,e.direction,r)),i}function ANe(){return{origin:null,direction:null}}const CNe=new Bg(ANe);function q3t(e,t,i){const r=rt(e,t)/rt(e,e);return Ue(i,e,r)}function wM(e,t){return rt(e,t)/yt(e)}function PX(e,t){const i=rt(e,t)/(yt(e)*yt(t));return-Xn(i)}function MNe(e,t,i){ot(c5,e),ot(JF,t);const r=rt(c5,JF),s=Xn(r),n=si(c5,c5,JF);return rt(n,i)<0?2*Math.PI-s:s}const c5=Q(),JF=Q(),RNe=Ge.getLogger("esri.geometry.support.sphere");function qo(){return nr()}function gS(e,t=qo()){return Yl(t,e)}function qme(e,t){return _r(e[0],e[1],e[2],t)}function ONe(e){return e}function Wme(e){e[0]=e[1]=e[2]=e[3]=0}function PNe(e){return e}function sN(e){return Array.isArray(e)?e[3]:e}function ru(e){return Array.isArray(e)?e:kNe}function Xme(e,t,i,r){return _r(e,t,i,r)}function INe(e,t,i){return e!==i&&ke(i,e),i[3]=e[3]+t,i}function $Ne(e,t,i){return RNe.error("sphere.setExtent is not yet supported"),e===i?i:gS(e,i)}function qv(e,t,i){if(J(t))return!1;const{origin:r,direction:s}=t,n=DNe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],l=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),p=l*l-4*a*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(p<0)return!1;const y=Math.sqrt(p);let b=(-l-y)/(2*a);const x=(-l+y)/(2*a);return(b<0||x<b&&x>0)&&(b=x),!(b<0)&&(i&&(i[0]=r[0]+s[0]*b,i[1]=r[1]+s[1]*b,i[2]=r[2]+s[2]*b),!0)}const DNe=Q();function NV(e,t){return qv(e,t,null)}function LNe(e,t,i){if(qv(e,t,i))return i;const r=gE(e,t,Tt.get());return Xe(i,t.origin,Ue(Tt.get(),t.direction,Er(t.origin,r)/yt(t.direction))),i}function gE(e,t,i){const r=Tt.get(),s=zO.get();si(r,t.origin,t.direction);const n=sN(e);si(i,r,t.origin),Ue(i,i,1/yt(i)*n);const a=Zme(e,t.origin),l=PX(t.origin,i);return ah(s,l+a,r),Ct(i,i,s),i}function NNe(e,t,i){return qv(e,t,i)?i:(ENe(t,ru(e),i),Yme(e,i,i))}function Yme(e,t,i){const r=We(Tt.get(),t,ru(e)),s=Ue(Tt.get(),r,e[3]/yt(r));return Xe(i,s,ru(e))}function Jme(e,t){const i=We(Tt.get(),t,ru(e)),r=dl(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Zme(e,t){const i=We(Tt.get(),t,ru(e)),r=yt(i),s=sN(e),n=s+Math.abs(s-r);return Xn(s/n)}const ZF=Q();function Kme(e,t,i,r){const s=We(ZF,t,ru(e));switch(i){case Jh.X:{const n=zQ(s,ZF)[2];return ze(r,-Math.sin(n),Math.cos(n),0)}case Jh.Y:{const n=zQ(s,ZF),a=n[1],l=n[2],p=Math.sin(a);return ze(r,-p*Math.cos(l),-p*Math.sin(l),Math.cos(a))}case Jh.Z:return ot(r,s);default:return}}function Qme(e,t){const i=We(FV,t,ru(e));return yt(i)-e[3]}function FNe(e,t,i,r){const s=Qme(e,t),n=Kme(e,t,Jh.Z,FV),a=Ue(FV,n,i-s);return Xe(r,t,a)}const kNe=Q(),FV=Q(),UNe=Object.freeze({__proto__:null,create:qo,copy:gS,fromCenterAndRadius:qme,wrap:ONe,clear:Wme,fromRadius:PNe,getRadius:sN,getCenter:ru,fromValues:Xme,elevate:INe,setExtent:$Ne,intersectRay:qv,intersectsRay:NV,intersectRayClosestSilhouette:LNe,closestPointOnSilhouette:gE,closestPoint:NNe,projectPoint:Yme,distanceToSilhouette:Jme,angleToSilhouette:Zme,axisAt:Kme,altitudeAt:Qme,setAltitudeAt:FNe});function er(e=XNe){return[e[0],e[1],e[2],e[3]]}function zNe(e,t,i,r){return IX(e,t,i,r,RX.get())}function nN(e,t){return IX(t[0],t[1],t[2],t[3],e)}function IX(e,t,i,r,s=er()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function ege(e,t,i){return ke(i,e),i[3]=t,i}function yS(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function Pa(e,t,i,r=er()){const s=i[0]-t[0],n=i[1]-t[1],a=i[2]-t[2],l=e[0]-t[0],p=e[1]-t[1],y=e[2]-t[2],b=n*y-a*p,x=a*l-s*y,A=s*p-n*l,M=b*b+x*x+A*A,P=Math.abs(M-1)>1e-5&&M>1e-12?1/Math.sqrt(M):1;r[0]=b*P,r[1]=x*P,r[2]=A*P,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2])}function tge(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,qE);let n=r,a=!1;for(;n<e.count-1&&!a;)e.getVec(n,jw),n++,a=!jc(qE,jw);if(!a)return!1;for(n=Math.max(n,s),a=!1;n<e.count&&!a;)e.getVec(n,jb),n++,We(h5,qE,jw),ot(h5,h5),We(u5,jw,jb),ot(u5,u5),a=!jc(qE,jb)&&!jc(jw,jb)&&Math.abs(rt(h5,u5))<BNe;return a?(Pa(qE,jw,jb,t),!0):(i!==0||r!==1||s!==2)&&tge(e,t,0,1,2)}const BNe=.99619469809,qE=Q(),jw=Q(),jb=Q(),h5=Q(),u5=Q();function kV(e,t,i){return t!==e&&nN(e,t),e[3]=-rt(e,i),e}function UV(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function vR(e,t,i,r){return si(jb,t,e),yS(i,jb,r)}function W3t(e,t,i,r){return oN(e,t,We(Tt.get(),i,t),YNe,r)}function Ow(e,t,i){return!!L(t)&&oN(e,t.origin,t.direction,JNe,i)}function VNe(e,t,i){return oN(e,t.origin,t.vector,i0.NONE,i)}function GNe(e,t,i){return oN(e,t.origin,t.vector,i0.CLAMP,i)}function ige(e,t){return Kr(e,t)>=0}function jNe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:a)+e[2]*(e[2]>0?s:l)+e[3]>=0}function HNe(e,t){const i=rt(e,t.ray.direction),r=-Kr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function qNe(e,t){const i=rt(e,t.ray.direction),r=-Kr(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function WNe(e,t,i){const r=Ue(Tt.get(),e,-e[3]),s=zV(e,We(Tt.get(),t,r),Tt.get());return Xe(i,s,r),i}function zV(e,t,i){const r=Ue(Tt.get(),e,rt(e,t));return We(i,t,r),i}function Kr(e,t){return rt(e,t)+e[3]}function oN(e,t,i,r,s){const n=rt(e,i);if(n===0)return!1;let a=-(rt(e,t)+e[3])/n;return r&i0.CLAMP&&(a=Ot(a,0,1)),!(!(r&i0.INFINITE_MIN)&&a<0||!(r&i0.INFINITE_MAX)&&a>1)&&(Xe(s,t,Ue(s,i,a)),!0)}function X3t(e){return e}const XNe=[0,0,1,0];var i0;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(i0||(i0={}));const YNe=i0.INFINITE_MIN|i0.INFINITE_MAX,JNe=i0.INFINITE_MAX,KF=Ge.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class rge{constructor(){this.plane=er(),this.origin=Q(),this.basis1=Q(),this.basis2=Q()}}function Pw(e=fge){return{plane:er(e.plane),origin:qn(e.origin),basis1:qn(e.basis1),basis2:qn(e.basis2)}}function ZNe(e,t,i){const r=c8e.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=zNe(0,0,0,0),aN(r),r}function yE(e,t=Pw()){return $X(e.origin,e.basis1,e.basis2,t)}function sge(e,t){ke(t.origin,e.origin),ke(t.basis1,e.basis1),ke(t.basis2,e.basis2),nN(t.plane,e.plane)}function $X(e,t,i,r=Pw()){return ke(r.origin,e),ke(r.basis1,t),ke(r.basis2,i),aN(r),a8e(r,"fromValues()"),r}function aN(e){vR(e.basis2,e.basis1,e.origin,e.plane)}function nge(e,t,i){e!==i&&yE(e,i);const r=Ue(Tt.get(),Cg(e),t);return Xe(i.origin,i.origin,r),i.plane[3]-=t,i}function KNe(e,t,i){return oge(t,i),nge(i,FX(e,e.origin),i),i}function oge(e,t=Pw()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return ze(t.origin,e[0]+i,e[1]+r,0),ze(t.basis1,i,0,0),ze(t.basis2,0,r,0),IX(0,0,1,0,t.plane),t}function DX(e,t,i){return!!Ow(e.plane,t,i)&&dge(e,i)}function QNe(e,t,i){if(DX(e,t,i))return i;const r=age(e,t,Tt.get());return Xe(i,t.origin,Ue(Tt.get(),t.direction,Er(t.origin,r)/yt(t.direction))),i}function age(e,t,i){const r=G6.get();pge(e,t,r,G6.get());let s=Number.POSITIVE_INFINITY;for(const n of UX){const a=kX(e,n,lN.get()),l=Tt.get();if(VNe(r,a,l)){const p=kg(Tt.get(),t.origin,l),y=Math.abs(Xn(rt(t.direction,p)));y<s&&(s=y,ke(i,l))}}return s===Number.POSITIVE_INFINITY?lge(e,t,i):i}function lge(e,t,i){if(DX(e,t,i))return i;const r=G6.get(),s=G6.get();pge(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const a of UX){const l=kX(e,a,lN.get()),p=Tt.get();if(GNe(r,l,p)){const y=SNe(t,p);if(!ige(s,p))continue;y<n&&(n=y,ke(i,p))}}return LX(e,t.origin)<n&&cge(e,t.origin,i),i}function cge(e,t,i){const r=WNe(e.plane,t,Tt.get()),s=Lte(Nte(e,e.basis1),r,-1,1,Tt.get()),n=Lte(Nte(e,e.basis2),r,-1,1,Tt.get());return We(i,Xe(Tt.get(),s,n),e.origin),i}function hge(e,t,i){const{origin:r,basis1:s,basis2:n}=e,a=We(Tt.get(),t,r),l=wM(s,a),p=wM(n,a),y=wM(Cg(e),a);return ze(i,l,p,y)}function LX(e,t){const i=hge(e,t,Tt.get()),{basis1:r,basis2:s}=e,n=yt(r),a=yt(s),l=Math.max(Math.abs(i[0])-n,0),p=Math.max(Math.abs(i[1])-a,0),y=i[2];return l*l+p*p+y*y}function e8e(e,t){return Math.sqrt(LX(e,t))}function t8e(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of UX){const s=kX(e,r,lN.get()),n=OX(s,t);n>i&&(i=n)}return Math.sqrt(i)}function NX(e,t){return ige(e.plane,t)&&dge(e,t)}function i8e(e,t,i,r){return o8e(e,i,r)}function FX(e,t){const i=-e.plane[3];return wM(Cg(e),t)-i}function r8e(e,t,i,r){const s=FX(e,t),n=Ue(l8e,Cg(e),i-s);return Xe(r,t,n),r}function s8e(e,t){return jc(e.basis1,t.basis1)&&jc(e.basis2,t.basis2)&&jc(e.origin,t.origin)}function uge(e,t,i){return e!==i&&yE(e,i),Ms(Hw,t),oc(Hw,Hw),Ct(i.basis1,e.basis1,Hw),Ct(i.basis2,e.basis2,Hw),Ct(i.plane,e.plane,Hw),Ct(i.origin,e.origin,t),kV(i.plane,i.plane,i.origin),i}function n8e(e,t,i,r){return e!==r&&yE(e,r),ah(QF,t,i),Ct(r.basis1,e.basis1,QF),Ct(r.basis2,e.basis2,QF),aN(r),r}function Cg(e){return e.plane}function o8e(e,t,i){switch(t){case Jh.X:ke(i,e.basis1),ot(i,i);break;case Jh.Y:ke(i,e.basis2),ot(i,i);break;case Jh.Z:ke(i,Cg(e))}return i}function dge(e,t){const i=We(Tt.get(),t,e.origin),r=dl(e.basis1),s=dl(e.basis2),n=rt(e.basis1,i),a=rt(e.basis2,i);return-n-r<0&&n-r<0&&-a-s<0&&a-s<0}function Nte(e,t){const i=lN.get();return ke(i.origin,e.origin),ke(i.vector,t),i}function kX(e,t,i){const{basis1:r,basis2:s,origin:n}=e,a=Ue(Tt.get(),r,t.origin[0]),l=Ue(Tt.get(),s,t.origin[1]);Xe(i.origin,a,l),Xe(i.origin,i.origin,n);const p=Ue(Tt.get(),r,t.direction[0]),y=Ue(Tt.get(),s,t.direction[1]);return Ue(i.vector,Xe(p,p,y),2),i}function a8e(e,t){Math.abs(rt(e.basis1,e.basis2)/(yt(e.basis1)*yt(e.basis2)))>1e-6&&KF.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(rt(e.basis1,Cg(e)))>1e-6&&KF.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-rt(Cg(e),e.origin)-e.plane[3])>1e-6&&KF.warn(t,"Plane offset is not consistent with plane origin")}function pge(e,t,i,r){const s=Cg(e);vR(s,t.direction,t.origin,i),vR(i,s,t.origin,r)}const fge={plane:er(),origin:$t(0,0,0),basis1:$t(1,0,0),basis2:$t(0,1,0)},G6=new Bg(er),lN=new Bg(M0),l8e=Q(),c8e=new Bg(()=>({origin:null,basis1:null,basis2:null,plane:null})),UX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Hw=lt(),QF=lt(),h8e=Object.freeze({__proto__:null,BoundedPlaneClass:rge,create:Pw,wrap:ZNe,copy:yE,copyWithoutVerify:sge,fromValues:$X,updateUnboundedPlane:aN,elevate:nge,setExtent:KNe,fromAABoundingRect:oge,intersectRay:DX,intersectRayClosestSilhouette:QNe,closestPointOnSilhouette:age,closestPoint:lge,projectPoint:cge,projectPointLocal:hge,distance2:LX,distance:e8e,distanceToSilhouette:t8e,extrusionContainsPoint:NX,axisAt:i8e,altitudeAt:FX,setAltitudeAt:r8e,equals:s8e,transform:uge,rotate:n8e,normal:Cg,UP:fge});function u8e(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function d8e(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function p8e(e){return{operations:e,value:e.create()}}function mge(e,t,i=p8e(e)){return i.operations=e,e.copy(t,i.value),i}function f8e(e){return mge(UNe,Xme(0,0,0,ir(e).radius))}const Fte=2**50;function m8e(){return mge(h8e,$X([0,0,0],[Fte,0,0],[0,Fte,0]))}function g8e(e,t,i){return e.operations.axisAt(e.value,t,Jh.Z,i)}function y8e(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function v8e(e,t,i){return e.operations.intersectRay(e.value,t,i)}function _8e(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function b8e(e,t){return e.operations.altitudeAt(e.value,t)}function gge(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function w8e(e,t,i,r){return t!==r&&nn(r,t),ze(qw,r[12],r[13],r[14]),gge(e,qw,i,qw),r[12]=qw[0],r[13]=qw[1],r[14]=qw[2],r}function e7(e,t,i){return e.operations.elevate(e.value,t,i.value)}const qw=Q();function kte(e,t,i,r,s){return s[0]=rt(e,t),s[1]=rt(e,i),s[2]=rt(e,r),s}function BV(e,t,i,r,s){ke(i,e),ke(d5,t),ot(d5,d5),si(r,d5,i),si(s,r,i)}function yge(e,t){return e?JL(t):t.isGeographic?It.PlateCarree:t}const d5=Q(),vge=96;function Y3t(e,t){const i=t||e.extent,r=e.width,s=lh(i&&i.spatialReference);return i&&r?i.width/r*s*H0e*vge:0}function _ge(e,t){return e/(lh(t)*H0e*vge)}var Ute,j6,xM,zte,Hb;(function(e){e[e.Binary=0]="Binary",e[e.JSON=1]="JSON"})(Ute||(Ute={})),function(e){e[e.TreeIndex=0]="TreeIndex",e[e.TreeStats=1]="TreeStats",e[e.TreeData=2]="TreeData",e[e.BrickBundles=3]="BrickBundles",e[e.Section=4]="Section",e[e.VariableStats=5]="VariableStats"}(j6||(j6={})),function(e){e[e.None=1]="None",e[e.Front=2]="Front",e[e.Back=3]="Back"}(xM||(xM={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(zte||(zte={})),function(e){e[e.None=0]="None",e[e.StaticSections=1]="StaticSections",e[e.Slices=2]="Slices",e[e.DynamicSections=4]="DynamicSections",e[e.GhostShell=8]="GhostShell",e[e.Isosurface=16]="Isosurface",e[e.Quality=32]="Quality",e[e.SunLocation=64]="SunLocation",e[e.StaticSectionSelection=128]="StaticSectionSelection",e[e.ExaggerationAndOffset=256]="ExaggerationAndOffset",e[e.CurrentTime=512]="CurrentTime",e[e.CurrentVariable=1024]="CurrentVariable",e[e.DeleteIsosurface=2048]="DeleteIsosurface",e[e.ContainerVisibility=4096]="ContainerVisibility",e[e.RenderMode=8192]="RenderMode",e[e.Optimization=16384]="Optimization"}(Hb||(Hb={}));function x8e(e){return new Promise(t=>import("./vxlLayer.26ce0764.js").then(i=>i.v).then(({default:i})=>{const r=i({locateFile:T8e,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})).catch(t=>Promise.reject(t))}function T8e(e){return hr(`esri/libs/vxl/${e}`)}var bt;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT",e[e.MAX_PASS=8]="MAX_PASS"})(bt||(bt={}));var tt;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_PLUGIN=3]="OPAQUE_PLUGIN",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_PLUGIN=5]="TRANSPARENT_PLUGIN",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=12]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=13]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VOXEL=22]="VOXEL",e[e.MAX_SLOTS=23]="MAX_SLOTS"})(tt||(tt={}));var Yi;function S8e(e,t,i={}){const r=bge(e);for(;r.length>1;){const s=H6(t,r.shift(),i);if(L(s))return s}return E8e(t,r.shift(),i)}function bge(e){const t=je("esri-force-webgl");if(t===Yi.WEBGL1||t===Yi.WEBGL2)return[t];switch(e){case"2d":return[Yi.WEBGL1];case"3d":return[Yi.WEBGL2,Yi.WEBGL1]}}function E8e(e,t,i={}){if(!window.WebGLRenderingContext)return Bte(e,A8e),null;const r=H6(e,t,i);return J(r)&&Bte(e,C8e),r}function H6(e,t,i={}){const r=t===Yi.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function Bte(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(Yi||(Yi={}));const A8e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',C8e=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`;var Sr,mi,ht,f0,ni,Jl,vS,Zt,kr,Gr,Pt,ei,Yt,_t,Jt,ai,hl,tr,Bh,uo,ks,Qi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Sr||(Sr={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(mi||(mi={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ht||(ht={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(f0||(f0={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(ni||(ni={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Jl||(Jl={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(vS||(vS={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(Zt||(Zt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(kr||(kr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(Gr||(Gr={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Pt||(Pt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ei||(ei={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Yt||(Yt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(_t||(_t={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(Jt||(Jt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(ai||(ai={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(hl||(hl={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(tr||(tr={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Bh||(Bh={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(uo||(uo={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(ks||(ks={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Qi||(Qi={}));const t7=33984;var so,Mh;(function(e){e[e.Texture=0]="Texture",e[e.Buffer=1]="Buffer",e[e.VAO=2]="VAO",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.Framebuffer=5]="Framebuffer",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(so||(so={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Mh||(Mh={}));const Vte=33306;var Hs,ol,Gte,jte,q6,VV,Hte;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Hs||(Hs={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ol||(ol={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Gte||(Gte={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(jte||(jte={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(q6||(q6={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(VV||(VV={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Hte||(Hte={}));const WE=Ge.getLogger("esri.layers.VoxelWasmPerScene");var Dr;(function(e){e[e.Lifetime=1]="Lifetime",e[e.RequestResponse=2]="RequestResponse",e[e.Rendering=3]="Rendering",e[e.Error=4]="Error"})(Dr||(Dr={}));class M8e{constructor(t){this._halfIntTexturesAvailable=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=bt.MATERIAL,this._renderSlot=tt.VOXEL,this._rctx=null,this._renderTargetToRestore=null,this._lastFrameWasStationary=!1,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._view=t,this._initialize()}get canRender(){return!!this._vxl&&this._view.viewingMode==="local"}_dbg(t,i){this._dbgFlags.has(t)&&(t===Dr.Error?WE.error(i):WE.warn(i))}_removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this._dbg(Dr.Lifetime,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}_initialize(){this._dbg(Dr.Lifetime,"--initialize--");for(const t of this._wasmMemBlockSizes)this._wasmMemBlocks.set(t,0);this._readyWatchHandle=vi(()=>this._view.ready,t=>{t&&this._view.viewingMode==="local"?(this._dbg(Dr.Lifetime,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this._dbg(Dr.Lifetime,"view ready status changed, not ready or not a local view!"),this._removeRenderPlugin())},{initial:!0}),this._qualityWatchHandle=vi(()=>{var t;return(t=this._view)==null?void 0:t.qualityProfile},t=>{this._dbg(Dr.Rendering,"qualityProfile changed to "+t),this._vxl&&this._vxl.set_quality(this._toWasmQuality(t))},{initial:!0}),this._timeExtentWatchHandle=vi(()=>{var t;return(t=this._view)==null?void 0:t.timeExtent},()=>{if(this._vxl){var t;const i=this._getTimeArgs((t=this._view)==null?void 0:t.timeExtent);this._dbg(Dr.Rendering,"sceneView timeExtent changed to useTime="+i.useTime+" st="+i.startTime+" et="+i.endTime),this._vxl.set_scene_time_extent(i.startTime,i.endTime,i.useTime),this._renderPluginContext.requestRender()}},{initial:!0}),this._stationaryWatchHandle=vi(()=>{var t;return(t=this._view)==null?void 0:t.stationary},t=>{this._vxl&&t&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()})}initializeRenderContext(t){this._dbg(Dr.Lifetime,"--initializeRenderContext--");const i=t.renderContext.rctx;i.type===Yi.WEBGL2?(this._renderPluginContext=t,this._rctx=t.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this._initializeWasm(i.gl)):this._dbg(Dr.Error,"WebGL 1 context only!")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this._dbg(Dr.Lifetime,"--uninitializeRenderContext--")}_restoreFramebuffer(){if(!this._renderTargetToRestore)return;const t=this._renderTargetToRestore.fbo;if(!this._rctx)return void this._dbg(Dr.Error,"no context in restoreFramebuffer!");this._rctx.bindFramebuffer(t,!0);const i=this._renderTargetToRestore.viewport;this._rctx.setViewport(i.x,i.y,i.width,i.height)}_bindPreviousDepthToSlot(t,i){const r=!!this._rctx,s=!!this._renderTargetToRestore;if(!r||!s)return 0;const n=this._renderTargetToRestore.fbo.depthStencilTexture;return n?(i===0?this._rctx.bindTexture(null,t,!0):this._rctx.bindTexture(n,t,!0),1):(this._dbg(Dr.Error,"no depth/stencil texture exists!"),0)}_modifyResourceCount(t,i,r){if(!this._rctx)return void this._dbg(Dr.Error,"modifyAllocation callback has no rendering context!");const s=t;r===1?this._rctx.instanceCounter.increment(s,i):this._rctx.instanceCounter.decrement(s,i)}_setBlendState(t,i,r,s){this._rctx?(this._rctx.setBlendingEnabled(t===1),this._rctx.setBlendFunction(i,r),this._rctx.setBlendEquation(s)):this._dbg(Dr.Error,"setBlendState callback has no rendering context!")}_setFrontFace(t){this._rctx?this._rctx.setFrontFace(t):this._dbg(Dr.Error,"setFrontFace callback has no rendering context!")}_setDepthStencilStateFunction(t,i,r){this._rctx?(this._rctx.setDepthFunction(r),this._rctx.setDepthTestEnabled(t===1),this._rctx.setDepthWriteEnabled(i===1),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(kr.ALWAYS,0,255),this._rctx.setStencilOpSeparate(Jl.FRONT,Gr.KEEP,Gr.INCR,Gr.KEEP),this._rctx.setStencilOpSeparate(Jl.BACK,Gr.KEEP,Gr.DECR,Gr.KEEP)):this._dbg(Dr.Error,"setDepthStencilStateFunction callback has no rendering context!")}_setRasterizerState(t){if(this._rctx)switch(t){case xM.None:this._rctx.setFaceCullingEnabled(!1);break;case xM.Back:this._rctx.setCullFace(Jl.BACK),this._rctx.setFaceCullingEnabled(!0);break;case xM.Front:this._rctx.setCullFace(Jl.FRONT),this._rctx.setFaceCullingEnabled(!0)}else this._dbg(Dr.Error,"setRasterizerState callback has no rendering context!")}_setViewport(t,i,r,s){this._rctx?this._rctx.setViewport(t,i,r,s):this._dbg(Dr.Error,"setViewport callback has no rendering context!")}_updateMemoryUsage(){this._layers.forEach((t,i)=>{if(t.needMemoryUsageUpdate){const r=this._vxl.estimate_memory_usage(i);r>=0&&(t.needMemoryUsageUpdate=!1,t.layerView.setUsedMemory(r))}})}_syncRequestsResponses(){this._layers.forEach((t,i)=>{const r=[];t.responses.forEach((l,p)=>{r.push(p),this._dbg(Dr.RequestResponse,"responding for requestID:"+p+" size:"+l.size),this._vxl.respond(i,p,l),l.requestType!==j6.TreeIndex&&l.requestType!==j6.Section||(t.needMemoryUsageUpdate=!0)});const s=t.responses;for(const l of r)s.delete(l);const n=this._vxl.get_new_requests(i),a=t.abortController.signal;for(const l in n){t.outstandingRequestCount+=1,t.outstandingRequestCount===1&&t.layerView.updatingFlagChanged();const p=n[l],y={responseType:"array-buffer",signal:a};this._dbg(Dr.RequestResponse,"making requestID:"+l+" url:"+p.url),Ar(p.url,y).then(b=>{t.outstandingRequestCount-=1,t.outstandingRequestCount===0&&t.layerView.updatingFlagChanged(),this._dbg(Dr.RequestResponse,"have response for requestID:"+l);let x=0;if(b.data.byteLength>0){x=this._vxl._malloc(b.data.byteLength);const A=new Uint8Array(this._vxl.HEAPU8.buffer,x,b.data.byteLength),M=new Uint8Array(b.data);for(let P=0;P<b.data.byteLength;++P)A[P]=M[P]}s.set(+l,{responseType:p.responseType,ptr:x,size:b.data.byteLength,success:!0,requestType:p.requestType})}).catch(b=>{t.outstandingRequestCount-=1,t.outstandingRequestCount===0&&t.layerView.updatingFlagChanged(),Cs(b)||(this._dbg(Dr.Error,`requestID:${l} failed, error=${b.toString()}`),s.set(+l,{responseType:p.responseType,ptr:0,size:0,success:!1,requestType:p.requestType}))})}})}updateWasmCamera(t){this._vxl.set_projection_matrix.apply(this._vxl,t.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,t.viewMatrix),this._vxl.set_near_far(t.near,t.far)}isUpdating(t){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(t)&&this._layers.get(t).outstandingRequestCount>0}setEnabled(t,i){this._layers.forEach((r,s)=>{r.layerView===t&&(this._vxl.set_enabled(s,i),this._renderPluginContext.requestRender())})}setSlices(t,i){const r={mask:Hb.Slices,slices:{planes:i,currentEditPlane:-1}};return this._doMaskedUIUpdate(t,r,!0)}setDynamicSections(t,i){const r={mask:Hb.DynamicSections,dynamicSections:{planes:i,currentEditPlane:-1}};return this._doMaskedUIUpdate(t,r,!0)}setStaticSections(t,i){const r={mask:Hb.StaticSections,staticSections:i};return this._doMaskedUIUpdate(t,r,!0)}setCurrentVariable(t,i){const r={mask:Hb.CurrentVariable,currentVariable:i};return this._doMaskedUIUpdate(t,r,!0)}setRenderMode(t,i){const r={mask:Hb.RenderMode,renderMode:i};return this._doMaskedUIUpdate(t,r,!0)}_doMaskedUIUpdate(t,i,r){if(!this._vxl)return!1;let s=!1;return this._layers.forEach((n,a)=>{if(n.layerView===t){const l={str:JSON.stringify(i),byteCount:0,ptr:0,isReusable:!1};this._allocateBlock(l)&&(s=this._vxl.handle_masked_ui_update(a,l.ptr,l.byteCount)===1,l.isReusable||this._vxl._free(l.ptr))}}),s&&r&&this._renderPluginContext.requestRender(),s}addVoxelLayer(t){if(!this._vxl){const r={layerView:t,resolveCallback:null,rejectCallback:null},s=new Promise((n,a)=>{r.resolveCallback=n,r.rejectCallback=a});return this._newLayers.push(r),s}const i=this._addVoxelLayer(t);return i<0?Promise.reject(-1):Promise.resolve(i)}removeVoxelLayer(t){if(!this._vxl){const s=this._newLayers.findIndex(a=>t===a.layerView);s>=0&&(this._newLayers[s].resolveCallback(-1),this._newLayers.splice(s,1));const n=this._newLayers.length;return n===0&&(this._dbg(Dr.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),n}let i=-1;this._layers.forEach((s,n)=>{s.layerView===t&&(i=n,s.abortController.abort(),this._vxl.remove_layer(i))}),i>=0&&this._layers.delete(i);const r=this._layers.size;return r===0&&(this._dbg(Dr.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),r}_getBlockSize(t){for(const i of this._wasmMemBlockSizes)if(t<i)return i;return-1}_allocateBlock(t){t.byteCount=this._vxl.lengthBytesUTF8(t.str)+1;const i=this._getBlockSize(t.byteCount);return i<0?(t.isReusable=!1,t.ptr=this._vxl._malloc(t.byteCount)):(t.isReusable=!0,t.ptr=this._wasmMemBlocks.get(i),t.ptr===0&&(t.ptr=this._vxl._malloc(i),this._wasmMemBlocks.set(i,t.ptr))),t.ptr!==0&&(this._vxl.stringToUTF8(t.str,t.ptr,t.byteCount),!0)}_getTimeArgs(t){let i=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=!1;return L(t)&&(t.isAllTime?s=!0:(L(t.start)&&(s=!0,i=t.start.getTime()/1e3),L(t.end)&&(s=!0,r=t.end.getTime()/1e3))),{startTime:i,endTime:r,useTime:s}}_addVoxelLayer(t){var i;const r=t.layer;let s=-1;const n=r.getConfiguration();if(n.length<1)return-1;const a={str:n,byteCount:0,ptr:0,isReusable:!1};if(!this._allocateBlock(a))return-1;const l=this._getTimeArgs((i=this._view)==null?void 0:i.timeExtent),p=this._view.spatialReference.isWGS84&&r.spatialReference.isWGS84?111319.49079327357:1;if(s=this._vxl.add_layer(r.serviceRoot,a.ptr,a.byteCount,p,p,l.startTime,l.endTime,l.useTime,this._toWasmQuality(this._view.qualityProfile)),a.isReusable||this._vxl._free(a.ptr),s>=0){const y=new AbortController;if(this._layers.set(s,{layerView:t,responses:new Map,outstandingRequestCount:0,abortController:y,needMemoryUsageUpdate:!1}),!this._halfIntTexturesAvailable||je("mac")){const b=[];let x="";for(const A of t.layer.variables)A.renderingFormat.type!=="Int16"&&A.renderingFormat.type!=="UInt16"||(b.push(A.name),A.id===t.layer.style.currentVariableId&&(x=A.name));x!==""&&WE.error("#addVoxelLayer_error()",t.layer,`The voxel layer '${t.layer.title}' cannot render the current variable '${x}' in this browser`),b.length>0&&WE.warn("#addVoxelLayer_warning()",t.layer,`The voxel layer '${t.layer.title}' cannot render the variables '${b.toString()}' in this browser`)}return je("esri-mobile")&&WE.warnOnce("Mobile support differs across devices. Voxel layer might not display as expected."),s}return-1}prepareRender(t){if(!this._vxl)return;const i=t.viewForward,r=t.eye;this._vxl.update_camera_pos_and_direction(r[0],r[1],r[2],i[0],i[1],i[2]);const s=this._vxl.cull();this._dbg(Dr.RequestResponse,"missingResourceCount="+s),this._moreToLoad=s>0,this._havePreparedWithAllLayers=this._newLayers.length===0,this._updateMemoryUsage()}render(t){if(!this._vxl||t.pass!==this._renderPass||t.slot!==this._renderSlot)return;for(const r of this._newLayers){const s=this._addVoxelLayer(r.layerView);s===-1?r.rejectCallback(-1):r.resolveCallback(s)}if(this._newLayers=[],this._layers.size===0)return void this._dbg(Dr.Error,"No voxel layers but RenderPlugin instance is being asked to render!");this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._lastFrameWasStationary=this._view.stationary,this._rctx.setPolygonOffsetFillEnabled(!1),this._rctx.setScissorTestEnabled(!1),this._rctx.setColorMask(!0,!0,!0,!0),this._vxl.begin_color_frame(!this._view.stationary||this._moreToLoad,t.scenelightingData.lightingMainDirection[0],t.scenelightingData.lightingMainDirection[1],t.scenelightingData.lightingMainDirection[2]);const i=this._renderTargetToRestore.viewport;i.width===this._viewportWidth&&i.height===this._viewportHeight||(this._viewportWidth=i.width,this._viewportHeight=i.height,this._vxl.set_viewport(i.width,i.height),this._layers.forEach(r=>{r.needMemoryUsageUpdate=!0})),i.x===0&&i.y===0||this._dbg(Dr.Error,"Unsupported viewport parameters detected!"),this.updateWasmCamera(t.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,t.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),t.rctx.externalVertexArrayObjectUpdate(),t.rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender()}destroy(){this._dbg(Dr.Lifetime,"--destroy--"),this._removeRenderPlugin(),this._readyWatchHandle=_o(this._readyWatchHandle),this._qualityWatchHandle=_o(this._qualityWatchHandle),this._timeExtentWatchHandle=_o(this._timeExtentWatchHandle),this._stationaryWatchHandle=_o(this._stationaryWatchHandle),this._vxl&&(this._layers.forEach(t=>{t.abortController.abort()}),this._wasmMemBlocks.forEach(t=>{t!==0&&this._vxl._free(t)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}_initializeWasm(t){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=x8e(t).then(i=>{var r;if(this._vxl=i,this._vxlPromise=null,this._newLayers.length<=0)return this._dbg(Dr.Lifetime," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),void this.destroy();const s=this._getTimeArgs((r=this._view)==null?void 0:r.timeExtent),n=this._vxl.addFunction(this._restoreFramebuffer.bind(this),"v"),a=this._vxl.addFunction(this._setBlendState.bind(this),"viiii"),l=this._vxl.addFunction(this._setFrontFace.bind(this),"vi"),p=this._vxl.addFunction(this._setRasterizerState.bind(this),"vi"),y=this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this),"viii"),b=this._vxl.addFunction(this._setViewport.bind(this),"viiii"),x=this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this),"iii"),A=this._vxl.addFunction(this._modifyResourceCount.bind(this),"viii"),M=this._halfIntTexturesAvailable&&!je("mac");this._vxl.initialize_voxel_wasm(n,a,l,p,y,b,x,A,s.startTime,s.endTime,s.useTime,M),this._renderPluginContext&&this._renderPluginContext.requestRender()}).catch(()=>{for(const i of this._newLayers)i.rejectCallback(-2);this._dbg(Dr.Error," WASM failed to download, removing RenderPlugin and destroying"),this.destroy()})),this._vxlPromise)}pickDepth(t,i,r){if(!this._vxl||!this._rctx||this._layers.size===0)return null;const s=r.viewport[3]-i;if(t<0||t>r.viewport[2]||i<0||i>r.viewport[3])return this._dbg(Dr.Error,`pickDepth: outOfRange, screenXY=[${t}, ${s}], vp=[${r.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=r.viewForward,a=r.eye;this._vxl.update_camera_pos_and_direction(a[0],a[1],a[2],n[0],n[1],n[2]),this.updateWasmCamera(r),this._vxl.begin_frame();const l=this._vxl.pick_depth(t,s);return this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),l.success?l.distanceToCamera:null}_toWasmQuality(t){switch(t){case"low":return 0;case"medium":return 1;case"high":return 2}}}class Y3{constructor(){this.view2WASM=new Map}static getInstance(){return Y3.instance||(Y3.instance=new Y3),Y3.instance}getVoxelWasmPerSceneView(t){return this.view2WASM.has(t)?this.view2WASM.get(t):null}isUpdating(t,i){return!!this.view2WASM.has(t)&&this.view2WASM.get(t).isUpdating(i)}addLayer(t,i){return this.view2WASM.has(t)||this.view2WASM.set(t,new M8e(t)),this.view2WASM.get(t).addVoxelLayer(i)}removeLayer(t,i){this.view2WASM.has(t)&&this.view2WASM.get(t).removeVoxelLayer(i)<1&&this.view2WASM.delete(t)}setLayerEnabled(t,i,r){this.view2WASM.has(t)&&this.view2WASM.get(t).setEnabled(i,r)}setLayerSlices(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(a=>a.type==="voxel-3d").forEach(a=>{a.layer===t&&(r=s.setSlices(a,i))})}),r}setLayerDynamicSections(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(a=>a.type==="voxel-3d").forEach(a=>{a.layer===t&&(r=s.setDynamicSections(a,i))})}),r}setLayerCurrentVariable(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(a=>a.type==="voxel-3d").forEach(a=>{a.layer===t&&(r=s.setCurrentVariable(a,i))})}),r}setLayerRenderMode(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(a=>a.type==="voxel-3d").forEach(a=>{a.layer===t&&(r=s.setRenderMode(a,i))})}),r}setLayerStaticSections(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(a=>a.type==="voxel-3d").forEach(a=>{a.layer===t&&(r=s.setStaticSections(a,i))})}),r}}function TM(e){return e&&e.type==="base-tile"||e.type==="tile"||e.type==="elevation"||e.type==="imagery-tile"||e.type==="base-elevation"||e.type==="open-street-map"||e.type==="wcs"||e.type==="web-tile"||e.type==="wmts"||e.type==="vector-tile"}function qte(e){return e&&e.type==="imagery-tile"}function R8e(e){return e&&e.type==="wmts"}function Wte(e){return e&&e.type==="voxel"}function wge(e){return e.parent&&e.parent.declaredClass==="esri.Basemap"&&e.parent.baseLayers.indexOf(e)>-1}function GV(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function O8e(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const P8e=Ge.getLogger("esri.support.AnalysesCollection");let _S=class extends vM{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{J(t.item)||t.item.parent===this.owner&&(P8e.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};_S=_([re("esri.support.AnalysesCollection")],_S);const m9={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},i7={xsmall:544,small:768,medium:992,large:1200};function I8e(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function r7(e,t){return t?m9[e].valueToClassName[t].split(" "):[]}const $8e=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Ei,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=i7}initialize(){this._breakpointsHandles.add(vi(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),No))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Ht(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=I8e(i);if(!r){const s=JSON.stringify(i7,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:i7,this._set("breakpoints",ie({},i))}_updateClassNames(){if(!this.container)return;const i=Uc.acquire(),r=Uc.acquire();let s,n=!1;for(s in m9){const a=this[s],l=m9[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==l&&(n=!0,this[s]=l,r7(s,a).forEach(p=>r.push(p)),r7(s,l).forEach(p=>i.push(p)))}n&&(this._applyClassNameChanges(i,r),Uc.release(i),Uc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in m9)r7(r,this[r]).forEach(s=>i.classList.remove(s))}};return _([S()],t.prototype,"breakpoints",null),_([S()],t.prototype,"orientation",void 0),_([S()],t.prototype,"widthBreakpoint",void 0),_([S()],t.prototype,"heightBreakpoint",void 0),t=_([re("esri.views.BreakpointsOwner")],t),t};let X1=class extends st{constructor(){super(...arguments),this.items=new kt,this._watchUpdatingTracking=new t0,this._callbacks=new Map,this._projector=Aee(),this._hiddenProjector=Aee()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const a=r.domNode.getBoundingClientRect();n.left=a.left,n.top=a.top,n.right=a.right,n.bottom=a.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};_([S({readOnly:!0})],X1.prototype,"surface",void 0),_([S({readOnly:!0})],X1.prototype,"items",void 0),_([S({readOnly:!0})],X1.prototype,"needsRender",null),_([S({readOnly:!0})],X1.prototype,"_watchUpdatingTracking",void 0),_([S({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],X1.prototype,"updating",void 0),X1=_([re("esri.views.overlay.ViewOverlay")],X1);const Xte=X1;function zX(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let a,l=0;const p=()=>{l=0,e.apply(r,a)},y=(...b)=>{s&&s.apply(r,b),a=b,n?l||(l=setTimeout(p,n)):p()};return y.remove=()=>{l&&(clearTimeout(l),l=0)},y.forceUpdate=()=>{l&&(clearTimeout(l),p())},y.hasPendingUpdates=()=>!!l,y}const D8e=/\?(\.|$)/g;function Pi(e,t,i,r){const s=Array.isArray(t)?t:t.indexOf(",")>-1?t.split(","):[t],n=ms(e,t,i,r);for(const a of s){const l=a.trim().replace(D8e,"$1"),p=e.get(l);i.call(e,p,p,l,e)}return n}function ms(e,t,i,r){return e.watch(t,i,r)}function L8e(e,t,i,r){return hN(e,t,null,i,r)}function BX(e,t,i,r){return cN(e,t,Sge,i,r)}function xge(e,t,i,r){return hN(e,t,Sge,i,r)}function J3t(e,t,i,r){return hN(e,t,k8e,i,r)}function N8e(e,t,i,r){return cN(e,t,Ege,i,r)}function Tge(e,t,i,r){return hN(e,t,Ege,i,r)}function W6(e,t,i,r){return cN(e,t,U8e,i,r)}function F8e(e,t,i,r){let s=!1;const n=e.watch(t,(a,l,p,y)=>{s||i.call(e,a,l,p,y)},r);return{remove(){n.remove()},pause(){s=!0},resume(){s=!1}}}function m0(e,t,i,r,s,n,a){const l={};function p(b){const x=l[b];x&&(n&&n(x.target,b,e,i),x.handle.remove(),delete l[b])}const y=Pi(e,t,(b,x,A)=>{p(A),pL(b)&&(l[A]={handle:xO(b,i,r),target:b},s&&s(b,A,e,i))},a);return{remove(){y.remove();for(const b in l)p(b)}}}function cN(e,t,i,r,s){const n=e.watch(t,(a,l,p,y)=>{i&&!i(a)||r==null||r.call(e,a,l,p,y)},s);if(Array.isArray(t))for(const a of t){const l=e.get(a);i&&i(l)&&(r==null||r.call(e,l,l,t,e))}else{const a=e.get(t);i&&i(a)&&(r==null||r.call(e,a,a,t,e))}return n}function hN(e,t,i,r,s){const n=typeof r=="function"?r:null,a=typeof r=="object"?r:null;typeof r=="boolean"&&(s=r);let l,p=!1;function y(){l&&(l.remove(),l=null)}const b=gv();ka(a,()=>{y(),b.reject(rr())});const x={then:b.promise.then.bind(b.promise),catch:b.promise.catch.bind(b.promise),remove:y};return Object.freeze(x),l=cN(e,t,i,(A,M,P,$)=>{p=!0,y(),n&&n.call(e,A,M,P,$),b.resolve({value:A,oldValue:M,propertyName:P,target:$})},s),p&&y(),x}function Sge(e){return!!e}function k8e(e){return!e}function Ege(e){return e===!0}function U8e(e){return e===!1}function z8e(e,t,i){return e.units[t][i]}function uN(e,t,i,r=2,s="abbr"){return`${Tg(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${z8e(e,i,s)}`}function Z3t(e,t,i,r=2,s="abbr"){const n=QDe(t,i);return uN(e,dn(t,i,n),n,r,s)}function K3t(e,t,i,r=2,s="abbr"){const n=eLe(t,i);return uN(e,dn(t,i,n),n,r,s)}function Q3t(e,t,i,r=2,s="abbr"){const n=tLe(t,i);return uN(e,dn(t,i,n),n,r,s)}function eTt(e,t,i,r=2,s="abbr"){const n=iLe(t,i);return uN(e,dn(t,i,n),n,r,s)}const Yte=["B","kB","MB","GB","TB"];function B8e(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(mS.KILOBYTES));i=Ot(i,0,Yte.length-1);const r=Tg(t/mS.KILOBYTES**i,{maximumFractionDigits:2});return o0(e.units.bytes[Yte[i]],{fileSize:r})}function V8e(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?G8e({tagName:r,tags:s.tags}):null}function G8e(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var jV;const j8e={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let xc=jV=class extends Ye{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=V8e({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return j8e[t]||null}clone(){return new jV({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};_([S({type:String})],xc.prototype,"contentType",void 0),_([S()],xc.prototype,"exifInfo",void 0),_([S({readOnly:!0})],xc.prototype,"orientationInfo",null),_([S({type:us})],xc.prototype,"id",void 0),_([S({type:String})],xc.prototype,"globalId",void 0),_([S({type:String})],xc.prototype,"keywords",void 0),_([S({type:String})],xc.prototype,"name",void 0),_([S({json:{read:!1}})],xc.prototype,"parentGlobalId",void 0),_([S({json:{read:!1}})],xc.prototype,"parentObjectId",void 0),_([S({type:us})],xc.prototype,"size",void 0),_([S({json:{read:!1}})],xc.prototype,"url",void 0),xc=jV=_([re("esri.layers.support.AttachmentInfo")],xc);const Age=xc;var HV;let Ta=HV=class extends Ye{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new HV(Fe({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};_([S({type:[String],json:{write:!0}})],Ta.prototype,"attachmentTypes",void 0),_([S({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ta.prototype,"attachmentsWhere",void 0),_([S({type:[String],json:{write:!0}})],Ta.prototype,"keywords",void 0),_([S({type:[Number],json:{write:!0}})],Ta.prototype,"globalIds",void 0),_([S({json:{write:!0}})],Ta.prototype,"name",void 0),_([S({type:Number,json:{read:{source:"resultRecordCount"}}})],Ta.prototype,"num",void 0),_([S({type:[Number],json:{write:!0}})],Ta.prototype,"objectIds",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],Ta.prototype,"returnMetadata",void 0),_([S({type:[Number],json:{write:!0}})],Ta.prototype,"size",void 0),_([S({type:Number,json:{read:{source:"resultOffset"}}})],Ta.prototype,"start",void 0),_([Et("start"),Et("num")],Ta.prototype,"writeStart",null),_([S({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ta.prototype,"where",void 0),Ta=HV=_([re("esri.rest.support.AttachmentQuery")],Ta),Ta.from=Ys(Ta);const X6=Ta,H8e="esri.widgets.Feature.support.featureUtils",Jte=Ge.getLogger(H8e),q8e=/href=(""|'')/gi,W8e=/(\{([^\{\r\n]+)\})/g,X8e=/\'/g,Cge=/^\s*expression\//i,Y8e=/(\n)/gi,J8e=/[\u00A0-\u9999<>\&]/gim,Z8e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,K8e=/^(?:mailto:|tel:)/,Mge="relationships/",qV=uW("short-date-short-time");function Rge(e){if(!J(e))return e.get("sourceLayer")||e.get("layer")}async function Y6(e,t){return typeof e=="function"?e.call(null,t):e}function Oge(e=""){if(e)return!K8e.test(e.trim().toLowerCase())}function Pge(e){return!!e&&Cge.test(e)}function Q8e(e,t){if(!Pge(t)||!e)return null;const i=t.replace(Cge,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function Ige(e,t){const i=Q8e(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function eFe(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function tFe(e){return e.replace(q8e,"")}function J6(e,t){const i=VX(t,e);return i?i.name:e}function iFe(e,t){return e&&e.map(i=>J6(i,t))}function VX(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function $ge(e){return`${e}`.trim()}function l2({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?WV({formattedAttributes:t,template:oFe(r,ie(ie(ie({},t),s),e),i),fieldInfoMap:n}):""}function WV({formattedAttributes:e,template:t,fieldInfoMap:i}){return $ge(tFe(o0(o0(t,r=>eFe(r,i)),e)))}function rFe(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(X8e,s);t[e]=n}}function sFe(e,t=!1){const i=ie({},e);return Object.keys(i).forEach(r=>rFe(r,i,t)),i}function nFe(e,t,i){const r=(t=$ge(t))&&t[0]!=="{";return o0(e,sFe(i,r))}function XV(e,t){return e.replace(W8e,(i,r,s)=>{const n=VX(t,s);return n?`{${n.name}}`:r})}function oFe(e,t,i){const r=XV(e,i);return r&&r.replace(Z8e,(s,n,a)=>nFe(s,n||a,t))}function aFe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function lFe(e){return(e==null?void 0:e.type)==="feature"}function cFe(e){return(e==null?void 0:e.type)==="map-image"}function hFe(e){return!(e==null||!e.layer)}function Dge(e,t){const i=t.fieldInfos,r=t.fieldName,s=Lge(i,r),n=s==null?void 0:s.clone(),a=t.preventPlacesFormatting,l=t.layer,p=VX(l,r);if(n&&(p==null?void 0:p.type)==="date"){const b=n.format||new dM;b.dateFormat=b.dateFormat||"short-date-short-time",b.dateTimeFormatOptions=lFe(l)&&l.datesInUnknownTimezone||hFe(l)&&cFe(l.layer)&&l.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=b}const y=n&&n.format;return typeof(e=aFe(e,y))=="string"||e==null||y==null?BO(e):a?Tg(e,qe(ie({},lpe(y)),{minimumFractionDigits:0,maximumFractionDigits:20})):y.format(e)}function Lge(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function uFe({fieldName:e,graphic:t,layer:i}){if(ig(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function dFe({fieldName:e,value:t,graphic:i,layer:r}){if(ig(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function pFe(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const a=t[n];if(typeof a=="number"){const p=t[s];return{type:"edit",date:xg(a,qV),user:p}}const l=t[r];if(typeof l=="number"){const p=t[i];return{type:"create",date:xg(l,qV),user:p}}return null}function fFe(e,t){const i=new Map;return e&&e.forEach(r=>{const s=J6(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function Zte(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function GX(e){return e.replace(J8e,t=>`&#${t.charCodeAt(0)};`)}function BO(e){return typeof e=="string"?e.replace(Y8e,'<br class="esri-text-new-line" />'):e}function mFe(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:a}=e;if(t==null)return"";const l=dFe({fieldName:i,value:t,graphic:a,layer:n});if(l)return l;const p=uFe({fieldName:i,graphic:a,layer:n});if(p)return p;if(s.get(i.toLowerCase()))return Dge(t,{fieldInfos:r,fieldName:i,layer:n});const y=n&&n.fieldsIndex;return y&&y.isDateField(i)?xg(t,qV):BO(t)}function s7({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const a={};return n==null||n.forEach(l=>bFe(a,l)),Object.keys(t).forEach(l=>{const p=t[l];a[l]=mFe({fieldName:l,fieldInfos:e,fieldInfoMap:s,layer:i,value:p,graphic:r})}),a}async function gFe(e,t){var i,r;const{layer:s,graphic:n,outFields:a,objectIds:l,returnGeometry:p,spatialReference:y}=e,b=l[0];if(typeof b!="number"&&typeof b!="string"){const A="Could not query required fields for the specified feature. The feature's ID is invalid.",M={layer:s,graphic:n,objectId:b,requiredFields:a};return Jte.warn(A,M),null}if((i=s.capabilities)==null||(r=i.operations)==null||!r.supportsQuery){const A="The specified layer cannot be queried. The following fields will not be available.",M={layer:s,graphic:n,requiredFields:a,returnGeometry:p};return Jte.warn(A,M),null}const x=s.createQuery();return x.objectIds=l,x.outFields=a!=null&&a.length?a:[s.objectIdField],x.returnGeometry=!!p,x.returnZ=!!p,x.returnM=!!p,x.outSpatialReference=y,(await s.queryFeatures(x,t)).features[0]}async function yFe(e){var t;if((t=e.expressionInfos)==null||!t.length)return!1;const i=await Np(),{arcadeUtils:{hasGeometryFunctions:r}}=i;return r(e)}async function vFe({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const a=[n],l=await t.getRequiredFields(i.fieldsIndex),p=D$e(l,e),y=p?[]:l,b=t.returnGeometry||await yFe(t);if(p&&!b)return;const x=await gFe({layer:i,graphic:e,outFields:y,objectIds:a,returnGeometry:b,spatialReference:r},s);x&&(x.geometry&&(e.geometry=x.geometry),x.attributes&&(e.attributes=ie(ie({},e.attributes),x.attributes)))}function ig(e=""){return!!e&&e.indexOf(Mge)!==-1}function _Fe(e){return e?`${Mge}${e.layerId}/${e.fieldName}`:""}function Kte({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach(r=>{const s=_Fe({layerId:i.relation.id.toString(),fieldName:r});e[s]=t.attributes[r]})}function bFe(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(i=>Kte({attributes:e,graphic:i,relatedInfo:t})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(i=>Kte({attributes:e,graphic:i,relatedInfo:t})))}const Qte=e=>{if(!e)return!1;const t=e.toUpperCase();return t.indexOf("CURRENT_TIMESTAMP")>-1||t.indexOf("CURRENT_DATE")>-1||t.indexOf("CURRENT_TIME")>-1},Nge=({layer:e,method:t,query:i,definitionExpression:r})=>{var s,n;if((s=e.capabilities)==null||(n=s.query)==null||!n.supportsCacheHint||t==="attachments")return;const a=L(i.where)&&i.where,l=L(i.geometry)&&i.geometry;Qte(r)||Qte(a)||(l==null?void 0:l.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},wFe=({query:e,layer:t,method:i})=>{Nge({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},xFe=({queryPayload:e,layer:t,method:i})=>{Nge({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},eie={editing:!1,operations:{add:!0,update:!0,delete:!0}},Fge=kt.ofType(Age),TFe="graphic.layer.capabilities.operations.supportsResizeAttachments";let Vd=class extends xv{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=ie({},eie),this.activeAttachmentInfo=null,this.attachmentInfos=new Fge,this.graphic=null,this.mode="view",this.handles.add([Pi(this,"graphic",()=>this._graphicChanged())])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return ie(ie({},eie),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(TFe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new Se("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new X6({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(l=>l[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const a=await n;return t.removeAll(),a.length&&t.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Se("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new Se("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new Se("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(l=>this._queryAttachment(l.objectId)),a=await n;return i.add(a),a}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Se("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new Se("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new Se("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),a=await n;return i.remove(a),a}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new Se("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new Se("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new Se("invalid-abilities","updateAttachment(): Update abilities are required.");const a=r.findIndex(y=>y===t);if(!i||typeof i.updateAttachment!="function")throw new Se("invalid-layer","updateAttachment(): A valid layer is required.");const l=i.updateAttachment(s,t.id,e).then(y=>this._queryAttachment(y.objectId)),p=await l;return r.splice(a,1,p),p}async _queryAttachment(e){if(!e)throw new Se("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new X6({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Rge(e);this._attachmentLayer=t?t.type==="scene"&&L(t.associatedLayer)?t.associatedLayer:t:null}};_([S()],Vd.prototype,"abilities",void 0),_([_i("abilities")],Vd.prototype,"castAbilities",null),_([S()],Vd.prototype,"activeAttachmentInfo",void 0),_([S({readOnly:!0,type:Fge})],Vd.prototype,"attachmentInfos",void 0),_([S({type:gl})],Vd.prototype,"graphic",void 0),_([S()],Vd.prototype,"mode",void 0),_([S({readOnly:!0})],Vd.prototype,"state",null),_([S({readOnly:!0})],Vd.prototype,"supportsResizeAttachments",null),Vd=_([re("esri.widgets.Attachments.AttachmentsViewModel")],Vd);const jX=Vd;function SFe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function EFe(e){const t=hr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.indexOf("image/")!==-1?`${t}image-32.svg`:e.indexOf("audio/")!==-1?`${t}sound-32.svg`:e.indexOf("video/")!==-1?`${t}video-32.svg`:e.indexOf("msexcel")!==-1||e.indexOf("ms-excel")!==-1||e.indexOf("spreadsheetml")!==-1?`${t}excel-32.svg`:e.indexOf("msword")!==-1||e.indexOf("ms-word")!==-1||e.indexOf("wordprocessingml")!==-1?`${t}word-32.svg`:e.indexOf("powerpoint")!==-1||e.indexOf("presentationml")!==-1?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}const tie={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Bt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},n7=window.CSS;let Ya=class extends cc{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new jX,this.visibleElements=ie({},tie),this._supportsImageOrientation=n7&&n7.supports&&n7.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(m0(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),Pi(this,"viewModel.mode",()=>this._modeChanged()))}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return ie(ie({},tie),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Se("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Se("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Se("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Ve("div",{class:this.classes(Bt.base,Bt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Ve("div",{key:"error-message",class:Bt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Ve("div",{class:Bt.loaderContainer,key:"loader"},Ve("div",{class:Bt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?Ve("div",{class:Bt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?Ve("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Bt.esriButton,Bt.esriButtonTertiary,Bt.esriButtonSmall,Bt.esriButtonHalf,e&&Bt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Ve("button",{type:"submit",disabled:i,class:this.classes(Bt.esriButton,Bt.esriButtonSecondary,Bt.esriButtonSmall,Bt.esriButtonHalf,{[Bt.buttonDisabled]:i})},this.messages.add):null,n=t?Ve("span",{key:"file-name",class:Bt.fileName},t.name):null,a=Ve("form",{bind:this,afterCreate:zz,afterRemoved:QQ,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Ve("fieldset",{class:Bt.fileFieldset},n,Ve("label",{class:this.classes(Bt.fileLabel,Bt.esriButton,Bt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,Ve("input",{class:Bt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return Ve("div",{key:"add-form-container",class:Bt.formNode},a)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:a,url:l}=e,{abilities:p}=i,y=s||!r,b=p.editing&&p.operations.delete&&t.deleteButton?Ve("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:G=>this._submitDeleteAttachment(G,e),class:this.classes(Bt.esriButton,Bt.esriButtonSmall,Bt.esriButtonTertiary,Bt.deleteButton,{[Bt.buttonDisabled]:s})},this.messages.delete):null,x=p.editing&&p.operations.update&&t.updateButton?Ve("button",{disabled:y,key:"update-button",type:"submit",class:this.classes(Bt.esriButton,Bt.esriButtonSmall,Bt.esriButtonThird,{[Bt.buttonDisabled]:y})},this.messages.update):null,A=this.visibleElements.cancelUpdateButton?Ve("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Bt.esriButton,Bt.esriButtonSmall,Bt.esriButtonTertiary,Bt.esriButtonThird,{[Bt.buttonDisabled]:s})},this.messages.cancel):null,M=r?Ve("span",{key:"file-name",class:Bt.fileName},r.name):null,P=p.editing&&p.operations.update?Ve("fieldset",{key:"file",class:Bt.fileFieldset},M,Ve("label",{class:this.classes(Bt.fileLabel,Bt.esriButton,Bt.esriButtonSecondary)},this.messages.changeFile,Ve("input",{class:Bt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,$=Ve("fieldset",{key:"size",class:Bt.metadataFieldset},Ve("label",null,B8e(this.messagesUnits,a))),k=Ve("fieldset",{key:"content-type",class:Bt.metadataFieldset},Ve("label",null,n)),z=Ve("form",{bind:this,afterCreate:zz,afterRemoved:QQ,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Ve("div",{class:Bt.metadata},$,k),P,Ve("div",{class:Bt.actions},b,A,x));return Ve("div",{key:"edit-form-container",class:Bt.formNode},Ve("a",{class:Bt.itemLink,href:l,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Ve("div",{class:Bt.itemLinkOverlay},Ve("span",{class:Bt.itemLinkOverlayIcon},Ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Ve("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Ve("path",{fill:"none",d:"M0 0h32v32H0z"}))))),z)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,a=i&&SFe(r),l=this._getCSSTransform(e,a),p=l?{transform:l,"image-orientation":"none"}:{},y=n.indexOf("?")===-1?"?":"&",b=a?`${n}${y}w=${t}`:EFe(r),x={[Bt.itemMaskIcon]:!a},A={[Bt.itemImageResizable]:i};return Ve("div",{class:this.classes(x,Bt.itemMask)},Ve("img",{styles:p,alt:s,src:b,class:this.classes(A,Bt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,a=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),l=r.editing?Ve("span",{"aria-hidden":"true",class:this.classes(Bt.itemChevronIcon,Uy(this.container)?Bt.iconLeft:Bt.iconRight)}):null,p=[a,Ve("label",{class:Bt.itemLabel},Ve("span",{class:Bt.itemFilename},s||this.messages.noTitle),l)],y=r.editing?Ve("button",{key:"details-button",bind:this,class:Bt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},p):Ve("a",{key:"details-link",class:Bt.itemButton,href:n,target:"_blank"},p);return Ve("li",{class:Bt.item,key:e},y)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,a={[Bt.containerList]:e!=="preview",[Bt.containerPreview]:e==="preview"},l=s.editing&&s.operations.add&&i.addButton?Ve("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Bt.esriButton,Bt.esriButtonTertiary,Bt.addAttachmentButton),type:"button"},Ve("span",{"aria-hidden":"true",class:this.classes(Bt.itemAddIcon,Bt.iconPlus)}),this.messages.add):null,p=n?Ve("ul",{class:Bt.items},r.toArray().map(y=>this.renderAttachmentInfo({attachmentInfo:y,displayType:e}))):Ve("div",{class:Bt.empty},this.messages.noAttachments);return Ve("div",{key:"attachments-container",class:this.classes(Bt.container,a)},p,l)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};_([oi("viewModel.abilities")],Ya.prototype,"abilities",void 0),_([S()],Ya.prototype,"displayType",void 0),_([S({readOnly:!0})],Ya.prototype,"effectiveDisplayType",null),_([oi("viewModel.graphic")],Ya.prototype,"graphic",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ya.prototype,"label",void 0),_([S(),Zc("esri/widgets/Attachments/t9n/Attachments")],Ya.prototype,"messages",void 0),_([S(),Zc("esri/core/t9n/Units")],Ya.prototype,"messagesUnits",void 0),_([S({readOnly:!0})],Ya.prototype,"selectedFile",void 0),_([S({readOnly:!0})],Ya.prototype,"submitting",void 0),_([S({readOnly:!0})],Ya.prototype,"error",void 0),_([S({type:jX})],Ya.prototype,"viewModel",void 0),_([S()],Ya.prototype,"visibleElements",void 0),_([_i("visibleElements")],Ya.prototype,"castVisibleElements",null),Ya=_([re("esri.widgets.Attachments")],Ya);const AFe=Ya;let vC=class extends jX{constructor(e){super(e),this.description=null,this.title=null}};_([S()],vC.prototype,"description",void 0),_([S()],vC.prototype,"title",void 0),vC=_([re("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],vC);const HX=vC,CFe={heading:"esri-widget__heading"};function qX(e,t){const i=MFe(e.level),r=`h${i}`;return delete e.level,Ve(r,qe(ie({},e),{class:Jde(CFe.heading,e.class),role:"heading","aria-level":String(i)}),t)}function MFe(e){return Ot(Math.ceil(e),1,6)}const o7={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let Kx=class extends cc{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return Ve("div",{class:o7.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Ve(qX,{level:this.headingLevel,class:o7.title},e):null}renderDescription(){const{description:e}=this;return e?Ve("div",{key:"description",class:o7.description},e):null}};_([S()],Kx.prototype,"description",void 0),_([S()],Kx.prototype,"headingLevel",void 0),_([S()],Kx.prototype,"title",void 0),Kx=_([re("esri.widgets.Feature.support.FeatureElementInfo")],Kx);const WX=Kx,RFe={base:"esri-feature-attachments"};let Ef=class extends cc{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new AFe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new HX}initialize(){this._featureElementInfo=new WX,Pi(this,["viewModel.description","viewModel.title","headingLevel"],()=>this._setupFeatureElementInfo()),Pi(this,"viewModel.graphic",e=>this.attachmentsWidget.graphic=e)}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return Ve("div",{class:RFe.base},(e=this._featureElementInfo)==null?void 0:e.render(),t==null?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};_([S({readOnly:!0})],Ef.prototype,"attachmentsWidget",void 0),_([oi("viewModel.description")],Ef.prototype,"description",void 0),_([oi("attachmentsWidget.displayType")],Ef.prototype,"displayType",void 0),_([oi("viewModel.graphic")],Ef.prototype,"graphic",void 0),_([S()],Ef.prototype,"headingLevel",void 0),_([oi("viewModel.title")],Ef.prototype,"title",void 0),_([S({type:HX})],Ef.prototype,"viewModel",void 0),Ef=_([re("esri.widgets.Feature.FeatureAttachments")],Ef);const OFe=Ef;let Y1=class extends zg(st){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Pi(this,"creator",t=>{this._destroyContent(),this._createContent(t)}))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(Y6(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=Y6(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};_([S({readOnly:!0})],Y1.prototype,"created",void 0),_([S()],Y1.prototype,"creator",void 0),_([S()],Y1.prototype,"destroyer",void 0),_([S({type:gl})],Y1.prototype,"graphic",void 0),_([S({readOnly:!0})],Y1.prototype,"state",null),Y1=_([re("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Y1);const Z6=Y1,a7={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let Qx=class extends cc{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Oge(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return Ve("div",{class:a7.loaderContainer,key:"loader"},Ve("div",{class:a7.loader}))}renderCreated(){var e;const t=(e=this.viewModel)==null?void 0:e.created;return t?t instanceof HTMLElement?Ve("div",{key:t,bind:t,afterCreate:this._attachToNode}):spe(t)?Ve("div",{key:t},!t.destroyed&&t.render()):Ve("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=(e=this.viewModel)==null?void 0:e.state;return Ve("div",{class:a7.base},t==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};_([oi("viewModel.creator")],Qx.prototype,"creator",void 0),_([oi("viewModel.graphic")],Qx.prototype,"graphic",void 0),_([S({type:Z6})],Qx.prototype,"viewModel",void 0),Qx=_([re("esri.widgets.Feature.FeatureContent")],Qx);const g9=Qx;let fm=class extends st{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=Ige(s,e),i.push(s)}),i}};_([S()],fm.prototype,"attributes",void 0),_([S({type:[Kfe]})],fm.prototype,"expressionInfos",void 0),_([S()],fm.prototype,"description",void 0),_([S({type:[FO]})],fm.prototype,"fieldInfos",void 0),_([S({readOnly:!0})],fm.prototype,"formattedFieldInfos",null),_([S()],fm.prototype,"title",void 0),fm=_([re("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],fm);const dN=fm,PFe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function IFe(e){let t=null;return PFe.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function $Fe(e,t){if(typeof t!="string"||!t)return t;const i=IFe(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=o0(o0(i.label,{messages:e,hierPart:s}),{appName:i.appName}),a=i.target?` target="${i.target}"`:"",l=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${a} href="$1"${l}>${n}</a>`)}const XE={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Gd=class extends cc{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new dN,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new WX,Pi(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo())}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",a=!(!e.format||!e.format.dateFormat),l=typeof n=="number"&&!a?this._forceLTR(n):$Fe(this.messagesURIUtils,n),p={[XE.fieldDataDate]:a};return Ve("tr",{key:`fields-element-info-row-${r}-${t}`},Ve("th",{key:`fields-element-info-row-header-${r}-${t}`,class:XE.fieldHeader,innerHTML:s}),Ve("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(XE.fieldData,p),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?Ve("table",{class:XE.esriTable,summary:this.messages.fieldsSummary},Ve("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return Ve("div",{class:XE.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};_([oi("viewModel.attributes")],Gd.prototype,"attributes",void 0),_([oi("viewModel.description")],Gd.prototype,"description",void 0),_([oi("viewModel.expressionInfos")],Gd.prototype,"expressionInfos",void 0),_([oi("viewModel.fieldInfos")],Gd.prototype,"fieldInfos",void 0),_([oi("viewModel.title")],Gd.prototype,"title",void 0),_([S({type:dN})],Gd.prototype,"viewModel",void 0),_([S(),Zc("esri/widgets/Feature/t9n/Feature")],Gd.prototype,"messages",void 0),_([S(),Zc("esri/widgets/support/t9n/uriUtils")],Gd.prototype,"messagesURIUtils",void 0),Gd=_([re("esri.widgets.Feature.FeatureFields")],Gd);const kge=Gd,iie={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},DFe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function LFe(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function C2(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=DFe[i],{getter:n,setter:a,multiplier:l}=s;if(i==="months"){const p=LFe(r.getFullYear(),r.getMonth()+t);r.getDate()>p&&r.setDate(p)}r[a](r[n]()+t*l)}return r}function rie(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function NFe(e,t,i){return e===0?0:e*iie[t]/iie[i]}var jd;let Rh=jd=class extends Ye{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return sie}static get empty(){return FFe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(jd.allTime)}get isEmpty(){return this.equals(jd.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new jd({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=L(this.start)?this.start.getTime():this.start,i=L(this.end)?this.end.getTime():this.end,r=L(e.start)?e.start.getTime():e.start,s=L(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Da(this.start,r=>rie(r,e)),i=Da(this.end,r=>C2(rie(r,e),1,e));return new jd({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return jd.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=kc(this.start,-1/0,l=>l.getTime()),i=kc(this.end,1/0,l=>l.getTime()),r=kc(e.start,-1/0,l=>l.getTime()),s=kc(e.end,1/0,l=>l.getTime());let n,a;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?a=i:s>=t&&s<=i&&(a=s),!isNaN(n)&&!isNaN(a)){const l=new jd;return l.start=n===-1/0?null:new Date(n),l.end=a===1/0?null:new Date(a),l}return jd.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new jd,{start:r,end:s}=this;return L(r)&&(i.start=C2(r,e,t)),L(s)&&(i.end=C2(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return sie.clone();const t=L(this.start)&&L(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=L(this.end)&&L(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new jd({start:t,end:i})}};_([S({type:Date,json:{write:{allowNull:!0}}})],Rh.prototype,"end",void 0),_([wt("end")],Rh.prototype,"readEnd",null),_([Et("end")],Rh.prototype,"writeEnd",null),_([S({readOnly:!0,json:{read:!1}})],Rh.prototype,"isAllTime",null),_([S({readOnly:!0,json:{read:!1}})],Rh.prototype,"isEmpty",null),_([S({type:Date,json:{write:{allowNull:!0}}})],Rh.prototype,"start",void 0),_([wt("start")],Rh.prototype,"readStart",null),_([Et("start")],Rh.prototype,"writeStart",null),Rh=jd=_([re("esri.TimeExtent")],Rh);const sie=new Rh,FFe=new Rh({start:void 0,end:void 0}),R0=Rh;var YV;let _C=YV=class extends Ye{constructor(e){super(e),this.name=null,this.code=null}clone(){return new YV({name:this.name,code:this.code})}};_([S({type:String,json:{write:!0}})],_C.prototype,"name",void 0),_([S({type:[String,Number],json:{write:!0}})],_C.prototype,"code",void 0),_C=YV=_([re("esri.layers.support.CodedValue")],_C);const kFe=_C,UFe=new Ui({inherited:"inherited",codedValue:"coded-value",range:"range"});let bC=class extends Ye{constructor(e){super(e),this.name=null,this.type=null}};_([S({type:String,json:{write:!0}})],bC.prototype,"name",void 0),_([ti(UFe)],bC.prototype,"type",void 0),bC=_([re("esri.layers.support.Domain")],bC);const pN=bC;var JV;let wC=JV=class extends pN{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new JV({codedValues:Fe(this.codedValues),name:this.name})}};_([S({type:[kFe],json:{write:!0}})],wC.prototype,"codedValues",void 0),_([ti({codedValue:"coded-value"})],wC.prototype,"type",void 0),wC=JV=_([re("esri.layers.support.CodedValueDomain")],wC);const Uge=wC;var ZV;let y9=ZV=class extends pN{constructor(e){super(e),this.type="inherited"}clone(){return new ZV}};_([ti({inherited:"inherited"})],y9.prototype,"type",void 0),y9=ZV=_([re("esri.layers.support.InheritedDomain")],y9);const zge=y9;var KV;let e3=KV=class extends pN{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new KV({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};_([S({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],e3.prototype,"maxValue",void 0),_([S({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],e3.prototype,"minValue",void 0),_([ti({range:"range"})],e3.prototype,"type",void 0),e3=KV=_([re("esri.layers.support.RangeDomain")],e3);const Bge=e3,Vge={key:"type",base:pN,typeMap:{range:Bge,"coded-value":Uge,inherited:zge}};function XX(e){if(!e||!e.type)return null;switch(e.type){case"range":return Bge.fromJSON(e);case"codedValue":return Uge.fromJSON(e);case"inherited":return zge.fromJSON(e)}return null}const YX=new Ui({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var QV;const zFe=new Ui({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Il=QV=class extends Ye{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?zFe.fromJSON(i.fieldValueType):null}clone(){return new QV({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};_([S({type:String,json:{write:!0}})],Il.prototype,"alias",void 0),_([S({type:[String,Number],json:{write:{allowNull:!0}}})],Il.prototype,"defaultValue",void 0),_([S()],Il.prototype,"description",void 0),_([wt("description")],Il.prototype,"readDescription",null),_([S({types:Vge,json:{read:{reader:XX},write:!0}})],Il.prototype,"domain",void 0),_([S({type:Boolean,json:{write:!0}})],Il.prototype,"editable",void 0),_([S({type:us,json:{write:!0}})],Il.prototype,"length",void 0),_([S({type:String,json:{write:!0}})],Il.prototype,"name",void 0),_([S({type:Boolean,json:{write:!0}})],Il.prototype,"nullable",void 0),_([ti(YX)],Il.prototype,"type",void 0),_([S()],Il.prototype,"valueType",void 0),_([wt("valueType",["description"])],Il.prototype,"readValueType",null),Il=QV=_([re("esri.layers.support.Field")],Il);const VO=Il;var eG;let t3=eG=class extends Ye{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new eG({mapLayerId:e,gdbVersion:t})}};_([ti({mapLayer:"map-layer"})],t3.prototype,"type",void 0),_([S({type:us,json:{write:!0}})],t3.prototype,"mapLayerId",void 0),_([S({type:String,json:{write:!0}})],t3.prototype,"gdbVersion",void 0),t3=eG=_([re("esri.layers.support.source.MapLayerSource")],t3);var tG;let mm=tG=class extends Ye{constructor(e){super(e),this.type="query-table"}clone(){var e;const{workspaceId:t,query:i,oidFields:r,spatialReference:s,geometryType:n}=this,a={workspaceId:t,query:i,oidFields:r,spatialReference:(e=s==null?void 0:s.clone())!=null?e:void 0,geometryType:n};return new tG(a)}};_([ti({queryTable:"query-table"})],mm.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],mm.prototype,"workspaceId",void 0),_([S({type:String,json:{write:!0}})],mm.prototype,"query",void 0),_([S({type:String,json:{write:!0}})],mm.prototype,"oidFields",void 0),_([S({type:It,json:{write:!0}})],mm.prototype,"spatialReference",void 0),_([ti(Dfe)],mm.prototype,"geometryType",void 0),mm=tG=_([re("esri.layers.support.source.QueryTableDataSource")],mm);var iG;let i3=iG=class extends Ye{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new iG({workspaceId:e,dataSourceName:t})}};_([ti({raster:"raster"})],i3.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],i3.prototype,"dataSourceName",void 0),_([S({type:String,json:{write:!0}})],i3.prototype,"workspaceId",void 0),i3=iG=_([re("esri.layers.support.source.RasterDataSource")],i3);var rG;let eb=rG=class extends Ye{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new rG({workspaceId:e,gdbVersion:t,dataSourceName:i})}};_([ti({table:"table"})],eb.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],eb.prototype,"workspaceId",void 0),_([S({type:String,json:{write:!0}})],eb.prototype,"gdbVersion",void 0),_([S({type:String,json:{write:!0}})],eb.prototype,"dataSourceName",void 0),eb=rG=_([re("esri.layers.support.source.TableDataSource")],eb);var sG,nG;const BFe=Va()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let _h=sG=class extends Ye{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return nie()(e,t,i)}castLeftTableSource(e){return Dp(oG(),e)}readRightTableSource(e,t,i){return nie()(e,t,i)}castRightTableSource(e){return Dp(oG(),e)}clone(){var e,t;const{leftTableKey:i,rightTableKey:r,leftTableSource:s,rightTableSource:n,joinType:a}=this,l={leftTableKey:i,rightTableKey:r,leftTableSource:(e=s==null?void 0:s.clone())!=null?e:void 0,rightTableSource:(t=n==null?void 0:n.clone())!=null?t:void 0,joinType:a};return new sG(l)}};_([ti({joinTable:"join-table"})],_h.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],_h.prototype,"leftTableKey",void 0),_([S({type:String,json:{write:!0}})],_h.prototype,"rightTableKey",void 0),_([S({json:{write:!0}})],_h.prototype,"leftTableSource",void 0),_([wt("leftTableSource")],_h.prototype,"readLeftTableSource",null),_([_i("leftTableSource")],_h.prototype,"castLeftTableSource",null),_([S({json:{write:!0}})],_h.prototype,"rightTableSource",void 0),_([wt("rightTableSource")],_h.prototype,"readRightTableSource",null),_([_i("rightTableSource")],_h.prototype,"castRightTableSource",null),_([ti(BFe)],_h.prototype,"joinType",void 0),_h=sG=_([re("esri.layers.support.source.JoinTableDataSource")],_h);let l7=null;function nie(){return l7||(l7=rE({types:oG()})),l7}let c7=null;function oG(){return c7||(c7={key:"type",base:null,typeMap:{"data-layer":Nh,"map-layer":t3}}),c7}const VFe={key:"type",base:null,typeMap:{"join-table":_h,"query-table":mm,raster:i3,table:eb}};let Nh=nG=class extends Ye{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new nG({fields:e,dataSource:t})}};_([ti({dataLayer:"data-layer"})],Nh.prototype,"type",void 0),_([S({type:[VO],json:{write:!0}})],Nh.prototype,"fields",void 0),_([S({types:VFe,json:{write:!0}})],Nh.prototype,"dataSource",void 0),Nh=nG=_([re("esri.layers.support.source.DataLayerSource")],Nh),Nh.from=Ys(Nh);var aG;const oie=new Ui({upperLeft:"upper-left",lowerLeft:"lower-left"});let tb=aG=class extends Ye{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new aG(Fe({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};_([S({type:ki,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],tb.prototype,"extent",void 0),_([S({type:["view","edit"],json:{write:!0}})],tb.prototype,"mode",void 0),_([S({type:String,json:{read:oie.read,write:oie.write}})],tb.prototype,"originPosition",void 0),_([S({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],tb.prototype,"tolerance",void 0),tb=aG=_([re("esri.rest.support.QuantizationParameters")],tb);const GFe=tb;var lG;const aie=new Ui({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Hd=lG=class extends Ye{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=Fe(e))}clone(){return new lG({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Fe(this.statisticParameters)})}};_([S({type:Number,json:{write:!0}})],Hd.prototype,"maxPointCount",void 0),_([S({type:Number,json:{write:!0}})],Hd.prototype,"maxRecordCount",void 0),_([S({type:Number,json:{write:!0}})],Hd.prototype,"maxVertexCount",void 0),_([S({type:String,json:{write:!0}})],Hd.prototype,"onStatisticField",void 0),_([S({type:String,json:{write:!0}})],Hd.prototype,"outStatisticFieldName",void 0),_([S({type:String,json:{read:{source:"statisticType",reader:aie.read},write:{target:"statisticType",writer:aie.write}}})],Hd.prototype,"statisticType",void 0),_([S({type:Object})],Hd.prototype,"statisticParameters",void 0),_([Et("statisticParameters")],Hd.prototype,"writeStatisticParameters",null),Hd=lG=_([re("esri.rest.support.StatisticDefinition")],Hd);const Gge=Hd;var ET;const jFe=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),HFe=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let gi=ET=class extends Ye{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return ZT(ET,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new ET(Fe({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:L(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};gi.MAX_MAX_RECORD_COUNT_FACTOR=5,_([S({json:{write:!0}})],gi.prototype,"aggregateIds",void 0),_([S({type:Boolean,json:{write:!0}})],gi.prototype,"cacheHint",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"compactGeometryEnabled",void 0),_([S({json:{write:!0}})],gi.prototype,"datumTransformation",void 0),_([_i("datumTransformation")],gi.prototype,"castDatumTransformation",null),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"defaultSpatialReferenceEnabled",void 0),_([S({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],gi.prototype,"distance",void 0),_([S({type:Nh,json:{write:!0}})],gi.prototype,"dynamicDataSource",void 0),_([S({type:String,json:{write:!0}})],gi.prototype,"formatOf3DObjects",void 0),_([S({type:String,json:{write:!0}})],gi.prototype,"gdbVersion",void 0),_([S({types:Sw,json:{read:Lp,write:!0}})],gi.prototype,"geometry",void 0),_([S({type:Number,json:{write:!0}})],gi.prototype,"geometryPrecision",void 0),_([S({type:[String],json:{write:!0}})],gi.prototype,"groupByFieldsForStatistics",void 0),_([S({type:String,json:{write:!0}})],gi.prototype,"having",void 0),_([S({type:Date})],gi.prototype,"historicMoment",void 0),_([Et("historicMoment")],gi.prototype,"writeHistoricMoment",null),_([S({type:Number,json:{write:!0}})],gi.prototype,"maxAllowableOffset",void 0),_([S({type:Number,cast:e=>e<1?1:e>ET.MAX_MAX_RECORD_COUNT_FACTOR?ET.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],gi.prototype,"maxRecordCountFactor",void 0),_([S({type:["xyFootprint"],json:{write:!0}})],gi.prototype,"multipatchOption",void 0),_([S({type:Number,json:{read:{source:"resultRecordCount"}}})],gi.prototype,"num",void 0),_([S({json:{write:!0}})],gi.prototype,"objectIds",void 0),_([S({type:[String],json:{write:!0}})],gi.prototype,"orderByFields",void 0),_([S({type:[String],json:{write:!0}})],gi.prototype,"outFields",void 0),_([S({type:It,json:{name:"outSR",write:!0}})],gi.prototype,"outSpatialReference",void 0),_([S({type:[Gge],json:{write:{enabled:!0,overridePolicy(){return{enabled:L(this.outStatistics)&&this.outStatistics.length>0}}}}})],gi.prototype,"outStatistics",void 0),_([S({json:{write:!0}})],gi.prototype,"parameterValues",void 0),_([Et("parameterValues")],gi.prototype,"writeParameterValues",null),_([S({type:Gt,json:{write:!0}})],gi.prototype,"pixelSize",void 0),_([S({type:GFe,json:{write:!0}})],gi.prototype,"quantizationParameters",void 0),_([S({type:[Object],json:{write:!0}})],gi.prototype,"rangeValues",void 0),_([S({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],gi.prototype,"relationParameter",void 0),_([S({type:String,json:{write:!0}})],gi.prototype,"resultType",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"returnCentroid",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"returnDistinctValues",void 0),_([S({type:Boolean,json:{default:!0,write:!0}})],gi.prototype,"returnExceededLimitFeatures",void 0),_([S({type:Boolean,json:{write:!0}})],gi.prototype,"returnGeometry",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"returnQueryGeometry",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"returnM",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],gi.prototype,"returnZ",void 0),_([S({type:It,json:{write:!0}})],gi.prototype,"sourceSpatialReference",void 0),_([ti(jFe,{ignoreUnknown:!1,name:"spatialRel"})],gi.prototype,"spatialRelationship",void 0),_([S({type:Number,json:{read:{source:"resultOffset"}}})],gi.prototype,"start",void 0),_([Et("start"),Et("num")],gi.prototype,"writeStart",null),_([S({type:String,json:{write:!0}})],gi.prototype,"sqlFormat",void 0),_([S({type:String,json:{write:!0}})],gi.prototype,"text",void 0),_([S({type:R0,json:{write:!0}})],gi.prototype,"timeExtent",void 0),_([S({type:Boolean,json:{default:!1,write:!0}})],gi.prototype,"timeReferenceUnknownClient",void 0),_([ti(HFe,{ignoreUnknown:!1}),S({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],gi.prototype,"units",void 0),_([S({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],gi.prototype,"where",void 0),_([Et("where")],gi.prototype,"writeWhere",null),gi=ET=_([re("esri.rest.support.Query")],gi);const ql=gi;var cG;let vn=cG=class extends Ye{constructor(e){super(e),this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new cG(Fe({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};_([S({type:Nh,json:{write:!0}})],vn.prototype,"dynamicDataSource",void 0),_([S({type:String,json:{write:!0}})],vn.prototype,"gdbVersion",void 0),_([S({type:Number,json:{write:!0}})],vn.prototype,"geometryPrecision",void 0),_([S({type:Date})],vn.prototype,"historicMoment",void 0),_([Et("historicMoment")],vn.prototype,"_writeHistoricMoment",null),_([S({type:Number,json:{write:!0}})],vn.prototype,"maxAllowableOffset",void 0),_([S({type:[Number],json:{write:!0}})],vn.prototype,"objectIds",void 0),_([S({type:[String],json:{write:!0}})],vn.prototype,"orderByFields",void 0),_([S({type:[String],json:{write:!0}})],vn.prototype,"outFields",void 0),_([S({type:It,json:{read:{source:"outSR"},write:{target:"outSR"}}})],vn.prototype,"outSpatialReference",void 0),_([S({json:{write:!0}})],vn.prototype,"relationshipId",void 0),_([S({type:Number,json:{read:{source:"resultOffset"}}})],vn.prototype,"start",void 0),_([Et("start"),Et("num")],vn.prototype,"writeStart",null),_([S({type:Number,json:{read:{source:"resultRecordCount"}}})],vn.prototype,"num",void 0),_([S({json:{write:!0}})],vn.prototype,"returnGeometry",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],vn.prototype,"returnM",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],vn.prototype,"returnZ",void 0),_([S({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],vn.prototype,"where",void 0),vn=cG=_([re("esri.rest.support.RelationshipQuery")],vn),vn.from=Ys(vn);const Z2=vn;function tTt(e){var t;const i=e.layer;return"floorInfo"in i&&(t=i.floorInfo)!=null&&t.floorField&&"floors"in e.view?jge(e.view.floors,i.floorInfo.floorField):null}function iTt(e,t){var i;return"floorInfo"in t&&(i=t.floorInfo)!=null&&i.floorField?jge(e,t.floorInfo.floorField):null}function rTt(e,t){const{definitionExpression:i}=t;return e?i?`(${i}) AND (${e})`:e:i}function jge(e,t){if(e==null||!e.length)return null;const i=e.filter(r=>r!=="").map(r=>`'${r}'`);return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}function qFe(e,t){return t?qe(ie({},t),{query:ie(ie({},e),t.query)}):{query:e}}function lu(e){return typeof e=="string"?Gn(e):e}function WFe(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let a=0;a<n.length;a++)r[s][a]=WFe(n[a])}else if(typeof n=="object")if(n.toJSON){const a=n.toJSON(i&&i[s]);r[s]=t?a:JSON.stringify(a)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}function GO(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=GO(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}function XFe(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function YFe(e,t){const i={};for(const r of e){const{parentObjectId:s,parentGlobalId:n,attachmentInfos:a}=r;for(const l of a){const{id:p}=l,y=aPe(CPe(`${t}/${s}/attachments/${p}`)),b=Age.fromJSON(l);b.set({url:y,parentObjectId:s,parentGlobalId:n}),i[s]?i[s].push(b):i[s]=[b]}}return i}function JFe(e,t,i){let r={query:GO(ie(qe(ie({},e.query),{f:"json"}),XFe(t)))};return i&&(r=qe(ie(ie({},i),r),{query:ie(ie({},i.query),r.query)})),Ar(e.path+"/queryAttachments",r)}async function ZFe(e,t,i){const r=lu(e);return JFe(r,X6.from(t),ie({},i)).then(s=>YFe(s.data.attachmentGroups,r.path))}const p5={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Hc({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:It.WebMercator}),minus180Line:new Hc({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:It.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Hc({paths:[[[180,-180],[180,180]]],spatialReference:It.WGS84}),minus180Line:new Hc({paths:[[[-180,-180],[-180,180]]],spatialReference:It.WGS84})}};function c2(e,t){return Math.ceil((e-t)/(2*t))}function Hge(e,t){const i=SM(e);for(const r of i)for(const s of r)s[0]+=t;return e}function SM(e){return b2(e)?e.rings:e.paths}async function KFe(e,t,i,r){const s=typeof e=="string"?Gn(e):e,n=t[0].spatialReference,a=qe(ie({},r),{query:qe(ie({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:Vv(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),l=await Ar(s.path+"/cut",a),{cutIndexes:p,geometries:y=[]}=l.data;return{cutIndexes:p,geometries:y.map(b=>{const x=Lp(b);return x.spatialReference=n,x})}}async function QFe(e,t,i){const r=typeof e=="string"?Gn(e):e,s=t[0].spatialReference,n=Vv(t[0]),a=qe(ie({},i),{query:qe(ie({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(e7e(t))})});return t7e((await Ar(r.path+"/simplify",a)).data,n,s)}function e7e(e){return{geometryType:Vv(e[0]),geometries:e.map(t=>t.toJSON())}}function t7e(e,t,i){const r=Nfe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const i7e=Ge.getLogger("esri.geometry.support.normalizeUtils");function r7e(e){return e.type==="polygon"}function s7e(e){return e[0].type==="polygon"}function n7e(e){return e[0].type==="polyline"}function o7e(e,t){if(!(e instanceof Hc||e instanceof Fa)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw i7e.error(s),new Se(s)}const i=SM(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let a=0;a<s.length-1;a++){const l=s[a][0],p=s[a][1],y=s[a+1][0],b=s[a+1][1],x=Math.sqrt((y-l)*(y-l)+(b-p)*(b-p)),A=(b-p)/x,M=(y-l)/x,P=x/t;if(P>1){for(let G=1;G<=P-1;G++){const B=G*t,W=M*B+l,q=A*B+p;n.push([W,q])}const $=(x+Math.floor(P-1)*t)/2,k=M*$+l,z=A*$+p;n.push([k,z])}n.push([y,b])}}return r7e(e)?new Fa({rings:r,spatialReference:e.spatialReference}):new Hc({paths:r,spatialReference:e.spatialReference})}function lie(e,t,i){if(t){const r=o7e(e,1e6);e=q3(r,!0)}return i&&(e=Hge(e,i)),e}function cie(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=c2(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=c2(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=c2(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=c2(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function a7e(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],a=SM(n);for(let l=0;l<a.length;l++){const p=a[l];p.some(y=>{if(y[0]<180)return!0;{let b=0;for(let A=0;A<p.length;A++){const M=p[A][0];b=M>b?M:b}b=Number(b.toFixed(9));const x=-360*c2(b,180);for(let A=0;A<p.length;A++){const M=n.getPoint(l,A);n.setPoint(l,A,M.clone().offset(x,0))}return!0}})}if(s===i){if(s7e(e))for(const l of SM(n))e[s]=e[s].addRing(l);else if(n7e(e))for(const l of SM(n))e[s]=e[s].addPath(l)}else i=s,e[s]=n}return e}async function fN(e,t,i){var r;if(!Array.isArray(e))return fN([e],t);const s=(r=t==null?void 0:t.url)!=null?r:qr.geometryServiceUrl;let n,a,l,p,y,b,x,A,M=0;const P=[],$=[];for(const q of e)if(J(q))$.push(q);else if(n||(n=q.spatialReference,a=lg(n),l=n.isWebMercator,b=l?102100:4326,p=p5[b].maxX,y=p5[b].minX,x=p5[b].plus180Line,A=p5[b].minus180Line),a)if(q.type==="mesh")$.push(q);else if(q.type==="point")$.push(cie(q.clone(),p,y));else if(q.type==="multipoint"){const X=q.clone();X.points=X.points.map(oe=>cie(oe,p,y)),$.push(X)}else if(q.type==="extent"){const X=q.clone()._normalize(!1,!1,a);$.push(X.rings?new Fa(X):X)}else if(q.extent){const X=q.extent,oe=c2(X.xmin,y)*(2*p);let de=oe===0?q.clone():Hge(q.clone(),oe);X.offset(oe,0),X.intersects(x)&&X.xmax!==p?(M=X.xmax>M?X.xmax:M,de=lie(de,l),P.push(de),$.push("cut")):X.intersects(A)&&X.xmin!==y?(M=X.xmax*(2*p)>M?X.xmax*(2*p):M,de=lie(de,l,360),P.push(de),$.push("cut")):$.push(de)}else $.push(q.clone());else $.push(q);let k=c2(M,p),z=-90;const G=k,B=new Hc;for(;k>0;){const q=360*k-180;B.addPath([[q,z],[q,-1*z]]),z*=-1,k--}if(P.length>0&&G>0){const q=a7e(P,await KFe(s,P,B,i)),X=[],oe=[];for(let fe=0;fe<$.length;fe++){const me=$[fe];if(me!=="cut")oe.push(me);else{const ge=q.shift(),Ce=e[fe];L(Ce)&&Ce.type==="polygon"&&Ce.rings&&Ce.rings.length>1&&ge.rings.length>=Ce.rings.length?(X.push(ge),oe.push("simplify")):oe.push(l?e0(ge):ge)}}if(!X.length)return oe;const de=await QFe(s,X,i),he=[];for(let fe=0;fe<oe.length;fe++){const me=oe[fe];me!=="simplify"?he.push(me):he.push(l?e0(de.shift()):de.shift())}return he}const W=[];for(let q=0;q<$.length;q++){const X=$[q];if(X!=="cut")W.push(X);else{const oe=P.shift();W.push(l===!0?e0(oe):oe)}}return Promise.resolve(W)}var by;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(by||(by={}));const hie=4294967296,l7e=new TextDecoder("utf-8"),c7e=je("safari")||je("ios")?6:je("ff")?12:32;class M2{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=by.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new M2(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*hie;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*hie;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),a=t(n,i,r,s);return n.release(),a}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=M2.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){M2.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case by.varint:this._decodeVarint();break;case by.fixed64:this._skip(8);break;case by.delimited:this._skip(this._getLength());break;case by.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==by.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>c7e){const a=t.subarray(i,r);return l7e.decode(a)}let s="",n="";for(let a=i;a<r;++a){const l=t[a];128&l?n+="%"+l.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(l),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}M2.pool=new mn(M2,null,e=>{e._data=null,e._dataView=null});class za{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new za(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new za(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class g0{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new g0(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function h7e(e){return!(J(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class sTt extends g0{}class mN{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new mN;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const qge=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class nTt{constructor(t){this.options=t,this.geometryTypes=qge,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new mN}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||Vo(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=uS(this.options.sourceSpatialReference)/uS(t.spatialReference);if(i!==1)for(const r of t.features){if(!h7e(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new g0}createSpatialReference(){return{wkid:0}}createGeometry(){return new za}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new za}}const uie=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],die=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],pie=["upperLeft","lowerLeft"];function fie(e){return e>=uie.length?null:uie[e]}function u7e(e){return e>=die.length?null:die[e]}function mie(e){return e>=pie.length?null:pie[e]}function gie(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function d7e(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),a=e.pos()+n;let l=0;for(;e.pos()<a;)t.addCoordinatePoint(s,e.getSInt64(),l++);break}default:e.skip()}return s}function p7e(e,t,i){const n=t.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const l=e.getUInt32(),p=e.pos()+l;let y=0;for(;e.pos()<p;)t.addLength(n,e.getUInt32(),y++);break}case 3:{const l=e.getUInt32(),p=e.pos()+l;let y=0;for(t.allocateCoordinates(n);e.pos()<p;)t.addCoordinate(n,e.getSInt64(),y),y++,y===a&&(y=0);break}default:e.skip()}return n}function f7e(e){const s=new za;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;for(;e.pos()<l;)s.lengths.push(e.getUInt32());break}case 3:{const a=e.getUInt32(),l=e.pos()+a;for(;e.pos()<l;)s.coords.push(e.getSInt64());break}case 1:n=qge[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function m7e(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g7e(e){const l={type:fie(0)};for(;e.next();)switch(e.tag()){case 1:l.name=e.getString();break;case 2:l.type=fie(e.getEnum());break;case 3:l.alias=e.getString();break;case 4:l.sqlType=u7e(e.getEnum());break;case 5:e.skip();break;case 6:l.defaultValue=e.getString();break;default:e.skip()}return l}function y7e(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function v7e(e,t,i,r){const l=t.createFeature(i);let p=0;for(;e.next();)switch(e.tag()){case 1:{const y=r[p++].name;l.attributes[y]=e.processMessage(m7e);break}case 2:l.geometry=e.processMessageWithArgs(p7e,t,i);break;case 4:l.centroid=e.processMessageWithArgs(d7e,t,i);break;default:e.skip()}return l}function _7e(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function b7e(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function w7e(e){const s={originPosition:mie(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=mie(e.getEnum());break;case 2:s.scale=e.processMessage(_7e);break;case 3:s.translate=e.processMessage(b7e);break;default:e.skip()}return s}function x7e(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function T7e(e,t){const l=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:l.wkid=e.getUInt32();break;case 5:l.wkt=e.getString();break;case 2:l.latestWkid=e.getUInt32();break;case 3:l.vcsWkid=e.getUInt32();break;case 4:l.latestVcsWkid=e.getUInt32();break;default:e.skip()}return l}function S7e(e,t){const $=t.createFeatureResult();$.geometryType=gie(t,0);let k=!1;for(;e.next();)switch(e.tag()){case 1:$.objectIdFieldName=e.getString();break;case 3:$.globalIdFieldName=e.getString();break;case 4:$.geohashFieldName=e.getString();break;case 5:$.geometryProperties=e.processMessage(x7e);break;case 7:$.geometryType=gie(t,e.getEnum());break;case 8:$.spatialReference=e.processMessageWithArgs(T7e,t);break;case 10:$.hasZ=e.getBool();break;case 11:$.hasM=e.getBool();break;case 12:$.transform=e.processMessage(w7e);break;case 9:{const z=e.getBool();$.exceededTransferLimit=z;break}case 13:t.addField($,e.processMessage(g7e));break;case 15:k||(t.prepareFeatures($),k=!0),t.addFeature($,e.processMessageWithArgs(v7e,t,$,$.fields));break;case 2:$.uniqueIdField=e.processMessage(y7e);break;default:e.skip()}return t.finishFeatureResult($),$}function E7e(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(f7e);break;case 1:s.featureResult=e.processMessageWithArgs(S7e,t);break;default:e.skip()}return L(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function A7e(e,t){try{const r=new M2(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(E7e,t):r.skip();return s}catch(i){throw new Se("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function C7e(e,t){const i=A7e(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const a=r.objectIdFieldName;for(const l of r.features)l.attributes&&(l.objectId=l.attributes[a])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function K6(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=vX(i.geometryType,t,e.outSpatialReference);if(!J(r))for(const s of i.features)r(s.geometry)}const yie="Layer does not support extent calculation.";function Wge(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Xge(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r,n=e.outSpatialReference;let a,l;if(L(i)&&(a=i.spatialReference,l=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=Vv(i),s.geometry=Wge(i,e.compactGeometryEnabled),s.inSR=l),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(t!=null&&t.returnCountOnly||t!=null&&t.returnExtentOnly||t!=null&&t.returnIdsOnly)?delete s.outFields:r.outFields.indexOf("*")!==-1?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?s.outSR=r.outSR.wkid||JSON.stringify(r.outSR):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&L(a)&&L(e.quantizationParameters)&&L(e.quantizationParameters.extent)&&a.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const p=r.timeExtent,{start:y,end:b}=p;y==null&&b==null||(s.time=y===b?y:`${y==null?"null":y},${b==null?"null":b}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&L(a)&&L(n)&&a.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Yge(e,t,i,r){const s=L(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await vE(e,t,"json",r);return K6(t,i,s.data),s}async function Jge(e,t,i,r){if(L(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:i.createFeatureResult()});const s=await Zge(e,t,r),n=s;return n.data=C7e(s.data,i),n}function Zge(e,t,i){return vE(e,t,"pbf",i)}function Kge(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):vE(e,t,"json",i,{returnIdsOnly:!0})}function Qge(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):vE(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function e1e(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):vE(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(yie);if(s.hasOwnProperty("count"))throw new Error(yie);return r})}function vE(e,t,i,r={},s={}){const n=typeof e=="string"?Gn(e):e,a=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",fN(a,null,r).then(l=>{const p=l&&l[0];L(p)&&((t=t.clone()).geometry=p);const y=GO(ie(ie(qe(ie({},n.query),{f:i}),s),Xge(t,s)));return Ar(ih(n.path,"query"),qe(ie({},r),{query:ie(ie({},y),r.query)}))})}var oTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",encodeGeometry:Wge,executeQuery:Yge,executeQueryForCount:Qge,executeQueryForExtent:e1e,executeQueryForIds:Kge,executeQueryPBF:Jge,executeQueryPBFBuffer:Zge,queryToQueryStringParameters:Xge,runQuery:vE});async function M7e(e,t,i){const r=lu(e);return Qge(r,ql.from(t),ie({},i)).then(s=>s.data.count)}async function R7e(e,t,i){const r=lu(e);return e1e(r,ql.from(t),ie({},i)).then(s=>({count:s.data.count,extent:ki.fromJSON(s.data.extent)}))}async function O7e(e,t,i){const r=lu(e);return Kge(r,ql.from(t),ie({},i)).then(s=>s.data.objectIds)}var hG;const uG=new Ui({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Zo=hG=class extends Ye{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const i=It.fromJSON(t.spatialReference),r=[];for(let s=0;s<e.length;s++){const n=e[s],a=gl.fromJSON(n),l=n.geometry&&n.geometry.spatialReference;L(a.geometry)&&!l&&(a.geometry.spatialReference=i);const p=n.aggregateGeometries,y=a.aggregateGeometries;if(p&&L(y))for(const b in y){const x=y[b],A=p[b],M=A==null?void 0:A.spatialReference;L(x)&&!M&&(x.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void uG.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&L(n.geometry))return void uG.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Lp(e);return!i&&t.spatialReference&&(r.spatialReference=It.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&L(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new hG(this.cloneProperties())}cloneProperties(){return Fe({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=y=>Math.round((y-r)/t),a=y=>Math.round((s-y)/i),l=this.features,p=this._getQuantizationFunction(this.geometryType,n,a);for(let y=0,b=l.length;y<b;y++)p(l[y].geometry)||(l.splice(y,1),y--,b--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,a]}=i,l=b=>b*n+r,p=b=>s-b*a,y=this._getHydrationFunction(e,l,p);for(const{geometry:b}of t)L(b)&&y(b);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let a=0,l=e.length;a<l;a++){const p=e[a];if(a>0){const y=t(p[0]),b=i(p[1]);y===r&&b===s||(n.push([y-r,b-s]),r=y,s=b)}else r=t(p[0]),s=i(p[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=b2(r)?r.rings:r.paths,n=[];for(let a=0,l=s.length;a<l;a++){const p=s[a],y=this._quantizePoints(p,t,i);y&&n.push(y)}return n.length>0?(b2(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=b2(r)?r.rings:r.paths;let n,a;for(let l=0,p=s.length;l<p;l++){const y=s[l];for(let b=0,x=y.length;b<x;b++){const A=y[b];b>0?(n+=A[0],a+=A[1]):(n=A[0],a=A[1]),A[0]=t(n),A[1]=i(a)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,a;for(let l=0,p=s.length;l<p;l++){const y=s[l];l>0?(n+=y[0],a+=y[1]):(n=y[0],a=y[1]),y[0]=t(n),y[1]=i(a)}}:void 0}};_([S({type:String,json:{write:!0}})],Zo.prototype,"displayFieldName",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Zo.prototype,"exceededTransferLimit",void 0),_([S({type:[gl],json:{write:!0}})],Zo.prototype,"features",void 0),_([wt("features")],Zo.prototype,"readFeatures",null),_([S({type:[VO],json:{write:!0}})],Zo.prototype,"fields",void 0),_([S({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:uG.read}}})],Zo.prototype,"geometryType",void 0),_([Et("geometryType")],Zo.prototype,"writeGeometryType",null),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Zo.prototype,"hasM",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Zo.prototype,"hasZ",void 0),_([S({types:Sw,json:{write:!0}})],Zo.prototype,"queryGeometry",void 0),_([wt("queryGeometry")],Zo.prototype,"readQueryGeometry",null),_([S({type:It,json:{write:!0}})],Zo.prototype,"spatialReference",void 0),_([Et("spatialReference")],Zo.prototype,"writeSpatialReference",null),_([S({json:{write:!0}})],Zo.prototype,"transform",void 0),Zo=hG=_([re("esri.rest.support.FeatureSet")],Zo),Zo.prototype.toJSON.isDefaultToJSON=!0;const Iw=Zo;var aTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Iw});async function lTt(e,t,i){const r=await t1e(e,t,i);return Iw.fromJSON(r)}async function t1e(e,t,i){const r=lu(e),s=ie({},i),n=ql.from(t),{data:a}=await Yge(r,n,n.sourceSpatialReference,s);return a}function Ba(e,t){return e?t?4:3:t?3:2}const jO=Ge.getLogger("esri.layers.graphics.featureConversionUtils"),i1e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},r1e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},Q6=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},P7e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},s1e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function JX(e,t,i,r){if(e){if(i)return t&&r?s1e:Q6;if(t&&r)return P7e}else if(t&&r)return Q6;return r1e}function h7({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function u7({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function vie({scale:e,translate:t},i){return i*e[0]+t[0]}function _ie({scale:e,translate:t},i){return t[1]-i*e[1]}function dG(e,t,i){return e?t?i?QX(e):ZX(e):i?KX(e):gN(e):null}function gN(e){const t=e.coords;return{x:t[0],y:t[1]}}function n1e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function ZX(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function I7e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function KX(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function $7e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function QX(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function D7e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function L7e(e,t,i,r){let s=gN;i&&r?s=QX:i?s=ZX:r&&(s=KX);for(const n of t){const{geometry:a,attributes:l}=n,p=L(a)?s(a):null;e.push({attributes:l,geometry:p})}return e}function eY(e,t){return e&&t?D7e:e?I7e:t?$7e:n1e}function N7e(e,t,i,r,s){const n=eY(i,r);for(const a of t){const{geometry:l,attributes:p}=a;let y;l&&(y=n(new za,l)),e.push(new g0(y,p,null,p[s]))}return e}function cTt(e,t,i=eY(t.z!=null,t.m!=null)){return i(e,t)}function F7e(e,t,i,r){for(const s of t){const{geometry:n,attributes:a}=s;let l;n&&(l=tY(n,i,r)),e.push({attributes:a,geometry:l})}return e}function tY(e,t,i){if(J(e))return null;const r=Ba(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const a=[];for(let l=0;l<r;l++)a.push(e.coords[n+l]);s.push(a)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function k7e(e,t,i,r,s){const n=Ba(i,r);for(const a of t){const l=a.geometry,p=a.attributes;let y;l&&(y=o1e(new za,l,n)),e.push(new g0(y,p,null,p[s]))}return e}function o1e(e,t,i=Ba(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let a=0;a<i;a++)r[s++]=n[a];return e}function U7e(e,t,i,r){for(const s of t){const{geometry:n,attributes:a}=s;let l;L(n)&&(l=iY(n,i,r)),e.push({attributes:a,geometry:l})}return e}function iY(e,t,i){if(!e)return null;const r=Ba(t,i),{coords:s,lengths:n}=e,a=[];let l=0;for(const p of n){const y=[];for(let b=0;b<p;b++){const x=[];for(let A=0;A<r;A++)x.push(s[l++]);y.push(x)}a.push(y)}return t?i?{paths:a,hasZ:t,hasM:i}:{paths:a,hasZ:t}:i?{paths:a,hasM:i}:{paths:a}}function z7e(e,t,i,r,s){const n=Ba(i,r);for(const a of t){const l=a.geometry,p=a.attributes;let y;l&&(y=a1e(new za,l,n)),e.push(new g0(y,p,null,p[s]))}return e}function a1e(e,t,i=Ba(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const a of t.paths){for(const l of a)for(let p=0;p<i;p++)s[n++]=l[p];r.push(a.length)}return e}function B7e(e,t,i,r){for(const s of t){const{geometry:n,attributes:a,centroid:l}=s;let p;if(L(n)&&(p=rY(n,i,r)),L(l)){const y=gN(l);e.push({attributes:a,centroid:y,geometry:p})}else e.push({attributes:a,geometry:p})}return e}function rY(e,t,i){if(!e)return null;const r=Ba(t,i),{coords:s,lengths:n}=e,a=[];let l=0;for(const p of n){const y=[];for(let b=0;b<p;b++){const x=[];for(let A=0;A<r;A++)x.push(s[l++]);y.push(x)}a.push(y)}return t?i?{rings:a,hasZ:t,hasM:i}:{rings:a,hasZ:t}:i?{rings:a,hasM:i}:{rings:a}}function V7e(e,t,i,r,s){for(const n of t){const a=n.geometry,l=n.centroid,p=n.attributes;let y;a&&(y=l1e(new za,a,i,r)),L(l)?e.push(new g0(y,p,n1e(new za,l),p[s])):e.push(new g0(y,p,null,p[s]))}return e}function l1e(e,t,i=t.hasZ,r=t.hasM){return G7e(e,t.rings,i,r),e}function G7e(e,t,i,r){const s=Ba(i,r),{lengths:n,coords:a}=e;let l=0;n.length=a.length=0;for(const p of t){for(const y of p)for(let b=0;b<s;b++)a[l++]=y[b];n.push(p.length)}return e}const AT=[],EM=[];function hTt(e,t,i,r,s){AT[0]=e;const[n]=c1e(EM,AT,t,i,r,s);return AT.length=EM.length=0,n}function c1e(e,t,i,r,s,n){if(e.length=0,!i){for(const a of t){const l=a.attributes[n];e.push(new g0(null,a.attributes,null,l))}return e}switch(i){case"esriGeometryPoint":return N7e(e,t,r,s,n);case"esriGeometryMultipoint":return k7e(e,t,r,s,n);case"esriGeometryPolyline":return z7e(e,t,r,s,n);case"esriGeometryPolygon":return V7e(e,t,r,s,n);default:jO.error("convertToFeatureSet:unknown-geometry",new Se(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function uTt(e,t,i,r){EM[0]=e,d1e(AT,EM,t,i,r);const s=AT[0];return AT.length=EM.length=0,s}function h1e(e,t,i){if(J(e))return null;const r=new za;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),jW(e)?eY(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):b2(e)?l1e(r,e,t,i):HW(e)?a1e(r,e,Ba(t,i)):GW(e)?o1e(r,e,Ba(t,i)):void jO.error("convertFromGeometry:unknown-geometry",new Se(`Unable to parse unknown geometry type '${e}'`))}function u1e(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(J(s))return null;switch(t){case"esriGeometryPoint":{let n=gN;return i&&r?n=QX:i?n=ZX:r&&(n=KX),n(s)}case"esriGeometryMultipoint":return tY(s,i,r);case"esriGeometryPolyline":return iY(s,i,r);case"esriGeometryPolygon":return rY(s,i,r);default:return void jO.error("convertToGeometry:unknown-geometry",new Se(`Unable to parse unknown geometry type '${t}'`))}}function j7e(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function d1e(e,t,i,r,s){if(e.length=0,J(i))return j7e(e,t);switch(i){case"esriGeometryPoint":return L7e(e,t,r,s);case"esriGeometryMultipoint":return F7e(e,t,r,s);case"esriGeometryPolyline":return U7e(e,t,r,s);case"esriGeometryPolygon":return B7e(e,t,r,s);default:jO.error("convertToFeatureSet:unknown-geometry",new Se(`Unable to parse unknown geometry type '${i}'`))}return e}function dTt(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:a,features:l,geometryType:p,exceededTransferLimit:y,uniqueIdField:b,queryGeometry:x,queryGeometryType:A}=e,M={features:d1e([],l,p,a,n),fields:s,geometryType:p,objectIdFieldName:t,spatialReference:i,uniqueIdField:b,queryGeometry:u1e(x,A,!1,!1)};return r&&(M.transform=r),y&&(M.exceededTransferLimit=y),n&&(M.hasM=n),a&&(M.hasZ=a),M}function pTt(e,t){const i=new mN,{hasM:r,hasZ:s,features:n,objectIdFieldName:a,spatialReference:l,geometryType:p,exceededTransferLimit:y,transform:b,fields:x}=e;return x&&(i.fields=x),i.geometryType=p,i.objectIdFieldName=a||t,i.spatialReference=l,i.objectIdFieldName?(n&&c1e(i.features,n,p,s,r,i.objectIdFieldName),y&&(i.exceededTransferLimit=y),r&&(i.hasM=r),s&&(i.hasZ=s),b&&(i.transform=b),i):(jO.error(new Se("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function fTt(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)L(n.geometry)&&fG(n.geometry,n.geometry,r,s,t),L(n.centroid)&&fG(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function mTt(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let a=0;a<r.length;a++){const l=r[a],p=l.weakClone();p.geometry=new za,_R(p.geometry,l.geometry,s,n,i,e),l.centroid&&(p.centroid=new za,_R(p.centroid,l.centroid,s,n,"esriGeometryPoint",e)),r[a]=p}return t.transform=e,t}function _R(e,t,i,r,s,n,a=i,l=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),J(t)||!t.coords.length)return null;const p=i1e[s],{coords:y,lengths:b}=t,x=Ba(i,r),A=Ba(i&&a,r&&l),M=JX(i,r,a,l);if(!b.length)return M(e.coords,y,0,0,h7(n,y[0]),u7(n,y[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=x,e;let P,$,k,z,G=0,B=0,W=B;for(const q of b){if(q<p)continue;let X=0;B=W,k=P=h7(n,y[G]),z=$=u7(n,y[G+1]),M(e.coords,y,B,G,k,z),X++,G+=x,B+=A;for(let oe=1;oe<q;oe++,G+=x)k=h7(n,y[G]),z=u7(n,y[G+1]),k===P&&z===$||(M(e.coords,y,B,G,k-P,z-$),B+=A,X++,P=k,$=z);X>=p&&(e.lengths.push(X),W=B)}return e.coords.length=W,e.coords.length?e:null}function H7e(e,t,i,r,s,n,a=i,l=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const p=i1e[s],{coords:y,lengths:b}=t,x=Ba(i,r),A=Ba(i&&a,r&&l),M=JX(i,r,a,l);if(!b.length)return M(e.coords,y,0,0,y[0],y[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=x,e;let P=0;const $=n*n;for(const k of b){if(k<p){P+=k*x;continue}const z=e.coords.length/A,G=P,B=P+(k-1)*x;M(e.coords,y,e.coords.length,G,y[G],y[G+1]),pG(e.coords,y,x,$,M,G,B),M(e.coords,y,e.coords.length,B,y[B],y[B+1]);const W=e.coords.length/A-z;W>=p?e.lengths.push(W):e.coords.length=z*A,P+=k*x}return e.coords.length?e:null}function q7e(e,t,i,r){const s=e[t],n=e[t+1],a=e[i],l=e[i+1],p=e[r],y=e[r+1];let b=a,x=l,A=p-b,M=y-x;if(A!==0||M!==0){const P=((s-b)*A+(n-x)*M)/(A*A+M*M);P>1?(b=p,x=y):P>0&&(b+=A*P,x+=M*P)}return A=s-b,M=n-x,A*A+M*M}function pG(e,t,i,r,s,n,a){let l,p=r,y=0;for(let b=n+i;b<a;b+=i)l=q7e(t,b,n,a),l>p&&(y=b,p=l);p>r&&(y-n>i&&pG(e,t,i,r,s,n,y),s(e,t,e.length,y,t[y],t[y+1]),a-y>i&&pG(e,t,i,r,s,y,a))}function gTt(e,t,i,r){if(J(t)||!t.coords||!t.coords.length)return null;const s=Ba(i,r);let n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(t&&t.coords){const y=t.coords;for(let b=0;b<y.length;b+=s){const x=y[b],A=y[b+1];n=Math.min(n,x),l=Math.max(l,x),a=Math.min(a,A),p=Math.max(p,A)}}return e[0]=n,e[1]=a,e[2]=l,e[3]=p,e}function fG(e,t,i,r,s){const{coords:n,lengths:a}=t,l=i?r?s1e:Q6:r?Q6:r1e,p=Ba(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return l(e.coords,n,0,0,vie(s,n[0]),_ie(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=p),e;const[y,b]=s.scale;let x=0;for(let A=0;A<a.length;A++){const M=a[A];e.lengths[A]=M;let P=vie(s,n[x]),$=_ie(s,n[x+1]);l(e.coords,n,x,x,P,$),x+=p;for(let k=1;k<M;k++,x+=p)P+=n[x]*y,$-=n[x+1]*b,l(e.coords,n,x,x,P,$)}return e!==t&&(e.lengths.length=a.length,e.coords.length=n.length),e}function W7e(e,t,i,r,s,n){const a=Ba(i,r),l=JX(i,r,s,n),p=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let y=0;y<p.length;y+=a)l(e.coords,p,e.coords.length,y,p[y],p[y+1]);return e}function X7e(e,t,i,r){let s=0,n=e[r*t],a=e[r*(t+1)];for(let l=1;l<i;l++){const p=n+e[r*(t+l)],y=a+e[r*(t+l)+1],b=(p-n)*(y+a);n=p,a=y,s+=b}return .5*s}function yTt(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let a=0;a<r.length;a++)n+=X7e(i,s,r[a],t),s+=a;return Math.abs(n)}function vTt(e,t){if(J(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let a=0;a<s.length;a++){const l=s[a];let p=r[t*n],y=r[t*n+1];for(let b=1;b<l;b++){const x=p+r[t*(n+b)],A=y+r[t*(n+b)+1];i.coords[t*(n+b)]=x,i.coords[t*(n+b)+1]=A,p=x,y=A}n+=l}return i}function Y7e(e,t){return t}function sY(e,t,i,r){switch(i){case 0:return bR(e,t+r,0);case 1:return e.originPosition==="lowerLeft"?bR(e,t+r,1):K7e(e,t+r,1)}}function p1e(e,t,i,r){return i===2?bR(e,t,2):sY(e,t,i,r)}function J7e(e,t,i,r){return i===2?bR(e,t,3):sY(e,t,i,r)}function Z7e(e,t,i,r){return i===3?bR(e,t,3):p1e(e,t,i,r)}function bR({translate:e,scale:t},i,r){return e[r]+i*t[r]}function K7e({translate:e,scale:t},i,r){return e[r]-i*t[r]}class Q7e{constructor(t){this.options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=Y7e,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(t){if(this.options.applyTransform&&(t.transform=null),this._attributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!t.hasZ)return;const i=vX(t.geometryType,this.options.sourceSpatialReference,t.spatialReference);if(!J(i))for(const r of t.features)i(r.geometry)}createSpatialReference(){return{}}addField(t,i){t.fields.push(i);const r=t.fields.map(s=>s.name);this._attributesConstructor=function(){for(const s of r)this[s]=null}}addFeature(t,i){t.features.push(i)}prepareFeatures(t){switch(this.transform=t.transform,this.options.applyTransform&&t.transform&&(this.applyTransform=this._deriveApplyTransform(t)),this.vertexDimension=2,t.hasZ&&this.vertexDimension++,t.hasM&&this.vertexDimension++,t.geometryType){case"esriGeometryPoint":this.addCoordinate=(i,r,s)=>this.addCoordinatePoint(i,r,s),this.createGeometry=i=>this.createPointGeometry(i);break;case"esriGeometryPolygon":this.addCoordinate=(i,r,s)=>this._addCoordinatePolygon(i,r,s),this.createGeometry=i=>this._createPolygonGeometry(i);break;case"esriGeometryPolyline":this.addCoordinate=(i,r,s)=>this._addCoordinatePolyline(i,r,s),this.createGeometry=i=>this._createPolylineGeometry(i);break;case"esriGeometryMultipoint":this.addCoordinate=(i,r,s)=>this._addCoordinateMultipoint(i,r,s),this.createGeometry=i=>this._createMultipointGeometry(i);break;default:t.geometryType}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(t,i,r){this.lengths.length===0&&(this.toAddInCurrentPath=i),this.lengths.push(i)}addQueryGeometry(t,i){const{queryGeometry:r,queryGeometryType:s}=i,n=fG(r.clone(),r,!1,!1,this.transform),a=u1e(n,s,!1,!1);t.queryGeometryType=s,t.queryGeometry=ie({},a)}createPointGeometry(t){const i={x:0,y:0,spatialReference:t.spatialReference};return t.hasZ&&(i.z=0),t.hasM&&(i.m=0),i}addCoordinatePoint(t,i,r){switch(i=this.applyTransform(this.transform,i,r,0),r){case 0:t.x=i;break;case 1:t.y=i;break;case 2:"z"in t?t.z=i:t.m=i;break;case 3:t.m=i}}_transformPathLikeValue(t,i){let r=0;return i<=1&&(r=this.previousCoordinate[i],this.previousCoordinate[i]+=t),this.applyTransform(this.transform,t,i,r)}_addCoordinatePolyline(t,i,r){this._dehydratedAddPointsCoordinate(t.paths,i,r)}_addCoordinatePolygon(t,i,r){this._dehydratedAddPointsCoordinate(t.rings,i,r)}_addCoordinateMultipoint(t,i,r){r===0&&t.points.push([]);const s=this._transformPathLikeValue(i,r);t.points[t.points.length-1].push(s)}_createPolygonGeometry(t){return{rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,i,r){r===0&&this.toAddInCurrentPath--==0&&(t.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this._transformPathLikeValue(i,r),n=t[t.length-1];r===0&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),n.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}_deriveApplyTransform(t){const{hasZ:i,hasM:r}=t;return i&&r?Z7e:i?p1e:r?J7e:sY}}async function eke(e,t,i){const r=lu(e),s=ie({},i),n=ql.from(t),a=!n.quantizationParameters,{data:l}=await Jge(r,n,new Q7e({sourceSpatialReference:n.sourceSpatialReference,applyTransform:a}),s);return l}function tke(e,t){const i=e.toJSON();return i.objectIds&&(i.objectIds=i.objectIds.join(",")),i.orderByFields&&(i.orderByFields=i.orderByFields.join(",")),!i.outFields||t!=null&&t.returnCountOnly?delete i.outFields:i.outFields.indexOf("*")!==-1?i.outFields="*":i.outFields=i.outFields.join(","),i.outSpatialReference&&(i.outSR=i.outSR.wkid||JSON.stringify(i.outSR.toJSON()),delete i.outSpatialReference),i.dynamicDataSource&&(i.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i}async function ike(e,t,i){const r=await f1e(e,t,i),s=r.data,n=s.geometryType,a=s.spatialReference,l={};for(const p of s.relatedRecordGroups){const y={fields:void 0,objectIdFieldName:void 0,geometryType:n,spatialReference:a,hasZ:!!s.hasZ,hasM:!!s.hasM,features:p.relatedRecords};if(p.objectId!=null)l[p.objectId]=y;else for(const b in p)p.hasOwnProperty(b)&&b!=="relatedRecords"&&(l[p[b]]=y)}return qe(ie({},r),{data:l})}async function rke(e,t,i){const r=await f1e(e,t,i,{returnCountOnly:!0}),s=r.data,n={};for(const a of s.relatedRecordGroups)a.objectId!=null&&(n[a.objectId]=a.count);return qe(ie({},r),{data:n})}async function f1e(e,t,i={},r){const s=GO(ie(ie(qe(ie({},e.query),{f:"json"}),r),tke(t,r)));return Ar(e.path+"/queryRelatedRecords",qe(ie({},i),{query:ie(ie({},i.query),s)}))}async function ske(e,t,i){t=Z2.from(t);const r=lu(e);return ike(r,t,i).then(s=>{const n=s.data,a={};return Object.keys(n).forEach(l=>a[l]=Iw.fromJSON(n[l])),a})}async function nke(e,t,i){t=Z2.from(t);const r=lu(e);return rke(r,t,ie({},i)).then(s=>s.data)}const bie="Layer does not support extent calculation.";function oke(e,t){var i,r;const s=e.geometry,n=e.toJSON(),a=n;if(L(s)&&(a.geometry=JSON.stringify(s),a.geometryType=Vv(s),a.inSR=s.spatialReference.wkid||JSON.stringify(s.spatialReference)),(i=n.topFilter)!=null&&i.groupByFields&&(a.topFilter.groupByFields=n.topFilter.groupByFields.join(",")),(r=n.topFilter)!=null&&r.orderByFields&&(a.topFilter.orderByFields=n.topFilter.orderByFields.join(",")),n.topFilter&&(a.topFilter=JSON.stringify(a.topFilter)),n.objectIds&&(a.objectIds=n.objectIds.join(",")),n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),n.outFields&&!(t!=null&&t.returnCountOnly||t!=null&&t.returnExtentOnly||t!=null&&t.returnIdsOnly)?n.outFields.indexOf("*")!==-1?a.outFields="*":a.outFields=n.outFields.join(","):delete a.outFields,n.outSR?a.outSR=n.outSR.wkid||JSON.stringify(n.outSR):s&&n.returnGeometry&&(a.outSR=a.inSR),n.returnGeometry&&delete n.returnGeometry,n.timeExtent){const l=n.timeExtent,{start:p,end:y}=l;p==null&&y==null||(a.time=p===y?p:`${p==null?"null":p},${y==null?"null":y}`),delete n.timeExtent}return a}async function ake(e,t,i,r){const s=await yN(e,t,"json",r);return K6(t,i,s.data),s}async function lke(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):yN(e,t,"json",i,{returnIdsOnly:!0})}async function cke(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):yN(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(bie);if(s.hasOwnProperty("count"))throw new Error(bie);return r})}function hke(e,t,i){return L(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):yN(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function yN(e,t,i,r={},s={}){const n=typeof e=="string"?Gn(e):e,a=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",fN(a,null,r).then(l=>{const p=l&&l[0];L(p)&&((t=t.clone()).geometry=p);const y=GO(ie(ie(qe(ie({},n.query),{f:i}),s),oke(t,s)));return Ar(ih(n.path,"queryTopFeatures"),qe(ie({},r),{query:ie(ie({},y),r.query)}))})}var mG;let r3=mG=class extends Ye{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new mG({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};_([S({type:[String],json:{write:!0}})],r3.prototype,"groupByFields",void 0),_([S({type:Number,json:{write:!0}})],r3.prototype,"topCount",void 0),_([S({type:[String],json:{write:!0}})],r3.prototype,"orderByFields",void 0),r3=mG=_([re("esri.rest.support.TopFilter")],r3);const uke=r3;var gG;const wie=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),xie=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Gs=gG=class extends Ye{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new gG(Fe({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};_([S({type:Boolean,json:{write:!0}})],Gs.prototype,"cacheHint",void 0),_([S({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Gs.prototype,"distance",void 0),_([S({types:Sw,json:{read:Lp,write:!0}})],Gs.prototype,"geometry",void 0),_([S({type:Number,json:{write:!0}})],Gs.prototype,"geometryPrecision",void 0),_([S({type:Number,json:{write:!0}})],Gs.prototype,"maxAllowableOffset",void 0),_([S({type:Number,json:{read:{source:"resultRecordCount"}}})],Gs.prototype,"num",void 0),_([S({json:{write:!0}})],Gs.prototype,"objectIds",void 0),_([S({type:[String],json:{write:!0}})],Gs.prototype,"orderByFields",void 0),_([S({type:[String],json:{write:!0}})],Gs.prototype,"outFields",void 0),_([S({type:It,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Gs.prototype,"outSpatialReference",void 0),_([S({type:String,json:{write:!0}})],Gs.prototype,"resultType",void 0),_([S({json:{write:!0}})],Gs.prototype,"returnGeometry",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Gs.prototype,"returnM",void 0),_([S({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Gs.prototype,"returnZ",void 0),_([S({type:Number,json:{read:{source:"resultOffset"}}})],Gs.prototype,"start",void 0),_([Et("start"),Et("num")],Gs.prototype,"writeStart",null),_([S({type:String,json:{read:{source:"spatialRel",reader:wie.read},write:{target:"spatialRel",writer:wie.write}}})],Gs.prototype,"spatialRelationship",void 0),_([S({type:R0,json:{write:!0}})],Gs.prototype,"timeExtent",void 0),_([S({type:uke,json:{write:!0}})],Gs.prototype,"topFilter",void 0),_([S({type:String,json:{read:xie.read,write:{writer:xie.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Gs.prototype,"units",void 0),_([S({type:String,json:{write:!0}})],Gs.prototype,"where",void 0),Gs=gG=_([re("esri.rest.support.TopFeaturesQuery")],Gs),Gs.from=Ys(Gs);const Zy=Gs;async function dke(e,t,i,r){const s=lu(e),n=ie({},r),{data:a}=await ake(s,Zy.from(t),i,n);return Iw.fromJSON(a)}async function pke(e,t,i){const r=lu(e);return(await lke(r,Zy.from(t),ie({},i))).data.objectIds}async function fke(e,t,i){const r=lu(e),s=await cke(r,Zy.from(t),ie({},i));return{count:s.data.count,extent:ki.fromJSON(s.data.extent)}}async function mke(e,t,i){const r=lu(e);return(await hke(r,Zy.from(t),ie({},i))).data.count}let s3=class extends st{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return typeof e!="string"?e:ie({url:e},t)}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?Gn(e):null}_encode(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let a=0;a<n.length;a++)r[s][a]=this._encode(n[a])}else if(typeof n=="object")if(n.toJSON){const a=n.toJSON(i&&i[s]);r[s]=t?a:JSON.stringify(a)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}};_([S({readOnly:!0})],s3.prototype,"parsedUrl",null),_([S()],s3.prototype,"requestOptions",void 0),_([S({type:String})],s3.prototype,"url",void 0),s3=_([re("esri.tasks.Task")],s3);const gke=s3;let gm=class extends gke{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then(i=>this.featureSetFromJSON(e,i,t))}async executeJSON(e,t){var i;const r=ie(ie({},this.requestOptions),t),s=this._normalizeQuery(e),n=((i=e.outStatistics)==null?void 0:i[0])!=null,a=je("featurelayer-pbf-statistics"),l=!n||a;let p;if(this.format==="pbf"&&l)try{p=await eke(this.url,s,r)}catch(y){if(y.name!=="query:parsing-pbf")throw y;this.format="json"}return this.format!=="json"&&l||(p=await t1e(this.url,s,r)),this._normalizeFields(p.fields),p}async featureSetFromJSON(e,t,i){if(!(this._queryIs3DObjectFormat(e)&&L(this.infoFor3D)&&t.features&&t.features.length))return Iw.fromJSON(t);const{meshFeatureSetFromJSON:r}=await Fq(import("./meshFeatureSet.2ba3578c.js"),i);return r(e,this.infoFor3D,t)}executeForCount(e,t){const i=ie(ie({},this.requestOptions),t),r=this._normalizeQuery(e);return M7e(this.url,r,i)}executeForExtent(e,t){const i=ie(ie({},this.requestOptions),t),r=this._normalizeQuery(e);return R7e(this.url,r,i)}executeForIds(e,t){const i=ie(ie({},this.requestOptions),t),r=this._normalizeQuery(e);return O7e(this.url,r,i)}executeRelationshipQuery(e,t){e=Z2.from(e);const i=ie(ie({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),ske(this.url,e,i)}executeRelationshipQueryForCount(e,t){e=Z2.from(e);const i=ie(ie({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),nke(this.url,e,i)}executeAttachmentQuery(e,t){const i=ie(ie({},this.requestOptions),t);return ZFe(this.url,e,i)}executeTopFeaturesQuery(e,t){const i=ie(ie({},this.requestOptions),t);return dke(this.parsedUrl,e,this.sourceSpatialReference,i)}executeForTopIds(e,t){const i=ie(ie({},this.requestOptions),t);return pke(this.parsedUrl,e,i)}executeForTopExtents(e,t){const i=ie(ie({},this.requestOptions),t);return fke(this.parsedUrl,e,i)}executeForTopCount(e,t){const i=ie(ie({},this.requestOptions),t);return mke(this.parsedUrl,e,i)}_normalizeQuery(e){let t=ql.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?Nh.from(e.dynamicDataSource):this.dynamicDataSource),L(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const i of this.infoFor3D.queryFormats){if(i.id==="3D_glb"){t.formatOf3DObjects=i.id;break}i.id!=="3D_gltf"||t.formatOf3DObjects||(t.formatOf3DObjects=i.id)}if(!t.formatOf3DObjects)throw new Se("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(J(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,J(t.outFields)&&(t.outFields=[]);const{originX:i,originY:r,originZ:s,translationX:n,translationY:a,translationZ:l,scaleX:p,scaleY:y,scaleZ:b,rotationX:x,rotationY:A,rotationZ:M,rotationDeg:P}=this.infoFor3D.transformFieldRoles;t.outFields.push(i,r,s,n,a,l,p,y,b,x,A,M,P)}}return t}_normalizeFields(e){if(L(this.fieldsIndex)&&L(e))for(const t of e){const i=this.fieldsIndex.get(t.name);i&&Object.assign(t,i.toJSON())}}_queryIs3DObjectFormat(e){return L(this.infoFor3D)&&e.returnGeometry&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};_([S({type:Nh})],gm.prototype,"dynamicDataSource",void 0),_([S()],gm.prototype,"fieldsIndex",void 0),_([S()],gm.prototype,"format",void 0),_([S()],gm.prototype,"gdbVersion",void 0),_([S()],gm.prototype,"infoFor3D",void 0),_([S()],gm.prototype,"sourceSpatialReference",void 0),gm=_([re("esri.tasks.QueryTask")],gm);const yke=gm,vke="esri.widgets.Feature.support.relatedFeatureUtils",Tie=Ge.getLogger(vke),Sie=new Map;function xC(e){if(!ig(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function _ke(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function bke({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function wke(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function xke(e,t){const i=_ke(e,t);if(!i)return;const r=`${t.url}/${i.relatedTableId}`;return{url:r,queryTask:new yke({url:r,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}function Tke(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function Ske(e,t,i,r){const s=new Z2;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function Eke(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function Ake(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,queryTask:a,relation:l,relatedFields:p,outStatistics:y}=t,b=bke({originRelationship:l,relationships:n.relationships,layerId:s});if(b.relationshipTableId&&b.keyFieldInRelationshipTable){const A=(await Ske(e,b,i,r))[e.attributes[i.objectIdField]];if(!A)return null;const M=A.features.map(P=>P.attributes[n.objectIdField]);if((y==null?void 0:y.length)>0&&n.supportsStatistics){const P=new ql;P.where=Eke(n.objectIdField,M,1e3),P.outFields=p,P.outStatistics=y;const $={features:Promise.resolve(A),statsFeatures:a.execute(P)};return bo($)}}const x=b==null?void 0:b.keyField;if(x){const A=$L(Pke(n.fields,x)),M=wke(e.attributes,l.keyField),P=A?`${x}=${M}`:`${x}='${M}'`,$=a.execute(new ql({where:P,outFields:t.relatedFields}),r),k=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?a.execute(new ql({where:P,outFields:t.relatedFields,outStatistics:t.outStatistics}),r):null,z={features:$};return k&&(z.statsFeatures=k),bo(z)}return null}function Cke(e,t){return Ar(e,{query:{f:"json"},signal:t&&t.signal})}function Mke({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:a}=s;if(!a){const x=new Se("relation-required","A relation is required on a layer to retrieve related records.");throw Tie.error(x),x}const{relatedTableId:l}=a;if(typeof l!="number"){const x=new Se("A related table ID is required on a layer to retrieve related records.");throw Tie.error(x),x}const p=`${t.url}/${l}`,y=Sie.get(p),b=y||Cke(p,i);y||Sie.set(p,b),r[n]=b}),bo(r)}function Rke({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,a)=>{n.layerInfo&&(s[a]=Ake(e,n,i,r))}),bo(s)}function Oke({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new Gge({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function Pke(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const Eie={chartAnimation:!0};let Oo=class extends st{constructor(e){super(e),this.abilities=ie({},Eie),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return ie(ie({},Eie),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=l2({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:l.title}),l.caption=l2({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:l.caption}),l.altText=l2({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:l.altText}),l.type==="image"){const{value:p}=l;return this._setImageValue({value:p,formattedAttributes:i,layer:n}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:p}=l;return this._setChartValue({value:p,chartType:l.type,attributes:e,formattedAttributes:i,layer:n}),l}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:a}=i;if(a){const l=XV(a,s);i.sourceURL=WV({formattedAttributes:r,template:l,fieldInfoMap:t})}if(n){const l=XV(n,s);i.linkURL=WV({formattedAttributes:r,template:l,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:p,normalizeField:y}=t;if(t.fields=iFe(p,n),y&&(t.normalizeField=J6(y,n)),!p.some(x=>!!(r[x]!=null||ig(x)&&l.size)))return;const b=a==null?void 0:a.fieldInfos;p.forEach(x=>{if(ig(x))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:b,fieldName:x,formattedAttributes:r,chartType:s,value:t})]);const A=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:x,fieldInfos:b});t.series.push(A)})}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:a}=e,l=[],p=xC(r),{layerId:y,fieldName:b}=p,x=(t=this.relatedInfos)==null?void 0:t.get(y.toString());if(!x)return l;const{relatedFeatures:A,relation:M}=x;if(!M||!A)return l;const{cardinality:P}=M;return A.forEach($=>{const{attributes:k}=$;k&&Object.keys(k).forEach(z=>{z===b&&l.push(this._getChartOption({value:a,attributes:k,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:z,fieldInfos:i}))})}),P==="one-to-many"||P==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:r,formattedAttributes:s,fieldName:n,relatedFieldName:a,fieldInfos:l,chartType:p}=e,{layer:y}=this,{normalizeField:b,tooltipField:x}=i,A=b?ig(b)?r[xC(b).fieldName]:r[b]:null,M=a&&r[a]!==void 0?r[a]:r[n]!==void 0?r[n]:s[n],P=M===void 0?null:M&&A?M/A:M,$=new Hfe({value:P});if(ig(n)){const W=xC(n),q=xC(x),X=q?q.fieldName:null,oe=Dge(P,{fieldInfos:l,fieldName:a,layer:y,preventPlacesFormatting:!!A}),de=W?W.label||W.fieldName:a,he=X&&r[X]!==void 0?r[X]:de;return $.tooltip=this._getTooltip({label:he,value:oe,chartType:p}),$}const k=Lge(l,n),z=J6(n,y),G=x&&s[x]!==void 0?s[x]:Ige(k||new FO({fieldName:z}),(t=this.popupTemplate)==null?void 0:t.expressionInfos),B=s[z];return $.tooltip=this._getTooltip({label:G,value:B,chartType:p}),$}};_([S()],Oo.prototype,"abilities",void 0),_([_i("abilities")],Oo.prototype,"castAbilities",null),_([S()],Oo.prototype,"activeMediaInfoIndex",void 0),_([S({readOnly:!0})],Oo.prototype,"activeMediaInfo",null),_([S()],Oo.prototype,"attributes",void 0),_([S()],Oo.prototype,"description",void 0),_([S()],Oo.prototype,"fieldInfoMap",void 0),_([S()],Oo.prototype,"formattedAttributes",void 0),_([S()],Oo.prototype,"expressionAttributes",void 0),_([S({readOnly:!0})],Oo.prototype,"formattedMediaInfos",null),_([S()],Oo.prototype,"layer",void 0),_([S({readOnly:!0})],Oo.prototype,"formattedMediaInfoCount",null),_([S()],Oo.prototype,"mediaInfos",void 0),_([S()],Oo.prototype,"popupTemplate",void 0),_([S()],Oo.prototype,"relatedInfos",void 0),_([S()],Oo.prototype,"title",void 0),Oo=_([re("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Oo);const h2=Oo;var Aie=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Ike=[].concat(Aie.slice(30,39),Aie.slice(28,30).reverse()),$ke=[{name:"default",colors:Ike},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Cie="en-us",nY=new Map([["ar",()=>import("./ar.3d43e886.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.fbf11e39.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.8844eaac.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.026b855d.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.1474b133.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.cc09e350.js").then(e=>e.d)],["de-de",()=>import("./de_DE.26e12193.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.86690601.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.fabaea63.js").then(e=>e.e)],["en-us",()=>import("./en_US.489d72f4.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.0779691c.js").then(e=>e.e)],["es-es",()=>import("./es_ES.8f849ddc.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.59dbbb9e.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.a0b0247a.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.87544fd5.js").then(e=>e.f)],["he-il",()=>import("./he_IL.928b74a0.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.09eb9691.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.0f7ea0fd.js").then(e=>e.h)],["id-id",()=>import("./id_ID.6631ad64.js").then(e=>e.i)],["it-it",()=>import("./it_IT.3a3aff16.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.b65d3928.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.263cecff.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.04e4f79d.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.97f7000f.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.9257a7b5.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.51cd1cc9.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.d36fcc8e.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.7b0f0270.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.544dde34.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.693d1889.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.7931f777.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.8796b3be.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.f9774698.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.b99a7da5.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.5cb29f72.js").then(e=>e.s)],["th-th",()=>import("./th_TH.657ded2e.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.18f50322.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.47cbf260.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.27a8b1bf.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.22fb096c.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.48c19caa.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.48c19caa.js").then(e=>e.z)]]);function Dke(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of nY.keys())if(r.startsWith(t)){i=r;break}return i}function Lke(e){return e?nY.has(e.toLowerCase())?e.toLowerCase():Dke(e)||Cie:Cie}let Ww,YE;async function Nke(e=Wh()){if(e=Lke(e),Ww&&e===YE)return Ww;Ww=import("./index.a46321bd.js").then(t=>t.i),YE=e;try{const[t,i]=await Promise.all([Ww,nY.get(YE)()]);YE===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Ww=null,YE=null,null}return Ww}function Fke(e,t="default"){const i=$ke.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const yn={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},d7=.05,p7=.95,f7=15;let Tc=class extends cc{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new h2,this.messages=null,this._getChartDependencies=async i=>{const r=await Nke(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:a}=n;this._renderChart({chartDiv:i,mediaInfo:a,chartsModule:r})}}initialize(){this._featureElementInfo=new WX,this.own(Pi(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()),Pi(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo()))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Ve("div",{bind:this,class:yn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Ve("div",{key:"media-element-container",class:yn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:a,title:l,type:p}=e,{sourceURL:y,linkURL:b}=s,x=Oge(b)?"_blank":"_self",A=x==="_blank"?"noreferrer":"",M=n?t:null,P=M?M.timestamp:0,$=M?M.sourceURL:y,k=Ve("img",{alt:a||l,key:`media-${p}-${i}-${r}-${P}`,src:$});return(b?Ve("a",{title:l,href:b,rel:A,target:x},k):null)||k}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return Ve("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:yn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.indexOf("chart")!==-1?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?Ve("div",{key:"media-title",class:yn.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?Ve("div",{key:"media-caption",class:yn.mediaItemCaption,innerHTML:e.caption}):null;return Ve("div",{key:"media-container",class:yn.mediaItemContainer},Ve("div",{key:"media-item-container",class:yn.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(yn.mediaButton,yn.mediaPrevious):this.classes(yn.mediaButton,yn.mediaNext),s=t?this.classes(yn.mediaIcon,yn.mediaPreviousIconLTR,yn.iconLeftTriangleArrow):this.classes(yn.mediaIcon,yn.mediaNextIconLTR,yn.iconRightTriangleArrow),n=t?this.classes(yn.mediaIcon,yn.mediaPreviousIconRTL,yn.iconRightTriangleArrow):this.classes(yn.mediaIcon,yn.mediaNextIconRTL,yn.iconLeftTriangleArrow),a=t?"media-previous":"media-next",l=t?this._previous:this._next;return Ve("button",{type:"button",key:a,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:l},Ve("span",{"aria-hidden":"true",class:s}),Ve("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_handleMediaKeyup(e){const t=kb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s}=e,{value:n,type:a}=s,{am4core:l}=i,p=Fke(l);function y(A){A instanceof l.ColorSet&&p&&(A.list=p)}rpe()&&l.useTheme(i.am4themes_dark);const b=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!b.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(y);const x=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),x.data=n.series.map(A=>({tooltip:A.tooltip,value:A.value})).filter(A=>a!=="pie-chart"||A.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=Uy(this.container);const a=n.series.push(new s.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value="value",a.dataFields.category="tooltip",this._customizeChartTooltip(a.tooltip,r),a.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category="tooltip",l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,n),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const p=e.yAxes.push(new a.ValueAxis),y=p.renderer.labels.template;p.renderer.minLabelPosition=d7,p.renderer.maxLabelPosition=p7,p.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(p.tooltip,n),y.wrap=!0;const b=e.series.push(new a.ColumnSeries);b.dataFields.valueY="value",b.dataFields.categoryX="tooltip",e.cursor=new a.XYCursor,s.series.length>f7&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:a}=i,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category="tooltip",l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,n),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dx=l.tooltip.contentWidth});const p=e.xAxes.push(new a.ValueAxis),y=p.renderer.labels.template;p.renderer.minLabelPosition=d7,p.renderer.maxLabelPosition=p7,p.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(p.tooltip,n),y.wrap=!0;const b=e.series.push(new a.ColumnSeries);b.dataFields.valueX="value",b.dataFields.categoryY="tooltip",e.cursor=new a.XYCursor,s.series.length>f7&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category="tooltip",l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,n),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const p=e.yAxes.push(new a.ValueAxis),y=p.renderer.labels.template;p.renderer.minLabelPosition=d7,p.renderer.maxLabelPosition=p7,p.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(p.tooltip,n),y.wrap=!0;const b=e.series.push(new a.LineSeries);b.dataFields.categoryX="tooltip",b.dataFields.valueY="value",e.cursor=new a.XYCursor,s.series.length>f7&&(e.scrollbarX=new n.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:a}=i,l=n.create(t,a.XYChart);return l.rtl=Uy(this.container),s==="column-chart"&&this._createColumnChart(l,e),s==="bar-chart"&&this._createBarChart(l,e),s==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.indexOf("?")!==-1?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};_([oi("viewModel.attributes")],Tc.prototype,"attributes",void 0),_([oi("viewModel.activeMediaInfoIndex")],Tc.prototype,"activeMediaInfoIndex",void 0),_([oi("viewModel.description")],Tc.prototype,"description",void 0),_([oi("viewModel.fieldInfoMap")],Tc.prototype,"fieldInfoMap",void 0),_([oi("viewModel.layer")],Tc.prototype,"layer",void 0),_([oi("viewModel.mediaInfos")],Tc.prototype,"mediaInfos",void 0),_([oi("viewModel.popupTemplate")],Tc.prototype,"popupTemplate",void 0),_([oi("viewModel.relatedInfos")],Tc.prototype,"relatedInfos",void 0),_([oi("viewModel.title")],Tc.prototype,"title",void 0),_([S({type:h2})],Tc.prototype,"viewModel",void 0),_([S(),Zc("esri/widgets/Feature/t9n/Feature")],Tc.prototype,"messages",void 0),Tc=_([re("esri.widgets.Feature.FeatureMedia")],Tc);const m1e=Tc;class kke{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class O0{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class $w extends O0{constructor(t,i,r,s,n,a){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=a}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new Gt(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new Gt(i[0],i[1],void 0,i[2],this._spRef):r&&s?new Gt(i[0],i[1],i[2],i[3],this._spRef):new Gt(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof $w&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class oY extends O0{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new $w(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof oY&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Dw extends Error{}class Uke extends Dw{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class zke extends Dw{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class Bke extends Dw{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class TC extends Dw{}class g1e extends Dw{constructor(t){super(`Invalid unit ${t}`)}}class Yu extends Dw{}class h1 extends Dw{constructor(){super("Zone is an abstract class")}}const Nt="numeric",Up="short",Zh="long",yG={year:Nt,month:Nt,day:Nt},y1e={year:Nt,month:Up,day:Nt},Vke={year:Nt,month:Up,day:Nt,weekday:Up},v1e={year:Nt,month:Zh,day:Nt},_1e={year:Nt,month:Zh,day:Nt,weekday:Zh},b1e={hour:Nt,minute:Nt},w1e={hour:Nt,minute:Nt,second:Nt},x1e={hour:Nt,minute:Nt,second:Nt,timeZoneName:Up},T1e={hour:Nt,minute:Nt,second:Nt,timeZoneName:Zh},S1e={hour:Nt,minute:Nt,hourCycle:"h23"},E1e={hour:Nt,minute:Nt,second:Nt,hourCycle:"h23"},A1e={hour:Nt,minute:Nt,second:Nt,hourCycle:"h23",timeZoneName:Up},C1e={hour:Nt,minute:Nt,second:Nt,hourCycle:"h23",timeZoneName:Zh},M1e={year:Nt,month:Nt,day:Nt,hour:Nt,minute:Nt},R1e={year:Nt,month:Nt,day:Nt,hour:Nt,minute:Nt,second:Nt},O1e={year:Nt,month:Up,day:Nt,hour:Nt,minute:Nt},P1e={year:Nt,month:Up,day:Nt,hour:Nt,minute:Nt,second:Nt},Gke={year:Nt,month:Up,day:Nt,weekday:Up,hour:Nt,minute:Nt},I1e={year:Nt,month:Zh,day:Nt,hour:Nt,minute:Nt,timeZoneName:Up},$1e={year:Nt,month:Zh,day:Nt,hour:Nt,minute:Nt,second:Nt,timeZoneName:Up},D1e={year:Nt,month:Zh,day:Nt,weekday:Zh,hour:Nt,minute:Nt,timeZoneName:Zh},L1e={year:Nt,month:Zh,day:Nt,weekday:Zh,hour:Nt,minute:Nt,second:Nt,timeZoneName:Zh};function Or(e){return typeof e=="undefined"}function R2(e){return typeof e=="number"}function vN(e){return typeof e=="number"&&e%1===0}function jke(e){return typeof e=="string"}function Hke(e){return Object.prototype.toString.call(e)==="[object Date]"}function N1e(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function qke(e){return Array.isArray(e)?e:[e]}function Mie(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function Wke(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function bS(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function rg(e,t,i){return vN(e)&&e>=t&&e<=i}function Xke(e,t){return e-t*Math.floor(e/t)}function mo(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function wy(e){if(!(Or(e)||e===null||e===""))return parseInt(e,10)}function i_(e){if(!(Or(e)||e===null||e===""))return parseFloat(e)}function aY(e){if(!(Or(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function lY(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function HO(e){return e%4===0&&(e%100!==0||e%400===0)}function AM(e){return HO(e)?366:365}function eD(e,t){const i=Xke(t-1,12)+1,r=e+(t-i)/12;return i===2?HO(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function cY(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function tD(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function vG(e){return e>99?e:e>60?1900+e:2e3+e}function F1e(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const a=ie({timeZoneName:t},n),l=new Intl.DateTimeFormat(i,a).formatToParts(s).find(p=>p.type.toLowerCase()==="timezonename");return l?l.value:null}function _N(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function k1e(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Yu(`Invalid unit value ${e}`);return t}function iD(e,t){const i={};for(const r in e)if(bS(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=k1e(s)}return i}function rD(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${mo(i,2)}:${mo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${mo(i,2)}${mo(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function bN(e){return Wke(e,["hour","minute","second","millisecond"])}const Yke=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z0-9_+-]{1,256}(\/[A-Za-z0-9_+-]{1,256})?)?/,Jke=["January","February","March","April","May","June","July","August","September","October","November","December"],U1e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Zke=["J","F","M","A","M","J","J","A","S","O","N","D"];function z1e(e){switch(e){case"narrow":return[...Zke];case"short":return[...U1e];case"long":return[...Jke];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const B1e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],V1e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Kke=["M","T","W","T","F","S","S"];function G1e(e){switch(e){case"narrow":return[...Kke];case"short":return[...V1e];case"long":return[...B1e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const j1e=["AM","PM"],Qke=["Before Christ","Anno Domini"],eUe=["BC","AD"],tUe=["B","A"];function H1e(e){switch(e){case"narrow":return[...tUe];case"short":return[...eUe];case"long":return[...Qke];default:return null}}function iUe(e){return j1e[e.hour<12?0:1]}function rUe(e,t){return G1e(t)[e.weekday-1]}function sUe(e,t){return z1e(t)[e.month-1]}function nUe(e,t){return H1e(t)[e.year<0?0:1]}function oUe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const x=e==="days";switch(t){case 1:return x?"tomorrow":`next ${s[e][0]}`;case-1:return x?"yesterday":`last ${s[e][0]}`;case 0:return x?"today":`this ${s[e][0]}`}}const a=Object.is(t,-0)||t<0,l=Math.abs(t),p=l===1,y=s[e],b=r?p?y[1]:y[2]||y[1]:p?s[e][0]:e;return a?`${l} ${b} ago`:`in ${l} ${b}`}function Rie(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const aUe={D:yG,DD:y1e,DDD:v1e,DDDD:_1e,t:b1e,tt:w1e,ttt:x1e,tttt:T1e,T:S1e,TT:E1e,TTT:A1e,TTTT:C1e,f:M1e,ff:O1e,fff:I1e,ffff:D1e,F:R1e,FF:P1e,FFF:$1e,FFFF:L1e};class Wc{static create(t,i={}){return new Wc(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let a=0;a<t.length;a++){const l=t.charAt(a);l==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||l===i?r+=l:(r.length>0&&n.push({literal:!1,val:r}),r=l,i=l)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return aUe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,ie(ie({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,ie(ie({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,ie(ie({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,ie(ie({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return mo(t,i);const r=ie({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(M,P)=>this.loc.extract(t,M,P),a=M=>t.isOffsetFixed&&t.offset===0&&M.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,M.format):"",l=()=>r?iUe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),p=(M,P)=>r?sUe(t,M):n(P?{month:M}:{month:M,day:"numeric"},"month"),y=(M,P)=>r?rUe(t,M):n(P?{weekday:M}:{weekday:M,month:"long",day:"numeric"},"weekday"),b=M=>{const P=Wc.macroTokenToFormatOpts(M);return P?this.formatWithSystemDefault(t,P):M},x=M=>r?nUe(t,M):n({era:M},"era"),A=M=>{switch(M){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return l();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return y("short",!0);case"cccc":return y("long",!0);case"ccccc":return y("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return y("short",!1);case"EEEE":return y("long",!1);case"EEEEE":return y("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return p("short",!0);case"LLLL":return p("long",!0);case"LLLLL":return p("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return p("short",!1);case"MMMM":return p("long",!1);case"MMMMM":return p("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return x("short");case"GG":return x("long");case"GGGGG":return x("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return b(M)}};return Rie(Wc.parseFormat(i),A)}formatDurationFromString(t,i){const r=p=>{switch(p[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null}},s=p=>y=>{const b=r(y);return b?this.num(p.get(b),y.length):y},n=Wc.parseFormat(i),a=n.reduce((p,{literal:y,val:b})=>y?p:p.concat(b),[]),l=t.shiftTo(...a.map(r).filter(p=>p));return Rie(n,s(l))}}class bp{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class qO{get type(){throw new h1}get name(){throw new h1}get isUniversal(){throw new h1}offsetName(t,i){throw new h1}formatOffset(t,i){throw new h1}offset(t){throw new h1}equals(t){throw new h1}get isValid(){throw new h1}}let m7=null;class hY extends qO{static get instance(){return m7===null&&(m7=new hY),m7}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return F1e(t,i,r)}formatOffset(t,i){return rD(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let v9={};function lUe(e){return v9[e]||(v9[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),v9[e]}const cUe={year:0,month:1,day:2,hour:3,minute:4,second:5};function hUe(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,a,l,p,y]=r;return[a,s,n,l,p,y]}function uUe(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:a}=i[s],l=cUe[n];Or(l)||(r[l]=parseInt(a,10))}return r}let f5={};class Mg extends qO{static create(t){return f5[t]||(f5[t]=new Mg(t)),f5[t]}static resetCache(){f5={},v9={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=Mg.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return F1e(t,i,r,this.name)}formatOffset(t,i){return rD(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=lUe(this.name),[s,n,a,l,p,y]=r.formatToParts?uUe(r,i):hUe(r,i),x=cY({year:s,month:n,day:a,hour:l===24?0:l,minute:p,second:y,millisecond:0});let A=+i;const M=A%1e3;return A-=M>=0?M:1e3+M,(x-A)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let g7=null;class Zl extends qO{static get utcInstance(){return g7===null&&(g7=new Zl(0)),g7}static instance(t){return t===0?Zl.utcInstance:new Zl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Zl(_N(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${rD(this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return rD(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class dUe extends qO{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Iy(e,t){if(Or(e)||e===null)return t;if(e instanceof qO)return e;if(jke(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?Zl.utcInstance:Zl.parseSpecifier(i)||Mg.create(e)}else return R2(e)?Zl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new dUe(e)}let Oie=()=>Date.now(),Pie="system",Iie=null,$ie=null,Die=null,Lie;class $o{static get now(){return Oie}static set now(t){Oie=t}static set defaultZone(t){Pie=t}static get defaultZone(){return Iy(Pie,hY.instance)}static get defaultLocale(){return Iie}static set defaultLocale(t){Iie=t}static get defaultNumberingSystem(){return $ie}static set defaultNumberingSystem(t){$ie=t}static get defaultOutputCalendar(){return Die}static set defaultOutputCalendar(t){Die=t}static get throwOnInvalid(){return Lie}static set throwOnInvalid(t){Lie=t}static resetCaches(){En.resetCache(),Mg.resetCache()}}let Nie={};function pUe(e,t={}){const i=JSON.stringify([e,t]);let r=Nie[i];return r||(r=new Intl.ListFormat(e,t),Nie[i]=r),r}let _G={};function bG(e,t={}){const i=JSON.stringify([e,t]);let r=_G[i];return r||(r=new Intl.DateTimeFormat(e,t),_G[i]=r),r}let wG={};function fUe(e,t={}){const i=JSON.stringify([e,t]);let r=wG[i];return r||(r=new Intl.NumberFormat(e,t),wG[i]=r),r}let xG={};function mUe(e,t={}){const a=t,{base:i}=a,r=wF(a,["base"]),s=JSON.stringify([e,r]);let n=xG[s];return n||(n=new Intl.RelativeTimeFormat(e,t),xG[s]=n),n}let SC=null;function gUe(){return SC||(SC=new Intl.DateTimeFormat().resolvedOptions().locale,SC)}function yUe(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=bG(e).resolvedOptions()}catch{i=bG(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function vUe(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function _Ue(e){const t=[];for(let i=1;i<=12;i++){const r=Di.utc(2016,i,1);t.push(e(r))}return t}function bUe(e){const t=[];for(let i=1;i<=7;i++){const r=Di.utc(2016,11,13+i);t.push(e(r))}return t}function m5(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function wUe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class xUe{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const l=r,{padTo:s,floor:n}=l,a=wF(l,["padTo","floor"]);if(!i||Object.keys(a).length>0){const p=ie({useGrouping:!1},r);r.padTo>0&&(p.minimumIntegerDigits=r.padTo),this.inf=fUe(t,p)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):lY(t,3);return mo(i,this.padTo)}}}class TUe{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const a=-1*(t.offset/60),l=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;t.offset!==0&&Mg.create(l).valid?(s=l,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Di.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=ie({},this.opts);s&&(n.timeZone=s),this.dtf=bG(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class SUe{constructor(t,i,r){this.opts=ie({style:"long"},r),!i&&N1e()&&(this.rtf=mUe(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):oUe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class En{static fromOpts(t){return En.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||$o.defaultLocale,a=n||(s?"en-US":gUe()),l=i||$o.defaultNumberingSystem,p=r||$o.defaultOutputCalendar;return new En(a,l,p,n)}static resetCache(){SC=null,_G={},wG={},xG={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return En.create(t,i,r)}constructor(t,i,r,s){const[n,a,l]=yUe(t);this.locale=n,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.intl=vUe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=wUe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:En.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(qe(ie({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(qe(ie({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return m5(this,t,r,z1e,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=_Ue(a=>this.extract(a,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return m5(this,t,r,G1e,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=bUe(a=>this.extract(a,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return m5(this,void 0,t,()=>j1e,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Di.utc(2016,11,13,9),Di.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return m5(this,t,i,H1e,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[Di.utc(-40,1,1),Di.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),a=n.find(l=>l.type.toLowerCase()===r);return a?a.value:null}numberFormatter(t={}){return new xUe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new TUe(t,this.intl,i)}relFormatter(t={}){return new SUe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return pUe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function _E(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function Lw(...e){return t=>e.reduce(([i,r,s],n)=>{const[a,l,p]=n(t,s);return[ie(ie({},i),a),r||l,p]},[{},null,1]).slice(0,2)}function bE(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function q1e(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=wy(t[i+s]);return[r,null,i+s]}}const W1e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,uY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,X1e=RegExp(`${uY.source}${W1e.source}?`),dY=RegExp(`(?:T${X1e.source})?`),EUe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,AUe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,CUe=/(\d{4})-?(\d{3})/,MUe=q1e("weekYear","weekNumber","weekDay"),RUe=q1e("year","ordinal"),OUe=/(\d{4})-(\d\d)-(\d\d)/,Y1e=RegExp(`${uY.source} ?(?:${W1e.source}|(${Yke.source}))?`),PUe=RegExp(`(?: ${Y1e.source})?`);function CT(e,t,i){const r=e[t];return Or(r)?i:wy(r)}function J1e(e,t){return[{year:CT(e,t),month:CT(e,t+1,1),day:CT(e,t+2,1)},null,t+3]}function Nw(e,t){return[{hours:CT(e,t,0),minutes:CT(e,t+1,0),seconds:CT(e,t+2,0),milliseconds:aY(e[t+3])},null,t+4]}function wE(e,t){const i=!e[t]&&!e[t+1],r=_N(e[t+1],e[t+2]),s=i?null:Zl.instance(r);return[{},s,t+3]}function Z1e(e,t){const i=e[t]?Mg.create(e[t]):null;return[{},i,t+1]}const IUe=RegExp(`^T?${uY.source}$`),$Ue=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function DUe(e){const[t,i,r,s,n,a,l,p,y]=e,b=t[0]==="-",x=p&&p[0]==="-",A=(M,P=!1)=>M!==void 0&&(P||M&&b)?-M:M;return[{years:A(i_(i)),months:A(i_(r)),weeks:A(i_(s)),days:A(i_(n)),hours:A(i_(a)),minutes:A(i_(l)),seconds:A(i_(p),p==="-0"),milliseconds:A(aY(y),x)}]}const LUe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function pY(e,t,i,r,s,n,a){const l={year:t.length===2?vG(wy(t)):wy(t),month:U1e.indexOf(i)+1,day:wy(r),hour:wy(s),minute:wy(n)};return a&&(l.second=wy(a)),e&&(l.weekday=e.length>3?B1e.indexOf(e)+1:V1e.indexOf(e)+1),l}const NUe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function FUe(e){const[,t,i,r,s,n,a,l,p,y,b,x]=e,A=pY(t,s,r,i,n,a,l);let M;return p?M=LUe[p]:y?M=0:M=_N(b,x),[A,new Zl(M)]}function kUe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const UUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,zUe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,BUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Fie(e){const[,t,i,r,s,n,a,l]=e;return[pY(t,s,r,i,n,a,l),Zl.utcInstance]}function VUe(e){const[,t,i,r,s,n,a,l]=e;return[pY(t,l,i,r,s,n,a),Zl.utcInstance]}const GUe=_E(EUe,dY),jUe=_E(AUe,dY),HUe=_E(CUe,dY),qUe=_E(X1e),WUe=Lw(J1e,Nw,wE),XUe=Lw(MUe,Nw,wE),YUe=Lw(RUe,Nw,wE),JUe=Lw(Nw,wE);function ZUe(e){return bE(e,[GUe,WUe],[jUe,XUe],[HUe,YUe],[qUe,JUe])}function KUe(e){return bE(kUe(e),[NUe,FUe])}function QUe(e){return bE(e,[UUe,Fie],[zUe,Fie],[BUe,VUe])}function eze(e){return bE(e,[$Ue,DUe])}const tze=Lw(Nw);function ize(e){return bE(e,[IUe,tze])}const rze=_E(OUe,PUe),sze=_E(Y1e),nze=Lw(J1e,Nw,wE,Z1e),oze=Lw(Nw,wE,Z1e);function aze(e){return bE(e,[rze,nze],[sze,oze])}const lze="Invalid Duration",K1e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},cze=ie({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},K1e),uu=146097/400,Xw=146097/4800,hze=ie({years:{quarters:4,months:12,weeks:uu/7,days:uu,hours:uu*24,minutes:uu*24*60,seconds:uu*24*60*60,milliseconds:uu*24*60*60*1e3},quarters:{months:3,weeks:uu/28,days:uu/4,hours:uu*24/4,minutes:uu*24*60/4,seconds:uu*24*60*60/4,milliseconds:uu*24*60*60*1e3/4},months:{weeks:Xw/7,days:Xw,hours:Xw*24,minutes:Xw*24*60,seconds:Xw*24*60*60,milliseconds:Xw*24*60*60*1e3}},K1e),ib=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],uze=ib.slice(0).reverse();function r_(e,t,i=!1){const r={values:i?t.values:ie(ie({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new Nr(r)}function dze(e){return e<0?Math.floor(e):Math.ceil(e)}function Q1e(e,t,i,r,s){const n=e[s][i],a=t[i]/n,l=Math.sign(a)===Math.sign(r[s]),p=!l&&r[s]!==0&&Math.abs(a)<=1?dze(a):Math.trunc(a);r[s]+=p,t[i]-=p*n}function pze(e,t){uze.reduce((i,r)=>Or(t[r])?i:(i&&Q1e(e,t,i,t,r),r),null)}class Nr{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||En.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?hze:cze,this.isLuxonDuration=!0}static fromMillis(t,i){return Nr.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new Yu(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Nr({values:iD(t,Nr.normalizeUnit),loc:En.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(R2(t))return Nr.fromMillis(t);if(Nr.isDuration(t))return t;if(typeof t=="object")return Nr.fromObject(t);throw new Yu(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=eze(t);return r?Nr.fromObject(r,i):Nr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=ize(t);return r?Nr.fromObject(r,i):Nr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new Yu("need to specify a reason the Duration is invalid");const r=t instanceof bp?t:new bp(t,i);if($o.throwOnInvalid)throw new Bke(r);return new Nr({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new g1e(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=qe(ie({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?Wc.create(this.loc,r).formatDurationFromString(this,t):lze}toHuman(t={}){const i=ib.map(r=>{const s=this.values[r];return Or(s)?null:this.loc.numberFormatter(qe(ie({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(ie({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?ie({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=lY(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=ie({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t),r={};for(const s of ib)(bS(i.values,s)||bS(this.values,s))&&(r[s]=i.get(s)+this.get(s));return r_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=k1e(t(this.values[r],r));return r_(this,{values:i},!0)}get(t){return this[Nr.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=ie(ie({},this.values),iD(t,Nr.normalizeUnit));return r_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),r_(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return pze(this.matrix,t),r_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(a=>Nr.normalizeUnit(a));const i={},r={},s=this.toObject();let n;for(const a of ib)if(t.indexOf(a)>=0){n=a;let l=0;for(const y in r)l+=this.matrix[y][a]*r[y],r[y]=0;R2(s[a])&&(l+=s[a]);const p=Math.trunc(l);i[a]=p,r[a]=(l*1e3-p*1e3)/1e3;for(const y in s)ib.indexOf(y)>ib.indexOf(a)&&Q1e(this.matrix,s,y,i,a)}else R2(s[a])&&(r[a]=s[a]);for(const a in r)r[a]!==0&&(i[n]+=a===n?r[a]:r[a]/this.matrix[n][a]);return r_(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return r_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of ib)if(!i(this.values[r],t.values[r]))return!1;return!0}}const JE="Invalid Interval";function fze(e,t){return!e||!e.isValid?Nn.invalid("missing or invalid start"):!t||!t.isValid?Nn.invalid("missing or invalid end"):t<e?Nn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Nn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new Yu("need to specify a reason the Interval is invalid");const r=t instanceof bp?t:new bp(t,i);if($o.throwOnInvalid)throw new zke(r);return new Nn({invalid:r})}static fromDateTimes(t,i){const r=QE(t),s=QE(i),n=fze(r,s);return n==null?new Nn({start:r,end:s}):n}static after(t,i){const r=Nr.fromDurationLike(i),s=QE(t);return Nn.fromDateTimes(s,s.plus(r))}static before(t,i){const r=Nr.fromDurationLike(i),s=QE(t);return Nn.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,a;try{n=Di.fromISO(r,i),a=n.isValid}catch{a=!1}let l,p;try{l=Di.fromISO(s,i),p=l.isValid}catch{p=!1}if(a&&p)return Nn.fromDateTimes(n,l);if(a){const y=Nr.fromISO(s,i);if(y.isValid)return Nn.after(n,y)}else if(p){const y=Nr.fromISO(r,i);if(y.isValid)return Nn.before(l,y)}}return Nn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Nn.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(QE).filter(a=>this.contains(a)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const a=i[n]||this.e,l=+a>+this.e?this.e:a;r.push(Nn.fromDateTimes(s,l)),s=l,n+=1}return r}splitBy(t){const i=Nr.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const a=[];for(;r<this.e;){const l=this.start.plus(i.mapUnits(p=>p*s));n=+l>+this.e?this.e:l,a.push(Nn.fromDateTimes(r,n)),r=n,s+=1}return a}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Nn.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Nn.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],a)=>n?n.overlaps(a)||n.abutsStart(a)?[s,n.union(a)]:[s.concat([n]),a]:[s,a],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(p=>[{time:p.s,type:"s"},{time:p.e,type:"e"}]),a=Array.prototype.concat(...n),l=a.sort((p,y)=>p.time-y.time);for(const p of l)r+=p.type==="s"?1:-1,r===1?i=p.time:(i&&+i!=+p.time&&s.push(Nn.fromDateTimes(i,p.time)),i=null);return Nn.merge(s)}difference(...t){return Nn.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:JE}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:JE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:JE}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:JE}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:JE}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):Nr.invalid(this.invalidReason)}mapEndpoints(t){return Nn.fromDateTimes(t(this.s),t(this.e))}}class g5{static hasDST(t=$o.defaultZone){const i=Di.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return Mg.isValidZone(t)}static normalizeZone(t){return Iy(t,$o.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||En.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||En.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||En.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||En.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return En.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return En.create(i,null,"gregory").eras(t)}static features(){return{relative:N1e()}}}function kie(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(Nr.fromMillis(r).as("days"))}function mze(e,t,i){const r=[["years",(l,p)=>p.year-l.year],["quarters",(l,p)=>p.quarter-l.quarter],["months",(l,p)=>p.month-l.month+(p.year-l.year)*12],["weeks",(l,p)=>{const y=kie(l,p);return(y-y%7)/7}],["days",kie]],s={};let n,a;for(const[l,p]of r)if(i.indexOf(l)>=0){n=l;let y=p(e,t);a=e.plus({[l]:y}),a>t?(e=e.plus({[l]:y-1}),y-=1):e=a,s[l]=y}return[e,s,a,n]}function gze(e,t,i,r){let[s,n,a,l]=mze(e,t,i);const p=t-s,y=i.filter(x=>["hours","minutes","seconds","milliseconds"].indexOf(x)>=0);y.length===0&&(a<t&&(a=s.plus({[l]:1})),a!==s&&(n[l]=(n[l]||0)+p/(a-s)));const b=Nr.fromObject(n,r);return y.length>0?Nr.fromMillis(p,r).shiftTo(...y).plus(b):b}const fY={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Uie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},yze=fY.hanidec.replace(/[\[|\]]/g,"").split("");function vze(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(fY.hanidec)!==-1)t+=yze.indexOf(e[i]);else for(const s in Uie){const[n,a]=Uie[s];r>=n&&r<=a&&(t+=r-n)}}return parseInt(t,10)}else return t}function Md({numberingSystem:e},t=""){return new RegExp(`${fY[e||"latn"]}${t}`)}const _ze="missing Intl.DateTimeFormat.formatToParts support";function Jr(e,t=i=>i){return{regex:e,deser:([i])=>t(vze(i))}}const bze=String.fromCharCode(160),eye=`( |${bze})`,tye=new RegExp(eye,"g");function wze(e){return e.replace(/\./g,"\\.?").replace(tye,eye)}function zie(e){return e.replace(/\./g,"").replace(tye," ").toLowerCase()}function Rd(e,t){return e===null?null:{regex:RegExp(e.map(wze).join("|")),deser:([i])=>e.findIndex(r=>zie(i)===zie(r))+t}}function Bie(e,t){return{regex:e,deser:([,i,r])=>_N(i,r),groups:t}}function y7(e){return{regex:e,deser:([t])=>t}}function xze(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Tze(e,t){const i=Md(t),r=Md(t,"{2}"),s=Md(t,"{3}"),n=Md(t,"{4}"),a=Md(t,"{6}"),l=Md(t,"{1,2}"),p=Md(t,"{1,3}"),y=Md(t,"{1,6}"),b=Md(t,"{1,9}"),x=Md(t,"{2,4}"),A=Md(t,"{4,6}"),M=k=>({regex:RegExp(xze(k.val)),deser:([z])=>z,literal:!0}),$=(k=>{if(e.literal)return M(k);switch(k.val){case"G":return Rd(t.eras("short",!1),0);case"GG":return Rd(t.eras("long",!1),0);case"y":return Jr(y);case"yy":return Jr(x,vG);case"yyyy":return Jr(n);case"yyyyy":return Jr(A);case"yyyyyy":return Jr(a);case"M":return Jr(l);case"MM":return Jr(r);case"MMM":return Rd(t.months("short",!0,!1),1);case"MMMM":return Rd(t.months("long",!0,!1),1);case"L":return Jr(l);case"LL":return Jr(r);case"LLL":return Rd(t.months("short",!1,!1),1);case"LLLL":return Rd(t.months("long",!1,!1),1);case"d":return Jr(l);case"dd":return Jr(r);case"o":return Jr(p);case"ooo":return Jr(s);case"HH":return Jr(r);case"H":return Jr(l);case"hh":return Jr(r);case"h":return Jr(l);case"mm":return Jr(r);case"m":return Jr(l);case"q":return Jr(l);case"qq":return Jr(r);case"s":return Jr(l);case"ss":return Jr(r);case"S":return Jr(p);case"SSS":return Jr(s);case"u":return y7(b);case"uu":return y7(l);case"uuu":return Jr(i);case"a":return Rd(t.meridiems(),0);case"kkkk":return Jr(n);case"kk":return Jr(x,vG);case"W":return Jr(l);case"WW":return Jr(r);case"E":case"c":return Jr(i);case"EEE":return Rd(t.weekdays("short",!1,!1),1);case"EEEE":return Rd(t.weekdays("long",!1,!1),1);case"ccc":return Rd(t.weekdays("short",!0,!1),1);case"cccc":return Rd(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Bie(new RegExp(`([+-]${l.source})(?::(${r.source}))?`),2);case"ZZZ":return Bie(new RegExp(`([+-]${l.source})(${r.source})?`),2);case"z":return y7(/[a-z_+-/]{1,256}?/i);default:return M(k)}})(e)||{invalidReason:_ze};return $.token=e,$}const Sze={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function Eze(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let a=Sze[r];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function Aze(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function Cze(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const a in i)if(bS(i,a)){const l=i[a],p=l.groups?l.groups+1:1;!l.literal&&l.token&&(s[l.token.val[0]]=l.deser(r.slice(n,n+p))),n+=p}return[r,s]}else return[r,{}]}function Mze(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Or(e.z)||(i=Mg.create(e.z)),Or(e.Z)||(i||(i=new Zl(e.Z)),r=e.Z),Or(e.q)||(e.M=(e.q-1)*3+1),Or(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Or(e.u)||(e.S=aY(e.u)),[Object.keys(e).reduce((n,a)=>{const l=t(a);return l&&(n[l]=e[a]),n},{}),i,r]}let v7=null;function Rze(){return v7||(v7=Di.fromMillis(1555555555555)),v7}function Oze(e,t){if(e.literal)return e;const i=Wc.macroTokenToFormatOpts(e.val);if(!i)return e;const n=Wc.create(t,i).formatDateTimeParts(Rze()).map(a=>Eze(a,t,i));return n.includes(void 0)?e:n}function Pze(e,t){return Array.prototype.concat(...e.map(i=>Oze(i,t)))}function iye(e,t,i){const r=Pze(Wc.parseFormat(i),e),s=r.map(a=>Tze(a,e)),n=s.find(a=>a.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[a,l]=Aze(s),p=RegExp(a,"i"),[y,b]=Cze(t,p,l),[x,A,M]=b?Mze(b):[null,null,void 0];if(bS(b,"a")&&bS(b,"H"))throw new TC("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:p,rawMatches:y,matches:b,result:x,zone:A,specificOffset:M}}}function Ize(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:a}=iye(e,t,i);return[r,s,n,a]}const rye=[0,31,59,90,120,151,181,212,243,273,304,334],sye=[0,31,60,91,121,152,182,213,244,274,305,335];function od(e,t){return new bp("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function nye(e,t,i){const r=new Date(Date.UTC(e,t-1,i)).getUTCDay();return r===0?7:r}function oye(e,t,i){return i+(HO(e)?sye:rye)[t-1]}function aye(e,t){const i=HO(e)?sye:rye,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function TG(e){const{year:t,month:i,day:r}=e,s=oye(t,i,r),n=nye(t,i,r);let a=Math.floor((s-n+10)/7),l;return a<1?(l=t-1,a=tD(l)):a>tD(t)?(l=t+1,a=1):l=t,ie({weekYear:l,weekNumber:a,weekday:n},bN(e))}function Vie(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=nye(t,1,4),n=AM(t);let a=i*7+r-s-3,l;a<1?(l=t-1,a+=AM(l)):a>n?(l=t+1,a-=AM(t)):l=t;const{month:p,day:y}=aye(l,a);return ie({year:l,month:p,day:y},bN(e))}function _7(e){const{year:t,month:i,day:r}=e,s=oye(t,i,r);return ie({year:t,ordinal:s},bN(e))}function Gie(e){const{year:t,ordinal:i}=e,{month:r,day:s}=aye(t,i);return ie({year:t,month:r,day:s},bN(e))}function $ze(e){const t=vN(e.weekYear),i=rg(e.weekNumber,1,tD(e.weekYear)),r=rg(e.weekday,1,7);return t?i?r?!1:od("weekday",e.weekday):od("week",e.week):od("weekYear",e.weekYear)}function Dze(e){const t=vN(e.year),i=rg(e.ordinal,1,AM(e.year));return t?i?!1:od("ordinal",e.ordinal):od("year",e.year)}function lye(e){const t=vN(e.year),i=rg(e.month,1,12),r=rg(e.day,1,eD(e.year,e.month));return t?i?r?!1:od("day",e.day):od("month",e.month):od("year",e.year)}function cye(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=rg(t,0,23)||t===24&&i===0&&r===0&&s===0,a=rg(i,0,59),l=rg(r,0,59),p=rg(s,0,999);return n?a?l?p?!1:od("millisecond",s):od("second",r):od("minute",i):od("hour",t)}const b7="Invalid DateTime",jie=864e13;function y5(e){return new bp("unsupported zone",`the zone "${e.name}" is not supported`)}function w7(e){return e.weekData===null&&(e.weekData=TG(e.c)),e.weekData}function ZE(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Di(qe(ie(ie({},i),t),{old:i}))}function hye(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Hie(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function _9(e,t,i){return hye(cY(e),t,i)}function qie(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=qe(ie({},e.c),{year:r,month:s,day:Math.min(e.c.day,eD(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),a=Nr.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),l=cY(n);let[p,y]=hye(l,i,e.zone);return a!==0&&(p+=a,y=e.zone.offset(p)),{ts:p,o:y}}function KE(e,t,i,r,s,n){const{setZone:a,zone:l}=i;if(e&&Object.keys(e).length!==0){const p=t||l,y=Di.fromObject(e,qe(ie({},i),{zone:p,specificOffset:n}));return a?y:y.setZone(l)}else return Di.invalid(new bp("unparsable",`the input "${s}" can't be parsed as ${r}`))}function v5(e,t,i=!0){return e.isValid?Wc.create(En.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function x7(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=mo(e.c.year,i?6:4),t?(r+="-",r+=mo(e.c.month),r+="-",r+=mo(e.c.day)):(r+=mo(e.c.month),r+=mo(e.c.day)),r}function Wie(e,t,i,r,s){let n=mo(e.c.hour);return t?(n+=":",n+=mo(e.c.minute),(e.c.second!==0||!i)&&(n+=":")):n+=mo(e.c.minute),(e.c.second!==0||!i)&&(n+=mo(e.c.second),(e.c.millisecond!==0||!r)&&(n+=".",n+=mo(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0?n+="Z":e.o<0?(n+="-",n+=mo(Math.trunc(-e.o/60)),n+=":",n+=mo(Math.trunc(-e.o%60))):(n+="+",n+=mo(Math.trunc(e.o/60)),n+=":",n+=mo(Math.trunc(e.o%60)))),n}const uye={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Lze={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Nze={ordinal:1,hour:0,minute:0,second:0,millisecond:0},dye=["year","month","day","hour","minute","second","millisecond"],Fze=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],kze=["year","ordinal","hour","minute","second","millisecond"];function Xie(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new g1e(e);return t}function Yie(e,t){const i=Iy(t.zone,$o.defaultZone),r=En.fromObject(t),s=$o.now();let n,a;if(Or(e.year))n=s;else{for(const y of dye)Or(e[y])&&(e[y]=uye[y]);const l=lye(e)||cye(e);if(l)return Di.invalid(l);const p=i.offset(s);[n,a]=_9(e,p,i)}return new Di({ts:n,zone:i,loc:r,o:a})}function Jie(e,t,i){const r=Or(i.round)?!0:i.round,s=(a,l)=>(a=lY(a,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(a,l)),n=a=>i.calendary?t.hasSame(e,a)?0:t.startOf(a).diff(e.startOf(a),a).get(a):t.diff(e,a).get(a);if(i.unit)return s(n(i.unit),i.unit);for(const a of i.units){const l=n(a);if(Math.abs(l)>=1)return s(l,a)}return s(e>t?-0:0,i.units[i.units.length-1])}function Zie(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Di{constructor(t){const i=t.zone||$o.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new bp("invalid input"):null)||(i.isValid?null:y5(i));this.ts=Or(t.ts)?$o.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const l=i.offset(this.ts);s=Hie(this.ts,l),r=Number.isNaN(s.year)?new bp("invalid input"):null,s=r?null:s,n=r?null:l}this._zone=i,this.loc=t.loc||En.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Di({})}static local(){const[t,i]=Zie(arguments),[r,s,n,a,l,p,y]=i;return Yie({year:r,month:s,day:n,hour:a,minute:l,second:p,millisecond:y},t)}static utc(){const[t,i]=Zie(arguments),[r,s,n,a,l,p,y]=i;return t.zone=Zl.utcInstance,Yie({year:r,month:s,day:n,hour:a,minute:l,second:p,millisecond:y},t)}static fromJSDate(t,i={}){const r=Hke(t)?t.valueOf():NaN;if(Number.isNaN(r))return Di.invalid("invalid input");const s=Iy(i.zone,$o.defaultZone);return s.isValid?new Di({ts:r,zone:s,loc:En.fromObject(i)}):Di.invalid(y5(s))}static fromMillis(t,i={}){if(R2(t))return t<-jie||t>jie?Di.invalid("Timestamp out of range"):new Di({ts:t,zone:Iy(i.zone,$o.defaultZone),loc:En.fromObject(i)});throw new Yu(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(R2(t))return new Di({ts:t*1e3,zone:Iy(i.zone,$o.defaultZone),loc:En.fromObject(i)});throw new Yu("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=Iy(i.zone,$o.defaultZone);if(!r.isValid)return Di.invalid(y5(r));const s=$o.now(),n=Or(i.specificOffset)?r.offset(s):i.specificOffset,a=iD(t,Xie),l=!Or(a.ordinal),p=!Or(a.year),y=!Or(a.month)||!Or(a.day),b=p||y,x=a.weekYear||a.weekNumber,A=En.fromObject(i);if((b||l)&&x)throw new TC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&l)throw new TC("Can't mix ordinal dates with month/day");const M=x||a.weekday&&!b;let P,$,k=Hie(s,n);M?(P=Fze,$=Lze,k=TG(k)):l?(P=kze,$=Nze,k=_7(k)):(P=dye,$=uye);let z=!1;for(const de of P){const he=a[de];Or(he)?z?a[de]=$[de]:a[de]=k[de]:z=!0}const G=M?$ze(a):l?Dze(a):lye(a),B=G||cye(a);if(B)return Di.invalid(B);const W=M?Vie(a):l?Gie(a):a,[q,X]=_9(W,n,r),oe=new Di({ts:q,zone:r,o:X,loc:A});return a.weekday&&b&&t.weekday!==oe.weekday?Di.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${oe.toISO()}`):oe}static fromISO(t,i={}){const[r,s]=ZUe(t);return KE(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=KUe(t);return KE(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=QUe(t);return KE(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Or(t)||Or(i))throw new Yu("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,a=En.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[l,p,y,b]=Ize(a,t,i);return b?Di.invalid(b):KE(l,p,r,`format ${i}`,t,y)}static fromString(t,i,r={}){return Di.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=aze(t);return KE(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new Yu("need to specify a reason the DateTime is invalid");const r=t instanceof bp?t:new bp(t,i);if($o.throwOnInvalid)throw new Uke(r);return new Di({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?w7(this).weekYear:NaN}get weekNumber(){return this.isValid?w7(this).weekNumber:NaN}get weekday(){return this.isValid?w7(this).weekday:NaN}get ordinal(){return this.isValid?_7(this.c).ordinal:NaN}get monthShort(){return this.isValid?g5.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?g5.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?g5.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?g5.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return HO(this.year)}get daysInMonth(){return eD(this.year,this.month)}get daysInYear(){return this.isValid?AM(this.year):NaN}get weeksInWeekYear(){return this.isValid?tD(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=Wc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Zl.instance(t),i)}toLocal(){return this.setZone($o.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=Iy(t,$o.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),a=this.toObject();[s]=_9(a,n,t)}return ZE(this,{ts:s,zone:t})}else return Di.invalid(y5(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return ZE(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=iD(t,Xie),r=!Or(i.weekYear)||!Or(i.weekNumber)||!Or(i.weekday),s=!Or(i.ordinal),n=!Or(i.year),a=!Or(i.month)||!Or(i.day),l=n||a,p=i.weekYear||i.weekNumber;if((l||s)&&p)throw new TC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&s)throw new TC("Can't mix ordinal dates with month/day");let y;r?y=Vie(ie(ie({},TG(this.c)),i)):Or(i.ordinal)?(y=ie(ie({},this.toObject()),i),Or(i.day)&&(y.day=Math.min(eD(y.year,y.month),y.day))):y=Gie(ie(ie({},_7(this.c)),i));const[b,x]=_9(y,this.o,this.zone);return ZE(this,{ts:b,o:x})}plus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t);return ZE(this,qie(this,i))}minus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t).negate();return ZE(this,qie(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=Nr.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?Wc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):b7}toLocaleString(t=yG,i={}){return this.isValid?Wc.create(this.loc.clone(i),t).formatDateTime(this):b7}toLocaleParts(t={}){return this.isValid?Wc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0}={}){if(!this.isValid)return null;const n=t==="extended";let a=x7(this,n);return a+="T",a+=Wie(this,n,i,r,s),a}toISODate({format:t="extended"}={}){return this.isValid?x7(this,t==="extended"):null}toISOWeekDate(){return v5(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,format:n="extended"}={}){return this.isValid?(s?"T":"")+Wie(this,n==="extended",i,t,r):null}toRFC2822(){return v5(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return v5(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?x7(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),v5(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():b7}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=ie({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return Nr.invalid("created by diffing an invalid DateTime");const s=ie({locale:this.locale,numberingSystem:this.numberingSystem},r),n=qke(i).map(Nr.normalizeUnit),a=t.valueOf()>this.valueOf(),l=a?this:t,p=a?t:this,y=gze(l,p,n,s);return a?y.negate():y}diffNow(t="milliseconds",i={}){return this.diff(Di.now(),t,i)}until(t){return this.isValid?Nn.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Di.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Jie(i,this.plus(r),qe(ie({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?Jie(t.base||Di.fromObject({},{zone:this.zone}),this,qe(ie({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(Di.isDateTime))throw new Yu("min requires all arguments be DateTimes");return Mie(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Di.isDateTime))throw new Yu("max requires all arguments be DateTimes");return Mie(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,a=En.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return iye(a,t,i)}static fromStringExplain(t,i,r={}){return Di.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return yG}static get DATE_MED(){return y1e}static get DATE_MED_WITH_WEEKDAY(){return Vke}static get DATE_FULL(){return v1e}static get DATE_HUGE(){return _1e}static get TIME_SIMPLE(){return b1e}static get TIME_WITH_SECONDS(){return w1e}static get TIME_WITH_SHORT_OFFSET(){return x1e}static get TIME_WITH_LONG_OFFSET(){return T1e}static get TIME_24_SIMPLE(){return S1e}static get TIME_24_WITH_SECONDS(){return E1e}static get TIME_24_WITH_SHORT_OFFSET(){return A1e}static get TIME_24_WITH_LONG_OFFSET(){return C1e}static get DATETIME_SHORT(){return M1e}static get DATETIME_SHORT_WITH_SECONDS(){return R1e}static get DATETIME_MED(){return O1e}static get DATETIME_MED_WITH_SECONDS(){return P1e}static get DATETIME_MED_WITH_WEEKDAY(){return Gke}static get DATETIME_FULL(){return I1e}static get DATETIME_FULL_WITH_SECONDS(){return $1e}static get DATETIME_HUGE(){return D1e}static get DATETIME_HUGE_WITH_SECONDS(){return L1e}}function QE(e){if(Di.isDateTime(e))return e;if(e&&e.valueOf&&R2(e.valueOf()))return Di.fromJSDate(e);if(e&&typeof e=="object")return Di.fromObject(e);throw new Yu(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const T7={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function pye(e){e||(e=Wh());let t=e in T7;if(!t){const n=e.split("-");n.length>1&&n[0]in T7&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=T7[e];return{decimal:i,group:r,pattern:s}}function Uze(e,t){const i=pye((t=ie({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:zze(e,r,t)}const fye=/[#0,]*[#0](?:\.0*#*)?/;function zze(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),a=n[0];if((t=n[e<0?1:0]||"-"+a).indexOf("%")!==-1)e*=100;else if(t.indexOf("\u2030")!==-1)e*=1e3;else{if(t.indexOf("\xA4")!==-1)throw new Error("currency notation not supported");if(t.indexOf("E")!==-1)throw new Error("exponential notation not supported")}const l=fye,p=a.match(l);if(!p)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(l,Bze(e,p[0],{decimal:s,group:r,places:i.places,round:i.round}))}function Bze(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const a=String(Math.abs(e)).split("."),l=a[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const P=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;P>l.length&&(a[1]=l.padEnd(Number(P),"0")),n<l.length&&(a[1]=l.substr(0,Number(n)))}else a[1]&&a.pop();const p=r[0].replace(",","");let y=p.indexOf("0");y!==-1&&(y=p.length-y,y>a[0].length&&(a[0]=a[0].padStart(y,"0")),p.indexOf("#")===-1&&(a[0]=a[0].substr(a[0].length-y)));let b,x,A=r[0].lastIndexOf(",");if(A!==-1){b=r[0].length-A-1;const P=r[0].substr(0,A);A=P.lastIndexOf(","),A!==-1&&(x=P.length-A-1)}const M=[];for(let P=a[0];P;){const $=P.length-b;M.push($>0?P.substr($):P),P=$>0?P.slice(0,$):"",x&&(b=x,x=void 0)}return a[0]=M.reverse().join(i.group||","),a.join(i.decimal||".")}function Vze(e){const t=pye((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.indexOf("%")!==-1)n/=100;else if(i.indexOf("\u2030")!==-1)n/=1e3;else if(i.indexOf("\xA4")!==-1)throw new Error("currency notation not supported");const a=i.split(";");return a.length===1&&a.push("-"+a[0]),{regexp:wR(a,function(p){return(p="(?:"+Dq(p,".")+")").replace(fye,function(y){const b={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},x=y.split(".");let A=e.places;x.length===1&&n!==1&&(x[1]="###"),x.length===1||A===0?b.fractional=!1:(A===void 0&&(A=e.pattern?x[1].lastIndexOf("0")+1:1/0),A&&e.fractional==null&&(b.fractional=!0),!e.places&&A<x[1].length&&(A+=","+x[1].length),b.places=A);const M=x[0].split(",");return M.length>1&&(b.groupSize=M.pop().length,M.length>1&&(b.groupSize2=M.pop().length)),"("+jze(b)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function Gze(e,t){const i=Vze(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function jze(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=Kie(e),i=wR(e.fractional,function(s){let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+wR(e.exponent,function(s){return s?"([eE]"+Kie({signed:e.eSigned})+")":""})}function Kie(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",wR(e.signed,function(t){return t?"[-+]":""},!0)+wR(e.separator,function(t){if(!t)return"(?:\\d+)";(t=Dq(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const wR=function(e,t,i){if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return Hze(r.join("|"),i)},Hze=function(e,t){return"("+(t?"?:":"")+e+")"};var Qie,ere;function _Tt(e){return VO.fromJSON(e.toJSON())}function qze(e){return e.toJSON?e.toJSON():e}function bTt(e){return typeof e=="string"||e instanceof String}function wTt(e){return typeof e=="number"}function tre(e){return e instanceof Date}function xTt(e,t){return e===t||!(!tre(e)||!tre(t))&&e.getTime()===t.getTime()}function TTt(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function STt(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new ki({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function ETt(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Qie||(Qie={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(ere||(ere={}));const ATt=1e3,CTt={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},ire={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},MTt={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function RTt(e,t){return Nq((i,r)=>{const s=G3(!0);e.reduce((n,a,l,p)=>n.then(y=>{try{return t(y,a,l,p)}catch(b){return _Q(b)}},y=>_Q(y)),s).then(i,r)})}function OTt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function PTt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(a){return function(l,p){const y={key:l,value:a[l]},b={key:p,value:a[p]};return s(y,b)}});var s;const n=[];return function a(l){if(l&&l.toJSON&&typeof l.toJSON=="function"&&(l=l.toJSON()),l===void 0)return;if(typeof l=="number")return isFinite(l)?""+l:"null";if(typeof l!="object")return JSON.stringify(l);let p,y;if(Array.isArray(l)){for(y="[",p=0;p<l.length;p++)p&&(y+=","),y+=a(l[p])||"null";return y+"]"}if(l===null)return"null";if(n.indexOf(l)!==-1){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const b=n.push(l)-1,x=Object.keys(l).sort(r&&r(l));for(y="",p=0;p<x.length;p++){const A=x[p],M=a(l[A]);M&&(y&&(y+=","),y+=JSON.stringify(A)+":"+M)}return n.splice(b,1),"{"+y+"}"}(e)}class mye{constructor(t){this.value=t}}class gye{constructor(t){this.value=t}}class mY{constructor(t){this.fn=t}}class gY{constructor(t,i){this.paramCount=i,this.fn=t}}const Wze=mY,Xze=gye,Yze=mye,Jze=gY,Fh={type:"VOID"},Zze={type:"BREAK"},Kze={type:"CONTINUE"};function xR(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function yY(e){return e instanceof mY||e instanceof kke||e instanceof gY}function sD(e){return!!Ra(e)||!!Vl(e)||!!ul(e)||!!Bl(e)||e===null||e===Fh||typeof e=="number"}function Qze(e,t){return e===void 0?t:e}function Ra(e){return typeof e=="string"||e instanceof String}function Bl(e){return typeof e=="boolean"}function Vl(e){return typeof e=="number"}function eBe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function fd(e){return e instanceof Array}function tBe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function iBe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function rBe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function K2(e){return e instanceof O0}function ul(e){return e instanceof Date}function sBe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function nBe(e){return e<0?-Math.round(-e):Math.round(e)}function oBe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function vY(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=xR(t,"\u2030",""),t=xR(t,"\xA4",""),Uze(e,{pattern:t})):e.toString()}function wN(e,t){const i=Di.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(yye(t),{locale:Wh(),numberingSystem:"latn"})}function yye(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function ss(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function aBe(e,t,i){if(e===null){if(t===null||t===Fh)return ss(null,null,i);if(Vl(t))return ss(0,t,i);if(Ra(t)||Bl(t))return ss(0,xn(t),i);if(ul(t))return ss(0,t.getTime(),i)}if(e===Fh){if(t===null||t===Fh)return ss(null,null,i);if(Vl(t))return ss(0,t,i);if(Ra(t)||Bl(t))return ss(0,xn(t),i);if(ul(t))return ss(0,t.getTime(),i)}else if(Vl(e)){if(Vl(t))return ss(e,t,i);if(Bl(t))return ss(e,xn(t),i);if(t===null||t===Fh)return ss(e,0,i);if(Ra(t))return ss(e,xn(t),i);if(ul(t))return ss(e,t.getTime(),i)}else if(Ra(e)){if(Ra(t))return ss(cv(e),cv(t),i);if(ul(t))return ss(xn(e),t.getTime(),i);if(Vl(t))return ss(xn(e),t,i);if(t===null||t===Fh)return ss(xn(e),0,i);if(Bl(t))return ss(xn(e),xn(t),i)}else if(ul(e)){if(ul(t))return ss(e,t,i);if(t===null||t===Fh)return ss(e.getTime(),0,i);if(Vl(t))return ss(e.getTime(),t,i);if(Bl(t)||Ra(t))return ss(e.getTime(),xn(t),i)}else if(Bl(e)){if(Bl(t))return ss(e,t,i);if(Vl(t))return ss(xn(e),xn(t),i);if(ul(t))return ss(xn(e),t.getTime(),i);if(t===null||t===Fh)return ss(xn(e),0,i);if(Ra(t))return ss(xn(e),xn(t),i)}return!!vye(e,t)&&(i==="<="||i===">=")}function vye(e,t){if(e===t||e===null&&t===Fh||t===null&&e===Fh)return!0;if(ul(e)&&ul(t))return e.getTime()===t.getTime();if(e instanceof oY||e instanceof $w)return e.equalityTest(t);if(e instanceof Gt&&t instanceof Gt){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function cv(e,t){if(Ra(e))return e;if(e===null)return"";if(Vl(e))return vY(e,t);if(Bl(e))return e.toString();if(ul(e))return wN(e,t);if(e instanceof rh)return JSON.stringify(e.toJSON());if(fd(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=nD(e[r]);return"["+i.join(",")+"]"}if(e instanceof O0){const i=[];for(let r=0;r<e.length();r++)i[r]=nD(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():yY(e)?"object, Function":""}function lBe(e){const t=[];if(fd(e)===!1)return null;if(e instanceof O0){for(let i=0;i<e.length();i++)t[i]=xn(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=xn(e[i]);return t}function b9(e,t){if(Ra(e))return e;if(e===null)return"";if(Vl(e))return vY(e,t);if(Bl(e))return e.toString();if(ul(e))return wN(e,t);if(e instanceof rh)return e instanceof ki?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+SG(e.spatialReference)+"}":SG(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(fd(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=nD(e[r]);return"["+i.join(",")+"]"}if(e instanceof O0){const i=[];for(let r=0;r<e.length();r++)i[r]=nD(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():yY(e)?"object, Function":""}function nD(e){if(e===null)return"null";if(Bl(e)||Vl(e)||Ra(e))return JSON.stringify(e);if(e instanceof rh||e instanceof O0||e instanceof Array)return b9(e);if(e instanceof Date)return JSON.stringify(wN(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Fh)return"null";return"null"}function xn(e,t){return Vl(e)?e:e===null||e===""?0:ul(e)?NaN:Bl(e)?e?1:0:fd(e)||e===""||e===void 0?NaN:t!==void 0&&Ra(e)?(t=xR(t,"\u2030",""),t=xR(t,"\xA4",""),Gze(e,{pattern:t})):e===Fh?0:Number(e)}function cBe(e){if(ul(e))return e;if(Ra(e)){const t=_ye(e);if(t)return t.toJSDate()}return null}function hBe(e){return ul(e)?Di.fromJSDate(e):Ra(e)?_ye(e):null}function _ye(e){const t=/ (\d\d)/;let i=Di.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=Di.fromISO(e),i.isValid)?i:null}function uBe(e){return Bl(e)?e:Ra(e)?(e=e.toLowerCase())==="true":!!Vl(e)&&e!==0&&!isNaN(e)}function dBe(e,t){return J(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function pBe(e){if(e===null)return null;if(e instanceof Gt)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Fa){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Hc){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof Bv?e.points.length===0?null:e:e instanceof ki?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function bye(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=cv(t);else{if(t==null)return null;if(t==="")return t;t=xn(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function wye(e,t){if(!e||!e.domain)return t;let i=null;t=cv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function xN(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,a=null;for(let l=0;l<t.fields.length;l++){const p=t.fields[l];p.name.toLowerCase()===e.toString().toLowerCase()&&(a=p)}if(a===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(l){return l.id===r&&(s=l.domains&&l.domains[a.name],s&&s.type==="inherited"&&(s=rre(a.name,t),n=!0),!0)}),n||s||(s=rre(e,t)),{field:a,domain:s}}function rre(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function SG(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(a){return function(l,p){const y={key:l,value:a[l]},b={key:p,value:a[p]};return s(y,b)}});var s;const n=[];return function a(l){if(l&&l.toJSON&&typeof l.toJSON=="function"&&(l=l.toJSON()),l===void 0)return;if(typeof l=="number")return isFinite(l)?""+l:"null";if(typeof l!="object")return JSON.stringify(l);let p,y;if(Array.isArray(l)){for(y="[",p=0;p<l.length;p++)p&&(y+=","),y+=a(l[p])||"null";return y+"]"}if(l===null)return"null";if(n.indexOf(l)!==-1){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const b=n.push(l)-1,x=Object.keys(l).sort(r&&r(l));for(y="",p=0;p<x.length;p++){const A=x[p],M=a(l[A]);M&&(y&&(y+=","),y+=JSON.stringify(A)+":"+M)}return n.splice(b,1),"{"+y+"}"}(e)}function fBe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function wS(e,t){if(!(t instanceof Gt))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function mBe(e,t){if(fd(e)||K2(e)){let i=!1,r=!1,s=[],n=t;if(fd(e)){for(const a of e)wS(s,a);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof $w)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!K2(e))throw new Error("Invalid Argument");for(const a of e.toArray())wS(s,a);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(kW(s,r,i)===!1&&(s=s.slice(0).reverse()),new Fa({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function gBe(e,t){if(fd(e)||K2(e)){let i=!1,r=!1,s=[],n=t;if(fd(e)){for(const a of e)wS(s,a);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof $w)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(K2(e)){for(const a of e.toArray())wS(s,a);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Hc({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function yBe(e,t){if(fd(e)||K2(e)){let i=!1,r=!1,s=[],n=t;if(fd(e)){for(const a of e)wS(s,a);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof $w)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(K2(e)){for(const a of e.toArray())wS(s,a);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Bv({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function vBe(e,t=!1){const i=[];if(e===null)return i;if(fd(e)===!0){for(let r=0;r<e.length;r++){const s=cv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof O0){for(let r=0;r<e.length();r++){const s=cv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(sD(e)){const r=cv(e);return r===""&&t!==!0||i.push(r),i}return[]}let S7=0;function _Be(e){return S7++,S7%100==0?(S7=0,Nq(t=>{setTimeout(()=>{t(e)},0)})):e}function bBe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function TR(e,t=null){return e==null?null:Bl(e)||Vl(e)||Ra(e)?e:e instanceof rh?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof O0?e.toArray().map(i=>TR(i,t)):e instanceof Array?e.map(i=>TR(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}function wBe(e,t,i,r,s){return _Y(e,t,i).then(n=>{s[r]=n})}function _Y(e,t=null,i=null){if(e instanceof O0&&(e=e.toArray()),e==null)return G3(null);if(sD(e)||e instanceof rh||e instanceof Date)return G3(TR(e,i));if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||sD(n)||n instanceof rh||n instanceof Date?s.push(TR(n,i)):(s.push(null),r.push(wBe(n,t,i,s.length-1,s)));return r.length>0?eR(r).then(()=>s):G3(s)}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):G3(null)}function xBe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:xN(t,r,e,i)}function TBe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function SBe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=xN(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return bye(n,i)}function EBe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return wye(xN(t,s,e,r),i)}function ABe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(qze(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:ire[t.geometryType]===void 0?"":ire[t.geometryType],fields:i}}const ITt=Object.freeze({__proto__:null,ReturnResultE:mye,ImplicitResultE:gye,NativeFunctionE:mY,SizzleFunctionE:gY,NativeFunction:Wze,ImplicitResult:Xze,ReturnResult:Yze,SizzleFunction:Jze,voidOperation:Fh,breakResult:Zze,continueResult:Kze,multiReplace:xR,isFunctionParameter:yY,isSimpleType:sD,defaultUndefined:Qze,isString:Ra,isBoolean:Bl,isNumber:Vl,isInteger:eBe,isArray:fd,isFeature:tBe,isFeatureSet:iBe,isFeatureSetCollection:rBe,isImmutableArray:K2,isDate:ul,pcCheck:sBe,absRound:nBe,generateUUID:oBe,formatNumber:vY,formatDate:wN,standardiseDateFormat:yye,greaterThanLessThan:aBe,equalityTest:vye,toString:cv,toNumberArray:lBe,toStringExplicit:b9,toNumber:xn,toDate:cBe,toDateTime:hBe,toBoolean:uBe,fixSpatialReference:dBe,fixNullGeometry:pBe,getDomainValue:bye,getDomainCode:wye,getDomain:xN,stableStringify:SG,autoCastFeatureToGeometry:fBe,autoCastArrayOfPointsToPolygon:mBe,autoCastArrayOfPointsToPolyline:gBe,autoCastArrayOfPointsToMultiPoint:yBe,toStringArray:vBe,tick:_Be,binaryOperator:bBe,castAsJson:TR,castAsJsonAsync:_Y,featureFullDomain:xBe,featureSubtypes:TBe,featureDomainValueLookup:SBe,featureDomainCodeLookup:EBe,featureSchema:ABe});var EG;let EC=EG=class extends Ye{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new EG({minValue:this.minValue,maxValue:this.maxValue})}};_([S({type:Number,json:{write:!0}})],EC.prototype,"minValue",void 0),_([S({type:Number,json:{write:!0}})],EC.prototype,"maxValue",void 0),EC=EG=_([re("esri.renderer.support.AuthoringInfoClassBreakInfo")],EC);const CBe=EC;var AG;let rb=AG=class extends Ye{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new AG({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Fe(this.classBreakInfos)})}};_([S({type:String,json:{write:!0}})],rb.prototype,"field",void 0),_([S({type:String,json:{write:!0}})],rb.prototype,"normalizationField",void 0),_([S({type:String,json:{write:!0}})],rb.prototype,"label",void 0),_([S({type:[CBe],json:{write:!0}})],rb.prototype,"classBreakInfos",void 0),rb=AG=_([re("esri.renderers.support.AuthoringInfoFieldInfo")],rb);const sre=rb;var CG;const _5=new Ui({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),b5=new Ui({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),nre={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},ore=["high-to-low","above-and-below","centered-on","extremes"],are=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],lre=["seconds","minutes","hours","days","months","years"];let Sc=CG=class extends Ye{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new CG({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};_([S({types:nre,json:{write:!0}})],Sc.prototype,"endTime",void 0),_([_i("endTime")],Sc.prototype,"castEndTime",null),_([S({type:String,json:{write:!0}})],Sc.prototype,"field",void 0),_([S({type:Number,json:{write:!0}})],Sc.prototype,"maxSliderValue",void 0),_([S({type:Number,json:{write:!0}})],Sc.prototype,"minSliderValue",void 0),_([S({types:nre,json:{write:!0}})],Sc.prototype,"startTime",void 0),_([_i("startTime")],Sc.prototype,"castStartTime",null),_([S({type:_5.apiValues,value:null,json:{type:_5.jsonValues,read:_5.read,write:_5.write}})],Sc.prototype,"style",null),_([S({type:are,value:null,json:{type:are,origins:{"web-scene":{type:ore,write:{writer:(e,t)=>{ore.indexOf(e)>-1&&(t.theme=e)}}}},write:!0}})],Sc.prototype,"theme",null),_([S({type:b5.apiValues,json:{type:b5.jsonValues,read:b5.read,write:b5.write}})],Sc.prototype,"type",void 0),_([S({type:lre,json:{type:lre,write:!0}})],Sc.prototype,"units",void 0),Sc=CG=_([re("esri.renderers.support.AuthoringInfoVisualVariable")],Sc);const MBe=Sc;let w9=class extends Ye{constructor(e){super(e),this.type=null}};_([S({readOnly:!0,json:{read:!1,write:!0}})],w9.prototype,"type",void 0),w9=_([re("esri.rest.support.ColorRamp")],w9);const bY=w9;var MG;let sb=MG=class extends bY{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new MG({fromColor:Fe(this.fromColor),toColor:Fe(this.toColor),algorithm:this.algorithm})}};_([ti({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],sb.prototype,"algorithm",void 0),_([S({type:Ft,json:{type:[us],write:!0}})],sb.prototype,"fromColor",void 0),_([S({type:Ft,json:{type:[us],write:!0}})],sb.prototype,"toColor",void 0),_([S({type:["algorithmic"]})],sb.prototype,"type",void 0),sb=MG=_([re("esri.rest.support.AlgorithmicColorRamp")],sb);const wY=sb;var RG;let AC=RG=class extends bY{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new RG({colorRamps:Fe(this.colorRamps)})}};_([S({type:[wY],json:{write:!0}})],AC.prototype,"colorRamps",void 0),_([S({type:["multipart"]})],AC.prototype,"type",void 0),AC=RG=_([re("esri.rest.support.MultipartColorRamp")],AC);const xye=AC,Tye={key:"type",base:bY,typeMap:{algorithmic:wY,multipart:xye}};function Sye(e){return e&&e.type?e.type==="algorithmic"?wY.fromJSON(e):e.type==="multipart"?xye.fromJSON(e):null:null}var OG;const s_=new Ui({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),w5=new Ui({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),cre=new Ui({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),hre=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],RBe=["high-to-low","above-and-below","above","below","90-10"],OBe=["flow-line","wave-front"],PBe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let to=OG=class extends Ye{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return Sye(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new OG({classificationMethod:this.classificationMethod,colorRamp:Fe(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:Fe(this.field1),field2:Fe(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};_([S({type:s_.apiValues,value:null,json:{type:s_.jsonValues,read:s_.read,write:s_.write,origins:{"web-document":{default:"manual",type:s_.jsonValues,read:s_.read,write:s_.write}}}})],to.prototype,"classificationMethod",null),_([S({types:Tye,json:{write:!0}})],to.prototype,"colorRamp",void 0),_([wt("colorRamp")],to.prototype,"readColorRamp",null),_([S({type:[String],value:null,json:{write:!0}})],to.prototype,"fields",null),_([S({type:sre,value:null,json:{write:!0}})],to.prototype,"field1",null),_([S({type:sre,value:null,json:{write:!0}})],to.prototype,"field2",null),_([S({type:OBe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"flowTheme",null),_([S({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],to.prototype,"focus",null),_([S({type:Number,value:null,json:{type:us,write:!0}})],to.prototype,"numClasses",null),_([S({type:hre,json:{type:hre,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],to.prototype,"lengthUnit",void 0),_([S({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"maxSliderValue",void 0),_([S({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"minSliderValue",void 0),_([S({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"statistics",null),_([S({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],to.prototype,"standardDeviationInterval",null),_([S({type:w5.apiValues,value:null,json:{type:w5.jsonValues,read:w5.read,write:w5.write,origins:{"web-scene":{type:cre.jsonValues,write:{writer:cre.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],to.prototype,"type",null),_([S({type:[MBe],json:{write:!0}})],to.prototype,"visualVariables",void 0),_([S({type:PBe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"univariateSymbolStyle",null),_([S({type:RBe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"univariateTheme",null),to=OG=_([re("esri.renderers.support.AuthoringInfo")],to);const IBe=to,E7=new Ui({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary"},{ignoreUnknown:!0});let CC=class extends Ye{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};_([S({type:IBe,json:{write:!0}})],CC.prototype,"authoringInfo",void 0),_([S({type:E7.apiValues,readOnly:!0,json:{type:E7.jsonValues,read:!1,write:{writer:E7.write,ignoreOrigin:!0}}})],CC.prototype,"type",void 0),CC=_([re("esri.renderers.Renderer")],CC);const Wv=CC;var PG;let x9=PG=class extends Ye{constructor(){super(...arguments),this.title=null}clone(){return new PG({title:this.title})}};_([S({type:String,json:{write:!0}})],x9.prototype,"title",void 0),x9=PG=_([re("esri.renderers.support.LegendOptions")],x9);const xY=x9;var IG;let T9=IG=class extends xY{constructor(){super(...arguments),this.showLegend=null}clone(){return new IG({title:this.title,showLegend:this.showLegend})}};_([S({type:Boolean,json:{write:!0}})],T9.prototype,"showLegend",void 0),T9=IG=_([re("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],T9);const Eye=T9,$Be=Ge.getLogger("esri.renderers.visualVariables.VisualVariable"),A7=new Ui({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let qd=class extends Ye{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?($Be.error(".field: field must be a string value"),null):PO(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};_([S()],qd.prototype,"index",void 0),_([S({type:A7.apiValues,readOnly:!0,json:{read:A7.read,write:A7.write}})],qd.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],qd.prototype,"field",void 0),_([_i("field")],qd.prototype,"castField",null),_([S({type:String,json:{write:!0}})],qd.prototype,"valueExpression",void 0),_([S({type:String,json:{write:!0}})],qd.prototype,"valueExpressionTitle",void 0),_([S({readOnly:!0})],qd.prototype,"arcadeRequired",null),_([S({type:Eye,json:{write:!0}})],qd.prototype,"legendOptions",void 0),qd=_([re("esri.renderers.visualVariables.VisualVariable")],qd);const WO=qd;var $G;let nb=$G=class extends Ye{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new $G({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};_([S({type:Ft,json:{type:[us],write:!0}})],nb.prototype,"color",void 0),_([S({type:String,json:{write:!0}})],nb.prototype,"label",void 0),_([S({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],nb.prototype,"value",void 0),_([Et("value")],nb.prototype,"writeValue",null),nb=$G=_([re("esri.renderers.visualVariables.support.ColorStop")],nb);const DBe=nb;var DG;let ob=DG=class extends WO{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new DG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};_([S({readOnly:!0})],ob.prototype,"cache",null),_([S({type:["color"],json:{type:["colorInfo"]}})],ob.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],ob.prototype,"normalizationField",void 0),_([S({type:[DBe],json:{write:!0}})],ob.prototype,"stops",null),ob=DG=_([re("esri.renderers.visualVariables.ColorVariable")],ob);const Aye=ob;var LG;let J1=LG=class extends Ye{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return lS(t.transparency)}writeOpacity(e,t,i){t[i]=UL(e)}clone(){return new LG({label:this.label,opacity:this.opacity,value:this.value})}};_([S({type:String,json:{write:!0}})],J1.prototype,"label",void 0),_([S({type:Number,json:{type:us,write:{target:"transparency"}}})],J1.prototype,"opacity",void 0),_([wt("opacity",["transparency"])],J1.prototype,"readOpacity",null),_([Et("opacity")],J1.prototype,"writeOpacity",null),_([S({type:Number,json:{write:!0}})],J1.prototype,"value",void 0),J1=LG=_([re("esri.renderers.visualVariables.support.OpacityStop")],J1);const LBe=J1;var NG;let ab=NG=class extends WO{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new NG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};_([S({readOnly:!0})],ab.prototype,"cache",null),_([S({type:["opacity"],json:{type:["transparencyInfo"]}})],ab.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],ab.prototype,"normalizationField",void 0),_([S({type:[LBe],json:{write:!0}})],ab.prototype,"stops",null),ab=NG=_([re("esri.renderers.visualVariables.OpacityVariable")],ab);const Cye=ab;var FG;let ym=FG=class extends WO{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new Se("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new FG({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};_([S({readOnly:!0})],ym.prototype,"cache",null),_([S({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],ym.prototype,"axis",void 0),_([S({type:["rotation"],json:{type:["rotationInfo"]}})],ym.prototype,"type",void 0),_([S({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],ym.prototype,"rotationType",void 0),_([S({type:String,json:{write:!0}})],ym.prototype,"valueExpressionTitle",void 0),_([Et("web-scene","valueExpressionTitle")],ym.prototype,"writeValueExpressionTitleWebScene",null),ym=FG=_([re("esri.renderers.visualVariables.RotationVariable")],ym);const Mye=ym;var kG;let n3=kG=class extends Ye{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new kG({label:this.label,size:this.size,value:this.value})}};_([S({type:String,json:{write:!0}})],n3.prototype,"label",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],n3.prototype,"size",void 0),_([S({type:Number,json:{write:!0}})],n3.prototype,"value",void 0),n3=kG=_([re("esri.renderers.visualVariables.support.SizeStop")],n3);const NBe=n3;var UG;let S9=UG=class extends Eye{constructor(){super(...arguments),this.customValues=null}clone(){return new UG({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};_([S({type:[Number],json:{write:!0}})],S9.prototype,"customValues",void 0),S9=UG=_([re("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],S9);const FBe=S9;var hg,Lo;function J3(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function SR(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Rye(e){return e.valueExpression?hg.Expression:e.field&&typeof e.field=="string"?hg.Field:hg.Unknown}function kBe(e,t){const i=t||Rye(e),r=e.valueUnit||"unknown";return i===hg.Unknown?Lo.Constant:e.stops?Lo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Lo.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Lo.Proportional:Lo.Additive:Lo.Identity:Lo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(hg||(hg={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Lo||(Lo={}));const xS={inches:dn(1,"meters","inches"),feet:dn(1,"meters","feet"),"us-feet":dn(1,"meters","us-feet"),yards:dn(1,"meters","yards"),miles:dn(1,"meters","miles"),"nautical-miles":dn(1,"meters","nautical-miles"),millimeters:dn(1,"meters","millimeters"),centimeters:dn(1,"meters","centimeters"),decimeters:dn(1,"meters","decimeters"),meters:dn(1,"meters","meters"),kilometers:dn(1,"meters","kilometers"),"decimal-degrees":1/X0e(1,"meters",ar.radius)},Av=Ge.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),ure=new gl,E9=Math.PI,Oye=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Pye(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(P=>P.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Av.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,a=n&&n.attributes;let l=s?t:null;const p=r.field,{ipData:y,hasExpression:b}=r.cache;let x=r.cache.compiledFunc;if(!p&&!b){const P=r.stops;return P&&P[0]&&P[0].color}if(typeof l!="number")if(b){if(!L(i)||!L(i.arcade))return void Av.error("Use of arcade expressions requires an arcade context");const P={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},$=i.arcade.arcadeUtils,k=$.getViewInfo(P),z=$.createExecContext(n,k);if(!x){const G=$.createSyntaxTree(r.valueExpression);x=$.createFunction(G),r.cache.compiledFunc=x}l=$.executeFunction(x,z)}else a&&(l=a[p]);const A=r.normalizationField,M=a?parseFloat(a[A]):void 0;if(l!=null&&(!A||s||!isNaN(M)&&M!==0)){isNaN(M)||s||(l/=M);const P=SY(l,y);if(P){const $=P[0],k=P[1],z=$===k?r.stops[$].color:Ft.blendColors(r.stops[$].color,r.stops[k].color,P[2],L(i)?i.color:void 0);return new Ft(z)}}}function Iye(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(P=>P.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Av.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,a=n&&n.attributes;let l=s?t:null;const p=r.field,{ipData:y,hasExpression:b}=r.cache;let x=r.cache.compiledFunc;if(!p&&!b){const P=r.stops;return P&&P[0]&&P[0].opacity}if(typeof l!="number")if(b){if(J(i)||J(i.arcade))return void Av.error("Use of arcade expressions requires an arcade context");const P={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},$=i.arcade.arcadeUtils,k=$.getViewInfo(P),z=$.createExecContext(n,k);if(!x){const G=$.createSyntaxTree(r.valueExpression);x=$.createFunction(G),r.cache.compiledFunc=x}l=$.executeFunction(x,z)}else a&&(l=a[p]);const A=r.normalizationField,M=a?parseFloat(a[A]):void 0;if(l!=null&&(!A||s||!isNaN(M)&&M!==0)){isNaN(M)||s||(l/=M);const P=SY(l,y);if(P){const $=P[0],k=P[1];if($===k)return r.stops[$].opacity;{const z=r.stops[$].opacity;return z+(r.stops[k].opacity-z)*P[2]}}}}function $ye(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(M=>M.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Av.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,a=s==="heading"&&r.rotationType==="arithmetic"?-1:1,l=typeof t=="number"?null:t,p=l&&l.attributes,y=r.field,{hasExpression:b}=r.cache;let x=r.cache.compiledFunc,A=0;if(!y&&!b)return A;if(b){if(J(i)||J(i.arcade))return void Av.error("Use of arcade expressions requires an arcade context");const M={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},P=i.arcade.arcadeUtils,$=P.getViewInfo(M),k=P.createExecContext(l,$);if(!x){const z=P.createSyntaxTree(r.valueExpression);x=P.createFunction(z),r.cache.compiledFunc=x}A=P.executeFunction(x,k)}else p&&(A=p[y]||0);return A=typeof A!="number"||isNaN(A)?null:n+a*A,A}function UBe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let a=r?t:null;const{isScaleDriven:l}=e.cache;let p=e.cache.compiledFunc;if(l){const b=L(i)?i.scale:void 0,x=L(i)?i.view:void 0;a=b==null||x==="3d"?zBe(e):b}else if(!r)switch(e.inputValueType){case hg.Expression:{if(J(i)||J(i.arcade))return void Av.error("Use of arcade expressions requires an arcade context");const b={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},x=i.arcade.arcadeUtils,A=x.getViewInfo(b),M=x.createExecContext(s,A);if(!p){const P=x.createSyntaxTree(e.valueExpression);p=x.createFunction(P),e.cache.compiledFunc=p}a=x.executeFunction(p,M);break}case hg.Field:n&&(a=n[e.field]);break;case hg.Unknown:a=null}if(!SR(a))return null;if(r||!e.normalizationField)return a;const y=n?parseFloat(n[e.normalizationField]):null;return SR(y)&&y!==0?a/y:null}function zBe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function TN(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Av.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Lye(UBe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Kc(e,t,i){return e==null?null:J3(e)?TN(e,t,i):SR(e)?e:null}function Dye(e,t,i){return SR(i)&&e>i?i:SR(t)&&e<t?t:e}function BBe(e,t,i,r){return e+(Kc(t.minSize,i,r)||t.minDataValue)}function VBe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Kc(s,t,i)}function GBe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Kc(t.minSize,i,r),a=Kc(t.maxSize,i,r),l=L(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return a;if(t.scaleBy==="area"&&l){const p=l==="circle",y=p?E9*(n/2)**2:n*n,b=y+s*((p?E9*(a/2)**2:a*a)-y);return p?2*Math.sqrt(b/E9):Math.sqrt(b)}return n+s*(a-n)}function jBe(e,t,i,r){const s=L(r)?r.shape:void 0,n=e/t.minDataValue,a=Kc(t.minSize,i,r),l=Kc(t.maxSize,i,r);let p=null;return p=s==="circle"?2*Math.sqrt(n*(a/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*a**2):n*a,Dye(p,a,l)}function HBe(e,t,i,r,s){const[n,a,l]=SY(e,s);if(n===a)return Kc(t.stops[n].size,i,r);{const p=Kc(t.stops[n].size,i,r);return p+(Kc(t.stops[a].size,i,r)-p)*l}}function qBe(e,t,i,r){const s=(L(r)&&r.resolution?r.resolution:1)*xS[t.valueUnit],n=Kc(t.minSize,i,r),a=Kc(t.maxSize,i,r),{valueRepresentation:l}=t;let p=null;return p=l==="area"?2*Math.sqrt(e/E9)/s:l==="radius"||l==="distance"?2*e/s:e/s,Dye(p,n,a)}function Lye(e,t,i,r,s){switch(t.transformationType){case Lo.Additive:return BBe(e,t,i,r);case Lo.Constant:return VBe(t,i,r);case Lo.ClampedLinear:return GBe(e,t,i,r);case Lo.Proportional:return jBe(e,t,i,r);case Lo.Stops:return HBe(e,t,i,r,s);case Lo.RealWorldSize:return qBe(e,t,i,r);case Lo.Identity:return e;case Lo.Unknown:return null}}function WBe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Kc(e.minSize,ure,s),a=Kc(e.maxSize,ure,s);if(n!=null||a!=null){if(n>a){const l=a;a=n,n=l}return{minSize:n,maxSize:a}}}function TY(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],a=[],l=[];for(const p of e.visualVariables)switch(p.type){case"color":s.push(p);break;case"opacity":n.push(p);break;case"rotation":l.push(p);break;case"size":a.push(p)}return s.forEach(p=>{const y=Pye(p,t,i);r.push({variable:p,value:y})}),n.forEach(p=>{const y=Iye(p,t,i);r.push({variable:p,value:y})}),l.forEach(p=>{const y=$ye(p,t,i);r.push({variable:p,value:y})}),a.forEach(p=>{const y=TN(p,t,i);r.push({variable:p,value:y})}),r.filter(p=>p.value!=null)}function SY(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function XBe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":TN(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var YBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:XBe,getColor:Pye,getOpacity:Iye,getRotationAngle:$ye,getSize:TN,getSizeForValue:Lye,getSizeFromNumberOrVariable:Kc,getSizeRangeAtScale:WBe,getVisualVariableValues:TY,viewScaleRE:Oye}),zG;const Yw=Ge.getLogger("esri.renderers.visualVariables.SizeVariable"),x5=new Ui({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),BG=new Ui({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function dre(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Wr(e):e.type==="size"?J3(e)?e:(delete(e=ie({},e)).type,new Lr(e)):void 0}function pre(e,t,i){if(typeof e!="object")return e;const r=new Lr;return r.read(e,i),r}let Lr=zG=class extends WO{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:Oye.test(this.valueExpression)}}set expression(e){Yw.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){J3(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),J3(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return Rye(this)}set maxDataValue(e){e&&this.stops&&(Yw.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(Yw.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return dre(e)}readMaxSize(e,t,i){return pre(e,t,i)}set minDataValue(e){e&&this.stops&&(Yw.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(Yw.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return dre(e)}readMinSize(e,t,i){return pre(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(Yw.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return kBe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new Se("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?BG.read(e):null}clone(){return new zG({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:J3(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:J3(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Lo.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Lo.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};_([S({readOnly:!0})],Lr.prototype,"cache",null),_([S({type:x5.apiValues,json:{type:x5.jsonValues,origins:{"web-map":{read:!1}},read:x5.read,write:x5.write}})],Lr.prototype,"axis",void 0),_([S({type:String,value:null,json:{read:!1}})],Lr.prototype,"expression",null),_([S()],Lr.prototype,"index",null),_([S({type:String,readOnly:!0})],Lr.prototype,"inputValueType",null),_([S({type:FBe,json:{write:!0}})],Lr.prototype,"legendOptions",void 0),_([S({type:Number,value:null,json:{write:!0}})],Lr.prototype,"maxDataValue",null),_([S({type:Number,value:null,json:{write:!0}})],Lr.prototype,"maxSize",null),_([_i("maxSize")],Lr.prototype,"castMaxSize",null),_([wt("maxSize")],Lr.prototype,"readMaxSize",null),_([S({type:Number,value:null,json:{write:!0}})],Lr.prototype,"minDataValue",null),_([S({type:Number,value:null,json:{write:!0}})],Lr.prototype,"minSize",null),_([_i("minSize")],Lr.prototype,"castMinSize",null),_([wt("minSize")],Lr.prototype,"readMinSize",null),_([S({type:String,json:{write:!0}})],Lr.prototype,"normalizationField",void 0),_([S({readOnly:!0})],Lr.prototype,"arcadeRequired",null),_([S({type:String})],Lr.prototype,"scaleBy",void 0),_([S({type:[NBe],value:null,json:{write:!0}})],Lr.prototype,"stops",null),_([S({type:["outline"],json:{write:!0}})],Lr.prototype,"target",void 0),_([S({type:String,readOnly:!0})],Lr.prototype,"transformationType",null),_([S({type:["size"],json:{type:["sizeInfo"]}})],Lr.prototype,"type",void 0),_([S({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Lr.prototype,"useSymbolValue",void 0),_([S({type:String,json:{write:!0}})],Lr.prototype,"valueExpression",void 0),_([wt("valueExpression",["valueExpression","expression"])],Lr.prototype,"readValueExpression",null),_([Et("web-scene","valueExpression")],Lr.prototype,"writeValueExpressionWebScene",null),_([S({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Lr.prototype,"valueRepresentation",void 0),_([S({type:BG.apiValues,json:{write:BG.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],Lr.prototype,"valueUnit",void 0),_([wt("valueUnit")],Lr.prototype,"readValueUnit",null),Lr=zG=_([re("esri.renderers.visualVariables.SizeVariable")],Lr);const Nye=Lr,JBe=Ge.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),ZBe={color:Aye,size:Nye,opacity:Cye,rotation:Mye},KBe=new Ui({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),QBe=/^\[([^\]]+)\]$/i;let A9=class extends st{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(QBe),a=n&&n[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const p=KBe.read(l.type),y=ZBe[p];y||(JBe.warn(`Unknown variable type: ${p}`),i&&i.messages&&i.messages.push(new Qh("visual-variable:unsupported",`visualVariable of type '${p}' is not supported`,{definition:l,context:i})));const b=new y;return b.read(l,i),b})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};_([S()],A9.prototype,"visualVariables",null),A9=_([re("esri.renderers.visualVariables.VisualVariableFactory")],A9);const eVe=A9,tVe={base:WO,key:"type",typeMap:{opacity:Cye,color:Aye,rotation:Mye,size:Nye}},XO=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new eVe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&hd(i,r,n.field),n.normalizationField&&hd(i,r,n.normalizationField),n.valueExpression&&await eu(i,r,n.valueExpression))}};return _([S({types:[tVe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),_([wt("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),_([Et("visualVariables")],t.prototype,"writeVisualVariables",null),t=_([re("esri.renderers.mixins.VisualVariablesMixin")],t),t},eA={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function iVe(e,t=eA){if(!e)return{symbol:null};const{retainId:i=eA.retainId,ignoreDrivers:r=eA.ignoreDrivers,hasLabelingContext:s=eA.hasLabelingContext,retainCIM:n=eA.retainCIM}=t;let a;if(mR(e)||e instanceof Rw)a=e.clone();else if(e.type==="cim"){var l,p;const y=(l=e.data)==null||(p=l.symbol)==null?void 0:p.type;if(y!=="CIMPointSymbol")return{error:new Se("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${y||"unknown"}' is unsupported in 3D`,{symbol:e})};a=n?e.clone():jy.fromCIMSymbol(e)}else if(e instanceof tu)a=WL.fromSimpleLineSymbol(e);else if(e instanceof cg)a=jy.fromSimpleMarkerSymbol(e);else if(e instanceof XL)a=jy.fromPictureMarkerSymbol(e);else if(e instanceof Ag)a=UO.fromSimpleFillSymbol(e);else{if(!(e instanceof fE))return{error:new Se("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};a=s?qL.fromTextSymbol(e):jy.fromTextSymbol(e)}if(i&&a.type!=="cim"&&(a.id=e.id),r&&mR(a))for(let y=0;y<a.symbolLayers.length;++y)a.symbolLayers.getItemAt(y)._ignoreDrivers=!0;return{symbol:a}}function oD(e,t,i,r){const s=Fye(e,{},{context:r,isLabelSymbol:!1});L(s)&&(t[i]=s)}function fre(e,t,i,r){const s=Fye(e,{},{context:r,isLabelSymbol:!0});L(s)&&(t[i]=s)}function Fye(e,t,i){if(J(e))return null;const{context:r,isLabelSymbol:s}=i;if(r&&r.origin==="web-scene"&&!(e instanceof pE)&&!(e instanceof Rw)){const n=iVe(e,{retainCIM:!0,hasLabelingContext:s});return L(n.symbol)?n.symbol.write(t,r):(r.messages&&r.messages.push(new Se("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:n.error})),null)}return r&&r.origin==="web-map"&&e.type==="web-style"?(r.messages&&r.messages.push(new Se("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in webmaps. Use CIMSymbol instead when working with WebMap in MapView.`,{symbol:e,context:r})),null):e.write(t,r)}function $Tt(e,t){return fDe(e,null,t)}const YO={types:k0e,json:{write:{writer:oD},origins:{"web-scene":{types:pte,write:{writer:oD},read:{reader:rE({types:pte})}}}}},kye={types:{base:hc,key:"type",typeMap:{"simple-fill":Lc.typeMap["simple-fill"],"picture-fill":Lc.typeMap["picture-fill"],"polygon-3d":Lc.typeMap["polygon-3d"]}},json:{write:{writer:oD},origins:{"web-scene":{type:UO,write:{writer:oD}}}}};var VG;let Z1=VG=class extends Ye{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new VG({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};_([S({type:String,json:{write:!0}})],Z1.prototype,"description",void 0),_([S({type:String,json:{write:!0}})],Z1.prototype,"label",void 0),_([S({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Z1.prototype,"minValue",void 0),_([S({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Z1.prototype,"maxValue",void 0),_([S(YO)],Z1.prototype,"symbol",void 0),Z1=VG=_([re("esri.renderers.support.ClassBreakInfo")],Z1);const aD=Z1;var GG;const T5=Ge.getLogger("esri.renderers.ClassBreaksRenderer"),Uye="log",C9="percent-of-total",M9="field",S5=new Ui({esriNormalizeByLog:Uye,esriNormalizeByPercentOfTotal:C9,esriNormalizeByField:M9}),rVe=Ys(aD);let lo=GG=class extends XO(Wv){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new aD;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(T5.error(".field: field must be a string value"),null):PO(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&M9||i&&C9||null,t&&i&&T5.warn("warning: both normalizationField and normalizationTotal are set!")):e!==M9&&e!==C9||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new aD({minValue:e,maxValue:t,symbol:U0e(i)}):rVe(Fe(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(J(t)||J(t.arcade))&&T5.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(J(t)||J(t.arcade))&&(i=qe(ie({},i),{arcade:await Np()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(J(t)||J(t.arcade)))return void T5.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(J(t)||J(t.arcade))){const s=await Np(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=qe(ie({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new GG({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Fe(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Fe(this.visualVariables),legendOptions:Fe(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),eu(e,t,this.valueExpression)];hd(e,t,this.field),hd(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Wt(t,{});let a=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const y=l.createSyntaxTree(this.valueExpression);a=l.createFunction(y),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=this.valueExpression;const p=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(p)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,a=parseFloat(i[this.normalizationField]);if(r===Uye)s=Math.log(s)*Math.LOG10E;else if(r!==C9||isNaN(n)){if(r===M9&&!isNaN(a)){if(isNaN(s)||isNaN(a))return-1;s/=a}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};_([S(kye)],lo.prototype,"backgroundFillSymbol",void 0),_([S({type:[aD]})],lo.prototype,"classBreakInfos",void 0),_([wt("classBreakInfos")],lo.prototype,"readClassBreakInfos",null),_([Et("classBreakInfos")],lo.prototype,"writeClassBreakInfos",null),_([S({type:String,json:{write:!0}})],lo.prototype,"defaultLabel",void 0),_([S(YO)],lo.prototype,"defaultSymbol",void 0),_([S({type:String,json:{write:!0}})],lo.prototype,"field",void 0),_([_i("field")],lo.prototype,"castField",null),_([S({type:Boolean})],lo.prototype,"isMaxInclusive",void 0),_([S({type:xY,json:{write:!0}})],lo.prototype,"legendOptions",void 0),_([S({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],lo.prototype,"minValue",null),_([S({type:String,json:{write:!0}})],lo.prototype,"normalizationField",void 0),_([S({type:Number,cast:e=>Xu(e),json:{write:!0}})],lo.prototype,"normalizationTotal",void 0),_([S({type:S5.apiValues,value:null,json:{type:S5.jsonValues,read:S5.read,write:S5.write}})],lo.prototype,"normalizationType",null),_([ti({classBreaks:"class-breaks"})],lo.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],lo.prototype,"valueExpression",void 0),_([S({type:String,json:{write:!0}})],lo.prototype,"valueExpressionTitle",void 0),lo=GG=_([re("esri.renderers.ClassBreaksRenderer")],lo);const zye=lo,R9=-3;var Hm;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Hm||(Hm={}));class sVe{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class EY{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Ci,this._users=new Ci}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,Hm.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,Hm.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const a=1+Math.max(s,R9)-R9;this._db.set(t,{entry:i,size:r,lifetime:a,lives:a}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,Hm.SOME);if(!(L(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((a,l)=>{const p=a.lifetime;r[p]=(r[p]||0)+a.size,this._users.forAll(y=>{const b=y.namespace;if(l.startsWith(b)){const x=i[b]||0;i[b]=x+a.size}})});const s={};this._users.forAll(a=>{const l=a.namespace;if(!isNaN(a.hitRate)&&a.hitRate>0){const p=i[l]||0;i[l]=p,s[l]=Math.round(100*a.hitRate)+"%"}else s[l]="0%"});const n=Object.keys(i);n.sort((a,l)=>i[l]-i[a]),n.forEach(a=>t[a]=Math.round(i[a]/2**20)+"MB / "+s[a]);for(let a=r.length-1;a>=0;--a){const l=r[a];l&&(t["Priority "+(a+R9-1)]=Math.round(l/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,Hm.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,Hm.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const a=n[1](i,r);return typeof a=="number"&&(s=a),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,Hm.SOME);L(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class nVe{constructor(t,i){this._storage=new EY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const mre=Ge.getLogger("esri.renderers.support.DictionaryLoader"),oVe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class AY{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new nVe(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(M){if(Cs(M))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const M of this._symbolFields){const P=this.fieldMap[M];if(P&&t.attributes[P]!=null){const $=""+t.attributes[P];s[M]=$}else s[M]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const a=Lq(n).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const p=n.split(";"),y=[],b=[];for(const M of p)if(M)if(M.includes("po:")){const P=M.substr(3).split("|");if(P.length===3){const $=P[0],k=P[1];let z=P[2];if(k==="DashTemplate")z=z.split(" ").map(G=>Number(G));else if(k==="Color"){const G=new Ft(z).toRgba();z=[G[0],G[1],G[2],255*G[3]]}else z=Number(z);b.push({primitiveName:$,propertyName:k,value:z})}}else if(M.includes("|")){for(const P of M.split("|"))if(this._itemNames.has(P)){y.push(P);break}}else this._itemNames.has(M)&&y.push(M);const x=!L(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",A=this._cimPartsToCIMSymbol(y,b,x,i);return this._symbolCache.put(a,A,1),A}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void mre.error("no valid URL!");const i=L(t)?t.abortOptions:null,r=Ar(this.url+"/resources/styles/dictionary-info.json",ie({responseType:"json",query:{f:"json"}},i)),[{data:s}]=await Promise.all([r,Np()]);if(!s)throw this._dictionaryPromise=null,new Se("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=s.expression,a=s.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+s.cimRefTemplateUrl,this._itemNames=new Set(s.itemsNames),this._symbolFields=a.symbol;const l={};if(this.config){const y=this.config;for(const b in y)l[b]=y[b]}if(a.configuration)for(const y of a.configuration)l.hasOwnProperty(y.name)||(l[y.name]=y.value);const p=[];if(L(t)&&t.fields&&this.fieldMap)for(const y of this._symbolFields){const b=this.fieldMap[y],x=t.fields.filter(A=>A.name===b);x.length>0&&p.push(qe(ie({},x[0]),{name:y}))}return this._dictionaryPromise=f$e(n,L(t)?t.spatialReference:null,p,l).then(y=>{const b={scale:0};return(x,A)=>{const M=y.repurposeFeature({geometry:null,attributes:x});return b.scale=L(A)?A.scale:void 0,y.evaluate({$feature:M,$view:b})}}).catch(y=>(mre.error("Creating dictinoary expression failed:",y),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let p=0;p<t.length;p++)n[p]=this._getSymbolPart(t[p],s);const a=await Promise.all(n),l=this.fieldMap;for(const p of a)Bye(p,l);return new hE({data:this._combineSymbolParts(a,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=Ar(r,ie({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){return this._ongoingRequests.delete(t),Promise.reject(n)}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=ie({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const a=n;s.symbolLayers.unshift(...a.symbolLayers)}}return r&&(s.callout=oVe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function Bye(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&aVe(s,t)}}function aVe(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Bye(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var DTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:AY}),jG;let Wd=jG=class extends XO(Wv){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new AY(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r!=null&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new jG({config:Fe(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Fe(this.fieldMap),url:Fe(this.url),visualVariables:Fe(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await eu(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};_([S({type:AY})],Wd.prototype,"_loader",null),_([S({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Wd.prototype,"config",void 0),_([S({type:Object,json:{write:!0}})],Wd.prototype,"fieldMap",void 0),_([S({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Wd.prototype,"scaleExpression",void 0),_([Et("scaleExpression")],Wd.prototype,"writeData",null),_([S({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Wd.prototype,"scaleExpressionTitle",void 0),_([S({type:String,json:{write:!0}})],Wd.prototype,"url",void 0),_([Et("visualVariables")],Wd.prototype,"writeVisualVariables",null),Wd=jG=_([re("esri.renderers.DictionaryRenderer")],Wd);const lVe=Wd;var HG;const cVe=Ge.getLogger("esri.renderers.support.AttributeColorInfo");let vm=HG=class extends Ye{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(cVe.error(".field: field must be a string value"),null):PO(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new HG({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};_([S({type:Ft,json:{type:[Number],write:!0}})],vm.prototype,"color",void 0),_([S({type:String,json:{write:!0}})],vm.prototype,"field",void 0),_([_i("field")],vm.prototype,"castField",null),_([S({type:String,json:{write:!0}})],vm.prototype,"label",void 0),_([S({type:String,json:{write:!0}})],vm.prototype,"valueExpression",void 0),_([S({type:String,json:{write:!0}})],vm.prototype,"valueExpressionTitle",void 0),vm=HG=_([re("esri.renderers.support.AttributeColorInfo")],vm);const hVe=vm;var qG;let O9=qG=class extends Ye{constructor(){super(...arguments),this.unit=null}clone(){return new qG({unit:this.unit})}};_([S({type:String,json:{write:!0}})],O9.prototype,"unit",void 0),O9=qG=_([re("esri.renderers.support.DotDensityLegendOptions")],O9);const uVe=O9;var WG;let Ja=WG=class extends XO(Wv){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Ft([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new tu,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Ag({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new WG({attributes:Fe(this.attributes),backgroundColor:Fe(this.backgroundColor),dotBlendingEnabled:Fe(this.dotBlendingEnabled),dotShape:Fe(this.dotShape),dotSize:Fe(this.dotSize),dotValue:Fe(this.dotValue),legendOptions:Fe(this.legendOptions),outline:Fe(this.outline),referenceScale:Fe(this.referenceScale),visualVariables:Fe(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await eu(e,t,i.valueExpression),i.field&&e.add(i.field)}};_([S({type:[hVe],json:{write:!0}})],Ja.prototype,"attributes",void 0),_([S({type:Ft,json:{write:!0}})],Ja.prototype,"backgroundColor",void 0),_([S({type:Boolean}),oi("dotBlendingEnabled")],Ja.prototype,"blendDots",void 0),_([S({type:Boolean,json:{write:!0}})],Ja.prototype,"dotBlendingEnabled",void 0),_([S({type:String,json:{write:!1}})],Ja.prototype,"dotShape",void 0),_([S({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Ja.prototype,"dotSize",void 0),_([S({type:uVe,json:{write:!0}})],Ja.prototype,"legendOptions",void 0),_([S({type:tu,json:{default:null,write:!0}})],Ja.prototype,"outline",void 0),_([S({type:Number,json:{write:!0}})],Ja.prototype,"dotValue",void 0),_([S({type:Number}),oi("dotValue")],Ja.prototype,"referenceDotValue",void 0),_([S({type:Number,json:{write:!0}})],Ja.prototype,"referenceScale",void 0),_([S({type:Number,json:{write:!0}})],Ja.prototype,"seed",void 0),_([ti({dotDensity:"dot-density"})],Ja.prototype,"type",void 0),Ja=WG=_([re("esri.renderers.DotDensityRenderer")],Ja);const dVe=Ja;var XG;let MC=XG=class extends Ye{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new XG({color:this.color,ratio:this.ratio})}};_([S({type:Ft,json:{write:!0}})],MC.prototype,"color",void 0),_([S({type:Number,json:{write:!0}})],MC.prototype,"ratio",void 0),MC=XG=_([re("esri.renderers.support.HeatmapColorStop")],MC);const P9=MC;var YG;let Xd=YG=class extends Wv{constructor(e){super(e),this.blurRadius=10,this.referenceScale=0,this.colorStops=[new P9({ratio:0,color:new Ft("rgba(255, 140, 0, 0)")}),new P9({ratio:.75,color:new Ft("rgba(255, 140, 0, 1)")}),new P9({ratio:.9,color:new Ft("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const i=this.field;i&&typeof i=="string"&&hd(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new YG({blurRadius:this.blurRadius,referenceScale:this.referenceScale,colorStops:Fe(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};_([S({type:Number,json:{write:!0}})],Xd.prototype,"blurRadius",void 0),_([S({type:Number})],Xd.prototype,"referenceScale",void 0),_([S({type:[P9],json:{write:!0}})],Xd.prototype,"colorStops",void 0),_([S({type:String,json:{write:!0}})],Xd.prototype,"field",void 0),_([S({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})}}})],Xd.prototype,"fieldOffset",void 0),_([S({type:Number,json:{write:!0}})],Xd.prototype,"maxPixelIntensity",void 0),_([S({type:Number,json:{write:!0}})],Xd.prototype,"minPixelIntensity",void 0),_([ti({heatmap:"heatmap"})],Xd.prototype,"type",void 0),Xd=YG=_([re("esri.renderers.HeatmapRenderer")],Xd);const pVe=Xd;var JG;let lb=JG=class extends XO(Wv){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new JG({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Fe(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};_([S({type:String,json:{write:!0}})],lb.prototype,"description",void 0),_([S({type:String,json:{write:!0}})],lb.prototype,"label",void 0),_([S(YO)],lb.prototype,"symbol",void 0),_([ti({simple:"simple"})],lb.prototype,"type",void 0),lb=JG=_([re("esri.renderers.SimpleRenderer")],lb);const CY=lb,fVe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function ZG(e){return e instanceof st}function gre(e){return e instanceof kt?Object.keys(e.items):ZG(e)?nc(e).keys():e?Object.keys(e):[]}function E5(e,t){return e instanceof kt?e.items[t]:e[t]}function mVe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function CM(e){return e?e.declaredClass:null}function Vye(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=gre(e),s=gre(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||mVe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(x=>r.indexOf(x)===-1),a=r.filter(x=>s.indexOf(x)===-1),l=r.filter(x=>s.indexOf(x)>-1&&E5(e,x)!==E5(t,x)).concat(n,a).sort(),p=CM(e);if(p&&fVe.indexOf(p)>-1&&l.length)return{type:"complete",oldValue:e,newValue:t};let y;const b=ZG(e)&&ZG(t);for(const x of l){const A=E5(e,x),M=E5(t,x);let P;(b||typeof A!="function"&&typeof M!="function")&&A!==M&&(A==null&&M==null||(P=i&&i[x]&&typeof i[x]=="function"?i[x](A,M):typeof A=="object"&&typeof M=="object"&&CM(A)===CM(M)?Vye(A,M):{type:"complete",oldValue:A,newValue:M},L(P)&&(L(y)?y.diff[x]=P:y={type:"partial",diff:{[x]:P}})))}return y}function gVe(e,t){if(J(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function LTt(e,t){for(const i of t)if(gVe(e,i))return!0;return!1}function yVe(e,t){if(!(typeof e=="function"||typeof t=="function"||J(e)&&J(t)))return J(e)||J(t)||typeof e=="object"&&typeof t=="object"&&CM(e)!==CM(t)?{type:"complete",oldValue:e,newValue:t}:Vye(e,t)}function A5(e){if(J(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!A5(i))return!1;for(const i of t.removed)if(!A5(i))return!1;for(const i of t.changed)if(!A5(i))return!1;return!0}case"partial":for(const t in e.diff)if(!A5(e.diff[t]))return!1;return!0}}var KG;let K1=KG=class extends Ye{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new KG({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};_([S({type:String,json:{write:!0}})],K1.prototype,"description",void 0),_([S({type:String,json:{write:!0}})],K1.prototype,"label",void 0),_([S(YO)],K1.prototype,"symbol",void 0),_([S({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],K1.prototype,"value",void 0),_([_i("value")],K1.prototype,"castValue",null),K1=KG=_([re("esri.renderers.support.UniqueValueInfo")],K1);const lD=K1,vVe=()=>!!je("enable-feature:force-wosr"),NTt=()=>!!je("enable-feature:direct-3d-object-feature-layer-display"),_Ve=()=>!!je("enable-feature:precipitation"),C7={};async function bVe(e,t){try{return{data:(await SVe(e,t)).data,baseUrl:vPe(e),styleUrl:e}}catch(i){return Fg(i),null}}function wVe(e,t,i){const r=t&&t.portal||ha.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return C7[n]||(C7[n]=xVe(e,r,i).then(a=>(s=a,a.fetchData())).then(a=>({data:a,baseUrl:s.itemUrl,styleName:e}))),C7[n]}function xVe(e,t,i){return t.load(i).then(()=>{const r=new Zm({disableExtraQuery:!0,query:`owner:${yre} AND type:${vre} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(a.typeKeywords.some(l=>l.toLowerCase()===n)&&a.type===vre&&a.owner===yre){s=a;break}}if(!s)throw new Se("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function TVe(e,t,i){return e.styleUrl?bVe(e.styleUrl,i):e.styleName?wVe(e.styleName,t,i):Promise.reject(new Se("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function FTt(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function kTt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!vVe()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function SVe(e,t){const i=ie({responseType:"json",query:{f:"json"}},t);return Ar(cd(e),i)}const yre="esri_en",vre="Style",UTt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var RC;const n_=Ge.getLogger("esri.renderers.UniqueValueRenderer"),EVe=Ys(lD);let _n=RC=class extends XO(Wv){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const a=t.find(l=>l.value===i[n].value);a?yVe(a,i[n])?(s.changed.push({type:"complete",oldValue:a,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:a,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(a=>a.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:PO(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new Se("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):n_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||ha.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=uE(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=W2(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?n_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void n_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?EVe(e):new lD({value:e,symbol:U0e(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)n_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(J(t)||J(t.arcade))&&(i=qe(ie({},i),{arcade:await Np()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(J(t)||J(t.arcade)))return void n_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(J(i)||J(i.arcade))){const s=await Np(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=qe(ie({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new RC({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Fe(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Fe(this.visualVariables),legendOptions:Fe(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Fe(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=Fe(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(Fe(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),eu(e,t,this.valueExpression)];hd(e,t,this.field),hd(e,t,this.field2),hd(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return TVe(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new Rw({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new lD({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Wt(t,{});let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const y=l.createSyntaxTree(this.valueExpression);a=l.createFunction(y),this._cache.compiledFunc=a}const p=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[p+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,a=[];t&&a.push(i[t]),s&&a.push(i[s]),n&&a.push(i[n]),r=a.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new RC(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||ha.getDefault());const r=i.populateFromStyle();return r.catch(s=>{n_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new RC(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{n_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};_([S({readOnly:!0})],_n.prototype,"_cache",null),_([ti({uniqueValue:"unique-value"})],_n.prototype,"type",void 0),_([S(kye)],_n.prototype,"backgroundFillSymbol",void 0),_([S({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],_n.prototype,"field",void 0),_([_i("field")],_n.prototype,"castField",null),_([Et("field")],_n.prototype,"writeField",null),_([S({type:String,json:{write:!0}})],_n.prototype,"field2",void 0),_([S({type:String,json:{write:!0}})],_n.prototype,"field3",void 0),_([S({type:String,json:{write:!0}})],_n.prototype,"valueExpression",void 0),_([S({type:String,json:{write:!0}})],_n.prototype,"valueExpressionTitle",void 0),_([S({type:xY,json:{write:!0}})],_n.prototype,"legendOptions",void 0),_([S({type:String,json:{write:!0}})],_n.prototype,"defaultLabel",void 0),_([S(cue(ie({},YO),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],_n.prototype,"defaultSymbol",null),_([S({type:String,json:{write:!0}})],_n.prototype,"fieldDelimiter",void 0),_([S({type:ha,readOnly:!0})],_n.prototype,"portal",void 0),_([wt("portal",["styleName"])],_n.prototype,"readPortal",null),_([S({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],_n.prototype,"styleOrigin",void 0),_([wt("styleOrigin",["styleName","styleUrl"])],_n.prototype,"readStyleOrigin",null),_([Et("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],_n.prototype,"writeStyleOrigin",null),_([S({type:[lD],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],_n.prototype,"uniqueValueInfos",null),_n=RC=_([re("esri.renderers.UniqueValueRenderer")],_n);const MY=_n,Gye={key:"type",base:Wv,typeMap:{heatmap:pVe,simple:CY,"unique-value":MY,"class-breaks":zye,"dot-density":dVe,dictionary:lVe},errorContext:"renderer"},AVe={key:"type",base:Wv,typeMap:{simple:CY,"unique-value":MY,"class-breaks":zye},errorContext:"renderer"},CVe=rE({types:Gye});function MVe(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Qh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):CVe(e,t,i):null}class RY{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(Wz),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new RY,r=this._originStores[or.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,Fe(s),or.DEFAULTS)});for(let s=or.SERVICE;s<Wz;s++){const n=this._originStores[s];n&&n.forEach((a,l)=>{t&&t.has(l)||i.set(l,Fe(a),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=or.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=or.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const a=this._originStores[n];if(a&&a.has(t)){this._values.set(t,a.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||or.DEFAULTS}forEach(t){this._values.forEach(t)}}const jye=e=>{let t=class extends e{constructor(...i){super(...i);const r=nc(this),s=r.store,n=new RY;r.store=n,nfe(r,s,n)}read(i,r){afe(this,i,r)}getAtOrigin(i,r){const s=M7(this),n=zy(r);if(typeof i=="string")return s.get(i,n);const a={};return i.forEach(l=>{a[l]=s.get(l,n)}),a}originOf(i){return g6(this.originIdOf(i))}originIdOf(i){return M7(this).originOf(i)}revert(i,r){const s=M7(this),n=zy(r),a=nc(this);let l;l=typeof i=="string"?i==="*"?s.keys(n):[i]:i,l.forEach(p=>{a.invalidate(p),s.revert(p,n),a.commit(p)})}};return t=_([re("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function M7(e){return nc(e).store}let _re=class extends jye(st){};_re=_([re("esri.core.ReadOnlyMultiOriginJSONSupport")],_re);const RVe=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return R7(this).delete(i,zy(r))}write(i={},r){return hfe(this,i=i||{},r),i}setAtOrigin(i,r,s){nc(this).setAtOrigin(i,r,zy(s))}removeOrigin(i){const r=R7(this),s=zy(i),n=r.keys(s);for(const a of n)r.originOf(a)===s&&r.set(a,r.get(a,s),or.USER)}updateOrigin(i,r){const s=R7(this),n=zy(r),a=this.get(i);for(let l=n+1;l<Wz;++l)s.delete(i,l);s.set(i,a,n)}toJSON(i){return this.write({},i)}};return t=_([re("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function R7(e){return nc(e).store}const OY=e=>{let t=class extends RVe(jye(e)){constructor(...i){super(...i)}};return t=_([re("esri.core.MultiOriginJSONSupport")],t),t};let QG=class extends OY(st){};QG=_([re("esri.core.MultiOriginJSONSupport")],QG);async function OVe(e,t){const{WhereClause:i}=await Promise.resolve().then(function(){return uK});return i.create(e,t)}var ej;let cb=ej=class extends Ye{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new ej({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};_([S({type:String,json:{write:!0}})],cb.prototype,"expression",void 0),_([S({type:String,json:{write:!0}})],cb.prototype,"name",void 0),_([S({type:["boolean","date","number","string"],json:{write:!0}})],cb.prototype,"returnType",void 0),_([S({type:String,json:{write:!0}})],cb.prototype,"title",void 0),cb=ej=_([re("esri.form.ExpressionInfo")],cb);const PVe=cb;let hb=class extends Ye{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};_([S({type:String,json:{write:!0}})],hb.prototype,"description",void 0),_([S({type:String,json:{write:!0}})],hb.prototype,"label",void 0),_([S()],hb.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],hb.prototype,"visibilityExpression",void 0),hb=_([re("esri.form.elements.Element")],hb);const TS=hb;var tj;let I9=tj=class extends Ye{constructor(e){super(e),this.type=null}clone(){return new tj({type:this.type})}};_([S({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],I9.prototype,"type",void 0),I9=tj=_([re("esri.form.elements.inputs.AttachmentInput")],I9);const IVe=I9;var ij;let ub=ij=class extends TS{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new ij({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};_([S({type:String,json:{write:!0}})],ub.prototype,"attachmentKeyword",void 0),_([S({type:Boolean,json:{write:!0}})],ub.prototype,"editable",void 0),_([S({type:IVe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ub.prototype,"input",void 0),_([S({type:["attachment"],json:{read:!1,write:!0}})],ub.prototype,"type",void 0),ub=ij=_([re("esri.form.elements.AttachmentElement")],ub);const bre=ub;let $9=class extends Ye{constructor(e){super(e),this.type=null}};_([S()],$9.prototype,"type",void 0),$9=_([re("esri.form.elements.inputs.Input")],$9);const xE=$9;let OC=class extends xE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};_([S({type:Number,json:{write:!0}})],OC.prototype,"maxLength",void 0),_([S({type:Number,json:{write:!0}})],OC.prototype,"minLength",void 0),OC=_([re("esri.form.elements.inputs.TextInput")],OC);const PY=OC;var rj;let D9=rj=class extends PY{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new rj({maxLength:this.maxLength,minLength:this.minLength})}};_([S({type:["barcode-scanner"],json:{read:!1,write:!0}})],D9.prototype,"type",void 0),D9=rj=_([re("esri.form.elements.inputs.BarcodeScannerInput")],D9);const $Ve=D9;var sj;let o3=sj=class extends xE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new sj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};_([S({type:String,json:{write:!0}})],o3.prototype,"noValueOptionLabel",void 0),_([S({type:Boolean,json:{write:!0}})],o3.prototype,"showNoValueOption",void 0),_([S({type:["combo-box"],json:{read:!1,write:!0}})],o3.prototype,"type",void 0),o3=sj=_([re("esri.form.elements.inputs.ComboBoxInput")],o3);const DVe=o3;var nj;function wre(e){return e!=null?new Date(e):null}function xre(e){return e?e.getTime():null}let Yd=nj=class extends xE{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return wre(t.max)}writeMax(e,t){t.max=xre(e)}readMin(e,t){return wre(t.min)}writeMin(e,t){t.min=xre(e)}clone(){return new nj({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};_([S({type:Boolean,json:{write:!0}})],Yd.prototype,"includeTime",void 0),_([S({type:Date,json:{type:Number,write:!0}})],Yd.prototype,"max",void 0),_([wt("max")],Yd.prototype,"readMax",null),_([Et("max")],Yd.prototype,"writeMax",null),_([S({type:Date,json:{type:Number,write:!0}})],Yd.prototype,"min",void 0),_([wt("min")],Yd.prototype,"readMin",null),_([Et("min")],Yd.prototype,"writeMin",null),_([S({type:["datetime-picker"],json:{read:!1,write:!0}})],Yd.prototype,"type",void 0),Yd=nj=_([re("esri.form.elements.inputs.DateTimePickerInput")],Yd);const LVe=Yd;var oj;let a3=oj=class extends xE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new oj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};_([S({type:String,json:{write:!0}})],a3.prototype,"noValueOptionLabel",void 0),_([S({type:Boolean,json:{write:!0}})],a3.prototype,"showNoValueOption",void 0),_([S({type:["radio-buttons"],json:{read:!1,write:!0}})],a3.prototype,"type",void 0),a3=oj=_([re("esri.form.elements.inputs.RadioButtonsInput")],a3);const NVe=a3;var aj;let l3=aj=class extends xE{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new aj({offValue:this.offValue,onValue:this.onValue})}};_([S({type:[String,Number],json:{write:!0}})],l3.prototype,"offValue",void 0),_([S({type:[String,Number],json:{write:!0}})],l3.prototype,"onValue",void 0),_([S({type:["switch"],json:{read:!1,write:!0}})],l3.prototype,"type",void 0),l3=aj=_([re("esri.form.elements.inputs.SwitchInput")],l3);const FVe=l3;var lj;let L9=lj=class extends PY{constructor(e){super(e),this.type="text-area"}clone(){return new lj({maxLength:this.maxLength,minLength:this.minLength})}};_([S({type:["text-area"],json:{read:!1,write:!0}})],L9.prototype,"type",void 0),L9=lj=_([re("esri.form.elements.inputs.TextAreaInput")],L9);const kVe=L9;var cj;let N9=cj=class extends PY{constructor(e){super(e),this.type="text-box"}clone(){return new cj({maxLength:this.maxLength,minLength:this.minLength})}};_([S({type:["text-box"],json:{read:!1,write:!0}})],N9.prototype,"type",void 0),N9=cj=_([re("esri.form.elements.inputs.TextBoxInput")],N9);const UVe=N9,zVe={base:xE,key:"type",typeMap:{"barcode-scanner":$Ve,"combo-box":DVe,"datetime-picker":LVe,"radio-buttons":NVe,switch:FVe,"text-area":kVe,"text-box":UVe}};var hj;let Cu=hj=class extends TS{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new hj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};_([S({types:Vge,json:{read:{reader:XX},write:!0}})],Cu.prototype,"domain",void 0),_([S({type:Boolean,json:{write:!0}})],Cu.prototype,"editable",void 0),_([S({type:String,json:{write:!0}})],Cu.prototype,"editableExpression",void 0),_([S({type:String,json:{write:!0}})],Cu.prototype,"fieldName",void 0),_([S({type:String,json:{write:!0}})],Cu.prototype,"hint",void 0),_([S({types:zVe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Cu.prototype,"input",void 0),_([S({type:String,json:{write:!0}})],Cu.prototype,"requiredExpression",void 0),_([S({type:String,json:{read:!1,write:!0}})],Cu.prototype,"type",void 0),_([S({type:String,json:{write:!0}})],Cu.prototype,"valueExpression",void 0),Cu=hj=_([re("esri.form.elements.FieldElement")],Cu);const Tre=Cu;var uj;let _m=uj=class extends TS{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new uj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Fe(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};_([S({type:Number,json:{write:!0}})],_m.prototype,"displayCount",void 0),_([S({type:["list"],json:{write:!0}})],_m.prototype,"displayType",void 0),_([S({type:Boolean,json:{write:!0}})],_m.prototype,"editable",void 0),_([S({type:[Qfe],json:{write:!0}})],_m.prototype,"orderByFields",void 0),_([S({type:Number,json:{write:!0}})],_m.prototype,"relationshipId",void 0),_([S({type:["relationship"],json:{read:!1,write:!0}})],_m.prototype,"type",void 0),_m=uj=_([re("esri.form.elements.RelationshipElement")],_m);const Sre=_m;function Hye(e){return{typesWithGroup:{base:TS,key:"type",typeMap:{attachment:bre,field:Tre,group:e,relationship:Sre}},typesWithoutGroup:{base:TS,key:"type",typeMap:{attachment:bre,field:Tre,relationship:Sre}}}}function qye(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function Wye(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function Xye(e,t,i=!0){return e?e.map(r=>Dp(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var dj;let Uf=dj=class extends TS{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Xye(e,O7,!1)}readElements(e,t){return qye(t.formElements,O7,!1)}writeElements(e,t){t.formElements=Wye(e,O7,!1)}clone(){return new dj({description:this.description,elements:Fe(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};_([S({json:{write:!0}})],Uf.prototype,"elements",void 0),_([_i("elements")],Uf.prototype,"castElements",null),_([wt("elements",["formElements"])],Uf.prototype,"readElements",null),_([Et("elements")],Uf.prototype,"writeElements",null),_([S({type:["collapsed","expanded"],json:{write:!0}})],Uf.prototype,"initialState",void 0),_([S({type:String,json:{read:!1,write:!0}})],Uf.prototype,"type",void 0),Uf=dj=_([re("esri.form.elements.GroupElement")],Uf);const O7=Hye(Uf),BVe=Uf;var pj;const P7=Hye(BVe);let Af=pj=class extends Ye{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Xye(e,P7)}readElements(e,t){return qye(t.formElements,P7)}writeElements(e,t){t.formElements=Wye(e,P7)}clone(){return new pj({description:this.description,expressionInfos:Fe(this.expressionInfos),elements:Fe(this.elements),title:this.title})}};_([S({type:String,json:{write:!0}})],Af.prototype,"description",void 0),_([S({json:{write:!0}})],Af.prototype,"elements",void 0),_([_i("elements")],Af.prototype,"castElements",null),_([wt("elements",["formElements"])],Af.prototype,"readElements",null),_([Et("elements")],Af.prototype,"writeElements",null),_([S({type:[PVe],json:{write:!0}})],Af.prototype,"expressionInfos",void 0),_([S({type:String,json:{write:!0}})],Af.prototype,"title",void 0),Af=pj=_([re("esri.form.FormTemplate")],Af);const VVe=Af;let GVe=0;const Ere=Ge.getLogger("esri.layers.Layer");let Po=class extends ps.EventedMixin(NL(d0)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ki(-180,-90,180,90,It.WGS84),this.id=Date.now().toString(16)+"-layer-"+GVe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=It.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e,i=await import("./arcgisLayers.3290adcd.js");try{return await i.fromUrl(t)}catch(r){throw Ere.error("#fromArcGISServerUrl({ url: '"+t.url+"'})","Failed to create layer from arcgis server url",r),r}}static async fromPortalItem(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.afaa3850.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",a=s&&s.portal&&s.portal.url||qr.portalUrl;throw Ere.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+n+"')",r),r}}initialize(){this.when().catch(e=>{var t,i;Cs(e)||Ge.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?Gn(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Ar(e,{query:{f:"json"},responseType:"json"})).data;throw new Se("layer:no-attribution-data","Layer does not have attribution data")}};_([S({type:String})],Po.prototype,"attributionDataUrl",void 0),_([S({type:ki})],Po.prototype,"fullExtent",void 0),_([S({readOnly:!0})],Po.prototype,"hasAttributionData",null),_([S({type:String,clonable:!1})],Po.prototype,"id",void 0),_([S({type:Boolean,nonNullable:!0})],Po.prototype,"legendEnabled",void 0),_([S({type:["show","hide","hide-children"]})],Po.prototype,"listMode",void 0),_([S({type:Number,range:{min:0,max:1},nonNullable:!0})],Po.prototype,"opacity",void 0),_([S({clonable:!1})],Po.prototype,"parent",void 0),_([S({readOnly:!0})],Po.prototype,"parsedUrl",null),_([S({type:Boolean})],Po.prototype,"popupEnabled",void 0),_([S({type:Boolean})],Po.prototype,"attributionVisible",void 0),_([S({type:It})],Po.prototype,"spatialReference",void 0),_([S({type:String})],Po.prototype,"title",void 0),_([S({type:String,readOnly:!0,json:{read:!1}})],Po.prototype,"type",void 0),_([S()],Po.prototype,"url",void 0),_([S({type:Boolean,nonNullable:!0})],Po.prototype,"visible",void 0),Po=_([re("esri.layers.Layer")],Po);const JO=Po;function Are(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function jVe(e,t,i){if(!e&&!t||!i)return;const r=uS(i);Cre(e,i,r),Cre(t,i,r)}function Cre(e,t,i){if(e)for(const r of e)HVe(r.geometry,t,i)}function HVe(e,t,i){if(J(e)||!e.spatialReference||Vo(e.spatialReference,t))return;const r=uS(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)Are(e,e.rings,r);else if("paths"in e)Are(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let qVe=0;const I7=Ge.getLogger("esri.layers.graphics.sources.MemorySource");let Q1=class extends d0.LoadableMixin(oE(zg(kt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=L(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var e;const t=(e=this.layer)==null?void 0:e.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);K6(e,this.layer.spatialReference,i);const r=Iw.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const a=n.attributes[s],l=this._idToClientGraphic.get(a);l&&(n.geometry=l.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new Se("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return K6(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:ki.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new Se("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=y=>"objectId"in y&&y.objectId!=null?y.objectId:"attributes"in y&&y.attributes[t]!=null?y.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const y of e.deleteFeatures){const b=n(y);b!=null&&r.push(b)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const y of e.updateFeatures)if(s.push(this._serializeFeature(y)),a){const b=n(y);b!=null&&a.set(b,y)}}jVe(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:p}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=l,i&&i.finish(p.uidToObjectId),this._updateClientGraphicIds(a,p),this._createEditsResult(p)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||J(e))return;const i=[];for(const{geometry:r}of e)!L(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new Se("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const a=e[n],l=this._serializeFeature(a);!r&&L(a.geometry)&&(r=a.geometry.type),i[n]=l,t.set(`${l.uid}`,a)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const a=s.sourceJSON.objectIdField;for(const l in n){const p=n[l],y=t.get(l);y&&(y.attributes||(y.attributes={}),p===-1?delete y.attributes[a]:y.attributes[a]=p,s._addIdToClientGraphic(y))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(e=(t=this.layer)==null?void 0:t.geometryType)!=null?e:(i=this.sourceJSON)==null?void 0:i.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(qVe++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return J(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Fa.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await V0e("MemorySourceWorker",{strategy:je("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const p=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",A=>{I7.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),A.preventDefault()}));const y={features:p.features,fields:t&&t.map(A=>A.toJSON()),geometryType:Qee.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},b=await this._connection.invoke("load",y,{signal:e});for(const A of b.warnings)I7.warn(A.message,{layer:this.layer,warning:A});b.featureErrors.length&&I7.warn(`Encountered ${b.featureErrors.length} validation errors while loading features`,b.featureErrors);const x=b.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(p.inferredGeometryType)&&(x.geometryType=Qee.toJSON(p.inferredGeometryType)),this.sourceJSON=x,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),p.finish(b.assignedObjectIds)}};_([rW({Type:gl,ensureType:Ys(gl)})],Q1.prototype,"itemType",void 0),_([S()],Q1.prototype,"type",void 0),_([S({constructOnly:!0})],Q1.prototype,"layer",void 0),_([S({readOnly:!0})],Q1.prototype,"workerGeometryType",null),_([S()],Q1.prototype,"sourceJSON",void 0),Q1=_([re("esri.layers.graphics.sources.MemorySource")],Q1);const Mre=Q1;function WVe(e){return"portalItem"in e}const XVe=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):WVe(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return _([S({type:String})],t.prototype,"apiKey",null),t=_([re("esri.layers.mixins.APIKeyMixin")],t),t},Yye={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Jye=Object.values(Yye),Zye=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Jye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),YVe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Jye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),JVe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function zTt(e){return!!Zye.test(e)}function ZO(e){const t=Gn(e),i=t.path.match(Zye)||t.path.match(YVe);if(!i)return null;const[,r,s,n,a]=i,l=s.indexOf("/");return{title:IY(l!==-1?s.slice(l+1):s),serverType:Yye[n.toLowerCase()],sublayer:a!=null&&a!==""?parseInt(a,10):null,url:{path:r}}}function ZVe(e){const t=Gn(e).path.match(JVe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function IY(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function KVe(e,t){const i=[];if(e){const r=ZO(e);L(r)&&r.title&&i.push(r.title)}if(t){const r=IY(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().indexOf(i[1].toLowerCase())!==-1)return i[0];if(i[1].toLowerCase().indexOf(i[0].toLowerCase())!==-1)return i[1]}return i.join(" - ")}function Kye(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).indexOf(t)!==-1,a=e.indexOf(i)!==-1||e.indexOf(r)!==-1||e.indexOf(s)!==-1;return n&&a}function QVe(e,t){return e&&wpe(xpe(e,t))}function eGe(e){let{url:t}=e;if(!t)return{url:t};t=xpe(t,e.logger);const i=Gn(t),r=ZO(i.path);let s;if(L(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=ZVe(i.path);L(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:wpe(t),layerId:s}}function tGe(e,t,i,r,s){wv(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=ih(r.url,i,e.layerId.toString()))}function BTt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.indexOf("/services/")!==-1,r=t.indexOf("/mapserver/wmsserver")!==-1,s=t.indexOf("/imageserver/wmsserver")!==-1,n=t.indexOf("/wmsserver")!==-1;return i&&(r||s||n)}const iGe=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=ZO(this.url);if(L(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",QVe(i,Ge.getLogger(this.declaredClass)))}};return _([S()],t.prototype,"title",null),_([S({type:String})],t.prototype,"url",null),t=_([re("esri.layers.mixins.ArcGISService")],t),t};function KO(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function rGe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sGe(e,t,i,r,s,n,a,l,p,y,b,x,A,M,P,$){const k=new Float32Array(16);return k[0]=e,k[1]=t,k[2]=i,k[3]=r,k[4]=s,k[5]=n,k[6]=a,k[7]=l,k[8]=p,k[9]=y,k[10]=b,k[11]=x,k[12]=A,k[13]=M,k[14]=P,k[15]=$,k}function nGe(e,t){return new Float32Array(e,t,16)}const oGe=KO();Object.freeze({__proto__:null,create:KO,clone:rGe,fromValues:sGe,createView:nGe,IDENTITY:oGe});const aGe=(e,t)=>{const i=C0(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return oc(i,i)},lGe=(e,t)=>{const i=C0(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return oc(i,i)},cGe=(e,t)=>{const i=1-t,r=C0(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return oc(r,r)},hGe=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=C0(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return oc(s,s)},uGe=(e,t)=>{const i=1-2*t,r=C0(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return oc(r,r)},dGe=(e,t)=>{const i=C0(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return oc(i,i)},pGe=(e,t)=>{const i=1-t,r=C0(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return oc(r,r)};class SN{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=Nc(t.strength,i.strength,r),this.radius=Nc(t.radius,i.radius,r),this.threshold=Nc(t.threshold,i.threshold,r)}clone(){return new SN(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:MM(this.radius),strength:this.strength,threshold:this.threshold}}}class EN{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(Nc(t.radius,i.radius,r))}clone(){return new EN(this.radius)}toJSON(){return{type:"blur",radius:MM(this.radius)}}}class ER{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=Nc(t.amount,i.amount,r),this._updateMatrix()}clone(){return new ER(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||KO();switch(this.type){case"brightness":this._colorMatrix=aGe(t,this.amount);break;case"contrast":this._colorMatrix=lGe(t,this.amount);break;case"grayscale":this._colorMatrix=cGe(t,this.amount);break;case"invert":this._colorMatrix=uGe(t,this.amount);break;case"saturate":this._colorMatrix=dGe(t,this.amount);break;case"sepia":this._colorMatrix=pGe(t,this.amount)}}}class AN{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=Nc(t.offsetX,i.offsetX,r),this.offsetY=Nc(t.offsetY,i.offsetY,r),this.blurRadius=Nc(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Nc(t.color[0],i.color[0],r)),this.color[1]=Math.round(Nc(t.color[1],i.color[1],r)),this.color[2]=Math.round(Nc(t.color[2],i.color[2],r)),this.color[3]=Nc(t.color[3],i.color[3],r)}clone(){return new AN(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:MM(this.offsetX),yoffset:MM(this.offsetY),blurRadius:MM(this.blurRadius),color:t}}}class CN{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=Nc(t.angle,i.angle,r),this._updateMatrix()}clone(){return new CN(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||KO();this._colorMatrix=hGe(t,this.angle)}}class MN{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=Nc(t.amount,i.amount,r)}clone(){return new MN(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Nc(e,t,i){return e+(t-e)*i}function MM(e){return Math.round(1e3*Fp(e))/1e3}function fGe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new ER(e.type,0);case"saturate":case"brightness":case"contrast":return new ER(e.type,1);case"opacity":return new MN(1);case"hue-rotate":return new CN(0);case"blur":return new EN(0);case"drop-shadow":return new AN(0,0,0,[...Hq("transparent")]);case"bloom":return new SN(0,0,1)}}var VTt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function GTt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function jTt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function mGe(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function gGe(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(fGe(i[s]))}function yGe(e){const t=e[0];return!!t&&"type"in t}var Rre,Ore,Qye={exports:{}};function eve(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=Pre(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new Se("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Pre(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!mGe(t[i].effects,t[i+1].effects))throw new Se("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});gGe(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function Pre(e){let t;if(!e)return[];try{t=Qye.exports.parse(e)}catch(i){throw new Se("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>vGe(i))}function vGe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return _Ge(e);case"opacity":return bGe(e);case"hue-rotate":return wGe(e);case"blur":return xGe(e);case"drop-shadow":return TGe(e);case"bloom":return SGe(e)}}catch(t){throw t.details.filter=e,t}throw new Se("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function _Ge(e){let t=1;return TE(e.parameters,1),e.parameters.length===1&&(t=cp(e.parameters[0])),new ER(e.name,t)}function bGe(e){let t=1;return TE(e.parameters,1),e.parameters.length===1&&(t=cp(e.parameters[0])),new MN(t)}function wGe(e){let t=0;return TE(e.parameters,1),e.parameters.length===1&&(t=OGe(e.parameters[0])),new CN(t)}function xGe(e){let t=0;return TE(e.parameters,1),e.parameters.length===1&&(t=LY(e.parameters[0]),QO(t,e.parameters[0])),new EN(t)}function TGe(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new Se("effect:type-error","Accepts only one color",{});i=PGe(r)}else{const s=LY(r);if(Object.isFrozen(t))throw new Se("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&QO(s,r)}if(t.length<2||t.length>3)throw new Se("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new AN(t[0],t[1],t[2]||0,i||tve("black"))}function SGe(e){let t=1,i=0,r=0;return TE(e.parameters,3),e.parameters[0]&&(t=cp(e.parameters[0])),e.parameters[1]&&(i=LY(e.parameters[1]),QO(i,e.parameters[1])),e.parameters[2]&&(r=cp(e.parameters[2])),new SN(t,i,r)}function TE(e,t){if(e.length>t)throw new Se("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function RN(e){if(e.type==="color")return"<color>";if(e.unit){if(DY[e.unit])return"<length>";if($Y[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function QO(e,t){if(e<0)throw new Se("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function EGe(e){if(e.type!=="quantity"||e.unit!==null)throw new Se("effect:type-error",`Expected <double>, Actual: ${RN(e)}`,{term:e})}function AGe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new Se("effect:type-error",`Expected <double> or <percentage>, Actual: ${RN(e)}`,{term:e})}Ore=function(){function e(s,n){function a(){this.constructor=s}a.prototype=n.prototype,s.prototype=new a}function t(s,n,a,l){var p=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(p,t.prototype),p.expected=n,p.found=a,p.location=l,p.name="SyntaxError",p}function i(s,n,a){return a=a||" ",s.length>n?s:(n-=s.length,s+(a+=a.repeat(n)).slice(0,n))}function r(s,n){var a,l={},p=(n=n!==void 0?n:{}).grammarSource,y={start:Ri},b=Ri,x="none",A=")",M=",",P="(",$="%",k="px",z="cm",G="mm",B="in",W="pt",q="pc",X="deg",oe="rad",de="grad",he="turn",fe="#",me=".",ge="e",Ce=/^[ \t\n\r]/,Ae=/^[a-z\-]/,Pe=/^[0-9a-fA-F]/,De=/^[+\-]/,ne=/^[0-9]/,pe=Zi("none"),ye=qt("none",!1),we=qt(")",!1),Ee=qt(",",!1),Ie=Zi("whitespace"),xe=ri([" ","	",`
`,"\r"],!1,!1),$e=Zi("function"),et=qt("(",!1),ct=Zi("identifier"),Mt=ri([["a","z"],"-"],!1,!1),at=Zi("percentage"),nt=qt("%",!1),dt=Zi("length"),xt=qt("px",!1),wr=qt("cm",!1),vs=qt("mm",!1),ji=qt("in",!1),ae=qt("pt",!1),sr=qt("pc",!1),Bs=Zi("angle"),Hi=qt("deg",!1),Os=qt("rad",!1),li=qt("grad",!1),vl=qt("turn",!1),Jn=Zi("number"),_l=Zi("color"),Xp=qt("#",!1),Qv=ri([["0","9"],["a","f"],["A","F"]],!1,!1),e1=ri(["+","-"],!1,!1),ft=ri([["0","9"]],!1,!1),f=qt(".",!1),N=qt("e",!1),T=function(){return[]},d=function(Me,Qe){return{type:"function",name:Me,parameters:Qe||[]}},h=function(Me,Qe){return Qe.length>0?lF(Me,Qe,3):[Me]},o=function(Me){return{type:"quantity",value:Me.value,unit:Me.unit}},c=function(Me){return{type:"color",colorType:Me.type,value:Me.value}},u=function(Me){return Me},m=function(){return pt()},g=function(Me){return{value:Me,unit:"%"}},v=function(Me){return{value:Me,unit:"px"}},w=function(Me){return{value:Me,unit:"cm"}},E=function(Me){return{value:Me,unit:"mm"}},C=function(Me){return{value:Me,unit:"in"}},R=function(Me){return{value:Me,unit:"pt"}},I=function(Me){return{value:Me,unit:"pc"}},F=function(Me){return{value:Me,unit:"deg"}},U=function(Me){return{value:Me,unit:"rad"}},j=function(Me){return{value:Me,unit:"grad"}},ee=function(Me){return{value:Me,unit:"turn"}},te=function(Me){return{value:Me,unit:null}},Z=function(){return{type:"hex",value:pt()}},le=function(Me){return{type:"function",value:Me}},ve=function(){return{type:"named",value:pt()}},be=function(){return parseFloat(pt())},ue=0,Le=0,Be=[{line:1,column:1}],it=0,Ke=[],Je=0;if("startRule"in n){if(!(n.startRule in y))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');b=y[n.startRule]}function pt(){return s.substring(Le,ue)}function qt(Me,Qe){return{type:"literal",text:Me,ignoreCase:Qe}}function ri(Me,Qe,ut){return{type:"class",parts:Me,inverted:Qe,ignoreCase:ut}}function Ji(){return{type:"end"}}function Zi(Me){return{type:"other",description:Me}}function an(Me){var Qe,ut=Be[Me];if(ut)return ut;for(Qe=Me-1;!Be[Qe];)Qe--;for(ut={line:(ut=Be[Qe]).line,column:ut.column};Qe<Me;)s.charCodeAt(Qe)===10?(ut.line++,ut.column=1):ut.column++,Qe++;return Be[Me]=ut,ut}function Br(Me,Qe){var ut=an(Me),zi=an(Qe);return{source:p,start:{offset:Me,line:ut.line,column:ut.column},end:{offset:Qe,line:zi.line,column:zi.column}}}function Rt(Me){ue<it||(ue>it&&(it=ue,Ke=[]),Ke.push(Me))}function gr(Me,Qe,ut){return new t(t.buildMessage(Me,Qe),Me,Qe,ut)}function Ri(){var Me;return(Me=Ps())===l&&(Me=rs()),Me}function Ps(){var Me,Qe;return Je++,Me=ue,bi(),s.substr(ue,4)===x?(Qe=x,ue+=4):(Qe=l,Je===0&&Rt(ye)),Qe!==l?(bi(),Le=Me,Me=T()):(ue=Me,Me=l),Je--,Me===l&&Je===0&&Rt(pe),Me}function rs(){var Me,Qe;if(Me=[],(Qe=Js())!==l)for(;Qe!==l;)Me.push(Qe),Qe=Js();else Me=l;return Me}function Js(){var Me,Qe,ut,zi;return Me=ue,bi(),(Qe=t1())!==l?(bi(),(ut=Xi())===l&&(ut=null),bi(),s.charCodeAt(ue)===41?(zi=A,ue++):(zi=l,Je===0&&Rt(we)),zi!==l?(bi(),Le=Me,Me=d(Qe,ut)):(ue=Me,Me=l)):(ue=Me,Me=l),Me}function Xi(){var Me,Qe,ut,zi,Eo,Zs,dc,zw;if(Me=ue,(Qe=Zn())!==l){for(ut=[],zi=ue,Eo=bi(),s.charCodeAt(ue)===44?(Zs=M,ue++):(Zs=l,Je===0&&Rt(Ee)),Zs===l&&(Zs=null),dc=bi(),(zw=Zn())!==l?zi=Eo=[Eo,Zs,dc,zw]:(ue=zi,zi=l);zi!==l;)ut.push(zi),zi=ue,Eo=bi(),s.charCodeAt(ue)===44?(Zs=M,ue++):(Zs=l,Je===0&&Rt(Ee)),Zs===l&&(Zs=null),dc=bi(),(zw=Zn())!==l?zi=Eo=[Eo,Zs,dc,zw]:(ue=zi,zi=l);Le=Me,Me=h(Qe,ut)}else ue=Me,Me=l;return Me}function Zn(){var Me,Qe;return Me=ue,(Qe=i1())===l&&(Qe=e_())===l&&(Qe=sF())===l&&(Qe=nF()),Qe!==l&&(Le=Me,Qe=o(Qe)),(Me=Qe)===l&&(Me=ue,(Qe=oF())!==l&&(Le=Me,Qe=c(Qe)),Me=Qe),Me}function bi(){var Me,Qe;for(Je++,Me=[],Ce.test(s.charAt(ue))?(Qe=s.charAt(ue),ue++):(Qe=l,Je===0&&Rt(xe));Qe!==l;)Me.push(Qe),Ce.test(s.charAt(ue))?(Qe=s.charAt(ue),ue++):(Qe=l,Je===0&&Rt(xe));return Je--,Qe=l,Je===0&&Rt(Ie),Me}function t1(){var Me,Qe,ut;return Je++,Me=ue,(Qe=F0())!==l?(s.charCodeAt(ue)===40?(ut=P,ue++):(ut=l,Je===0&&Rt(et)),ut!==l?(Le=Me,Me=u(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Je--,Me===l&&(Qe=l,Je===0&&Rt($e)),Me}function F0(){var Me,Qe,ut;if(Je++,Me=ue,Qe=[],Ae.test(s.charAt(ue))?(ut=s.charAt(ue),ue++):(ut=l,Je===0&&Rt(Mt)),ut!==l)for(;ut!==l;)Qe.push(ut),Ae.test(s.charAt(ue))?(ut=s.charAt(ue),ue++):(ut=l,Je===0&&Rt(Mt));else Qe=l;return Qe!==l&&(Le=Me,Qe=m()),Je--,(Me=Qe)===l&&(Qe=l,Je===0&&Rt(ct)),Me}function i1(){var Me,Qe,ut;return Je++,Me=ue,bi(),(Qe=uc())!==l?(s.charCodeAt(ue)===37?(ut=$,ue++):(ut=l,Je===0&&Rt(nt)),ut!==l?(Le=Me,Me=g(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Je--,Me===l&&Je===0&&Rt(at),Me}function e_(){var Me,Qe,ut;return Je++,Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===k?(ut=k,ue+=2):(ut=l,Je===0&&Rt(xt)),ut!==l?(Le=Me,Me=v(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===z?(ut=z,ue+=2):(ut=l,Je===0&&Rt(wr)),ut!==l?(Le=Me,Me=w(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===G?(ut=G,ue+=2):(ut=l,Je===0&&Rt(vs)),ut!==l?(Le=Me,Me=E(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===B?(ut=B,ue+=2):(ut=l,Je===0&&Rt(ji)),ut!==l?(Le=Me,Me=C(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===W?(ut=W,ue+=2):(ut=l,Je===0&&Rt(ae)),ut!==l?(Le=Me,Me=R(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,bi(),(Qe=uc())!==l?(s.substr(ue,2)===q?(ut=q,ue+=2):(ut=l,Je===0&&Rt(sr)),ut!==l?(Le=Me,Me=I(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l)))))),Je--,Me===l&&Je===0&&Rt(dt),Me}function sF(){var Me,Qe,ut;return Je++,Me=ue,(Qe=uc())!==l?(s.substr(ue,3)===X?(ut=X,ue+=3):(ut=l,Je===0&&Rt(Hi)),ut!==l?(Le=Me,Me=F(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,(Qe=uc())!==l?(s.substr(ue,3)===oe?(ut=oe,ue+=3):(ut=l,Je===0&&Rt(Os)),ut!==l?(Le=Me,Me=U(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,(Qe=uc())!==l?(s.substr(ue,4)===de?(ut=de,ue+=4):(ut=l,Je===0&&Rt(li)),ut!==l?(Le=Me,Me=j(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l),Me===l&&(Me=ue,(Qe=uc())!==l?(s.substr(ue,4)===he?(ut=he,ue+=4):(ut=l,Je===0&&Rt(vl)),ut!==l?(Le=Me,Me=ee(Qe)):(ue=Me,Me=l)):(ue=Me,Me=l)))),Je--,Me===l&&(Qe=l,Je===0&&Rt(Bs)),Me}function nF(){var Me,Qe;return Je++,Me=ue,bi(),(Qe=uc())!==l?(Le=Me,Me=te(Qe)):(ue=Me,Me=l),Je--,Me===l&&Je===0&&Rt(Jn),Me}function oF(){var Me,Qe,ut,zi;if(Je++,Me=ue,s.charCodeAt(ue)===35?(Qe=fe,ue++):(Qe=l,Je===0&&Rt(Xp)),Qe!==l){if(ut=[],Pe.test(s.charAt(ue))?(zi=s.charAt(ue),ue++):(zi=l,Je===0&&Rt(Qv)),zi!==l)for(;zi!==l;)ut.push(zi),Pe.test(s.charAt(ue))?(zi=s.charAt(ue),ue++):(zi=l,Je===0&&Rt(Qv));else ut=l;ut!==l?(Le=Me,Me=Z()):(ue=Me,Me=l)}else ue=Me,Me=l;return Me===l&&(Me=ue,(Qe=Js())!==l&&(Le=Me,Qe=le(Qe)),(Me=Qe)===l&&(Me=ue,(Qe=F0())!==l&&(Le=Me,Qe=ve()),Me=Qe)),Je--,Me===l&&(Qe=l,Je===0&&Rt(_l)),Me}function uc(){var Me,Qe,ut,zi,Eo,Zs,dc;for(Me=ue,De.test(s.charAt(ue))?(s.charAt(ue),ue++):Je===0&&Rt(e1),Qe=ue,ut=[],ne.test(s.charAt(ue))?(zi=s.charAt(ue),ue++):(zi=l,Je===0&&Rt(ft));zi!==l;)ut.push(zi),ne.test(s.charAt(ue))?(zi=s.charAt(ue),ue++):(zi=l,Je===0&&Rt(ft));if(s.charCodeAt(ue)===46?(zi=me,ue++):(zi=l,Je===0&&Rt(f)),zi!==l){if(Eo=[],ne.test(s.charAt(ue))?(Zs=s.charAt(ue),ue++):(Zs=l,Je===0&&Rt(ft)),Zs!==l)for(;Zs!==l;)Eo.push(Zs),ne.test(s.charAt(ue))?(Zs=s.charAt(ue),ue++):(Zs=l,Je===0&&Rt(ft));else Eo=l;Eo!==l?Qe=ut=[ut,zi,Eo]:(ue=Qe,Qe=l)}else ue=Qe,Qe=l;if(Qe===l)if(Qe=[],ne.test(s.charAt(ue))?(ut=s.charAt(ue),ue++):(ut=l,Je===0&&Rt(ft)),ut!==l)for(;ut!==l;)Qe.push(ut),ne.test(s.charAt(ue))?(ut=s.charAt(ue),ue++):(ut=l,Je===0&&Rt(ft));else Qe=l;if(Qe!==l){if(ut=ue,s.charCodeAt(ue)===101?(zi=ge,ue++):(zi=l,Je===0&&Rt(N)),zi!==l){if(De.test(s.charAt(ue))?(Eo=s.charAt(ue),ue++):(Eo=l,Je===0&&Rt(e1)),Eo===l&&(Eo=null),Zs=[],ne.test(s.charAt(ue))?(dc=s.charAt(ue),ue++):(dc=l,Je===0&&Rt(ft)),dc!==l)for(;dc!==l;)Zs.push(dc),ne.test(s.charAt(ue))?(dc=s.charAt(ue),ue++):(dc=l,Je===0&&Rt(ft));else Zs=l;Zs!==l?ut=zi=[zi,Eo,Zs]:(ue=ut,ut=l)}else ue=ut,ut=l;ut===l&&(ut=null),Le=Me,Me=be()}else ue=Me,Me=l;return Me}function aF(Me,Qe){return Me.map(function(ut){return ut[Qe]})}function lF(Me,Qe,ut){return[Me].concat(aF(Qe,ut))}if((a=b())!==l&&ue===s.length)return a;throw a!==l&&ue<s.length&&Rt(Ji()),gr(Ke,it<s.length?s.charAt(it):null,it<s.length?Br(it,it+1):Br(it,it))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var a,l=null;for(a=0;a<s.length;a++)if(s[a].source===this.location.source){l=s[a].text.split(/\r\n|\n|\r/g);break}var p=this.location.start,y=this.location.source+":"+p.line+":"+p.column;if(l){var b=this.location.end,x=i("",p.line.toString().length),A=l[p.line-1],M=p.line===b.line?b.column:A.length+1;n+=`
 --> `+y+`
`+x+` |
`+p.line+" | "+A+`
`+x+" | "+i("",p.column-1)+i("",M-p.column,"^")}else n+=`
 at `+y}return n},t.buildMessage=function(s,n){var a={literal:function(M){return'"'+p(M.text)+'"'},class:function(M){var P=M.parts.map(function($){return Array.isArray($)?y($[0])+"-"+y($[1]):y($)});return"["+(M.inverted?"^":"")+P+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(M){return M.description}};function l(M){return M.charCodeAt(0).toString(16).toUpperCase()}function p(M){return M.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+l(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+l(P)})}function y(M){return M.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+l(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+l(P)})}function b(M){return a[M.type](M)}function x(M){var P,$,k=M.map(b);if(k.sort(),k.length>0){for(P=1,$=1;P<k.length;P++)k[P-1]!==k[P]&&(k[$]=k[P],$++);k.length=$}switch(k.length){case 1:return k[0];case 2:return k[0]+" or "+k[1];default:return k.slice(0,-1).join(", ")+", or "+k[k.length-1]}}function A(M){return M?'"'+p(M)+'"':"end of input"}return"Expected "+x(s)+" but "+A(n)+" found."},{SyntaxError:t,parse:r}},(Rre=Qye).exports&&(Rre.exports=Ore());const $Y={deg:1,grad:.9,rad:180/Math.PI,turn:360};function CGe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&$Y[e.unit]!=null))throw new Se("effect:type-error",`Expected <angle>, Actual: ${RN(e)}`,{term:e})}const DY={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function MGe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&DY[e.unit]!=null))throw new Se("effect:type-error",`Expected <length>, Actual: ${RN(e)}`,{term:e})}function cp(e){AGe(e);const t=e.value;return QO(t,e),e.unit==="%"?.01*t:t}function RGe(e){return EGe(e),QO(e.value,e),e.value}function OGe(e){return CGe(e),e.value*$Y[e.unit]||0}function LY(e){return MGe(e),e.value*DY[e.unit]||0}function PGe(e){switch(e.colorType){case"hex":return FRe(e.value);case"named":return tve(e.value);case"function":return DGe(e.value)}}function tve(e){if(!Que(e))throw new Se("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return NRe(e)}const IGe=/^rgba?/i,$Ge=/^hsla?/i;function DGe(e){if(TE(e.parameters,4),IGe.test(e.name))return[cp(e.parameters[0]),cp(e.parameters[1]),cp(e.parameters[2]),e.parameters[3]?cp(e.parameters[3]):1];if($Ge.test(e.name))return ede(RGe(e.parameters[0]),cp(e.parameters[1]),cp(e.parameters[2]),e.parameters[3]?cp(e.parameters[3]):1);throw new Se("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function fj(e,t,i){try{return NGe(e)}catch(s){var r;i==null||(r=i.messages)==null||r.push(s)}return null}function mj(e,t,i,r){try{const s=LGe(e);Kh(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function LGe(e){const t=eve(e);return t?yGe(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function NGe(e){if(!e||e.length===0)return null;if(FGe(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:Ire(i.value)});return t}return Ire(e)}function FGe(e){const t=e[0];return!!t&&"scale"in t}function Ire(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[B0(i,"amount")];break;case"blur":r=[B0(i,"radius","pt")];break;case"hue-rotate":r=[B0(i,"angle","deg")];break;case"drop-shadow":r=[B0(i,"xoffset","pt"),B0(i,"yoffset","pt"),B0(i,"blurRadius","pt"),kGe(i,"color")];break;case"bloom":r=[B0(i,"strength"),B0(i,"radius","pt"),B0(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;eve(s),t.push(s)}return t.join(" ")}function B0(e,t,i){if(e[t]==null)throw new Se("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function kGe(e,t){if(e[t]==null)throw new Se("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const ive=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return _([S({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),_([S({json:{read:!1,write:!1,origins:{"web-map":{read:{reader:fj},write:{allowNull:!0,writer:mj}}}}})],t.prototype,"effect",void 0),t=_([re("esri.layers.mixins.BlendLayer")],t),t},UGe=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return _([S({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=_([re("esri.layers.mixins.CustomParametersMixin")],t),t};var gj;const $7=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),D7=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Cf=gj=class extends Ye{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:a,distance:l}=this;return new ql(ie({geometry:Fe(i),objectIds:Fe(n),spatialRelationship:r,timeExtent:Fe(s),where:t,units:a,distance:l},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:a}=this;return new gj({geometry:Fe(t),objectIds:Fe(s),spatialRelationship:i,timeExtent:Fe(r),where:e,units:n,distance:a})}};_([S({type:String,json:{write:!0}})],Cf.prototype,"where",void 0),_([S({types:Sw,json:{write:!0}})],Cf.prototype,"geometry",void 0),_([S({type:$7.apiValues,json:{name:"spatialRel",read:{reader:$7.read},write:{allowNull:!1,writer:$7.write,overridePolicy(){return{enabled:L(this.geometry)}}}}})],Cf.prototype,"spatialRelationship",void 0),_([S({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Cf.prototype,"distance",void 0),_([S({type:[Number],json:{write:!0}})],Cf.prototype,"objectIds",void 0),_([S({type:D7.apiValues,json:{read:D7.read,write:{writer:D7.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Cf.prototype,"units",void 0),_([S({type:R0,json:{write:!0}})],Cf.prototype,"timeExtent",void 0),Cf=gj=_([re("esri.layers.support.FeatureFilter")],Cf);const zGe=Cf;var yj;let db=yj=class extends Ye{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const i=super.write(e,t);if(t!=null&&t.origin){if(i.filter){const n=Object.keys(i.filter);var r;if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new Se("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}var s;if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new Se("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new yj({filter:L(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};_([S({type:zGe,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?Kh(i,s,t):Kh(i,null,t)}}}})],db.prototype,"filter",void 0),_([S({json:{write:!0,origins:{"web-map":{read:{reader:fj},write:{writer:mj,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}}}}})],db.prototype,"includedEffect",void 0),_([S({json:{write:!0,origins:{"web-map":{read:{reader:fj},write:{writer:mj,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}}}}})],db.prototype,"excludedEffect",void 0),_([S({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":{name:"showExcludedLabels",default:!0}}}})],db.prototype,"excludedLabelsVisible",void 0),db=yj=_([re("esri.layers.support.FeatureEffect")],db);const BGe=db,VGe=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return _([S({type:BGe,json:{origins:{"web-map":{write:{allowNull:!0}}}}})],t.prototype,"featureEffect",void 0),t=_([re("esri.layers.mixins.FeatureEffectLayer")],t),t},GGe={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function jGe(e){if(!e)return e;const{start:t,end:i}=e;return new R0({start:L(t)?C2(t,-t.getTimezoneOffset(),"minutes"):t,end:L(i)?C2(i,-i.getTimezoneOffset(),"minutes"):i})}function HGe(e){if(!e)return e;const{start:t,end:i}=e;return new R0({start:L(t)?C2(t,t.getTimezoneOffset(),"minutes"):t,end:L(i)?C2(i,i.getTimezoneOffset(),"minutes"):i})}var vj;let PC=vj=class extends Ye{async collectRequiredFields(e,t){return eu(e,t,this.expression)}clone(){return new vj({expression:this.expression,title:this.title})}};_([S({type:String,json:{write:!0}})],PC.prototype,"expression",void 0),_([S({type:String,json:{write:!0}})],PC.prototype,"title",void 0),PC=vj=_([re("esri.layers.support.FeatureExpressionInfo")],PC);const $re=PC;function qGe(e){return xS[e]!=null}function rve(e){return 1/(xS[e]||1)}function WGe(){const e=Object.keys(xS);return e.sort(),e}const XGe=WGe();var _j;const C5=Va()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Dre=new Ui({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let bm=_j=class extends Ye{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):L(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new _j({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};_([S({type:$re,json:{write:!0}})],bm.prototype,"featureExpressionInfo",void 0),_([wt("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],bm.prototype,"readFeatureExpressionInfo",null),_([Et("featureExpressionInfo",{featureExpressionInfo:{type:$re},"featureExpression.value":{type:[0]}})],bm.prototype,"writeFeatureExpressionInfo",null),_([S({type:C5.apiValues,nonNullable:!0,json:{type:C5.jsonValues,read:C5.read,write:{writer:C5.write,isRequired:!0}}})],bm.prototype,"mode",null),_([S({type:Number,json:{write:!0}})],bm.prototype,"offset",void 0),_([S({type:XGe,json:{type:String,read:Dre.read,write:Dre.write}})],bm.prototype,"unit",null),bm=_j=_([re("esri.layers.support.ElevationInfo")],bm);const sve=bm,YGe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},nve={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},ove={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},JGe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:wv}}},ZGe={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},KGe={value:null,type:sve,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function HTt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const F9={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},QGe=qe(ie({},F9),{json:qe(ie({},F9.json),{origins:{"web-document":qe(ie({},F9.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?lS(t.layerDefinition.drawingInfo.transparency):void 0:lS(t.drawingInfo.transparency)}})}),qTt={type:R0,readOnly:!0,get(){var e,t;if((e=this.layer)==null||!e.timeInfo)return null;const{datesInUnknownTimezone:i,timeOffset:r,useViewTime:s}=this.layer,n=(t=this.view)==null?void 0:t.timeExtent;let a=this.layer.timeExtent;i&&(a=HGe(a));let l=s?n&&a?n.intersection(a):n||a:a;if(!l||l.isEmpty||l.isAllTime)return l;r&&(l=l.offset(-r.value,r.unit)),i&&(l=jGe(l));const p=this._get("timeExtent");return l.equals(p)?p:l}},WTt={type:ki,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=ki.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=It.fromJSON(t.spatialReference)),i}}}},read:!1}},eje={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},tje={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},ije={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},rje=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&b9e(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),lfe(this,i,s=>super.read(i,s),r)}write(i,r){if(r!=null&&r.origin){const p=`${r.origin}/${r.layerContainerType||"operational-layers"}`,y=GGe[p];let b=y&&y[this.operationalLayerType];var s;if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&p==="web-scene/operational-layers"&&(b=!1),!b)return(s=r.messages)==null||s.push(new Se("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${p}'`,{layer:this})),null}const n=super.write(i,qe(ie({},r),{layer:this})),a=!!r&&!!r.messages&&!!r.messages.filter(p=>p instanceof Se&&p.name==="web-document-write:property-required").length;var l;return eS(n==null?void 0:n.url)?(r==null||(l=r.messages)==null||l.push(new Se("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&a?null:n}beforeSave(){}};return _([S({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),_([S({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),_([Et("listMode")],t.prototype,"writeListMode",null),_([S({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),_([Et("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),_([S(F9)],t.prototype,"opacity",void 0),_([S({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),_([Et("title")],t.prototype,"writeTitle",null),_([S({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=_([re("esri.layers.mixins.OperationalLayer")],t),t};function sje(e){return"operationalLayerType"in e}var bj;const L7=new Ui({asc:"ascending",desc:"descending"});let c3=bj=class extends Ye{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new bj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};_([S({type:String,json:{write:!0}})],c3.prototype,"field",void 0),_([S({type:String,json:{write:!0}})],c3.prototype,"valueExpression",void 0),_([S({type:L7.apiValues,json:{read:L7.read,write:L7.write}})],c3.prototype,"order",void 0),c3=bj=_([re("esri.layers.support.OrderByInfo")],c3);const ave=c3;function nje(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new ave;return s.read(r,i),[s]}function oje(e,t,i,r){const s=e.find(n=>!!n.field);s&&Kh(i,[s.toJSON()],t)}const aje=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return _([S({type:[ave],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:nje},write:{target:"layerDefinition.orderBy",writer:oje}}})],t.prototype,"orderBy",void 0),t=_([re("esri.layers.mixins.OrderedLayer")],t),t},lje=Ge.getLogger("esri.portal.PortalItemResource");let ey=class extends st{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?qe(ie({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){L(e)&&Xh(e)?lje.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(J(i))throw new Se("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Ss(t,"signal")})}async update(e,t){return(await Promise.resolve().then(function(){return aM})).addOrUpdateResource(this,"update",e,t)}hasPath(){return L(this.path)}_normalizePath(e,t){return J(e)?e:(e=e.replace(/^\/+/,""),L(t)&&Xh(e)&&(e=gW(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};_([S()],ey.prototype,"portalItem",void 0),_([S({type:String,value:null})],ey.prototype,"path",null),_([_i("path")],ey.prototype,"_castPath",null),_([S({type:String,readOnly:!0})],ey.prototype,"url",null),_([S({type:String,readOnly:!0})],ey.prototype,"itemRelativeUrl",null),ey=_([re("esri.portal.PortalItemResource")],ey);const cje=ey;let IC=class extends st{constructor(e){super(e),this.created=null,this.rating=null}};_([S()],IC.prototype,"created",void 0),_([S()],IC.prototype,"rating",void 0),IC=_([re("esri.portal.PortalRating")],IC);const N7=IC;var h3;let Wi=h3=class extends DO(d0){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return ZT(h3,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.indexOf("Table")>-1?"Table":t.indexOf("Route Layer")>-1?"Route Layer":t.indexOf("Markup")>-1?"Markup":"Feature Layer":e==="Image Service"?i=t.indexOf("Elevation 3D Layer")>-1?"Elevation Layer":t.indexOf("Tiled Imagery")>-1?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Media Service"?i="Media Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.indexOf("Web Tool")>-1?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.indexOf("Spatiotemporal")===-1&&(t.indexOf("Hosted Service")>-1||t.indexOf("Tiled")>-1)&&t.indexOf("Relational")===-1?"Tile Layer":"Map Image Layer":e&&e.toLowerCase().indexOf("add in")>-1?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.indexOf("configurableApp")>-1&&(i="Instant App"),i}readExtent(e){return e&&e.length?new ki(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,a=!1,l=!1,p=!1,y=!1,b=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.indexOf("Hosted Service")>-1,e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(a=t.indexOf("Table")>-1,l=t.indexOf("Route Layer")>-1,p=t.indexOf("Markup")>-1,y=t.indexOf("Spatiotemporal")!==-1,b=t.indexOf("UtilityNetwork")!==-1,s=y&&a?"spatiotemporaltable":a?"table":l?"routelayer":p?"markup":y?"spatiotemporal":n?"featureshosted":b?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.indexOf("Tiled")>-1||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.indexOf("Line")>-1?"sceneweblayerline":t.indexOf("3DObject")>-1?"sceneweblayermultipatch":t.indexOf("Point")>-1?"sceneweblayerpoint":t.indexOf("IntegratedMesh")>-1?"sceneweblayermesh":t.indexOf("PointCloud")>-1?"sceneweblayerpointcloud":t.indexOf("Polygon")>-1?"sceneweblayerpolygon":t.indexOf("Building")>-1?"sceneweblayerbuilding":t.indexOf("Voxel")>-1?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.indexOf("Elevation 3D Layer")>-1?"elevationlayer":t.indexOf("Tiled Imagery")>-1?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="media service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"&&t.indexOf("Web Tool")>-1&&this.portal&&this.portal.isPortal?"tool":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.indexOf("ViewingMode-Local")>-1?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.indexOf("configurableApp")>-1?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.indexOf("ArcGIS Pro")>-1||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.indexOf("Explorer Mapping Application")>-1||t.indexOf("Document")>-1?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":"maps",s?hr(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].indexOf(this.type)>-1}get itemUrl(){const e=this.get("portal.restUrl");return e?e+"/content/items/"+this.id:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=ha.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:L(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof N7&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new N7({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:Fe(this.applicationProxies),avgRating:this.avgRating,categories:Fe(this.categories),created:Fe(this.created),culture:this.culture,description:this.description,extent:Fe(this.extent),groupCategories:Fe(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Fe(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Fe(this.screenshots),size:this.size,snippet:this.snippet,tags:Fe(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Fe(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new h3({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",qe(ie({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",ie({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new N7(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",ie({query:qe(ie({},e),{token:this.apiKey})},t),h3)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new Se("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")x0(t)?r.query={data:t}:r.query={url:nd(t)},L(i)&&(r.query.filename=i);else{const s=new FormData;L(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new Se("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(function(){return aM})).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Promise.resolve().then(function(){return aM});return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(function(){return aM});if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new Se("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(function(){return aM})).removeAllResources(this,e)}resourceFromPath(e){return new cje({portalItem:this,path:e})}toJSON(){const e=this.extent,t={created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return sue(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new h3({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};_([S({type:["private","shared","org","public"]})],Wi.prototype,"access",void 0),_([S()],Wi.prototype,"accessInformation",void 0),_([S({type:String})],Wi.prototype,"apiKey",void 0),_([S({json:{read:{source:"appProxies"}}})],Wi.prototype,"applicationProxies",void 0),_([S()],Wi.prototype,"avgRating",void 0),_([S()],Wi.prototype,"categories",void 0),_([S({type:Date})],Wi.prototype,"created",void 0),_([S()],Wi.prototype,"culture",void 0),_([S()],Wi.prototype,"description",void 0),_([S({readOnly:!0})],Wi.prototype,"displayName",null),_([S({type:ki})],Wi.prototype,"extent",void 0),_([wt("extent")],Wi.prototype,"readExtent",null),_([S()],Wi.prototype,"groupCategories",void 0),_([S({readOnly:!0})],Wi.prototype,"iconUrl",null),_([S()],Wi.prototype,"id",void 0),_([S({readOnly:!0})],Wi.prototype,"isLayer",null),_([S()],Wi.prototype,"itemControl",void 0),_([S({readOnly:!0})],Wi.prototype,"itemUrl",null),_([S()],Wi.prototype,"licenseInfo",void 0),_([S({type:Date})],Wi.prototype,"modified",void 0),_([S()],Wi.prototype,"name",void 0),_([S()],Wi.prototype,"numComments",void 0),_([S()],Wi.prototype,"numRatings",void 0),_([S()],Wi.prototype,"numViews",void 0),_([S()],Wi.prototype,"owner",void 0),_([S()],Wi.prototype,"ownerFolder",void 0),_([S({type:ha})],Wi.prototype,"portal",void 0),_([S()],Wi.prototype,"screenshots",void 0),_([S()],Wi.prototype,"size",void 0),_([S()],Wi.prototype,"snippet",void 0),_([S()],Wi.prototype,"sourceJSON",void 0),_([S()],Wi.prototype,"tags",void 0),_([S()],Wi.prototype,"thumbnail",void 0),_([S({readOnly:!0})],Wi.prototype,"thumbnailUrl",null),_([S()],Wi.prototype,"title",void 0),_([S()],Wi.prototype,"type",void 0),_([S()],Wi.prototype,"typeKeywords",void 0),_([S()],Wi.prototype,"url",void 0),_([S({readOnly:!0})],Wi.prototype,"userItemUrl",null),Wi=h3=_([re("esri.portal.PortalItem")],Wi);const SS=Wi;var lve=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:SS});const hje=Ge.getLogger("esri.layers.mixins.PortalLayer"),uje=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new SS({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.0df6b1e1.js").then(function(n){return n.l});return Gi(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Cs(s)||hje.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Fg(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?jn==null?void 0:jn.findCredential(this.url):null;if(!r)return!0;const s=M5.credential===r?M5.user:await this._fetchEditingUser(i);return M5.credential=r,M5.user=s,J(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var r,s;const n=(r=this.portalItem)==null||(s=r.portal)==null?void 0:s.user;if(n)return n;const a=jn.findServerInfo(this.url);if(a==null||!a.owningSystemUrl)return null;const l=`${a.owningSystemUrl}/sharing/rest`,p=ha.getDefault();if(p&&p.loaded&&cd(p.restUrl)===cd(l))return p.user;const y=`${l}/community/self`,b=L(i)?i.signal:null,x=await nh(Ar(y,{authMode:"no-prompt",query:{f:"json"},signal:b}));return x.ok?nX.fromJSON(x.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||ha.getDefault());return s&&n&&!ype(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new Se("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,qe(ie({},r),{layer:this}))}};return _([S({type:SS})],t.prototype,"portalItem",null),_([wt("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),_([Et("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),_([S({clonable:!1})],t.prototype,"resourceReferences",void 0),_([S({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=_([re("esri.layers.mixins.PortalLayer")],t),t},M5={credential:null,user:null},AR=new kt,RM=new WeakMap;function dje(e){cve(e)&&AR.push(e)}function pje(e){cve(e)&&AR.includes(e)&&AR.remove(e)}function cve(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function hve(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:hve(t,e%t):0}let F7=0,R5=0;function fje(){const e=Date.now();for(const i of AR)if(i.refreshInterval){var t;e-((t=RM.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(RM.set(i,e),i.refresh(e))}}Oue(()=>{const e=Date.now();let t=0;for(const i of AR)t=hve(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?RM.get(i)||RM.set(i,e):RM.delete(i);if(t!==R5){if(R5=t,clearInterval(F7),R5===0)return void(F7=0);F7=setInterval(fje,R5)}});function mje(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const gje=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=kq(()=>this.hasDataChanged()),this.when().then(()=>{dje(this)},()=>{})}destroy(){pje(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){vz(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{Ge.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return _([S({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),_([S({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),_([S()],t.prototype,"refreshParameters",null),t=_([re("esri.layers.mixins.RefreshableLayer")],t),t},uve=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&yje(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return _([S({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),_([S({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),_([S({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=_([re("esri.layers.mixins.ScaleRangeLayer")],t),t};function yje(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const u2=Va()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var wj;let $C=wj=class extends Ye{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return NFe(this.value,this.unit,"milliseconds")}clone(){return new wj({value:this.value,unit:this.unit})}};_([S({type:Number,json:{write:!0},nonNullable:!0})],$C.prototype,"value",void 0),_([S({type:u2.apiValues,json:{type:u2.jsonValues,read:u2.read,write:u2.write},nonNullable:!0})],$C.prototype,"unit",void 0),$C=wj=_([re("esri.TimeInterval")],$C);const CR=$C;var xj;let u3=xj=class extends Ye{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new xj({respectsDaylightSaving:e,timezone:t})}};_([S({type:Boolean,json:{write:!0}})],u3.prototype,"respectsDaylightSaving",void 0),_([wt("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],u3.prototype,"readRespectsDaylightSaving",null),_([S({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],u3.prototype,"timezone",void 0),u3=xj=_([re("esri.layers.support.TimeReference")],u3);const vje=u3;var Tj;let Za=Tj=class extends Ye{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new R0({start:i,end:r})}writeFullTimeExtent(e,t){e&&L(e.start)&&L(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new CR({value:t.timeInterval,unit:u2.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new CR({value:t.defaultTimeInterval,unit:u2.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:a,trackIdField:l,useTime:p}=this;return new Tj({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:Fe(n),fullTimeExtent:Fe(a),trackIdField:l,useTime:p})}};_([S({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Za.prototype,"cumulative",void 0),_([S({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Za.prototype,"endField",void 0),_([S({type:R0,json:{write:{enabled:!0,allowNull:!0}}})],Za.prototype,"fullTimeExtent",void 0),_([wt("fullTimeExtent",["timeExtent"])],Za.prototype,"readFullTimeExtent",null),_([Et("fullTimeExtent")],Za.prototype,"writeFullTimeExtent",null),_([S({type:Boolean,json:{write:!0}})],Za.prototype,"hasLiveData",void 0),_([S({type:CR,json:{write:{enabled:!0,allowNull:!0}}})],Za.prototype,"interval",void 0),_([wt("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Za.prototype,"readInterval",null),_([Et("interval")],Za.prototype,"writeInterval",null),_([S({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Za.prototype,"startField",void 0),_([S({type:vje,json:{write:{enabled:!0,allowNull:!0}}})],Za.prototype,"timeReference",void 0),_([S({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Za.prototype,"trackIdField",void 0),_([S({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Za.prototype,"useTime",void 0),Za=Tj=_([re("esri.layers.support.TimeInfo")],Za);const dve=Za,_je=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,a=u2.fromJSON(s.timeOffsetUnits);return n&&a?new CR({value:n,unit:a}):null}set timeInfo(i){Ffe(i,this.fieldsIndex),this._set("timeInfo",i)}};return _([S({type:R0,json:{write:!1}})],t.prototype,"timeExtent",void 0),_([S({type:CR})],t.prototype,"timeOffset",void 0),_([wt("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),_([S({value:null,type:dve,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),_([S({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=_([re("esri.layers.mixins.TemporalLayer")],t),t};var Sj;let zm=Sj=class extends Ye{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Sj({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};_([S({constructOnly:!0})],zm.prototype,"name",void 0),_([S({constructOnly:!0})],zm.prototype,"fields",void 0),_([S({constructOnly:!0})],zm.prototype,"isAscending",void 0),_([S({constructOnly:!0})],zm.prototype,"isUnique",void 0),_([S({constructOnly:!0})],zm.prototype,"description",void 0),zm=Sj=_([re("esri.layers.support.FeatureIndex")],zm);let k9=class extends Ye{constructor(){super(...arguments),this.type=null}};_([S({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],k9.prototype,"type",void 0),k9=_([re("esri.layers.support.FeatureReduction")],k9);const U9=k9;var Ej;let d3=Ej=class extends Ye{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new Ej({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};_([S({type:String,json:{write:!0}})],d3.prototype,"statisticType",void 0),_([S({type:String,json:{write:!0}})],d3.prototype,"onStatisticField",void 0),_([S({type:String,json:{write:!0}})],d3.prototype,"onStatisticValueExpression",void 0),d3=Ej=_([re("esri.layers.support.OutStatistic")],d3);const bje=d3;var Aj;let DC=Aj=class extends Ye{constructor(){super(...arguments),this.name=null}clone(){return new Aj({name:this.name,outStatistic:this.outStatistic.clone()})}};_([S({type:String,json:{write:!0}})],DC.prototype,"name",void 0),_([S({type:bje,json:{write:!0}})],DC.prototype,"outStatistic",void 0),DC=Aj=_([re("esri.layers.support.AggregateField")],DC);const wje=DC,NY="__begin__",FY="__end__",xje=new RegExp(NY,"ig"),Tje=new RegExp(FY,"ig"),Lre=new RegExp("^"+NY,"i"),Nre=new RegExp(FY+"$","i"),cD='"',Sje=cD+" + ",Eje=" + "+cD;function Aje(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Cje(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function ON(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=Aje(e.labelExpression),t.type="conventional"),t}function Mje(e){const t=ON(e);if(!t)return null;switch(t.type){case"conventional":return Cj(t.expression);case"arcade":return t.expression}return null}function Rje(e){const t=ON(e);if(!t)return null;switch(t.type){case"conventional":return Pje(t.expression);case"arcade":return kY(t.expression)}return null}function Cj(e){let t;return e?(t=o0(e,i=>NY+'$feature["'+i+'"]'+FY),t=Lre.test(t)?t.replace(Lre,""):cD+t,t=Nre.test(t)?t.replace(Nre,""):t+cD,t=t.replace(xje,Sje).replace(Tje,Eje)):t='""',t}const Oje=/^\s*\{([^}]+)\}\s*$/i;function Pje(e){const t=e.match(Oje);return t&&t[1].trim()||null}const Ije=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,$je=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Dje=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function kY(e){if(!e)return null;let t=Ije.exec(e)||$je.exec(e);return t?t[1]||t[3]:(t=Dje.exec(e),t?t[2]:null)}var Mj;let ty=Mj=class extends Ye{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Cj(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=Cj(this.value)),e!=null&&(t[i]=e)}clone(){return new Mj({expression:this.expression,title:this.title,value:this.value})}};_([S({type:String,json:{write:{writerEnsuresNonNull:!0}}})],ty.prototype,"expression",void 0),_([wt("expression",["expression","value"])],ty.prototype,"readExpression",null),_([Et("expression")],ty.prototype,"writeExpression",null),_([S({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],ty.prototype,"title",void 0),_([S({json:{read:!1,write:!1}})],ty.prototype,"value",void 0),ty=Mj=_([re("esri.layers.support.LabelExpressionInfo")],ty);const pve=ty,fve=[252,146,31,255],XTt=[153,153,153,255],Lje={type:"esriSMS",style:"esriSMSCircle",size:6,color:fve,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Nje={type:"esriSLS",style:"esriSLSSolid",width:.75,color:fve},Fje={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},kje={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Uje={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},zje={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Bje={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Vje=cg.fromJSON(Lje),Gje=tu.fromJSON(Nje),jje=Ag.fromJSON(Fje),Hje=fE.fromJSON(kje);function YTt(e){if(J(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return Vje;case"polyline":return Gje;case"polygon":case"extent":return jje}return null}cg.fromJSON(Uje);tu.fromJSON(zje);Ag.fromJSON(Bje);var Rj;const O5=new Ui({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function mve(e){return!e||e.origin!=="service"&&!gve(e.layer)}function gve(e){return(e==null?void 0:e.type)==="map-image"}function yve(e){var t,i;return!!gve(e)&&!((t=e.capabilities)==null||(i=t.exportMap)==null||!i.supportsArcadeExpressionForLabeling)}function qje(e){return mve(e)||yve(e.layer)}let Ln=Rj=class extends Ye{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Hje,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=function(r,s,n){switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],a=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&a;case"OR":return s||a}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=Cje(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=kY(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&mve(r))e=new pve({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return ON(this)}getLabelExpressionArcade(){return Mje(this)}getLabelExpressionSingleField(){return Rje(this)}hash(){return JSON.stringify(this)}clone(){return new Rj({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Fe(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Fe(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};_([S({type:String,json:{write:!0}})],Ln.prototype,"name",void 0),_([S({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Ln.prototype,"allowOverrun",void 0),_([S({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],Ln.prototype,"deconflictionStrategy",void 0),_([S({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&yve(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ln.prototype,"labelExpression",void 0),_([wt("labelExpression")],Ln.prototype,"readLabelExpression",null),_([Et("labelExpression")],Ln.prototype,"writeLabelExpression",null),_([S({type:pve,json:{write:{overridePolicy:(e,t,i)=>qje(i)?{allowNull:!0}:{enabled:!1}}}})],Ln.prototype,"labelExpressionInfo",void 0),_([Et("labelExpressionInfo")],Ln.prototype,"writeLabelExpressionInfo",null),_([S({type:O5.apiValues,json:{type:O5.jsonValues,read:O5.read,write:O5.write}})],Ln.prototype,"labelPlacement",void 0),_([S({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ln.prototype,"labelPosition",void 0),_([S({type:Number})],Ln.prototype,"maxScale",void 0),_([Et("maxScale")],Ln.prototype,"writeMaxScale",null),_([S({type:Number})],Ln.prototype,"minScale",void 0),_([Et("minScale")],Ln.prototype,"writeMinScale",null),_([S({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ln.prototype,"repeatLabel",void 0),_([S({type:Number,cast:Wr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ln.prototype,"repeatLabelDistance",void 0),_([S({types:mDe,json:{origins:{"web-scene":{types:gDe,write:fre,default:null}},write:fre,default:null}})],Ln.prototype,"symbol",void 0),_([S({type:Boolean,json:{write:!0}})],Ln.prototype,"useCodedValues",void 0),_([S({type:String,json:{write:!0}})],Ln.prototype,"where",void 0),Ln=Rj=_([re("esri.layers.support.LabelClass")],Ln);const UY=Ln;var Oj;let bh=Oj=class extends Ye{constructor(e){super(e),this.type="cluster",this.clusterRadius=Wr("80px"),this.clusterMinSize=Wr("12px"),this.clusterMaxSize=Wr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new Oj({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Fe(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Fe(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Fe(this.popupTemplate)})}};_([S({type:["cluster"],readOnly:!0,json:{write:!0}})],bh.prototype,"type",void 0),_([S({type:Number,cast:e=>e==="auto"?e:Wr(e),json:{write:!0}})],bh.prototype,"clusterRadius",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],bh.prototype,"clusterMinSize",void 0),_([S({type:Number,cast:Wr,json:{write:!0}})],bh.prototype,"clusterMaxSize",void 0),_([S(nve)],bh.prototype,"popupEnabled",void 0),_([S({type:kL,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],bh.prototype,"popupTemplate",void 0),_([S({types:pDe})],bh.prototype,"symbol",void 0),_([S({type:[UY],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],bh.prototype,"labelingInfo",void 0),_([S(ove)],bh.prototype,"labelsVisible",void 0),_([S({type:[wje],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],bh.prototype,"fields",void 0),bh=Oj=_([re("esri.layers.support.FeatureReductionCluster")],bh);const Fre=bh;var Pj;let z9=Pj=class extends U9{constructor(e){super(e),this.type="selection"}clone(){return new Pj}};_([S({type:["selection"]})],z9.prototype,"type",void 0),z9=Pj=_([re("esri.layers.support.FeatureReductionSelection")],z9);const kre=z9,Wje={types:{key:"type",base:U9,typeMap:{selection:kre,cluster:Fre}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:{key:"type",base:U9,typeMap:{selection:Fre}}},"web-scene":{types:{key:"type",base:U9,typeMap:{selection:kre}}}}}},Ure=new Ui({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let iy=class extends T0(Ye){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};_([S({json:{write:!0}})],iy.prototype,"name",void 0),_([S({json:{write:!0}})],iy.prototype,"description",void 0),_([S({json:{read:Ure.read,write:Ure.write}})],iy.prototype,"drawingTool",void 0),_([S({json:{write:!0}})],iy.prototype,"prototype",void 0),_([S({json:{write:!0}})],iy.prototype,"thumbnail",void 0),iy=_([re("esri.layers.support.FeatureTemplate")],iy);const zY=iy;let wm=class extends T0(Ye){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=XX(e[i]);return t}writeDomains(e,t){const i={};for(const s of Object.keys(e)){var r;e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON())}t.domains=i}};_([S({json:{write:!0}})],wm.prototype,"id",void 0),_([S({json:{write:!0}})],wm.prototype,"name",void 0),_([S({json:{write:!0}})],wm.prototype,"domains",void 0),_([wt("domains")],wm.prototype,"readDomains",null),_([Et("domains")],wm.prototype,"writeDomains",null),_([S({type:[zY],json:{write:!0}})],wm.prototype,"templates",void 0),wm=_([re("esri.layers.support.FeatureType")],wm);const vve=wm;function Xje(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function zre(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Bre(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class Yje{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=Vre(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),Xje(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):$L(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),zre(r)||Bre(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)zre(t)||Bre(t)||t.nullable||x$e(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(Vre(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function Vre(e){return e.toLowerCase().trim()}const Jje=Ge.getLogger("esri.layers.support.fieldProperties");function Zje(){return{fields:{type:[VO],value:null},fieldsIndex:{readOnly:!0,get(){return new Yje(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||Jje.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return kfe(this.fieldsIndex,e)}}}}let p3=class extends T0(Ye){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};_([S({type:String,json:{read:{source:"shapeAreaFieldName"}}})],p3.prototype,"shapeAreaField",void 0),_([S({type:String,json:{read:{source:"shapeLengthFieldName"}}})],p3.prototype,"shapeLengthField",void 0),_([S({type:String,json:{read:e=>aLe.read(e)||lLe.read(e)}})],p3.prototype,"units",void 0),p3=_([re("esri.layers.support.GeometryFieldsInfo")],p3);const Kje=p3,Qje=/\[([^\[\]]+)\]/gi;function Gre(e,t,i){return e?e.map(r=>{const s=new UY;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(Qje,(a,l)=>`[${eHe(l,n)}]`)}return s}):null}function eHe(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var Ij;let f3=Ij=class extends Ye{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new kt}clone(){return new Ij({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};_([S({type:String,json:{write:!0}})],f3.prototype,"floorField",void 0),_([S({json:{read:!1,write:!1}})],f3.prototype,"viewAllMode",void 0),_([S({json:{read:!1,write:!1}})],f3.prototype,"viewAllLevelIds",void 0),f3=Ij=_([re("esri.layers.support.LayerFloorInfo")],f3);const tHe=f3,jre=new Ui({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Hre=new Ui({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Mu=class extends T0(Ye){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};_([S({json:{read:jre.read,write:jre.write}})],Mu.prototype,"cardinality",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"composite",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"id",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"keyField",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"keyFieldInRelationshipTable",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"name",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"relatedTableId",void 0),_([S({json:{read:!0,write:!0}})],Mu.prototype,"relationshipTableId",void 0),_([S({json:{read:Hre.read,write:Hre.write}})],Mu.prototype,"role",void 0),Mu=_([re("esri.layers.support.Relationship")],Mu);const iHe=Mu,Jd=[];function rHe(e,t){if(Kye(e.url))return!0;const{wkid:i}=t;for(const r of Jd){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Jd.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102960;t++)e.add(t);return e}]),Jd.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Jd.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Jd.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Jd.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Jd.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Jd.push([10.61,()=>new Set([102497])]),Jd.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Jd.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Jd.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function sHe(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await nh(r.populateFromStyle());if(Gi(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Qh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const nHe=["oid","global-id"],oHe=["oid","global-id","guid"];function aHe({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const a=pHe({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!a.length)return null;const l=gHe({titleBase:s,fields:i,displayField:e}),p=mHe();return new kL({title:l,content:p,fieldInfos:a})}const lHe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],cHe=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!_ve(e.name,t)&&(!i||e.name!==i)&&!(nHe.indexOf(e.type)>-1)&&!lHe.some(s=>s.test(e.name));function hHe(e,t){const i=e;return t&&(e=e.filter(r=>t.indexOf(r.type)===-1)),e===i&&(e=e.slice()),e.sort(uHe),e}function uHe(e,t){return e.type==="oid"?-1:t.type==="oid"?1:qre(e)?-1:qre(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function _ve(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].indexOf(e.toLowerCase())!==-1}function dHe(e,t){return e.editable&&oHe.indexOf(e.type)===-1&&!_ve(e.name,t)}function pHe({editFieldsInfo:e,fields:t,objectIdField:i},r){return hHe(t,(r==null?void 0:r.ignoreFieldTypes)||yHe).map(s=>new FO({fieldName:s.name,isEditable:dHe(s,e),label:s.alias,format:fHe(s),visible:cHe(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function fHe(e){switch(e.type){case"small-integer":case"integer":case"single":return new dM({digitSeparator:!0,places:0});case"double":return new dM({digitSeparator:!0,places:2});case"date":return new dM({dateFormat:"long-month-day-year"});default:return null}}function mHe(){return[new oS,new uR]}function gHe(e){const t=y$e(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function qre(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const yHe=["geometry","blob","raster","guid","xml"],k7=new Ui({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),vHe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Dn="FeatureLayer",Wre=Ge.getLogger("esri.layers.FeatureLayer");function Xre(e){return e&&e instanceof kt}function Ai(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function P5(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function _He(e){var t;const i=e==null||(t=e.supportedSpatialAggregationStatistics)==null?void 0:t.map(r=>r.toLowerCase());return{envelope:!(i==null||!i.includes("envelopeaggregate")),centroid:!(i==null||!i.includes("centroidaggregate")),convexHull:!(i==null||!i.includes("convexhullaggregate"))}}const U7=Zje();function z7(e,t,i){const r=!(i==null||!i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let gt=class extends VGe(ive(aje(_je(uve(gje(iGe(rje(uje(OY(UGe(XVe(T0(JO))))))))))))){constructor(...e){super(...e),this._handles=new Ei,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=It.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(kt.ofType(zm)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Ht(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?ie({url:e},t):e}load(e){const t=L(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Fg).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new Se("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){r!=null&&r.writeLayerSchema&&Kh(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?Gn(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=ih(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=ih(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){ete(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=MVe(r,t,i)||void 0;return s||Wre.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new MY({defaultSymbol:B7(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:B7(s.symbol,s,i)}))}):new CY({symbol:B7(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(Xre(t)&&this._resetMemorySource(t),Xre(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof kt?new Mre({layer:this,items:e}):e:null}readSource(e,t){const i=Iw.fromJSON(t.featureSet);return new Mre({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>zY.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?KVe(this.url,i):i;let n=i;if(!n&&this.url){const a=ZO(this.url);L(a)&&(n=a.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),IY(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=vve.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=eGe({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Wre});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){tGe(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new Se(Dn,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new Se(Dn,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.2b7fe13b.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return aHe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await Fq(import("./FeatureLayerSource.5c7a20f9.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new ql,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:s}=this;return e.timeExtent=r!=null&&s!=null?s.offset(-r.value,r.unit):s||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new Se(Dn,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new Se(Dn,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:a}=n;return a!=null&&(a.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=X6.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new Se(Dn,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:a,start:l,where:p}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const y=r&&r.length>1,b=i&&i.length,x=s&&s.length,A=a&&a.length;if(y||b||x||A||n||l||p)throw new Se(Dn,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||p))throw new Se(Dn,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new Se(Dn,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(ql.from(e)||this.createQuery(),t)).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(ql.from(e)||this.createQuery(),t);throw new Se(Dn,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(ql.from(e)||this.createQuery(),t);throw new Se(Dn,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(ql.from(e)||this.createQuery(),t);throw new Se(Dn,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Z2.from(e),t);throw new Se(Dn,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Z2.from(e),t);throw new Se(Dn,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(Zy.from(e),t).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new Se(Dn,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(Zy.from(e),t);throw new Se(Dn,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(Zy.from(e),t);throw new Se(Dn,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(Zy.from(e),t);throw new Se(Dn,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var i,r;const s=(t=qe(ie({},t),{writeLayerSchema:(i=(r=t)==null?void 0:r.writeLayerSchema)!=null?i:this._hasMemorySource()})).origin,n=t.layerContainerType,a=t.messages;if(this.isTable){if(s==="web-scene"||s==="web-map"&&n!=="tables")return a&&a.push(new Se("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null;if(this._hasMemorySource())return a&&a.push(new Se("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using an in-memory Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&s==="web-map"&&n==="tables")return a&&a.push(new Se("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new Se(Dn,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||rHe(this,e))}_readEditingEnabled(e,t,i){var r;let s=(r=e.layerDefinition)==null?void 0:r.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){if(!e){var s,n;const a=(s=this.capabilities)!=null&&(n=s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";Kh("layerDefinition.capabilities",a,t),!i||r!=null&&r.writeLayerSchema||(t.capabilities=a)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new Se(Dn,`feature is missing the identifying attribute ${i}`)):Promise.reject(new Se(Dn,"'attributes' are required on a feature to query attachments")):Promise.reject(new Se(Dn,"A feature is required to add/delete/update attachments")):Promise.reject(new Se(Dn,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Ar(this.url,{query:qe(ie({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),ete(this.renderer,this.fieldsIndex),Ffe(this.timeInfo,this.fieldsIndex),sHe(this,{origin:"service"})}async hasDataChanged(){var e;if((e=this.source)!=null&&e.refresh)try{var t;const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(L(r)&&(this.sourceJSON=ie(ie({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await OVe(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||this.fields&&this.fields.some(function(t){return t.type==="geometry"})||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new Se("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new Se("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach(i=>{const r=vHe[i.name];r&&(t[r]=!!i.isEnabled)}),t}_readDataCapabilities(e){return{isVersioned:Ai(e,"isDataVersioned",!1),supportsAttachment:Ai(e,"hasAttachments",!1),supportsM:Ai(e,"hasM",!1),supportsZ:Ai(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ai(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=i.includes("editing")&&!t.datesInUnknownTimezone;let s=r&&i.includes("create"),n=r&&i.includes("delete"),a=r&&i.includes("update");const l=i.includes("changetracking");return r&&!(s||n||a)&&(s=n=a=!0),{supportsCalculate:Ai(t,"supportsCalculate",!1),supportsTruncate:Ai(t,"supportsTruncate",!1),supportsValidateSql:Ai(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:n,supportsEditing:r,supportsChangeTracking:l,supportsQuery:i.includes("query"),supportsQueryAttachments:Ai(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Ai(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:a,supportsExceedsLimitStatistics:Ai(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var t;const i=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=(t=this.url)==null?void 0:t.includes("MapServer"),a=!je("mapserver-pbf-enabled")&&n&&this.version<10.81,l=Kye(this.url),p=(e.supportedQueryFormats||"").split(",").reduce((y,b)=>{const x=b.toLowerCase().trim();return x&&y.add(x),y},new Set);return{supportsStatistics:Ai(i,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ai(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ai(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:_He(i),supportsCentroid:Ai(i,"supportsReturningGeometryCentroid",!1),supportsDistance:Ai(i,"supportsQueryWithDistance",!1),supportsDistinct:Ai(i,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ai(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ai(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ai(i,"supportsHavingClause",!1),supportsOrderBy:Ai(i,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ai(i,"supportsPagination",!1),supportsQuantization:Ai(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ai(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ai(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ai(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ai(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ai(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ai(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ai(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ai(r,"allowOthersToQuery",!0),supportsHistoricMoment:Ai(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!a&&p.has("pbf"),supportsDisjointSpatialRelationship:Ai(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ai(i,"supportsQueryWithCacheHint",!1),supportsDefaultSpatialReference:Ai(i,"supportsDefaultSR",!1),supportsCompactGeometry:l,maxRecordCountFactor:P5(e,"maxRecordCountFactor",void 0),maxRecordCount:P5(e,"maxRecordCount",void 0),standardMaxRecordCount:P5(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:P5(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Ai(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ai(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ai(e,"allowGeometryUpdates",!0),supportsGlobalId:Ai(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ai(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ai(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ai(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ai(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ai(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ai(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ai(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ai(t,"allowOthersToUpdate",!0)}}};_([S({readOnly:!0,json:{read:!1}})],gt.prototype,"capabilities",void 0),_([wt("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],gt.prototype,"readCapabilities",null),_([S({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],gt.prototype,"charts",void 0),_([S({readOnly:!0})],gt.prototype,"createQueryVersion",null),_([S({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],gt.prototype,"copyright",void 0),_([S({type:Boolean})],gt.prototype,"datesInUnknownTimezone",void 0),_([S({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],gt.prototype,"displayField",void 0),_([S({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],gt.prototype,"definitionExpression",void 0),_([S({types:Lc,readOnly:!0})],gt.prototype,"defaultSymbol",void 0),_([S({type:Nh})],gt.prototype,"dynamicDataSource",void 0),_([S({readOnly:!0})],gt.prototype,"editFieldsInfo",void 0),_([S({type:Boolean})],gt.prototype,"editingEnabled",null),_([wt(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],gt.prototype,"readEditingEnabled",null),_([wt("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],gt.prototype,"readEditingEnabledFromWebMap",null),_([Et(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],gt.prototype,"writeEditingEnabled",null),_([Et("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],gt.prototype,"writeEditingEnabledToWebMap",null),_([S({readOnly:!0})],gt.prototype,"editingInfo",void 0),_([wt("editingInfo")],gt.prototype,"readEditingInfo",null),_([S(KGe)],gt.prototype,"elevationInfo",void 0),_([S(Wje)],gt.prototype,"featureReduction",void 0),_([S(qe(ie({},U7.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:z7}}}}}))],gt.prototype,"fields",void 0),_([S(U7.fieldsIndex)],gt.prototype,"fieldsIndex",void 0),_([S({type:tHe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],gt.prototype,"floorInfo",void 0),_([S({type:VVe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],gt.prototype,"formTemplate",void 0),_([S({type:ki,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],gt.prototype,"fullExtent",void 0),_([S()],gt.prototype,"gdbVersion",void 0),_([S({readOnly:!0,type:Kje,json:{read:{source:"geometryProperties"}}})],gt.prototype,"geometryFieldsInfo",void 0),_([S({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:k7.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:z7,writer(e,t,i){const r=e?k7.toJSON(e):null;r&&Kh(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:k7.read}}})],gt.prototype,"geometryType",void 0),_([S({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],gt.prototype,"hasM",void 0),_([S({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],gt.prototype,"hasZ",void 0),_([S({readOnly:!0,type:jv})],gt.prototype,"heightModelInfo",void 0),_([S({type:Date})],gt.prototype,"historicMoment",void 0),_([S(eje)],gt.prototype,"id",void 0),_([S({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],gt.prototype,"infoFor3D",void 0),_([S({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],gt.prototype,"isTable",void 0),_([wt("service","isTable",["type","geometryType"]),wt("isTable",["layerDefinition.type","layerDefinition.geometryType"])],gt.prototype,"readIsTable",null),_([Et("web-map","isTable")],gt.prototype,"writeIsTable",null),_([S(ove)],gt.prototype,"labelsVisible",void 0),_([S({type:[UY],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Gre},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Gre},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],gt.prototype,"labelingInfo",void 0),_([S(QGe)],gt.prototype,"opacity",void 0),_([S({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],gt.prototype,"layerId",void 0),_([S(ZGe)],gt.prototype,"legendEnabled",void 0),_([S({type:["show","hide"]})],gt.prototype,"listMode",void 0),_([S(tje)],gt.prototype,"minScale",void 0),_([wt("service","minScale",["minScale","effectiveMinScale"])],gt.prototype,"readMinScale",null),_([S(ije)],gt.prototype,"maxScale",void 0),_([wt("service","maxScale",["maxScale","effectiveMaxScale"])],gt.prototype,"readMaxScale",null),_([S({type:String})],gt.prototype,"globalIdField",void 0),_([wt("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),wt("service","globalIdField",["globalIdField","fields"])],gt.prototype,"readGlobalIdFieldFromService",null),_([S({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:z7}}}}})],gt.prototype,"objectIdField",void 0),_([wt("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),wt("service","objectIdField",["objectIdField","fields"])],gt.prototype,"readObjectIdFieldFromService",null),_([S({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],gt.prototype,"operationalLayerType",void 0),_([S(U7.outFields)],gt.prototype,"outFields",void 0),_([S({readOnly:!0})],gt.prototype,"parsedUrl",null),_([S({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],gt.prototype,"path",void 0),_([S(nve)],gt.prototype,"popupEnabled",void 0),_([S({type:kL,json:{name:"popupInfo",write:!0}})],gt.prototype,"popupTemplate",void 0),_([S({readOnly:!0})],gt.prototype,"defaultPopupTemplate",null),_([S({type:[iHe],readOnly:!0})],gt.prototype,"relationships",void 0),_([S({types:Gye,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:AVe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],gt.prototype,"renderer",null),_([wt("service","renderer",["drawingInfo.renderer","defaultSymbol"]),wt("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],gt.prototype,"readRenderer",null),_([S()],gt.prototype,"sourceJSON",void 0),_([S({type:Boolean})],gt.prototype,"returnM",void 0),_([S({type:Boolean})],gt.prototype,"returnZ",void 0),_([S(YGe)],gt.prototype,"screenSizePerspectiveEnabled",void 0),_([S({clonable:!1})],gt.prototype,"source",null),_([_i("source")],gt.prototype,"castSource",null),_([wt("portal-item","source",["featureSet"]),wt("web-map","source",["featureSet"])],gt.prototype,"readSource",null),_([S({readOnly:!0})],gt.prototype,"serviceDefinitionExpression",void 0),_([wt("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],gt.prototype,"readServiceDefinitionExpression",null),_([S({type:It,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],gt.prototype,"spatialReference",void 0),_([S({type:Number})],gt.prototype,"subtypeCode",void 0),_([S({type:[zY]})],gt.prototype,"templates",void 0),_([wt("templates",["editFieldsInfo","creatorField","editorField","templates"])],gt.prototype,"readTemplates",null),_([S({type:dve})],gt.prototype,"timeInfo",void 0),_([S()],gt.prototype,"title",void 0),_([wt("service","title",["name"]),wt("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],gt.prototype,"readTitle",null),_([wt("web-map","title",["layerDefinition.name","title"])],gt.prototype,"readTitleFromWebMap",null),_([S({type:String})],gt.prototype,"sublayerTitleMode",void 0),_([S({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],gt.prototype,"trackIdField",void 0),_([S({json:{read:!1}})],gt.prototype,"type",void 0),_([S({type:String})],gt.prototype,"typeIdField",void 0),_([wt("service","typeIdField"),wt("typeIdField",["layerDefinition.typeIdField"])],gt.prototype,"readTypeIdField",null),_([S({type:[vve]})],gt.prototype,"types",void 0),_([wt("service","types",["types"]),wt("types",["layerDefinition.types"])],gt.prototype,"readTypes",null),_([S({readOnly:!0,json:{write:!1}})],gt.prototype,"serverGens",void 0),_([S({type:kt.ofType(zm),readOnly:!0})],gt.prototype,"indexes",void 0),_([S(JGe)],gt.prototype,"url",null),_([Et("url")],gt.prototype,"writeUrl",null),_([S({readOnly:!0})],gt.prototype,"userIsAdmin",void 0),_([S({json:{origins:{service:{read:!0}},read:!1}})],gt.prototype,"version",void 0),_([wt("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],gt.prototype,"readVersion",null),_([S({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],gt.prototype,"visible",void 0),_([wt("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],gt.prototype,"readVisible",null),gt=_([re("esri.layers.FeatureLayer")],gt);const B7=rE({types:k0e}),bve=gt;var JTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:bve});const bHe=["$datastore","$map","$layer","$aggregatedfeatures"],wHe="esri.widgets.Feature.support.arcadeFeatureUtils",xHe=Ge.getLogger(wHe);function THe(e){return typeof e=="string"?BO(GX(e)):Array.isArray(e)?SHe(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?EHe(e):e}function SHe(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?BO(GX(t)):t}</li>`).join("")}</ul>`}function EHe(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?BO(GX(i)):i}</td></tr>`}).join("")}</table>`}function AHe({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:a,interceptor:l}){i.forEach(p=>{const y=p.toLowerCase(),b={map:n,spatialReference:s.sr,interceptor:l};if(y==="$map"&&(r.vars[y]=t.convertMapToFeatureSetCollection(b)),y==="$layer"&&(r.vars[y]=t.convertFeatureLayerToFeatureSet({layer:a.sourceLayer,spatialReference:s.sr,interceptor:l})),y==="$datastore"&&(r.vars[y]=t.convertServiceUrlToWorkspace({url:a.sourceLayer.url,spatialReference:s.sr,interceptor:l})),y==="$aggregatedfeatures"){const x=a.layer,{fields:A,objectIdField:M,geometryType:P,spatialReference:$,displayField:k}=x,z=new bve(qe(ie({fields:A,objectIdField:M,geometryType:P,spatialReference:$,displayField:k},x.type==="feature"?{templates:x.templates,typeIdField:x.typeIdField,types:x.types}:null),{source:e}));r.vars[y]=t.convertFeatureLayerToFeatureSet({layer:z,spatialReference:s.sr,interceptor:l})}})}function wve(){return import("./arcadeUtils.5e9a5423.js").then(function(e){return e.q})}async function CHe({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:a}=await s.queryFeatures(n);return a}async function xve({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:a}){if(!e||!e.expression)return null;const l=t.createSyntaxTree(e.expression),p=bHe.filter(M=>t.hasVariable(l,M)),[y]=await eR([CHe({graphic:n,view:a}),t.loadScriptDependencies(l,!0,p)]),b=t.getViewInfo({spatialReference:r}),x=t.createExecContext(n,b);x.interceptor=i,x.useAsync=!0,AHe({aggregatedFeatures:y,arcadeUtils:t,featureSetVars:p,context:x,viewInfo:b,map:s,graphic:n,interceptor:i});const A=t.createFunction(l,x);return t.executeAsyncFunction(A,x).catch(M=>xHe.error("arcade-execution-error",{error:M,graphic:n,expressionInfo:e}))}async function MHe({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const a=await wve(),l={};for(const b of e)l[`expression/${b.name}`]=xve({expressionInfo:b,arcadeUtils:a,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const p=await bo(l),y={};for(const b in p)y[b]=THe(p[b].value);return y}const RHe=1;let wh=class extends zg(st){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var t,i;const r=(t=this.contentElement)==null?void 0:t.type;(i=this.contentElementViewModel)==null||i.destroy();const s=r==="fields"?new dN:r==="media"?new h2:r==="text"?new Z6:null;this._set("contentElementViewModel",s)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=zX(this._compile,RHe,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:a,_abortController:l}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const p=await wve();if(l!==this._abortController)return;const y=await xve({arcadeUtils:p,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:a});if(!y||y.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const b=await _Y(y,l.signal),x=b==null?void 0:b.type,A=x==="media"?pR.fromJSON(b):x==="text"?aS.fromJSON(b):x==="fields"?oS.fromJSON(b):null;this._set("contentElement",A)},this.handles.add([Pi(this,["expressionInfo","graphic","map","spatialReference","view"],this._compileThrottled),Pi(this,"contentElement",this._createVM)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};_([S()],wh.prototype,"_abortController",void 0),_([S({type:jfe})],wh.prototype,"expressionInfo",void 0),_([S({type:gl})],wh.prototype,"graphic",void 0),_([S({readOnly:!0})],wh.prototype,"contentElement",void 0),_([S({readOnly:!0})],wh.prototype,"contentElementViewModel",void 0),_([S()],wh.prototype,"interceptor",void 0),_([S()],wh.prototype,"spatialReference",null),_([S({readOnly:!0})],wh.prototype,"state",null),_([S()],wh.prototype,"map",null),_([S()],wh.prototype,"view",void 0),wh=_([re("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],wh);const BY=wh,I5={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let B9=class extends cc{constructor(e,t){super(e,t),this.viewModel=new BY}initialize(){Pi(this,"viewModel.contentElementViewModel",()=>this._setupExpressionWidget())}destroy(){this._destroyContentWidget()}renderLoading(){return Ve("div",{key:"loading-container",class:I5.loadingSpinnerContainer},Ve("span",{class:this.classes(I5.iconLoading,I5.spinner)}))}render(){var e;const{state:t}=this.viewModel;return Ve("div",{class:I5.base},t==="loading"?this.renderLoading():t==="disabled"?null:(e=this._contentWidget)==null?void 0:e.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new kge({viewModel:e}):i==="media"?new m1e({viewModel:e}):i==="text"?new g9({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};_([S({type:BY})],B9.prototype,"viewModel",void 0),B9=_([re("esri.widgets.Feature.FeatureExpression")],B9);const OHe=B9;class PHe{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var V9;const IHe=1,Yre="content-view-models",Tve="esri.widgets.FeatureViewModel",$He=Ge.getLogger(Tve),Jre={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let cn=V9=class extends st{constructor(e){super(e),this._handles=new Ei,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=zX(this._graphicChanged,IHe,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=ie({},Jre),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(Pi(this,["graphic","_effectivePopupTemplate","abilities"],()=>this.graphicChangedThrottled()))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return L(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return fFe(Zte(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Rge(this.graphic)}castAbilities(e){return ie(ie({},Jre),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof h2&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof h2&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof h2&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Cs(i)||(this._error=i,$He.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new aS({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(Yre),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:a}=this,l=new BY({expressionInfo:i,graphic:r,interceptor:V9.interceptor,map:s,spatialReference:n,view:a});return this.contentViewModels[t]=l,this._handles.add(Pi(l,"contentElementViewModel",()=>this._setExpressionContentVM(l,t)),Yre),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new HX(ie({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new Z6({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:a}=this,{attributes:l}=s,p=n.global;return{title:l2({attributes:l,fieldInfoMap:i,globalAttributes:p,expressionAttributes:a,layer:r,text:e}),description:l2({attributes:l,fieldInfoMap:i,globalAttributes:p,expressionAttributes:a,layer:r,text:t})}}_createFieldsVMParams(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=ie(ie({},r.global),r.content[t]),n=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos),a=n==null?void 0:n.filter(({fieldName:b})=>Pge(b)||ig(b)||s.hasOwnProperty(b)),l=i==null?void 0:i.expressionInfos,{description:p,title:y}=e;return ie({attributes:s,expressionInfos:l,fieldInfos:a},this._compileTitleAndDesc({title:y,description:p}))}_compileFields(e,t){const i=e.clone(),r=new dN(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:a,relatedInfos:l,_sourceLayer:p,_expressionAttributes:y}=this,{attributes:b}=r,{description:x,mediaInfos:A,title:M}=e;return ie({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:b,layer:p,fieldInfoMap:s,formattedAttributes:ie(ie({},n.global),n.content[t]),expressionAttributes:y,mediaInfos:A,popupTemplate:a,relatedInfos:l},this._compileTitleAndDesc({title:M,description:x}))}_compileMedia(e,t){const i=e.clone(),r=new h2(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,a=this.formattedAttributes.global;e.text=l2({attributes:n,fieldInfoMap:i,globalAttributes:a,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new Z6(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?pFe(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,a=this.formattedAttributes.global;return l2({attributes:n,fieldInfoMap:t,globalAttributes:a,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return Y6(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return Y6(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:a,view:l}=this,{content:{value:p},title:{value:y}}=await bo({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await vFe({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:b}}=await bo({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:MHe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:a,interceptor:V9.interceptor,view:l})});t===this._featureAbortController&&r&&(this._expressionAttributes=b,this._graphicExpressionAttributes=ie(ie({},r.attributes),b),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(y)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:a,_fieldInfoMap:l,_graphicExpressionAttributes:p}=this;i.content[t]=s7({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:ie(ie({},p),e.attributes),layer:a,fieldInfoMap:l,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=s7({fieldInfos:e.fieldInfos,graphic:r,attributes:ie(ie({},l),e.attributes),layer:n,fieldInfoMap:a,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:a}=this,l=t==null?void 0:t.fieldInfos,p={global:s7({fieldInfos:l,graphic:i,attributes:a,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((y,b)=>{y.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:y,contentElementIndex:b,formattedAttributes:p}),y.type==="media"&&this._createMediaFormattedAttributes({contentElement:y,contentElementIndex:b,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Zte(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=L(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const a=t.filter(y=>y&&ig(y.fieldName));if(!a||!a.length)return;t.forEach(y=>this._configureRelatedInfo(y,n));const l=await Mke({relatedInfos:r,layer:n},i);Object.keys(l).forEach(y=>{var b;const x=r.get(y.toString()),A=(b=l[y])==null?void 0:b.value;x&&A&&(x.layerInfo=A.data)});const p=await Rke({graphic:e,relatedInfos:r,layer:n},i);Object.keys(p).forEach(y=>{var b;Tke((b=p[y])==null?void 0:b.value,r.get(y.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=xC(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const a=i.get(s.toString())||xke(s,t);a&&(Oke({relatedInfo:a,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,a))}};cn.interceptor=new PHe(wFe,xFe),_([S()],cn.prototype,"_error",void 0),_([S()],cn.prototype,"_featureAbortController",void 0),_([S({readOnly:!0})],cn.prototype,"_effectivePopupTemplate",null),_([S({readOnly:!0})],cn.prototype,"_fieldInfoMap",null),_([S({readOnly:!0})],cn.prototype,"_sourceLayer",null),_([S()],cn.prototype,"abilities",void 0),_([_i("abilities")],cn.prototype,"castAbilities",null),_([S({readOnly:!0})],cn.prototype,"content",void 0),_([S({readOnly:!0})],cn.prototype,"contentViewModels",void 0),_([S({type:Boolean})],cn.prototype,"defaultPopupTemplateEnabled",void 0),_([S({readOnly:!0})],cn.prototype,"state",null),_([S({readOnly:!0})],cn.prototype,"formattedAttributes",void 0),_([S({type:gl,value:null})],cn.prototype,"graphic",null),_([S({readOnly:!0})],cn.prototype,"lastEditInfo",void 0),_([S({readOnly:!0})],cn.prototype,"relatedInfos",void 0),_([S()],cn.prototype,"spatialReference",null),_([S({readOnly:!0})],cn.prototype,"title",void 0),_([S()],cn.prototype,"map",null),_([S({readOnly:!0})],cn.prototype,"waitingForContent",null),_([S()],cn.prototype,"view",void 0),cn=V9=_([re(Tve)],cn);const VY=cn,Sve=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>spe(i)&&!i.destroyed?Ve("div",{key:i},i.render()):i instanceof HTMLElement?Ve("div",{key:i,bind:i,afterCreate:this._attachToNode}):D5e(i)?Ve("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=_([re("esri.widgets.Feature.ContentMixin")],t),t},va={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Zre={title:!0,content:!0,lastEditedInfo:!0};let Sa=class extends Sve(cc){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=ie({},Zre),this.map=null,this.view=null,this.viewModel=new VY}initialize(){this.own(Pi(this,"viewModel.contentViewModels",()=>this._setupContentWidgets()))}loadDependencies(){return import("./calcite-notice.f321d1ad.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return ie(ie({},Zre),e)}render(){const{state:e}=this.viewModel,t=Ve("div",{class:va.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return Ve("div",{class:this.classes(va.base,va.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return Ve("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?Ve("div",{key:"error-title",slot:"title"},e.errorMessage):null,Ve("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return Ve("div",{key:"loading-container",class:va.loadingSpinnerContainer},Ve("span",{class:this.classes(va.iconLoading,va.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Ve("div",{class:va.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Ve(qX,{level:this.headingLevel,class:va.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Ve("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:Ve("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?Ve("div",{key:this._buildKey("attachments-element",e),class:this.classes(va.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Ve("div",{key:this._buildKey("expression-element",e),class:va.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Ve("div",{key:this._buildKey("custom-element",t),class:va.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Ve("div",{key:this._buildKey("fields-element",e),class:va.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Ve("div",{key:this._buildKey("media-element",e),class:va.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,a=om(n,{date:r,user:s});return Ve("div",{key:"edit-info-element",class:this.classes(va.lastEditedInfo,va.contentElement)},a)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Ve("div",{key:this._buildKey("text-element",t),class:this.classes(va.contentElement,va.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new OFe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new kge({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new m1e({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new g9({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new g9({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new OHe({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new g9({viewModel:s}))}this.scheduleRender()}};_([oi("viewModel.graphic")],Sa.prototype,"graphic",void 0),_([oi("viewModel.defaultPopupTemplateEnabled")],Sa.prototype,"defaultPopupTemplateEnabled",void 0),_([S()],Sa.prototype,"headingLevel",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Sa.prototype,"label",void 0),_([S(),Zc("esri/widgets/Feature/t9n/Feature")],Sa.prototype,"messages",void 0),_([S(),Zc("esri/t9n/common")],Sa.prototype,"messagesCommon",void 0),_([S(),Zc("esri/widgets/support/t9n/uriUtils")],Sa.prototype,"messagesURIUtils",void 0),_([oi("viewModel.spatialReference")],Sa.prototype,"spatialReference",void 0),_([oi("viewModel.title")],Sa.prototype,"title",void 0),_([S()],Sa.prototype,"visibleElements",void 0),_([_i("visibleElements")],Sa.prototype,"castVisibleElements",null),_([oi("viewModel.map")],Sa.prototype,"map",void 0),_([oi("viewModel.view")],Sa.prototype,"view",void 0),_([S({type:VY})],Sa.prototype,"viewModel",void 0),Sa=_([re("esri.widgets.Feature")],Sa);const DHe=Sa;let pb=class extends ps.EventedAccessor{constructor(e){super(e),this._anchorHandles=new Ei,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([ms(this,["screenLocationEnabled","location","view.size","view.stationary"],()=>this._updateScreenPointAndHandle()),ms(this,["view","view.ready"],()=>this._wireUpView())])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i=t.type==="3d"?"camera":"viewpoint",r=F8e(t,i,()=>this._viewpointChange());this._anchorHandles.add(r,e),this._viewpointHandle=r,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;!e||(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,r=this.get("view.ready"),s=i&&r&&L(e)?t.toScreen(e):null;this._set("screenLocation",s)}};_([S()],pb.prototype,"location",void 0),_([S({readOnly:!0})],pb.prototype,"screenLocation",void 0),_([S()],pb.prototype,"screenLocationEnabled",void 0),_([S()],pb.prototype,"view",void 0),pb=_([re("esri.widgets.support.AnchorElementViewModel")],pb);const Eve=pb,LHe="esri.widgets.CompassViewModel";let G9=class extends Eve{constructor(e){super(e),this.visible=!1}};_([S()],G9.prototype,"visible",void 0),G9=_([re(LHe)],G9);const Ave=G9,V7={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let fb=class extends cc{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new Ave,this.visible=!1}initialize(){this.own([ms(this,"visible",e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[V7.spinnerStart]:r,[V7.spinnerFinish]:s},a=this._getPositionStyles();return Ve("div",{class:this.classes(V7.base,n),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=jT(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||J(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};_([oi("viewModel.location")],fb.prototype,"location",void 0),_([oi("viewModel.view")],fb.prototype,"view",void 0),_([S({type:Ave})],fb.prototype,"viewModel",void 0),_([oi("viewModel.visible")],fb.prototype,"visible",void 0),fb=_([re("esri.widgets.Spinner")],fb);const NHe=fb;var Kre;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Kre||(Kre={}));class $j{constructor(t,i){this._storage=new EY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function FHe(e){return typeof e=="function"}function ZTt(e,t,i,r){return FHe(e)?e(t,i,r):e}function KTt(e){return[e.r,e.g,e.b,e.a]}function QTt(e,t,i){const r=` /-,
`,s=p=>{let y=p.length;for(;y--;)if(r.indexOf(p.charAt(y))===-1)return!1;return!0},n=[];let a=0,l=-1;do if(l=t.indexOf("[",a),l>=a){if(l>a){const p=t.substr(a,l-a);n.push([p,null,s(p)])}if(a=l+1,l=t.indexOf("]",a),l>=a){if(l>a){const p=e[t.substr(a,l-a)];p&&n.push([null,p,!1])}a=l+1}}while(l!==-1);if(a<t.length-1){const p=t.substr(a);n.push([p,null,s(p)])}return p=>{let y="",b=null;for(const x of n){const[A,M,P]=x;if(A)P?b=A:(b&&(y+=b,b=null),y+=A);else{const $=p.attributes[M];$&&(b&&(y+=b,b=null),y+=$)}}return kHe(y,i)}}function kHe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function eSt(e,t,i,r,s,n,a=!0){const l=t/s,p=i/n,y=Math.ceil(l/2),b=Math.ceil(p/2);for(let x=0;x<n;x++)for(let A=0;A<s;A++){const M=4*(A+(a?n-x-1:x)*s);let P=0,$=0,k=0,z=0,G=0,B=0,W=0;const q=(x+.5)*p;for(let X=Math.floor(x*p);X<(x+1)*p;X++){const oe=Math.abs(q-(X+.5))/b,de=(A+.5)*l,he=oe*oe;for(let fe=Math.floor(A*l);fe<(A+1)*l;fe++){let me=Math.abs(de-(fe+.5))/y;const ge=Math.sqrt(he+me*me);ge>=-1&&ge<=1&&(P=2*ge*ge*ge-3*ge*ge+1,P>0&&(me=4*(fe+X*t),W+=P*e[me+3],k+=P,e[me+3]<255&&(P=P*e[me+3]/250),z+=P*e[me],G+=P*e[me+1],B+=P*e[me+2],$+=P))}}r[M]=z/$,r[M+1]=G/$,r[M+2]=B/$,r[M+3]=W/k}}function tSt(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function UHe(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const iSt=e=>isNaN(e)||!e?0:e,rSt=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function sSt(){return import("./geometryEngineJSON.7b5bdc4f.js")}function Cve(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)VHe(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":zHe(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":r!=null&&r.preserveOutlineWidth||!s.width||(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":Cve(s.lineSymbol,t,!0,qe(ie({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function zHe(e,t,i){if(e.markerPlacement&&BHe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||Cve(r.symbol,t,!0,i)}function BHe(e,t){switch(UHe(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function VHe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}new $j(1e3);new Ft([128,128,128]);const Qre=/\/resource\/(.*?)\.svg$/,GHe=new Ft("white");function nSt(e){if(J(e)||!("symbolLayers"in e)||J(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function jHe(e,t){const i=t.resource.href;return!je("esri-canvas-svg-support")&&e.styleOrigin&&Qre.test(i)?i.replace(Qre,"/resource/png/$1.png"):i}function hD(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new Ft(i)}function HHe(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const a=L(n)?n:null;return hD(t=t||a||i!=null&&GHe,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const a=L(n.material)?n.material.color:null,l=s(a);J(n.material)?n.material=new Yh({color:l}):n.material.color=l,i!=null&&"outline"in n&&L(n.outline)&&L(n.outline.color)&&(n.outline.color=hD(n.outline.color,i))}})}function qHe(e,t,i){(t=t||e.color)&&(e.color=hD(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=hD(e.outline.color,i))}function G7(e,t,i){e&&(t||i!=null)&&(t&&(t=new Ft(t)),mR(e)?HHe(e,t,i):uX(e)&&qHe(e,t,i))}async function WHe(e,t){const i=e.symbolLayers;i&&await YL(i,async r=>XHe(r,t))}async function XHe(e,t){switch(e.type){case"extrude":JHe(e,t);break;case"icon":case"line":case"text":YHe(e,t);break;case"path":KHe(e,t);break;case"object":await ZHe(e,t)}}function YHe(e,t){const i=Mve(t);L(i)&&(e.size=i)}function Mve(e){for(const t of e)if(typeof t=="number")return t;return null}function JHe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function ZHe(e,t){const{resourceSize:i,symbolSize:r}=await QHe(e),s=Rve(t,i,r);e.width=OM(t[0],r[0],i[0],s),e.depth=OM(t[1],r[1],i[1],s),e.height=OM(t[2],r[2],i[2],s)}function KHe(e,t){const i=Rve(t,Jf,[e.width,void 0,e.height]);e.width=OM(t[0],e.width,1,i),e.height=OM(t[2],e.height,1,i)}function Rve(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function QHe(e){const t=await import("./symbolLayerUtils.4b72148b.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,a=[r,n,s];let l=1;for(let p=0;p<3;p++)if(a[p]!=null){l=a[p]/i[p];break}for(let p=0;p<3;p++)a[p]==null&&(a[p]=i[p]*l);return{resourceSize:i,symbolSize:a}}function OM(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function eqe(e,t){const i=Mve(t);if(!J(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function tqe(e,t){if(e&&t)return mR(e)?WHe(e,t):void(uX(e)&&eqe(e,t))}function iqe(e,t,i){if(e&&t!=null)if(mR(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else uX(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function Ove(e){return e&&"opacity"in e?e.opacity*Ove(e.parent):1}async function rqe(e,t){var i,r;if(!e)return;const s=e.sourceLayer,n=(i=L(t)&&(r=t.useSourceLayer)!=null&&r?s:e.layer)!=null?i:s,a=Ove(n);if(L(e.symbol)&&(!L(t)||t.ignoreGraphicSymbol!==!0)){const G=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(L(t)?t.abortOptions:null):e.symbol.clone();return G7(G,null,a),G}const l=L(t)&&t.renderer||n&&"renderer"in n&&n.renderer;let p=l&&"getSymbolAsync"in l?await l.getSymbolAsync(e,t):null;if(!p)return;if(p=p.type==="web-style"?await p.fetchSymbol(L(t)?t.abortOptions:null):p.clone(),!("visualVariables"in l)||!l.visualVariables||!l.visualVariables.length)return G7(p,null,a),p;if("arcadeRequiredForVisualVariables"in l&&l.arcadeRequiredForVisualVariables&&(J(t)||J(t.arcade))){const G=ie({},t);G.arcade=await Np(),t=G}const y=await Promise.resolve().then(function(){return YBe}),b=[],x=[],A=[],M=[];for(const G of l.visualVariables)switch(G.type){case"color":b.push(G);break;case"opacity":x.push(G);break;case"rotation":M.push(G);break;case"size":G.target||A.push(G)}const P=!!b.length&&b[b.length-1],$=P?y.getColor(P,e,t):null,k=!!x.length&&x[x.length-1];let z=k?y.getOpacity(k,e,t):null;if(a!=null&&(z=z!=null?z*a:a),G7(p,$,z),A.length){const G=y.getAllSizes(A,e,t);await tqe(p,G)}for(const G of M)iqe(p,y.getRotationAngle(G,e,t),G.axis);return p}class ese{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}const sqe=je("mac")?"Meta":"Ctrl",PN={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)PN[e]=String.fromCharCode(e);for(let e=1;e<25;e++)PN[111+e]=`F${e}`;for(let e=65;e<91;e++)PN[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function nqe(e){if(e.key!==void 0)return kb(e);const t=PN[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function oqe(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class aqe{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const tse=Ge.getLogger("esri.views.input.InputHandler");class ya{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?tse.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new aqe(t,s):t,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=b=>{const x=this._incoming[b.match.eventType];if(x){const A=x.indexOf(b);x.splice(A,1),a(),this._manager&&this._manager.updateDependencies()}},p=new lqe(n,r,{onPause:l,onRemove:l,onResume:b=>{const x=this._incoming[b.match.eventType];x&&x.indexOf(b)===-1&&(x.push(b),a(),this._manager&&this._manager.updateDependencies())}});let y=this._incoming[n.eventType];return y||(y=[],this._incoming[n.eventType]=y),y.push(p),a(),this._manager&&this._manager.updateDependencies(),p}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new cqe(t,{onEmit:(r,s,n,a)=>{this._manager.emit(r.eventType,s,n,a)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):tse.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class lqe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class cqe{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class hqe extends ya{constructor(t){super(!0),this._onChange=t,this._value="mouse",this.registerIncoming("pointer-down",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse")}),this._moveHandler=this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse")}),this._moveHandler.pause()}_setValue(t){t!==this._value&&(t==="touch"?this._moveHandler.resume():this._moveHandler.pause(),this._value=t,this._onChange(t))}}const j7=Ge.getLogger("esri.views.input.InputManager");let mb=class extends st{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=sqe,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=ls.INTERNAL){if(this._nameToGroup[e])return void j7.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void j7.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,p,y,b)=>{this._emitInputEvent(n.priorityIndex+1,a,l,p,b,y)},setPointerCapture:(a,l)=>{this._setPointerCapture(r,n,a,l)},setEventCallback:a=>{n.eventCallback=a},setUninstallCallback:a=>{n.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):j7.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const a of n.keyModifiers)oqe(a)||t.add(a)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(r(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(r(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=t.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new hqe(e=>this._setLatestPointerType(e)),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,ls.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],ls.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const a=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,p={event:new uqe(t,i,a,n||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(p):this._doNewPropagation(p)}_doNewPropagation(e){this._currentPropagation={events:new ese,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new ese;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.indexOf(n)!==-1);if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};_([S({readOnly:!0})],mb.prototype,"hasPendingInputs",null),_([S()],mb.prototype,"eventSource",void 0),_([S()],mb.prototype,"recognizers",void 0),_([S({readOnly:!0})],mb.prototype,"latestPointerType",void 0),mb=_([re("esri.views.input.InputManager")],mb);class uqe{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=xy.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=xy.STOPPED}shouldStopPropagation(){return(this._propagationState&xy.STOPPED)!=0}async(t){this._propagationState|=xy.PAUSED;const i=(r,s)=>{this._propagationState&=~xy.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&xy.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var xy;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(xy||(xy={}));const ls={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};function dqe(e){return e&&typeof e.highlight=="function"}function pqe(e){return e&&typeof e.maskOccludee=="function"}function oSt(e,t,i){return J(e)||e>i&&(t===0||e<t)}function aSt(e,t){return e>0||t>0}function lSt(e){var t,i;const r=e.effectiveScaleRange;return{minScale:(t=r==null?void 0:r.minScale)!=null?t:0,maxScale:(i=r==null?void 0:r.maxScale)!=null?i:0}}const IN={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},d2=new cE({id:"zoom-to-feature",title:"{messages.zoom}",className:IN.iconZoom}),ise=new cE({id:"remove-selected-feature",title:"{messages.remove}",className:IN.iconTrash}),Z3=new cE({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:IN.iconZoom}),K3=new cE({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:IN.iconBrowseClusteredFeatures}),fqe="esri.widgets.Popup.PopupViewModel",Cv=Ge.getLogger(fqe),mqe=function(e){const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new Se("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new Se("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:a}=r;if(!a)return Promise.reject(new Se("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new Se("trigger-action:invalid-action","Action is disabled"));if(a===d2.id)return yqe(s.viewModel).catch(yz);if(a===Z3.id)return vqe(s.viewModel);if(a===K3.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,a===ise.id){s.close();const{selectedFeature:l}=s;if(!l)return Promise.reject(new Se(`trigger-action:${ise.id}`,"selectedFeature is required",{selectedFeature:l}));const{sourceLayer:p}=l;return p?p.remove(l):i.graphics.remove(l),Promise.resolve()}return Promise.resolve()};function Pve(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function gqe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new Se("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Cv.error(s)}),r}return!0}async function yqe(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=Pve(e);if(!n){const y=new Se("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});return Cv.error(y),Promise.reject(y)}const a=r.scale/s,l=e.get("selectedFeature.geometry")||t,p=l&&l.type==="point"&&gqe(i,r);d2.active=!0,d2.disabled=!0;try{await e.view.goTo({target:n,scale:p?a:void 0})}finally{d2.active=!1,d2.disabled=!1,e.zoomToLocation=null,p&&(e.location=l)}}async function vqe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const l=new Se("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Cv.error(l),l}if(!t.isAggregate){const l=new Se("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Cv.error(l),l}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],Z3.active=!0,Z3.disabled=!0;const{extent:a}=await s.queryExtent(n);await i.goTo({target:a}),Z3.active=!1,Z3.disabled=!1}async function _qe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const l=new Se("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw Cv.error(l),l}if(!t.isAggregate){const l=new Se("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Cv.error(l),l}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:a}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=a,i.graphics.add(e.selectedClusterBoundaryFeature)}async function bqe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const l=new Se("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw Cv.error(l),l}if(!t.isAggregate){const l=new Se("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Cv.error(l),l}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],K3.active=!0,K3.disabled=!0;const{features:a}=await s.queryFeatures(n);K3.active=!1,K3.disabled=!1,i.popup.open({features:[t].concat(a),featureMenuOpen:!0})}function wqe(e){var t;(t=e.selectedFeature)!=null&&t.isAggregate&&(e.features=e.features.filter(i=>i.isAggregate))}const Ive=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return _([S()],t.prototype,"goToOverride",void 0),_([S()],t.prototype,"view",void 0),t=_([re("esri.widgets.support.GoTo")],t),t},PM=kt.ofType({key:"type",defaultKeyValue:"button",base:FL,typeMap:{button:cE,toggle:e0e}}),xqe=()=>[d2.clone()],Tqe=()=>[Z3.clone(),K3.clone()],$ve="esri.widgets.Popup.PopupViewModel",rse=Ge.getLogger($ve);let lr=class extends Ive(Eve){constructor(e){super(e),this._handles=new Ei,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new PM,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new gl({symbol:new Ag({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([Pi(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ms(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),ms(this,"view.animation.state",e=>this._animationStateChange(e)),ms(this,"location",e=>this._locationChange(e)),ms(this,"selectedFeature",e=>this._selectedFeatureChange(e)),ms(this,["selectedFeatureIndex","featureCount","featuresPerPage"],()=>this._selectedFeatureIndexChange()),ms(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],()=>this._setGraphicOnFeatureViewModels()),ms(this,"featureViewModels",()=>this._featureViewModelsChange()),this.on("trigger-action",e=>mqe({event:e,view:this.view})),W6(this,"waitingForResult",()=>this._waitingForResultChange(),!0),ms(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs()),ms(this,["view.scale"],this._viewScaleChange),W6(this,"visible",()=>this.browseClusterEnabled=!1),ms(this,"browseClusterEnabled",e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new PM;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,a=s?i.concat(t):t,l=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),p=l&&l.actions,y=l&&l.overwriteActions?p:p?p.concat(a):a;return y&&y.filter(Boolean).forEach(b=>e.add(b)),e}get defaultActions(){var e;const t=this._get("defaultActions")||new PM;return t.removeAll(),t.addMany((e=this.selectedFeature)!=null&&e.isAggregate?Tqe():xqe()),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=e0(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Pve(this);if(!t){const i=new Se("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return rse.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new Se("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return rse.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=qe(ie({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){wqe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await _qe(this),await bqe(this)}_animationStateChange(e){this.zoomToLocation||(d2.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var e;const t=(e=this.view)==null?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;if((e=this.selectedFeature)!=null&&e.isAggregate)return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.browseClusterEnabled=!1,this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,a=n+r;s.slice(n,a).forEach((l,p)=>{l&&!l.graphic&&(l.graphic=e[n+p])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate?void 0:(e.symbol=await rqe(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(a=>a.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(e!=null&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,a)=>{if(!n)return;let l=null;if(r.some((b,x)=>(b&&b.graphic===n&&(l=b,r.splice(x,1)),!!l)),l)s[a]=l;else{var p,y;const b=new VY({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(p=this.view)==null?void 0:p.spatialReference,graphic:n===e?n:null,map:(y=this.view)==null?void 0:y.map,view:this.view});s[a]=b}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},ls.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:a,location:l}=s,p=[Promise.resolve(n),...a.map(y=>y.promise)];return r.popup.open({location:l||i,promises:p}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return J(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;let{layer:n,sourceLayer:a}=t;if((a==null?void 0:a.type)!=="map-notes"&&(a==null?void 0:a.type)!=="subtype-group"||(n=a),!(n&&n instanceof JO))return;const l=this._getLayerView(r,n);this._highlightPromise=l;const p=await l;if(!(p&&dqe(p)&&this._highlightPromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const y=n.type==="imagery"?void 0:"objectIdField"in n&&n.objectIdField,b=t.attributes,x=b&&y&&b[y],A=p.highlight(x||t);this._handles.add(A,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>t.indexOf(r)===-1);this.features=t.concat(i)}};_([S()],lr.prototype,"featurePage",void 0),_([S()],lr.prototype,"isLoadingFeature",null),_([S({type:PM})],lr.prototype,"actions",void 0),_([S({readOnly:!0})],lr.prototype,"active",null),_([S({readOnly:!0})],lr.prototype,"allActions",null),_([S({type:Boolean})],lr.prototype,"defaultPopupTemplateEnabled",void 0),_([S()],lr.prototype,"autoCloseEnabled",void 0),_([S()],lr.prototype,"autoOpenEnabled",void 0),_([S()],lr.prototype,"browseClusterEnabled",void 0),_([S()],lr.prototype,"content",void 0),_([S({type:PM,readOnly:!0})],lr.prototype,"defaultActions",null),_([S({readOnly:!0})],lr.prototype,"featureCount",null),_([S()],lr.prototype,"features",null),_([S()],lr.prototype,"featuresPerPage",void 0),_([S()],lr.prototype,"featureViewModelAbilities",void 0),_([S({readOnly:!0})],lr.prototype,"featureViewModels",void 0),_([S()],lr.prototype,"highlightEnabled",void 0),_([S()],lr.prototype,"includeDefaultActions",void 0),_([S({type:Gt})],lr.prototype,"location",null),_([S({readOnly:!0})],lr.prototype,"pendingPromisesCount",null),_([S({readOnly:!0})],lr.prototype,"selectedClusterBoundaryFeature",void 0),_([S({readOnly:!0})],lr.prototype,"waitingForResult",null),_([S({readOnly:!0})],lr.prototype,"promiseCount",null),_([S()],lr.prototype,"promises",null),_([S({value:null,readOnly:!0})],lr.prototype,"selectedFeature",null),_([S({value:-1})],lr.prototype,"selectedFeatureIndex",null),_([S({readOnly:!0})],lr.prototype,"selectedFeatureViewModel",null),_([S({readOnly:!0})],lr.prototype,"state",null),_([S()],lr.prototype,"title",void 0),_([S()],lr.prototype,"updateLocationEnabled",void 0),_([S()],lr.prototype,"view",void 0),_([S()],lr.prototype,"visible",void 0),_([S()],lr.prototype,"zoomFactor",void 0),_([S()],lr.prototype,"zoomToLocation",void 0),_([S()],lr.prototype,"centerAtLocation",null),lr=_([re($ve)],lr);const Dve=lr,sse="selected-index",Sqe=0,nse="popup-spinner",mt={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},ose={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},ase="esri-popup";function V0(e,t){return t===void 0?`${ase}__${e}`:`${ase}__${e}-${t}`}const Lve="esri.widgets.Popup",lse=Ge.getLogger(Lve),cse={closeButton:!0,featureNavigation:!0};let hi=class extends Sve(cc){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ei,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=zX(()=>this._displaySpinner(),Sqe),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Dve,this.visible=null,this.visibleElements=ie({},cse),this._addSelectedFeatureIndexHandle(),this.own([ms(this,"viewModel.screenLocation",()=>this._positionContainer()),ms(this,["viewModel.active","dockEnabled"],()=>this._toggleScreenLocationEnabled()),ms(this,"viewModel.screenLocation",(i,r)=>{!!i!=!!r&&this.reposition()}),ms(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],()=>this.reposition()),ms(this,"spinnerEnabled",i=>this._spinnerEnabledChange(i)),ms(this,"viewModel.view.size",(i,r)=>this._updateDockEnabledForViewSize(i,r)),ms(this,"viewModel.view",(i,r)=>this._viewChange(i,r)),ms(this,"viewModel.view.ready",(i,r)=>this._viewReadyChange(i,r)),ms(this,["viewModel.waitingForResult","viewModel.location"],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ms(this,["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],()=>this._setTitleFromFeatureWidget()),ms(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],()=>this._setContentFromFeatureWidget()),W6(this,"collapsed",()=>{var i,r;((i=this.viewModel)==null||(r=i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),m0(this,"viewModel.allActions","change",()=>this._watchActions()),Pi(this,"viewModel.allActions",()=>this._watchActions()),ms(this,"viewModel.featureViewModels",()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,a;return!!(this.selectedFeatureWidget?((e=this.selectedFeatureWidget)==null||(t=e.viewModel)==null?void 0:t.waitingForContent)||((i=this.selectedFeatureWidget)==null||(r=i.viewModel)==null?void 0:r.state)==="error"||((s=this.selectedFeatureWidget)==null||(n=s.viewModel)==null?void 0:n.content):(a=this.viewModel)==null?void 0:a.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ose}set dockOptions(e){const t=ie({},ose),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=ie(ie({},t),e),n=ie(ie({},t.breakpoint),r),{breakpoint:a}=s;a===!0?s.breakpoint=n:typeof a=="object"&&(s.breakpoint=ie(ie({},n),a)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=qe(ie({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new DHe({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return ie(ie({},cse),e)}blur(){const{active:e}=this.viewModel;e||lse.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||lse.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(sse);const r=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:r};((t=this.viewModel)==null||(i=t.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,r;const{actionsMenuOpen:s,dockEnabled:n,featureMenuVisible:a,dividedActions:l,currentAlignment:p,currentDockPosition:y}=this,{active:b}=this.viewModel,{menuActions:x}=l,A=b&&x.length>1&&s,M=b&&n,P=b&&!n,$=(e=this.selectedFeature)==null||(t=e.layer)==null?void 0:t.title,k=(i=this.selectedFeature)==null||(r=i.layer)==null?void 0:r.id,z={[mt.alignTopCenter]:p==="top-center",[mt.alignBottomCenter]:p==="bottom-center",[mt.alignTopLeft]:p==="top-left",[mt.alignBottomLeft]:p==="bottom-left",[mt.alignTopRight]:p==="top-right",[mt.alignBottomRight]:p==="bottom-right",[mt.isDocked]:M,[mt.shadow]:P,[mt.isDockedTopLeft]:y==="top-left",[mt.isDockedTopCenter]:y==="top-center",[mt.isDockedTopRight]:y==="top-right",[mt.isDockedBottomLeft]:y==="bottom-left",[mt.isDockedBottomCenter]:y==="bottom-center",[mt.isDockedBottomRight]:y==="bottom-right",[mt.isFeatureMenuOpen]:a,[mt.isActionsMenuOpen]:A};return Ve("div",{class:this.classes(mt.base,z),role:"presentation","data-layer-title":$,"data-layer-id":k,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},b?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Ve("span",{"aria-hidden":"true",class:this.classes(mt.icon,mt.iconLoading,mt.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Ve("div",{key:V0("loading-container"),role:"presentation",class:mt.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Uy(this.container),t={[mt.iconRightTriangleArrow]:e,[mt.paginationPreviousIconRTL]:e,[mt.iconLeftTriangleArrow]:!e,[mt.paginationPreviousIconLTR]:!e};return Ve("span",{"aria-hidden":"true",class:this.classes(mt.icon,t)})}renderPreviousButton(){const{messages:e}=this;return Ve("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(mt.button,mt.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Uy(this.container),t={[mt.iconLeftTriangleArrow]:e,[mt.paginationNextIconRTL]:e,[mt.iconRightTriangleArrow]:!e,[mt.paginationNextIconLTR]:!e};return Ve("span",{"aria-hidden":"true",class:this.classes(mt.icon,t)})}renderNextButton(){const{messages:e}=this;return Ve("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(mt.button,mt.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return Ve("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(mt.button,mt.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[mt.iconUndock]:e,[mt.iconDock]:!e,[mt.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[mt.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[mt.iconDockToTop]:!e&&t==="top-center",[mt.iconDockToBottom]:!e&&t==="bottom-center"};return Ve("span",{"aria-hidden":"true",class:this.classes(i,mt.icon)})}renderDockButton(){var e,t,i;const{dockEnabled:r,messages:s}=this,n=(e=this.viewModel)==null||(t=e.view)==null?void 0:t.widthBreakpoint,a=r?s.undock:s.dock;return n!=="xsmall"&&(i=this.dockOptions)!=null&&i.buttonEnabled?Ve("div",{role:"button","aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(mt.button,mt.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[mt.headerContainerButton]:i},a=Ve(qX,{level:this.headingLevel,class:mt.headerTitle,innerHTML:e}),l=i?Ve("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(mt.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},a):Ve("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(mt.headerContainer,n)},a);return e?l:null}renderCloseIcon(){return Ve("span",{"aria-hidden":"true",class:this.classes(mt.icon,mt.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Ve("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:mt.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Ve("header",{class:mt.header},this.renderTitle(),Ve("div",{class:mt.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?Ve("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:mt.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:a}=r;return a.length?Ve("div",{key:V0("actions-menu-button"),class:this.classes(mt.button,mt.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},Ve("span",{"aria-hidden":"true",class:mt.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?Ve("ul",{id:e,role:"menu","aria-labelledby":t,key:V0("actions"),class:mt.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?Ve("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:mt.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Ve("section",{key:V0("navigation"),class:this.classes(mt.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,a={[mt.footerHasPagination]:e,[mt.footerHasActions]:s,[mt.footerHasActionsMenu]:n};return e||s?Ve("div",{key:V0("feature-buttons"),class:this.classes(mt.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=om(e.selectedFeatures,{total:t.length});return Ve("section",{key:V0("menu"),class:mt.featureMenu},Ve("strong",{class:mt.featureMenuHeader},r),Ve("nav",{bind:this,class:mt.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:zz},this.renderFeatureMenu(),Ve("div",{class:mt.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?Ve("div",{class:mt.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Ve("div",{key:V0("pointer"),class:mt.pointer,role:"presentation"},Ve("div",{class:this.classes(mt.pointerDirection,mt.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:a,contentCollapsed:l,visibleElements:p}=this,{title:y}=this.viewModel,b=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",x=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",A={[mt.shadow]:e,[mt.isCollapsible]:n,[mt.isCollapsed]:l};return Ve("div",{class:this.classes(mt.main,mt.widget,A),tabIndex:p.closeButton?null:-1,role:"dialog","aria-labelledby":y?r:"","aria-describedby":a&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},b?this.renderFooter():null,b?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),x?this.renderFooter():null,x?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=(e=this.viewModel)==null?void 0:e.content;return t?typeof t=="string"?Ve("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Ve("span",{key:"text",class:mt.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[mt.iconLoading]:e.active,[mt.rotating]:e.active,[mt.icon]:!!t,[mt.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),Ve("span",{key:"icon","aria-hidden":"true",class:this.classes(mt.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[mt.action]:t.type!=="toggle",[mt.actionToggle]:t.type==="toggle",[mt.actionToggleOn]:t.type==="toggle"&&t.value,[mt.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],a=i==="menu-item"?Ve("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(mt.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):Ve("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(mt.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,a=e===n,l={[mt.featureMenuSelected]:a},p=a?Ve("span",{key:V0(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:mt.iconCheckMark}):null,y=Ve("span",{innerHTML:e.title||r.untitled});return Ve("li",{role:"menuitem",tabIndex:-1,key:V0(`feature-menu-feature-${s}`),class:this.classes(l,mt.featureMenuItem),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Ve("span",{class:mt.featureMenuTitle},y,p))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Ve("ol",{class:mt.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,a=s==="zoom-to-feature"?om(e.title,{messages:t}):s==="remove-selected-feature"?om(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?om(e.title,{messages:t}):e.title;return a&&n?om(a,n):a}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:mt.iconDefaultAction;return n&&i?om(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?om(r,i):r}_createFeatureUpdatedAnimation(){return g5e("enter",mt.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(ms(i,["uid","active","className","disabled","id","title","image","visible"],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new kt:t.slice(0,i),menuActions:r?new kt:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;var i,r;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){kb(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){kb(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=kb(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=kb(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(p=>p.uid===r);if(!i)return;const a=i.querySelectorAll("li"),l=a.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(n+1+l)%l].focus()):(e.stopPropagation(),a[(n-1+l)%l].focus())}_handleMainKeyup(e){const t=kb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await qT(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ms(this,"viewModel.selectedFeatureIndex",(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,sse)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const a=n.padding;return s==="right"&&r.x+i/2>n.width-a.right||s==="left"&&r.x-i/2<a.left||s==="top"&&r.y-t<a.top||s==="bottom"&&r.y+t>n.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:a}=s;if(J(n)||!a||!i)return"top-center";if(!this._isScreenLocationWithinView(n,a))return this._get("currentAlignment")||"top-center";function l(B){return parseInt(B.replace(/[^-\d\.]/g,""),10)}const p=r?window.getComputedStyle(r,null):null,y=p?l(p.getPropertyValue("max-height")):0,b=p?l(p.getPropertyValue("height")):0,{height:x,width:A}=i.getBoundingClientRect(),M=A+t,P=Math.max(x,y,b)+t,$=this._isOutsideView({popupHeight:P,popupWidth:M,screenLocation:n,side:"right",view:a}),k=this._isOutsideView({popupHeight:P,popupWidth:M,screenLocation:n,side:"left",view:a}),z=this._isOutsideView({popupHeight:P,popupWidth:M,screenLocation:n,side:"top",view:a}),G=this._isOutsideView({popupHeight:P,popupWidth:M,screenLocation:n,side:"bottom",view:a});return k?z?"bottom-right":"top-right":$?z?"bottom-left":"top-left":z?G?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Uy(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if(e!=="auto")return e;const i=(t=this.viewModel)==null?void 0:t.view,r=Uy(this.container)?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:a}=i;return a&&n<=a.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,a=r/2,l=i.height-t,p=i.width-e,{padding:y}=this.view;return s==="bottom-center"?{top:t+n-y.top,left:e-a-y.left}:s==="top-left"?{bottom:l+n-y.bottom,right:p+n-y.right}:s==="bottom-left"?{top:t+n-y.top,right:p+n-y.right}:s==="top-right"?{bottom:l+n-y.bottom,left:e+n-y.left}:s==="bottom-right"?{top:t+n-y.top,left:e+n-y.left}:s==="top-center"?{bottom:l+n-y.bottom,left:e-a-y.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(J(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,a]=t,{width:l,height:p}=i;return r<=l&&n>l||r>l&&n<=l||s<=p&&a>p||s>p&&a<=p}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],a=[];n[0]=e[0]-r,n[1]=e[1]-s,a[0]=t[0]-r,a[1]=t[1]-s;const{dockOptions:l}=this,p=l.breakpoint;this._dockingThresholdCrossed(n,a,p)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const r=e.breakpoint,s=(t=this.viewModel)==null||(i=t.view)==null?void 0:i.ui;if(!s)return!1;const{width:n,height:a}=s;if(isNaN(n)||isNaN(a))return!1;const l=r.hasOwnProperty("width")&&n<=r.width,p=r.hasOwnProperty("height")&&a<=r.height;return l||p}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?om(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,nse),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new NHe({view:e}),e.ui.add(this._spinner,{key:nse,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};_([S({readOnly:!0})],hi.prototype,"actionsMenuId",null),_([S({readOnly:!0})],hi.prototype,"actionsMenuButtonId",null),_([S({readOnly:!0})],hi.prototype,"featureMenuId",null),_([S({readOnly:!0})],hi.prototype,"titleId",null),_([S({readOnly:!0})],hi.prototype,"contentId",null),_([S({readOnly:!0})],hi.prototype,"hasContent",null),_([S({readOnly:!0})],hi.prototype,"featureNavigationVisible",null),_([S({readOnly:!0})],hi.prototype,"collapsible",null),_([S({readOnly:!0})],hi.prototype,"featureMenuVisible",null),_([S({readOnly:!0})],hi.prototype,"contentCollapsed",null),_([S({readOnly:!0})],hi.prototype,"dividedActions",null),_([oi("viewModel.actions")],hi.prototype,"actions",void 0),_([S()],hi.prototype,"actionsMenuOpen",null),_([S()],hi.prototype,"alignment",void 0),_([oi("viewModel.autoCloseEnabled")],hi.prototype,"autoCloseEnabled",void 0),_([oi("viewModel.autoOpenEnabled")],hi.prototype,"autoOpenEnabled",void 0),_([oi("viewModel.defaultPopupTemplateEnabled")],hi.prototype,"defaultPopupTemplateEnabled",void 0),_([oi("viewModel.content")],hi.prototype,"content",void 0),_([S()],hi.prototype,"collapsed",void 0),_([S()],hi.prototype,"collapseEnabled",void 0),_([S({readOnly:!0})],hi.prototype,"currentAlignment",null),_([S({readOnly:!0})],hi.prototype,"currentDockPosition",null),_([S()],hi.prototype,"dockOptions",null),_([S()],hi.prototype,"dockEnabled",void 0),_([oi("viewModel.featureCount")],hi.prototype,"featureCount",void 0),_([S()],hi.prototype,"featureMenuOpen",void 0),_([oi("viewModel.features")],hi.prototype,"features",void 0),_([oi("viewModel.goToOverride")],hi.prototype,"goToOverride",void 0),_([S()],hi.prototype,"headingLevel",void 0),_([oi("viewModel.highlightEnabled")],hi.prototype,"highlightEnabled",void 0),_([oi("viewModel.location")],hi.prototype,"location",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],hi.prototype,"label",void 0),_([S()],hi.prototype,"maxInlineActions",void 0),_([S(),Zc("esri/widgets/Popup/t9n/Popup")],hi.prototype,"messages",void 0),_([S(),Zc("esri/t9n/common")],hi.prototype,"messagesCommon",void 0),_([oi("viewModel.promises")],hi.prototype,"promises",void 0),_([oi("viewModel.selectedFeature")],hi.prototype,"selectedFeature",void 0),_([oi("viewModel.selectedFeatureIndex")],hi.prototype,"selectedFeatureIndex",void 0),_([S({readOnly:!0})],hi.prototype,"selectedFeatureWidget",null),_([S()],hi.prototype,"spinnerEnabled",void 0),_([oi("viewModel.title")],hi.prototype,"title",void 0),_([oi("viewModel.updateLocationEnabled")],hi.prototype,"updateLocationEnabled",void 0),_([oi("viewModel.view")],hi.prototype,"view",void 0),_([S({type:Dve}),A5e(["triggerAction","trigger-action"])],hi.prototype,"viewModel",void 0),_([oi("viewModel.visible")],hi.prototype,"visible",void 0),_([S()],hi.prototype,"visibleElements",void 0),_([_i("visibleElements")],hi.prototype,"castVisibleElements",null),_([zu()],hi.prototype,"_close",null),_([zu()],hi.prototype,"_toggleDockEnabled",null),_([zu()],hi.prototype,"_toggleFeatureMenu",null),_([zu()],hi.prototype,"_toggleActionsMenu",null),_([zu()],hi.prototype,"_triggerAction",null),_([zu()],hi.prototype,"_selectFeature",null),_([zu()],hi.prototype,"_next",null),_([zu()],hi.prototype,"_previous",null),hi=_([re(Lve)],hi);const hse=hi,H7=[0,0];function Eqe(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return H7[0]=i.left+t.pageXOffset,H7[1]=i.top+t.pageYOffset,H7}function use(e){e&&(Rpe(e),e.parentNode&&e.parentNode.removeChild(e))}function Aqe(e){const t=document.createElement("div");return e.appendChild(t),t}const tA=16,$5=750,Cqe=512,Mqe=2,Rqe=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:tA,time:$5},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",r=>{const s=this.surface;s&&s.setAttribute("data-cursor",r)}),this.watch("interacting",r=>{const s=this.surface;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(this.watch("ui",(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),use(this.root),this._set("root",null),_ee(this.userContent,r),use(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",_ee(i,n),i.appendChild(n),this._set("userContent",n);const a=document.createElement("div");a.className="esri-view-root",i.insertBefore(a,i.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const p=new Xte;a.appendChild(p.surface),this._set("overlay",p),p.watch("needsRender",y=>{y&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=L2({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(vi(()=>this.size,y=>{const[b,x]=y,A="esri-view-surface--inset-outline";b>=document.body.clientWidth||x>=document.body.clientHeight?l.classList.add(A):l.classList.remove(A)},No),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new hse({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([vi(()=>this.root,r=>{i.container=r?Aqe(r):null},No),vi(()=>this.popup,(r,s)=>{const n="popup",a="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:a}))},No)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=tA,i.time=$5,this.handles.add([(()=>{const r=()=>{i.freq=tA,i.time=$5};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),L2({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=tA,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const a=this._position();n.freq=a||s?tA:Math.min($5,n.freq*Mqe),!s&&n.freq>=Cqe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,a=this.height;return r===n&&s===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:a,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=Eqe(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return _([S({value:null,cast:i=>OL(i)})],t.prototype,"container",null),_([S({readOnly:!0})],t.prototype,"focused",null),_([S({readOnly:!0})],t.prototype,"height",void 0),_([S({type:hse})],t.prototype,"popup",null),_([S({type:Xte})],t.prototype,"overlay",void 0),_([S({readOnly:!0})],t.prototype,"position",void 0),_([S({readOnly:!0})],t.prototype,"resizing",void 0),_([S({readOnly:!0})],t.prototype,"root",void 0),_([S({value:null,readOnly:!0})],t.prototype,"size",null),_([S({readOnly:!0})],t.prototype,"surface",void 0),_([S({readOnly:!0})],t.prototype,"suspended",void 0),_([S()],t.prototype,"ui",void 0),_([S({readOnly:!0})],t.prototype,"userContent",void 0),_([S({readOnly:!0})],t.prototype,"width",void 0),_([S()],t.prototype,"widthBreakpoint",void 0),t=_([re("esri.views.DOMContainer")],t),t};function Oqe(e){return e&&"focus"in e}const GY=Ge.getLogger("esri.layers.support.ElevationSampler");class Nve{queryElevation(t){return Fve(t.clone(),this)}on(){return Lqe}projectIfRequired(t,i){return kve(t,i)}}class Pqe extends Nve{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=zL(t.tile.extent,i.spatialReference);const s=lh(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return LO(this.extent,i)}elevationAt(t){const i=this.projectIfRequired(t,this.spatialReference);if(J(i))return null;if(!this.contains(t)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return GY.warn("#elevationAt()",`Point used to sample elevation (${t.x}, ${t.y}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(i.x,i.y)}}class cSt extends Nve{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(a=>new Pqe(a,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:a,max:l}=n.demResolution;this.demResolution={min:a,max:l};for(let p=1;p<this.samplers.length;p++){const y=this.samplers[p];this.extent.union(y.extent),this.demResolution.min=Math.min(this.demResolution.min,y.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,y.demResolution.max)}}else this.extent=zL(Mi(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t){const i=this.projectIfRequired(t,this.spatialReference);if(!i)return null;for(const r of this.samplers)if(r.contains(i))return r.elevationAt(i);return GY.warn("#elevationAt()",`Point used to sample elevation (${t.x}, ${t.y}) is outside of the sampler`),this.noDataValue}}function Fve(e,t){const i=kve(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":Iqe(e,i,t);break;case"polyline":$qe(e,i,t);break;case"multipoint":Dqe(e,i,t)}return e}function kve(e,t){if(J(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=Tw(e,t);return r||GY.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function Iqe(e,t,i){e.z=Wt(i.elevationAt(t),0)}function $qe(e,t,i){Ky.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],a=t.paths[s];for(let l=0;l<n.length;l++){const p=n[l],y=a[l];Ky.x=y[0],Ky.y=y[1],r&&(p[3]=p[2]),p[2]=Wt(i.elevationAt(Ky),0)}}e.hasZ=!0}function Dqe(e,t,i){Ky.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],a=t.points[s];Ky.x=a[0],Ky.y=a[1],r&&(n[3]=n[2]),n[2]=Wt(i.elevationAt(Ky),0)}e.hasZ=!0}const Ky=new Gt,Lqe={remove(){}};function uD(e){return e.type==="point"}class Uve{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function zve(e){return"array"in e}function wp(e,t,i="ground"){if(uD(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(zve(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,Wt(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}var Dj;let Mf=Dj=class extends Ye{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Dj({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};_([S({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"cols",void 0),_([S({type:us,json:{write:!0}})],Mf.prototype,"level",void 0),_([S({type:String,json:{write:!0}})],Mf.prototype,"levelValue",void 0),_([S({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"origin",void 0),_([S({type:Number,json:{write:!0}})],Mf.prototype,"resolution",void 0),_([S({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"rows",void 0),_([S({type:Number,json:{write:!0}})],Mf.prototype,"scale",void 0),Mf=Dj=_([re("esri.layers.support.LOD")],Mf);const Bve=Mf;var ry;const dse=new Ui({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Io=ry=class extends Ye{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=It.WebMercator,numLODs:n=24}=e;if(!ml(s)){const x=[];if(i)for(let A=0;A<i.length;A++){const M=i[A];x.push({level:A,scale:M,resolution:M})}else{let A=5e-4;for(let M=n-1;M>=0;M--)x.unshift({level:M,scale:A,resolution:A}),A*=2}return new ry({dpi:96,lods:x,origin:new Gt(0,0,s),size:[r,r],spatialReference:s})}const a=lg(s),l=e.origin?new Gt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new Gt(a?{x:a.origin[0],y:a.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),p=96,y=1/(lh(s)*39.37*p),b=[];if(i)for(let x=0;x<i.length;x++){const A=i[x],M=A*y;b.push({level:x,scale:A,resolution:M})}else{let x=PW(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const A=Math.ceil(n/t);b.push({level:0,scale:x,resolution:x*y});for(let M=1;M<A;M++){const P=x/2**t,$=P*y;b.push({level:M,scale:P,resolution:$}),x=P}}return new ry({dpi:p,lods:b,origin:l,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=lg(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return Gt.fromJSON(ie({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,a;if(typeof t=="number")n=t,a=i;else if(Vo(t.spatialReference,this.spatialReference))n=t.x,a=t.y,r=i;else{const y=Tw(t,this.spatialReference);if(J(y))return null;n=y.x,a=y.y,r=i}const l=s.resolution*this.size[0],p=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Mi()}),r.level=e,r.row=Math.floor((this.origin.y-a)/p+.001),r.col=Math.floor((n-this.origin.x)/l+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=ry.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===ry.ExtrapolateOptions.POWER_OF_TWO){const a=this.lods[this.lods.length-1];a.level<e.level&&(i=a)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Mi()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return ry.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],a=n.resolution*t;i.push(new Bve({level:n.level,scale:n.scale,resolution:a}))}return new ry({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};_([S({type:Number,json:{write:!0}})],Io.prototype,"compressionQuality",void 0),_([S({type:Number,json:{write:!0}})],Io.prototype,"dpi",void 0),_([S({type:String,json:{read:dse.read,write:dse.write,origins:{"web-scene":{read:!1,write:!1}}}})],Io.prototype,"format",void 0),_([S({readOnly:!0})],Io.prototype,"isWrappable",null),_([S({type:Gt,json:{write:!0}})],Io.prototype,"origin",void 0),_([wt("origin")],Io.prototype,"readOrigin",null),_([S({type:[Bve],value:null,json:{write:!0}})],Io.prototype,"lods",null),_([S({readOnly:!0})],Io.prototype,"minScale",void 0),_([S({readOnly:!0})],Io.prototype,"maxScale",void 0),_([S({readOnly:!0})],Io.prototype,"scales",void 0),_([S({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Io.prototype,"size",void 0),_([wt("size",["rows","cols"])],Io.prototype,"readSize",null),_([Et("size",{cols:{type:us},rows:{type:us}})],Io.prototype,"writeSize",null),_([S({type:It,json:{write:!0}})],Io.prototype,"spatialReference",void 0),Io=ry=_([re("esri.layers.support.TileInfo")],Io),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Io||(Io={}));const j9=Io,Nqe=12;class gs{constructor(t){const i=gs.checkUnsupported(t);if(L(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=J2(this.spatialReference)||S0(this.spatialReference)||E0(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce(function(y,b,x){return b.level<y.min&&(y.min=b.level,y.minIndex=x),y.max=Math.max(y.max,b.level),y},{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],a=2**n.level;let l=n.resolution*a,p=n.scale*a;this.levels=new Array(s.max+1);for(let y=0;y<this.levels.length;y++)this.levels[y]={resolution:l,scale:p,tileSize:[l*r.size[0],l*r.size[1]]},l/=2,p/=2}clone(){return new gs(this.toTileInfo())}toTileInfo(){return new j9({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],a=n.tileSize[0],l=n.tileSize[1];s[0]=this.origin[0]+r*a,s[2]=s[0]+a,s[3]=this.origin[1]-i*l,s[1]=s[3]-l}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=Hee(t[0]),i[1]=S6(t[1]),i[2]=Hee(t[2]),i[3]=S6(t[3])):this._isGCS&&(i[0]=xi(t[0]),i[1]=xi(t[1]),i[2]=xi(t[2]),i[3]=xi(t[3]))}getExtentGeometry(t,i,r,s=new ki){return this.getExtent(t,i,r,Kp),s.spatialReference=this.spatialReference,s.xmin=Kp[0],s.ymin=Kp[1],s.xmax=Kp[2],s.ymax=Kp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof gs)){if(gs.checkUnsupported(t))return!1;t=new gs(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!_2(t.origin[0],this.origin[0],s)||!_2(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*Nqe,_2(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(J(t)||n[0]===0||n[1]===0)return s;gs.computeRowColExtent(t,n,this.origin,Kp);let a=Kp[1],l=Kp[3],p=Kp[0],y=Kp[2];const b=y-p,x=l-a;if(b*x>r){const A=Math.floor(Math.sqrt(r));x>A&&(a=a+Math.floor(.5*x)-Math.floor(.5*A),l=a+A),b>A&&(p=p+Math.floor(.5*b)-Math.floor(.5*A),y=p+A)}for(let A=a;A<l;A++)for(let M=p;M<y;M++)s.push([0,A,M]);return L(i)&&(i[0]=this.origin[0]+p*n[0],i[1]=this.origin[1]-l*n[1],i[2]=this.origin[0]+y*n[0],i[3]=this.origin[1]-a*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(function(s){return!xOe(s.resolution,r/2**s.level)})}static hasGapInLevels(t){const i=t.lods.map(function(r){return r.level});i.sort(function(r,s){return r-s});for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new Se("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return J(t)?jY():t.lods.length<1?new Se("tilingscheme:generic","Tiling scheme must have at least one level"):gs.isPowerOfTwo(t)?gs.hasGapInLevels(t)?new Se("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):gs.tileSizeSupported(t)?gs.hasOriginPerLODs(t)?new Se("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new Se("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new Se("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=lh(i),a=1.2*Math.max(r,s),l=256,p=96,y=.0254,b=new gs(new j9({size:[l,l],origin:{x:t[0]-.5*(a-r),y:t[3]+.5*(a-s)},lods:[{level:0,resolution:a/l,scale:1/(l/p*y/(a*n))}],spatialReference:i}));return b.ensureMaxLod(20),b}static makeWebMercatorAuxiliarySphere(t){const i=new gs(gs.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new gs(new j9({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function jY(){return new Se("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}gs.WebMercatorAuxiliarySphereTileInfo=new j9({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:It.WebMercator},spatialReference:It.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),gs.WebMercatorAuxiliarySphere=gs.makeWebMercatorAuxiliarySphere(19);const Kp=Mi(),Q3=64,e4=512,Fqe=2.5,MR=TOe(Iz/10),Vve=4,kqe=4,H9=e=>e<4?3:kqe,Gve=Mi();gs.WebMercatorAuxiliarySphere.getExtent(0,0,0,Gve);const Uqe=Mi([-180,-90,180,90]),zqe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Bqe="Surface extent is too large for tile resolution at level 0.",jve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",dD=5,pse=Ge.getLogger("esri.views.support.GroundViewElevationSampler");let sy=class extends ps.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=MR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;return L(e.extent)&&e.spatialReference?zL(e.extent,e.spatialReference):null}elevationAt(e){const t=e.spatialReference,i=this.spatialReference;if(!Mp(t,i)){const r=t?t.wkid:"unknown";return pse.error(`Cannot sample elevation at a location with spatial reference (${r}) different from the view (${i.wkid})`),null}if(J(this.extent)||!LO(this.extent,e)){const r=L(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return pse.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${r})`),this.noDataValue}return wp(this.view.elevationProvider,e)}queryElevation(e){return Fve(e.clone(),this)}};_([S({readOnly:!0})],sy.prototype,"demResolution",void 0),_([S({readOnly:!0})],sy.prototype,"extent",null),_([S({readOnly:!0})],sy.prototype,"noDataValue",void 0),_([S({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],sy.prototype,"spatialReference",void 0),_([S({constructOnly:!0})],sy.prototype,"view",void 0),sy=_([re("esri.views.support.GroundViewElevationSampler")],sy);const Vqe=sy;let ny=class extends st{constructor(e){super(e),this.handles=new Ei,this.view=null,this.layerViews=new kt}initialize(){this.handles.add(BX(this,"view.map.ground",e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Vqe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>e.watch("updating",()=>this._updateUpdating(),!0)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};_([S({readOnly:!0})],ny.prototype,"elevationSampler",null),_([S({type:Boolean,readOnly:!0})],ny.prototype,"updating",null),_([S({constructOnly:!0})],ny.prototype,"view",void 0),_([S({type:kt,readOnly:!0})],ny.prototype,"layerViews",void 0),_([S({readOnly:!0})],ny.prototype,"suspended",null),ny=_([re("esri.views.GroundView")],ny);const Gqe=ny,jqe=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:a,clientOnlyGraphics:l}=await this._prepareFetchPopupFeatures(i,r),p=Promise.resolve(l),y=this._queryLayerPopupFeatures(n,a,r),b=y.map(x=>x.promise);return{location:s,clientOnlyGraphics:l,allGraphicsPromise:due([p,...b]).then(x=>Array.from(new Set(x.flat()))),promisesPerLayerView:y}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:a})=>{const l={clientGraphics:a,event:L(s)?s.event:null,signal:L(s)?s.signal:null,defaultPopupTemplateEnabled:!!L(s)&&!!s.defaultPopupTemplateEnabled},p=n.fetchPopupFeatures(i,l);return{layerView:n,promise:p}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(L(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:a}=await this._popupHitTestGraphics(i,r),l=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:p,clientOnlyGraphics:y}=this._graphicsPerFetchPopupLayerView(s,l);return{clientOnlyGraphics:y,layerViewsAndGraphics:p,queryArea:n,location:a}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),a=s.filter(p=>this._isValidPopupGraphic(p.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(p=>p.graphic),queryArea:n,location:n||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),L(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return L(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,a=r.map(l=>{const p=[];return"layer"in l?n.set(l.layer,p):n.set(l.graphics,p),{layerView:l,graphics:p}});for(const l of i){const p=n.get(l.layer)||n.get(l.sourceLayer)||null;p?p.push(l):s.push(l)}return{layerViewsAndGraphics:a,clientOnlyGraphics:s}}};return t=_([re("esri.views.PopupView")],t),t};async function Hqe(e){if(!e)return;const t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,i=await hpe("esri/t9n/basemaps");return i[e]||i[t]}const Lj={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return hr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return hr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return hr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return hr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return hr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return hr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return hr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return hr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return hr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return hr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return hr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return hr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return hr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return hr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return hr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return hr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},qqe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),Wqe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function Xqe(e){return e.layerContainerType==="basemap"?qqe:e.layerContainerType==="operational-layers"?Wqe:null}function HY(e){return!(e.type!=="feature"||e.url||!e.source||e.source.type!=="memory")}function Yqe(e,t){if(t.restrictedWebMapWriting){const i=Xqe(t);return!L(i)||i.has(e.type)&&!HY(e)}return!0}function Jqe(e,t){if(HY(e)){const i=iE("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&q7(e,r)}else e.type==="stream"?q7(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&q7(e,t)}function q7(e,t){"maxScale"in e&&(t.maxScale=h6(e.maxScale)),"minScale"in e&&(t.minScale=h6(e.minScale))}function Zqe(e,t){if(Jqe(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=h6(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(HY(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function fse(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new Se("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(Yqe(e,i)){const r={};return e.write(r,i)?r:null}return L(t)&&Zqe(e,t=Fe(t)),t}var q9;let Kqe=0;const W7=Ge.getLogger("esri.Basemap");let Ru=q9=class extends DO(d0){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Kqe++,this.baseLayers=new kt,this.referenceLayers=new kt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&W7.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{W7.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const i=this.referenceLayers.removeAll();for(const r of i)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(e=this.portalItem)==null||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=ie({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Eg(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=qe(ie({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=fse(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);L(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=fse(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);L(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Eg(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return dX(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new q9({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=ie({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=Fe(i);return r.url&&l0(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&l0(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;Gi(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(Hqe(n).then(a=>{a&&this.read({title:a},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:a}=await import("./layersCreator.589b64ff.js"),l=[];if(Gi(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const p={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},y=a(this.baseLayers,e.baseMapLayers.filter(x=>!x.isReference),p);l.push(y);const b=a(this.referenceLayers,e.baseMapLayers.filter(x=>x.isReference),p);l.push(b)}await bo(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=Gn(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||ha.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||ha.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=Lj[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),QT(W7,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return q9.fromJSON(t)}return null}};_([S({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:kt}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Ru.prototype,"baseLayers",null),_([S({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ru.prototype,"id",void 0),_([S({type:SS})],Ru.prototype,"portalItem",void 0),_([S()],Ru.prototype,"referenceLayers",null),_([S({readOnly:!0})],Ru.prototype,"resourceInfo",void 0),_([S({type:It})],Ru.prototype,"spatialReference",void 0),_([S()],Ru.prototype,"thumbnailUrl",void 0),_([S({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ru.prototype,"title",void 0),_([Et("title")],Ru.prototype,"writeTitle",null),Ru=q9=_([re("esri.Basemap")],Ru);const ES=Ru;var Qqe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ES});let m3=class extends zg(kt){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Oue(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=L(this.getCollections)?this.getCollections():null;if(J(e))return void this.removeAll();let t=0;for(const i of e)L(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new kt(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};_([S()],m3.prototype,"getCollections",void 0),_([S()],m3.prototype,"getChildrenFunction",void 0),_([S()],m3.prototype,"itemFilterFunction",void 0),m3=_([re("esri.core.CollectionFlattener")],m3);const MT=m3;function eWe(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&e!=null&&(t=e.capabilities)!=null&&t.operations&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const mse=Ge.getLogger("esri.support.basemapUtils");function tWe(){return{}}function iWe(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function qY(e,t){var i;let r;if(typeof e=="string"){if(!(e in Lj)){const s=Object.entries(Lj).filter(([n,a])=>qr.apiKey&&!a.classic||!qr.apiKey&&a.classic&&!a.deprecated).map(([n])=>`"${n}"`).join(", ");return mse.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${s}`),null}t&&(r=t[e]),r||(r=ES.fromId(e),t&&(t[e]=r))}else r=Ys(ES,e);return(i=r)!=null&&i.destroyed&&(mse.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function rWe(e,t=null){const i=qY(e);if(!i)return null;const r=new ES({id:i.id,title:i.title,baseLayers:i.baseLayers.slice(),referenceLayers:i.referenceLayers.slice()});return t&&(r.baseLayers=gse(r.baseLayers,t.baseLayers),r.referenceLayers=gse(r.referenceLayers,t.referenceLayers)),r.load().catch(()=>{}),r.portalItem=i.portalItem,r}function gse(e,t){const i=new kt;return e.forEach(r=>{const s=t.find(n=>sWe(yse(r),yse(n)))||r;i.some(n=>n===s)?i.push(r):i.push(s)}),i}function yse(e){var t,i;return{type:e.type,url:nWe("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!L(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(i=e.activeLayer)==null?void 0:i.id:void 0}}function sWe(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(L(e.activeLayerId)||L(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(L(e.sublayers)||L(t.sublayers)){if(J(e.sublayers)||J(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let i=0;i<e.sublayers.length;i++){const r=e.sublayers.at(i),s=t.sublayers.at(i);if(r.id!==s.id||r.visible!==s.visible)return!1}}return!0}function nWe(e){return e?cd(e).replace(/^\s*https?:/i,"").toLowerCase():""}const oWe=Ge.getLogger("esri.support.groundUtils"),vse={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function aWe(e){let t=null;if(typeof e=="string")if(e in vse){const i=vse[e];t=new hS({resourceInfo:{data:{layers:[i]}}})}else oWe.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Ys(hS,e);return t}function lWe(e){return e&&e.type==="group"}function Nj(e,t,i){let r,s;if(e)for(let n=0,a=e.length;n<a;n++){if(r=e.getItemAt(n),r[t]===i)return r;if(lWe(r)&&(s=Nj(r.layers,t,i),s))return s}}const _se=Ge.getLogger("esri.support.LayersMixin"),cWe=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new kt;const r=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},s=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||_se.error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},n=a=>{a.parent=null,this.layerRemoved(a)};this.layers.on("before-add",a=>r(a.item)),this.layers.on("after-add",a=>s(a.item)),this.layers.on("after-remove",a=>n(a.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Eg(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof JO){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else au(i)?i.then(n=>{this.destroyed||this.add(n,r)}):_se.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return Nj(this.layers,"id",i)}findLayerByUid(i){return Nj(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return _([S()],t.prototype,"layers",null),t=_([re("esri.support.LayersMixin")],t),t},Hve="esri.support.TablesMixin",hWe=Ge.getLogger(Hve);function uWe(e){return e&&e.type==="group"}function Fj(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if(uWe(n)){const a=Fj(n.tables,t,i);if(a)return a}}}const dWe=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new kt,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&hWe.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Eg(i,this._get("tables")))}findTableById(i){return Fj(this.tables,"id",i)}findTableByUid(i){return Fj(this.tables,"uid",i)}};return _([S()],t.prototype,"tables",null),t=_([re(Hve)],t),t};let Rf=class extends dWe(cWe(ps.EventedMixin(st))){constructor(e){super(e),this.allLayers=new MT({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=new MT({getCollections:()=>[this.tables,this.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}}),this.basemap=null,this.editableLayers=new MT({getCollections:()=>[this.allLayers],itemFilterFunction:eWe}),this.ground=new hS,this._basemapCache=tWe()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),iWe(this._basemapCache),this._basemapCache=null}castBasemap(e){return qY(e,this._basemapCache)}castGround(e){const t=aWe(e);return J(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};_([S({readOnly:!0,dependsOn:[]})],Rf.prototype,"allLayers",void 0),_([S({readOnly:!0})],Rf.prototype,"allTables",void 0),_([S({type:ES})],Rf.prototype,"basemap",void 0),_([_i("basemap")],Rf.prototype,"castBasemap",null),_([S({readOnly:!0})],Rf.prototype,"editableLayers",void 0),_([S({type:hS,nonNullable:!0})],Rf.prototype,"ground",void 0),_([_i("ground")],Rf.prototype,"castGround",null),Rf=_([re("esri.Map")],Rf);const qve=Rf;let O2=class extends vM{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};_([rW({Type:gl,ensureType:Ys(gl)})],O2.prototype,"itemType",void 0),O2=_([re("esri.support.GraphicsCollection")],O2);let oy=class extends st{constructor(e){super(e),this.view=null,this.baseLayerViews=new kt,this.referenceLayerViews=new kt,this._loadingHandle=Pi(this,"view.map.basemap",t=>{t&&t.load().catch(()=>{})})}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var e,t;if(this.view&&this.view.suspended)return!1;const i=(e=this.view)==null||(t=e.map)==null?void 0:t.basemap;return!!i&&!!i.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};_([S({constructOnly:!0})],oy.prototype,"view",void 0),_([S({readOnly:!0})],oy.prototype,"baseLayerViews",void 0),_([S({readOnly:!0})],oy.prototype,"referenceLayerViews",void 0),_([S({readOnly:!0})],oy.prototype,"suspended",null),_([S({type:Boolean,readOnly:!0})],oy.prototype,"updating",null),oy=_([re("esri.views.BasemapView")],oy);const pWe=Ge.getLogger("esri.views.LayerViewManager");class fWe{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=gv(),this._started=!1,this.done=!1,ka(this._controller.signal,()=>{const s=new Se("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{var s,n;let a,l;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)a=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new Se("layer:view-not-supported","No layerview implementation was found");const y=await this.layerViewImporter.importLayerView(i);Gi(t),a="default"in y?new y.default({layer:i,view:r}):new y({layer:i,view:r})}const p=()=>{l=_o(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=ka(t,p),Gi(t);try{await a.when()}catch(y){throw p(),y}if(!((s=this._map)==null||(n=s.allLayers)==null?void 0:n.includes(i)))return p(),void this._deferred.reject(new Se("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new Se("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}}let Ou=class extends xv{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new t0,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var t;const i=(t=this.view.map)==null?void 0:t.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(J(this._workPromise)&&(this._workPromise=gv()),this.handles.remove("reschedule"),this.handles.add(EO(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var t,i,r;const s=this.view.map;if(this._map!==s&&(this.clear(),this._map=s),J(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=new MT({getCollections:()=>this._rootCollectionNames.map(p=>this.get(p)),getChildrenFunction:p=>p&&"layers"in p?p.layers:null});if(!n)return this._workPromise.resolve(),void(this._workPromise=null);for(const p of n)this._createLayerView(p);this._refreshCollections();for(const[p,y]of this._layerLayerViewInfoMap)n.includes(p)||(this._layerLayerViewInfoMap.delete(y.layer),y.destroy());const a=n.filter(p=>p.type==="group").map(p=>p.layers),l=[s==null||(t=s.ground)==null?void 0:t.layers,s==null||(i=s.basemap)==null?void 0:i.baseLayers,s==null||(r=s.basemap)==null?void 0:r.referenceLayers,s==null?void 0:s.layers,...a].filter(p=>!!p);this.handles.add(l.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([av(()=>{var e,t;return(e=this.view)==null||(t=e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),vi(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Oa)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return L(this._workPromise)||this._watchUpdatingTracking.updating||rn(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new Se("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const a=n.layerView;a.layer=s,a.parent=i,t.getItemAt(r)!==a&&t.splice(r,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new fWe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Cs(i)||i.name==="cancelled:layerview-create")||pWe.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};_([S()],Ou.prototype,"_workPromise",void 0),_([S({readOnly:!0})],Ou.prototype,"_watchUpdatingTracking",void 0),_([S({readOnly:!0})],Ou.prototype,"_layersToLayerViews",null),_([S({readOnly:!0})],Ou.prototype,"_rootCollectionNames",null),_([S()],Ou.prototype,"layerViewImporter",void 0),_([S()],Ou.prototype,"supportsGround",void 0),_([S({readOnly:!0})],Ou.prototype,"updating",null),_([S({readOnly:!0})],Ou.prototype,"updatingRemaining",null),_([S({constructOnly:!0})],Ou.prototype,"view",void 0),Ou=_([re("esri.views.LayerViewManager")],Ou);const mWe=Ou;let xh=class extends st{constructor(e){super(e),this.factor=1.5,this.offset=dd(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};_([S({type:Number})],xh.prototype,"factor",void 0),_([S({nonNullable:!0})],xh.prototype,"offset",void 0),_([S()],xh.prototype,"position",void 0),_([S({type:Number,range:{min:0}})],xh.prototype,"size",void 0),_([S()],xh.prototype,"maskUrl",void 0),_([S()],xh.prototype,"maskEnabled",void 0),_([S()],xh.prototype,"overlayUrl",void 0),_([S()],xh.prototype,"overlayEnabled",void 0),_([S({readOnly:!0})],xh.prototype,"version",null),_([S({type:Boolean})],xh.prototype,"visible",void 0),xh=_([re("esri.views.Magnifier")],xh);const Wve=xh;let W9=class extends st{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new bse(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new bse(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=zn(t.signal);if(i&&!t.abortCallback)t.reject(rr());else{const r=i?t.abortCallback(rr()):t.callback(e);au(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=rr();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};_([S()],W9.prototype,"running",void 0),W9=_([re("esri.layers.support.PromiseQueue")],W9);class bse{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let LC=class extends st{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};_([S()],LC.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),_([S()],LC.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),LC=_([re("esri.views.support.DebugFlags")],LC);const gWe=new LC,yWe=Ge.getLogger("esri.views.support.Scheduler");function vWe(e){return new pD.Scheduler({nowFunc:e})}var ii;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(ii||(ii={}));const Gf=0,wse=new Map([[ii.RESOURCE_CONTROLLER,Gf],[ii.SLIDE,Gf],[ii.STREAM_DATA_LOADER,Gf],[ii.ELEVATION_QUERY,Gf],[ii.TERRAIN_SURFACE,1],[ii.SURFACE_GEOMETRY_UPDATES,1],[ii.GRAPHICS_CORE,2],[ii.I3S_CONTROLLER,2],[ii.POINT_CLOUD_LAYER,2],[ii.FEATURE_TILE_FETCHER,2],[ii.OVERLAY,4],[ii.STAGE,4],[ii.GRAPHICS_DECONFLICTOR,4],[ii.FILTER_VISIBILITY,4],[ii.SCALE_VISIBILITY,4],[ii.FRUSTUM_VISIBILITY,4],[ii.POINT_OF_INTEREST_FREQUENT,6],[ii.POINT_OF_INTEREST_INFREQUENT,30],[ii.LABELER,8],[ii.FEATURE_QUERY_ENGINE,8],[ii.FEATURE_TILE_TREE,16],[ii.FEATURE_TILE_TREE_ACTIVE,Gf],[ii.ELEVATION_ALIGNMENT,12],[ii.TEXT_TEXTURE_ATLAS,12],[ii.CLOUDS_GENERATOR,12],[ii.TEXTURE_UNLOAD,12],[ii.LINE_OF_SIGHT_TOOL,16],[ii.LINE_OF_SIGHT_TOOL_INTERACTIVE,Gf],[ii.SNAPPING,Gf],[ii.SHADOW_ACCUMULATOR,30]]);function xse(e){return wse.has(e)?wse.get(e):typeof e=="number"?e:1}var po;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(po||(po={}));const Tse=6.5,Sse=1,_We=30,Ese=1e3/30,Ase=100,Cse=.9;var pD,o_;(function(e){let t=class extends st{constructor(s){super(s),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new ov("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=po.INTERACTING,this._tasks=new Ci,this._runQueue=new Ci,this._load=0,this._idleStateCallbacks=new Ci,this._idleUpdatesStartFired=!1,this._maxReschedule=D5,this._forceTask=!1,this._debug=!1,this._debugHandle=vi(()=>gWe.SCHEDULER_LOG_SLOW_TASKS,l=>this._debug=l,No),this._budget=new r(s.nowFunc);for(const l of Object.keys(ii))this.performanceInfo.tasks.set(ii[l],new ov(ii[l]));let n;const a=this;this._test={get state(){return Wt(n,a._state)},set state(l){n=l},FRAME_SAFETY_BUDGET:Tse,INTERACTING_BUDGET:Ese,IDLE_BUDGET:Ase,get budget(){return a._budget.budget},usedBudget:0,setBudget:l=>a._budget=l,updateTask:l=>this._updateTask(l),getState:l=>this._getState(l),getRuntime:l=>this._getRuntime(l),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),_o(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=D5,this._schedule(),this.frame()))}))}registerTask(s,n){const a=xse(s),l=new i(this,s,n,a);return this._tasks.push(l),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new ov(s)),l}registerIdleStateCallbacks(s,n){const a={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(a),this.state===po.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(p){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===po.IDLE&&p()),a.idleBegin=p},set idleEnd(p){a.idleEnd=p}}}get now(){return this.nowFunc()}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==po.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return J(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=Tse,a=s.frameDuration,l=Sse;switch(this.state){case po.IDLE:n=0,a=Math.max(Ase,s.frameDuration),l=_We;break;case po.INTERACTING:a=Math.max(Ese,s.frameDuration);case po.ANIMATING:}return a=a-s.elapsedFrameTime-n,this.state!==po.IDLE&&a<Sse&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._maxReschedule=D5,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case po.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case po.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return o_.SCHEDULED;let n=o_.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?n=o_.READY:n!==o_.READY&&(n=o_.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(a=>{a.name===s&&(n+=a.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((a,l)=>{n+=a>1?` ${a}x ${l}`:` ${l}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,a)=>a.needsUpdate?++n:n,0);this._load=this._load*Cse+s*(1-Cse)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Gf&&s.needsUpdate&&!this._runQueue.some(n=>n===s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Gf&&(s=!0,n=Math.max(n,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===D5&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)}catch(p){yWe.error(`Exception in task "${a.name}"`,p)}a.schedulePriority=a.basePriority;const l=this._budget.now()-n;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",a.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(p=>p.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(ii))this._frameTaskTimes.set(ii[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,a)=>this.performanceInfo.tasks.get(a).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};_([S()],t.prototype,"updating",void 0),_([S()],t.prototype,"nowFunc",void 0),t=_([re("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends st{constructor(s,n,a,l){super({}),this._scheduler=s,this.name=n,this._basePriority=l,this.runtime=0,this._queue=new W9,this._handles=new Ei,this.schedulePriority=this._basePriority,this.task=L(a)?a:this._queue,this._handles.add(CO(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(SE),this._scheduler.removeTask(this),this.schedule=AS.schedule,this.reschedule=AS.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=xse(s);this._basePriority!==Gf&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,a){return this._queue.push(s,n,a)}reschedule(s,n,a){return this._queue.unshift(s,n,a)}processQueue(s){this._queue.runTask(s)}};_([S({constructOnly:!0})],i.prototype,"task",void 0),_([S({readOnly:!0})],i.prototype,"updating",null),i=_([re("esri.views.support.SchedulerTask")],i);class r{constructor(n){this.now=n,this._begin=0,this._budget=0,this._state=po.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,a){this._begin=this.now(),this._budget=n,this._state=a,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(pD||(pD={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(o_||(o_={}));const SE=(()=>{const e=new pD.Budget(()=>performance.now());return e.enabled=!1,e})();class bWe{remove(){}processQueue(){}schedule(t,i,r){try{if(zn(i)){const s=rr();return r?Promise.resolve(r(s)):Promise.reject(s)}return _z(t(SE))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const AS=new bWe,D5=Number.MAX_SAFE_INTEGER;let eT=class extends st{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(ii.TEXTURE_UNLOAD))!=null?i:AS}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return L(t)?`${e}.${t}px`:e}};_([S()],eT.prototype,"_frameTask",void 0),_([S()],eT.prototype,"updating",null),eT=_([re("esri.views.3d.support.TextureCollection")],eT);var Mse;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(Mse||(Mse={}));const Xve=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Yve={};function Jve(e){return!!Yve[e]}function wWe(e){for(const t of e)if(!Jve(t))return!1;return!0}Xve.forEach(e=>{Yve[e]=!0});class xWe{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!wWe(n))return n.some(Jve)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,l;Array.isArray(i)?l=i:(a=i,l=[]),typeof r=="function"?a=r:s=r,s=s!=null?s:ls.DEFAULT;const p=this._createUniqueGroupName(),y=new TWe(this.view,n,l,a);this.handlers.set(p,{handler:y,priority:s});for(const b of n){const x=this.handlerCounts.get(b)||0;this.handlerCounts.set(b,x+1)}return this.inputManager&&this.inputManager.installHandlers(p,[y],s),{remove:()=>this._removeHandler(p,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class TWe extends ya{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,a=>s(this._wrapClick(a)));break;case"double-click":this.registerIncoming("double-click",r,a=>s(this._wrapDoubleClick(a)));break;case"immediate-click":this.registerIncoming("immediate-click",r,a=>s(this._wrapImmediateClick(a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,a=>s(this._wrapImmediateDoubleClick(a)));break;case"hold":this.registerIncoming("hold",r,a=>s(this._wrapHold(a)));break;case"drag":this.registerIncoming("drag",r,a=>{const l=this._wrapDrag(a);l&&s(l)});break;case"key-down":this.registerIncoming("key-down",r,a=>s(this._wrapKeyDown(a)));break;case"key-up":this.registerIncoming("key-up",r,a=>s(this._wrapKeyUp(a)));break;case"pointer-down":this.registerIncoming("pointer-down",r,a=>s(this._wrapPointer(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,a=>s(this._wrapPointer(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,a=>s(this._wrapPointer(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,a=>s(this._wrapPointerDrag(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,a=>s(this._wrapMouseWheel(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,a=>s(this._wrapPointer(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,a=>s(this._wrapPointer(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,a=>{s(this._wrapGamepad(a))});break;case"focus":this.registerIncoming("focus",r,a=>{s(this._wrapFocus(a))});break;case"blur":this.registerIncoming("blur",r,a=>{s(this._wrapBlur(a))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:l,eventId:p}=t.data,{cancelable:y,timestamp:b}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:a,native:l,timestamp:b,screenPoint:dd(n,a),mapPoint:this._getMapPoint(n,a),eventId:p,cancelable:y,stopPropagation:()=>t.stopPropagation(),async:x=>t.async(x),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:l,eventId:p}=t.data,{cancelable:y,timestamp:b}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:a,native:l,timestamp:b,mapPoint:this._getMapPoint(n,a),eventId:p,cancelable:y,stopPropagation:()=>t.stopPropagation(),async:x=>t.async(x),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:l,eventId:p}=t.data,y=l.pointerId,{cancelable:b,timestamp:x}=t;return{type:"immediate-click",pointerId:y,pointerType:i,button:r,buttons:s,x:n,y:a,native:l,timestamp:x,mapPoint:this._getMapPoint(n,a),eventId:p,cancelable:b,stopPropagation:()=>t.stopPropagation(),async:A=>t.async(A),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:l,eventId:p}=t.data,y=l.pointerId,{cancelable:b,timestamp:x}=t;return{type:"immediate-double-click",pointerId:y,pointerType:i,button:r,buttons:s,x:n,y:a,native:l,timestamp:x,mapPoint:this._getMapPoint(n,a),eventId:p,cancelable:b,stopPropagation:()=>t.stopPropagation(),async:A=>t.async(A),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:l}=t.data,{cancelable:p,timestamp:y}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:a,native:l,timestamp:y,mapPoint:this._getMapPoint(n,a),cancelable:p,stopPropagation:()=>t.stopPropagation(),async:b=>t.async(b),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(dd(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:a,button:l}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const p=i.pointer.native,y=i.buttons,{cancelable:b,timestamp:x}=t,A={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:A,pointerType:a,button:l,buttons:y,radius:i.radius,angle:th(i.angle),native:p,timestamp:x,cancelable:b,stopPropagation:()=>t.stopPropagation(),async:M=>t.async(M),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:a}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:a,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:a,native:l,eventId:p}=t.data,y=l.pointerId,b=l.pointerType,{cancelable:x,timestamp:A}=t;return{type:i,x:r,y:s,pointerId:y,pointerType:b,button:n,buttons:a,native:l,timestamp:A,eventId:p,cancelable:x,stopPropagation:()=>t.stopPropagation(),async:M=>t.async(M),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:a}=t.data.currentEvent,{button:l}=t.data.startEvent,p=t.data.startEvent.native.pointerId,y=t.data.startEvent.native.pointerType,b=t.data.action,x={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:A,timestamp:M}=t;return{type:"pointer-drag",x:i,y:r,pointerId:p,pointerType:y,button:l,buttons:s,action:b,origin:x,native:n,timestamp:M,eventId:a,cancelable:A,stopPropagation:()=>t.stopPropagation(),async:P=>t.async(P),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:a,deltaY:l,native:p}=r;return{type:"mouse-wheel",x:n,y:a,deltaY:l,native:p,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:a}=t,{buttons:l,axes:p}=r;return{type:"gamepad",device:s,timestamp:a,action:i,buttons:l,axes:p,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}}var RR,Rse,Ose;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(RR||(RR={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(Rse||(Rse={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(Ose||(Ose={}));const SWe=Ge.getLogger("esri.views.interactive.interactiveToolUtils");function EWe(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return SWe.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function fD(e){return e.visible&&e.getEditableFlag(RR.USER)&&e.getEditableFlag(RR.MANAGER)}function ku(e){return dd(e.x,e.y)}function Zve(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return dd(t.clientX-i.left,t.clientY-i.top)}function Pse(e,t){return t instanceof Event?Zve(e,t):ku(t)}function Ise(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class AWe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":$se(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Dse(t))break;const s=ku(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(J(n))break;const a=this._findToolAndManipulatorByKey(n,i.forEachTool,L5),l=Da(a,y=>y.manipulator),p=Da(a,y=>y.tool);!(L(l)&&L(p)&&l.interactive)||l.grabbable&&l.grabbableForEvent(t)||!l.grabbing||l.dragging||this._ungrabManipulatorBeforeDragging(l,p,t),L(l)&&l.interactive&&l.grabbable&&l.grabbableForEvent(t)&&!l.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),l.grabbing=!0,l.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Dse(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),a=Da(s||n,({key:b})=>b),l=this._findManipulatorByKey(a,i.forEachTool);if(J(l))break;const p=ku(t);p.x=Ot(p.x,0,i.view.width),p.y=Ot(p.y,0,i.view.height);const y=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(l.dragging=!0,n?l.events.emit("drag",{action:"update",start:y,screenPoint:p}):l.events.emit("drag",{action:"start",start:y,screenPoint:p,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:a,start:y}));break;case"end":l.dragging=!1,n&&l.events.emit("drag",{action:"end",start:y,screenPoint:p}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=ku(t),n=this._intersect(s,t.pointerType,i.forEachTool),a=this._findToolAndManipulatorByKey(n,i.forEachTool,L5);if(CWe(t)||i.forEachTool(b=>{if((!L(a)||a.tool!==b||b.automaticManipulatorSelection)&&b.manipulators){let x=!1;b.manipulators.forEach(({manipulator:A})=>{A.selected&&(A.selected=!1,x=!0)}),x&&b.manipulatorSelectionChanged&&b.manipulatorSelectionChanged()}}),J(a))break;const{manipulator:l,tool:p}=a;if(!l.interactive)break;l.selectable&&p.automaticManipulatorSelection&&(l.selected=!l.selected,p.manipulatorSelectionChanged&&p.manipulatorSelectionChanged());const y=t.native.shiftKey;l.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:y,stopPropagation:r});break}case"click":{const s=ku(t),n=this._intersect(s,t.pointerType,i.forEachTool),a=this._findManipulatorByKey(n,i.forEachTool);if(J(a)||!a.interactive)break;const l=t.native.shiftKey;a.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l}),r();break}case"double-click":{const s=ku(t),n=this._intersect(s,t.pointerType,i.forEachTool),a=this._findManipulatorByKey(n,i.forEachTool);if(J(a)||!a.interactive)break;const l=t.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r});break}case"immediate-double-click":{const s=ku(t),n=this._intersect(s,t.pointerType,i.forEachTool),a=this._findManipulatorByKey(n,i.forEachTool);if(J(a)||!a.interactive)break;const l=t.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r});break}}this._updateCursor(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:ku(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=Da(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);L(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:ku(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return rn(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(L(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}clearPointers(t,i,r=!0,s){const n=a=>a.tool===t&&(J(s)||a.manipulatorId===s);this._grabbedManipulators.forEach(({key:a,pointerType:l},p)=>{if(n(a)){this._grabbedManipulators.delete(p);const y=this._findManipulatorByKey(a,i);L(y)&&(y.grabbing=!1,y.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:l}))}}),this._draggedManipulators.forEach(({key:a},l)=>{if(n(a)){this._draggedManipulators.delete(l);const p=this._findManipulatorByKey(a,i);L(p)&&(p.dragging=!1,p.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:a},l)=>{if(n(a)){this._hoveredManipulators.delete(l);const p=this._findManipulatorByKey(a,i);L(p)&&(p.hovering=!1)}}),this._updateCursor(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!fD(n))return!1;const a=n.manipulators.intersect(t,i);return!J(a)&&(s={manipulatorId:a.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(dd(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!$se(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(ku(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let a=this._findManipulatorByKey(n,s);const l=Da(this._hoveredManipulators.get(i),({key:y})=>y),p=this._findManipulatorByKey(l,s);L(a)&&!a.interactive&&(a=null),p!==a&&(L(p)&&(p.hovering=!1),L(a)?(a.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._updateCursor(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,L5)?L5.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return J(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!fD(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!L(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function $se(e){return e==="mouse"}function Dse(e){return e.pointerType!=="mouse"||e.button===0}function CWe(e){return!!e.native.shiftKey}const L5={manipulator:null,tool:null},Lse=Ge.getLogger("esri.views.ToolViewManager"),Nse="attached",X7="tools";let xm=class extends xv{constructor(e){super(e),this._manipulatorState=new AWe,this.tools=new kt,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(Xve,e=>{this._handleInputEvent(e)},ls.TOOL),...EWe(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(L(e)&&!this.view.ready)return void Lse.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return void(L(e)&&Lse.warn("Tool is already active - ignoring activation request."));const t=this.activeTool;this._set("activeTool",e),L(t)&&t.deactivate(),L(e)&&e.activate(),this._removeIncompleteTools(e);const i=J(this.activeTool);for(const r of this.tools){r.setEditableFlag(RR.MANAGER,i||r===this.activeTool);const s=fD(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(e=(t=this.textures)==null?void 0:t.updating)!=null&&e}attach(){this.view.type==="3d"?(this._set("textures",new eT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch("camera",()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Hp(()=>this._set("textures",Ht(this.textures)))],Nse)):this.handles.add(this.view.watch("extent",()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){L(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Nse)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=qe(ie({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});L(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&L(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(X7),this._forEachTool(e=>{if(e instanceof st){const t=ms(e,["cursor","visible","editable"],()=>{fD(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,X7)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),X7)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=this._manipulatorState.cursor;this._forEachTool(t=>!(!L(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(J(e)||t!==e)&&!t.created).forEach(t=>{this.tools.remove(t)})}};_([S({constructOnly:!0,nonNullable:!0})],xm.prototype,"view",void 0),_([S({readOnly:!0,nonNullable:!0})],xm.prototype,"textures",void 0),_([S({value:null})],xm.prototype,"activeTool",null),_([S({readOnly:!0,type:kt})],xm.prototype,"tools",void 0),_([S({readOnly:!0})],xm.prototype,"cursor",void 0),_([S({readOnly:!0})],xm.prototype,"updating",null),xm=_([re("esri.views.ToolViewManager")],xm);const MWe=xm;let g3=class extends st{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":RWe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return OWe[this.deviceType]}};_([S({nonNullable:!0,readOnly:!0})],g3.prototype,"nativeIndex",void 0),_([S({type:String,readOnly:!0})],g3.prototype,"deviceType",null),_([S({type:Number,readOnly:!0})],g3.prototype,"axisThreshold",null),g3=_([re("esri.views.input.gamepad.GamepadInputDevice")],g3);const RWe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),OWe={standard:.15,spacemouse:.025,unknown:0},WY=g3;let NC=class extends st{constructor(...e){super(...e),this.devices=new kt,this.enabledFocusMode="document"}};_([S({type:kt.ofType(WY),readOnly:!0})],NC.prototype,"devices",void 0),_([S({type:["document","view","none"]})],NC.prototype,"enabledFocusMode",void 0),NC=_([re("esri.views.input.gamepad.GamepadSettings")],NC);const PWe=NC;let X9=class extends st{constructor(){super(...arguments),this.gamepad=new PWe}};_([S({readOnly:!0})],X9.prototype,"gamepad",void 0),X9=_([re("esri.views.input.Input")],X9);const IWe=X9;let ay=class extends st{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};_([S({type:Boolean,nonNullable:!0})],ay.prototype,"enabled",void 0),_([S({type:WY})],ay.prototype,"device",void 0),_([S({type:["pan","zoom"],nonNullable:!0})],ay.prototype,"mode",void 0),_([S({type:["forward-down","forward-up"],nonNullable:!0})],ay.prototype,"tiltDirection",void 0),_([S({type:Number,nonNullable:!0})],ay.prototype,"velocityFactor",void 0),ay=_([re("esri.views.navigation.gamepad.GamepadSettings")],ay);const Kve=ay;let gb=class extends st{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Kve,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};_([S({type:Boolean})],gb.prototype,"browserTouchPanEnabled",void 0),_([S({type:Kve,nonNullable:!0})],gb.prototype,"gamepad",void 0),_([S({type:Boolean})],gb.prototype,"momentumEnabled",void 0),_([S({type:Boolean})],gb.prototype,"mouseWheelZoomEnabled",void 0),gb=_([re("esri.views.navigation.Navigation")],gb);const Qve=gb;function $We(e,t){if(!e)return null;if(!kj(e))return new Se("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const i=e.heightUnit,r=jv.deriveUnitFromSR(e,t).heightUnit;return i!==r?new Se("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function DWe(e,t,i){const r=e_e(e),s=t,n=LWe(r,s,i);if(r){const a=jv.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&a!==r.heightUnit){const l=new Se("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new Se("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:l})}}if(!NWe(e)||n===Ic.Unsupported)return new Se("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Ic.Units:{const a=r.heightUnit||"unknown",l=s.heightUnit||"unknown",p=new Se("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${l})`,{layerUnit:a,sceneUnit:l});return new Se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:p})}case Ic.HeightModel:{const a=r.heightModel||"unknown",l=s.heightModel||"unknown",p=new Se("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${l})`,{layerHeightModel:a,sceneHeightModel:l});return new Se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:p})}case Ic.CRS:{const a=r.vertCRS||"unknown",l=s.vertCRS||"unknown",p=new Se("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${l})`,{layerDatum:a,sceneDatum:l});return new Se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:p})}}return null}function LWe(e,t,i){if(!kj(e)||!kj(t))return Ic.Unsupported;if(e==null||t==null)return Ic.Ok;if(!i&&e.heightUnit!==t.heightUnit)return Ic.Units;if(e.heightModel!==t.heightModel)return Ic.HeightModel;switch(e.heightModel){case"gravity-related-height":return Ic.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?Ic.Ok:Ic.CRS;default:return Ic.Unsupported}}var Ic;function kj(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function NWe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!r_e(e)}function e_e(e){const t=e.url&&ZO(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&L(t)&&t.serverType==="ImageServer")&&t_e(e)&&e.heightModelInfo?e.heightModelInfo:r_e(e)?jv.deriveUnitFromSR(FWe,e.spatialReference):null}function t_e(e){return"heightModelInfo"in e}function i_e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function r_e(e){return i_e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):n_e(e)}function s_e(e){return e.layers!=null||n_e(e)||i_e(e)||t_e(e)}function n_e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"analysis":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Ic||(Ic={}));const FWe=new jv({heightModel:"gravity-related-height"});var vt;function Fse(e){return e==="global"?vt.Global:vt.Local}function IM(e){return e===vt.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(vt||(vt={}));let Uj,Y7=null;async function kWe(e){Y7||(Y7=Promise.resolve().then(function(){return hpt}).then(t=>Uj=t)),await Y7,Gi(e)}async function o_e(e,t,i,r){if(!e)return null;const s=e.spatialReference;return _X()||Tv(s,t)?mE(e,t):Uj?Uj.projectGeometry(e,t,i,r):(await Promise.race([kWe(r),U6(r)]),o_e(e,t,i,r))}const a_e=Ge.getLogger("esri.views.support.DefaultsFromMap");a_e.level="info";let as=class extends st{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.logDebugInformation=!1,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._debug("Aborting project extent task"),this._projectExtentTask.task=Ql(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return L(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return J(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var e,t,i,r;const s=(e=this.map)==null?void 0:e.call(this),n=[];return L(this.priorityCollection)&&n.push(this.priorityCollection),n.push({parent:s==null?void 0:s.basemap,layers:s==null||(t=s.basemap)==null?void 0:t.baseLayers},{layers:s==null?void 0:s.layers},{parent:s==null?void 0:s.ground,layers:s==null||(i=s.ground)==null?void 0:i.layers},{parent:s==null?void 0:s.basemap,layers:s==null||(r=s.basemap)==null?void 0:r.referenceLayers}),n}get _allLayers(){var e,t;const i=this._collectLayers(this.mapCollections);return this._debug("Collected",(e=(t=i.layers)==null?void 0:t.length)!=null?e:0,"layers, updating",i.updating),i}get _spatialReferenceTask(){var e,t;if(this.suspended)return(t=this._get("_spatialReferenceTask"))!=null?t:{updating:!1};const{layers:i,updating:r}=this._allLayers,s={candidates:null};for(const a of i)if(this._processSpatialReferenceCandidates(a,s),s.candidates&&s.candidates.length===1)break;if(((e=s.candidates)==null?void 0:e.length)!==1&&r)return{updating:!0};const n=this._pickSpatialReferenceCandidate(s.candidates);return this._debug("Finished spatial reference",L(n)?`${n.spatialReference.wkid}:${L(n.viewingMode)?IM(n.viewingMode):"global/local"}`:"none available"),{spatialReference:L(n)?n.spatialReference:null,viewingMode:L(n)?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var e,t,i,r,s,n,a,l;if(!this.required.tileInfo)return(l=this._get("_tileInfoTask"))!=null?l:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:p,updating:y}=this._collectLayers([{parent:(e=this.map)==null||(t=e.call(this))==null?void 0:t.basemap,layers:(i=this.map)==null||(r=i.call(this))==null||(s=r.basemap)==null?void 0:s.baseLayers},{layers:(n=this.map)==null||(a=n.call(this))==null?void 0:a.layers}]);if(p&&p.length>0&&"tileInfo"in p[0]){const b=p[0].tileInfo;return{tileInfo:b&&b.spatialReference.equals(this.spatialReference)?b:null,updating:!1}}return{updating:y}}get _heightModelInfoTask(){var e,t;if(!this.required.heightModelInfo||this.suspended&&(e=this._get("_heightModelInfoTask"))!=null&&e.heightModelInfo)return(t=this._get("_heightModelInfoTask"))!=null?t:{updating:!1};const{layers:i,updating:r}=this._allLayers;for(const p of i){var s,n;if(this._debug("Considering",(s=(n=p.title)!=null?n:p.id)!=null?s:p.declaredClass,"for height model info"),s_e(p)){const y=e_e(p);var a,l;if(y)return this._debug("Derived height model info",y),{heightModelInfo:y,vcsWkid:(a=p.spatialReference)==null?void 0:a.vcsWkid,latestVcsWkid:(l=p.spatialReference)==null?void 0:l.latestVcsWkid,updating:!1}}this._debug("Layer does not support height models")}return this._debug("No height model info found,","updating",r),{updating:r}}get _extentCandidatesTask(){var e;if(this.suspended||!this.required.extent)return(e=this._get("_extentCandidatesTask"))!=null?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const t=this._allLayers,i=t.updating,r=[];for(const n of t.layers){var s;const a="fullExtents"in n&&n.fullExtents||(L(n.fullExtent)?[n.fullExtent]:[]),l=this.requiresExtentInSpatialReference?null:a[0],p=(s=a.find(y=>y.spatialReference.equals(this.spatialReference)))!=null?s:l;if(p)return{candidates:[{extent:p,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const y of a)r.push({extent:y,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(J(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:L(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(L(this._projectExtentTask.task)&&(this._debug("Aborting project extent task"),this._projectExtentTask.task=Ql(this._projectExtentTask.task)),this._debug("Starting project extent task for",i.extent),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:SO(async s=>{try{const n=await o_e(i.extent,r,i.layer.portalItem,s);this._debug("Project extent task finished",n),this._projectExtentTask=qe(ie({},this._projectExtentTask),{task:null,output:n})}catch{if(zn(s))return;this._projectExtentTask=qe(ie({},this._projectExtentTask),{task:null})}})},{updating:!0})}_processSpatialReferenceCandidates(e,t){var i;const r=this._getSupportedSpatialReferences(e);if(r.length!==0)if(this._debug("Spatial reference candidates from",(i=e.title)!=null?i:e.id,":",r.map(s=>`${s.spatialReference.wkid}:${L(s.viewingMode)?IM(s.viewingMode):"global/local"}`).join(", ")),t.candidates){const s=[],n=(a,l)=>J(a.viewingMode)?l.viewingMode:(J(l.viewingMode)||a.viewingMode===l.viewingMode)&&a.viewingMode;for(const a of t.candidates)for(const l of r){if(!a.spatialReference.equals(l.spatialReference))continue;const p=n(a,l);if(p!==!1){s.push({spatialReference:a.spatialReference,viewingMode:p});break}}s.length>0&&(t.candidates=s)}else t.candidates=r}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return!e||e.length<1?L(t)?{spatialReference:t,viewingMode:null}:null:(L(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==vt.Local)&&(e=e.filter(({viewingMode:i})=>i!==vt.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(L(s)){const n=L(s.constraints)?s.constraints:[{spatialReference:r}];for(const{spatialReference:a,viewingMode:l}of n)(!this.requiresExtentInSpatialReference||J(this.userSpatialReference)||a.equals(this.userSpatialReference))&&i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var t;if(this._loadMaybe((t=this.map)==null?void 0:t.call(this))!=="loaded")return{layers:[],updating:!0};const i={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const s of e.layers){switch(this._loadMaybe(s)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":var i,r;t.updating||(this._debug("Considering layer",(i=(r=s.title)!=null?r:s.id)!=null?i:s.declaredClass),t.layers.push(s)),"layers"in s&&this._collectCollection({layers:s.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(this._debug("Triggering load",(t=(i=e.title)!=null?i:e.id)!=null?t:e.declaredClass),e.load(),"loading"):e.loadStatus:"loaded";var t,i}_debug(...e){this.logDebugInformation&&a_e.info(...e)}};_([S()],as.prototype,"required",void 0),_([S({constructOnly:!0})],as.prototype,"map",void 0),_([S({constructOnly:!0})],as.prototype,"getSpatialReferenceSupport",void 0),_([S()],as.prototype,"defaultSpatialReference",void 0),_([S()],as.prototype,"userSpatialReference",void 0),_([S()],as.prototype,"sourcePreloadCount",void 0),_([S()],as.prototype,"priorityCollection",void 0),_([S()],as.prototype,"logDebugInformation",void 0),_([S()],as.prototype,"requiresExtentInSpatialReference",void 0),_([S()],as.prototype,"suspended",void 0),_([S({readOnly:!0})],as.prototype,"ready",null),_([S({readOnly:!0})],as.prototype,"heightModelInfoReady",null),_([S({readOnly:!0})],as.prototype,"spatialReference",null),_([S({readOnly:!0})],as.prototype,"extent",null),_([S({readOnly:!0})],as.prototype,"heightModelInfo",null),_([S({readOnly:!0})],as.prototype,"vcsWkid",null),_([S({readOnly:!0})],as.prototype,"latestVcsWkid",null),_([S({readOnly:!0})],as.prototype,"viewingMode",null),_([S({readOnly:!0})],as.prototype,"tileInfo",null),_([S({readOnly:!0})],as.prototype,"mapCollections",null),_([S({readOnly:!0})],as.prototype,"_allLayers",null),_([S({readOnly:!0})],as.prototype,"_spatialReferenceTask",null),_([S({readOnly:!0})],as.prototype,"_tileInfoTask",null),_([S({readOnly:!0})],as.prototype,"_heightModelInfoTask",null),_([S({readOnly:!0})],as.prototype,"_extentCandidatesTask",null),_([S()],as.prototype,"_extentTask",null),_([S()],as.prototype,"_projectExtentTask",void 0),as=_([re("esri.views.support.DefaultsFromMap")],as);const UWe=as;var Y9;const N5=Ge.getLogger("esri.views.View");let yi=Y9=class extends zg(ps.EventedMixin(oE(st))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new MT({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new O2,this.analyses=new _S,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new kt,this.magnifier=new Wve,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new IWe,this.navigation=new Qve,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new xWe(this),this.persistableViewModels=new kt,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,Y9.views.add(this)):(this._currentSpatialReference=null,Y9.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),L(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(L(this.analysisViewManager)&&this.analysisViewManager.attach(),this._startup(),this.toolViewManager.attach())},!0))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,qT(()=>this.ready)))),this.basemapView=new oy({view:this}),this.layerViewManager=new mWe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new MWe({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([vi(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=qe(ie({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),vi(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),vi(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([vi(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(L(e))return;const s=Hp(()=>e=Ql(e));e=SO(async n=>{try{await jT(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}N5.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ht(this.graphics),this.analyses=Ht(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager=Ht(this.toolViewManager),this.layerViewManager=Ht(this.layerViewManager),this.basemapView=Ht(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return N5.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new UWe(ie({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||d0.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!(this._currentSpatialReference||(e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){var t;e!==this._get("map")&&((t=e)!=null&&t.destroyed&&(N5.warn("#map","The provided map is already destroyed",{map:e}),e=null),d0.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var e,t;let i=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return i&&(e=this.defaultsFromMap)!=null&&(t=e.required)!=null&&t.heightModelInfo&&(i=i.clone(),i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),i}set spatialReference(e){const t=!Vo(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return L(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(e=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)!=null?e:null}importLayerView(e){throw new Se("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{}}_validateSpatialReference(e){return L(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&N5.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(CO(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};yi.views=new kt,_([S()],yi.prototype,"_userSpatialReference",void 0),_([oi("toolViewManager.activeTool")],yi.prototype,"activeTool",void 0),_([S({readOnly:!0})],yi.prototype,"allLayerViews",void 0),_([S()],yi.prototype,"groundView",void 0),_([S()],yi.prototype,"animation",void 0),_([S()],yi.prototype,"basemapView",void 0),_([S({readOnly:!0})],yi.prototype,"_defaultsFromMapSettings",null),_([S()],yi.prototype,"defaultsFromMap",null),_([S()],yi.prototype,"fatalError",void 0),_([S({type:ki})],yi.prototype,"extent",void 0),_([S(O6(O2,"graphics"))],yi.prototype,"graphics",void 0),_([S(O6(_S,"analyses"))],yi.prototype,"analyses",void 0),_([S({readOnly:!0,type:jv})],yi.prototype,"heightModelInfo",null),_([S({readOnly:!0})],yi.prototype,"interacting",null),_([S({readOnly:!0})],yi.prototype,"navigating",void 0),_([S({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],yi.prototype,"preconditionsReady",null),_([S({readOnly:!0})],yi.prototype,"typeSpecificPreconditionsReady",void 0),_([S({type:kt,readOnly:!0})],yi.prototype,"layerViews",void 0),_([S({type:Wve})],yi.prototype,"magnifier",void 0),_([S({value:null,type:qve})],yi.prototype,"map",null),_([S()],yi.prototype,"padding",void 0),_([S({readOnly:!0})],yi.prototype,"ready",void 0),_([S({type:It})],yi.prototype,"spatialReference",null),_([S()],yi.prototype,"spatialReferenceWarningDelay",void 0),_([S()],yi.prototype,"stationary",null),_([S({readOnly:!0})],yi.prototype,"supportsGround",void 0),_([S({type:R0})],yi.prototype,"timeExtent",void 0),_([oi("toolViewManager.tools")],yi.prototype,"tools",void 0),_([S()],yi.prototype,"toolViewManager",void 0),_([S({readOnly:!0})],yi.prototype,"type",void 0),_([S({type:Number})],yi.prototype,"scale",void 0),_([S({readOnly:!0})],yi.prototype,"updating",void 0),_([S({readOnly:!0})],yi.prototype,"initialExtentRequired",void 0),_([S({readOnly:!0})],yi.prototype,"initialExtent",null),_([S()],yi.prototype,"cursor",null),_([S({readOnly:!0})],yi.prototype,"input",void 0),_([S({type:Qve,nonNullable:!0})],yi.prototype,"navigation",void 0),_([S()],yi.prototype,"layerViewManager",void 0),_([S()],yi.prototype,"analysisViewManager",void 0),_([S()],yi.prototype,"width",void 0),_([S()],yi.prototype,"height",void 0),_([S({readOnly:!0})],yi.prototype,"resizing",void 0),_([S({value:null,readOnly:!0})],yi.prototype,"size",null),_([S({readOnly:!0})],yi.prototype,"suspended",void 0),_([S({readOnly:!0})],yi.prototype,"viewEvents",void 0),_([S({readOnly:!0})],yi.prototype,"persistableViewModels",void 0),_([S()],yi.prototype,"_isValid",void 0),_([S()],yi.prototype,"_readyCycleForced",void 0),_([S()],yi.prototype,"_currentSpatialReference",void 0),yi=Y9=_([re("esri.views.View")],yi);const zWe=yi;let ly=class extends y6{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new Se("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=au(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};_([S({readOnly:!0})],ly.prototype,"done",null),_([S({readOnly:!0,type:String})],ly.prototype,"state",void 0),_([S()],ly.prototype,"target",void 0),ly=_([re("esri.views.ViewAnimation")],ly),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(ly||(ly={}));const CS=ly,iA=()=>import("./TileLayerView3D.a24b5911.js"),kse=()=>Promise.resolve().then(function(){return Lft}),Use={analysis:()=>import("./AnalysisLayerView3D.6bb22669.js"),"base-dynamic":()=>import("./BaseDynamicLayerView3D.8b3800b6.js"),"base-elevation":kse,"base-tile":iA,"bing-maps":iA,"building-scene":()=>import("./BuildingSceneLayerView3D.f3a5ac97.js"),csv:()=>import("./CSVLayerView3D.8cdaa007.js"),elevation:kse,feature:()=>import("./FeatureLayerView3D.7a173c0a.js"),geojson:()=>import("./GeoJSONLayerView3D.d530e9c6.js"),graphics:()=>import("./GraphicsLayerView3D.1442bfb6.js"),group:()=>import("./GroupLayerView.fc43d5a3.js"),imagery:()=>import("./ImageryLayerView3D.7668c0a8.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.3d094453.js"),"map-image":()=>import("./MapImageLayerView3D.50dfb4dc.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.7e6bc73e.js"),"open-street-map":iA,"point-cloud":()=>import("./PointCloudLayerView3D.a9c52f80.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.587faa13.js"),route:()=>import("./RouteLayerView3D.7331b867.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.ccb8abe6.js"):import("./SceneLayerGraphicsView3D.190d2202.js"),stream:()=>import("./StreamLayerView3D.349a89fa.js"),tile:iA,"imagery-tile":()=>import("./ImageryTileLayerView3D.fd4a7981.js"),"vector-tile":()=>import("./VectorTileLayerView3D.8c37469a.js"),wcs:()=>import("./ImageryTileLayerView3D.fd4a7981.js"),"web-tile":iA,wfs:()=>import("./WFSLayerView3D.814b1397.js"),wms:()=>import("./WMSLayerView3D.a37bd1dd.js"),wmts:()=>import("./WMTSLayerView3D.f59d3e96.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function BWe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Se(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const zse={hasLayerViewModule:e=>L(Use[e.type]),importLayerView:e=>{const t=Use[e.type];if(!L(t))throw BWe(e);return t(e)}},VWe=Ge.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Bse="analyses-owner-handles";var tT,qb;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(tT||(tT={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(qb||(qb={}));let yb=class extends zg(st){constructor(e){super(e),this._allAnalysisViews=new kt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._analysisModules={"area-measurement":{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this.detach()}attach(){this.handles.add(this._connectOwner(this.view),Bse)}detach(){this.handles.remove(Bse),this._update(),this._creatingViewCount=0}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}whenAnalysisView(e){const t=this._items.get(e);if(J(t)||t.state.list===qb.REMOVED){const i=new Se("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return Promise.reject(i)}return t.createAnalysisViewTask.promise}_connectOwner(e){return this._connectAnalysesCollection(e.analyses)}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:tT.PENDING,list:qb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=SO(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=qb.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=qb.REMOVED,this._scheduleUpdate()):VWe.error("Trying to remove analysis which was not added")}_scheduleUpdate(){L(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=EO(()=>this._update()))}_update(){this._scheduledUpdateHandle=_o(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===qb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case tT.PENDING:e.createAnalysisViewTask=Ql(e.createAnalysisViewTask);break;case tT.CREATED:L(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Ht(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,J(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(a){throw this._creatingViewCount-=1,a}if(zn(t))throw this._creatingViewCount-=1,rr("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(a){throw this._creatingViewCount-=1,a}if(zn(t))throw this._creatingViewCount-=1,n.destroy(),rr("AnalysisView creation aborted");return e.view=n,e.state.view=tT.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.db1dacf5.js").then(function(t){return t.A});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.eb402fa4.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.de1bc107.js");case"slice":return import("./SliceAnalysisView3D.3096d64e.js");default:return null}}};_([S()],yb.prototype,"updating",null),_([S({constructOnly:!0})],yb.prototype,"view",void 0),_([S()],yb.prototype,"_allAnalysisViews",void 0),_([S()],yb.prototype,"_creatingViewCount",void 0),yb=_([re("esri.views.3d.analysis.AnalysisViewManager3D")],yb);const GWe=yb,jWe=Ge.getLogger("esri.views.3d.state.Constraints");let Tm=class extends st{constructor(e){super(e),this.collision=new FC,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===vt.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==vt.Local?this._set("altitude",e):jWe.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Ot(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return Ot(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===vt.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=J7)=>(i.min=oa.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?XI([[4e3,oa.max],[1e4,xi(88)],[6e6,xi(88)]]):()=>oa.max;return(t,i=J7)=>(i.min=oa.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?XI([[4e3,oa.max],[5e4,xi(88)],[6e6,xi(88)],[2e7,oa.min]]):XI([[3e5,oa.max],[3e6,xi(88)],[6e6,xi(88)],[2e7,oa.min]]);return(t,i=J7)=>(i.min=oa.min,i.max=e(t),i)}};function HWe(e){return{min:-2e5,max:4*e.radius}}_([S()],Tm.prototype,"altitude",null),_([S({readOnly:!0})],Tm.prototype,"collision",void 0),_([S()],Tm.prototype,"distance",void 0),_([S({readOnly:!0})],Tm.prototype,"minimumPoiDistance",void 0),_([S()],Tm.prototype,"tilt",void 0),_([S({constructOnly:!0})],Tm.prototype,"mode",void 0),Tm=_([re("esri.views.3d.state.Constraints")],Tm);const Vse=HWe(ar),oa={min:xi(.5),max:xi(179.5)},J7={min:0,max:0};let FC=class extends st{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};_([S({type:Boolean})],FC.prototype,"enabled",void 0),_([S({type:Number})],FC.prototype,"elevationMargin",void 0),FC=_([re("esri.views.3d.state.Constraints.CollisionConstraint")],FC);const qWe=Tm;let kC=class extends st{constructor(){super(...arguments),this.min=Vse.min,this.max=Vse.max}set mode(e){QT(Ge.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}get mode(){return QT(Ge.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"}),"manual"}};_([S({type:Number})],kC.prototype,"min",void 0),_([S({type:Number})],kC.prototype,"max",void 0),kC=_([re("esri.views.3d.constraints.AltitudeConstraint")],kC);const l_e=kC;let cy=class extends st{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};_([S({type:Number,value:1e-8})],cy.prototype,"near",null),_([_i("near")],cy.prototype,"castNear",null),_([S({type:Number,value:1e-8})],cy.prototype,"far",null),_([_i("far")],cy.prototype,"castFar",null),_([S({type:["auto","manual"]})],cy.prototype,"mode",void 0),cy=_([re("esri.views.3d.constraints.ClipDistanceConstraint")],cy);const c_e=cy,zj={min:th(oa.min),max:th(oa.max)};let y3=class extends st{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Ot(e,zj.min,zj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};_([S({type:["auto","manual"]})],y3.prototype,"mode",void 0),_([S({type:Number,value:zj.max})],y3.prototype,"max",null),_([_i("max")],y3.prototype,"castMax",null),y3=_([re("esri.views.3d.constraints.TiltConstraint")],y3);const h_e=y3;let v3=class extends st{constructor(){super(...arguments),this.tilt=new h_e,this.altitude=new l_e,this.clipDistance=new c_e}};_([S({type:h_e})],v3.prototype,"tilt",void 0),_([S({type:l_e})],v3.prototype,"altitude",void 0),_([S({type:c_e})],v3.prototype,"clipDistance",void 0),v3=_([re("esri.views.3d.constraints.Constraints")],v3);const u_e=v3;var Bj;let Zd=Bj=class extends Ye{constructor(e){super(e),this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new Bj(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};_([S({type:Date,json:{type:Number,write:{target:"datetime"}}})],Zd.prototype,"date",void 0),_([wt("date",["datetime"])],Zd.prototype,"readDate",null),_([Et("date")],Zd.prototype,"writeDate",null),_([S({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Zd.prototype,"directShadowsEnabled",void 0),_([wt("directShadowsEnabled",["directShadows"])],Zd.prototype,"readDirectShadowsEnabled",null),_([Et("directShadowsEnabled")],Zd.prototype,"writedirectShadowsEnabled",null),_([S({type:Number,json:{write:!0}})],Zd.prototype,"displayUTCOffset",void 0),_([Et("displayUTCOffset")],Zd.prototype,"writeDisplayUTCOffset",null),Zd=Bj=_([re("esri.webscene.Lighting")],Zd);const y0=Zd;var _3;let Kd=_3=class extends ps.EventedMixin(y0){constructor(e){super(e),this.type="sun",this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new _3(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=_3.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=_3.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(Z7.target=this,Z7.timezoneOffset=s,this.emit("timezone-will-change",Z7)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new _3(qe(ie({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};_([S({readOnly:!0})],Kd.prototype,"type",void 0),_([S({type:Boolean})],Kd.prototype,"cameraTrackingEnabled",void 0),_([S({type:Boolean})],Kd.prototype,"ambientOcclusionEnabled",void 0),_([S({type:Boolean})],Kd.prototype,"waterReflectionEnabled",void 0),_([S({type:Date})],Kd.prototype,"defaultDate",null),_([S({type:Date})],Kd.prototype,"date",null),Kd=_3=_([re("esri.views.3d.environment.SunLighting")],Kd),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(Kd||(Kd={}));const Z7={target:null,timezoneOffset:0},vb=Kd;var Vj;let b3=Vj=class extends ps.EventedMixin(y0){constructor(e){super(e),this.type="virtual",this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new Vj(qe(ie({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};_([S({readOnly:!0})],b3.prototype,"type",void 0),_([S({type:Boolean})],b3.prototype,"ambientOcclusionEnabled",void 0),_([S({type:Boolean})],b3.prototype,"waterReflectionEnabled",void 0),b3=Vj=_([re("esri.views.3d.environment.VirtualLighting")],b3);const d_e=b3,WWe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:vb,virtual:d_e}};var Gj;let J9=Gj=class extends st{set quality(e){["low","high"].indexOf(e)!==-1&&this._set("quality",e)}clone(){return new Gj({quality:this.quality})}};_([S({type:["low","high"],value:"low"})],J9.prototype,"quality",null),J9=Gj=_([re("esri.views.3d.environment.SceneViewAtmosphere")],J9);const p_e=J9;var jj;let UC=jj=class extends Ye{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new jj({cloudCover:this.cloudCover})}};_([ti({sunny:"sunny"})],UC.prototype,"type",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],UC.prototype,"cloudCover",void 0),UC=jj=_([re("esri.views.3d.environment.SunnyWeather")],UC);const f_e=UC;var Hj;let zC=Hj=class extends Ye{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new Hj({cloudCover:this.cloudCover})}};_([ti({cloudy:"cloudy"})],zC.prototype,"type",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],zC.prototype,"cloudCover",void 0),zC=Hj=_([re("esri.views.3d.environment.CloudyWeather")],zC);const XWe=zC;var qj;let BC=qj=class extends Ye{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new qj({fogStrength:this.fogStrength})}};_([ti({foggy:"foggy"})],BC.prototype,"type",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],BC.prototype,"fogStrength",void 0),BC=qj=_([re("esri.views.3d.environment.FoggyWeather")],BC);const YWe=BC;var Wj;let w3=Wj=class extends Ye{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Wj({cloudCover:this.cloudCover,precipitation:this.precipitation})}};_([ti({rainy:"rainy"})],w3.prototype,"type",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],w3.prototype,"cloudCover",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],w3.prototype,"precipitation",void 0),w3=Wj=_([re("esri.views.3d.environment.RainyWeather")],w3);const JWe=w3;var Xj;let x3=Xj=class extends st{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Xj({cloudCover:this.cloudCover,precipitation:this.precipitation})}};_([ti({snowy:"snowy"})],x3.prototype,"type",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],x3.prototype,"cloudCover",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1}})],x3.prototype,"precipitation",void 0),x3=Xj=_([re("esri.views.3d.environment.SnowyWeather")],x3);const ZWe=x3,m_e={key:"type",base:null,typeMap:{sunny:f_e,cloudy:XWe,rainy:JWe,snowy:ZWe,foggy:YWe}},Gse=Object.keys(m_e.typeMap);function KWe(){return je("enable-feature:precipitation")?Gse:Gse.filter(e=>e!=="snowy")}function QWe(e,t){return!!KWe().includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const qu=1e4;let Z9=class extends Ye{constructor(e){super(e)}clone(){}};_([S({readOnly:!0,json:{read:!1}})],Z9.prototype,"type",void 0),Z9=_([re("esri.webscene.background.Background")],Z9);const g_e=Z9;var Yj;const eXe=qe(ie({},Ug),{nonNullable:!0});let VC=Yj=class extends g_e{constructor(e){super(e),this.type="color",this.color=new Ft([0,0,0,1])}clone(){return new Yj(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};_([ti({color:"color"},{readOnly:!0})],VC.prototype,"type",void 0),_([S(eXe)],VC.prototype,"color",void 0),VC=Yj=_([re("esri.webscene.background.ColorBackground")],VC);const y_e=VC,jse={base:g_e,key:"type",typeMap:{color:y_e}};function tXe(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const iXe={types:jse,json:{read:tXe(jse),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var Jj;const Hse=(e,t,i)=>({enabled:!i||!i.isPresentation});let _b=Jj=class extends Ye{constructor(e){super(e),this.lighting=new y0,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}clone(){return new Jj(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:y0.prototype.clone.call(this.lighting),background:Fe(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}}};_([S({type:y0,json:{write:!0}})],_b.prototype,"lighting",void 0),_([S(iXe)],_b.prototype,"background",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Hse}}})],_b.prototype,"atmosphereEnabled",void 0),_([S({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Hse}}})],_b.prototype,"starsEnabled",void 0),_b=Jj=_([re("esri.webscene.Environment")],_b);const MS=_b;var GC;const rXe=Ge.getLogger("esri.views.3d.environment.SceneViewEnvironment");let bb=GC=class extends MS{constructor(e){super(e),this.atmosphere=new p_e,this.lighting=new vb}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new GC(qe(ie({},t),{lighting:vb.fromWebsceneLighting(t.lighting)}))}set weather(e){QWe(e==null?void 0:e.type,rXe)&&this._set("weather",e)}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof vb||e instanceof d_e?e:e instanceof y0?((t=this.lighting)==null?void 0:t.type)==="sun"?this.lighting.cloneWithWebsceneLighting(e):vb.fromWebsceneLighting(e):Dp(WWe,e):new vb;var t}clone(){return new GC({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Fe(this.background)})}cloneWithWebsceneEnvironment(e){return new GC(qe(ie({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Fe(this.background)},e.cloneConstructProperties()),{lighting:this.lighting.type&&this.lighting.type!=="sun"?vb.fromWebsceneLighting(e.lighting):this.lighting.cloneWithWebsceneLighting(e.lighting)}))}};_([S({type:p_e,json:{read:!1},nonNullable:!0})],bb.prototype,"atmosphere",void 0),_([S({types:m_e,nonNullable:!0,json:{write:!1},value:new f_e})],bb.prototype,"weather",null),_([S({nonNullable:!0})],bb.prototype,"lighting",void 0),_([_i("lighting")],bb.prototype,"castLighting",null),bb=GC=_([re("esri.views.3d.environment.SceneViewEnvironment")],bb);const T3=bb;function Pn(e,t){return e[0]=t[0],e[1]=t[1],e}function ds(e,t,i){return e[0]=t,e[1]=i,e}function kh(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Fs(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function v_e(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function __e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function sXe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function nXe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function oXe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function aXe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function lXe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Wl(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function r0(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function ug(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function v0(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function $N(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function Q2(e){const t=e[0],i=e[1];return t*t+i*i}function XY(e,t){return e[0]=-t[0],e[1]=-t[1],e}function cXe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function OR(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function bs(e,t){return e[0]*t[0]+e[1]*t[1]}function hXe(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function $y(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function uXe(e,t){t=t||1;const i=2*mp()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function Zj(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function wb(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function dXe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function pXe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function fXe(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],a=Math.sin(r),l=Math.cos(r);return e[0]=s*l-n*a+i[0],e[1]=s*a+n*l+i[1],e}function mXe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let a=i*i+r*r;a>0&&(a=1/Math.sqrt(a));let l=s*s+n*n;l>0&&(l=1/Math.sqrt(l));const p=(i*s+r*n)*a*l;return p>1?0:p<-1?Math.PI:Math.acos(p)}function gXe(e){return"vec2("+e[0]+", "+e[1]+")"}function b_e(e,t){return e[0]===t[0]&&e[1]===t[1]}function yXe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=pi*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=pi*Math.max(1,Math.abs(r),Math.abs(n))}function vXe(e,t,i,r,s){let n=t[0]-i[0],a=t[1]-i[1];const l=(r[0]*n+r[1]*a)*(s-1);return n=r[0]*l,a=r[1]*l,e[0]=t[0]+n,e[1]=t[1]+a,e}const _Xe=$N,bXe=Fs,wXe=v_e,xXe=__e,w_e=ug,TXe=v0,SXe=Q2;Object.freeze({__proto__:null,copy:Pn,set:ds,add:kh,subtract:Fs,multiply:v_e,divide:__e,ceil:sXe,floor:nXe,min:oXe,max:aXe,round:lXe,scale:Wl,scaleAndAdd:r0,distance:ug,squaredDistance:v0,length:$N,squaredLength:Q2,negate:XY,inverse:cXe,normalize:OR,dot:bs,cross:hXe,lerp:$y,random:uXe,transformMat2:Zj,transformMat2d:wb,transformMat3:dXe,transformMat4:pXe,rotate:fXe,angle:mXe,str:gXe,exactEquals:b_e,equals:yXe,projectAndScale:vXe,len:_Xe,sub:bXe,mul:wXe,div:xXe,dist:w_e,sqrDist:TXe,sqrLen:SXe});function x_e(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const Kj=1e4,Jw=$t(5802e-9,13558e-9,331e-7),K7=3,Q7=$t(65e-8*K7,1881e-9*K7,85e-9*K7),EXe=3996e-9,AXe=.085,K9=1e5;function V(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(V||(V={}));var Y;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(Y||(Y={}));function dg(e,t){t.attributeTextureCoordinates===Go.Default&&(e.attributes.add(Y.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(V`void forwardTextureCoordinates() {
vuv0 = uv0;
}`)),t.attributeTextureCoordinates===Go.Atlas&&(e.attributes.add(Y.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(Y.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(V`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`)),t.attributeTextureCoordinates===Go.None&&e.vertex.code.add(V`void forwardTextureCoordinates() {}`)}var Go;(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(Go||(Go={}));function qp(e){e.code.add(V`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Yn(e){e.include(qp),e.code.add(V`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function DN(e){e.fragment.code.add(V`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}const CXe=Ge.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class T_e{constructor(){this.includedModules=new Map}include(t,i){this.includedModules.has(t)?this.includedModules.get(t)!==i&&CXe.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(t,i),t(this.builder,i))}}class Ir extends T_e{constructor(){super(...arguments),this.vertex=new qse,this.fragment=new qse,this.attributes=new OXe,this.varyings=new PXe,this.extensions=new RS,this.constants=new un}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,a=n.uniforms.generateSource(),l=n.code.generateSource(),p=t==="vertex"?$Xe:IXe,y=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${p}

${y.join(`
`)}

${a.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${l.join(`
`)}`}}class MXe{constructor(){this._entries=new Map}add(t,i,r){const s=`${t}_${i}_${r}`;return this._entries.set(s,{name:t,type:i,arraySize:r}),this}generateSource(){const t=i=>i?`[${i}]`:"";return Array.from(this._entries.values()).map(i=>`uniform ${i.type} ${i.name}${t(i.arraySize)};`)}get entries(){return Array.from(this._entries.values())}}class RXe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class qse extends T_e{constructor(){super(...arguments),this.uniforms=new MXe,this.code=new RXe,this.constants=new un}get builder(){return this}}class OXe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class PXe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class RS{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?RS.ALLOWLIST_VERTEX:RS.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}RS.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],RS.ALLOWLIST_VERTEX=[];class un{constructor(){this._entries=[]}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=un._numberToFloatStr(r);break;case"int":s=un._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${un._numberToFloatStr(r[0])},                            ${un._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${un._numberToFloatStr(r[0])},                            ${un._numberToFloatStr(r[1])},                            ${un._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${un._numberToFloatStr(r[0])},                            ${un._numberToFloatStr(r[1])},                            ${un._numberToFloatStr(r[2])},                            ${un._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${un._numberToIntStr(r[0])},                             ${un._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${un._numberToIntStr(r[0])},                             ${un._numberToIntStr(r[1])},                             ${un._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${un._numberToIntStr(r[0])},                             ${un._numberToIntStr(r[1])},                             ${un._numberToIntStr(r[2])},                             ${un._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>un._numberToFloatStr(n)).join(", ")})`}return this._entries.push(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const IXe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,$Xe=`precision highp float;
precision highp sampler2D;`;function DXe(e){const t=new Ir;return t.attributes.add(Y.POSITION,"vec2"),t.include(dg,{attributeTextureCoordinates:Go.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("inverseProjectionMatrix","mat4"),t.vertex.uniforms.add("inverseViewMatrix","mat4"),t.vertex.code.add(V`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),t.fragment.uniforms.add("lightingMainDirection","vec3").add("radii","vec2").add("scaleHeight","float").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4").add("innerFadeDistance","float").add("altitudeFade","float").add("depthTex","sampler2D").add("betaRayleigh","vec3").add("betaCombined","vec3").add("betaMie","float").add("hazeStrength","float"),t.include(DN),e.haze&&t.fragment.include(Yn),t.fragment.code.add(V`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),t.fragment.code.add(V`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.fragment.code.add(V`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.fragment.code.add(V`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?V`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?V``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":V`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?V`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:V`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?V`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:V`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?V`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:V`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":V`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const LXe=Object.freeze({__proto__:null,build:DXe});class Ur{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}class Xr{constructor(t,i,r){this.release=r,i&&(this._config=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t)}destroy(){this._program=Xt(this._program),this._pipeline=this._config=null}reload(t){Xt(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t)}get program(){return this._program}get key(){return this._config.key}get configuration(){return this._config}bindPass(t,i){}bindMaterial(t,i){}bindDraw(t){}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return mi.TRIANGLES}getPipelineState(t,i){return this._pipeline}}class Rs{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function Oe(e={}){return(t,i)=>{var r,s;t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i);const n=t._parameterNames.length-1,a=e.count||2,l=Math.ceil(Math.log2(a)),p=(s=t._parameterBits)!=null?s:[0];let y=0;for(;p[y]+l>16;)y++,y>=p.length&&p.push(0);t._parameterBits=p;const b=p[y],x=(1<<l)-1<<b;p[y]+=l,Object.defineProperty(t,i,{get(){return this[n]},set(A){if(this[n]!==A&&(this[n]=A,this._keyDirty=!0,this._parameterBits[y]=this._parameterBits[y]&~x|+A<<b&x,typeof A!="number"&&typeof A!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof A}})}}const mr=new Map([[Y.POSITION,0],[Y.NORMAL,1],[Y.UV0,2],[Y.COLOR,3],[Y.SIZE,4],[Y.TANGENT,4],[Y.AUXPOS1,5],[Y.SYMBOLCOLOR,5],[Y.AUXPOS2,6],[Y.FEATUREATTRIBUTE,6],[Y.INSTANCEFEATUREATTRIBUTE,6],[Y.INSTANCECOLOR,7],[Y.MODEL,8],[Y.MODELNORMAL,12],[Y.MODELORIGINHI,11],[Y.MODELORIGINLO,15]]),NXe=Ge.getLogger("esri/views/webgl");function FXe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const S_e=!!je("enable-feature:webgl-debug");function Bu(){return S_e}function PR(){return S_e}function Qy(e){if(Bu()){const t=e.getError();if(t){const i=FXe(e,t),r=new Error().stack;NXe.error(new Se("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class $r{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Ci({deallocator:null}),this._glProgram=t.programCache.acquire(i.generateSource("vertex"),i.generateSource("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this._fragmentUniforms=Bu()?i.fragmentUniforms.entries:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform2iv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(J(t)||t.glName==null){const s=this._textures.get(i);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(i)),null}let r=this._textures.get(i);return r==null?(r=this._allocTextureUnit(t),this._textures.set(i,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(i,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),L(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{if((t.type==="sampler2D"||t.type==="samplerCube")&&!this._textures.has(t.name))throw new Error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Fr,ew,Wb,Qt,An,Gl,ic,OS,Rg,rc,hv,PS,Pr,tw;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Fr||(Fr={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(ew||(ew={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(Wb||(Wb={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(Qt||(Qt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(An||(An={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Gl||(Gl={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(ic||(ic={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(OS||(OS={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Rg||(Rg={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(rc||(rc={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(hv||(hv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(PS||(PS={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Pr||(Pr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(tw||(tw={}));function su(e,t,i=f0.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function ga(e,t,i,r,s=f0.ADD,n=f0.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const YY={face:Jl.BACK,mode:vS.CCW},E_e={face:Jl.FRONT,mode:vS.CCW},LN=e=>e===Fr.Back?YY:e===Fr.Front?E_e:null,ac={zNear:0,zFar:1},Ii={r:!0,g:!0,b:!0,a:!0};function kXe(e){return qXe.intern(e)}function UXe(e){return WXe.intern(e)}function zXe(e){return XXe.intern(e)}function BXe(e){return YXe.intern(e)}function VXe(e){return JXe.intern(e)}function GXe(e){return ZXe.intern(e)}function jXe(e){return KXe.intern(e)}function HXe(e){return QXe.intern(e)}function Ti(e){return eYe.intern(e)}class Vg{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function Gg(e){return"["+e.join(",")+"]"}const qXe=new Vg(A_e,e=>ie({__tag:"Blending"},e));function A_e(e){return e?Gg([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const WXe=new Vg(C_e,e=>ie({__tag:"Culling"},e));function C_e(e){return e?Gg([e.face,e.mode]):null}const XXe=new Vg(M_e,e=>ie({__tag:"PolygonOffset"},e));function M_e(e){return e?Gg([e.factor,e.units]):null}const YXe=new Vg(R_e,e=>ie({__tag:"DepthTest"},e));function R_e(e){return e?Gg([e.func]):null}const JXe=new Vg(O_e,e=>ie({__tag:"StencilTest"},e));function O_e(e){return e?Gg([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const ZXe=new Vg(P_e,e=>ie({__tag:"DepthWrite"},e));function P_e(e){return e?Gg([e.zNear,e.zFar]):null}const KXe=new Vg(I_e,e=>ie({__tag:"ColorWrite"},e));function I_e(e){return e?Gg([e.r,e.g,e.b,e.a]):null}const QXe=new Vg($_e,e=>ie({__tag:"StencilWrite"},e));function $_e(e){return e?Gg([e.mask]):null}const eYe=new Vg(tYe,e=>({blending:kXe(e.blending),culling:UXe(e.culling),polygonOffset:zXe(e.polygonOffset),depthTest:BXe(e.depthTest),stencilTest:VXe(e.stencilTest),depthWrite:GXe(e.depthWrite),colorWrite:jXe(e.colorWrite),stencilWrite:HXe(e.stencilWrite)}));function tYe(e){return e?Gg([A_e(e.blending),C_e(e.culling),M_e(e.polygonOffset),R_e(e.depthTest),O_e(e.stencilTest),P_e(e.depthWrite),I_e(e.colorWrite),$_e(e.stencilWrite)]):null}class iYe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class IR extends Xr{initializeProgram(t){const i=IR.shader.get(),r=this.configuration,s=i.build({haze:r.haze});return new $r(t.rctx,s,mr)}initializePipeline(){return this.configuration.haze?Ti({blending:ga(ht.ONE,ht.ZERO,ht.ONE_MINUS_SRC_COLOR,ht.ONE),colorWrite:Ii}):Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}IR.shader=new Ur(LXe,()=>import("./ChapmanAtmosphere.glsl.02f659e1.js"));class D_e extends Rs{constructor(){super(...arguments),this.haze=!1}}_([Oe()],D_e.prototype,"haze",void 0);class jo{constructor(t,i,r,s,n,a=!1,l=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=a,this.divisor=l}}new jo(Y.POSITION,3,Zt.FLOAT,0,12);new jo(Y.POSITION,3,Zt.FLOAT,0,20),new jo(Y.UV0,2,Zt.FLOAT,12,20);new jo(Y.POSITION,3,Zt.FLOAT,0,32),new jo(Y.NORMAL,3,Zt.FLOAT,12,32),new jo(Y.UV0,2,Zt.FLOAT,24,32);new jo(Y.POSITION,3,Zt.FLOAT,0,16),new jo(Y.COLOR,4,Zt.UNSIGNED_BYTE,12,16);const JY=[new jo(Y.POSITION,2,Zt.FLOAT,0,8)],t4=[new jo(Y.POSITION,2,Zt.FLOAT,0,16),new jo(Y.UV0,2,Zt.FLOAT,8,16)],uh=Ge.getLogger("esri.views.webgl.BufferObject");function rYe(e){return KCe(e)}class Fi{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(so.Buffer,this),this._glName=this._context.gl.createBuffer(),Qy(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new Fi(t,ni.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new Fi(t,ni.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==Yi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Fi(t,ni.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=tr.STREAM_READ,r){if(t.type!==Yi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Fi(t,ni.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=tr.STREAM_DRAW,r){if(t.type!==Yi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Fi(t,ni.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===ni.ELEMENT_ARRAY_BUFFER?this._indexType===Zt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===ni.ELEMENT_ARRAY_BUFFER||this.bufferType===ni.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(so.Buffer,this),this._context=null):this._glName&&uh.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&uh.error("Buffer size needs to be positive!"),this.bufferType===ni.ELEMENT_ARRAY_BUFFER&&L(i))switch(this._indexType=i,i){case Zt.UNSIGNED_SHORT:t*=2;break;case Zt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===ni.ELEMENT_ARRAY_BUFFER&&(V$(t)&&(i/=2,this._indexType=Zt.UNSIGNED_SHORT),G$(t)&&(i/=4,this._indexType=Zt.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;L(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),Qy(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&uh.error("offset is out of range!");let n=i,a=r,l=s,p=t.byteLength;this.bufferType===ni.ELEMENT_ARRAY_BUFFER&&(V$(t)?(p/=2,n*=2,a*=2,l*=2):G$(t)&&(p/=4,n*=4,a*=4,l*=4)),s===void 0&&(s=p-1),r>=s&&uh.error("end must be bigger than start!"),i+r-s>this._size&&uh.error("An attempt to write beyond the end of the buffer!");const y=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const b=this._context.gl,x=ArrayBuffer.isView(t)?t.buffer:t,A=a===0&&l===t.byteLength?x:x.slice(a,l);b.bufferSubData(this.bufferType,n,A),Qy(b),this._isVAOAware&&this._context.bindVAO(y)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&uh.error("offset is out of range!"),r>=s&&uh.error("end must be bigger than start!"),i+r-s>this._size&&uh.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const a=this._context.gl;if(this._context.type===Yi.WEBGL2)a.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const l=r===0&&s===t.length?t:t.subarray(r,s);a.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,l)}Qy(a),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==Yi.WEBGL2)return void uh.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void uh.error("Problem getting subdata: offset and length were less than zero!");const n=rYe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void uh.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&uh.warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this._context.bindBuffer(this,ni.COPY_READ_BUFFER),a.getBufferSubData(ni.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(ni.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===Yi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):uh.error("Get buffer subdata is supported in WebGL2 only!")}}function yo(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const Wse=4;class Vt{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(so.Texture,this),this._descriptor=ie({target:Yt.TEXTURE_2D,samplingMode:Pt.LINEAR,wrapMode:ei.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==Yi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),a_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Yt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(so.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===Yt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=Yt.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Yt.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=a_(i);var a;t===null&&(s.width=s.width||Wse,s.height=s.height||Wse,n&&(s.depth=(a=s.depth)!=null?a:1));const l=this._context.bindTexture(this,Vt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Vt.TEXTURE_UNIT_FOR_UPDATES),Vt._validateTexture(this._context,s),this._configurePixelStorage();const p=s.pixelFormat;let y=s.internalFormat?s.internalFormat:this._deriveInternalFormat(p,s.dataType);if(ek(t)){let b=t.width,x=t.height;const A=1;t instanceof HTMLVideoElement&&(b=t.videoWidth,x=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,y,s.hasMipmap,b,x,A),this._texImage(i,0,y,b,x,A,t),Qy(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=b),s.height===void 0&&(s.height=x),n&&s.depth===void 0&&(s.depth=A)}else{const{width:b,height:x,depth:A}=s;if(b!=null&&x!=null||console.error("Width and height must be specified!"),n&&A==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,y,s.hasMipmap,b,x,A),r.DEPTH24_STENCIL8&&y===r.DEPTH_STENCIL&&(y=r.DEPTH24_STENCIL8),Q9(t)){const M=t.levels,P=Xse(i,b,x,A),$=Math.min(P-1,M.length-1);yo(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,$):s.hasMipmap=s.hasMipmap&&P===M.length;const k=y;if(!nYe(k))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((z,G,B,W)=>{const q=M[Math.min(z,M.length-1)];this._compressedTexImage(i,z,k,G,B,W,q)},$)}else L(t)?(this._texImage(i,0,y,b,x,A,t),Qy(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((M,P,$,k)=>{this._texImage(i,M,y,P,$,k,null),Qy(r)})}Vt._applySamplingMode(r,this._descriptor),Vt._applyWrapMode(r,this._descriptor),Vt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Qy(r),this._context.bindTexture(l,Vt.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,p=this._descriptor,{pixelFormat:y,internalFormat:b,dataType:x,isImmutable:A,target:M}=p;if(A&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const P=this._context.bindTexture(this,Vt.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>p.width||n>p.height||i+s>p.width||r+n>p.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),ek(a)?l.texSubImage2D(M,t,i,r,y,x,a):Q9(a)?l.compressedTexSubImage2D(M,t,i,r,s,n,b,a.levels[t]):l.texSubImage2D(M,t,i,r,s,n,y,x,a),this._context.bindTexture(P,Vt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,a,l,p){p||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const y=this._context.gl;if(!yo(y))throw new Error("3D textures are not supported in WebGL1");const b=this._descriptor,{pixelFormat:x,dataType:A,isImmutable:M,target:P,internalFormat:$}=b;if(M&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");a_(P)||console.warn("Attempting to set 3D texture data on a non-3D texture");const k=this._context.bindTexture(this,Vt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(Vt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>b.width||a>b.height||l>b.depth||i+n>b.width||r+a>b.height||s+l>b.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),Q9(p))p=p.levels[t],y.compressedTexSubImage3D(P,t,i,r,s,n,a,l,$,p);else{const z=p;y.texSubImage3D(P,t,i,r,s,n,a,l,x,A,z)}this._context.bindTexture(k,Vt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,Vt._validateTexture(this._context,t)}t.samplingMode===Pt.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=Pt.LINEAR_MIPMAP_NEAREST):t.samplingMode===Pt.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=Pt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,Vt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Vt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,Vt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,Vt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(Vt._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(Vt._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===Yi.WEBGL1)return t;switch(i){case ai.FLOAT:switch(t){case _t.RGBA:return Jt.RGBA32F;case _t.RGB:return Jt.RGB32F;default:throw new Error("Unable to derive format")}case ai.UNSIGNED_BYTE:switch(t){case _t.RGBA:return Jt.RGBA8;case _t.RGB:return Jt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,a){const l=this._context.gl;if(!yo(l))throw new Error("Immutable textures are not supported in WebGL1");if(!sYe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const p=r?Xse(t,s,n,a):1;a_(t)?l.texStorage3D(t,p,i,s,n,a):l.texStorage2D(t,p,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,a,l){const p=this._context.gl;let y=null;const b=this._context.type===Yi.WEBGL2,x=a_(t),{isImmutable:A,pixelFormat:M,dataType:P}=this._descriptor;if(b&&(y=p),b||!ek(l))if(A){if(L(l)){const $=l;x?y.texSubImage3D(t,i,0,0,0,s,n,a,M,P,$):p.texSubImage2D(t,i,0,0,s,n,M,P,$)}}else{const $=l;x?y.texImage3D(t,i,r,s,n,a,0,M,P,$):p.texImage2D(t,i,r,s,n,0,M,P,$)}else p.texImage2D(t,0,r,M,P,l)}_compressedTexImage(t,i,r,s,n,a,l){const p=this._context.gl;let y=null;const b=a_(t),x=this._descriptor.isImmutable;if(b){if(this._context.type!==Yi.WEBGL2)throw new Error("3D textures are not supported in WebGL1");y=p}x?L(l)&&(b?y.compressedTexSubImage3D(t,i,0,0,0,s,n,a,r,l):p.compressedTexSubImage2D(t,i,0,0,s,n,r,l)):b?y.compressedTexImage3D(t,i,r,s,n,a,0,l):p.compressedTexImage2D(t,i,r,s,n,0,l)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:a,target:l}=this._descriptor;const p=l===Yt.TEXTURE_3D;for(let y=0;t(y,r,s,n),a&&(r!==1||s!==1||p&&n!==1)&&!(y>=i);++y)r=Math.max(1,r>>1),s=Math.max(1,s>>1),p&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=yo(t.gl),s=YT(i.width)&&YT(i.height);r||!i.isImmutable&&!a_(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==ei.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===ei.CLAMP_TO_EDGE&&i.wrapMode.t===ei.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===Pt.LINEAR_MIPMAP_NEAREST||r===Pt.LINEAR_MIPMAP_LINEAR?(r=Pt.LINEAR,i.hasMipmap||(s=Pt.LINEAR)):r!==Pt.NEAREST_MIPMAP_NEAREST&&r!==Pt.NEAREST_MIPMAP_LINEAR||(r=Pt.NEAREST,i.hasMipmap||(s=Pt.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var r;const s=t.capabilities.textureFilterAnisotropic;!s||t.gl.texParameterf(i.target,s.TEXTURE_MAX_ANISOTROPY,(r=i.maxAnisotropy)!=null?r:1)}}function sYe(e){return e in Jt}function nYe(e){return e in Hs}function Q9(e){return L(e)&&"type"in e&&e.type==="compressed"}function oYe(e){return L(e)&&"byteLength"in e}function ek(e){return L(e)&&!Q9(e)&&!oYe(e)}function a_(e){return e===Yt.TEXTURE_3D||e===Yt.TEXTURE_2D_ARRAY}function Xse(e,t,i,r=1){let s=Math.max(t,i);return e===Yt.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}Vt.TEXTURE_UNIT_FOR_UPDATES=0;function Yse(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function zo(e,t){return e.vertexBuffers[t].size/aYe(e.layout[t])}function aYe(e){return e[0].stride}function ZY(e,t,i,r,s=0){const n=e.gl,a=e.capabilities.instancing;e.bindBuffer(i);for(const l of r){const p=t.get(l.name);p===void 0&&console.error(`There is no location for vertex attribute '${l.name}' defined.`);const y=s*l.stride;if(l.count<=4)n.vertexAttribPointer(p,l.count,l.type,l.normalized,l.stride,l.offset+y),n.enableVertexAttribArray(p),l.divisor>0&&a&&a.vertexAttribDivisor(p,l.divisor);else if(l.count===9)for(let b=0;b<3;b++)n.vertexAttribPointer(p+b,3,l.type,l.normalized,l.stride,l.offset+12*b+y),n.enableVertexAttribArray(p+b),l.divisor>0&&a&&a.vertexAttribDivisor(p+b,l.divisor);else if(l.count===16)for(let b=0;b<4;b++)n.vertexAttribPointer(p+b,4,l.type,l.normalized,l.stride,l.offset+16*b+y),n.enableVertexAttribArray(p+b),l.divisor>0&&a&&a.vertexAttribDivisor(p+b,l.divisor);else console.error("Unsupported vertex attribute element count: "+l.count)}}function KY(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);if(a.count<=4)s.disableVertexAttribArray(l),a.divisor&&a.divisor>0&&n&&n.vertexAttribDivisor(l,0);else if(a.count===9)for(let p=0;p<3;p++)s.disableVertexAttribArray(l+p),a.divisor&&a.divisor>0&&n&&n.vertexAttribDivisor(l+p,0);else if(a.count===16)for(let p=0;p<4;p++)s.disableVertexAttribArray(l+p),a.divisor&&a.divisor>0&&n&&n.vertexAttribDivisor(l+p,0);else console.error("Unsupported vertex attribute element count: "+a.count)}e.unbindBuffer(ni.ARRAY_BUFFER)}function L_e(e){switch(e){case _t.ALPHA:case _t.LUMINANCE:case _t.RED:case _t.RED_INTEGER:case Jt.R8:case Jt.R8I:case Jt.R8UI:case Jt.R8_SNORM:case hl.STENCIL_INDEX8:return 1;case _t.LUMINANCE_ALPHA:case _t.RG:case _t.RG_INTEGER:case Jt.RGBA4:case Jt.R16F:case Jt.R16I:case Jt.R16UI:case Jt.RG8:case Jt.RG8I:case Jt.RG8UI:case Jt.RG8_SNORM:case Jt.RGB565:case Jt.RGB5_A1:case hl.DEPTH_COMPONENT16:return 2;case _t.DEPTH_COMPONENT:case _t.RGB:case _t.RGB_INTEGER:case Jt.RGB8:case Jt.RGB8I:case Jt.RGB8UI:case Jt.RGB8_SNORM:case Jt.SRGB8:case hl.DEPTH_COMPONENT24:return 3;case _t.DEPTH_STENCIL:case _t.RGBA:case _t.RGBA_INTEGER:case Jt.RGBA8:case Jt.R32F:case Jt.R11F_G11F_B10F:case Jt.RG16F:case Jt.R32I:case Jt.R32UI:case Jt.RG16I:case Jt.RG16UI:case Jt.RGBA8I:case Jt.RGBA8UI:case Jt.RGBA8_SNORM:case Jt.SRGB8_ALPHA8:case Jt.RGB9_E5:case Jt.RGB10_A2UI:case Jt.RGB10_A2:case hl.DEPTH_STENCIL:case hl.DEPTH_COMPONENT32F:case hl.DEPTH24_STENCIL8:return 4;case hl.DEPTH32F_STENCIL8:return 5;case Jt.RGB16F:case Jt.RGB16I:case Jt.RGB16UI:return 6;case Jt.RG32F:case Jt.RG32I:case Jt.RG32UI:case Jt.RGBA16F:case Jt.RGBA16I:case Jt.RGBA16UI:return 8;case Jt.RGB32F:case Jt.RGB32I:case Jt.RGB32UI:return 12;case Jt.RGBA32F:case Jt.RGBA32I:case Jt.RGBA32UI:return 16;case Hs.COMPRESSED_RGB_S3TC_DXT1_EXT:case Hs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Hs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Hs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Hs.COMPRESSED_R11_EAC:case Hs.COMPRESSED_SIGNED_R11_EAC:case Hs.COMPRESSED_RGB8_ETC2:case Hs.COMPRESSED_SRGB8_ETC2:case Hs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Hs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Hs.COMPRESSED_RG11_EAC:case Hs.COMPRESSED_SIGNED_RG11_EAC:case Hs.COMPRESSED_RGBA8_ETC2_EAC:case Hs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function uv(e){if(J(e))return 0;if("descriptor"in e)return e.glName?uv(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return L_e(t)*r*i}const l_=Ge.getLogger("esri.views.webgl.VertexArrayObject");class In{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(so.VAO,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,L(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&l_.warn("Leaked WebGL VAO"));if(this._glName){var i,r;const s=(i=this._context)==null||(r=i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):l_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Xt(this._indexBuffer)}this._context.instanceCounter.decrement(so.VAO,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||l_.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const a=t[n];a||l_.error("Vertex buffer is uninitialized!");const l=i[n];l||l_.error("Vertex element descriptor is empty!"),ZY(this._context,this._locations,a,l)}L(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||l_.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||l_.error("Vertex buffer is uninitialized!");const n=i[r];KY(this._context,this._locations,s,n)}L(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function Ga(e,t=JY,i=mr,r=-1,s=1){let n=null;return t===t4?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new In(e,i,{geometry:t},{geometry:Fi.createVertex(e,tr.STATIC_DRAW,n)})}function lYe(e,t=JY,i=mr){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new In(e,i,{geometry:t},{geometry:Fi.createVertex(e,tr.STATIC_DRAW,r)})}const N_e=4;function F_e(e,t=N_e){return new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:t,height:t})}function Jse(e,t,i=N_e){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:i,height:i},r)}function k_e(e){return new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class Zse{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=Q(),this._projectionInverse=lt(),this._viewInverse=lt(),this._heightParameters=nr(),this._betasRayleigh=Q(),this._betasCombined=Q(),this._scaleHeight=0,this._radii=St(),this._nearFar=St(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=ar.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(ar.radius)}destroy(){this._atmosphereTechnique=es(this._atmosphereTechnique),this._atmosphereHazeTechnique=es(this._atmosphereHazeTechnique),this._vao=Xt(this._vao),this._handles=Ht(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx;this._handles=new Ei,L(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"}),this._handles.add(m0(this._view,"basemapTerrain","elevation-change",s=>this._updateElevation(s),()=>this._updateElevation())),this._handles.add(m0(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const r=new D_e;r.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(IR,r),r.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(IR,r),this._vao=Ga(i,t4),this._scaleHeight=AXe*K9,ze(this._betasRayleigh,Jw[0],Jw[1],Jw[2]),ze(this._betasCombined,Jw[0]+Q7[0],Jw[1]+Q7[1],Jw[2]+Q7[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.camera);const s=t.rctx.useTechnique(i);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture(r,"depthTex"),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(J(this._vao))return;const r=i.rctx;i.scenelightingData.setLightDirectionUniform(t),t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse),t.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse),t.setUniform2fv("nearFar",this._nearFar),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",EXe),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(mi.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:Wt(this._view.basemapTerrain.rootTiles,[null])[0];if(J(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(ar.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(ar.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,ds(this._radii,t,t+K9),this._innerFadeDistance=2*Math.sqrt((2*t-Kj)*Kj)}_update(t){if(J(t))return;this._cameraHeight=yt(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/K9));this._heightParameters=_r(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),ke(this._cameraPosition,t.eye),Ms(this._projectionInverse,t.projectionMatrix),Ms(this._viewInverse,t.viewMatrix),ds(this._nearFar,t.near,t.far),this._altitudeFade=x_e(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Vi(.6,1,JT(9500,10500,this._cameraHeight-ar.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}function cYe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function U_e(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function z_e(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>pi?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function B_e(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=i[0],p=i[1],y=i[2],b=i[3];return e[0]=r*b+a*l+s*y-n*p,e[1]=s*b+a*p+n*l-r*y,e[2]=n*b+a*y+r*p-s*l,e[3]=a*b-r*l-s*p-n*y,e}function hYe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],a=t[3],l=Math.sin(i),p=Math.cos(i);return e[0]=r*p+a*l,e[1]=s*p+n*l,e[2]=n*p-s*l,e[3]=a*p-r*l,e}function uYe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],a=t[3],l=Math.sin(i),p=Math.cos(i);return e[0]=r*p-n*l,e[1]=s*p+a*l,e[2]=n*p+r*l,e[3]=a*p-s*l,e}function dYe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],a=t[3],l=Math.sin(i),p=Math.cos(i);return e[0]=r*p+s*l,e[1]=s*p-r*l,e[2]=n*p+a*l,e[3]=a*p-n*l,e}function pYe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function e$(e,t,i,r){const s=t[0],n=t[1],a=t[2],l=t[3];let p,y,b,x,A,M=i[0],P=i[1],$=i[2],k=i[3];return y=s*M+n*P+a*$+l*k,y<0&&(y=-y,M=-M,P=-P,$=-$,k=-k),1-y>pi?(p=Math.acos(y),b=Math.sin(p),x=Math.sin((1-r)*p)/b,A=Math.sin(r*p)/b):(x=1-r,A=r),e[0]=x*s+A*M,e[1]=x*n+A*P,e[2]=x*a+A*$,e[3]=x*l+A*k,e}function fYe(e){const t=mp(),i=mp(),r=mp(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function mYe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=i*i+r*r+s*s+n*n,l=a?1/a:0;return e[0]=-i*l,e[1]=-r*l,e[2]=-s*l,e[3]=n*l,e}function i4(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function V_e(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,a=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*a+a]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[a]=(t[3*a+s]+t[3*s+a])*r}return e}function gYe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),a=Math.cos(t),l=Math.sin(i),p=Math.cos(i),y=Math.sin(r),b=Math.cos(r);return e[0]=n*p*b-a*l*y,e[1]=a*l*b+n*p*y,e[2]=a*p*y-n*l*b,e[3]=a*p*b+n*l*y,e}function yYe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const G_e=Yl,vYe=fl,_Ye=Kq,bYe=B_e,wYe=OO,xYe=pde,TYe=tW,j_e=Qq,SYe=j_e,H_e=eW,EYe=H_e,QY=dde,AYe=F2,CYe=fde;function MYe(e,t,i){const r=rt(t,i);return r<-.999999?(si(Qp,RYe,t),Zq(Qp)<1e-6&&si(Qp,OYe,t),ot(Qp,Qp),U_e(e,Qp,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(si(Qp,t,i),e[0]=Qp[0],e[1]=Qp[1],e[2]=Qp[2],e[3]=1+r,QY(e,e))}const Qp=Q(),RYe=$t(1,0,0),OYe=$t(0,1,0);function PYe(e,t,i,r,s,n){return e$(Kse,t,s,n),e$(Qse,i,r,n),e$(e,Kse,Qse,2*n*(1-n)),e}const Kse=Hv(),Qse=Hv();function IYe(e,t,i,r){const s=$Ye;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],QY(e,V_e(e,s))}const $Ye=zs();Object.freeze({__proto__:null,identity:cYe,setAxisAngle:U_e,getAxisAngle:z_e,multiply:B_e,rotateX:hYe,rotateY:uYe,rotateZ:dYe,calculateW:pYe,slerp:e$,random:fYe,invert:mYe,conjugate:i4,fromMat3:V_e,fromEuler:gYe,str:yYe,copy:G_e,set:vYe,add:_Ye,mul:bYe,scale:wYe,dot:xYe,lerp:TYe,length:j_e,len:SYe,squaredLength:H_e,sqrLen:EYe,normalize:QY,exactEquals:AYe,equals:CYe,rotationTo:MYe,sqlerp:PYe,setAxes:IYe});function EE(e=LYe){return[e[0],e[1],e[2],e[3]]}function $R(e,t){return DYe(e[0],e[1],e[2],t,RX.get())}function DYe(e,t,i,r,s=EE()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function DR(e,t,i=EE()){return si(i,e,t),ot(i,i),i[3]=PX(e,t),i}const LYe=[0,0,1,0];function fr(){return new Float32Array(3)}function mD(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Bi(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function q_e(e,t){return new Float32Array(e,t,3)}function eJ(){return fr()}function W_e(){return Bi(1,1,1)}function X_e(){return Bi(1,0,0)}function Y_e(){return Bi(0,1,0)}function J_e(){return Bi(0,0,1)}const NYe=eJ(),FYe=W_e(),kYe=X_e(),UYe=Y_e(),zYe=J_e();Object.freeze({__proto__:null,create:fr,clone:mD,fromValues:Bi,createView:q_e,zeros:eJ,ones:W_e,unitX:X_e,unitY:Y_e,unitZ:J_e,ZEROS:NYe,ONES:FYe,UNIT_X:kYe,UNIT_Y:UYe,UNIT_Z:zYe});function Z_e(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(V`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function tJ(e,t){e.include(dg,t),e.fragment.code.add(V`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.attributeTextureCoordinates===Go.Default&&e.fragment.code.add(V`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`),t.attributeTextureCoordinates===Go.Atlas&&(e.include(Z_e),e.fragment.code.add(V`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))}const hSt=Bi(0,.6,.2);var fi;function iJ(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;t.pbrMode===fi.Normal&&r&&e.include(tJ,t),t.pbrMode!==fi.Schematic?(t.pbrMode===fi.Disabled&&i.code.add(V`float getBakedOcclusion() { return 1.0; }`),t.pbrMode===fi.Normal&&(i.uniforms.add("emissionFactor","vec3"),i.uniforms.add("mrrFactors","vec3"),i.code.add(V`vec3 mrr;
vec3 emission;
float occlusion;`),t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texMetallicRoughnessSize","vec2"),i.code.add(V`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texEmissionSize","vec2"),i.code.add(V`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texOcclusionSize","vec2"),i.code.add(V`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(V`float getBakedOcclusion() { return 1.0; }`),i.code.add(V`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `))):i.code.add(V`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function K_e(e,t,i=!1){i||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(fi||(fi={}));function rJ(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add("lightingAmbientSH0","vec3"),i.code.add(V`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add("lightingAmbientSH_R","vec4"),i.uniforms.add("lightingAmbientSH_G","vec4"),i.uniforms.add("lightingAmbientSH_B","vec4"),i.code.add(V`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add("lightingAmbientSH0","vec3"),i.uniforms.add("lightingAmbientSH_R1","vec4"),i.uniforms.add("lightingAmbientSH_G1","vec4"),i.uniforms.add("lightingAmbientSH_B1","vec4"),i.uniforms.add("lightingAmbientSH_R2","vec4"),i.uniforms.add("lightingAmbientSH_G2","vec4"),i.uniforms.add("lightingAmbientSH_B2","vec4"),i.code.add(V`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==fi.Normal&&t.pbrMode!==fi.Schematic||i.code.add(V`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}function NN(e){const t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.uniforms.add("lightingSpecularStrength","float"),t.uniforms.add("lightingEnvironmentStrength","float"),t.code.add(V`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function FN(e){e.vertex.code.add(V`const float PI = 3.141592653589793;`),e.fragment.code.add(V`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}function Q_e(e){e.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade","mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2").add("cubeMap","samplerCube"),e.fragment.code.add(V`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);
float C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.fragment.code.add(V`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.fragment.code.add(V`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),e.fragment.code.add(V`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.fragment.code.add(V`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),e.fragment.code.add(V`vec4 renderCloud(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`),e.fragment.code.add(V`vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)}function P0(e){e.code.add(V`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function BYe(){const e=new Ir;return e.attributes.add(Y.POSITION,"vec2"),e.varyings.add("worldRay","vec3"),e.vertex.uniforms.add("inverseProjectionMatrix","mat4"),e.vertex.uniforms.add("inverseViewMatrix","mat4"),e.vertex.code.add(V`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),e.fragment.uniforms.add("lightingMainDirection","vec3"),e.fragment.include(P0),e.fragment.include(qp),e.include(NN),e.include(rJ,{pbrMode:fi.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(FN),e.include(DN),e.include(Q_e),e.fragment.code.add(V`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay), cameraPosition) : renderCloudCrossFade(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const VYe=Object.freeze({__proto__:null,build:BYe});class kN extends Xr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=kN.shader.get().build();return new $r(t.rctx,i,mr)}initializePipeline(){return Ti({blending:su(ht.ONE,ht.SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}kN.shader=new Ur(VYe,()=>import("./CloudsComposition.glsl.3086b99a.js"));let S3=class extends st{constructor(e){super(e),this._inverseProjectionMatrix=lt(),this._inverseViewMatrix=lt(),this._technique=new kN(e),this._vao=Ga(e.rctx),this._setDefaultParallax(e.radius)}destroy(){this._technique=es(this._technique),this._vao=Xt(this._vao)}render(e,t,i){this._parameters.clouds=t;const r=e.camera;if(J(this._vao)||J(r))return;const s=e.rctx,n=s.useTechnique(this._technique);e.scenelightingData.setLightDirectionUniform(n),e.scenelightingData.setUniforms(n,!1,!1),Ms(this._inverseProjectionMatrix,r.projectionMatrix),Ms(this._inverseViewMatrix,r.viewMatrix),n.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix),n.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix),n.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption),this._setParallaxParams(r.eye,i),e.cloudsCompositionParams=this._parameters,ebe(n,r,this._parameters),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(mi.TRIANGLE_STRIP,0,4)}get isFading(){return this._parameters.crossFade.stage!==Nu.FINISHED||this._parameters.fadeInOut.stage!==ll.FINISHED||this._parameters.fadeIn.stage!==Lu.FINISHED||this._parameters.fadeInOutHeight.stage!==Xb.FINISHED}_setDefaultParallax(e){this._parameters={parallax:{anchorPointClouds:Q(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:lt()},parallaxNew:{anchorPointClouds:Q(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:lt()},crossFade:{stage:Nu.FINISHED,factor:0,distanceThresholdFactor:.3},fadeInOut:{stage:ll.FINISHED,factor:0,distanceThresholdFactor:.6},fadeIn:{stage:Lu.FINISHED,factor:0,distanceThresholdFactor:2},fadeInOutHeight:{stage:Xb.FINISHED,factor:-1},cameraPositionLastFrame:Q(),startTime:0,startTimeHeightFade:0,clouds:null}}_isCameraPositionFinal(e){return WT(this._parameters.cameraPositionLastFrame,e)}_setFadeInStage(e){const t=this._isCameraPositionFinal(e);this._parameters.fadeIn.stage===Lu.FINISHED&&(this._parameters.fadeIn.factor=1,ke(this._parameters.parallax.anchorPointClouds,G0),this._parameters.fadeIn.stage=Lu.CHANGE_ANCHOR,this._parameters.crossFade.stage=Nu.FINISHED,this._parameters.fadeInOut.stage=ll.FINISHED),this._parameters.fadeIn.stage===Lu.CHANGE_ANCHOR&&t&&(ke(this._parameters.parallax.anchorPointClouds,G0),this._parameters.fadeIn.stage=Lu.FADE_IN,this._parameters.startTime=performance.now()),this._parameters.fadeIn.factor>0&&this._parameters.fadeIn.stage===Lu.FADE_IN&&(this._parameters.fadeIn.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeIn.factor<=0&&this._parameters.fadeIn.stage===Lu.FADE_IN&&(this._parameters.fadeIn.stage=Lu.FINISHED,this._parameters.fadeIn.factor=0)}_setCrossFadingStage(){this._parameters.crossFade.stage===Nu.FINISHED&&(ke(this._parameters.parallaxNew.anchorPointClouds,G0),this._parameters.startTime=performance.now(),this._parameters.crossFade.factor=0,this._parameters.crossFade.stage=Nu.CROSS_FADE),this._parameters.crossFade.factor<1&&this._parameters.crossFade.stage===Nu.CROSS_FADE&&(this._parameters.crossFade.factor=(performance.now()-this._parameters.startTime)/500),this._parameters.crossFade.factor>=1&&this._parameters.crossFade.stage===Nu.CROSS_FADE&&(this._parameters.crossFade.stage=Nu.FINISHED,this._parameters.crossFade.factor=1,ke(this._parameters.parallax.anchorPointClouds,this._parameters.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e){this._parameters.fadeInOut.stage===ll.FINISHED&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=0,this._parameters.fadeInOut.stage=ll.FADE_OUT),this._parameters.fadeInOut.factor<1&&this._parameters.fadeInOut.stage===ll.FADE_OUT&&(this._parameters.fadeInOut.factor=(performance.now()-this._parameters.startTime)/250),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===ll.FADE_OUT&&(this._parameters.fadeInOut.factor=1,ke(this._parameters.parallax.anchorPointClouds,G0)),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===ll.FADE_OUT&&this._isCameraPositionFinal(e)&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=1,this._parameters.fadeInOut.stage=ll.FADE_IN,this._parameters.crossFade.stage=Nu.FINISHED,this._parameters.crossFade.factor=0),this._parameters.fadeInOut.factor>0&&this._parameters.fadeInOut.stage===ll.FADE_IN&&(this._parameters.fadeInOut.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeInOut.factor<=0&&this._parameters.fadeInOut.stage===ll.FADE_IN&&(this._parameters.fadeInOut.stage=ll.FINISHED,this._parameters.fadeInOut.factor=0)}_setFadeInOutHeight(e){const t=performance.now();this._parameters.startTimeHeightFade=this._parameters.fadeInOutHeight.stage===Xb.FINISHED?t:this._parameters.startTimeHeightFade,e?this._parameters.fadeInOutHeight.factor+=(t-this._parameters.startTimeHeightFade)/500:this._parameters.fadeInOutHeight.factor-=(t-this._parameters.startTimeHeightFade)/500,this._parameters.startTimeHeightFade=t,this._parameters.fadeInOutHeight.factor=Ot(this._parameters.fadeInOutHeight.factor,0,1),this._parameters.fadeInOutHeight.stage=Xb.HEIGHT_FADE}_setParallaxParams(e,t){this._parameters.fadeInOutHeight.factor<0&&(this._parameters.fadeInOutHeight.factor=yt(e)-this._parameters.parallax.radius>qu?1:0),ot(G0,e),Ue(G0,G0,this._parameters.parallax.radius),this._parameters.parallax.anchorPointClouds[0]===0&&this._parameters.parallax.anchorPointClouds[1]===0&&this._parameters.parallax.anchorPointClouds[2]===0&&ke(this._parameters.parallax.anchorPointClouds,G0);const i=yt(We(GYe,this._parameters.parallax.anchorPointClouds,G0));let r=!0;i>this._parameters.fadeIn.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeIn.stage!==Lu.FINISHED?this._setFadeInStage(e):i>this._parameters.fadeInOut.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeInOut.stage!==ll.FINISHED?this._setFadeInOutStage(e):i>this._parameters.crossFade.distanceThresholdFactor*this._parameters.parallax.cloudsHeight&&!t||this._parameters.crossFade.stage!==Nu.FINISHED?this._setCrossFadingStage():r=!1;const s=yt(e),n=s-this._parameters.parallax.radius;(n>1.7*qu||n<-qu)&&this._parameters.fadeInOutHeight.factor<1?this._parameters.fadeInOutHeight.factor=1:(n>qu||n<-.35*qu)&&this._parameters.fadeInOutHeight.factor<1?this._setFadeInOutHeight(!0):n<qu&&n>-.35*qu&&this._parameters.fadeInOutHeight.factor>0?this._setFadeInOutHeight(!1):this._parameters.fadeInOutHeight.stage=Xb.FINISHED,this._parameters.parallax.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-this._parameters.parallax.radius*this._parameters.parallax.radius,0))/s,DR(ene,this._parameters.parallax.anchorPointClouds,Zw),this._parameters.parallax.transform=lt(),qc(this._parameters.parallax.transform,this._parameters.parallax.transform,Zw[3],Zw),r&&(DR(ene,this._parameters.parallaxNew.anchorPointClouds,Zw),this._parameters.parallaxNew.transform=lt(),qc(this._parameters.parallaxNew.transform,this._parameters.parallaxNew.transform,Zw[3],Zw)),ke(this._parameters.cameraPositionLastFrame,e)}};var Lu,ll,Nu,Xb;function ebe(e,t,i){e.bindTexture(i.clouds.cubeMap.colorTexture,"cubeMap"),e.setUniform1f("cloudsHeight",i.parallax.cloudsHeight),e.setUniformMatrix4fv("rotationMatrixClouds",i.parallax.transform),e.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",i.parallaxNew.transform),e.setUniform3fv("anchorPosition",i.parallax.anchorPointClouds),e.setUniform3fv("anchorPositionCrossFade",i.parallaxNew.anchorPointClouds),i.fadeInOut.stage!==ll.FINISHED?e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(Ot(i.fadeInOut.factor,0,1))):e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(Ot(i.fadeIn.factor,0,1))),e.setUniform1f("radiusCurvatureCorrectionFactor",i.parallax.radiusCurvatureCorrectionFactor),e.setUniform1i("crossFade",i.crossFade.stage),e.setUniform1f("crossFadeAnchorFactor",Ot(i.crossFade.factor,0,1)),e.setUniform1f("radius",i.parallax.radius),e.setUniform3fv("cameraPosition",t.eye)}_([S({constructOnly:!0})],S3.prototype,"rctx",void 0),_([S({constructOnly:!0})],S3.prototype,"viewingMode",void 0),_([S({constructOnly:!0})],S3.prototype,"radius",void 0),S3=_([re("esri.views.3d.environment.CloudsComposition")],S3),function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(Lu||(Lu={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.FADE_IN=2]="FADE_IN"}(ll||(ll={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.CROSS_FADE=1]="CROSS_FADE"}(Nu||(Nu={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Xb||(Xb={}));const ene=$t(0,0,1),Zw=EE(),G0=Q(),GYe=Q();function jYe(e){return L(e)&&L(e.cubeMap)&&!e.running&&e.coverage>0}function md(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function LR(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function sJ(e,t,i,r,s,n,a,l,p,y){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=a,e[6]=l,e[7]=p,e[8]=y,e}function nJ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function gd(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function iw(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5],p=t[6],y=t[7],b=t[8],x=b*a-l*y,A=-b*n+l*p,M=y*n-a*p;let P=i*x+r*A+s*M;return P?(P=1/P,e[0]=x*P,e[1]=(-b*r+s*y)*P,e[2]=(l*r-s*a)*P,e[3]=A*P,e[4]=(b*i-s*p)*P,e[5]=(-l*i+s*n)*P,e[6]=M*P,e[7]=(-y*i+r*p)*P,e[8]=(a*i-r*n)*P,e):null}function HYe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5],p=t[6],y=t[7],b=t[8];return e[0]=a*b-l*y,e[1]=s*y-r*b,e[2]=r*l-s*a,e[3]=l*p-n*b,e[4]=i*b-s*p,e[5]=s*n-i*l,e[6]=n*y-a*p,e[7]=r*p-i*y,e[8]=i*a-r*n,e}function qYe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],l=e[6],p=e[7],y=e[8];return t*(y*n-a*p)+i*(-y*s+a*l)+r*(p*s-n*l)}function UN(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=t[6],b=t[7],x=t[8],A=i[0],M=i[1],P=i[2],$=i[3],k=i[4],z=i[5],G=i[6],B=i[7],W=i[8];return e[0]=A*r+M*a+P*y,e[1]=A*s+M*l+P*b,e[2]=A*n+M*p+P*x,e[3]=$*r+k*a+z*y,e[4]=$*s+k*l+z*b,e[5]=$*n+k*p+z*x,e[6]=G*r+B*a+W*y,e[7]=G*s+B*l+W*b,e[8]=G*n+B*p+W*x,e}function gD(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=t[6],b=t[7],x=t[8],A=i[0],M=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=a,e[4]=l,e[5]=p,e[6]=A*r+M*a+y,e[7]=A*s+M*l+b,e[8]=A*n+M*p+x,e}function oJ(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=t[6],b=t[7],x=t[8],A=Math.sin(i),M=Math.cos(i);return e[0]=M*r+A*a,e[1]=M*s+A*l,e[2]=M*n+A*p,e[3]=M*a-A*r,e[4]=M*l-A*s,e[5]=M*p-A*n,e[6]=y,e[7]=b,e[8]=x,e}function aJ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function WYe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function XYe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function YYe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function JYe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ZYe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function lJ(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=i+i,l=r+r,p=s+s,y=i*a,b=r*a,x=r*l,A=s*a,M=s*l,P=s*p,$=n*a,k=n*l,z=n*p;return e[0]=1-x-P,e[3]=b-z,e[6]=A+k,e[1]=b+z,e[4]=1-y-P,e[7]=M-$,e[2]=A-k,e[5]=M+$,e[8]=1-y-x,e}function tbe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],a=t[5],l=t[6],p=t[8],y=t[9],b=t[10],x=b*a-l*y,A=-b*n+l*p,M=y*n-a*p,P=i*x+r*A+s*M;if(!P)return null;const $=1/P;return e[0]=x*$,e[1]=(-b*r+s*y)*$,e[2]=(l*r-s*a)*$,e[3]=A*$,e[4]=(b*i-s*p)*$,e[5]=(-l*i+s*n)*$,e[6]=M*$,e[7]=(-y*i+r*p)*$,e[8]=(a*i-r*n)*$,e}function IS(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5],p=t[6],y=t[7],b=t[8],x=t[9],A=t[10],M=t[11],P=t[12],$=t[13],k=t[14],z=t[15],G=i*l-r*a,B=i*p-s*a,W=i*y-n*a,q=r*p-s*l,X=r*y-n*l,oe=s*y-n*p,de=b*$-x*P,he=b*k-A*P,fe=b*z-M*P,me=x*k-A*$,ge=x*z-M*$,Ce=A*z-M*k;let Ae=G*Ce-B*ge+W*me+q*fe-X*he+oe*de;return Ae?(Ae=1/Ae,e[0]=(l*Ce-p*ge+y*me)*Ae,e[1]=(p*fe-a*Ce-y*he)*Ae,e[2]=(a*ge-l*fe+y*de)*Ae,e[3]=(s*ge-r*Ce-n*me)*Ae,e[4]=(i*Ce-s*fe+n*he)*Ae,e[5]=(r*fe-i*ge-n*de)*Ae,e[6]=($*oe-k*X+z*q)*Ae,e[7]=(k*W-P*oe-z*B)*Ae,e[8]=(P*X-$*W+z*G)*Ae,e):null}function KYe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function QYe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function eJe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function tJe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function ibe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function iJe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function rJe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function sJe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function nJe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],l=e[5],p=e[6],y=e[7],b=e[8],x=t[0],A=t[1],M=t[2],P=t[3],$=t[4],k=t[5],z=t[6],G=t[7],B=t[8];return Math.abs(i-x)<=pi*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(r-A)<=pi*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(s-M)<=pi*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(n-P)<=pi*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(a-$)<=pi*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(l-k)<=pi*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(p-z)<=pi*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(y-G)<=pi*Math.max(1,Math.abs(y),Math.abs(G))&&Math.abs(b-B)<=pi*Math.max(1,Math.abs(b),Math.abs(B))}function cJ(e){const t=pi,i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],l=e[5],p=e[6],y=e[7],b=e[8];return Math.abs(1-(i*i+n*n+p*p))<=t&&Math.abs(1-(r*r+a*a+y*y))<=t&&Math.abs(1-(s*s+l*l+b*b))<=t}const oJe=UN,aJe=ibe;Object.freeze({__proto__:null,fromMat4:md,copy:LR,set:sJ,identity:nJ,transpose:gd,invert:iw,adjoint:HYe,determinant:qYe,multiply:UN,translate:gD,rotate:oJ,scale:aJ,scaleByVec2:WYe,fromTranslation:XYe,fromRotation:YYe,fromScaling:JYe,fromMat2d:ZYe,fromQuat:lJ,normalFromMat4Legacy:tbe,normalFromMat4:IS,projection:KYe,str:QYe,frob:eJe,add:tJe,subtract:ibe,multiplyScalar:iJe,multiplyScalarAndAdd:rJe,exactEquals:sJe,equals:nJe,isOrthoNormal:cJ,mul:oJe,sub:aJe});function Xv(e,t=!0){e.attributes.add(Y.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(V`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?V`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}function lJe(){const e=new Ir;e.include(Xv,!1),e.fragment.uniforms.add("tileRows","float").add("tileSize","float");const t=2,i=8;return e.fragment.code.add(V`
    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    vec4 taylorInvSqrt(vec4 r) {
      return 1.79284291400159 - 0.85373472095314 * r;
    }

    vec4 mod289(vec4 x) {
      return x - floor( x * (1.0 / 289.0)) * 289.0;
    }

    vec4 permute(vec4 x) {
      return mod289(((x * 34.0) + 1.0) * x);
    }

    vec4 fade(vec4 t) {
      return (t * t * t) * (t * (t * vec4(6.0) - vec4(15.0)) + vec4(10.0));
    }

    float glmPerlin(vec4 Position, vec4 rep) {
      vec4 Pi0 = mod(floor(Position), rep);
      vec4 Pi1 = mod(Pi0 + 1.0, rep);
      vec4 Pf0 = fract(Position);
      vec4 Pf1 = Pf0 - 1.0;
      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
      vec4 iy = vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);

      vec4 ixy = permute(permute(ix) + iy);
      vec4 ixy0 = permute(ixy + vec4(Pi0.z));
      vec4 ixy1 = permute(ixy + vec4(Pi1.z));
      vec4 ixy00 = permute(ixy0 + vec4(Pi0.w));
      vec4 ixy01 = permute(ixy0 + vec4(Pi1.w));
      vec4 ixy10 = permute(ixy1 + vec4(Pi0.w));
      vec4 ixy11 = permute(ixy1 + vec4(Pi1.w));

      vec4 gx00 = ixy00 / 7.0;
      vec4 gy00 = floor(gx00) / 7.0;
      vec4 gz00 = floor(gy00) / 6.0;
      gx00 = fract(gx00) - 0.5;
      gy00 = fract(gy00) - 0.5;
      gz00 = fract(gz00) - 0.5;
      vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);
      vec4 sw00 = step(gw00, vec4(0.0));
      gx00 -= sw00 * (step(0.0, gx00) - 0.5);
      gy00 -= sw00 * (step(0.0, gy00) - 0.5);

      vec4 gx01 = ixy01 / 7.0;
      vec4 gy01 = floor(gx01) / 7.0;
      vec4 gz01 = floor(gy01) / 6.0;
      gx01 = fract(gx01) - 0.5;
      gy01 = fract(gy01) - 0.5;
      gz01 = fract(gz01) - 0.5;
      vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);
      vec4 sw01 = step(gw01, vec4(0.0));
      gx01 -= sw01 * (step(0.0, gx01) - 0.5);
      gy01 -= sw01 * (step(0.0, gy01) - 0.5);

      vec4 gx10 = ixy10 / 7.0;
      vec4 gy10 = floor(gx10) / 7.0;
      vec4 gz10 = floor(gy10) / 6.0;
      gx10 = fract(gx10) - 0.5;
      gy10 = fract(gy10) - 0.5;
      gz10 = fract(gz10) - 0.5;
      vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);
      vec4 sw10 = step(gw10, vec4(0.0));
      gx10 -= sw10 * (step(0.0, gx10) - 0.5);
      gy10 -= sw10 * (step(0.0, gy10) - 0.5);

      vec4 gx11 = ixy11 / 7.0;
      vec4 gy11 = floor(gx11) / 7.0;
      vec4 gz11 = floor(gy11) / 6.0;
      gx11 = fract(gx11) - 0.5;
      gy11 = fract(gy11) - 0.5;
      gz11 = fract(gz11) - 0.5;
      vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);
      vec4 sw11 = step(gw11, vec4(0.0));
      gx11 -= sw11 * (step(0.0, gx11) - 0.5);
      gy11 -= sw11 * (step(0.0, gy11) - 0.5);

      vec4 g0000 = vec4(gx00.x, gy00.x, gz00.x, gw00.x);
      vec4 g1000 = vec4(gx00.y, gy00.y, gz00.y, gw00.y);
      vec4 g0100 = vec4(gx00.z, gy00.z, gz00.z, gw00.z);
      vec4 g1100 = vec4(gx00.w, gy00.w, gz00.w, gw00.w);
      vec4 g0010 = vec4(gx10.x, gy10.x, gz10.x, gw10.x);
      vec4 g1010 = vec4(gx10.y, gy10.y, gz10.y, gw10.y);
      vec4 g0110 = vec4(gx10.z, gy10.z, gz10.z, gw10.z);
      vec4 g1110 = vec4(gx10.w, gy10.w, gz10.w, gw10.w);
      vec4 g0001 = vec4(gx01.x, gy01.x, gz01.x, gw01.x);
      vec4 g1001 = vec4(gx01.y, gy01.y, gz01.y, gw01.y);
      vec4 g0101 = vec4(gx01.z, gy01.z, gz01.z, gw01.z);
      vec4 g1101 = vec4(gx01.w, gy01.w, gz01.w, gw01.w);
      vec4 g0011 = vec4(gx11.x, gy11.x, gz11.x, gw11.x);
      vec4 g1011 = vec4(gx11.y, gy11.y, gz11.y, gw11.y);
      vec4 g0111 = vec4(gx11.z, gy11.z, gz11.z, gw11.z);
      vec4 g1111 = vec4(gx11.w, gy11.w, gz11.w, gw11.w);

      vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));
      g0000 *= norm00.x;
      g0100 *= norm00.y;
      g1000 *= norm00.z;
      g1100 *= norm00.w;

      vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));
      g0001 *= norm01.x;
      g0101 *= norm01.y;
      g1001 *= norm01.z;
      g1101 *= norm01.w;

      vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));
      g0010 *= norm10.x;
      g0110 *= norm10.y;
      g1010 *= norm10.z;
      g1110 *= norm10.w;

      vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));
      g0011 *= norm11.x;
      g0111 *= norm11.y;
      g1011 *= norm11.z;
      g1111 *= norm11.w;

      float n0000 = dot(g0000, Pf0);
      float n1000 = dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));
      float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));
      float n1100 = dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));
      float n0010 = dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));
      float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));
      float n0110 = dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));
      float n1110 = dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));
      float n0001 = dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));
      float n1001 = dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));
      float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));
      float n1101 = dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));
      float n0011 = dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));
      float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));
      float n0111 = dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));
      float n1111 = dot(g1111, Pf1);

      vec4 fade_xyzw = fade(Pf0);
      vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);
      vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);
      vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);
      vec2 n_yzw = mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);
      float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);
      return 2.2 * n_xyzw;
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float hash(float p) {
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);;
    }

    float noise(vec3 x) {
      vec3 p = floor(x);
      vec3 f = fract(x);

      f = f * f * (3.0 - 2.0 * f);
      float n = p.x + p.y * 57.0 + 113.0 * p.z;

      return mix(
      mix(
        mix(hash(n + 0.0), hash(n + 1.0), f.x),
        mix(hash(n + 57.0), hash(n + 58.0), f.x),
        f.y),
      mix(
        mix(hash(n + 113.0), hash(n + 114.0), f.x),
        mix(hash(n + 170.0), hash(n + 171.0), f.x),
        f.y),
      f.z);
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - noise(mod(tp, numCells));
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv, float tileRows) {
      vec2 tile = floor(uv);
      float z = floor(tileRows * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${V.float(i)});

      float worley0 = worley(p, ${V.float(t)} * 2.0);
      float worley1 = worley(p, ${V.float(t)} * 8.0);
      float worley2 = worley(p, ${V.float(t)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${V.float(t)});
      float worley1 = worley(p, ${V.float(t)} * 2.0);
      float worley2 = worley(p, ${V.float(t)} * 4.0);
      float worley3 = worley(p, ${V.float(t)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.code.add(V`void main() {
float padWidth = 1.0;
float paddedSize = tileSize + 2.0 * padWidth;
float tileCount = tileRows * tileRows;
vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);
bool padCell = false;
if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
bool startPadX = false;
bool startPadY = false;
bool endPadX = false;
bool endPadY = false;
if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
startPadX = true;
}
if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
startPadY = true;
}
if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
endPadX = true;
}
if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
endPadY = true;
}
vec2 padding = vec2(2.0 * padWidth) * tile;
vec2 uv;
if (padCell) {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
if (startPadX) {
pixel.x += tileSize;
}
if (startPadY) {
pixel.y += tileSize;
}
if (endPadX) {
pixel.x -= tileSize;
}
if (endPadY) {
pixel.y -= tileSize;
}
uv = vec2(pixel.xy / tileSize);
} else {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
uv = vec2(pixel.xy / tileSize);
}
vec3 p_ = get3Dfrom2D(uv, tileRows);
vec3 p = p_;
p.z /= (tileRows * tileRows);
float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
float worleyNoise = getTextureForPointWorley(p);
gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
p_ = mod(p_ + 1.0, tileRows * tileRows);
p = p_;
p.z /= (tileRows * tileRows);
worleyPerlinNoise = getTextureForPointPerlinWorley(p);
worleyNoise = getTextureForPointWorley(p);
gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
gl_FragColor.ba = vec2(0.0, 1.0);
}`),e}const cJe=Object.freeze({__proto__:null,build:lJe});class zN extends Xr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=zN.shader.get().build();return new $r(t.rctx,i,mr)}initializePipeline(){return Ti({blending:su(ht.ONE,ht.ZERO),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}zN.shader=new Ur(cJe,()=>import("./NoiseTextureAtlas.glsl.d06ee6de.js"));class E3{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(so.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:a,multisampled:l}=i;if(l){if(this._context.type!==Yi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,a,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(so.Renderbuffer,this),this._context=null)}}const hJe=Ge.getLogger("esri.views.webgl.FrameBufferObject");class Hr{constructor(t,i,r=null,s=null){if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=ie({},i),t.instanceCounter.increment(so.Framebuffer,this),L(r)){Array.isArray(r)||(r=[r]);for(let a=0;a<r.length;++a){const l=r[a],p=Mh.COLOR_ATTACHMENT0+a;let y;ine(l)?(Sm(l)?(y=l.descriptor,this._colorAttachments.set(p,l)):(y=l,this._colorAttachments.set(p,new Vt(this._context,y))),F5(y,this._desc)):(tne(l)?(y=l.descriptor,this._colorAttachments.set(p,l)):(y=l,this._colorAttachments.set(p,new E3(this._context,y))),tk(y,this._desc)),this._validateColorAttachmentPoint(p)}}if(L(s)){let a,l;if(ine(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Sm(s)?(l=s.descriptor,this._depthStencilTexture=s):(l=s,this._depthStencilTexture=new Vt(this._context,l)),F5(l,this._desc);else{var n;tne(s)?(l=s.descriptor,a=s):(l=s,a=new E3(this._context,l));const p=(n=this._desc.depthStencilTarget)!=null?n:Qi.DEPTH_STENCIL_RENDER_BUFFER;p===Qi.STENCIL_RENDER_BUFFER?this._stencilAttachment=a:p===Qi.DEPTH_RENDER_BUFFER||p===Qi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=a:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),tk(l,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(so.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Mh.COLOR_ATTACHMENT0);return t&&Sm(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Mh.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+uv(r),0)+uv(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&Sm(i)?i:null}attachColorTexture(t,i=Mh.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),F5(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=Mh.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(Sm(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=Mh.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Sm(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(J(t))return;const i=t.descriptor;i.pixelFormat!==_t.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==ai.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),F5(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Qi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Qi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Vte)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Vte)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(J(t))return;const i=t.descriptor;if(i.internalFormat!==hl.DEPTH_STENCIL&&i.internalFormat!==hl.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),tk(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===hl.DEPTH_STENCIL?Qi.DEPTH_STENCIL_RENDER_BUFFER:Qi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Qi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(uo.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Qi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(uo.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,a,l){(t<0||i<0||n<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const p=this._desc,y=l.descriptor;l.descriptor.target!==Yt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>p.width||i+s>p.height||n+r>y.width||a+s>y.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const b=this._context,x=b.bindTexture(l,Vt.TEXTURE_UNIT_FOR_UPDATES);b.setActiveTexture(Vt.TEXTURE_UNIT_FOR_UPDATES),b.bindFramebuffer(this),b.gl.copyTexSubImage2D(Yt.TEXTURE_2D,0,n,a,t,i,r,s),b.bindTexture(x,Vt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,a,l){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),l||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,a,l)}async readPixelsAsync(t,i,r,s,n,a,l){if(this._context.type!==Yi.WEBGL2)return Bu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,a,l);const p=this._context.gl,y=Fi.createPixelPack(this._context,tr.STREAM_READ,l.byteLength);this._context.bindBuffer(y),this._context.bindFramebuffer(this),p.readPixels(t,i,r,s,n,a,0),this._context.unbindBuffer(ni.PIXEL_PACK_BUFFER),await y.getSubDataAsync(l),y.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=uo.FRAMEBUFFER){var i,r,s,n;const a=this._context.gl;if(this._initialized)return void a.bindFramebuffer(t,this.glName);this._glName&&a.deleteFramebuffer(this._glName);const l=this._context,p=a.createFramebuffer(),y=this._desc,b=(i=y.colorTarget)!=null?i:ks.RENDER_BUFFER,x=(r=y.width)!=null?r:1,A=(s=y.height)!=null?s:1;if(a.bindFramebuffer(t,p),this._colorAttachments.size===0)if(b===ks.TEXTURE||b===ks.CUBEMAP)this._colorAttachments.set(Mh.COLOR_ATTACHMENT0,uJe(l,y,this.descriptor.colorTarget===ks.CUBEMAP?Yt.TEXTURE_CUBE_MAP:Yt.TEXTURE_2D));else{const P=new E3(l,{internalFormat:Jt.RGBA4,width:x,height:A});this._colorAttachments.set(Mh.COLOR_ATTACHMENT0,P)}this._colorAttachments.forEach((P,$)=>{P&&(Sm(P)?this._framebufferTexture2D(P.glName,$,rne(P),t):a.framebufferRenderbuffer(t,$,a.RENDERBUFFER,P.glName))});const M=(n=y.depthStencilTarget)!=null?n:Qi.NONE;switch(M){case Qi.DEPTH_RENDER_BUFFER:case Qi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new E3(l,{internalFormat:y.depthStencilTarget===Qi.DEPTH_RENDER_BUFFER?hl.DEPTH_COMPONENT16:hl.DEPTH_STENCIL,width:x,height:A}));const P=M===Qi.DEPTH_RENDER_BUFFER?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;a.framebufferRenderbuffer(t,P,a.RENDERBUFFER,this._depthAttachment.glName);break}case Qi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new E3(l,{internalFormat:hl.STENCIL_INDEX8,width:x,height:A})),a.framebufferRenderbuffer(t,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case Qi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){l.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const P={target:Yt.TEXTURE_2D,pixelFormat:_t.DEPTH_STENCIL,dataType:ai.UNSIGNED_INT_24_8,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:x,height:A};this._depthStencilTexture=new Vt(l,P)}this._framebufferTexture2D(this._depthStencilTexture.glName,a.DEPTH_STENCIL_ATTACHMENT,rne(this._depthStencilTexture),t)}PR()&&a.checkFramebufferStatus(t)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=p,this._initialized=!0}_framebufferTexture2D(t,i=Mh.COLOR_ATTACHMENT0,r=Yt.TEXTURE_2D,s=uo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){Bu()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return Sm(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(uo.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Qi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(uo.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(uo.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Hr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Hr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Hr._MAX_COLOR_ATTACHMENTS=1}const i=t-Mh.COLOR_ATTACHMENT0;i+1>Hr._MAX_COLOR_ATTACHMENTS&&hJe.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Hr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Sm(e){return"type"in e&&e.type==="texture"}function tne(e){return"type"in e&&e.type==="renderbuffer"}function ine(e){return Sm(e)||"pixelFormat"in e}function uJe(e,t,i){return new Vt(e,{target:i,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:t.width,height:t.height})}function F5(e,t){e.target!==Yt.TEXTURE_2D&&e.target!==Yt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function tk(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function rne(e){return e.descriptor.target===Yt.TEXTURE_CUBE_MAP?Yt.TEXTURE_CUBE_MAP_POSITIVE_X:Yt.TEXTURE_2D}Hr._MAX_COLOR_ATTACHMENTS=-1;const $S=je("esri-mobile")?64:128,dJe=$S/128,hJ=Math.ceil(Math.sqrt($S)),Ty=($S+2)*hJ;class pJe{constructor(t,i){this._frameBuffer=new Hr(t,{colorTarget:ks.TEXTURE,width:Ty,height:Ty},{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,hasMipmap:!1,width:Ty,height:Ty}),this._vao=Ga(t),this._technique=new zN({rctx:t,viewingMode:i.state.viewingMode})}get textureAtlas(){return this._frameBuffer.colorTexture}destroy(){this._technique=es(this._technique),this._frameBuffer=Xt(this._frameBuffer),this._vao=Xt(this._vao)}render(t){if(J(this._vao)||J(this.textureAtlas))return;const i=t.getViewport();t.setViewport(0,0,Ty,Ty),t.bindFramebuffer(this._frameBuffer);const r=t.useTechnique(this._technique);r.setUniform1f("tileSize",$S),r.setUniform1f("tileRows",hJ),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(i.x,i.y,i.width,i.height)}}var id;function fJe(e){const t=new Ir;return t.include(Xv,!1),t.fragment.uniforms.add("cloudRadius","float").add("halfCubeMapSize","float").add("power","float").add("sigmaE","float").add("density","float").add("cloudSize","float").add("detailSize","float").add("smoothness","float").add("cloudHeight","float").add("coverage","float").add("view","mat3").add("cloudShapeTexture","sampler2D"),t.fragment.code.add(V`
    const int STEPS = ${e.steps===id.SIXTEEN?V`16`:e.steps===id.HUNDRED?V`100`:V`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);

    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(V`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${V.float(Ty)};
      const float dataWidth = ${V.float(Ty)};
      const float tileRows = ${V.float(hJ)};
      const vec3 atlasDimensions = vec3(${V.float($S)}, ${V.float($S)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${V.float(dJe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }`),t.fragment.code.add(V`float clouds(vec3 p) {
float cloudVariations = getCloudShape(0.002 * p, 0.5);
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
cloud += (cloudVariations * 0.6 - 0.3) * ( -4.0 * (coverage * coverage - coverage));
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));
float shape = getCloudShape(cloudSize * p, 0.0);
shape *= mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));
cloud = saturate(remap(cloud, shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(V`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(V`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(V`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(V`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(id||(id={}));const mJe=Object.freeze({__proto__:null,get RayMarchingSteps(){return id},build:fJe});class rA{constructor(t,i,r,s,n,a,l,p,y=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=a,this.cloudHeight=l,this.raymarchingStepType=p,this.median=y}}const rbe={sunny:new rA([.1,.7],[.02,.02],[0,0],[.86,.86],[.8,.8],[.5,.5],[.05,.05],id.SIXTEEN),cloudy:new rA([.24,.7],[.135,.2],[0,0],[.5,.5],[.65,.7],[.3,.3],[1,1],id.TWOHUNDRED),rainy:new rA([.5,.9],[.2,.5],[.3,.6],[.4,.4],[.7,.7],[.5,.5],[1,1],id.TWOHUNDRED),snowy:new rA([.5,.9],[.2,.5],[0,0],[.4,.4],[.7,.7],[.5,.5],[1,1],id.TWOHUNDRED),foggy:new rA([.8,.8],[.5,.5],[0,0],[.85,.85],[.75,.75],[.8,.8],[.3,.3],id.HUNDRED)};class BN extends Xr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=BN.shader.get().build({steps:this.configuration.steps});return new $r(t.rctx,i,mr)}initializePipeline(){return Ti({blending:ga(ht.ONE,ht.ONE,ht.ZERO,ht.ZERO),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}BN.shader=new Ur(mJe,()=>import("./Clouds.glsl.02be8d50.js"));class sbe extends Rs{constructor(){super(...arguments),this.steps=id.SIXTEEN}}_([Oe({count:id.COUNT})],sbe.prototype,"steps",void 0);let Ka=class extends st{constructor(e){super(e),this._frameTask=null,this._handles=new Ei,this._cubeMapSize=je("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new sbe,this.coverage=Vi(xl.coverage[0],xl.coverage[1],.5),this.density=Vi(xl.density[0],xl.density[1],.5),this.absorption=Vi(xl.absorption[0],xl.absorption[1],.5),this.cloudSize=Vi(xl.cloudSize[0],xl.cloudSize[1],.5),this.detailSize=Vi(xl.detailSize[0],xl.detailSize[1],.5),this.smoothness=Vi(xl.smoothness[0],xl.smoothness[1],.5),this.cloudHeight=Vi(xl.cloudHeight[0],xl.cloudHeight[1],.5),this.raymarchingStepType=xl.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=lt(),this._viewMatrix3=zs(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new BN({rctx:this.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}initialize(){this._vao=Ga(this.rctx);const e=ir(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._frameTask=this.view.resourceController.scheduler.registerTask(ii.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(Pi(this,"coverage",()=>this.setDirty())),["coverage","density","absorption","cloudSize","detailSize","smoothness","cloudHeight","raymarchingStepType"].forEach(t=>this._handles.add(Pi(this,t,()=>this.setDirty())))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>es(e)),this._techniques=null,this._frameBufferCube=Xt(this._frameBufferCube),this._vao=Xt(this._vao),this._noiseTexture=Ht(this._noiseTexture)}_ensureNoiseTexture(){return J(this._noiseTexture)&&(this._noiseTexture=new pJe(this.rctx,this.view),this._noiseTexture.render(this.rctx)),this._noiseTexture.textureAtlas}get frameBufferCube(){if(J(this._frameBufferCube)){const e={target:Yt.TEXTURE_CUBE_MAP,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Hr(this.rctx,{colorTarget:ks.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}applyPreset(e,t){const i=e.median,r=s=>{const n=Vi(s[0],s[1],i);return t<.5?Vi(s[0],n,2*t):Vi(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||J(this._vao))return void(this.running=!1);const t=this._ensureNoiseTexture();if(J(t))return void(this.running=!1);const i=this._getTechnique(this.raymarchingStepType);if(!this.rctx.isTechniqueCompiled(i))return;const r=this.rctx.getViewport();this.rctx.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),this.rctx.bindFramebuffer(this.frameBufferCube);const s=this.rctx.useTechnique(i),n=1+this.absorption,a=Vi(35,120,this.absorption);s.bindTexture(t,"cloudShapeTexture"),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",a),s.setUniform1f("sigmaE",n),s.setUniform1f("density",Vi(0,.3,this.density)),s.setUniform1f("cloudSize",Vi(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",Vi(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",Vi(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",Vi(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),this.rctx.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);for(let l=0;l<5;l++){const p=gJe[l],y=yJe[l];ome(this._viewMatrix,vJe,p,y),md(this._viewMatrix3,this._viewMatrix),s.setUniformMatrix3fv("view",this._viewMatrix3);const b=Yt.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(b),this.rctx.gl.drawArrays(this.rctx.gl.TRIANGLE_STRIP,0,4),this.rctx.gl.flush()}this.running=!1,this.rctx.setViewport(r.x,r.y,r.width,r.height),this.requestRender(),e.madeProgress()}};_([S({constructOnly:!0})],Ka.prototype,"rctx",void 0),_([S({constructOnly:!0})],Ka.prototype,"view",void 0),_([S({constructOnly:!0})],Ka.prototype,"requestRender",void 0),_([S()],Ka.prototype,"_frameTask",void 0),_([S()],Ka.prototype,"coverage",void 0),_([S()],Ka.prototype,"density",void 0),_([S()],Ka.prototype,"absorption",void 0),_([S()],Ka.prototype,"cloudSize",void 0),_([S()],Ka.prototype,"detailSize",void 0),_([S()],Ka.prototype,"smoothness",void 0),_([S()],Ka.prototype,"cloudHeight",void 0),_([S()],Ka.prototype,"raymarchingStepType",void 0),_([S()],Ka.prototype,"running",void 0),Ka=_([re("esri.views.3d.environment.CloudsGenerator")],Ka);const gJe=[Bi(1,0,0),Bi(-1,0,0),Bi(0,1,0),Bi(0,-1,0),Bi(0,0,1)],yJe=[Bi(0,1,0),Bi(0,1,0),Bi(0,0,-1),Bi(0,0,1),Bi(0,1,0)],vJe=eJ(),xl=rbe.sunny;function _Je(e){const t=new Ir;return t.attributes.add(Y.POSITION,"vec2"),t.include(dg,{attributeTextureCoordinates:Go.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("inverseProjectionMatrix","mat4"),t.vertex.uniforms.add("inverseViewMatrix","mat4"),t.vertex.code.add(V`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),t.fragment.uniforms.add("atmosphereC","float").add("cameraPosition","vec3").add("nearFar","vec2").add("depthTex","sampler2D").add("fogStrength","float").add("fogAmount","float").add("fogColor","vec3"),t.include(DN),t.fragment.include(Yn),t.fragment.code.add(V`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),t.fragment.code.add(V`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),t.fragment.code.add(V`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?V`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const bJe=Object.freeze({__proto__:null,build:_Je});class NR extends Xr{initializeProgram(t){const i=NR.shader.get(),r=this.configuration,s=i.build({haze:r.haze});return new $r(t.rctx,s,mr)}initializePipeline(){return this.configuration.haze?Ti({blending:ga(ht.ONE,ht.ZERO,ht.ONE_MINUS_SRC_COLOR,ht.ONE),colorWrite:Ii}):Ti({blending:ga(ht.SRC_ALPHA,ht.ZERO,ht.ONE_MINUS_SRC_ALPHA,ht.ONE),colorWrite:Ii})}}NR.shader=new Ur(bJe,()=>import("./Fog.glsl.215d4d14.js"));class Qj extends Rs{constructor(){super(...arguments),this.haze=!1}}_([Oe()],Qj.prototype,"haze",void 0);let jC=class extends st{constructor(e){super(e),this._projectionInverse=lt(),this._viewInverse=lt(),this._nearFar=St(),this._fogColor=fr(),this._fogColorAtNight=fr(),this._cameraDirection=fr(),this._foggyFadeStart=.3,this._foggyFadeEnd=.6,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=Ga(t,t4);const i=ir(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+K9}destroy(){this._hazeFogTechnique=es(this._hazeFogTechnique),this._thickFogTechnique=es(this._thickFogTechnique),this._vao=Xt(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(J(this._thickFogTechnique)){const e=new Qj;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(NR,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(J(this._hazeFogTechnique)){const e=new Qj;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(NR,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=e.offscreenRenderingHelper,s=t?this.thickFogTechnique:this.hazeFogTechnique,n=e.rctx.useTechnique(s);r.renderDepthDetached(()=>{n.bindTexture(r.depthTexture,"depthTex"),this._renderFog(s.program,e)})}_renderFog(e,t){if(J(this._vao))return!1;const i=t.rctx;return e.setUniform3fv("cameraPosition",t.camera.eye),e.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse),e.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse),e.setUniform2fv("nearFar",this._nearFar),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(mi.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){if(J(e.camera))return;const r=t?.1:0;i?ze(this._fogColor,.5,.5,.5):t?ze(this._fogColor,1.5,1.5,1.5):ze(this._fogColor,.24,.44,.8),Ue(this._fogColorAtNight,this._fogColor,r),ot(this._cameraDirection,e.camera.eye);const s=Math.max(0,rt(this._cameraDirection,e.scenelightingData.lightingMainDirection));Wn(this._fogColor,this._fogColorAtNight,this._fogColor,s),Ms(this._projectionInverse,e.camera.projectionMatrix),Ms(this._viewInverse,e.camera.viewMatrix),ds(this._nearFar,e.camera.near,e.camera.far);const n=yt(e.camera.eye),a=n*n;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-JT(this._foggyFadeStart*qu,this._foggyFadeEnd*qu,Math.abs(n-this._planetRadius)):1-JT(this._hazeFadeStart*qu,this._hazeFadeEnd*qu,Math.abs(n-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};_([S({constructOnly:!0})],jC.prototype,"context",void 0),_([S({constructOnly:!0})],jC.prototype,"view",void 0),jC=_([re("esri.views.3d.environment.Fog")],jC);async function yd(e,t){const{data:i}=await Ar(e,ie({responseType:"image"},t));return i}function da(e,t){const i=ie({hasModelTransformation:!1},t);if(i.hasModelTransformation)return i.linearDepth?void e.vertex.code.add(V`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(V`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);i.linearDepth?e.vertex.code.add(V`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(V`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}var zp;function wJe(e){const t=new Ir;if(e.geometry===zp.Underground)t.attributes.add(Y.POSITION,"vec2"),t.varyings.add("color","vec4"),t.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),t.vertex.code.add(V`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),t.fragment.code.add(V`void main() {
gl_FragColor = color;
}`);else{t.include(da,{linearDepth:!1}),t.attributes.add(Y.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const i=e.geometry===zp.Cylinder;t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),i||(t.varyings.add("innerFactor","float"),t.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"));const r=6.2831853,s=1/128;t.vertex.code.add(V`
		void main(void) {
      ${i?V`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:V`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${V.float(r*s)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${V.float(s)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),t.fragment.uniforms.add("tex","sampler2D"),i||t.fragment.uniforms.add("altitudeFade","float"),t.fragment.code.add(V`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${i?V`gl_FragColor = atmosphereColor;`:V`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(zp||(zp={}));const xJe=Object.freeze({__proto__:null,get SimpleAtmosphereGeometry(){return zp},build:wJe});class DS extends Xr{initializeProgram(t){const i=DS.shader.get(),r=this.configuration,s=i.build({geometry:r.geometry});return new $r(t.rctx,s,mr)}initializePipeline(){return this.configuration.geometry===zp.Cylinder?Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),culling:YY,depthTest:{func:kr.LEQUAL},colorWrite:Ii}):Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}DS.shader=new Ur(xJe,()=>import("./SimpleAtmosphere.glsl.dbc51c53.js"));class yD extends Rs{constructor(){super(...arguments),this.geometry=zp.Cone}}_([Oe({count:zp.COUNT})],yD.prototype,"geometry",void 0);const nbe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function ch(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,a=TJe(s.constructor.ElementType),l=s.offset,p=!(!s.optional||!s.optional.glNormalized);return new jo(r,n,a,l,i,p,t)})}function TJe(e){const t=SJe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const SJe={u8:Zt.UNSIGNED_BYTE,u16:Zt.UNSIGNED_SHORT,u32:Zt.UNSIGNED_INT,i8:Zt.BYTE,i16:Zt.SHORT,i32:Zt.INT,f32:Zt.FLOAT};class uJ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const a=this.TypedArrayConstructor;s===void 0&&(s=9*a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=t*this.typedBufferStride,l=r*i.typedBufferStride;for(let p=0;p<9;++p)s[a++]=n[l++]}get buffer(){return this.typedBuffer.buffer}}uJ.ElementCount=9;class dJ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const a=this.TypedArrayConstructor;s===void 0&&(s=16*a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=t*this.typedBufferStride,l=r*i.typedBufferStride;for(let p=0;p<16;++p)s[a++]=n[l++]}get buffer(){return this.typedBuffer.buffer}}dJ.ElementCount=16;class jg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const a=this.TypedArrayConstructor;s===void 0&&(s=a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}jg.ElementCount=1;class Hg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const a=this.TypedArrayConstructor;s===void 0&&(s=2*a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,ds(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=t*this.typedBufferStride,l=r*i.typedBufferStride;s[a++]=n[l++],s[a]=n[l]}get buffer(){return this.typedBuffer.buffer}}Hg.ElementCount=2;class qg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const a=this.TypedArrayConstructor;s===void 0&&(s=3*a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,ze(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=t*this.typedBufferStride,l=r*i.typedBufferStride;s[a++]=n[l++],s[a++]=n[l++],s[a]=n[l]}get buffer(){return this.typedBuffer.buffer}}qg.ElementCount=3;class Wg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const a=this.TypedArrayConstructor;s===void 0&&(s=4*a.BYTES_PER_ELEMENT);const l=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,l):new a(i,l,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,fl(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=t*this.typedBufferStride,l=r*i.typedBufferStride;s[a++]=n[l++],s[a++]=n[l++],s[a++]=n[l++],s[a]=n[l]}get buffer(){return this.typedBuffer.buffer}}Wg.ElementCount=4;class r4 extends jg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new r4(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}r4.ElementType="f32";class vd extends Hg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(vd,t,i)}static fromTypedArray(t,i){return new vd(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}vd.ElementType="f32";class Cr extends qg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Cr,t,i)}static fromTypedArray(t,i){return new Cr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Cr.ElementType="f32";class So extends Wg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(So,t,i)}static fromTypedArray(t,i){return new So(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}So.ElementType="f32";class Bp extends uJ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Bp,t,i)}static fromTypedArray(t,i){return new Bp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Bp.ElementType="f32";class Mv extends uJ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Mv,t,i)}static fromTypedArray(t,i){return new Mv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Mv.ElementType="f64";class LS extends dJ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(LS,t,i)}static fromTypedArray(t,i){return new LS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}LS.ElementType="f32";class Rv extends dJ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Rv,t,i)}static fromTypedArray(t,i){return new Rv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Rv.ElementType="f64";class NS extends jg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(NS,t,i)}static fromTypedArray(t,i){return new NS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}NS.ElementType="f64";class FS extends Hg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(FS,t,i)}static fromTypedArray(t,i){return new FS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}FS.ElementType="f64";class gn extends qg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(gn,t,i)}static fromTypedArray(t,i){return new gn(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gn.ElementType="f64";class rw extends Wg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(rw,t,i)}static fromTypedArray(t,i){return new rw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}rw.ElementType="f64";class Og extends jg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Og,t,i)}static fromTypedArray(t,i){return new Og(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Og.ElementType="u8";class sw extends Hg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(sw,t,i)}static fromTypedArray(t,i){return new sw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}sw.ElementType="u8";class Ov extends qg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Ov,t,i)}static fromTypedArray(t,i){return new Ov(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ov.ElementType="u8";class lc extends Wg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(lc,t,i)}static fromTypedArray(t,i){return new lc(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}lc.ElementType="u8";class nw extends jg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(nw,t,i)}static fromTypedArray(t,i){return new nw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}nw.ElementType="u16";class kS extends Hg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(kS,t,i)}static fromTypedArray(t,i){return new kS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kS.ElementType="u16";class ow extends qg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(ow,t,i)}static fromTypedArray(t,i){return new ow(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ow.ElementType="u16";class Pv extends Wg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Pv,t,i)}static fromTypedArray(t,i){return new Pv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Pv.ElementType="u16";class aw extends jg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(aw,t,i)}static fromTypedArray(t,i){return new aw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}aw.ElementType="u32";class US extends Hg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(US,t,i)}static fromTypedArray(t,i){return new US(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}US.ElementType="u32";class FR extends qg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(FR,t,i)}static fromTypedArray(t,i){return new FR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}FR.ElementType="u32";class kR extends Wg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(kR,t,i)}static fromTypedArray(t,i){return new kR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kR.ElementType="u32";class zS extends jg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(zS,t,i)}static fromTypedArray(t,i){return new zS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zS.ElementType="i8";class lw extends Hg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(lw,t,i)}static fromTypedArray(t,i){return new lw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}lw.ElementType="i8";class UR extends qg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(UR,t,i)}static fromTypedArray(t,i){return new UR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}UR.ElementType="i8";class zR extends Wg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(zR,t,i)}static fromTypedArray(t,i){return new zR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zR.ElementType="i8";class BR extends jg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(BR,t,i)}static fromTypedArray(t,i){return new BR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}BR.ElementType="i16";class cw extends Hg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(cw,t,i)}static fromTypedArray(t,i){return new cw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}cw.ElementType="i16";class VR extends qg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(VR,t,i)}static fromTypedArray(t,i){return new VR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}VR.ElementType="i16";class GR extends Wg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(GR,t,i)}static fromTypedArray(t,i){return new GR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}GR.ElementType="i16";class jR extends jg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(jR,t,i)}static fromTypedArray(t,i){return new jR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jR.ElementType="i32";class HR extends Hg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(HR,t,i)}static fromTypedArray(t,i){return new HR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}HR.ElementType="i32";class qR extends qg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(qR,t,i)}static fromTypedArray(t,i){return new qR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qR.ElementType="i32";class WR extends Wg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(WR,t,i)}static fromTypedArray(t,i){return new WR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}WR.ElementType="i32";function obe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function EJe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function AJe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function CJe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class vD{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new vD(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const a=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(a)}else{const a=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(a)}}}class pJ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,vd,i),this}vec2f64(t,i){return this._appendField(t,FS,i),this}vec3f(t,i){return this._appendField(t,Cr,i),this}vec3f64(t,i){return this._appendField(t,gn,i),this}vec4f(t,i){return this._appendField(t,So,i),this}vec4f64(t,i){return this._appendField(t,rw,i),this}mat3f(t,i){return this._appendField(t,Bp,i),this}mat3f64(t,i){return this._appendField(t,Mv,i),this}mat4f(t,i){return this._appendField(t,LS,i),this}mat4f64(t,i){return this._appendField(t,Rv,i),this}vec4u8(t,i){return this._appendField(t,lc,i),this}f32(t,i){return this._appendField(t,r4,i),this}f64(t,i){return this._appendField(t,NS,i),this}u8(t,i){return this._appendField(t,Og,i),this}u16(t,i){return this._appendField(t,nw,i),this}i8(t,i){return this._appendField(t,zS,i),this}vec2i8(t,i){return this._appendField(t,lw,i),this}vec2i16(t,i){return this._appendField(t,cw,i),this}vec2u8(t,i){return this._appendField(t,sw,i),this}vec4u16(t,i){return this._appendField(t,Pv,i),this}u32(t,i){return this._appendField(t,aw,i),this}_appendField(t,i,r){const s=i.ElementCount*obe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.indexOf(t)>=0}createBuffer(t){return new vD(this,t)}createView(t){return new vD(this,t)}clone(){const t=new pJ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function on(){return new pJ}function Yv(e,t,i){e.setUniform3f("cameraPosition",i[3]-t[0],i[7]-t[1],i[11]-t[2])}function hh(e,t){e.setUniformMatrix4fv("proj",t)}function abe(e,t,i){yl(sne,i,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",sne)}function I0(e,t){abe(e,t.origin,t.camera.viewMatrix)}function lbe(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const sne=KO();var eH;(function(e){function t(a,l){const p=a[l],y=a[l+1],b=a[l+2];return Math.sqrt(p*p+y*y+b*b)}function i(a,l){const p=a[l],y=a[l+1],b=a[l+2],x=1/Math.sqrt(p*p+y*y+b*b);a[l]*=x,a[l+1]*=x,a[l+2]*=x}function r(a,l,p){a[l]*=p,a[l+1]*=p,a[l+2]*=p}function s(a,l,p,y,b,x=l){(b=b||a)[x]=a[l]+p[y],b[x+1]=a[l+1]+p[y+1],b[x+2]=a[l+2]+p[y+2]}function n(a,l,p,y,b,x=l){(b=b||a)[x]=a[l]-p[y],b[x+1]=a[l+1]-p[y+1],b[x+2]=a[l+2]-p[y+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(eH||(eH={}));const ja=nr();class MJe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function Kt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new MJe(t)}function Kw(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function nne(e,t,i,r){let s,n=(i[0]-e[0])/t[0],a=(r[0]-e[0])/t[0];n>a&&(s=n,n=a,a=s);let l=(i[1]-e[1])/t[1],p=(r[1]-e[1])/t[1];if(l>p&&(s=l,l=p,p=s),n>p||l>a)return!1;l>n&&(n=l),p<a&&(a=p);let y=(i[2]-e[2])/t[2],b=(r[2]-e[2])/t[2];return y>b&&(s=y,y=b,b=s),!(n>b||y>a)&&(b<a&&(a=b),!(a<0))}function k5(e,t,i,r,s,n=St()){const a=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),l=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(a===0)return!1;const p=l/a;return n[0]=e[0]+p*(t[0]-e[0]),n[1]=e[s]+p*(t[s]-e[s]),!0}function one(e,t,i,r,s){s||(s=e),ja[0]=e[0],ja[1]=e[1],ja[2]=e[2],ja[3]=1,ld(ja,ja,t),s.length>2&&(s[2]=-ja[2]),ld(ja,ja,i),Kt(ja[3]!==0),s[0]=ja[0]/ja[3],s[1]=ja[1]/ja[3],s[2]=ja[2]/ja[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function RJe(e,t){return Math.log(e)/Math.log(t)}function cbe(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function hbe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function OJe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function PJe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function IJe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function $Je(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function fJ(e,t,i,r,s){const n=e;e[11]===0?(r[0]=2/(t*n[0]),r[1]=2/(i*n[5]),r[2]=(1+n[12])/n[0],r[3]=(1+n[13])/n[5],ds(s,0,1)):(r[0]=-2/(t*n[0]),r[1]=-2/(i*n[5]),r[2]=(1-n[8])/n[0],r[3]=(1-n[9])/n[5],ds(s,1,0))}class VN{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=Q(),Kt(t.length>=1),Kt(r.length%this._numIndexPerPrimitive==0),Kt(r.length>=t.length*this._numIndexPerPrimitive),Kt(s.size===3||s.size===4);const{data:n,size:a}=s,l=t.length;let p=a*r[this._numIndexPerPrimitive*t[0]];c_.clear(),c_.push(p),this.bbMin=$t(n[p],n[p+1],n[p+2]),this.bbMax=qn(this.bbMin);for(let b=0;b<l;++b){const x=this._numIndexPerPrimitive*t[b];for(let A=0;A<this._numIndexPerPrimitive;++A){p=a*r[x+A],c_.push(p);let M=n[p];this.bbMin[0]=Math.min(M,this.bbMin[0]),this.bbMax[0]=Math.max(M,this.bbMax[0]),M=n[p+1],this.bbMin[1]=Math.min(M,this.bbMin[1]),this.bbMax[1]=Math.max(M,this.bbMax[1]),M=n[p+2],this.bbMin[2]=Math.min(M,this.bbMin[2]),this.bbMax[2]=Math.max(M,this.bbMax[2])}}Wn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let y=this.radius*this.radius;for(let b=0;b<c_.length;++b){p=c_.getItemAt(b);const x=n[p]-this.center[0],A=n[p+1]-this.center[1],M=n[p+2]-this.center[2],P=x*x+A*A+M*M;if(P<=y)continue;const $=Math.sqrt(P),k=.5*($-this.radius);this.radius=this.radius+k,y=this.radius*this.radius;const z=k/$;this.center[0]+=x*z,this.center[1]+=A*z,this.center[2]+=M*z}c_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(wo(this.bbMin,this.bbMax)>1){const t=Wn(Q(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let y=0;y<8;++y)s[y]=0;const{data:n,size:a}=this.position;for(let y=0;y<i;++y){let b=0;const x=this._numIndexPerPrimitive*this.primitiveIndices[y];let A=a*this.indices[x],M=n[A],P=n[A+1],$=n[A+2];for(let k=1;k<this._numIndexPerPrimitive;++k){A=a*this.indices[x+k];const z=n[A],G=n[A+1],B=n[A+2];z<M&&(M=z),G<P&&(P=G),B<$&&($=B)}M<t[0]&&(b|=1),P<t[1]&&(b|=2),$<t[2]&&(b|=4),r[y]=b,++s[b]}let l=0;for(let y=0;y<8;++y)s[y]>0&&++l;if(l<2)return;const p=new Array(8);for(let y=0;y<8;++y)p[y]=s[y]>0?new Uint32Array(s[y]):void 0;for(let y=0;y<8;++y)s[y]=0;for(let y=0;y<i;++y){const b=r[y];p[b][s[b]++]=this.primitiveIndices[y]}this._children=new Array(8);for(let y=0;y<8;++y)p[y]!==void 0&&(this._children[y]=new VN(p[y],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){c_.prune()}}const c_=new Ci({deallocator:null});class s4{constructor(){this.id=ec()}unload(){}}var Vp;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Vp||(Vp={}));function ane(e,t,i){const r=ug(e,t),s=ug(t,i),n=ug(i,e),a=(r+s+n)/2,l=a*(a-r)*(a-s)*(a-n);return l<=0?0:Math.sqrt(l)}function DJe(e,t,i){return We(ik,t,e),We(lne,i,e),yt(si(ik,ik,lne))/2}new Bg(M0);new Bg(()=>({p0:null,p1:null,p2:null}));const ik=Q(),lne=Q();let Sy=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const ube=new Uint16Array([0]),_D=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function BS(e){if(e===1)return ube;if(e<_D.length)return new Uint16Array(_D.buffer,0,e);if(e>Sy.length){const t=Math.max(2*Sy.length,e);Sy=new Uint32Array(t);for(let i=0;i<Sy.length;i++)Sy[i]=i}return new Uint32Array(Sy.buffer,0,e)}function uSt(e){if(e===1)return new Uint16Array(ube);if(e<_D.length)return new Uint16Array(_D.slice(0,e));if(e>Sy.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(Sy.slice(0,e))}function dbe(e,t,i){if(!e)return!1;const{size:r,data:s}=e;ze(i,0,0,0),ze(Vu,0,0,0);let n=0,a=0;for(let l=0;l<t.length-2;l+=3){const p=t[l+0]*r,y=t[l+1]*r,b=t[l+2]*r;ze(fo,s[p+0],s[p+1],s[p+2]),ze(Km,s[y+0],s[y+1],s[y+2]),ze(U5,s[b+0],s[b+1],s[b+2]);const x=DJe(fo,Km,U5);x?(Xe(fo,fo,Km),Xe(fo,fo,U5),Ue(fo,fo,1/3*x),Xe(i,i,fo),n+=x):(Xe(Vu,Vu,fo),Xe(Vu,Vu,Km),Xe(Vu,Vu,U5),a+=3)}return(a!==0||n!==0)&&(n!==0?(Ue(i,i,1/n),!0):a!==0&&(Ue(i,Vu,1/a),!0))}function pbe(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;ze(i,0,0,0);let n=-1,a=0;for(let l=0;l<t.length;l++){const p=t[l]*r;n!==p&&(i[0]+=s[p+0],i[1]+=s[p+1],i[2]+=s[p+2],a++),n=p}return a>1&&Ue(i,i,1/a),a>0}function mJ(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;ze(r,0,0,0),ze(Vu,0,0,0);let a=0,l=0;const p=t?t.length-1:n.length/s-1,y=p+(i?2:0);for(let b=0;b<y;b+=2){const x=b<p?b:p,A=b<p?b+1:0,M=(t?t[x]:x)*s,P=(t?t[A]:A)*s;fo[0]=n[M+0],fo[1]=n[M+1],fo[2]=n[M+2],Km[0]=n[P+0],Km[1]=n[P+1],Km[2]=n[P+2],Ue(fo,Xe(fo,fo,Km),.5);const $=Yq(fo,Km);$>0?(Xe(r,r,Ue(fo,fo,$)),a+=$):(Xe(Vu,Vu,fo),l++)}return a!==0?(Ue(r,r,1/a),!0):l!==0&&(Ue(r,Vu,1/l),!0)}const fo=Q(),Km=Q(),U5=Q(),Vu=Q();class ws extends s4{constructor(t,i=[],r=rc.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=Vp.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,a]of t)a&&this._vertexAttributes.set(n,ie({},a));if(i==null||i.length===0){const n=LJe(this._vertexAttributes),a=BS(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const l of this._vertexAttributes.keys())this._indices.set(l,a)}else for(const[n,a]of i)a&&(this._indices.set(n,NJe(a)),n===Y.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new ws([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return J(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===rc.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(Y.POSITION),r=this.vertexAttributes.get(Y.POSITION);return dbe(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(Y.POSITION),r=this.vertexAttributes.get(Y.POSITION);return pbe(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(Y.POSITION);if(t.length===0)return null;const i=this.primitiveType===rc.Triangle?3:1;Kt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=BS(t.length/i),s=this.vertexAttributes.get(Y.POSITION);return new VN(r,i,t,s)}}function LJe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function NJe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Qw=eH;var rk,sk,nk,tH;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),a=new Uint16Array(36);for(let y=0;y<6;y++)for(let b=0;b<6;b++)a[6*y+b]=y;const l=new Uint16Array(36);for(let y=0;y<6;y++)l[6*y+0]=0,l[6*y+1]=1,l[6*y+2]=2,l[6*y+3]=2,l[6*y+4]=3,l[6*y+5]=0;function p(y){Array.isArray(y)||(y=[y,y,y]);const b=new Array(24);for(let x=0;x<8;x++)b[3*x]=i[x][0]*y[0],b[3*x+1]=i[x][1]*y[1],b[3*x+2]=i[x][2]*y[2];return new ws([[Y.POSITION,{size:3,data:b,exclusive:!0}],[Y.NORMAL,{size:3,data:r}],[Y.UV0,{size:2,data:s}]],[[Y.POSITION,n],[Y.NORMAL,a],[Y.UV0,l]])}e.createGeometry=p})(rk||(rk={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function a(l){Array.isArray(l)||(l=[l,l,l]);const p=new Array(18);for(let y=0;y<6;y++)p[3*y]=i[y][0]*l[0],p[3*y+1]=i[y][1]*l[1],p[3*y+2]=i[y][2]*l[2];return new ws([[Y.POSITION,{size:3,data:p,exclusive:!0}],[Y.NORMAL,{size:3,data:r}]],[[Y.POSITION,s],[Y.NORMAL,n]])}e.createGeometry=a}(sk||(sk={})),function(e){const r=Bi(-.5,0,-.5),s=Bi(.5,0,-.5),n=Bi(0,0,.5),a=Bi(0,0+.5,0),l=fr(),p=fr(),y=fr(),b=fr(),x=fr();We(l,r,a),We(p,r,s),si(y,l,p),ot(y,y),We(l,s,a),We(p,s,n),si(b,l,p),ot(b,b),We(l,n,a),We(p,n,r),si(x,l,p),ot(x,x);const A=[r,s,n,a],M=[0,-1,0,y[0],y[1],y[2],b[0],b[1],b[2],x[0],x[1],x[2]],P=[0,1,2,3,1,0,3,2,1,3,0,2],$=[0,0,0,1,1,1,2,2,2,3,3,3];function k(z){Array.isArray(z)||(z=[z,z,z]);const G=new Array(12);for(let B=0;B<4;B++)G[3*B]=A[B][0]*z[0],G[3*B+1]=A[B][1]*z[1],G[3*B+2]=A[B][2]*z[2];return new ws([[Y.POSITION,{size:3,data:G,exclusive:!0}],[Y.NORMAL,{size:3,data:M}]],[[Y.POSITION,new Uint16Array(P)],[Y.NORMAL,new Uint16Array($)]])}e.createGeometry=k}(nk||(nk={})),function(e){function t(B,W,q,X={uv:!0}){const oe=-Math.PI,de=2*Math.PI,he=-Math.PI/2,fe=Math.PI,me=Math.max(3,Math.floor(W)),ge=Math.max(2,Math.floor(q)),Ce=(me+1)*(ge+1),Ae=new Float32Array(3*Ce),Pe=new Float32Array(3*Ce),De=new Float32Array(2*Ce),ne=[];let pe=0;for(let Ie=0;Ie<=ge;Ie++){const xe=[],$e=Ie/ge,et=he+$e*fe,ct=Math.cos(et);for(let Mt=0;Mt<=me;Mt++){const at=Mt/me,nt=oe+at*de,dt=Math.cos(nt)*ct,xt=Math.sin(et),wr=-Math.sin(nt)*ct;Ae[3*pe]=dt*B,Ae[3*pe+1]=xt*B,Ae[3*pe+2]=wr*B,Pe[3*pe]=dt,Pe[3*pe+1]=xt,Pe[3*pe+2]=wr,De[2*pe]=at,De[2*pe+1]=$e,xe.push(pe),++pe}ne.push(xe)}const ye=new Uint32Array(2*me*(ge-1)*3);pe=0;for(let Ie=0;Ie<ge;Ie++)for(let xe=0;xe<me;xe++){const $e=ne[Ie][xe],et=ne[Ie][xe+1],ct=ne[Ie+1][xe+1],Mt=ne[Ie+1][xe];Ie===0?(ye[pe++]=$e,ye[pe++]=ct,ye[pe++]=Mt):Ie===ge-1?(ye[pe++]=$e,ye[pe++]=et,ye[pe++]=ct):(ye[pe++]=$e,ye[pe++]=et,ye[pe++]=ct,ye[pe++]=ct,ye[pe++]=Mt,ye[pe++]=$e)}const we=[[Y.POSITION,ye],[Y.NORMAL,ye]],Ee=[[Y.POSITION,{size:3,data:Ae,exclusive:!0}],[Y.NORMAL,{size:3,data:Pe,exclusive:!0}]];return X.uv&&(Ee.push([Y.UV0,{size:2,data:De,exclusive:!0}]),we.push([Y.UV0,ye])),X.offset&&(we[0][0]=Y.OFFSET,Ee[0][0]=Y.OFFSET,we.push([Y.POSITION,new Uint32Array(ye.length)]),Ee.push([Y.POSITION,{size:3,data:Float64Array.from(X.offset),exclusive:!0}])),new ws(Ee,we)}function i(B,W,q){const X=B;let oe,de;if(q)oe=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],de=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Ae=X*(1+Math.sqrt(5))/2;oe=[-X,Ae,0,X,Ae,0,-X,-Ae,0,X,-Ae,0,0,-X,Ae,0,X,Ae,0,-X,-Ae,0,X,-Ae,Ae,0,-X,Ae,0,X,-Ae,0,-X,-Ae,0,X],de=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Ae=0;Ae<oe.length;Ae+=3)Qw.scale(oe,Ae,B/Qw.length(oe,Ae));let he={};function fe(Ae,Pe){Ae>Pe&&([Ae,Pe]=[Pe,Ae]);const De=Ae.toString()+"."+Pe.toString();if(he[De])return he[De];let ne=oe.length;return oe.length+=3,Qw.add(oe,3*Ae,oe,3*Pe,oe,ne),Qw.scale(oe,ne,B/Qw.length(oe,ne)),ne/=3,he[De]=ne,ne}for(let Ae=0;Ae<W;Ae++){const Pe=de.length,De=new Uint32Array(4*Pe);for(let ne=0;ne<Pe;ne+=3){const pe=de[ne],ye=de[ne+1],we=de[ne+2],Ee=fe(pe,ye),Ie=fe(ye,we),xe=fe(we,pe),$e=4*ne;De[$e]=pe,De[$e+1]=Ee,De[$e+2]=xe,De[$e+3]=ye,De[$e+4]=Ie,De[$e+5]=Ee,De[$e+6]=we,De[$e+7]=xe,De[$e+8]=Ie,De[$e+9]=Ee,De[$e+10]=Ie,De[$e+11]=xe}de=De,he={}}const me=new Float32Array(oe);for(let Ae=0;Ae<me.length;Ae+=3)Qw.normalize(me,Ae);const ge=[[Y.POSITION,de],[Y.NORMAL,de]],Ce=[[Y.POSITION,{size:3,data:new Float32Array(oe),exclusive:!0}],[Y.NORMAL,{size:3,data:me,exclusive:!0}]];return new ws(Ce,ge)}function r(B,W,q,X,oe,de,he){const fe=W?[W[0],W[1],W[2]]:[0,0,0],me=B?[B[0],B[1],B[2]]:[0,0,1];de=de||[0,0];const ge=q?[255*q[0],255*q[1],255*q[2],q.length>3?255*q[3]:255]:[255,255,255,255],Ce=X!=null&&X.length===2?X:[1,1],Ae=[[Y.POSITION,{size:3,data:fe,exclusive:!0}],[Y.NORMAL,{size:3,data:me,exclusive:!0}],[Y.UV0,{size:de.length,data:de}],[Y.COLOR,{size:4,data:ge,exclusive:!0}],[Y.SIZE,{size:2,data:Ce}]];if(oe!=null){const Pe=new Float32Array([oe[0],oe[1],oe[2],oe[3]]);Ae.push([Y.AUXPOS1,{size:4,data:Pe}])}if(he!=null){const Pe=new Float32Array([he[0],he[1],he[2],he[3]]);Ae.push([Y.AUXPOS2,{size:4,data:Pe}])}return new ws(Ae,null,rc.Point)}function s(B,W,q,X,oe,de,he,fe){if(B!=null){const{data:me}=fe.getMutableAttribute(Y.NORMAL);me[0]=B[0],me[1]=B[1],me[2]=B[2]}if(W!=null){const{data:me}=fe.getMutableAttribute(Y.POSITION);me[0]=W[0],me[1]=W[1],me[2]=W[2]}if(q!=null){const{data:me}=fe.getMutableAttribute(Y.COLOR);me[0]=q[0],me[1]=q[1],me[2]=q[2],me[3]=q[3]}if(X!=null){const{data:me}=fe.getMutableAttribute(Y.SIZE);me[0]=X[0],me[1]=X[1]}if(oe!=null){const{data:me}=fe.getMutableAttribute(Y.AUXPOS1);me[0]=oe[0],me[1]=oe[1],me[2]=oe[2],me[3]=oe[3]}if(de!=null){const{data:me}=fe.getMutableAttribute(Y.UV0);me[0]=de[0],me[1]=de[1]}if(he!=null){const{data:me}=fe.getMutableAttribute(Y.AUXPOS2);me[0]=he[0],me[1]=he[1],me[2]=he[2],me[3]=he[3]}}function n(B,W){const q=new Float32Array(3*B.length),X=new Float32Array(W?3*B.length:3),oe=new Uint32Array(B.length),de=new Uint32Array(B.length);for(let ge=0;ge<B.length;ge++)q[3*ge]=B[ge][0],q[3*ge+1]=B[ge][1],q[3*ge+2]=B[ge][2],W&&(X[3*ge]=W[ge][0],X[3*ge+1]=W[ge][1],X[3*ge+2]=W[ge][2]),oe[ge]=ge,de[ge]=0;W||(X[0]=0,X[1]=1,X[2]=0);const he=[0,0],fe=[[Y.POSITION,oe],[Y.NORMAL,W?oe:de],[Y.UV0,de]],me=[[Y.POSITION,{size:3,data:q,exclusive:!0}],[Y.NORMAL,{size:3,data:X,exclusive:!0}],[Y.UV0,{size:2,data:he,exclusive:!0}]];return new ws(me,fe,rc.Point)}function a(){const B=[0,0,0,0,0,100,100,0,0],W=new Uint16Array([0,1,2]),q=[0,1,0],X=new Uint16Array([0,0,0]),oe=[0,0],de=new Uint16Array([0,0,0]),he=[[Y.POSITION,W],[Y.NORMAL,X],[Y.UV0,de]],fe=[[Y.POSITION,{size:3,data:B,exclusive:!0}],[Y.NORMAL,{size:3,data:q,exclusive:!0}],[Y.UV0,{size:2,data:oe,exclusive:!0}]];return new ws(fe,he)}e.createBoxGeometry=rk.createGeometry,e.createDiamondGeometry=sk.createGeometry,e.createTetrahedronGeometry=nk.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=a;const l=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function p(B=l){const W=new Array(12);for(let ge=0;ge<4;ge++)for(let Ce=0;Ce<3;Ce++)W[3*ge+Ce]=B[ge][Ce];const q=new Uint32Array([0,1,2,2,3,0]),X=[0,0,1],oe=new Uint32Array([0,0,0,0,0,0]),de=[0,0,1,0,1,1,0,1],he=[255,255,255,255],fe=[[Y.POSITION,q],[Y.NORMAL,oe],[Y.UV0,q],[Y.COLOR,oe]],me=[[Y.POSITION,{size:3,data:W,exclusive:!0}],[Y.NORMAL,{size:3,data:X,exclusive:!0}],[Y.UV0,{size:2,data:de,exclusive:!0}],[Y.COLOR,{size:4,data:he,exclusive:!0}]];return new ws(me,fe)}function y(B,W,q,X,oe=!0,de=!0){let he=0;const fe=W,me=B;let ge=Bi(0,he,0),Ce=Bi(0,he+me,0),Ae=Bi(0,-1,0),Pe=Bi(0,1,0);X&&(he=me,Ce=Bi(0,0,0),ge=Bi(0,he,0),Ae=Bi(0,1,0),Pe=Bi(0,-1,0));const De=[Ce,ge],ne=[Ae,Pe],pe=q+2,ye=Math.sqrt(me*me+fe*fe);if(X)for(let at=q-1;at>=0;at--){const nt=at*(2*Math.PI/q),dt=Bi(Math.cos(nt)*fe,he,Math.sin(nt)*fe);De.push(dt);const xt=Bi(me*Math.cos(nt)/ye,-fe/ye,me*Math.sin(nt)/ye);ne.push(xt)}else for(let at=0;at<q;at++){const nt=at*(2*Math.PI/q),dt=Bi(Math.cos(nt)*fe,he,Math.sin(nt)*fe);De.push(dt);const xt=Bi(me*Math.cos(nt)/ye,fe/ye,me*Math.sin(nt)/ye);ne.push(xt)}const we=new Uint32Array(2*(q+2)*3),Ee=new Uint32Array(2*(q+2)*3);let Ie=0,xe=0;if(oe){for(let at=3;at<De.length;at++)we[Ie++]=1,we[Ie++]=at-1,we[Ie++]=at,Ee[xe++]=0,Ee[xe++]=0,Ee[xe++]=0;we[Ie++]=De.length-1,we[Ie++]=2,we[Ie++]=1,Ee[xe++]=0,Ee[xe++]=0,Ee[xe++]=0}if(de){for(let at=3;at<De.length;at++)we[Ie++]=at,we[Ie++]=at-1,we[Ie++]=0,Ee[xe++]=at,Ee[xe++]=at-1,Ee[xe++]=1;we[Ie++]=0,we[Ie++]=2,we[Ie++]=De.length-1,Ee[xe++]=1,Ee[xe++]=2,Ee[xe++]=ne.length-1}const $e=new Float32Array(3*pe);for(let at=0;at<pe;at++)$e[3*at]=De[at][0],$e[3*at+1]=De[at][1],$e[3*at+2]=De[at][2];const et=new Float32Array(3*pe);for(let at=0;at<pe;at++)et[3*at]=ne[at][0],et[3*at+1]=ne[at][1],et[3*at+2]=ne[at][2];const ct=[[Y.POSITION,we],[Y.NORMAL,Ee]],Mt=[[Y.POSITION,{size:3,data:$e,exclusive:!0}],[Y.NORMAL,{size:3,data:et,exclusive:!0}]];return new ws(Mt,ct)}function b(B,W,q,X,oe,de){const he=X?mD(X):Bi(1,0,0),fe=oe?mD(oe):Bi(0,0,0);de=de==null||de;const me=fr();ot(me,he);const ge=fr();Ue(ge,me,Math.abs(B));const Ce=fr();Ue(Ce,ge,-.5),Xe(Ce,Ce,fe);const Ae=Bi(0,1,0);Math.abs(1-rt(me,Ae))<.2&&ze(Ae,0,0,1);const Pe=fr();si(Pe,me,Ae),ot(Pe,Pe),si(Ae,Pe,me);const De=2*q+(de?2:0),ne=q+(de?2:0),pe=new Float32Array(3*De),ye=new Float32Array(3*ne),we=new Float32Array(2*De),Ee=new Uint32Array(3*q*(de?4:2)),Ie=new Uint32Array(3*q*(de?4:2));de&&(pe[3*(De-2)+0]=Ce[0],pe[3*(De-2)+1]=Ce[1],pe[3*(De-2)+2]=Ce[2],we[2*(De-2)]=0,we[2*(De-2)+1]=0,pe[3*(De-1)+0]=pe[3*(De-2)+0]+ge[0],pe[3*(De-1)+1]=pe[3*(De-2)+1]+ge[1],pe[3*(De-1)+2]=pe[3*(De-2)+2]+ge[2],we[2*(De-1)]=1,we[2*(De-1)+1]=1,ye[3*(ne-2)+0]=-me[0],ye[3*(ne-2)+1]=-me[1],ye[3*(ne-2)+2]=-me[2],ye[3*(ne-1)+0]=me[0],ye[3*(ne-1)+1]=me[1],ye[3*(ne-1)+2]=me[2]);const xe=function(nt,dt,xt){Ee[nt]=dt,Ie[nt]=xt};let $e=0;const et=fr(),ct=fr();for(let nt=0;nt<q;nt++){const dt=nt*(2*Math.PI/q);Ue(et,Ae,Math.sin(dt)),Ue(ct,Pe,Math.cos(dt)),Xe(et,et,ct),ye[3*nt+0]=et[0],ye[3*nt+1]=et[1],ye[3*nt+2]=et[2],Ue(et,et,W),Xe(et,et,Ce),pe[3*nt+0]=et[0],pe[3*nt+1]=et[1],pe[3*nt+2]=et[2],we[2*nt+0]=nt/q,we[2*nt+1]=0,pe[3*(nt+q)+0]=pe[3*nt+0]+ge[0],pe[3*(nt+q)+1]=pe[3*nt+1]+ge[1],pe[3*(nt+q)+2]=pe[3*nt+2]+ge[2],we[2*(nt+q)+0]=nt/q,we[2*nt+1]=1;const xt=(nt+1)%q;xe($e++,nt,nt),xe($e++,nt+q,nt),xe($e++,xt,xt),xe($e++,xt,xt),xe($e++,nt+q,nt),xe($e++,xt+q,xt)}if(de){for(let nt=0;nt<q;nt++){const dt=(nt+1)%q;xe($e++,De-2,ne-2),xe($e++,nt,ne-2),xe($e++,dt,ne-2)}for(let nt=0;nt<q;nt++){const dt=(nt+1)%q;xe($e++,nt+q,ne-1),xe($e++,De-1,ne-1),xe($e++,dt+q,ne-1)}}const Mt=[[Y.POSITION,Ee],[Y.NORMAL,Ie],[Y.UV0,Ee]],at=[[Y.POSITION,{size:3,data:pe,exclusive:!0}],[Y.NORMAL,{size:3,data:ye,exclusive:!0}],[Y.UV0,{size:2,data:we,exclusive:!0}]];return new ws(at,Mt)}function x(B,W,q,X,oe){q=q||10,X=X==null||X,Kt(B.length>1);const de=[[0,0,0]],he=[],fe=[];for(let me=0;me<q;me++){he.push([0,-me-1,-(me+1)%q-1]);const ge=me/q*2*Math.PI;fe.push([Math.cos(ge)*W,Math.sin(ge)*W])}return e.createPathExtrusionGeometry(fe,B,de,he,X,oe)}function A(B,W,q,X,oe,de=Bi(0,0,0)){const he=B.length,fe=new Float32Array(W.length*he*3+(6*q.length||0)),me=new Float32Array(W.length*he*3+(q?6:0)),ge=(W.length-1)*he*6+3*X.length*2,Ce=new Uint32Array(ge),Ae=new Uint32Array(ge);let Pe=0,De=0,ne=0,pe=0;const ye=fr(),we=fr(),Ee=fr(),Ie=fr(),xe=fr(),$e=fr(),et=fr(),ct=Q(),Mt=fr(),at=fr(),nt=fr(),dt=fr(),xt=fr(),wr=er();ze(Mt,0,1,0),We(we,W[1],W[0]),ot(we,we),oe?(Xe(ct,W[0],de),ot(Ee,ct)):ze(Ee,0,0,1),G(we,Ee,Mt,Mt,xe,Ee,cne),ke(Ie,Ee),ke(dt,xe);for(let li=0;li<q.length;li++)Ue($e,xe,q[li][0]),Ue(ct,Ee,q[li][2]),Xe($e,$e,ct),Xe($e,$e,W[0]),fe[Pe++]=$e[0],fe[Pe++]=$e[1],fe[Pe++]=$e[2];me[De++]=-we[0],me[De++]=-we[1],me[De++]=-we[2];for(let li=0;li<X.length;li++)Ce[ne++]=X[li][0]>0?X[li][0]:-X[li][0]-1+q.length,Ce[ne++]=X[li][1]>0?X[li][1]:-X[li][1]-1+q.length,Ce[ne++]=X[li][2]>0?X[li][2]:-X[li][2]-1+q.length,Ae[pe++]=0,Ae[pe++]=0,Ae[pe++]=0;let vs=q.length;const ji=q.length-1;for(let li=0;li<W.length;li++){let vl=!1;li>0&&(ke(ye,we),li<W.length-1?(We(we,W[li+1],W[li]),ot(we,we)):vl=!0,Xe(at,ye,we),ot(at,at),Xe(nt,W[li-1],Ie),yS(W[li],at,wr),Ow(wr,iu(nt,ye),ct)?(We(ct,ct,W[li]),ot(Ee,ct),si(xe,at,Ee),ot(xe,xe)):G(at,Ie,dt,Mt,xe,Ee,cne),ke(Ie,Ee),ke(dt,xe)),oe&&(Xe(ct,W[li],de),ot(xt,ct));for(let Jn=0;Jn<he;Jn++)if(Ue($e,xe,B[Jn][0]),Ue(ct,Ee,B[Jn][1]),Xe($e,$e,ct),ot(et,$e),me[De++]=et[0],me[De++]=et[1],me[De++]=et[2],Xe($e,$e,W[li]),fe[Pe++]=$e[0],fe[Pe++]=$e[1],fe[Pe++]=$e[2],!vl){const _l=(Jn+1)%he;Ce[ne++]=vs+Jn,Ce[ne++]=vs+he+Jn,Ce[ne++]=vs+_l,Ce[ne++]=vs+_l,Ce[ne++]=vs+he+Jn,Ce[ne++]=vs+he+_l;for(let Xp=0;Xp<6;Xp++)Ae[pe++]=Ce[ne-6+Xp]-ji}vs+=he}const ae=W[W.length-1];for(let li=0;li<q.length;li++)Ue($e,xe,q[li][0]),Ue(ct,Ee,q[li][1]),Xe($e,$e,ct),Xe($e,$e,ae),fe[Pe++]=$e[0],fe[Pe++]=$e[1],fe[Pe++]=$e[2];const sr=De/3;me[De++]=we[0],me[De++]=we[1],me[De++]=we[2];const Bs=vs-he;for(let li=0;li<X.length;li++)Ce[ne++]=X[li][0]>=0?vs+X[li][0]:-X[li][0]-1+Bs,Ce[ne++]=X[li][2]>=0?vs+X[li][2]:-X[li][2]-1+Bs,Ce[ne++]=X[li][1]>=0?vs+X[li][1]:-X[li][1]-1+Bs,Ae[pe++]=sr,Ae[pe++]=sr,Ae[pe++]=sr;const Hi=[[Y.POSITION,Ce],[Y.NORMAL,Ae]],Os=[[Y.POSITION,{size:3,data:fe,exclusive:!0}],[Y.NORMAL,{size:3,data:me,exclusive:!0}]];return new ws(Os,Hi)}function M(B,W,q){Kt(B.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Kt(B[0].length===3,"createPolylineGeometry(): malformed vertex"),Kt(W==null||W.length===B.length,"createPolylineGeometry: need same number of points and normals"),Kt(W==null||W[0].length===3,"createPolylineGeometry(): malformed normal");const X=new Float64Array(3*B.length),oe=new Uint32Array(2*(B.length-1));let de=0,he=0;for(let ge=0;ge<B.length;ge++){for(let Ce=0;Ce<3;Ce++)X[de++]=B[ge][Ce];ge>0&&(oe[he++]=ge-1,oe[he++]=ge)}const fe=[],me=[];if(fe.push([Y.POSITION,oe]),me.push([Y.POSITION,{size:3,data:X,exclusive:!0}]),W){const ge=new Float32Array(3*W.length);let Ce=0;for(let Ae=0;Ae<B.length;Ae++)for(let Pe=0;Pe<3;Pe++)ge[Ce++]=W[Ae][Pe];fe.push([Y.NORMAL,oe]),me.push([Y.NORMAL,{size:3,data:ge,exclusive:!0}])}return q&&(me.push([Y.COLOR,{size:4,data:q}]),fe.push([Y.COLOR,BS(q.length/4)])),new ws(me,fe,rc.Line)}function P(B,W,q,X,oe=0){const de=new Array(18),he=[[-W,oe,X/2],[q,oe,X/2],[0,B+oe,X/2],[-W,oe,-X/2],[q,oe,-X/2],[0,B+oe,-X/2]],fe=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let me=0;me<6;me++)de[3*me]=he[me][0],de[3*me+1]=he[me][1],de[3*me+2]=he[me][2];return new ws([[Y.POSITION,{size:3,data:de,exclusive:!0}]],[[Y.POSITION,fe]])}function $(B,W){const q=B.getMutableAttribute(Y.POSITION).data;for(let X=0;X<q.length;X+=3){const oe=q[X],de=q[X+1],he=q[X+2];ze(ex,oe,de,he),Ct(ex,ex,W),q[X]=ex[0],q[X+1]=ex[1],q[X+2]=ex[2]}}function k(B,W=B){const q=B.vertexAttributes,X=q.get(Y.POSITION).data,oe=q.get(Y.NORMAL).data;if(oe){const de=W.getMutableAttribute(Y.NORMAL).data;for(let he=0;he<oe.length;he+=3){const fe=oe[he+1];de[he+1]=-oe[he+2],de[he+2]=fe}}if(X){const de=W.getMutableAttribute(Y.POSITION).data;for(let he=0;he<X.length;he+=3){const fe=X[he+1];de[he+1]=-X[he+2],de[he+2]=fe}}return W}function z(B,W,q,X,oe){return!(Math.abs(rt(W,B))>oe)&&(si(q,B,W),ot(q,q),si(X,q,B),ot(X,X),!0)}function G(B,W,q,X,oe,de,he){return z(B,W,oe,de,he)||z(B,q,oe,de,he)||z(B,X,oe,de,he)}e.createSquareGeometry=p,e.createConeGeometry=y,e.createCylinderGeometry=b,e.createTubeGeometry=x,e.createPathExtrusionGeometry=A,e.createPolylineGeometry=M,e.createExtrudedTriangle=P,e.transformInPlace=$,e.cgToGIS=k,e.makeOrthoBasisDirUp=z,e.makeOrthoBasisDirUpFallback=G}(tH||(tH={}));const cne=.99619469809,ex=fr(),$c=tH,FJe=Ge.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class kJe{constructor(){this.type="panoramic",this._techniqueConfig=new yD,this._readyResolver=bg(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._texture=Xt(this._texture),this._vao=Xt(this._vao),this._readyController=Ql(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=zp.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(DS,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=zo(this._vao,"geometry"),yd(nbe,{signal:this._readyController.signal}).then(r=>{this._texture=new Vt(i,{pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Cs(r)||FJe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._texture!=null}render(t){const i=t.rctx,r=i.useTechnique(this._technique);r.bindTexture(this._texture,"tex"),hh(r,t.camera.projectionMatrix),UJe(hne,t.camera.viewMatrix),r.setUniformMatrix4fv("view",hne),r.setUniform4f("uColor",1,1,1,1),t.scenelightingData.setLightDirectionUniform(r),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(mi.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=$c.createPolySphereGeometry(1,2,!1),r=i.indices.get(Y.POSITION);for(let l=0;l<r.length;l+=3){const p=r[l];r[l]=r[l+2],r[l+2]=p}const s=i.vertexAttributes.get(Y.POSITION).data,n=une.createBuffer(r.length),a=n.position;for(let l=0;l<r.length;++l){const p=3*r[l];a.set(l,0,s[p]),a.set(l,1,s[p+1]),a.set(l,2,s[p+2])}return new In(t,mr,{geometry:ch(une)},{geometry:Fi.createVertex(t,tr.STATIC_DRAW,n.buffer)})}}function UJe(e,t){nn(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const hne=lt(),une=on().vec3f(Y.POSITION);var Vh;function zJe(e){const t=new Ir;return t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add("cameraPosition","vec3").add("offset","vec3").add("width","float").add("proj","mat4").add("view","mat4").add("time","float"),t.varyings.add("vUv","vec2"),t.vertex.code.add(V`
    //https://www.shadertoy.com/view/4djSRW
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===Vh.RAIN?V`

            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:V`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add("opacity","float").add("particleColor","vec3"),t.fragment.code.add(V`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===Vh.RAIN?V`d = 0.5 * smoothstep(0.5, 0.0, d);`:V`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}(function(e){e[e.RAIN=0]="RAIN",e[e.SNOW=1]="SNOW"})(Vh||(Vh={}));const BJe=Object.freeze({__proto__:null,get PrecipitationType(){return Vh},build:zJe});class sg extends Xr{initializeProgram(t){const i=sg.shader.get(),r=this.configuration,s=i.build({type:r.type});return new $r(t.rctx,s,sg.attributeLocation)}initializePipeline(){return Ti({blending:ga(ht.ONE,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}}sg.shader=new Ur(BJe,()=>import("./Precipitation.glsl.a7774d92.js")),sg.attributeLocation=new Map([[Y.POSITION,0],[Y.INSTANCEFEATUREATTRIBUTE,1]]);class iH extends Rs{constructor(){super(...arguments),this.type=Vh.RAIN}}_([Oe()],iH.prototype,"type",void 0);class fbe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return L(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let xb=class extends st{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=Q(),this._tile=Q(),this._particleColor=fr(),this._particleColorAtNight=fr(),this._nightMultiplier=.7,this._cameraDirection=fr(),this._renderParameters={camera:null,time:0,radius:1},this._animation=new fbe,this._updatingTracking=new t0,this._renderParameters.time=0,this._renderParameters.radius=ir(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=es(this._snowTechnique),this._rainTechnique=es(this._rainTechnique),this._vao=Xt(this._vao),this._instanceIdBuffer=Xt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(J(this._rainTechnique)){const e=new iH;e.type=Vh.RAIN,this._rainTechnique=this._shaderTechniqueRepository.acquire(sg,e)}return this._rainTechnique}get snowTechnique(){if(J(this._snowTechnique)){const e=new iH;e.type=Vh.SNOW,this._snowTechnique=this._shaderTechniqueRepository.acquire(sg,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const{rctx:r,camera:s}=e;this._ensureResources(r);const n=i===Vh.RAIN?this.rainTechnique:this.snowTechnique;if(J(n)||J(this._vao)||J(this._instanceIdBuffer)||(L(e.cloudsCompositionParams)&&(this._opacity=1-e.cloudsCompositionParams.fadeInOutHeight.factor),this._opacity<=0))return;const a=r.useTechnique(n);this._renderParameters.camera=s,this._renderParameters.time=(i===Vh.RAIN?this._rainSpeed:this._snowSpeed)*mue(this._animation.time),this._update(a,s,i,e),r.bindVAO(this._vao);const l=sg.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),ZY(r,l,this._instanceIdBuffer,dne,0),r.capabilities.instancing.drawArraysInstanced(mi.TRIANGLES,0,3,this._numParticles*t),KY(r,l,this._instanceIdBuffer,dne)}_update(e,t,i,r){const s=t.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",t.viewMatrix),e.setUniform3fv("cameraPosition",s),hh(e,t.projectionMatrix),e.setUniform1f("time",this._renderParameters.time),i===Vh.RAIN?ze(this._particleColor,.85,.85,.85):ze(this._particleColor,1,1,1),Ue(this._particleColorAtNight,this._particleColor,this._nightMultiplier),ot(this._cameraDirection,s);const n=Math.max(0,rt(this._cameraDirection,r.scenelightingData.lightingMainDirection));Wn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){L(this._vao)||(this._vao=this._createVertexArrayObject(e),L(this._instanceIdBuffer)||(this._instanceIdBuffer=this._createInstanceIndices(e)))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return Fi.createVertex(e,tr.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new In(e,sg.attributeLocation,{geometry:ch(VJe)},{geometry:Fi.createVertex(e,tr.STATIC_DRAW,t)})}};_([S({constructOnly:!0})],xb.prototype,"context",void 0),_([S({constructOnly:!0})],xb.prototype,"view",void 0),_([S({readOnly:!0})],xb.prototype,"updating",null),_([S()],xb.prototype,"_updatingTracking",void 0),xb=_([re("esri.views.3d.environment.Precipitation")],xb);const VJe=on().vec3f(Y.POSITION),dne=ch(on().f32(Y.INSTANCEFEATUREATTRIBUTE),1),GJe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",jJe=Ge.getLogger("esri.views.3d.environment.SimpleAtmosphere"),z5=128,pne=-Kj,fne=0,ok=50,HJe=()=>1-511/512,qJe=XI([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class WJe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:St(),silCircleCenter:Q(),silCircleV1:Q(),silCircleV2:Q(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._texture=null,this._fadeVaoCount=0,this._readyResolver=bg(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=S0(t.spatialReference);const i=ir(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+pne)/this.planetRadius,this.middleRimFactor=(this.planetRadius+fne)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=fne/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=_o(this._cameraChangeHandle),this._texture=Xt(this._texture),this._fadeVao=Xt(this._fadeVao),this._vao=Xt(this._vao),this._readyController=Ql(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=Pi(this.view,"state.camera",()=>t.requestRender(),!0),this._vao=this._createRibbon(i),this._vaoCount=zo(this._vao,"geometry"),this._fadeVao=Ga(i),this._fadeVaoCount=zo(this._fadeVao,"geometry");const r=this.isOnMars?GJe:nbe,s=this._readyController.signal;try{const n=await yd(r,{signal:s});Gi(s),this._texture=new Vt(i,{pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Cs(n)||jJe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(J(this._coneTechnique)){const t=new yD;t.geometry=zp.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(DS,t)}return this._coneTechnique}get undergroundTechnique(){if(J(this._undergroundTechnique)){const t=new yD;t.geometry=zp.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(DS,t)}return this._undergroundTechnique}render(t){this._update(t.camera);const i=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const r=i.useTechnique(this.coneTechnique);r.setUniformMatrix4fv("proj",t.camera.projectionMatrix),r.setUniformMatrix4fv("view",t.camera.viewMatrix),r.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),r.setUniform3fv("silCircleV1",this._renderData.silCircleV1),r.setUniform3fv("silCircleV2",this._renderData.silCircleV2),r.setUniform2fv("texV",this._renderData.texV),r.bindTexture(this._texture,"tex"),t.scenelightingData.setLightDirectionUniform(r),r.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.setUniform1f("innerScale",this._renderData.innerScale),i.bindVAO(this._vao),i.drawArrays(mi.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const r=i.useTechnique(this.undergroundTechnique);r.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),t.scenelightingData.setLightDirectionUniform(r),r.setUniform3fv("cameraPosition",t.camera.eye),i.bindVAO(this._fadeVao),i.drawArrays(mi.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=Q(),r=this.planetRadius,s=yt(t.eye),n=s-r;if(n<0){const M=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=M}else this._renderData.undergroundFadeAlpha=0;const a=Math.max(ok,n),l=r+pne;this._renderData.innerScale=XJe(r+a,r,l)-1,this._renderData.altitudeFade=x_e(n),Ue(i,t.eye,(r+ok)/s),mne(i,t.center,t.up,r,this._renderData);const p=this._computeScreenRimWidth(t,i,t.up,this._renderData),y=HJe(),b=qJe(n);let x=this.texV0+y*this.texVScale,A=this.texV0+p*b*this.texVScale;if(n>ok){mne(t.eye,t.center,t.up,r,this._renderData);const M=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),P=Ot((M-1.5)/(p-1.5),0,1);x=this.texV0+P*y*this.texVScale,A=this.texV0+Vi(this.texV1,p*b,P)*this.texVScale}ds(this._renderData.texV,x,A)}_createRibbon(t){const i=new Float32Array(3+3*z5*3),r=new Uint32Array(3*z5*5);i[0]=0,i[1]=0,i[2]=-1;for(let a=0;a<z5;a++){const l=9*a+3;i[l+0]=a,i[l+1]=this.innerRimFactor,i[l+2]=-1,i[l+3]=a,i[l+4]=this.middleRimFactor,i[l+5]=0,i[l+6]=a,i[l+7]=this.outerRimFactor,i[l+8]=1;const p=3*a+1,y=a===z5-1?1:p+3,b=15*a;r[b+0]=p,r[b+1]=p+1,r[b+2]=y+1,r[b+3]=y+1,r[b+4]=y,r[b+5]=p,r[b+6]=p+1,r[b+7]=p+2,r[b+8]=y+2,r[b+9]=y+2,r[b+10]=y+1,r[b+11]=p+1,r[b+12]=p,r[b+13]=y,r[b+14]=0}const s=gne.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const l=3*r[a];n.set(a,0,i[l]),n.set(a,1,i[l+1]),n.set(a,2,i[l+2])}return new In(t,mr,{geometry:ch(gne)},{geometry:Fi.createVertex(t,tr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return Xe(sA,s.silCircleCenter,s.silCircleV2),Ue(lk,sA,this.outerRimFactor),eN(ak,i,sA,r),one(sA,ak,t.projectionMatrix,t.viewport),one(lk,ak,t.projectionMatrix,t.viewport),Er(sA,lk)/t.height}}function mne(e,t,i,r,s){const n=yt(e),a=r*Math.sqrt(n*n-r*r)/n,l=Math.sqrt(r*r-a*a),p=s.silCircleV1,y=s.silCircleV2;return Ue(s.silCircleCenter,e,l/n),si(p,e,t),dl(p)<1&&si(p,e,i),Ue(p,p,a/yt(p)),si(y,p,e),Ue(y,y,a/yt(y)),a}const ak=lt(),sA=Q(),lk=Q();function XJe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const gne=on().vec3f(Y.POSITION);function gJ(e){const t=V`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=V`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function YJe(){const e=new Ir;return e.attributes.add(Y.POSITION,"vec3"),e.attributes.add(Y.COLOR,"vec4"),e.attributes.add(Y.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float"),e.include(gJ),e.vertex.code.add(V`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(V`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}const JJe=Object.freeze({__proto__:null,build:YJe});class GN extends Xr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=GN.shader.get().build();return new $r(t.rctx,i,mr)}initializePipeline(){return Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:Ii})}bindPass(t){const i=this._makeInfiniteProjectionMatrix(t.camera.projectionMatrix,t.camera.near,ZJe);As(i,i,t.camera.viewMatrix),As(i,i,t.modelMatrix),this.program.setUniformMatrix4fv("transform",i),this.program.setUniform4fv("viewport",t.camera.fullViewport),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio)}_makeInfiniteProjectionMatrix(t,i,r){return nn(r,t),r[10]=24e-8-1,r[11]=-1,r[14]=(24e-8-2)*i,r}}GN.shader=new Ur(JJe,()=>import("./Stars.glsl.ddc085dc.js"));const ZJe=lt(),KJe=Ge.getLogger("esri.views.3d.environment.Stars");let hy=class extends st{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter={camera:null,modelMatrix:lt()},this._updatingTracking=new t0}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return L(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ql(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=es(this._technique),this._vao=Xt(this._vao)}render(e){const{rctx:t,camera:i}=e;if(this._ensureResources(t),J(this._technique)||J(this._vao))return;const r=t.useTechnique(this._technique);this._renderParameter.camera=i,this._technique.bindPass(this._renderParameter),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(mi.POINTS,0,this._numPoints)}_ensureResources(e){if(L(this._technique)||J(tx))return;this._technique=new GN({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=tx.byteLength/yne;const t=new Float32Array(tx,0,2*this._numPoints),i=new Uint8Array(tx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>{var r;return(r=this.view)==null?void 0:r.environment.lighting.date},r=>this._update(r),No)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=this._renderParameter.modelMatrix;nn(r,tZe),pS(r,r,-i*Math.PI),As(r,eZe,r),pS(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=vne.createBuffer(r),n=s.position,a=s.color,l=s.size;for(let p=0;p<r;p++){const y=t[2*p+0],b=t[2*p+1];n.set(p,0,-Math.cos(y)*Math.sin(b)),n.set(p,1,-Math.sin(y)*Math.sin(b)),n.set(p,2,-Math.cos(b));const x=this._unpackUint8Attributes(i[p]),A=this._hexToRGB(QJe[x[1]]);a.set(p,0,255*A[0]),a.set(p,1,255*A[1]),a.set(p,2,255*A[2]),a.set(p,3,255),l.set(p,x[0])}return new In(e,mr,{geometry:ch(vne)},{geometry:Fi.createVertex(e,tr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(L(tx))return null;const e=SO(async t=>{const{data:i}=await HPe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),tx=i});return e.promise.catch(t=>{Cs(t)||KJe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new Se("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/yne;if(t%1!=0||t>5e4||t<5e3)throw new Se("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};_([S({constructOnly:!0})],hy.prototype,"view",void 0),_([S({constructOnly:!0})],hy.prototype,"requestRender",void 0),_([S({readOnly:!0})],hy.prototype,"updating",null),_([S()],hy.prototype,"_loadDataTask",void 0),_([S()],hy.prototype,"_updatingTracking",void 0),hy=_([re("esri.views.3d.environment.Stars")],hy);const QJe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],eZe=CX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),tZe=CX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),yne=9,vne=on().vec3f(Y.POSITION).vec4u8(Y.COLOR).f32(Y.SIZE);let tx=null;var HC;const iZe=[tt.POSTPROCESSING_ENVIRONMENT_OPAQUE,tt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let _ne,Qa=HC=class extends st{constructor(e){super(e),this._handles=new Ei,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null,this._precipitationEnabled=_Ve()}initialize(){this.view._stage.addRenderPlugin(iZe,this)}destroy(){var e;this._pendingAtmosphere=Ht(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=Ht(this._handles),this._set("view",null)}get atmosphereType(){return L(this._pendingAtmosphere)?this._pendingAtmosphere.type:L(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!((e=this.view.basemapTerrain)==null||!e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!L(this._precipitation)&&this._precipitation.update(e)}get updating(){return L(this._pendingAtmosphere)||L(this._stars)&&this._stars.updating||L(this._clouds)&&this._clouds.running}get weatherVisible(){return yt(this.view.state.camera.eye)-ir(this.view.spatialReference).radius<=qu}get _stars(){var e,t;const i=this.view,r=(e=(t=i.environment)==null?void 0:t.starsEnabled)!=null&&e,s=this._get("_stars");return!r||J(this._context)?(Ht(s),null):L(s)?s:new hy({view:i,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||J(this._context))return Ht(e),null;const t=this.view,i=this._context;return L(e)&&e.context===i?e:(Ht(e),new xb({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||J(this._context))return Ht(e),null;if(L(e))return e;const t=this.view,i=this._context.renderContext.rctx;return Ht(e),new Ka({rctx:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudComposition(){const e=this._get("_cloudComposition");if(!this.weatherEnabled||J(this._context))return Ht(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=ir(this.view.spatialReference).radius;return L(e)&&e.viewingMode===t&&e.radius===r?e:(Ht(e),new S3({rctx:i,viewingMode:t,radius:r}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||J(this._context))return Ht(e),null;if(L(e))return e;const t=this.view,i=this._context;return Ht(e),new jC({context:i,view:t})}get weatherEnabled(){var e,t;return!((e=this.view)==null||(t=e.environmentManager)==null||!t.weatherEnabled)}get precipitationEnabled(){return this._precipitationEnabled}set precipitationEnabled(e){this._precipitationEnabled=e}initializeRenderContext(e=null){this._context=e,this._handles.add([BX(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0),vi(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Oa),vi(()=>this._stars,()=>this._setNeedsRender()),vi(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),No),vi(()=>this._precipitation,()=>this._setNeedsRender()),vi(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),No),vi(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},Oa)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ht(this._atmosphere),this._set("_stars",Ht(this._stars)),this._set("_precipitation",Ht(this._precipitation)),this._set("_clouds",Ht(this._clouds)),this._set("_cloudComposition",Ht(this._cloudComposition)),this._set("_fog",Ht(this._fog))}render(e){if(e.pass===bt.MATERIAL)switch(e.slot){case tt.POSTPROCESSING_ENVIRONMENT_OPAQUE:L(this._stars)&&this._stars.render(e),L(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),jYe(this._clouds)&&L(this._cloudComposition)&&(this._cloudComposition.render(e,this._clouds,L(this.view.animation)),this._cloudComposition.isFading&&this._setNeedsRender()));break;case tt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(L(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),L(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}this.view.environment.weather.type!=="rainy"&&this.view.environment.weather.type!=="snowy"||!L(this._precipitation)||this._precipitation.render(e,this.view.environment.weather.precipitation,this.view.environment.weather.type==="rainy"?Vh.RAIN:Vh.SNOW)}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return J(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){J(e)||J(this._clouds)||(this._clouds.applyPreset(rbe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){L(this._context)&&this._context.requestRender()}_updateFog(e){if(!J(this._fog)&&!J(e))switch(e.type){case"foggy":this._fog.strength=Vi(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=Vi(4e-6,8e-5,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;L(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return L(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);L(this._context)&&i.initializeRenderContext(this._context),J(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{L(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return Zse;case"panoramic":return kJe;case"simple":return WJe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||E0(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&L(this._context)&&Zse.isSupported(this._context)&&tS(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=L(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{_ne=HC.prototype._getAtmosphereClass,HC.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{HC.prototype._getAtmosphereClass=_ne},precipitationEnabled:e=>{this.precipitationEnabled=e}}}};_([S({constructOnly:!0})],Qa.prototype,"view",void 0),_([S({type:Boolean,readOnly:!0})],Qa.prototype,"updating",null),_([S()],Qa.prototype,"weatherVisible",null),_([S()],Qa.prototype,"_context",void 0),_([S()],Qa.prototype,"_pendingAtmosphere",void 0),_([S({readOnly:!0})],Qa.prototype,"_stars",null),_([S({readOnly:!0})],Qa.prototype,"_precipitation",null),_([S({readOnly:!0})],Qa.prototype,"_clouds",null),_([S({readOnly:!0})],Qa.prototype,"_cloudComposition",null),_([S({readOnly:!0})],Qa.prototype,"_fog",null),_([S()],Qa.prototype,"weatherEnabled",null),_([S()],Qa.prototype,"_precipitationEnabled",void 0),_([S({readOnly:!0})],Qa.prototype,"_weatherUpdateParameters",null),Qa=HC=_([re("esri.views.3d.environment.EnvironmentRenderer")],Qa);function bne(e,t,i){return rZe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function rZe(e,t,i,r,s){const n=xi(i),a=xi(s),l=n-a,p=xi(t)-xi(r),y=Math.sin(l/2),b=Math.sin(p/2),x=2*$p(Math.sqrt(y*y+Math.cos(n)*Math.cos(a)*b*b))*e;return Math.round(1e4*x)/1e4}function sZe(e,t,i){const r=t.spatialReference,s=ir(r),n=new Gt(t.x,e.y,r),a=new Gt(i.x,e.y,r),l=new Gt(e.x,t.y,r),p=new Gt(e.x,i.y,r);return{lon:bne(s.radius,n,a),lat:bne(s.radius,l,p)}}function nZe(e,t,i){const r=t/i,s=xi(e),n=Math.sin(r/2),a=Math.cos(s),l=2*$p(Math.sqrt(n*n/(a*a)));return th(l)}function oZe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function wne(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=oZe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var xne,Tne,Sne,mbe={exports:{}};xne=mbe,Tne=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,a=Math.acos,l=e/180,p=864e5,y=2440588,b=2451545,x={dec:0,ra:0};function A(ne){return ne.valueOf()/p-.5+y}function M(ne){return new Date((ne+.5-y)*p)}function P(ne){return A(ne)-b}var $=23.4397*l;function k(ne,pe){return n(t(ne)*i($)-r(pe)*t($),i(ne))}function z(ne,pe){return s(t(pe)*i($)+i(pe)*t($)*t(ne))}function G(ne,pe,ye){return n(t(ne),i(ne)*t(pe)-r(ye)*i(pe))}function B(ne,pe,ye){return s(t(pe)*t(ye)+i(pe)*i(ye)*i(ne))}function W(ne,pe){return l*(280.16+360.9856235*ne)-pe}function q(ne){return l*(357.5291+.98560028*ne)}function X(ne){return l*(1.9148*t(ne)+.02*t(2*ne)+3e-4*t(3*ne))}function oe(ne,pe){return ne+pe+102.9372*l+e}function de(ne,pe){var ye=q(ne),we=oe(ye,X(ye));return pe||(pe={dec:0,ra:0}),pe.dec=z(we,0),pe.ra=k(we,0),pe}var he={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(ne,pe,ye,we){var Ee=l*-ye,Ie=l*pe,xe=P(ne),$e=de(xe,x),et=W(xe,Ee)-$e.ra;return we||(we={azimuth:0,altitude:0}),we.azimuth=G(et,Ie,$e.dec),we.altitude=B(et,Ie,$e.dec),we}},fe=[[-.83,"sunrise","sunset"]];he.addTime=function(ne,pe,ye){fe.push([ne,pe,ye])};var me=9e-4;function ge(ne,pe){return Math.round(ne-me-pe/(2*e))}function Ce(ne,pe,ye){return me+(ne+pe)/(2*e)+ye}function Ae(ne,pe,ye){return b+ne+.0053*t(pe)-.0069*t(2*ye)}function Pe(ne,pe,ye){return a((t(ne)-t(pe)*t(ye))/(i(pe)*i(ye)))}function De(ne){var pe=l*(134.963+13.064993*ne),ye=l*(93.272+13.22935*ne),we=l*(218.316+13.176396*ne)+6.289*l*t(pe),Ee=5.128*l*t(ye),Ie=385001-20905*i(pe);return{ra:k(we,Ee),dec:z(we,Ee),dist:Ie}}return he.getTimes=function(ne,pe,ye){var we=l*-ye,Ee=l*pe,Ie=ge(P(ne),we),xe=Ce(0,we,Ie),$e=q(xe),et=X($e),ct=oe($e,et),Mt=z(ct,0),at=Ae(xe,$e,ct);function nt(Bs){return Ae(Ce(Pe(Bs,Ee,Mt),we,Ie),$e,ct)}function dt(Bs){var Hi=(t(Bs)-t(Ee)*t(Mt))/(i(Ee)*i(Mt));return Hi<-1?he.PolarException.MIDNIGHT_SUN:Hi>1?he.PolarException.POLAR_NIGHT:he.PolarException.NORMAL}var xt,wr,vs,ji,ae,sr={solarNoon:M(at),nadir:M(at-.5),polarException:he.PolarException.NORMAL};for(xt=0,wr=fe.length;xt<wr;xt+=1)ae=at-((ji=nt((vs=fe[xt])[0]*l))-at),sr[vs[1]]=M(ae),sr[vs[2]]=M(ji);return sr.polarException=dt(fe[0][0]*l),sr},he.getMoonPosition=function(ne,pe,ye){var we=l*-ye,Ee=l*pe,Ie=P(ne),xe=De(Ie),$e=W(Ie,we)-xe.ra,et=B($e,Ee,xe.dec);return et+=.017*l/r(et+10.26*l/(et+5.1*l)),{azimuth:G($e,Ee,xe.dec),altitude:et,distance:xe.dist}},he.getMoonFraction=function(ne){var pe=P(ne),ye=de(pe),we=De(pe),Ee=149598e3,Ie=a(t(ye.dec)*t(we.dec)+i(ye.dec)*i(we.dec)*i(ye.ra-we.ra)),xe=n(Ee*t(Ie),we.dist-Ee*i(Ie));return(1+i(xe))/2},he},(Sne=Tne())!==void 0&&(xne.exports=Sne);const hw=mbe.exports,jf={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function aZe(e,t,i,r,s,n,a){ze(a.ambient.color,1,1,1),a.ambient.intensity=jf.global.ambient,ze(a.direct.color,1,1,1),a.direct.intensity=jf.global.direct;const l=t[2],p=Ot((Math.abs(l)-jf.local.altitude)/(jf.global.altitude-jf.local.altitude),0,1);let y;if(a.globalFactor=p,n==="sun"&&(y=hw.getTimes(e,t[1],t[0])),p<1){let b;if(n==="sun")b=mZe(e,y,r);else{const x=ybe(r);b={direct:{intensity:jf.local.directAtNoon*x.direct,color:$t(1,1,1)},ambient:{intensity:jf.local.ambientAtNoon*x.ambient,color:$t(1,1,1)},timeOfDay:"early afternoon"}}Wn(a.ambient.color,b.ambient.color,a.ambient.color,p),a.ambient.intensity=Vi(b.ambient.intensity,a.ambient.intensity,p),Wn(a.direct.color,b.direct.color,a.direct.color,p),a.direct.intensity=Vi(b.direct.intensity,a.direct.intensity,p),a.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,a.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}a.noonFactor=n==="sun"?fZe(e,y):1,n==="sun"?cZe(e,t,i,a.direct.directionToLightSource):lZe(s,i,a.direct.directionToLightSource)}function lZe(e,t,i){t===vt.Global?ot(V5,e.eye):ze(V5,0,0,1),ah(B5,gZe,e.viewRight),Ct(i,V5,B5),ah(B5,yZe,V5),Ct(i,i,B5)}function cZe(e,t,i,r){const s=pZe,n=p0(dZe);if(i===vt.Global)hw.getPosition(e,0,0,s),ze(r,0,0,-1),dS(n,n,-s.azimuth),KL(n,n,-s.altitude),Ct(r,r,n);else{const a=jf.planarDirection,l=a.globalAngles,p=t[2];let y=(Math.abs(p)-a.localAltitude)/(a.globalAltitude-a.localAltitude);y=Ot(y,0,1),y<1?(hw.getPosition(e,t[1],t[0],s),s.azimuth=(1-y)*s.azimuth+y*l.azimuth,s.altitude=(1-y)*s.altitude+y*l.altitude):(s.azimuth=l.azimuth,s.altitude=l.altitude),ze(r,0,-1,0),pS(n,n,-s.azimuth),dS(n,n,-s.altitude),Ct(r,r,n)}}function hZe(e,t){if(t===vt.Global)return!0;const i=jf.planarDirection;return Math.abs(e)<i.localAltitude}const uZe=$t(.5773502691896258,-.5773502691896258,.5773502691896258);class gbe{constructor(){this.ambient={color:$t(1,1,1),intensity:.55},this.direct={color:$t(1,1,1),intensity:.55,directionToLightSource:qn(uZe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const dZe=lt(),pZe={azimuth:0,altitude:0};function fZe(e,t){const i=e.valueOf();let r,s;t.polarException===hw.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===hw.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-Ot(Math.abs(i-n)/432e5,0,1)}function ybe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Ene(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function mZe(e,t,i){const r=e.valueOf();let s,n;t.polarException===hw.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===hw.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const a=n-s,l=s+a/2,p=a/4,y=l-p,b=l+p,x=.06*a,A=s-x/2,M=s+x/2,P=n-x/2,$=n+x/2,k=jf.local,z=[.01,k.ambientAtNight],G=[.8,.8,1],B=[.01,.01,.01],W=[k.directAtTwilight,k.ambientAtTwilight],q=[1,.6,.5],X=[.8,.8,1],oe=[.9*k.directAtNoon,k.ambientAtNoon],de=[1,.98,.98],he=[.98,.98,1],fe=[k.directAtNoon,k.ambientAtNoon],me=[1,1,1],ge=[1,1,1],Ce=oe,Ae=de,Pe=he,De=W,ne=q,pe=X;let ye,we,Ee=[0,0],Ie=[0,0,0],xe=[0,0,0];r<A||r>$?(Ee=z,Ie=B,xe=G,we="night"):r<M?(ye=M-A,Ee=Xo(r-A,ye,z,W),Ie=Xo(r-A,ye,B,q),xe=Xo(r-A,ye,G,X),we="sun rising"):r<y?(ye=y-M,Ee=Xo(r-M,ye,W,oe),Ie=Xo(r-M,ye,q,de),xe=Xo(r-M,ye,X,he),we="early morning"):r<l?(ye=l-y,Ee=Xo(r-y,ye,oe,fe),Ie=Xo(r-y,ye,de,me),xe=Xo(r-y,ye,he,ge),we="late morning"):r<b?(ye=b-l,Ee=Xo(r-l,ye,fe,Ce),Ie=Xo(r-l,ye,me,Ae),xe=Xo(r-l,ye,ge,Pe),we="early afternoon"):r<P?(ye=P-b,Ee=Xo(r-b,ye,Ce,De),Ie=Xo(r-b,ye,Ae,ne),xe=Xo(r-b,ye,Pe,pe),we="late afternoon"):r<$&&(ye=$-P,Ee=Xo(r-P,ye,De,z),Ie=Xo(r-P,ye,ne,B),xe=Xo(r-P,ye,pe,G),we="sun setting");let $e=0;switch(i){case"rainy":case"foggy":$e=.9;case"snowy":$e=.5}$e>0&&(Ie=Ene(Ie,$e),xe=Ene(xe,$e));const et=$t(Ie[0],Ie[1],Ie[2]),ct=$t(xe[0],xe[1],xe[2]),Mt=ybe(i);return{direct:{intensity:Ee[0]*Mt.direct,color:et},ambient:{intensity:Ee[1]*Mt.ambient,color:ct},timeOfDay:we}}function Xo(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const B5=lt(),V5=Q(),gZe=.35,yZe=-.5;class yJ{constructor(t=Q()){this.intensity=t}}class vbe{constructor(t=Q(),i=$t(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class rH{constructor(t=Q(),i=$t(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class _be{constructor(){this.r=[0],this.g=[0],this.b=[0]}}let Qd=class extends ps.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ei,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new rH,this._ambientLight=new yJ,this._moonLight=new vbe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||(e=this._renderer)!=null&&e.updating)}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((t=this._view)==null||(i=t.state)==null?void 0:i.viewingMode)===vt.Global&&tS(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Qa({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([vi(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Pc),vi(()=>e.environment.lighting.date,s=>this._lightingDateHandler(s),Pc),vi(()=>e.stationary,()=>this._interactingStationaryHandler()),vi(()=>e.environment.lighting.directShadowsEnabled,t,Pc),vi(()=>e.environment.lighting.ambientOcclusionEnabled,t,Pc),vi(()=>e.environment.lighting.waterReflectionEnabled,t,Pc),vi(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Pc),vi(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Pc),vi(()=>e.environment.weather.type,r,Pc),vi(()=>this.weatherEnabled,r,Pc),vi(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Oa),vi(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Oa),vi(()=>e.state.camera,i,Oa),vi(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Ht(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.date),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!J2(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),L(this._referencePosWGS84Comparable)){const r=wne(this._referencePosWGS84Comparable,Ane);L(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=tS(this._view.spatialReference);if(i&&!J2(this._view.spatialReference))return!1;const r=e.position;return J(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=Q()),i?XLe(r,this._referencePosWGS84Comparable):ze(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||t.environment.lighting.date,r=this._referencePosWGS84Comparable,s=L(r)?vZe:_Ze;if(L(r)){const b=this.weatherVisible?t.environment.weather.type:"disabled";aZe(i,r,t.state.viewingMode,b,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,a=s.direct;Ue(n.intensity,a.color,a.intensity*Math.PI),ke(n.direction,a.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const l=this._ambientLight;Ue(l.intensity,s.ambient.color,s.ambient.intensity);const p=this._moonLight;Wn(p.intensity,wZe,xZe,s.globalFactor);const y=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));Ue(p.intensity,p.intensity,y),ke(p.direction,a.directionToLightSource),t._stage.renderView.updateLightSources([n,l,p],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||J(e))return!1;const i=bZe;i.setTime((t||this._view.environment.lighting.date).getTime());const r=wne(e,Ane);if(J(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),a=i.getUTCMinutes()-(r.minutes-s.minutes),l=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(a),i.setUTCSeconds(l),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=kc(this._referencePosWGS84Comparable,!0,s=>hZe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof y_e?{type:"color",color:MX(Ft.toUnitRGBA(i.color))}:{type:"color",color:_r(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,fillLightsEnabled:this._view.environment.lighting.type==="sun",background:r})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=jT(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=jT(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};_([S({type:Boolean,readOnly:!0})],Qd.prototype,"updating",null),_([S()],Qd.prototype,"disableQueries",void 0),_([S()],Qd.prototype,"_disableWeather",void 0),_([S()],Qd.prototype,"weatherEnabled",null),_([S()],Qd.prototype,"weatherVisible",null),_([S()],Qd.prototype,"referencePositionWGS84Comparable",null),_([S()],Qd.prototype,"_renderer",void 0),_([S()],Qd.prototype,"_referencePosWGS84Comparable",void 0),Qd=_([re("esri.views.3d.environment.SceneViewEnvironmentManager")],Qd);const vZe=new gbe,_Ze=new gbe,bZe=new Date,Ane={hours:0,minutes:0,seconds:0},wZe=$t(.22,.22,.33),xZe=$t(.22,.22,.22);function XR(e,t){return(e&t)!=0}function bD(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var Si,ts,xo;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Si||(Si={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(ts||(ts={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(xo||(xo={}));const Iv={selection:ts.NONE,interactionType:Si.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xo.TUMBLE};function bbe(e,t,i,r){return t=t||e.viewForward,ke(r,t),Ue(r,r,Math.sign(rt(t,i))),r}function TZe(e,t,i,r){return MZe(e,t,i,AZe(r,t,i,!0))}function SZe(e,t,i,r){const s=rt(i,We(e,r,t));return Xe(e,t,Ue(e,i,s))}const EZe={dir:Q(),len:0,clip:St()};function AZe(e,t,i,r){const s=EZe;return e?(i&&r&&(s.len=Er(t,i)),ke(s.dir,e)):r?(s.len=Er(t,i),We(s.dir,i,t),Ue(s.dir,s.dir,1/s.len)):(We(s.dir,i,t),ot(s.dir,s.dir)),s}function CZe(e,t,i){const r=rt(e,i.dir),s=-Kr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function MZe(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!CZe(e[s],t,r))return!1;return!0}function RZe(e,t,i=Iv){const r=vJ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,a=bbe(t,i.interactionDirection,IZe(e,t,Math.sign(r),NZe),LZe),l=ke(FZe,t.viewForward),p=s.intersectInfiniteManifold(iu(t.eye,a),n,ck);return t.eye=L(p)?p:s.setAltitude(ck,n,t.eye),t.center=SZe(ck,t.eye,l,t.center),!0}function vJ(e,t,i=Iv){if(!OZe(e,i))return 0;const r=$Ze(e.state.constraints.altitude,DZe);PZe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=Ot(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function OZe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==Si.TUMBLE||!XR(t.selection,ts.TILT))}function PZe(e,t,i){const r=t.interactionType;if(r===Si.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:l}=t,p=r===Si.TUMBLE||r===Si.ZOOM,y=vJ(e,a),b=y===0?0:e.renderCoordsHelper.getAltitude(a.eye);i.min=s,i.max=n,bD(y,b,p,l,.05*b,i)}function IZe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),Ue(r,r,i),r}function $Ze(e,t){return t.min=e.min,t.max=e.max,t}const DZe={min:0,max:0},LZe=Q(),NZe=Q(),FZe=Q(),ck=Q();function _J(e,t,i=Iv){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;G5.min=0,G5.max=r,UZe(e,i,G5);const s=bJ(e,t),n=G5.max-s;return n>=-1e-6?0:n}function kZe(e,t,i=Iv){const r=_J(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=bJ(e,t)+r,a=ke(BZe,t.eye),l=bbe(t,i.interactionDirection,zZe(e,t,jZe),GZe);if(!qv(qme(s.renderLocation,n),iu(t.eye,l),j5))return!1;t.eye=j5;const p=We(VZe,t.eye,a);t.center=Xe(j5,t.center,p);const y=e.renderCoordsHelper.getAltitude(t.center),b=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,y,j5);return L(b)&&(t.center=b),!0}function UZe(e,t,i){const r=t.interactionType;if(r===Si.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:l}=t,p=r===Si.ZOOM||r===Si.PAN,y=_J(e,a),b=y===0?0:bJ(e,a);i.min=s,i.max=n,bD(y,b,p,l,.05*b,i)}function bJ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return Er(t.eye,i.renderLocation)}function zZe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return kg(i,t.eye,r.renderLocation)}const G5={min:0,max:0},BZe=Q(),VZe=Q(),GZe=Q(),jZe=Q(),j5=Q();var Ts,ma;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Ts||(Ts={}));class HZe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=ma.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(ma||(ma={}));function $0(e){return L(e)&&L(e.dist)}function Cne(e){return(t,i,r)=>(Wn(Mne,t,i,r),!NX(e,Mne))}function wbe(e){return $0(e)&&e.intersector===Ts.OBJECT&&!!e.target}function wJ(e){return $0(e)&&e.intersector===Ts.HUD&&!!e.target&&L(e.target.center)}const Mne=Q();class qZe{constructor(){this._transform=lt(),this._transformInverse=new H5({value:this._transform},Ms,lt),this._transformInverseTranspose=new H5(this._transformInverse,oc,lt),this._transformTranspose=new H5({value:this._transform},oc,lt),this._transformInverseRotation=new H5({value:this._transform},tbe,zs)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){nn(this._transform,t)}multiplyTransform(t){As(this._transform,this._transform,t)}set(t){nn(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class H5{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class WZe{constructor(t=0){this.offset=t,this.tmpVertex=Q()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],a=r+this.localOrigin[2],l=this.offset/Math.sqrt(s*s+n*n+a*a);return this.tmpVertex[0]=t+s*l,this.tmpVertex[1]=i+n*l,this.tmpVertex[2]=r+a*l,this.tmpVertex}applyToAabb(t){const i=t[0]+this.localOrigin[0],r=t[1]+this.localOrigin[1],s=t[2]+this.localOrigin[2],n=t[3]+this.localOrigin[0],a=t[4]+this.localOrigin[1],l=t[5]+this.localOrigin[2],p=this.offset/Math.sqrt(i*i+r*r+s*s);t[0]+=i*p,t[1]+=r*p,t[2]+=s*p;const y=this.offset/Math.sqrt(n*n+a*a+l*l);return t[3]+=n*y,t[4]+=a*y,t[5]+=l*y,t}}class XZe{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Q(),this.mbs=nr(),this.obb={center:Q(),halfSize:fr(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,a=r+this.componentLocalOriginLength,l=this.offset/Math.sqrt(s*s+n*n+a*a);return this.tmpVertex[0]=t+s*l,this.tmpVertex[1]=i+n*l,this.tmpVertex[2]=r+a*l,this.tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],a=t[4],l=t[5]+this.componentLocalOriginLength,p=this.offset/Math.sqrt(i*i+r*r+s*s);t[0]+=i*p,t[1]+=r*p,t[2]+=s*p;const y=this.offset/Math.sqrt(n*n+a*a+l*l);return t[3]+=n*y,t[4]+=a*y,t[5]+=l*y,t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.mbs[0]=t[0]+t[0]*r,this.mbs[1]=t[1]+t[1]*r,this.mbs[2]=t[2]+t[2]*r,this.mbs[3]=t[3]+t[3]*this.offset/i,this.mbs}applyToObb(t){const i=t.center,r=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this.obb.center[0]=i[0]+i[0]*r,this.obb.center[1]=i[1]+i[1]*r,this.obb.center[2]=i[2]+i[2]*r,yv(this.obb.halfSize,t.halfSize,t.quaternion),Xe(this.obb.halfSize,this.obb.halfSize,t.center);const s=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*s,this.obb.halfSize[1]+=this.obb.halfSize[1]*s,this.obb.halfSize[2]+=this.obb.halfSize[2]*s,We(this.obb.halfSize,this.obb.halfSize,t.center),i4(Ine,t.quaternion),yv(this.obb.halfSize,this.obb.halfSize,Ine),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}}class YZe{constructor(t=0){this.offset=t,this.sphere=qo(),this.tmpVertex=Q()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],a=s[1]*t+s[5]*i+s[9]*r+s[13],l=s[2]*t+s[6]*i+s[10]*r+s[14];const p=this.offset/Math.sqrt(n*n+a*a+l*l);n+=n*p,a+=a*p,l+=l*p;const y=this.objectTransform.inverse;return this.tmpVertex[0]=y[0]*n+y[4]*a+y[8]*l+y[12],this.tmpVertex[1]=y[1]*n+y[5]*a+y[9]*l+y[13],this.tmpVertex[2]=y[2]*n+y[6]*a+y[10]*l+y[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Rne=new YZe;function sH(e){return L(e)?(Rne.offset=e,Rne):null}const One=new XZe;function dSt(e){return L(e)?(One.offset=e,One):null}const Pne=new WZe;function JZe(e){return L(e)?(Pne.offset=e,Pne):null}const Yb="terrain",Ine=Hv();function wD(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function ZZe(e,t,i,r){for(let s=0;s<r;++s)$ne[0]=e[s],wD($ne,hk,1),t[s]=hk[0],i[s]=hk[1]}const $ne=new Float64Array(1),hk=new Float32Array(2);function nH(e,t){return J(e)&&(e=[]),e.push(t),e}function oH(e,t){if(J(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function n4(e){return!!L(e)&&!e.visible}function KZe(e,t,i){const r=e.origin.vec3;cbe(uk,-r[0],-r[1],-r[2]),L(e.transformation)?As(t,uk,e.transformation):nn(t,uk),i&&(Ms(i,t),oc(i,i))}function QZe(e,t,i,r,s){q5[0]=e.get(t,0),q5[1]=e.get(t,1),q5[2]=e.get(t,2),wD(q5,h_,3),i.set(s,0,h_[0]),r.set(s,0,h_[1]),i.set(s,1,h_[2]),r.set(s,1,h_[3]),i.set(s,2,h_[4]),r.set(s,2,h_[5])}const q5=new Float64Array(3),h_=new Float32Array(6),uk=lt(),VS=1e-5;class eKe{constructor(t){this.options=new HZe,this._results=new tKe,this.transform=new qZe,this.tolerance=VS,this.verticalOffset=null,this._ray=ua(),this._rayEnd=Q(),this._rayBeginTransformed=Q(),this._rayEndTransformed=Q(),this.viewingMode=t==null?vt.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(TNe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&V6(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===vt.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Xe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?VS:r;const a=sH(this.verticalOffset);if(L(t)&&t.length>0){const l=n?p=>{n(p)&&this.intersectObject(p)}:p=>{this.intersectObject(p)};for(const p of t){const y=p.getSpatialQueryAccelerator&&p.getSpatialQueryAccelerator();L(y)?(L(a)?y.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,a):y.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&y.forEachDegenerateObject(l)):p.objects.forAll(b=>l(b))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=sH(this.verticalOffset);for(const n of i){const{geometry:a,material:l,instanceParameters:p}=n;if(n4(p))continue;const y=a.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),Ct(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ct(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const b=this.transform.transform;L(s)&&(s.objectTransform=this.transform),l.intersect(a,p,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(x,A,M,P,$,k)=>{if(x>=0){if(L(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,x))return;if(P){if(this._results.hud.dist==null||x<this._results.hud.dist){const G={object:t,geometryId:y,triangleNr:M,center:k};this._results.hud.set(Ts.HUD,G,x,A,Rn,$)}return}const z=G=>G.set(Ts.OBJECT,{object:t,geometryId:y,triangleNr:M},x,A,b,$);if((this._results.min.drapedLayerOrder==null||$>=this._results.min.drapedLayerOrder)&&(this._results.min.dist==null||x<this._results.min.dist)&&z(this._results.min),this.options.store!==ma.MIN&&(this._results.max.drapedLayerOrder==null||$<this._results.max.drapedLayerOrder)&&(this._results.max.dist==null||x>this._results.max.dist)&&z(this._results.max),this.options.store===ma.ALL){const G=jN(this._ray);G.set(Ts.OBJECT,{object:t,geometryId:y,triangleNr:M},x,A,b),this._results.all.push(G)}}},n.shaderTransformation)}}sortResults(){this._results.all.sort((t,i)=>t.dist!==i.dist?Wt(t.dist,0)-Wt(i.dist,0):t.drapedLayerOrder!==i.drapedLayerOrder?Wt(t.drapedLayerOrder,Number.MAX_VALUE)-Wt(i.drapedLayerOrder,Number.MAX_VALUE):Wt(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-Wt(t.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function _d(e){return new eKe(e)}class tKe{constructor(){this._min=new qC(ua()),this._max=new qC(ua()),this._hud=new qC(ua()),this._ground=new qC(ua())}get min(){return this._min}get max(){return this._max}get hud(){return this._hud}get ground(){return this._ground}init(t){this._min.init(t),this._max.init(t),this._hud.init(t),this._ground.init(t),this.all=[]}}class qC{constructor(t){this.intersector=Ts.OBJECT,this.normal=Q(),this.transformation=lt(),this._ray=ua(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return L(this.dist)?(Ue(W5,this.ray.direction,this.dist),yt(W5)):null}getIntersectionPoint(t){return!!$0(this)&&(Ue(W5,this.ray.direction,this.dist),Xe(t,this.ray.origin,W5),!0)}getTransformedNormal(t){return ke(nA,this.normal),nA[3]=0,ld(nA,nA,this.transformation),ke(t,nA),ot(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ts.OBJECT,V6(t,this._ray)}set(t,i,r,s,n,a,l){this.intersector=t,this.dist=r,ke(this.normal,Wt(s,nde)),nn(this.transformation,Wt(n,Rn)),this.target=i,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=l}copy(t){V6(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ke(this.normal,t.normal),nn(this.transformation,t.transformation)}}function jN(e){return new qC(e)}const W5=Q(),nA=nr();function xbe(e,t,i,r){return L(e.renderCoordsHelper.fromRenderCoords(t.eye,xD,r))&&QW(i,xD)}function HN(e,t){return e.elevationProvider?Wt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function Fw(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),iKe(e,s.ray,u1)||ke(u1,s.center);const n=e.state.constraints,a=n.minimumPoiDistance;if(wo(s.eye,u1)<a){const l=n.collision.enabled;ke(u_,s.viewForward),Ue(u_,u_,a),l?s.eye=We(xD,u1,u_):Xe(u1,s.eye,u_);const p=e.renderCoordsHelper,y=p.getAltitude(s.eye),b=n.collision.elevationMargin;l&&y<b&&(We(u_,u1,s.eye),s.eye=p.setAltitude(xD,b,s.eye),Xe(u1,s.eye,u_))}return s.center=u1,s}function Dne(e,t,i){if(!e.state.isGlobal)return!1;const r=HN(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,sKe),a=n*n;return wo(t,i)>a}function iKe(e,t,i){let r=Lne[e.viewingMode];r||(r=_d(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Lne[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||Dne(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||Dne(e,t.origin,i))||!!s&&rKe(t,i,ir(e.spatialReference).radius)}function rKe(e,t,i){const r=rt(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return Ue(t,e.direction,s/yt(e.direction)),Xe(t,t,e.origin),!0}const Lne={},xD=Q(),u1=Q(),u_=Q(),sKe={near:0,far:0};function AE(e,t,i=ad.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=HN(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),a=s+r.collision.elevationMargin;if(n>=a)return!1;const l=yt(t.eye);if(We(X5,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(nKe,a,t.eye),i===ad.EYE_AND_CENTER)t.center=Xe(X5,t.eye,X5);else if(i===ad.EYE_AND_CENTER_SCALE){const p=(l-n+a)/l;t.center=Ue(X5,t.center,p)}return!0}var ad;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(ad||(ad={}));const X5=Q(),nKe=Q();function $v(e,t,i){e.worldUpAtPosition(t,Nne),We(dk,i,t);const r=yt(dk);return r===0?0:Xn(rt(dk,Nne)/r)}const Nne=Q(),dk=Q();function Tbe(e,t,i=Iv,r=!0){oA.eyeCenterDistance=0,oA.requiresTwoSteps=!1;const s=xJ(e,t,i,void 0,oA);if(s===0)return!1;switch(ah(Y5,-s,t.viewRight),i.tiltMode){case xo.LOOK_AROUND:Ct(d1,t.viewForward,Y5),Ue(d1,d1,oA.eyeCenterDistance),t.center=Xe(Dy,t.eye,d1);break;case xo.TUMBLE:We(d1,t.center,t.eye),Ct(d1,d1,Y5),t.eye=We(Dy,t.center,d1);break;default:i.tiltMode}return t.up=Ct(Dy,t.up,Y5),!oA.requiresTwoSteps||!r||Tbe(e,t,i,!1)}function xJ(e,t,i=Iv,r=Iv,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,a=e.state.constraints.tilt(n,mKe);return fKe(e,i,a),r.interactionType===Si.TUMBLE&&XR(r.selection,ts.ALTITUDE)&&Sbe(e,r.interactionStartCamera,a),i.tiltMode===xo.LOOK_AROUND||r.tiltMode===xo.LOOK_AROUND?aKe(e,t,a,s):oKe(e,t,a)}function oKe(e,t,i){const r=$v(e.renderCoordsHelper,t.center,t.eye),s=r-Ot(r,i.min,i.max);return YR(s)?s:0}function aKe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return cKe(e,t,i,r);case"local":return lKe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function lKe(e,t,i,r){const s=$v(e.renderCoordsHelper,t.center,t.eye),n=Ot(s,i.min,i.max),a=s-n;if(!YR(a))return 0;if(r){const l=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,p=e.renderCoordsHelper.getAltitude(t.eye)-l,y=Math.cos(n);Math.abs(y)>1e-4?r.eyeCenterDistance=p/y:r.eyeCenterDistance=t.distance}return a}function cKe(e,t,i,r){const s=hKe(e,t,gKe),n=Ot(s.tiltAtCenter,i.min,i.max);if(!YR(s.tiltAtCenter-n))return 0;let a,l;return s.centerIsOnSurface?(a=uKe(s),l=dKe(s,a)):(a=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&a<Math.PI/2&&(r.requiresTwoSteps=!0,a=Math.PI/2-1e-5),l=pKe(s,a)),r&&(r.eyeCenterDistance=aH(s,a)),l}function hKe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+ir(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,Dy);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,L(n)?(i.eyeCenterDistance=Er(t.eye,n),i.tiltAtCenter=$v(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=$v(e.renderCoordsHelper,t.center,t.eye):(gE(s,t.ray,Dy),i.eyeCenterDistance=Er(t.eye,Dy),i.tiltAtCenter=Xn(-rt(t.viewForward,ot(Dy,Dy)))),i.radius=s,i.eyeRadius=yt(t.eye),i.constraints=e.state.constraints,i}function YR(e){return Math.abs(e)>1e-9}function uKe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const a=aH(e,n);if(t.clampTilt(a,r)===n)return n;let l=0;for(;l<10&&YR(n-s);){const p=(s+n)/2,y=aH(e,p);YR(t.clampTilt(y,p)-p)?s=p:n=p,l++}return n}function aH(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-Ot(t,0,Math.PI),r=$p(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const a=Math.PI-r,l=Math.PI-i-a;return Math.sin(l)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function dKe(e,t){const i=$p(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=$p(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function pKe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function fKe(e,t,i){if(t.interactionType===Si.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:a}=i,l=xJ(e,r,Iv,t),p=l===0?0:$v(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=a,t.interactionType===Si.TUMBLE?(XR(t.selection,ts.ALTITUDE)&&Sbe(e,r,i),bD(l,p,!0,s,Fne,i)):bD(l,p,!1,s,Fne,i)}function Sbe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=dl(t.center),n=Math.sqrt(s),a=t.distance,l=ir(e.spatialReference).radius,p=r.altitude.min+l,y=r.altitude.max+l,b=(p*p-a*a-s)/(-2*n*a),x=(y*y-a*a-s)/(-2*n*a);i.min=Math.max(i.min,Math.min(Math.PI-Xn(x),i.max)),i.max=Math.min(i.max,Math.PI-Xn(b))}const d1=Q(),Y5=lt(),Dy=Q(),Fne=xi(5),mKe={min:0,max:0},gKe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},oA={eyeCenterDistance:0,requiresTwoSteps:!1};function yKe(e){return e}const qN=e=>e*e,TJ=e=>1-qN(1-e),vKe=e=>e<.5?qN(2*e)/2:(TJ(2*(e-.5))+1)/2,SJ=e=>e*e*e,Ebe=e=>1-SJ(1-e),Abe=e=>e<.5?SJ(2*e)/2:(Ebe(2*(e-.5))+1)/2,EJ=e=>e*e*e*e,Cbe=e=>1-EJ(1-e),_Ke=e=>e<.5?EJ(2*e)/2:(Cbe(2*(e-.5))+1)/2,AJ=e=>e*e*e*e*e,Mbe=e=>1-AJ(1-e),bKe=e=>e<.5?AJ(2*e)/2:(Mbe(2*(e-.5))+1)/2,CJ=e=>1-Math.cos(e*Math.PI/2),Rbe=e=>1-CJ(1-e),wKe=e=>e<.5?CJ(2*e)/2:(Rbe(2*(e-.5))+1)/2,MJ=e=>2**(10*(e-1)),o4=e=>1-MJ(1-e),xKe=e=>e<.5?MJ(2*e)/2:(o4(2*(e-.5))+1)/2,RJ=e=>-(Math.sqrt(1-e*e)-1),Obe=e=>1-RJ(1-e),TKe=e=>e<.5?RJ(2*e)/2:(Obe(2*(e-.5))+1)/2;function xd(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function Td(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const SKe=Td(xd(1),1),EKe=Td(xd(1),0),Pbe=Td(xd(1),.5),AKe=Td(xd(2),1),CKe=Td(xd(2),0),MKe=Td(xd(2),.5),RKe=Td(xd(3),1),OKe=Td(xd(3),0),PKe=Td(xd(3),.5),IKe=Td(xd(4),1),$Ke=Td(xd(4),0),DKe=Td(xd(4),.5),LKe={linear:yKe,"in-quad":qN,"out-quad":TJ,"in-out-quad":vKe,"in-coast-quad":SKe,"out-coast-quad":EKe,"in-out-coast-quad":Pbe,"in-cubic":SJ,"out-cubic":Ebe,"in-out-cubic":Abe,"in-coast-cubic":AKe,"out-coast-cubic":CKe,"in-out-coast-cubic":MKe,"in-quart":EJ,"out-quart":Cbe,"in-out-quart":_Ke,"in-coast-quart":RKe,"out-coast-quart":OKe,"in-out-coast-quart":PKe,"in-quint":AJ,"out-quint":Mbe,"in-out-quint":bKe,"in-coast-quint":IKe,"out-coast-quint":$Ke,"in-out-coast-quint":DKe,"in-sine":CJ,"out-sine":Rbe,"in-out-sine":wKe,"in-expo":MJ,"out-expo":o4,"in-out-expo":xKe,"in-circ":RJ,"out-circ":Obe,"in-out-circ":TKe};function sn(e,t,i=UKe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let l=0;l<zKe;l++){let p=0;for(const y of kKe)if(XR(i.selection,y.type)){const b=Math.abs(y.error(e,r,i));y.apply(e,r,i)&&(s=!0,p+=b)}if(p===0)break}const n=XR(i.selection,ts.COLLISION),a=NKe(i.interactionType,e);return n&&AE(e,r,a)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function NKe(e,t){switch(e){case Si.PAN:return ad.EYE_AND_CENTER;case Si.ASCEND:return t.state.isGlobal?ad.EYE_AND_CENTER_SCALE:ad.EYE_AND_CENTER;default:return ad.EYE}}function dp(e,t){const i=typeof e=="number"?e:ug(e,t),r=Math.min(1,i/150);return Abe(r)}function FKe(e,t,i){return xJ(e,t,i)*t.distance}const kKe=[{type:ts.TILT,error:FKe,apply:Tbe},{type:ts.ALTITUDE,error:vJ,apply:RZe},{type:ts.DISTANCE,error:_J,apply:kZe}],UKe={selection:ts.ALL,interactionType:Si.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xo.TUMBLE},zKe=5,dh=Q(),pc=Q(),p1=Q(),_a=Q(),d_=Q(),BKe=Q(),ph={upward:$t(0,0,1),forward:$t(0,1,0),sideway:$t(1,0,0)},kne=zs();class Une{constructor(t=vt.Global){this.viewingMode=t,this.center=Q(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=qn(ph.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===vt.Global){const n=(yt(this.center)+yt(t.center))/2;i.pan=DF(this.center,t.center)*n}else i.pan=Er(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===vt.Global?$9e(t.center,i.center,r.pan,this.center):Wn(this.center,t.center,i.center,r.pan),this.distance=Vi(t.distance,i.distance,r.zoom),this.pitch=Vi(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Vi(s,n,r.rotate)}copyFrom(t){ke(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ke(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,kne);ke(this.center,t.center),We(_a,t.center,t.eye),Gc(_a,_a,i),Gc(d_,t.up,i),this.distance=yt(_a),_a[0]/=this.distance,_a[1]/=this.distance,_a[2]/=this.distance,this.pitch=this._eyeUpToPitch(_a),this.yaw=this._eyeUpToYaw(_a,d_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,kne);gd(i,i),this._axisAngleVec3(ph.sideway,this.pitch-Math.PI/2,ph.forward,_a),this._axisAngleVec3(ph.upward,this.yaw,_a),this._axisAngleVec3(ph.sideway,this.pitch-Math.PI/2,ph.upward,d_),this._axisAngleVec3(ph.upward,this.yaw,d_),Ue(_a,_a,this.distance),Gc(_a,_a,i),Gc(d_,d_,i),t.center=this.center,t.eye=We(_a,this.center,_a),t.up=d_}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),a=Math.sin(i);return Ue(dh,r,n),si(pc,t,r),Ue(pc,pc,a),Ue(p1,t,(1-n)*rt(t,r)),Xe(s,Xe(s,dh,pc),p1)}_lookAtOrientation(t,i=zs()){return this._upAtLookAt(t,p1),si(dh,this.lookAtDirection,p1),ot(dh,dh),dh[0]===0&&dh[1]===0&&dh[2]===0&&ke(dh,ph.sideway),si(pc,p1,dh),ot(pc,pc),i[0]=dh[0],i[1]=pc[0],i[2]=p1[0],i[3]=dh[1],i[4]=pc[1],i[5]=p1[1],i[6]=dh[2],i[7]=pc[2],i[8]=p1[2],i}_upAtLookAt(t,i){return this.viewingMode===vt.Local?ke(i,ph.upward):ot(i,t)}_eyeUpToPitch(t){return Math.PI-DF(ph.upward,t)}_eyeUpToYaw(t,i){const r=BKe;return Math.abs(i[2])<.5?(ke(r,i),t[2]>0&&Ue(r,r,-1)):ke(r,t),si(pc,r,ph.upward),ot(pc,pc),DF(ph.sideway,pc,ph.upward)}}function OJ(e){return e?{ray:ua(e.ray),c0:e.c0,c1:e.c1}:{ray:ua(),c0:0,c1:Number.MAX_VALUE}}function VKe(e,t=OJ()){return V6(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function GKe(e,t,i=OJ()){const r=yt(e.vector);return Hme(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function pSt(e,t){return Ibe(e,e.c0,t)}function fSt(e,t){return Ibe(e,e.c1,t)}function Ibe(e,t,i){return Xe(i,e.ray.origin,Ue(i,e.ray.direction,t))}new Bg(()=>({c0:0,c1:0,ray:null}));function JR(e){return e?[er(e[0]),er(e[1]),er(e[2]),er(e[3]),er(e[4]),er(e[5])]:[er(),er(),er(),er(),er(),er()]}function $be(){return[Q(),Q(),Q(),Q(),Q(),Q(),Q(),Q()]}function TD(e,t){for(let i=0;i<Pg.NUM;i++)nN(e[i],t[i])}function Dbe(e,t,i,r=YKe){const s=As(zO.get(),t,e);Ms(s,s);for(let n=0;n<lH.NUM;++n){const a=ld(RX.get(),XKe[n],s);ze(r[n],a[0]/a[3],a[1]/a[3],a[2]/a[3])}Lbe(i,r)}function Lbe(e,t){Pa(t[zt.FAR_BOTTOM_LEFT],t[zt.NEAR_BOTTOM_LEFT],t[zt.NEAR_TOP_LEFT],e[Qr.LEFT]),Pa(t[zt.NEAR_BOTTOM_RIGHT],t[zt.FAR_BOTTOM_RIGHT],t[zt.FAR_TOP_RIGHT],e[Qr.RIGHT]),Pa(t[zt.FAR_BOTTOM_LEFT],t[zt.FAR_BOTTOM_RIGHT],t[zt.NEAR_BOTTOM_RIGHT],e[Qr.BOTTOM]),Pa(t[zt.NEAR_TOP_LEFT],t[zt.NEAR_TOP_RIGHT],t[zt.FAR_TOP_RIGHT],e[Qr.TOP]),Pa(t[zt.NEAR_BOTTOM_LEFT],t[zt.NEAR_BOTTOM_RIGHT],t[zt.NEAR_TOP_RIGHT],e[Qr.NEAR]),Pa(t[zt.FAR_BOTTOM_RIGHT],t[zt.FAR_BOTTOM_LEFT],t[zt.FAR_TOP_LEFT],e[Qr.FAR])}function ev(e,t){for(let i=0;i<Pg.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function jKe(e,t){return Fbe(e,VKe(t,kbe.get()))}function mSt(e,t){for(let i=0;i<Pg.NUM;i++){const r=e[i];if(!qNe(r,t))return!1}return!0}function HKe(e,t,i){return Fbe(e,GKe(t,i,kbe.get()))}function Nbe(e,t){for(let i=0;i<Pg.NUM;i++)if(Kr(e[i],t)>0)return!1;return!0}function qKe(e,t){for(let i=0;i<Pg.NUM;i++)if(jNe(e[i],t))return!1;return!0}function Fbe(e,t){for(let i=0;i<Pg.NUM;i++)if(!HNe(e[i],t))return!1;return!0}var Qr,zt;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(Qr||(Qr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(zt||(zt={}));const WKe={bottom:[zt.FAR_BOTTOM_RIGHT,zt.NEAR_BOTTOM_RIGHT,zt.NEAR_BOTTOM_LEFT,zt.FAR_BOTTOM_LEFT],near:[zt.NEAR_BOTTOM_LEFT,zt.NEAR_BOTTOM_RIGHT,zt.NEAR_TOP_RIGHT,zt.NEAR_TOP_LEFT],far:[zt.FAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_LEFT,zt.FAR_TOP_LEFT,zt.FAR_TOP_RIGHT],right:[zt.NEAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_RIGHT,zt.FAR_TOP_RIGHT,zt.NEAR_TOP_RIGHT],left:[zt.FAR_BOTTOM_LEFT,zt.NEAR_BOTTOM_LEFT,zt.NEAR_TOP_LEFT,zt.FAR_TOP_LEFT],top:[zt.FAR_TOP_LEFT,zt.NEAR_TOP_LEFT,zt.NEAR_TOP_RIGHT,zt.FAR_TOP_RIGHT]};var Pg,lH;(function(e){e[e.NUM=6]="NUM"})(Pg||(Pg={})),function(e){e[e.NUM=8]="NUM"}(lH||(lH={}));const XKe=[_r(-1,-1,-1,1),_r(1,-1,-1,1),_r(1,1,-1,1),_r(-1,1,-1,1),_r(-1,-1,1,1),_r(1,-1,1,1),_r(1,1,1,1),_r(-1,1,1,1)],kbe=new Bg(OJ),YKe=$be(),JKe=Ge.getLogger("esri.views.3d.webgl-engine.lib.Camera");class br{constructor(t=null,i=null,r=null){this._viewUp=Q(),this._viewForward=Q(),this._viewRight=Q(),this._ray=ua(),this._viewport=_r(0,0,1,1),this._padding=_r(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=yr(1,1e3),this._viewDirty=!0,this._viewMatrix=lt(),this._projectionDirty=!0,this._projectionMatrix=lt(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=lt(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=lt(),this._frustumDirty=!0,this._frustum=JR(),this._fullViewport=nr(),this.pixelRatio=1,this.relativeElevation=0,L(t)&&ke(this._ray.origin,t),this._center=L(i)?qn(i):Q(),this._up=L(r)?qn(r):$t(0,0,1)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return We(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){nn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[di.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[di.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[di.RIGHT]+this._padding[di.LEFT]}set fullWidth(t){this.width=t-(this._padding[di.RIGHT]+this._padding[di.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[di.TOP]+this._padding[di.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[di.TOP]+this._padding[di.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[di.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[di.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[di.TOP]===t[di.TOP]&&this._padding[di.RIGHT]===t[di.RIGHT]&&this._padding[di.BOTTOM]===t[di.BOTTOM]&&this._padding[di.LEFT]===t[di.LEFT]||(this._viewport[0]+=t[di.LEFT]-this._padding[di.LEFT],this._viewport[1]+=t[di.BOTTOM]-this._padding[di.BOTTOM],this._viewport[2]-=t[di.RIGHT]+t[di.LEFT]-(this._padding[di.RIGHT]+this._padding[di.LEFT]),this._viewport[3]-=t[di.TOP]+t[di.BOTTOM]-(this._padding[di.TOP]+this._padding[di.BOTTOM]),Yl(this._padding,t),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(As(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;nme(this._projectionMatrix,-s*(1+2*this._padding[di.LEFT]/t),s*(1+2*this._padding[di.RIGHT]/t),-r*(1+2*this._padding[di.BOTTOM]/i),r*(1+2*this._padding[di.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(t){nn(this._projectionMatrix,t),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return IJe(this._fov,this.width,this.height)}set fovX(t){this._fov=OJe(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return $Je(this._fov,this.width,this.height)}set fovY(t){this._fov=PJe(t,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Er(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ms(this._viewInverseTransposeMatrix,this.viewMatrix),oc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ke(this._ray.origin,t.eye),ke(this._center,t.center),ke(this._up,t.up),Yl(this._viewport,t.viewport),Yl(this._padding,t.padding),Pn(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(nn(this._viewMatrix,t.viewMatrix),ke(this._viewRight,t.viewRight),ke(this._viewUp,t.viewUp),ke(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(nn(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(TD(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(nn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Yl(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new br().copyFrom(this)}equals(t){return jc(this.eye,t.eye)&&jc(this._center,t.center)&&jc(this._up,t.up)&&F2(this._viewport,t.viewport)&&F2(this._padding,t.padding)&&b_e(this._nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this.pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;a0(ba,t.eye,t.center),a0(pk,this.eye,this._center);const s=rt(ba,pk),n=Oz(ba),a=Oz(pk);return s*s>=r*n*a&&Jq(t.eye,this.eye)<Math.max(n,a)*i*i&&n6(t.padding,this._padding)<.5&&n6(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(wM(this.viewForward,We(ba,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Ns()){return t[0]=(this.padding[di.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[di.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[di.LEFT]+this.width*i,t[1]=this.padding[di.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i,r=!1){t!==Ki&&ke(Ki,t),Ki[3]=1,r&&(i[2]=-Ki[2]),ld(Ki,Ki,this.projectionMatrix),Ue(Ki,Ki,1/Math.abs(Ki[3]));const s=this.fullViewport;return i[0]=Vi(0,s[0]+s[2],.5+.5*Ki[0]),i[1]=Vi(0,s[1]+s[3],.5+.5*Ki[1]),r||(i[2]=.5*(Ki[2]+1)),i}projectToScreen(t,i){this.projectToRenderScreen(t,fk),this.renderToScreen(fk,i)}projectToRenderScreen(t,i){if(Ki[0]=t[0],Ki[1]=t[1],Ki[2]=t[2],Ki[3]=1,ld(Ki,Ki,this.viewProjectionMatrix),Ki[3]===0)return null;Ue(Ki,Ki,1/Math.abs(Ki[3]));const r=this.fullViewport;return"x"in i?(i.x=Vi(0,r[0]+r[2],.5+.5*Ki[0]),i.y=Vi(0,r[1]+r[3],.5+.5*Ki[1])):(i[0]=Vi(0,r[0]+r[2],.5+.5*Ki[0]),i[1]=Vi(0,r[1]+r[3],.5+.5*Ki[1]),i.length>2&&(i[2]=.5*(Ki[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,fk),i)}unprojectFromRenderScreen(t,i){if(As(J5,this.projectionMatrix,this.viewMatrix),!Ms(J5,J5))return null;const r=this.fullViewport;return Ki[0]=2*(t[0]-r[0])/r[2]-1,Ki[1]=2*(t[1]-r[1])/r[3]-1,Ki[2]=2*t[2]-1,Ki[3]=1,ld(Ki,Ki,J5),Ki[3]===0?null:(i[0]=Ki[0]/Ki[3],i[1]=Ki[1]/Ki[3],i[2]=Ki[2]/Ki[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this.pixelRatio,a=i*this.pixelRatio,l=Math.max(n-r/2,0),p=Math.max(this.fullHeight-a-s/2,0),y=-Math.min(n-r/2,0),b=-Math.min(this.fullHeight-a-s/2,0);return[l,p,r-y- -Math.min(this.fullWidth-n-r/2,0),s-b- -Math.min(a-s/2,0)]}computeUp(t){t===vt.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this.pixelRatio,s=this.fullHeight-t[1]*this.pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this.pixelRatio,s=(this.fullHeight-t[1])/this.pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){We(ba,this.center,this.eye);const t=yt(this.center);t<1?(ze(this._up,0,0,1),this._markViewDirty()):Math.abs(rt(ba,this.center))>.9999*yt(ba)*t||(si(this._up,ba,this.center),si(this._up,this._up,ba),ot(this._up,this._up),this._markViewDirty())}_computeUpLocal(){kg(ba,this.eye,this.center),Math.abs(ba[2])<=.9999&&(Ue(ba,ba,ba[2]),ze(this._up,-ba[0],-ba[1],1-ba[2]),ot(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?jc(t,i)||(ke(i,t),this._markViewDirty()):JKe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Dbe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(eN(this._viewMatrix,this.eye,this._center,this._up),ze(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ze(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ze(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Ki=nr(),J5=lt(),ba=Q(),pk=Q(),fk=ca();var di;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(di||(di={}));const SD={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class PJ{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:SD.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new PJ(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:SD.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class ZKe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let a=0;a<this.segments.length;a++){const l=this.segments[a],p=l.definition;if(t<=l.time||a===this.segments.length-1){i=this.segmentInterpolateComponentsAt(l,t/l.time,i),n.hasPan?i.pan=(r+p.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+p.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const y=i.zoom*(p.compared.targetZoom-p.compared.sourceZoom)+p.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,x=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(y-b)/(x-b):i.zoom=1,i}t-=l.time,r+=p.compared.pan,s+=p.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class mk{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let a=0,l=0;r&&(s&&(a=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(l=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const p=this.definition.desiredPixelFlow;if(r&&s&&n){const y=a+l+a*l;this._zoomPixelFlow=a*l/y*p,this._panPixelFlow=l/y*p,this._rotatePixelFlow=a/y*p}else if(r&&s){const y=1+a;this._zoomPixelFlow=a/y*p,this._panPixelFlow=1/y*p}else if(r&&n){const y=1+l;this._zoomPixelFlow=l/y*p,this._rotatePixelFlow=1/y*p}else if(s&&n){const y=this._panPixelsAtSource/this._rotatePixels,b=1+y;this._panPixelFlow=y/b*p,this._rotatePixelFlow=1/b*p}else s?this._panPixelFlow=p:r?this._zoomPixelFlow=p:n&&(this._rotatePixelFlow=p);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function KKe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function QKe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,a=1/Math.LN2,l=t-e.compared.sourceZoom,p=1/l,y=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(l))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*a*p*y-e.halfWindowSize*s*n*a*p+e.halfWindowSize*s*n*a*y/(l*l)}function eQe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,a=Math.log(e.compared.sourceZoom*n),l=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*l+2*s*a+2*n-2*a*l/(r*r)-l/(t*t))/(e.desiredPixelFlow*Math.LN2)}function tQe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function iQe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function rQe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function sQe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function nQe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function oQe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function aQe(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function lQe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,a=-t+e.compared.targetZoom,l=1/a,p=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*l+e.halfWindowSize*r*s*n*p/(a*a)+e.halfWindowSize*s*n*l*p/t}function cQe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,a=Math.log(t/e.compared.targetZoom),l=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*l-2*s*a+2*n+2*a*l/(r*r)-l/(t*t))/(e.desiredPixelFlow*Math.LN2)}function hQe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function uQe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function dQe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function pQe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function fQe(e,t){let i=mQe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,a=s?tQe:KKe,l=s?iQe:QKe,p=s?rQe:eQe,y=n?hQe:aQe,b=n?uQe:lQe,x=n?dQe:cQe,A=W=>a(e,W,r)+sQe(e,W,r)+y(e,W,r),M=W=>l(e,W,r)+nQe(e,W,r)+b(e,W,r),P=W=>p(e,W,r)+oQe(e,W,r)+x(e,W,r);let $=A(i);const k=pQe(e);let z;const G=t.maximumIterations||20,B=t.maximumDistance!=null?t.maximumDistance:1/0;for(z=0;z<G;z++){const q=(M(i)+1e-6)/P(i);if(isNaN(q)||i>=B&&q<0){if(!isFinite(B))return null;i=B,$=A(i);break}if(i-=q,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const X=A(i);if(Math.abs(X-$)/$<=.005)break;$=X}return $>k*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function mQe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class gQe extends ZKe{constructor(t,i){super(),this._preallocSegments=[new mk,new mk,new mk],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=fQe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=TJ(r.zoom):t===this._descensionSegment&&(r.zoom=qN(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,a=i.ascensionFactor!=null?i.ascensionFactor:.5,l=Math.min(1-a,i.ascensionFactor!=null?i.descensionFactor:.5),p=1-a-l;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.update(),this._ascensionSegment=r,this.segments.push(r),p>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*p,s.definition.compared.rotate=this.definition.compared.rotate*p,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const yQe={zoom:0,pan:0,rotate:0};class vQe{constructor(t){this.createCamera=t,this._time=0,this.definition=new PJ(t),this.path=new gQe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(fue(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?Pbe:o4}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,yQe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:SD.minDuration/r,n=i.maxDuration!=null?i.maxDuration:SD.maxDuration/r;return Math.min(Math.max(s,t),n)}}const _Qe=Q();class bQe{constructor(t){this.currentTime=0,this._animation=new vQe(()=>new Une(t)),this._current=new Une(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,a=We(_Qe,i.center,t.center),l=yt(a);l>=1e-5?(a[0]/=l,a[1]/=l,a[2]/=l):(a[0]=0,a[1]=1,a[0]=0),ke(s.lookAtDirection,a),ke(n.lookAtDirection,a),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new br,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+fue(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var xs;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(xs||(xs={}));let p2=class extends st{constructor(){super(...arguments),this.state=xs.Ready}get active(){return this.state===xs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=xs.Stopped,!0)}finishController(){this.state=xs.Finished}get steppingFinished(){return!1}};_([S({readOnly:!0})],p2.prototype,"active",null),_([S()],p2.prototype,"state",void 0),p2=_([re("esri.views.3d.state.controllers.CameraController")],p2);let ZR=class extends p2{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(rr()),this._asyncResult=null),this.state===xs.Finished||this.state===xs.Stopped?this.state===xs.Finished?e.resolve():e.reject(rr()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=xs.Running,L(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!L(this.viewAnimation)||this.state!==xs.Ready&&this.state!==xs.Running||(this.viewAnimation.state===CS.State.FINISHED?this.finish():this.viewAnimation.state===CS.State.STOPPED&&(this.state=xs.Stopped))}onControllerEnd(){L(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===xs.Finished?this.viewAnimation.finish():this.state===xs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===xs.Finished?this._asyncResult.resolve():this._asyncResult.reject(rr()))}finish(){this.finishController()}};ZR=_([re("esri.views.3d.state.controllers.AnimationController")],ZR);let ng=class extends ZR{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new bQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new CS}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);Z5.copyFrom(this.view.state.camera);const r=_d(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Z5.ray,r,zne)&&(Z5.center=zne),this.animation.update(Z5,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return qe(ie({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?LKe[e.easing]:e.easing})}};_([S({constructOnly:!0})],ng.prototype,"view",void 0),_([S({constructOnly:!0})],ng.prototype,"mode",void 0),ng=_([re("esri.views.3d.state.controllers.PointToPointAnimationController")],ng);const Z5=new br,zne=Q();function Ube(e,t,i){return wQe(e,e.screenToRender(t,Tt.get()),i)}function wQe(e,t,i){const r=Pn(Tt.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=Pn(Tt.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Tt.get());return J(n)?null:(We(i.direction,n,i.origin),i)}function CE(e,t,i){return IJ(e,e.screenToRender(t,Tt.get()),i)}function IJ(e,t,i){ke(i.origin,e.eye);const r=ze(Tt.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,Tt.get());return J(s)?null:(We(i.direction,s,i.origin),i)}function $J(e,t,i,r){const s=CE(t,i,xQe);return qv(e,s,r)}const xQe=ua(),zbe=30,ED=[1,3e8],Bbe=70;function P2(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function cH(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Dv(e,t,i){const r=ah(zO.get(),i[3],i);We(Tr,e.eye,t),Ct(Tr,Tr,r),e.eye=Xe(Tr,Tr,t),We(Tr,e.center,t),Ct(Tr,Tr,r),e.center=Xe(Tr,Tr,t),e.up=Ct(Tr,e.up,r)}function TQe(e,t,i,r){return Ow(e,Ube(t,i,NJ),r)}function hH(e,t,i,r){return Ow(e,CE(t,i,NJ),r)}function DJ(e,t,i,r){const s=Tt.get();let n=1-i;We(s,t,e.eye);const a=yt(s);let l=a*(1-n);n>=0&&l<r&&(l=r,n=-(l-a)/a),Math.abs(a-l)<1e-6||(Ue(s,s,n),e.eye=Xe(Tr,e.eye,s),e.center=Wn(Tr,e.center,t,n))}function Vbe(e,t,i){t.getScreenCenter(Bne),$J(e,t,Bne,Tr)&&(t.center=Tr);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=Ue(Tt.get(),t.viewForward,s);t.eye=We(Tr,t.center,n)}const Bne=Ns();function gk(e,t){ze(t,0,0,0);for(const i of e)Xe(t,t,i);Ue(t,t,1/e.length)}function t$(e,t,i,r){return Math.sin(e/yt(t))*(i+r.radius)}function Vne(e,t,i,r){return t$(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Uo;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Uo||(Uo={}));const Gne={Elevation:3e4,Angle:xi(6)},$M={Pole:.95,Angle:xi(18),Tilt:45},Gbe=xi(80);function jbe(e,t,i,r,s){const n=Q(),a=qo();let l=!0,p=!0;return e.intersectScreen(i,n)?a[3]=yt(n):(p=!1,t.aboveGround?a[3]=Math.max(yt(t.center),.9*s.radius):a[3]=yt(t.eye)-t.relativeElevation,r?KR(a,t,i,n):l=$J(a,t,i,n)),{sphere:a,scenePickPoint:l?n:null,hasGeometryIntersection:p}}function WN(e,t,i,r){return yt(e.eye)-r.radius>Gne.Elevation?Uo.Horizontal:i?(CE(e,t,Zne),-Math.sign(e.relativeElevation)*(.5*Math.PI+PX(e.eye,Zne.direction))<Gne.Angle?Uo.Vertical:Uo.Horizontal):Uo.Vertical}function Hbe(e,t,i){We(yk,i,t),e.eye=We(Tr,e.eye,yk),e.center=We(Tr,e.center,yk)}const yk=Q();function KR(e,t,i,r){const s=CE(t,i,NJ);return!J(s)&&(gE(e,s,K5),qv(e,s,r)?!(wo(K5,s.origin)<wo(r,s.origin))||(ke(r,K5),!1):(We(ix,t.eye,t.center),ot(ix,ix),ege(ix,-rt(ot(ix,ix),K5),jne),Ow(jne,s,r),!1))}const K5=Q(),ix=Q(),jne=er();function qbe(e,t,i,r,s,n){let a;if(si(MD,e,t),We(iP,e,t),yt(e)<=s||!r.aboveGround){si(i,iP,r.eye);const l=rt(e,t)/(yt(e)*yt(t)),p=Math.cos(Ot(_v.normalize(xi(n)),0,Gbe));a=-Xn(l)-Math.max(0,yt(t)-s)/(p*s)}else We(Hne,r.eye,r.center),si(i,iP,Hne),a=-yt(iP)/s;return ot(i,i),Ue(i,i,yt(MD)),a}const Hne=Q();function qne(e,t,i,r){let s,n;const a=Math.cos(Ot(_v.normalize(xi(r)),0,Gbe));return s=t>i?-(t-i)/(a*i):t<-i?Math.PI-(t+i)/(a*i):Xn(t/i),n=e>i?-(e-i)/(a*i):e<-i?Math.PI-(e+i)/(a*i):Xn(e/i),(n-s)*i}function SQe(e,t,i,r,s,n,a,l,p,y){const b=qne(e[2],t[2],a[3],p),x=y?qne(e[0],t[0],a[3],180):t[0]-e[0],A=Math.sin(l)*x-Math.cos(l)*b,M=Math.cos(l)*x+Math.sin(l)*b;ot(Tr,s);const P=y?A/Math.sqrt(Math.abs(a[3]**2-rt(i,Tr)**2)):A/a[3],$=M/Math.sqrt(Math.abs(a[3]**2-rt(i,r)**2));ds(n,P,$)}function Wbe(e,t,i,r,s,n,a,l,p,y){si(MD,e,t),BV(n.up,n.eye,Q5,eP,tP),BV([0,0,1],n.eye,pg,dv,Zbe),ke(i,dv),ke(r,pg),ot(i,i),Ue(i,i,yt(MD)),kte(e,ot(eP,eP),ot(tP,tP),ot(Q5,Q5),Wne),kte(t,eP,tP,Q5,Xne),SQe(Wne,Xne,e,pg,dv,s,a,l,p,y)}function EQe(e,t,i,r,s,n,a){ah(AD,s,r),ah(CD,a,n),As(iT,AD,CD),We(t,e,i),Ct(t,t,iT),Xe(t,t,i)}function Xbe(e,t,i,r,s,n){ah(AD,r,i),ah(CD,n,s),As(iT,AD,CD),We(Tr,e.eye,t),Ct(Tr,Tr,iT),e.eye=Xe(Tr,Tr,t),We(Tr,e.center,t),Ct(Tr,Tr,iT),e.center=Xe(Tr,Tr,t),We(Tr,e.up,t),Ct(Tr,Tr,iT),e.up=Xe(Tr,Tr,t)}function LJ(e,t,i,r,s,n,a=$M.Pole,l=$M.Angle){const p=Math.abs(r)>Math.PI-l||Math.abs(r)<l,y=Math.abs(e[2])<i*a||Math.abs(t)>i;return!!(p&&y&&n.aboveGround&&s<$M.Tilt)}function Ybe(e,t,i,r,s,n){if(n)DR(i,r,Yne),Dv(t,e,Yne);else{const a=qbe(i,r,Jne,t,e[3],s);Dv(t,e,$R(Jne,a))}}function Jbe(e,t,i,r,s,n,a){const l=a?20:1,p=1e-12;let y,b;ke(p_,r),rP.copyFrom(t);for(let x=0;x<l&&wo(i,p_)>p&&(y=wo(i,p_),Wbe(i,p_,dv,pg,aA,rP,e,s,n,a),Xbe(rP,e,pg,aA[1],dv,aA[0]),EQe(p_,p_,e,pg,aA[1],dv,aA[0]),b=wo(i,p_),b<y||x===0);x++)t.copyFrom(rP)}function AQe(e,t,i,r,s,n,a){LJ(i,rt(t.up,i),e[3],-_v.normalize(xi(s)),n,t,$M.Pole,$M.Angle)?Jbe(e,t,i,r,-_v.normalize(xi(s)),n,a):Ybe(e,t,i,r,n,a)}function CQe(e,t,i,r,s,n){const{eye:a}=e;BV([0,0,1],a,pg,dv,Zbe);const l=t.translation[0]*i.pan,p=s.mode==="zoom"?0:t.translation[1]*i.pan,y=Math.max(Math.sqrt(Math.abs(1-rt(e.center,pg)**2/yt(e.center)**2)),.5),b=(Math.sin(n)*p+Math.cos(n)*l)/y,x=-Math.cos(n)*p+Math.sin(n)*l;switch(qc(r.pan.matrix,r.pan.matrix,b,pg),r.pan.enabled=!0,s.mode){case"pan":qc(r.pan.matrix,r.pan.matrix,x,dv),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function MQe(e,t,i,r,s){const{eye:n,viewRight:a}=e,l=si(Tt.get(),a,n),p=t.translation[0]*i.pan;switch(p!==0&&(qc(r.pan.matrix,r.pan.matrix,-p,l),r.pan.enabled=!0),s.mode){case"pan":{const y=t.translation[1]*i.pan;y!==0&&(qc(r.pan.matrix,r.pan.matrix,y,a),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function RQe(e,t,i,r,s,n,a,l,p){LJ(e.center,rt(e.up,e.center),yt(e.center),-_v.normalize(xi(n)),a,t)?CQe(t,i,r,l,p,-_v.normalize(xi(s))):MQe(t,i,r,l,p)}const pg=Q(),dv=Q(),Zbe=Q(),Q5=Q(),eP=Q(),tP=Q(),Wne=Q(),Xne=Q(),aA=St(),Yne=EE(),AD=lt(),CD=lt(),iT=lt(),p_=Q(),Tr=Q(),iP=Q(),rP=new br,MD=Q(),Jne=Q(),NJ={origin:Q(),direction:Q()},Zne={origin:Q(),direction:Q()},Kne=.6,vk=4,OQe=12,PQe=60,IQe=20;let RD=class extends ng{constructor(){super(...arguments),this.zoomLocation=Q(),this.tmpCamera=new br,this.tmpViewDir=Q(),this.tmpRayDir={origin:Q(),direction:Q()},this.targetOnSphere=Q(),this.tmpCenter=Q(),this.constraintOptions={selection:ts.ALL_EXCEPT_COLLISION,interactionType:Si.ZOOM,interactionFactor:null,interactionStartCamera:new br,interactionDirection:null,tiltMode:xo.TUMBLE},this.sphere=qo()}initialize(){this.intersector=_d(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation)&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ke(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:o4}}_updateCamera(e,t,i,r,s){const n=ir(this.view.spatialReference);if(WN(e,r,s,n)===Uo.Horizontal){let a=Kne**t;this.sphere[3]=yt(i),We(this.tmpViewDir,e.center,e.eye);const l=yt(this.tmpViewDir);let p=l*a;if(a<=1&&p<vk&&(p=vk,a=p/l),Math.abs(l-p)<1e-6)return;const y=yt(e.center);if(this.sphere[3]!==y){const b=this.sphere[3]+a*(y-this.sphere[3]);e.center=Ue(sP,e.center,b/y)}Ue(this.tmpViewDir,this.tmpViewDir,-a),e.eye=Xe(sP,e.center,this.tmpViewDir),sn(this.view,e,this.constraintOptions),wo(i,e.center)>1e-12&&$J(this.sphere,e,r,this.targetOnSphere)&&AQe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let a=Kne**Math.abs(t);const l=t>0?1:-1;let p;CE(e,r,this.tmpRayDir),ot(this.tmpRayDir.direction,this.tmpRayDir.direction),this.view.camera.position.hasZ&&(p=Math.abs(this.view.camera.position.z));let y=Math.max(OQe*p,IQe);const b=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,PQe);y=y>b?b:y,Ue(this.tmpRayDir.direction,this.tmpRayDir.direction,y),Xe(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let x=y*a;const A=Math.max(vk,1.01*e.nearFar[0]);if(t>0&&x<A&&(x=A,a=x/y),Math.abs(y-x)<1e-6)return;Ue(this.tmpRayDir.direction,this.tmpRayDir.direction,l*(1-a)),e.eye=Xe(sP,e.eye,this.tmpRayDir.direction),e.center=Xe(sP,e.center,this.tmpRayDir.direction)}AE(this.view,e)}};RD=_([re("esri.views.3d.state.controllers.global.ZoomStepController")],RD);const sP=Q(),$Qe=.6,DQe=4,LQe=60,NQe=14,FQe=20;let OD=class extends ng{constructor(){super(...arguments),this.zoomLocation=Q(),this.tmpCamera=new br,this.tmpRayDir=Q(),this.tmpCenter=Q(),this.constraintOptions={selection:ts.ALL,interactionType:Si.ZOOM,interactionFactor:null,interactionStartCamera:new br,interactionDirection:null,tiltMode:xo.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=_d(this.view.state.viewingMode);e>0?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ke(this.zoomLocation,this.tmpCamera.center);const n=$Qe**e;let a=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,LQe);const l=Math.max(NQe*Math.abs(this.view.camera.position.z),FQe);if(a=a?Math.min(a,l):l,a){const p=Q();We(p,this.zoomLocation,this.tmpCamera.eye),a<yt(p)&&(ot(p,p),Xe(this.zoomLocation,this.tmpCamera.eye,Ue(p,p,a)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:o4}}_updateCamera(e,t,i){We(this.tmpRayDir,i,e.eye);const r=yt(this.tmpRayDir);let s=r*t;const n=t<=1,a=Math.max(DQe,1.01*e.nearFar[0]);n&&s<a&&(s=a,t=s/r),Math.abs(r-s)<1e-6||(Ue(this.tmpRayDir,this.tmpRayDir,t),e.eye=We(Qne,i,this.tmpRayDir),e.center=Wn(Qne,e.center,i,1-t),sn(this.view,e,this.constraintOptions))}};OD=_([re("esri.views.3d.state.controllers.local.ZoomStepController")],OD);const Qne=Q();function kQe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function FJ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class UQe extends ya{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(kQe(i,"primary")){const r=this.view.state.isGlobal?new RD({view:this.view,mode:"animation"}):new OD({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Ns(i.x,i.y)),t.stopPropagation()}}}let Lv=class extends p2{constructor(){super(...arguments),this.startCamera=new br,this.currentCamera=new br}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=xs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};Lv=_([re("esri.views.3d.state.controllers.InteractiveController")],Lv);var Dc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Dc||(Dc={}));const zQe=7,_k=90;let rT=class extends Lv{constructor(e){super(e),this.view=null,this.pivot=Dc.CENTER,this.lastPoint=St(),this.tmpWorldUp=Q(),this.tmpViewDir=Q(),this.tmpRotCurPoint=St(),this.tmpTransf=lt(),this.tmpAxis=Q(),this.tmpPivotPoint=Q(),this.pivotPos=Q(),this.constraintOptions={selection:ts.ALL,interactionType:Si.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Dc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Dc.EYE:ke(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=Si.LOOK_AROUND,this.constraintOptions.tiltMode=xo.LOOK_AROUND,this.constraintOptions.selection=ts.NONE;break;case Dc.CENTER:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||ke(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=Si.TUMBLE,this.constraintOptions.tiltMode=xo.TUMBLE,this.constraintOptions.selection=ts.ALL&~ts.DISTANCE}this.constraintOptions.interactionStartCamera=this.startCamera,P2(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e){const t=this.startCamera,i=Q();We(i,this.pivotPos,t.eye);let r=yt(i);this.view.camera.position.hasZ&&(r=Math.min(r,zQe*Math.abs(this.view.camera.position.z)));const s=ir(this.view.spatialReference),n=Ns(t.width/t.pixelRatio*.5,t.height/t.pixelRatio*.5),a=WN(this.startCamera,n,!0,s);let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t.fullWidth/t.pixelRatio*.5,t.fullHeight/t.pixelRatio*.5,t,2.5*_k,_k),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],t,_k);l===void 0&&p===void 0||(l=l===void 0?p:l,p=p===void 0||a===Uo.Horizontal?l:p,r=l>p?p:l),ot(i,i),ke(this.pivotPos,Xe(this.tmpPivotPoint,t.eye,Ue(this.tmpPivotPoint,i,r)))}update(e){if(this.active){switch(this.pivot){case Dc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Dc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}sn(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),P2(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;We(this.tmpViewDir,i,r);const a=yt(this.tmpViewDir),l=Xn(rt(this.tmpViewDir,this.tmpWorldUp)/a);if(this.pivot===Dc.EYE){s*=-.5;const p=.5*Math.PI-l,y=.5*Math.PI*.99;s=p-Math.max(-y,Math.min(y,p+s))}return s=Ot(s+l,oa.min,oa.max)-l,si(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Dc.CENTER&&(n=-n),ah(this.tmpTransf,n,this.tmpWorldUp),qc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),Ct(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Ct(bk,e.up,this.tmpTransf),Xe(bk,r,this.tmpViewDir),Pn(this.lastPoint,this.tmpRotCurPoint),bk}};_([S({constructOnly:!0})],rT.prototype,"view",void 0),_([S()],rT.prototype,"pivot",void 0),rT=_([re("esri.views.3d.state.controllers.RotateController")],rT);const bk=Q();class wk extends ya{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!FJ(t.data,this.pointerAction))return;const r=Ns(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new rT({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let i$=class extends Lv{constructor(e){super(e),this.view=null,this.pickPoint=Q(),this.tmpP0=St(),this.panAxisAngle=EE(),this.tmpRayDir=Q(),this.targetOnSphere=Q(),this.tmpRay={origin:Q(),direction:Q()},this.dragBeginPoint=Ns(),this.normalizedAnchorPoint=St(),this.constraintOptions={selection:ts.ALL_EXCEPT_COLLISION,interactionType:Si.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xo.TUMBLE},this.sphere=qo(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Pn(this.dragBeginPoint,e),P2(this.startCamera,e,this.normalizedAnchorPoint);const t=ir(this.view.spatialReference),i=jbe(this.intersectionHelper,this.startCamera,e,!1,t);if(this.navMode=WN(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===Uo.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r;CE(this.startCamera,e,this.tmpRay),ot(this.tmpRay.direction,this.tmpRay.direction),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=Ot(zbe*r,ED[0],ED[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Bbe);s=s>n?n:s,this.hasPickPoint=!0,Ue(this.tmpRay.direction,this.tmpRay.direction,s),Xe(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Uo.Horizontal){We(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=yt(this.tmpRayDir);P2(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/yt(this.currentCamera.center));this.currentCamera.center=Ue(nP,this.currentCamera.center,n)}Ue(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=Xe(nP,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=dp(this.dragBeginPoint,e),sn(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(KR(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),DR(this.pickPoint,this.targetOnSphere,this.panAxisAngle),Dv(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=yt(this.tmpRay.direction);P2(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;Ue(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=Xe(nP,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=Xe(nP,this.currentCamera.center,this.tmpRayDir)}AE(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};_([S({constructOnly:!0})],i$.prototype,"view",void 0),i$=_([re("esri.views.3d.state.controllers.global.ZoomController")],i$);const nP=Q();let r$=class extends Lv{constructor(e){super(e),this.view=null,this.tmpP=Q(),this.tmpDir=Q(),this.tmpN=Q(),this.tmpP0=St(),this.tmpPoi=Q(),this.tmpRayDir=Q(),this.dragBeginPoint=Ns(),this.normalizedAnchorPoint=St(),this.constraintOptions={selection:ts.ALL,interactionType:Si.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:Q(),tiltMode:xo.TUMBLE},this.plane=er()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;let t;Pn(this.dragBeginPoint,e),P2(this.startCamera,e,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP),We(this.tmpDir,this.tmpP,this.startCamera.eye),ot(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let i=Ot(zbe*t,ED[0],ED[1]);const r=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],this.view.state.camera,Bbe);i=i>r?r:i,Ue(this.tmpDir,this.tmpDir,i),Xe(this.tmpP,this.startCamera.eye,this.tmpDir),We(this.tmpN,this.startCamera.eye,this.startCamera.center),ot(this.tmpN,this.tmpN),this.tmpN[1]<0&&Na(this.tmpN,this.tmpN),yS(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;TQe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ke(this.tmpPoi,this.currentCamera.center),P2(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Pn(this.normalizedAnchorPoint,this.tmpP0),We(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=yt(this.tmpRayDir);let r=i*(1-t);ke(this.constraintOptions.interactionDirection,this.tmpRayDir),Ue(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(Ue(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=Xe(f_,this.currentCamera.eye,this.tmpRayDir),Wn(f_,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?f_[2]=Math.max(this.startCamera.center[2],f_[2]):f_[2]=Math.min(this.startCamera.center[2],f_[2]),this.currentCamera.center=f_,this.constraintOptions.interactionFactor=dp(this.dragBeginPoint,e),sn(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};_([S({constructOnly:!0})],r$.prototype,"view",void 0),r$=_([re("esri.views.3d.state.controllers.local.ZoomController")],r$);const f_=Q();class BQe extends ya{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!FJ(t.data,this.pointerAction))return;const r=Ns(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new i$({view:this.view}):this.cameraController=new r$({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const VQe=Q(),oP=Q();function kJ(){return{direction:Q(),up:Q()}}function Kbe(e,t,i,r,s){let n=ot(VQe,e),a=rt(n,r);const l=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(rt(t,r)),a<.99?(ke(n,t),l&&Ue(n,n,-1)):n=null);let p=0;if(n){Ue(oP,r,rt(r,n)),We(n,n,oP);const b=rt(n,s)/(yt(n)*yt(s));si(oP,n,s),p=(rt(oP,r)>0?1:-1)*th(Xn(b))}const y=th(Xn(-rt(r,e)/yt(e)));return i?(i.heading=p,i.tilt=y,i):{heading:p,tilt:y}}const Qbe=$t(0,1,0),e2e=$t(0,0,1),lA=lt(),j0=Q(),H0=Q();function t2e(e,t,i,r=kJ()){const{direction:s,up:n}=r;return rme(lA,-xi(t)),dS(lA,lA,xi(i)),Ct(s,e2e,lA),Ue(s,s,-1),Ct(n,Qbe,lA),r}function GQe(e,t,i,r){return Kbe(t,i,r,e2e,Qbe)}function jQe(e,t,i,r){const s=t2e(e,i,r),n=Q();return Ue(n,s.direction,-t),Xe(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function HQe(e){return th(e)}function qQe(e){return xi(e)}function i2e(e,t,i,r,s){const n=e.renderSpatialReference,a=e.map&&e.spatialReference||t.spatialReference;return To(t,j0,n),To(t,H0,n),j0[0]-=i/2,H0[0]+=i/2,j0[1]-=r/2,H0[1]+=r/2,Ho(j0,n,j0,a),Ho(H0,n,H0,a),s?(s.xmin=j0[0],s.ymin=j0[1],s.xmax=H0[0],s.ymax=H0[1],s.spatialReference=a):s=new ki(j0[0],j0[1],H0[0],H0[1],a),s}const WQe=Object.freeze({__proto__:null,headingTiltToDirectionUp:t2e,directionToHeadingTilt:GQe,eyeForCenterWithHeadingTilt:jQe,lookAtTiltToEyeTilt:HQe,eyeTiltToLookAtTilt:qQe,toExtent:i2e}),r2e=$t(0,0,1),s2e=ot(Q(),$t(1,1,1)),XQe=new vv(-180,180),cA=lt(),Ey=Q(),rx=Q();function n2e(e,t,i,r=kJ()){si(Ey,e,r2e),rt(Ey,Ey)===0&&si(Ey,e,s2e),ah(cA,-xi(t),e),qc(cA,cA,-xi(i),Ey);const{up:s,direction:n}=r;return si(s,Ey,e),ot(s,s),Ct(s,s,cA),ot(n,e),Na(n,n),Ct(n,n,cA),r}function YQe(e,t,i,r){const s=Ey,n=rx;return ot(s,e),si(rx,s,r2e),rt(rx,rx)===0&&si(rx,s,s2e),si(n,rx,s),Kbe(t,i,r,s,n)}function JQe(e,t,i,r){const s={eye:Q(),up:null,tilt:r,heading:i},n=Ey;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const a=t,l=xi(i),p=xi(r),y=Math.sin(l),b=Math.cos(l),x=Math.sin(p),A=Math.cos(p),M=yt(n);let P;if(Math.abs(p)<1e-8)P=a+M;else{const De=M/x,ne=$p(a/De),pe=Math.PI-p-ne;P=De*Math.sin(pe)}const $=A*a,k=a*a*(x*x),z=b*b*k,G=P-$,B=G*G,W=z*(z+B-n[1]*n[1]);if(W<0)return Ue(s.eye,n,P/M),s.tilt=0,s;const q=Math.sqrt(W),X=n[1]*G,oe=z+B;let de;if(de=b>0?-q+X:q+X,Math.abs(oe)<1e-8)return M<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=a):Ue(s.eye,n,P/M),s.tilt=0,xk(s.eye),Tk(s,e);s.eye[1]=de/oe;const he=y*y*k,fe=x*a,me=b*fe*s.eye[1],ge=s.eye[1]*s.eye[1],Ce=1-ge,Ae=Math.sqrt(Ce),Pe=z*ge+he-2*me*Ae*G+Ce*B;return Math.abs(Pe)<1e-8?(Ue(s.eye,n,P/M),s.tilt=0,xk(s.eye),Tk(s,e)):(s.eye[0]=(Ce*(P*n[0]-$*n[0])-fe*Ae*(n[0]*s.eye[1]*b+n[2]*y))/Pe,s.eye[2]=(Ce*(P*n[2]-$*n[2])-fe*Ae*(n[2]*s.eye[1]*b-n[0]*y))/Pe,Ue(s.eye,s.eye,P),xk(s.eye),Tk(s,e))}function xk(e){const t=e[1];e[1]=-e[2],e[2]=t}function Tk(e,t){const i=n2e(t,e.heading,e.tilt);return e.up=i.up,e}function ZQe(e,t,i){const r=yt(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=$p(i/(s/Math.sin(e)));return th(e-n)}function KQe(e,t,i){const r=xi(e),s=yt(t);return $p(i/(s/Math.sin(r)))+r}function o2e(e,t,i,r,s){let n,a,l,p;const y=t.latitude,b=ir(e.spatialReference).radius,x=t.longitude,A=nZe(y,i,b)/2;n=x-A,a=x+A;const M=xi(y),P=(1+Math.sin(M))/(1-Math.sin(M)),$=(P+1)*Math.tan(r/b/2),k=$*$;function z(B){const W=Math.PI/2;return(B=D9e.normalize(B,-W))>W&&(B=Math.PI-B),B}if(l=1.5*Math.PI-2*Math.atan(.5*($+Math.sqrt(4*P+k))),p=l+r/b,l=z(l),p=z(p),p<l){const B=p;p=l,l=B}if(l=Math.max(th(l),-90),p=Math.min(th(p),90),a=XQe.monotonic(n,a),a-n>180){const B=(a-n-180)/2;n+=B,a-=B}const G=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:It.WGS84;return s?(s.xmin=n,s.ymin=l,s.xmax=a,s.ymax=p,s.spatialReference=G):s=new ki(n,l,a,p,G),e.spatialReference&&e.spatialReference.isWebMercator&&e0(s,!1,s),s}const QQe=Object.freeze({__proto__:null,headingTiltToDirectionUp:n2e,directionToHeadingTilt:YQe,eyeForCenterWithHeadingTilt:JQe,lookAtTiltToEyeTilt:ZQe,eyeTiltToLookAtTilt:KQe,toExtent:o2e});function GS(e,t){return e!=null&&(t==null||(t===vt.Local?!e.isGeographic||e.isWGS84||e.wkid===td.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===td.CGCS2000||e.wkid===td.GCSMARS2000||e.wkid===td.GCSMARS2000_SPHERE||e.wkid===td.GCSMOON2000))}const a2e=Ge.getLogger("esri.views.3d.support.cameraUtils"),l2e=39.37,c2e=96,uH=1,eet=8,tet=5,h2e=1,eoe=Q(),aP=Q(),iet={heading:0,tilt:0},qm=new Gt,ret=new vv(-20037508342788905e-9,20037508342788905e-9),set=new vv(-180,180);var pa;function a4(e){return e.spatialReference||It.WGS84}function ME(e){return e.viewingMode==="global"?QQe:WQe}function net(e,t,i,r,s){return ME(e).headingTiltToDirectionUp(t,i,r,s)}function Bm(e,t){if(J(t))return null;const i=e.renderSpatialReference,r=ME(e).headingTiltToDirectionUp,s=Q();if(!To(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);Ue(n.direction,n.direction,e.state.camera.distance),Xe(n.direction,n.direction,s);const a=Fw(e,s,n.direction,n.up);return a.fov=xi(t.fov),a}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(pa||(pa={}));const sx=Q();function jS(e,t,i){const r=e.renderSpatialReference,s=XN(e,t.eye,t.viewForward,t.up,iet);let n=a4(e);return Ho(t.eye,r,sx,n)||(n=It.WGS84,Ho(t.eye,r,sx,n)),J(i)?new sh(new Gt(sx,n),s.heading,s.tilt,th(t.fov)):(i.position.x=sx[0],i.position.y=sx[1],i.position.z=sx[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=th(t.fov),i)}function UJ(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===vt.Global&&i!=null&&(t*=Math.cos(xi(i))),t/=e.renderCoordsHelper.unitInMeters,s/(c2e*l2e/t)/Math.tan(r.fovX/2)}function uw(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let a=c2e*l2e/(n/s);return e.renderCoordsHelper.viewingMode===vt.Global&&(a/=Math.cos(xi(i))),a*=e.renderCoordsHelper.unitInMeters,a}function u2e(e,t,i,r,s,n){return d2e(e,t,UJ(e,i,t.latitude),r,s,n)}function d2e(e,t,i,r,s,n){if(I2(n)){const l=new RE(n.signal);return QR(e,r.heading,r.tilt,t,i,s,l),void l.resolver.promise.then(p=>{const y=ID(e,p,r.fov);if(!J(y))return n.resolver.resolve(y);n.resolver.reject()},p=>n.resolver.reject(p))}const a=QR(e,r.heading,r.tilt,t,i,s);return ID(e,a,r.fov,n)}function XN(e,t,i,r,s){return ME(e).directionToHeadingTilt(t,i,r,s)}function oet(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,qm,e.spatialReference)&&Wt(wp(e.elevationProvider,qm),0)>qm.z-h2e)}async function aet(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,qm,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(qm.x,qm.y,qm.z,qm.spatialReference,"ground",i);return Wt(r,0)>qm.z-h2e}async function cet(e,t,i){const r=Q();if(t)if(t instanceof Gt){if(To(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return L(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else ke(r,t);else ke(r,e.state.camera.center);return r}function het(e,t){const i=Q();if(t&&t instanceof Gt){if(To(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=wp(e.elevationProvider,t);L(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else ke(i,t||e.state.camera.center);return i}function QR(e,t,i,r,s,n,a){const l=r&&r instanceof Gt?r:null;if(I2(a))return cet(e,r,a.signal).then(y=>{dH(e,t,i,l,y,s,n,a)},y=>a.resolver.reject(y)),null;const p=het(e,r);return dH(e,t,i,l,p,s,n,a)}function dH(e,t,i,r,s,n,a,l){if(J(r)){const x=e.renderSpatialReference;if(r=Sv(s,x,a4(e)),J(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const p=pet(e,t,i,s,n,a),y=(0,ME(e).eyeForCenterWithHeadingTilt)(s,n,p.heading,p.tilt);if(a===pa.ADJUST&&e.viewingMode==="global"&&i>0){const x=()=>{const M=p2e(e,s,n,met(e,n,i,s));return a=i-M<1?pa.LOCKED:pa.ADJUST,dH(e,t,M,r,s,n,a,l)},A=e.map.ground.navigationConstraint;if(!A||A.type==="stay-above"){if(oet(e,y.eye))return x();if(I2(l))return aet(e,y.eye,l.signal).then(M=>M?x():(l.resolver.resolve({eye:y.eye,up:y.up,center:qn(s),heading:y.heading,tilt:y.tilt}),null)),null}}const b=!l||I2(l)?{center:Q(),eye:Q(),up:Q(),tilt:0,heading:0}:l;return b.eye=y.eye,b.up=y.up,b.center=qn(s),b.heading=y.heading,b.tilt=y.tilt,I2(l)&&l.resolver.resolve(b),b}function DM(e,t,i,r,s,n=null){const a=t.zmax!=null&&t.zmin!=null;let l,p,y;if(e.state.isGlobal){if(!GS(t.spatialReference,vt.Global))return I2(n)&&n.resolver.reject(),null;const z=new Gt(t.xmin,t.ymin,t.spatialReference),G=new Gt(t.xmax,t.ymax,t.spatialReference),B=t.spatialReference.isGeographic?set:ret;l=new Gt({x:B.center(z.x,G.x),y:(G.y+z.y)/2,z:a?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const W=ir(t.spatialReference),q=sZe(l,z,G);p=q.lon,y=q.lat,B.diff(z.x,G.x)>B.range/2&&(p+=W.halfCircumference),p=Math.min(p,W.halfCircumference),y=Math.min(y,W.halfCircumference)}else{const z=Wt(e.renderSpatialReference,t.spatialReference);z.equals(t.spatialReference)||(t=mE(t,z)),p=t.xmax-t.xmin,y=t.ymax-t.ymin;const G=a?(t.zmax+t.zmin)/2:null;l=new Gt({x:t.xmin+.5*p,y:t.ymin+.5*y,z:G,spatialReference:z})}const b=a?t.zmax-t.zmin:0,x=e.state.camera,A=1/Math.tan(x.fovX/2),M=1/Math.tan(x.fovY/2),P=1/Math.tan(x.fov/2),$=Math.max(.5*p*A,.5*y*M,.5*b*P)/uH;if(I2(n)){const z=new RE(n.signal);return QR(e,i,r,l,$,s,z),void z.resolver.promise.then(G=>{const B=ID(e,G,e.camera.fov);if(!J(B))return n.resolver.resolve(B);n.resolver.reject()},G=>n.resolver.reject(G))}const k=QR(e,i,r,l,$,s);return ID(e,k,e.camera.fov,n)}function uet(e,t,i){const r=e.renderSpatialReference,s=Sv(i,r,a4(e));if(J(s))return null;const n=Math.tan(t.fovX/2),a=Math.tan(t.fovY/2),l=Yq(t.eye,i),p=2*l*n*uH,y=2*l*a*uH;return e.viewingMode==="global"?o2e(e,s,p,y):i2e(e,s,p,y)}function det(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>eet)return!0;const s=e.renderSpatialReference,n=a4(e),a=Sv(t,s,n),l=Sv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(J(a)||J(l))return!1;const p=Math.tan(.5*e.state.camera.fov)*r;return l.distance(a)/p>tet}function pet(e,t,i,r,s,n){let a=0;return n===pa.ADJUST&&det(e,r,s)?(t=0,a=fet(e,s,i,r)):a=zJ(e,r,s,i),a=e.state.constraints.clampTilt(s,a),{heading:t,tilt:i=p2e(e,r,s,a)}}const PD=.7;function fet(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-PD)+s.max*PD,a=zJ(e,r,t,i);return Math.min(a,n)}function met(e,t,i,r){const s=e.state.constraints.tilt(t);let n=zJ(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-PD)+n*PD}function p2e(e,t,i,r){return ME(e).lookAtTiltToEyeTilt(r,t,i)}function zJ(e,t,i,r){return ME(e).eyeTiltToLookAtTilt(r,t,i)}function ID(e,t,i,r){if(J(t))return null;const s=e.renderSpatialReference,n=Sv(t.eye,s,a4(e));return J(n)?null:L(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new sh(n,t.heading,t.tilt,i)}function f2e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);a2e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function m2e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);a2e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function get(e,t){return e.spatialReference?_ge(t,e.spatialReference):void 0}function g2e(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const a=It.WGS84;return t instanceof sh?(s=t.position.latitude,To(t.position,eoe,r),To(i,aP,r),n=Er(eoe,aP)):(Ho(t.center,r,aP,a),s=aP[1],n=t.distance),uw(e,n,s)}class RE{constructor(t){this.signal=t,this.resolver=bg()}}function I2(e){return e&&"resolver"in e}function Od(e){let t=e*e;return e<0&&(t*=-1),t}function toe(e,t,i){const r=i,s=e.state,n=e.device,a=t.tiltDirection==="forward-down"?1:-1,l=1;return n.deviceType==="standard"?(r.translation[0]=Od(s.axes[0]),r.translation[1]=Od(s.axes[1]),r.translation[2]=Od(s.buttons[7])-Od(s.buttons[6]),r.heading=Od(s.axes[2]),r.tilt=Od(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Od(s.axes[0]),r.translation[1]=1.2*Od(s.axes[1]),r.translation[2]=2*-Od(s.axes[2]),r.heading=1.2*Od(s.axes[5]),r.tilt=1.2*Od(s.axes[3])),r.tilt*=a,Ue(r.translation,r.translation,l),r}function ioe(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function Sk(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let Ly=class extends Lv{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new br,this.constraintOptions={selection:ts.ALL,interactionType:Si.NONE,interactionStartCamera:new br,interactionFactor:0,interactionDirection:null,tiltMode:xo.LOOK_AROUND}}handleEventGamepad(e){const t=toe(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||Sk(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,ioe(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=ioe(this.keysButtonState,this.transformation);Sk(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,m_),this._applyDisabledMovementTypes(m_),this._applyPan(m_.pan),this._applyRotate(m_.rotate),this._applyZoom(m_.zoom),this._applyAscend(m_.ascend),this.constraintOptions.interactionType=Si.NONE,this.constraintOptions.selection=ts.COLLISION,sn(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;We(Tl,t.center,t.eye),Ct(Tl,Tl,e.matrix),t.center=Xe(Tl,Tl,t.eye),t.up=Ct(Tl,t.up,e.matrix),this.constraintOptions.interactionType=Si.LOOK_AROUND,this.constraintOptions.selection=ts.ALL_EXCEPT_COLLISION,sn(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Ct(Tl,t.eye,e.matrix),t.center=Ct(Tl,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Ct(Tl,t.up,e.matrix)),this.constraintOptions.interactionType=Si.PAN,this.constraintOptions.selection=ts.ALL,sn(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=Xe(Tl,this.currentCamera.eye,Ue(Tt.get(),t,e)),ke(hA,t),Na(hA,hA),this.constraintOptions.interactionDirection=hA,this.constraintOptions.interactionType=Si.ZOOM,this.constraintOptions.selection=ts.ALL_EXCEPT_COLLISION,sn(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Tt.get());if(this.constraintOptions.interactionDirection=ke(hA,t),this.view.state.isGlobal){const i=yt(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=Ue(Tl,this.currentCamera.eye,r),this.currentCamera.center=Ue(Tl,this.currentCamera.center,r)}else{const i=Ue(Tt.get(),t,e);this.currentCamera.eye=Xe(Tl,this.currentCamera.eye,i),this.currentCamera.center=Xe(Tl,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=Si.ASCEND,this.constraintOptions.selection=ts.COLLISION,sn(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=ts.ALL_EXCEPT_COLLISION,sn(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){Tet(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Tl)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,a=this.view.navigation.gamepad,l=ze(Tt.get(),s[0],s[1],0);ot(l,l);const p=n.translation[0]*e.pan;if(p!==0){const P=Ue(Tt.get(),r,p);yl(i.pan.matrix,i.pan.matrix,P),i.pan.enabled=!0}switch(a.mode){case"pan":{const P=-n.translation[1]*e.pan;if(P!==0){const $=Ue(Tt.get(),l,P);yl(i.pan.matrix,i.pan.matrix,$),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:a.mode}const y=n.translation[2]*e.ascend;i.ascend=y;const b=-n.heading*e.rotate;b!==0&&(qc(i.rotate.matrix,i.rotate.matrix,b,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Tt.get())),i.rotate.enabled=!0);const x=n.tilt*e.rotate,A=$v(this.view.renderCoordsHelper,t.center,t.eye),M=Ot(A+x,oa.min,oa.max)-A;M&&(qc(i.rotate.matrix,i.rotate.matrix,M,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,a=this.view.navigation.gamepad,l=si(Tt.get(),s,r);ot(l,l),Na(l,l),RQe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,a),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(m_.pan,this.tmpCamera);const p=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,y=n.translation[2]*e.ascend;i.ascend=y;const b=-n.heading*e.rotate;b!==0&&(qc(i.rotate.matrix,i.rotate.matrix,b,this.tmpCamera.eye),i.rotate.enabled=!0);const x=n.tilt*e.rotate,A=this._clampTiltDeltaGlobalToValidRange(x,t.ray,p);A!==0&&(qc(i.rotate.matrix,i.rotate.matrix,A,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=ir(this.view.spatialReference),s=t$(oa.min,t.origin,i,r);let n=0,a=0;const l=Tt.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,l)){const p=$v(this.view.renderCoordsHelper,l,t.origin);n=t$(p,t.origin,i,r),a=t$(oa.max,t.origin,i,r)}else{gE(i+r.radius,t,l);const p=Xn(-rt(t.direction,ot(l,l)));n=Vne(p,t.origin,i,r),a=Vne(oa.max,t.origin,i,r)}return Ot(n+e,s,a)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=net(this.view,t,0,y2e,xet),n=i.intersectManifoldClosestSilhouette(iu(t,s),e,Tt.get()),a=Er(t,n),l=i.intersectManifoldClosestSilhouette(iu(t,kg(Tt.get(),t,r.center)),e,Tt.get()),p=Er(t,l);return Math.min(a,p)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,Tt.get());if(s){const a=We(Tt.get(),e,n),l=yt(a);Ue(a,a,1/l);const p=ot(Tt.get(),e),y=Xn(rt(p,a));return l*Math.sin(Math.min(vet,y))}{const a=ke(Tt.get(),e);return t.setAltitude(a,this.filteredSurfaceElevation),Er(n,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:_et}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+ir(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Tt.get(),a=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),l=this._clampedDistanceToSurface(t,n),p=r.width/2,y=roe*r.width,b=roe*r.width,x=l*Math.tan(.5*r.fovX)/p,A=x/i,M=x/this._computeHeadingRotateRadius(n),P=a-t;return{pan:(s?A:x)*y*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(y*e/p)*P-P),zoom:2**(y*e/p)*l-l,rotate:Ot(M*b,bet,wet)*e}}_applyDisabledMovementTypes(e){!L(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&p0(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&p0(e.rotate.matrix))}static activatesFor(e,t){const i=toe(t,e.navigation.gamepad,yet);return!(t.action==="end"||Sk(i))}};_([S({constructOnly:!0})],Ly.prototype,"view",void 0),_([S({constructOnly:!0})],Ly.prototype,"gamepadDevice",void 0),_([S({constructOnly:!0})],Ly.prototype,"disableMovements",void 0),Ly=_([re("esri.views.3d.state.controllers.GamepadKeyboardController")],Ly);const yet={translation:[0,0,0],heading:0,tilt:0,zoom:0},y2e=80,vet=xi(y2e),roe=.75,_et=5,bet=xi(30),wet=xi(80),m_={zoom:0,ascend:0,pan:{enabled:!1,matrix:lt()},rotate:{enabled:!1,matrix:lt()}},Tl=Q(),hA=Q(),xet=kJ();function Tet(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,p0(e.pan.matrix),e.rotate.enabled=!1,p0(e.rotate.matrix)}class Eet extends ya{constructor(t){super(!0),this.view=t,this.watchHandles=new Ei,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([Pi(this.view.navigation.gamepad,"enabled",i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||Ly.activatesFor(this.view,t.data)){if(!r){const s=new Ly({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var Mc;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Mc||(Mc={}));class Aet extends ya{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:vt.Local},this.keyToNumber={[i.left]:Mc.LEFT,[i.right]:Mc.RIGHT,[i.forward]:Mc.FORWARD,[i.backward]:Mc.BACKWARD,[i.up]:Mc.UP,[i.down]:Mc.DOWN,[i.headingLeft]:Mc.HEADINGLEFT,[i.headingRight]:Mc.HEADINGRIGHT,[i.tiltUp]:Mc.TILTUP,[i.tiltDown]:Mc.TILTDOWN,[i.zoomIn]:Mc.ZOOMIN,[i.zoomOut]:Mc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new Ly({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class Cet extends ya{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new RD({view:this.view,mode:"interaction"}):new OD({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Ns(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class $D{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let pv=class extends ZR{constructor(e){super(e),this.view=null,this.beginCamera=new br,this.elapsedTimeSec=0,this.constraintOptions={selection:ts.ALL,interactionType:Si.PAN,interactionFactor:0,interactionStartCamera:new br,interactionDirection:null,tiltMode:xo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new CS}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),sn(this.view,t,this.constraintOptions)}};_([S({constructOnly:!0})],pv.prototype,"view",void 0),pv=_([re("esri.views.3d.state.controllers.momentum.MomentumController")],pv);let LM=class extends pv{constructor(e){super(e),this.interactionType=Si.PAN,this.tmpPan=Q()}momentumStep(e,t){const i=this.momentum.value(e);Ue(this.tmpPan,this.momentum.direction,i),t.eye=We(soe,t.eye,this.tmpPan),t.center=We(soe,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};_([S({constructOnly:!0})],LM.prototype,"momentum",void 0),LM=_([re("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],LM);const soe=Q(),Met=Q(),lP=Q();let s$=class extends pv{constructor(e){super(e),this.interactionType=Si.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);ke(lP,t.eye),ot(lP,lP),si(this.momentum.axis2,lP,this.momentum.axis1),Xbe(t,Met,this.momentum.axis1,i,this.momentum.axis2,r)}};_([S({constructOnly:!0})],s$.prototype,"momentum",void 0),s$=_([re("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],s$);let Jb=class extends pv{constructor(e){super(e),this.interactionType=Si.TUMBLE}set center(e){this._set("center",qn(e))}set axis(e){this._set("axis",qn(e))}momentumStep(e,t){const i=this.momentum.value(e);Dv(t,this.center,$R(this.axis,i))}};_([S({constructOnly:!0})],Jb.prototype,"momentum",void 0),_([S({constructOnly:!0})],Jb.prototype,"center",null),_([S({constructOnly:!0})],Jb.prototype,"axis",null),Jb=_([re("esri.views.3d.state.controllers.momentum.MomentumController")],Jb);let sT=class extends pv{constructor(e){super(e),this.interactionType=Si.ZOOM,this.constraintOptions.interactionDirection=Q()}set zoomCenter(e){this._set("zoomCenter",qn(e))}momentumStep(e,t){ke(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);DJ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=kg(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};_([S({constructOnly:!0})],sT.prototype,"momentum",void 0),_([S({constructOnly:!0})],sT.prototype,"zoomCenter",null),sT=_([re("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],sT);let Tb=class extends pv{constructor(e){super(e),this.interactionType=Si.ZOOM,this.radius=0,this.tmpSceneCenter=Q(),this.tmpZoomAxisAngle=EE(),this.sphere=qo()}set screenCenter(e){this._set("screenCenter",Ns(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",qn(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);Vbe(this.sphere,t,i),this.constraintOptions.interactionType=Si.ZOOM,sn(this.view,t,this.constraintOptions),KR(this.sphere,t,this.screenCenter,this.tmpSceneCenter),DR(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),Dv(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=Si.PAN}};_([S({constructOnly:!0})],Tb.prototype,"momentum",void 0),_([S({constructOnly:!0})],Tb.prototype,"screenCenter",null),_([S({constructOnly:!0})],Tb.prototype,"sceneCenter",null),_([S({constructOnly:!0})],Tb.prototype,"radius",void 0),Tb=_([re("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Tb);class pp{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class YN{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class Ret extends YN{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class v2e{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new pp(.6),this.screen=[new pp(.4),new pp(.4)],this.scene=[new pp(.6),new pp(.6),new pp(.6)],this.tmpDirection=Q()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){ze(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=yt(this.tmpDirection);s>0&&Ue(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new Ret(t,i,r,n,this.tmpDirection)}}class noe{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const ooe=1e-5;class Oet extends YN{constructor(t,i,r,s,n,a=0,l){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=a,this.axis2=l}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class Pet{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=Q(),this.tmpAxis2=Q(),this.tmpAngles=St(),this.time=new pp(.3),this.screen=[new pp(.4),new pp(.4)],this.angle1=new noe(.6),this.angle2=new noe(.6),this.axis1=Q(),this.axis2=Q(),this.lastScene=Q()}addMomentumDirectRotation(t,i,r,s,n,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let l=qbe(this.lastScene,i,this.tmpAxis2,s,n,a);this.angle2.update(0),dl(this.tmpAxis2)<ooe?l=0:ot(this.axis1,this.tmpAxis2),this.angle1.update(l),ke(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,a,l){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;Wbe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,a,l,!1),dl(this.tmpAxis2)<ooe?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),ot(this.axis1,this.tmpAxis1),ot(this.axis2,this.tmpAxis2)),ke(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new Oet(t,i,r,s,this.axis1,n,this.axis2)}}class _2e{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new pp(.8),this.time=new pp(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=Ot(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new YN(t,i,r)}}class b2e extends _2e{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class Iet extends YN{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class w2e extends _2e{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new Iet(t,i,r)}}let n$=class extends Lv{constructor(e){super(e),this.view=null,this.smoothRotation=new $D(.05),this.rotationAxis=Q(),this.panningPlane=er(),this.smoothScaling=new $D(.05),this.zoomCenterScreen=Ns(),this.zoomMomentumEstimator=new w2e,this.rotationMomentumEstimator=new b2e,this.panSphericalMomentumEstimator=new Pet,this.panPlanarMomentumEstimator=new v2e,this.adjustedSphere=qo(),this.tmp3d=Q(),this.tmpScreenPointArray=Ns(),this.beginScreenPoint=Ns(),this.beginScenePoint=Q(),this.screenPickPoint=Ns(),this.navMode=Uo.Horizontal,this.tmpInteractionDirection=Q(),this.constraintOptions={selection:ts.ALL,interactionType:Si.NONE,interactionFactor:0,interactionStartCamera:new br,interactionDirection:null,tiltMode:xo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-_v.normalize(xi(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Ym(e.center,this.screenPickPoint),Pn(this.beginScreenPoint,this.screenPickPoint);const i=ir(this.view.spatialReference),r=jbe(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,i);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,ke(this.beginScenePoint,this.scenePickPoint),this.navMode=WN(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===Uo.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Na(this.tmp3d,this.startCamera.viewForward);yS(this.scenePickPoint,t,this.panningPlane);const i=Ns(this.screenPickPoint[0],0),r=Q(),s=yt(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],KR(this.adjustedSphere,this.startCamera,i,r);const n=ca();this.startCamera.projectToRenderScreen(r,n);const a=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],a),this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&yS(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=Q(),p=Q(),y=Q(),b=80,x=5,A=50;We(l,this.scenePickPoint,this.currentCamera.eye),ot(l,l);const M=x*Math.max(Math.abs(this.view.camera.position.z),A),P=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,b),$=P?Math.min(P,M):M;ke(y,Xe(p,this.currentCamera.eye,Ue(p,l,$))),this.panningPlane[3]=-rt(this.panningPlane,y),this.startCamera.center=Xe(p,this.startCamera.eye,Ue(p,this.startCamera.viewForward,$));const k=Ym(e.center,this.tmpScreenPointArray);hH(this.panningPlane,this.startCamera,k,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Uo.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Uo.Horizontal?new Tb({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new sT({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Jb({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Uo.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new s$({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new LM({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),Vbe(this.sphere,this.currentCamera,this.smoothScaling.value),Ym(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=Si.ZOOM,this.constraintOptions.interactionFactor=dp(e.radius-this.beginRadius),sn(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=Ym(e.center,this.tmpScreenPointArray);KR(this.sphere,this.currentCamera,t,this.tmp3d),LJ(this.beginScenePoint,rt(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Jbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Ybe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=Si.PAN,this.constraintOptions.interactionFactor=dp(this.screenPickPoint,t),sn(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){ot(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Na(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+cH(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),Dv(this.currentCamera,this.sphere,$R(this.rotationAxis,s)),this.constraintOptions.interactionType=Si.TUMBLE,this.constraintOptions.interactionFactor=dp(e.radius*i),sn(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=Ym(e.center,this.tmpScreenPointArray);hH(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(Hbe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=Si.PAN,this.constraintOptions.interactionFactor=dp(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),sn(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),DJ(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=Si.ZOOM,this.constraintOptions.interactionFactor=dp(e.radius-this.beginRadius),sn(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ke(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Na(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=cH(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),Dv(this.currentCamera,this.sphere,$R(this.rotationAxis,n)),this.constraintOptions.interactionType=Si.TUMBLE,this.constraintOptions.interactionFactor=dp(e.radius*n),sn(this.view,this.currentCamera,this.constraintOptions)}};_([S({constructOnly:!0})],n$.prototype,"view",void 0),n$=_([re("esri.views.3d.state.controllers.global.PinchAndPanController")],n$);const aoe=$t(0,0,1),$et={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},Det=80;let o$=class extends Lv{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new $D(.05),this.scalingValueSmooth=new $D(.05),this.planeHorizontal=er(),this.planeVertical=er(),this.rotationMomentumEstimator=new b2e,this.panMomentumEstimator=new v2e(300,12,.9),this.zoomMomentumEstimator=new w2e,this.beginCenter=Q(),this.tmpPoints=[],this.beginCenterScreen=Ns(),this.tmpCentroid3d=Q(),this.tmpCentroid2d=Ns(),this.tmp2d=Ns(),this.constraintOptions={selection:ts.ALL,interactionType:Si.NONE,interactionFactor:0,interactionStartCamera:new br,interactionDirection:null,tiltMode:xo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Ym(e.center,this.beginCenterScreen),ege(aoe,0,this.planeHorizontal);const i=Q();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i);const r=Q();Na(r,this.startCamera.viewForward);const s=Q();ke(s,aoe);const n=rt(r,s),a=$p(n<0?-n:n);if(this.panMode=a>=$et.ANGLE_THRESHOLD?Uo.Horizontal:Uo.Vertical,kV(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||UV(this.planeHorizontal,this.planeHorizontal),this.panMode===Uo.Vertical){Ue(s,s,n),We(this.planeVertical,r,s),ot(this.planeVertical,this.planeVertical),kV(this.planeVertical,this.planeVertical,i);const l=Q(),p=Q(),y=Q();We(l,i,this.currentCamera.eye),ot(l,l);const b=5*Math.max(Math.abs(this.view.camera.position.z),50),x=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,Det),A=x?Math.min(x,b):b;ke(y,Xe(p,this.currentCamera.eye,Ue(p,l,A))),this.planeVertical[3]=-rt(this.planeVertical,y),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),gk(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),gk(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===Uo.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),DJ(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=Si.ZOOM,this.constraintOptions.interactionFactor=dp(Math.abs(e.radius-this.beginRadius)),sn(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),gk(this.tmpPoints,this.tmpCentroid3d),Ym(e.center,this.tmpCentroid2d),Hbe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=Si.PAN,this.constraintOptions.interactionFactor=dp(this.beginCenterScreen,this.tmpCentroid2d),sn(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,a=this.rotationValueSmooth.value,l=a+cH(e.angle-a),p=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=p,this.rotationValueSmooth.update(l);const y=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(y,.001*e.timestamp),Dv(this.currentCamera,n,$R(s,y)),this.constraintOptions.interactionType=Si.TUMBLE,this.constraintOptions.interactionFactor=dp(Math.abs(e.radius*y)),sn(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new sT({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Jb({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new LM({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,r[n]===void 0&&(r[n]=Q()),hH(t,i,s,r[n]),n+=1}),r}};_([S({constructOnly:!0})],o$.prototype,"view",void 0),o$=_([re("esri.views.3d.state.controllers.local.PinchAndPanController")],o$);class loe extends ya{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!FJ(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new n$({view:this.view}):new o$({view:this.view})}}class Let extends ya{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class x2e extends ya{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class Net extends x2e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class Fet extends x2e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class ket extends ya{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var i,r,s;const n=this.invert?-1:1,a=Ns(0,t.data.delta*n);switch(t.data.action){case"begin":(i=this.cameraController)==null||i.end(),this.cameraController=new rT({view:this.view,pivot:Dc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(a);break;case"update":(r=this.cameraController)==null||r.update(a);break;case"end":(s=this.cameraController)==null||s.end(),this.cameraController=null}}}function coe(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>Bet(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Uet(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function zet(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function Bet(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class Vet{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const a=n.gamepad,l=a.index,p=this.inputDevices[l];p&&(this._emitGamepadEvent(a,coe(p),!1),this.inputDevices.splice(l,1),this.latestUpdate.splice(l,1),this.input.gamepad.devices.remove(p),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new WY(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=L2({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const a=this.latestUpdate[s.index],l=coe(n),p=r||zet(l);a&&(a.timestamp===s.timestamp||!a.active&&p||Uet(a.state,l))||this._emitGamepadEvent(s,l,!p)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const a=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:a})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const hoe=je("trident"),uoe=je("edge"),Get=je("chrome"),jet=je("ff"),Het=je("safari"),nx={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class JN{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Vet(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(Ek[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&Ek[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Ek[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?nx.touchNone:nx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?nx.touchPan:nx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(nx.touchNone),this._element.classList.remove(nx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=Zve(this._element,t);return JN.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=nqe(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(hoe||uoe)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}hoe||uoe?r*=.7:Get||Het?r*=.6:jet&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,a)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}JN.test={disableSubpixelCoordinates:!1};const Ek={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class qet extends ya{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function T2e(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Wet(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function Xet(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:dd()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[B,W]=e,[q,X]=[W.x-B.x,W.y-B.y];return t.radius=Math.sqrt(q*q+X*X)/2,t.center.x=(B.x+W.x)/2,t.center.y=(B.y+W.y)/2,t}let i=0,r=0;for(let B=0;B<e.length;B++)i+=e[B].x,r+=e[B].y;i/=e.length,r/=e.length;const s=e.map(B=>B.x-i),n=e.map(B=>B.y-r);let a=0,l=0,p=0,y=0,b=0,x=0,A=0;for(let B=0;B<s.length;B++){const W=s[B],q=n[B],X=W*W,oe=q*q;a+=X,l+=oe,p+=W*q,y+=X*W,b+=oe*q,x+=W*oe,A+=q*X}const M=.5*(y+x),P=.5*(b+A),$=a*l-p*p,k=(M*l-P*p)/$,z=(a*P-p*M)/$,G=dd(k+i,z+r);return{radius:Math.sqrt(k*k+z*z+(a+l)/e.length),center:G}}class Yet extends ya{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:Jet(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=cP(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=a$(s,S2e(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=cP(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=cP(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=a$(r,i)-t,r.lastAngle=a$(r,i)-t})}_emitEvent(t,i,r){const s=cP(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function S2e(e){const t=[];return e.forEach(i=>{t.push(dd(i.event.x,i.event.y))}),Xet(t)}function cP(e){const t=S2e(e);let i=0;return e.forEach(r=>{let s=a$(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function Jet(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function a$(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var doe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(doe||(doe={}));const tv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Zet extends ya{constructor(t=tv.maximumDoubleClickDelay,i=tv.maximumDoubleClickDistance,r=tv.maximumDoubleTouchDelay,s=tv.maximumDoubleTouchDistance,n=fL){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=_o(t.doubleClickTimeout))}get hasPendingInputs(){return rn(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;T2e(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class Ket extends ya{constructor(t=tv.maximumDoubleClickDelay,i=tv.maximumDoubleClickDistance,r=tv.maximumDoubleTouchDelay,s=tv.maximumDoubleTouchDistance,n=fL){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const a=n.immediateDoubleClick;if(a){a.timeoutHandle.remove();const l=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;T2e(a,t.data)>l?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,a.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const uA={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class Qet extends ya{constructor(t=uA.maximumClickDelay,i=uA.movementUntilMouseDrag,r=uA.movementUntilPenDrag,s=uA.movementUntilTouchDrag,n=uA.holdDelay,a=fL){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",l=>{this._handlePointerLoss(l,"pointer-up")}),this.registerIncoming("pointer-capture-lost",l=>{this._handlePointerLoss(l,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",l=>{this._handlePointerLoss(l,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(r);if(a){if(!a.isDragging){const l=a.previousEvent;this._pointerHold.emit(l,void 0,t.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):Wet(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class ett{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class ttt extends ya{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new ett({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,a=1/0;i.pointers.forEach($=>{r=Math.max(r,$.x),s=Math.min(s,$.x),n=Math.max(n,$.y),a=Math.min(a,$.y)});let l=-1/0,p=1/0,y=-1/0,b=1/0;t.pointers.forEach($=>{l=Math.max(l,$.x),p=Math.min(p,$.x),y=Math.max(y,$.y),b=Math.min(b,$.y)});const x=r-s,A=n-a,M=l-p,P=y-b;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(M-x)<=this._maxDelta&&Math.abs(P-A)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const a=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-a.y))}),r>=this._threshold}}let Em=class extends st{constructor(){super(...arguments),this._handles=new Ei}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new JN(this.view.surface,e.input);const t=[new Ket,new Qet,new Zet,new Yet(this.view.navigation),new ttt],i=new mb({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new qet],ls.INTERNAL),this._modeDragPan=new loe(e,"primary"),this._modeDragRotate=new wk(e,"secondary",Dc.CENTER),this._modeDragZoom=new BQe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Let(e),new UQe(e),new Eet(e),new Aet(e,r.pan),new Cet(e),new Fet(e,r.resetTilt),new Net(e,r.resetHeading),new wk(e,"primary",Dc.EYE,[r.lookAround]),new wk(e,"secondary",Dc.CENTER,[r.lookAround]),new loe(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new ket(e)],ls.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),Pi(this.view.navigation,"browserTouchPanEnabled",s=>{this._source.browserTouchPanningEnabled=!s})}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=pH.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};_([S()],Em.prototype,"view",void 0),_([S({value:"pan"})],Em.prototype,"primaryDragAction",null),_([S({value:"default"})],Em.prototype,"mode",null),_([S({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],Em.prototype,"hasPendingInputs",void 0),_([S({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],Em.prototype,"latestPointerType",void 0),_([S()],Em.prototype,"_inputManager",void 0),Em=_([re("esri.views.3d.input.SceneInputManager")],Em);const pH=new Map,Ak=new Map,Ck=new Map;Ak.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Ak.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Ck.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Ck.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),pH.set("default",Ak),pH.set("pro",Ck);const itt=Em;let _s=class extends st{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};_([S()],_s.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),_([S()],_s.prototype,"SCENEVIEW_LOCKING_LOG",void 0),_([S()],_s.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),_([S()],_s.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),_([S()],_s.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),_([S()],_s.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),_([S()],_s.prototype,"DECONFLICTOR_SHOW_GRID",void 0),_([S()],_s.prototype,"LABELS_SHOW_BORDER",void 0),_([S()],_s.prototype,"TEXT_SHOW_BASELINE",void 0),_([S()],_s.prototype,"TEXT_SHOW_BORDER",void 0),_([S()],_s.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),_([S()],_s.prototype,"OVERLAY_SHOW_CENTER",void 0),_([S()],_s.prototype,"SHOW_POI",void 0),_([S()],_s.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),_([S()],_s.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),_([S()],_s.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),_([S()],_s.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),_([S()],_s.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),_([S()],_s.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),_([S()],_s.prototype,"I3S_TREE_SHOW_TILES",void 0),_([S()],_s.prototype,"I3S_SHOW_MODIFICATIONS",void 0),_([S()],_s.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),_([S()],_s.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),_([S()],_s.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),_([S()],_s.prototype,"LINE_WIREFRAMES",void 0),_s=_([re("esri.views.3d.support.DebugFlags")],_s);const ur=new _s;let Ih,RT,fH=!1,mH=!1,gH=!1,yH=!1,NM=null;function rtt(e,t){if(!mH||!RT)return;E2e();const i=RT;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const a=e.accBins[s][e.accBinsNumY-1-n];r+=a.length;const l=s*e.accBinsSizeX,p=(s+1)*e.accBinsSizeX,y=n*e.accBinsSizeY,b=(n+1)*e.accBinsSizeY;i.fillText(a.length.toFixed(),l+5,y+15),A2e(l,p,y,b,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function stt(e){gH=ur.DECONFLICTOR_SHOW_VISIBLE,yH=ur.DECONFLICTOR_SHOW_INVISIBLE,fH=gH||yH,mH=ur.DECONFLICTOR_SHOW_GRID,NM=null,fH||mH?NM=()=>ntt(e):Ih&&(Ih.parentElement.removeChild(Ih),Ih=null)}function E2e(){NM&&(NM(),NM=null)}function ntt(e){Ih==null&&(Ih=document.createElement("canvas"),Ih.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Ih));const t=e.width*e.pixelRatio,i=e.height*e.pixelRatio;Ih.setAttribute("width",`${t}px`),Ih.setAttribute("height",`${i}px`),Ih.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${e.width}px;height:${e.height}px`),RT=Ih.getContext("2d"),RT.clearRect(0,0,e.width,e.height),RT.font="12px Arial"}function A2e(e,t,i,r,s){E2e();const n=Ih.height,a=RT;a.beginPath(),a.lineWidth=1,a.strokeStyle=s,a.moveTo(e,n-i),a.lineTo(t,n-i),a.stroke(),a.lineTo(t,n-r),a.stroke(),a.lineTo(t,n-i),a.stroke(),a.lineTo(e,n-i),a.stroke(),a.lineTo(e,n-i),a.stroke(),a.closePath()}function ott(e,t){fH&&(t&&gH||!t&&yH)&&A2e(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Fo,Gh;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Fo||(Fo={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(Gh||(Gh={}));function C2e(e,t){return new ZN(e,P2e,t)}function att(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=P2e;return new ZN(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:Mk.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:Mk.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:Mk.minPixelSize},t)}function ltt(e){return Math.abs(e*e*e)}function M2e(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return dA.scale=Math.min(r.divisor/(t-r.offset),1),dA.factor=ltt(e),dA.minPixelSize=r.minPixelSize,dA.paddingPixels=s,dA}function R2e(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function BJ(e,t){return Math.max(Vi(e*t.scale,e,t.factor),R2e(e,t))}function ctt(e,t,i){const r=M2e(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,BJ(1,r)}function poe(e,t,i,r){r.scale=ctt(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function O2e(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,R2e(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function htt(e,t,i,r){return BJ(e,M2e(t,i,r))}class ZN{constructor(t,i,r,s=utt(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===vt.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new ZN(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:a}=this.description,{fovY:l,distance:p}=t,y=this.calculateCurvatureDependentParameters(t,i),b=this.coverageCompensation(t,i,y),{tiltAngle:x,scaleFallOffFactor:A}=y,M=Math.sin(x)*p,P=.5*Math.PI-x-l*(.5-s*b),$=M/Math.cos(P),k=P+l*n*b,z=($-A*(M/Math.cos(k)))/(1-A);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=z,r.divisor=$-z,r.minPixelSize=a,r}_calculateCurvatureDependentParametersLocal(t,i,r=foe){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=foe){const s=this.description.curvatureDependent,n=1+t.distance/i,a=Math.sqrt(n*n-1),[l,p]=[s.min.curvature,s.max.curvature],y=Ot((a-l)/(p-l),0,1),[b,x]=[s.min,s.max];return r.tiltAngle=Vi(b.tiltAngle,x.tiltAngle,y),r.scaleFallOffFactor=Vi(b.scaleFallOffFactor,x.scaleFallOffFactor,y),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:a,distance:l}=t,p=l*l+s-2*Math.cos(n)*l*i,y=Math.sqrt(p),b=Math.sqrt(p-s);return(Math.acos(b/y)-Math.asin(i/(y/Math.sin(n)))+.5*a)/a}}const P2e={curvatureDependent:{min:{curvature:xi(10),tiltAngle:xi(12),scaleFallOffFactor:.5},max:{curvature:xi(70),tiltAngle:xi(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Mk={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function utt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const dA={scale:0,factor:0,minPixelSize:0,paddingPixels:0},foe={tiltAngle:0,scaleFallOffFactor:0};function dtt(e){return e instanceof Float32Array&&e.length>=16}function ptt(e){return Array.isArray(e)&&e.length>=16}function ftt(e){return dtt(e)||ptt(e)}var Te;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(Te||(Te={}));var Gu;(function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"})(Gu||(Gu={}));const hP=On();function KN(e,t,i,r,s,n,a){if(!n4(t))if(e.boundingInfo){Kt(e.primitiveType===rc.Triangle);const l=i.tolerance;I2e(e.boundingInfo,r,s,l,n,a)}else{const l=e.indices.get(Y.POSITION),p=e.vertexAttributes.get(Y.POSITION);l4(r,s,0,l.length/3,l,p,void 0,n,a)}}const mtt=Q();function I2e(e,t,i,r,s,n){if(J(e))return;const a=D2e(t,i,mtt);if(f0e(hP,e.getBBMin()),m0e(hP,e.getBBMax()),L(s)&&s.applyToAabb(hP),VJ(hP,t,a,r)){const{primitiveIndices:l,indices:p,position:y}=e,b=l?l.length:p.length/3;if(b>btt){const x=e.getChildren();if(x!==void 0){for(let A=0;A<8;++A)x[A]!==void 0&&I2e(x[A],t,i,r,s,n);return}}l4(t,i,0,b,p,y,l,s,n)}}const $2e=Q();function l4(e,t,i,r,s,n,a,l,p){if(a)return gtt(e,t,i,r,s,n,a,l,p);const y=n.data,b=n.stride||n.size,x=e[0],A=e[1],M=e[2],P=t[0]-x,$=t[1]-A,k=t[2]-M;for(let z=i,G=3*i;z<r;++z){let B=b*s[G++],W=y[B++],q=y[B++],X=y[B];B=b*s[G++];let oe=y[B++],de=y[B++],he=y[B];B=b*s[G++];let fe=y[B++],me=y[B++],ge=y[B];L(l)&&([W,q,X]=l.applyToVertex(W,q,X,z),[oe,de,he]=l.applyToVertex(oe,de,he,z),[fe,me,ge]=l.applyToVertex(fe,me,ge,z));const Ce=oe-W,Ae=de-q,Pe=he-X,De=fe-W,ne=me-q,pe=ge-X,ye=$*pe-ne*k,we=k*De-pe*P,Ee=P*ne-De*$,Ie=Ce*ye+Ae*we+Pe*Ee;if(Math.abs(Ie)<=Number.EPSILON)continue;const xe=x-W,$e=A-q,et=M-X,ct=xe*ye+$e*we+et*Ee;if(Ie>0){if(ct<0||ct>Ie)continue}else if(ct>0||ct<Ie)continue;const Mt=$e*Pe-Ae*et,at=et*Ce-Pe*xe,nt=xe*Ae-Ce*$e,dt=P*Mt+$*at+k*nt;if(Ie>0){if(dt<0||ct+dt>Ie)continue}else if(dt>0||ct+dt<Ie)continue;const xt=(De*Mt+ne*at+pe*nt)/Ie;xt>=0&&p(xt,c4(Ce,Ae,Pe,De,ne,pe,$2e),z,!1)}}function gtt(e,t,i,r,s,n,a,l,p){const y=n.data,b=n.stride||n.size,x=e[0],A=e[1],M=e[2],P=t[0]-x,$=t[1]-A,k=t[2]-M;for(let z=i;z<r;++z){const G=a[z];let B=3*G,W=b*s[B++],q=y[W++],X=y[W++],oe=y[W];W=b*s[B++];let de=y[W++],he=y[W++],fe=y[W];W=b*s[B];let me=y[W++],ge=y[W++],Ce=y[W];L(l)&&([q,X,oe]=l.applyToVertex(q,X,oe,z),[de,he,fe]=l.applyToVertex(de,he,fe,z),[me,ge,Ce]=l.applyToVertex(me,ge,Ce,z));const Ae=de-q,Pe=he-X,De=fe-oe,ne=me-q,pe=ge-X,ye=Ce-oe,we=$*ye-pe*k,Ee=k*ne-ye*P,Ie=P*pe-ne*$,xe=Ae*we+Pe*Ee+De*Ie;if(Math.abs(xe)<=Number.EPSILON)continue;const $e=x-q,et=A-X,ct=M-oe,Mt=$e*we+et*Ee+ct*Ie;if(xe>0){if(Mt<0||Mt>xe)continue}else if(Mt>0||Mt<xe)continue;const at=et*De-Pe*ct,nt=ct*Ae-De*$e,dt=$e*Pe-Ae*et,xt=P*at+$*nt+k*dt;if(xe>0){if(xt<0||Mt+xt>xe)continue}else if(xt>0||Mt+xt<xe)continue;const wr=(ne*at+pe*nt+ye*dt)/xe;wr>=0&&p(wr,c4(Ae,Pe,De,ne,pe,ye,$2e),G,!1)}}const moe=Q(),goe=Q();function c4(e,t,i,r,s,n,a){return ze(moe,e,t,i),ze(goe,r,s,n),si(a,moe,goe),ot(a,a),a}function D2e(e,t,i){return ze(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function VJ(e,t,i,r){return GJ(e,t,i,r,1/0)}function GJ(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],a=(e[3]+r-t[0])*i[0];let l=Math.min(n,a),p=Math.max(n,a);const y=(e[1]-r-t[1])*i[1],b=(e[4]+r-t[1])*i[1];if(p=Math.min(p,Math.max(y,b)),p<0||(l=Math.max(l,Math.min(y,b)),l>p))return!1;const x=(e[2]-r-t[2])*i[2],A=(e[5]+r-t[2])*i[2];return p=Math.min(p,Math.max(x,A)),!(p<0)&&(l=Math.max(l,Math.min(x,A)),!(l>p)&&l<s)}function L2e(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;s&&(n=htt(n,r,t,s));const a=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Ot(a*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function eO(e,t,i){if(!e)return;const r=e.parameters,s=e.paddingPixelsOverride;t.setUniform4f(i,r.divisor,r.offset,r.minPixelSize,s)}function N2e(e,t){const i=t?N2e(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=_tt(s)),s==null&&r in i||(i[r]=s)}return i}function ytt(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(i=!0,Array.isArray(s)?e[r]=s.slice():e[r]=s)}return i}function vtt(e,t,i,r,s,n){if(!t.options.selectionMode)return;const a=e.vertexAttributes.get(Y.POSITION).data,l=e.vertexAttributes.get(Y.SIZE),p=l&&l.data[0],y=r[0],b=r[1],x=((p+s)/2+4)*e.screenToWorldRatio;let A=Number.MAX_VALUE,M=0;for(let P=0;P<a.length-5;P+=3){const $=a[P],k=a[P+1],z=y-$,G=b-k,B=a[P+3]-$,W=a[P+4]-k,q=Ot((B*z+W*G)/(B*B+W*W),0,1),X=B*q-z,oe=W*q-G,de=X*X+oe*oe;de<A&&(A=de,M=P/3)}A<x*x&&n(i.dist,i.normal,M,!1)}function _tt(e){const t=[];return e.forEach(i=>t.push(i)),t}const vH={multiply:1,ignore:2,replace:3,tint:4},btt=1e3;function jJ(e){e.vertex.code.add(V`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(V`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(V`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(V`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(V`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(V`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(V`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function wtt(e,t){if(t.screenSizePerspective){eO(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;eO(i,e,"screenSizePerspectiveAlignment")}}var Xc;function F2e(e,t){const i=e;i.include(jJ),i.attributes.add(Y.POSITION,"vec3"),i.attributes.add(Y.NORMAL,"vec3"),i.attributes.add(Y.AUXPOS1,"vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("cameraPosition","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("renderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(V`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.vertex.code.add(V`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||i.vertex.code.add(V`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),i.vertex.code.add(V`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||t.screenCenterOffsetUnitsEnabled===Xc.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?V`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Xc.Screen?V`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Xc.Screen?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Xc.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(V`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function k2e(e,t){e.setUniform1f("renderTransparentlyOccludedHUD",t.renderTransparentlyOccludedHUD===Gu.OCCLUDED?1:t.renderTransparentlyOccludedHUD===Gu.NOTOCCLUDED?0:.75)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Xc||(Xc={}));class Xg{constructor(t){this._material=t.material,this._techniqueRep=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRep.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(t,this._material.getTechniqueConfig(r,i),this._technique),this._technique}ensureResources(t){return Gl.LOADED}}class HJ extends Xg{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=es(this._texture),this._textureNormal=es(this._textureNormal),this._textureEmissive=es(this._textureEmissive),this._textureOcclusion=es(this._textureOcclusion),this._textureMetallicRoughness=es(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Gl.LOADED:Gl.LOADING}updateTexture(t){(J(this._texture)||t!==this._texture.id)&&(this._texture=es(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}bindTextures(t){L(this._texture)&&t.bindTexture(this._texture.glTexture,"tex"),L(this._textureNormal)&&t.bindTexture(this._textureNormal.glTexture,"normalTexture"),L(this._textureEmissive)&&t.bindTexture(this._textureEmissive.glTexture,"texEmission"),L(this._textureOcclusion)&&t.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),L(this._textureMetallicRoughness)&&t.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(t){const i=L(this._texture)?this._texture.glTexture:null;L(i)&&i.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",i.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(t,i){if(J(t))return void i(null);const r=this._textureRepository.acquire(t);if(au(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return es(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class Wp extends s4{constructor(t,i){super(),this.type=Vp.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=mr,this._parameters=N2e(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t){ytt(this._parameters,t)&&(this.validateParameters(this._parameters),this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){L(this.repository)&&this.repository.materialChanged(this)}}var qs;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(qs||(qs={}));const Sd={renderOccluded:qs.Occlude};function xtt(e,t,i,r,s=1){const n=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(r*=a,s===1)for(let p=0;p<l;++p)n[r]=t[e[p]],r+=a;else for(let p=0;p<l;++p){const y=t[e[p]];for(let b=0;b<s;b++)n[r]=y,r+=a}}function Ttt(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,a=e.length;r*=n;for(let l=0;l<a;++l){const p=2*e[l];s[r]=t[p],s[r+1]=t[p+1],r+=n}}function U2e(e,t,i,r,s){const n=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(r*=a,s==null||s===1)for(let p=0;p<l;++p){const y=3*e[p];n[r]=t[y],n[r+1]=t[y+1],n[r+2]=t[y+2],r+=a}else for(let p=0;p<l;++p){const y=3*e[p];for(let b=0;b<s;++b)n[r]=t[y],n[r+1]=t[y+1],n[r+2]=t[y+2],r+=a}}function HS(e,t,i,r,s=1){const n=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(r*=a,s===1)for(let p=0;p<l;++p){const y=4*e[p];n[r]=t[y],n[r+1]=t[y+1],n[r+2]=t[y+2],n[r+3]=t[y+3],r+=a}else for(let p=0;p<l;++p){const y=4*e[p];for(let b=0;b<s;++b)n[r]=t[y],n[r+1]=t[y+1],n[r+2]=t[y+2],n[r+3]=t[y+3],r+=a}}function h4(e,t,i,r,s,n=1){if(!i)return void U2e(e,t,r,s,n);const a=r.typedBuffer,l=r.typedBufferStride,p=e.length,y=i[0],b=i[1],x=i[2],A=i[4],M=i[5],P=i[6],$=i[8],k=i[9],z=i[10],G=i[12],B=i[13],W=i[14];if(s*=l,n===1)for(let q=0;q<p;++q){const X=3*e[q],oe=t[X],de=t[X+1],he=t[X+2];a[s]=y*oe+A*de+$*he+G,a[s+1]=b*oe+M*de+k*he+B,a[s+2]=x*oe+P*de+z*he+W,s+=l}else for(let q=0;q<p;++q){const X=3*e[q],oe=t[X],de=t[X+1],he=t[X+2],fe=y*oe+A*de+$*he+G,me=b*oe+M*de+k*he+B,ge=x*oe+P*de+z*he+W;for(let Ce=0;Ce<n;++Ce)a[s]=fe,a[s+1]=me,a[s+2]=ge,s+=l}}function qJ(e,t,i,r,s,n=1){if(!i)return void U2e(e,t,r,s,n);const a=i,l=r.typedBuffer,p=r.typedBufferStride,y=e.length,b=a[0],x=a[1],A=a[2],M=a[4],P=a[5],$=a[6],k=a[8],z=a[9],G=a[10],B=!yX(a),W=1e-6,q=1-W;if(s*=p,n===1)for(let X=0;X<y;++X){const oe=3*e[X],de=t[oe],he=t[oe+1],fe=t[oe+2];let me=b*de+M*he+k*fe,ge=x*de+P*he+z*fe,Ce=A*de+$*he+G*fe;if(B){const Ae=me*me+ge*ge+Ce*Ce;if(Ae<q&&Ae>W){const Pe=1/Math.sqrt(Ae);me*=Pe,ge*=Pe,Ce*=Pe}}l[s+0]=me,l[s+1]=ge,l[s+2]=Ce,s+=p}else for(let X=0;X<y;++X){const oe=3*e[X],de=t[oe],he=t[oe+1],fe=t[oe+2];let me=b*de+M*he+k*fe,ge=x*de+P*he+z*fe,Ce=A*de+$*he+G*fe;if(B){const Ae=me*me+ge*ge+Ce*Ce;if(Ae<q&&Ae>W){const Pe=1/Math.sqrt(Ae);me*=Pe,ge*=Pe,Ce*=Pe}}for(let Ae=0;Ae<n;++Ae)l[s+0]=me,l[s+1]=ge,l[s+2]=Ce,s+=p}}function Stt(e,t,i,r,s,n=1){if(!i)return void HS(e,t,r,s,n);const a=i,l=r.typedBuffer,p=r.typedBufferStride,y=e.length,b=a[0],x=a[1],A=a[2],M=a[4],P=a[5],$=a[6],k=a[8],z=a[9],G=a[10],B=!yX(a),W=1e-6,q=1-W;if(s*=p,n===1)for(let X=0;X<y;++X){const oe=4*e[X],de=t[oe],he=t[oe+1],fe=t[oe+2],me=t[oe+3];let ge=b*de+M*he+k*fe,Ce=x*de+P*he+z*fe,Ae=A*de+$*he+G*fe;if(B){const Pe=ge*ge+Ce*Ce+Ae*Ae;if(Pe<q&&Pe>W){const De=1/Math.sqrt(Pe);ge*=De,Ce*=De,Ae*=De}}l[s+0]=ge,l[s+1]=Ce,l[s+2]=Ae,l[s+3]=me,s+=p}else for(let X=0;X<y;++X){const oe=4*e[X],de=t[oe],he=t[oe+1],fe=t[oe+2],me=t[oe+3];let ge=b*de+M*he+k*fe,Ce=x*de+P*he+z*fe,Ae=A*de+$*he+G*fe;if(B){const Pe=ge*ge+Ce*Ce+Ae*Ae;if(Pe<q&&Pe>W){const De=1/Math.sqrt(Pe);ge*=De,Ce*=De,Ae*=De}}for(let Pe=0;Pe<n;++Pe)l[s+0]=ge,l[s+1]=Ce,l[s+2]=Ae,l[s+3]=me,s+=p}}function DD(e,t,i,r,s,n=1){const a=r.typedBuffer,l=r.typedBufferStride,p=e.length;if(s*=l,n===1){if(i===4)for(let y=0;y<p;++y){const b=4*e[y];a[s]=t[b],a[s+1]=t[b+1],a[s+2]=t[b+2],a[s+3]=t[b+3],s+=l}else if(i===3)for(let y=0;y<p;++y){const b=3*e[y];a[s]=t[b],a[s+1]=t[b+1],a[s+2]=t[b+2],a[s+3]=255,s+=l}}else if(i===4)for(let y=0;y<p;++y){const b=4*e[y];for(let x=0;x<n;++x)a[s]=t[b],a[s+1]=t[b+1],a[s+2]=t[b+2],a[s+3]=t[b+3],s+=l}else if(i===3)for(let y=0;y<p;++y){const b=3*e[y];for(let x=0;x<n;++x)a[s]=t[b],a[s+1]=t[b+1],a[s+2]=t[b+2],a[s+3]=255,s+=l}}function QN(e,t,i,r,s,n){for(const a of t.fieldNames){const l=e.vertexAttributes.get(a),p=e.indices.get(a);if(l&&p)switch(a){case Y.POSITION:{Kt(l.size===3);const y=s.getField(a,Cr);y&&h4(p,l.data,i,y,n);break}case Y.NORMAL:{Kt(l.size===3);const y=s.getField(a,Cr);y&&qJ(p,l.data,r,y,n);break}case Y.UV0:{Kt(l.size===2);const y=s.getField(a,vd);y&&Ttt(p,l.data,y,n);break}case Y.COLOR:{Kt(l.size===3||l.size===4);const y=s.getField(a,lc);y&&DD(p,l.data,l.size,y,n);break}case Y.SYMBOLCOLOR:{Kt(l.size===3||l.size===4);const y=s.getField(a,lc);y&&DD(p,l.data,l.size,y,n);break}case Y.TANGENT:{Kt(l.size===4);const y=s.getField(a,So);y&&Stt(p,l.data,r,y,n);break}}}}function LD(e,t,i=0){const r=Ot(e,0,Ctt);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*Mtt(r*Ett[s]))}function WJ(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*Att[r];return i}const Ett=[1,256,65536,16777216],Att=[1/256,1/65536,1/16777216,1/4294967296],Ctt=WJ(new Uint8ClampedArray([255,255,255,255]));function Mtt(e){return e-Math.floor(e)}function Rtt(){if(J(Rk)){const e=t=>hr(`esri/libs/basisu/${t}`);Rk=import("./basis_transcoder.89537858.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return Rk}let Rk;var Zb;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(Zb||(Zb={}));let Rp=null,uP=null;async function z2e(){return J(uP)&&(uP=Rtt(),Rp=await uP),uP}function Ott(e,t){if(J(Rp))return e.byteLength;const i=new Rp.BasisFile(new Uint8Array(e)),r=V2e(i)?B2e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function Ptt(e,t){if(J(Rp))return e.byteLength;const i=new Rp.KTX2File(new Uint8Array(e)),r=G2e(i)?B2e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function B2e(e,t,i,r,s){const n=L_e(t?Hs.COMPRESSED_RGBA8_ETC2_EAC:Hs.COMPRESSED_RGB8_ETC2),a=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*a)}function V2e(e){return e.getNumImages()>=1&&!e.isUASTC()}function G2e(e){return e.getFaces()>=1&&e.isETC1S()}async function Itt(e,t,i){J(Rp)&&(Rp=await z2e());const r=new Rp.BasisFile(new Uint8Array(i));if(!V2e(r))return null;r.startTranscoding();const s=j2e(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,a)=>r.getImageTranscodedSizeInBytes(0,n,a),(n,a,l)=>r.transcodeImage(l,0,n,a,0,0));return r.close(),r.delete(),s}async function $tt(e,t,i){J(Rp)&&(Rp=await z2e());const r=new Rp.KTX2File(new Uint8Array(i));if(!G2e(r))return null;r.startTranscoding();const s=j2e(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,a)=>r.getImageTranscodedSizeInBytes(n,0,0,a),(n,a,l)=>r.transcodeImage(l,n,0,0,a,0,-1,-1));return r.close(),r.delete(),s}function j2e(e,t,i,r,s,n,a,l){const{compressedTextureETC:p,compressedTextureS3TC:y}=e.capabilities,[b,x]=p?r?[Zb.ETC2_RGBA,Hs.COMPRESSED_RGBA8_ETC2_EAC]:[Zb.ETC1_RGB,Hs.COMPRESSED_RGB8_ETC2]:y?r?[Zb.BC3_RGBA,Hs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Zb.BC1_RGB,Hs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Zb.RGBA32,_t.RGBA],A=t.hasMipmap?i:Math.min(1,i),M=[];for(let z=0;z<A;z++)M.push(new Uint8Array(a(z,b))),l(z,b,M[z]);const P=M.length>1,$=P?Pt.LINEAR_MIPMAP_LINEAR:Pt.LINEAR,k=qe(ie({},t),{samplingMode:$,hasMipmap:P,internalFormat:x,width:s,height:n});return new Vt(e,k,{type:"compressed",levels:M})}const pA=Ge.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Dtt=542327876,Ltt=131072,Ntt=4;function XJ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function Ftt(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const ktt=XJ("DXT1"),Utt=XJ("DXT3"),ztt=XJ("DXT5"),Btt=31,Vtt=0,Gtt=1,jtt=2,Htt=3,qtt=4,Wtt=7,Xtt=20,Ytt=21;function Jtt(e,t,i){const{textureData:r,internalFormat:s,width:n,height:a}=Ztt(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?Pt.LINEAR_MIPMAP_LINEAR:Pt.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=a,new Vt(e,t,r)}function Ztt(e,t){const i=new Int32Array(e,0,Btt);if(i[Vtt]!==Dtt)return pA.error("Invalid magic number in DDS header"),null;if(!(i[Xtt]&Ntt))return pA.error("Unsupported format, must contain a FourCC code"),null;const r=i[Ytt];let s,n;switch(r){case ktt:s=8,n=Hs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Utt:s=16,n=Hs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ztt:s=16,n=Hs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return pA.error("Unsupported FourCC code:",Ftt(r)),null}let a=1,l=i[qtt],p=i[Htt];(3&l)==0&&(3&p)==0||(pA.warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,p=p+3&-4);const y=l,b=p;let x,A;i[jtt]&Ltt&&t!==!1&&(a=Math.max(1,i[Wtt])),a===1||YT(l)&&YT(p)||(pA.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let M=i[Gtt]+4;const P=[];for(let $=0;$<a;++$)A=(l+3>>2)*(p+3>>2)*s,x=new Uint8Array(e,M,A),P.push(x),M+=A,l=Math.max(1,l>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:P},internalFormat:n,width:y,height:b}}class Sn extends s4{constructor(t,i){super(),this.data=t,this.type=Vp.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new ps,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:ei.REPEAT,t:ei.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||hv.STRETCH,this.estimatedTexMemRequired=Sn._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;J(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){eS(t.src)||t.preload==="auto"&&t.crossOrigin||(t.preload="auto",t.crossOrigin="anonymous",t.src=t.src)}_startPreloadImageElement(t){x0(t.src)||eS(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(J(t))return 0;if(DE(t)||Ub(t))return i.encoding===Sn.KTX2_ENCODING?Ptt(t,i.mipmap):i.encoding===Sn.BASIS_ENCODING?Ott(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Sn._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?Pt.LINEAR_MIPMAP_LINEAR:Pt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(L(this._glTexture))return this._glTexture;if(L(this._loadingPromise))return this._loadingPromise;const r=this.data;return J(r)?(this._glTexture=new Vt(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(DE(r)||Ub(r))&&this.params.encoding===Sn.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(DE(r)||Ub(r))&&this.params.encoding===Sn.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(DE(r)||Ub(r))&&this.params.encoding===Sn.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):Ub(r)?this._loadFromPixelData(t,r):DE(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||J(this._glTexture)||this.data.readyState<FM.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(L(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:a}=this._powerOfTwoStretchInfo;a.setData(this.data),this._drawStretchedTexture(t,i,s,n,a,this._glTexture)}else{const{width:s,height:n}=this.data,{width:a,height:l}=this._glTexture.descriptor;s!==a||n!==l?this._glTexture.updateData(0,0,0,Math.min(s,a),Math.min(n,l),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=Jtt(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>$tt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>Itt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){Kt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?_t.LUMINANCE:this.params.components===3?_t.RGB:_t.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new Vt(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await yd(r,{signal:s});return Gi(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await Ape(r,r.src,!1,s);return Gi(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=FM.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,a)=>{const l=()=>{r.removeEventListener("loadeddata",p),r.removeEventListener("error",y),_o(b)},p=()=>{r.readyState>=FM.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(t,r,i)))},y=x=>{l(),a(x||new Se("Failed to load video"))};r.addEventListener("loadeddata",p),r.addEventListener("error",y);const b=ka(s,()=>y(rr()))}))}_loadFromImage(t,i,r){const s=Sn._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?_t.RGB:_t.RGBA,!this._requiresPowerOfTwo(t,n)||YT(s.width)&&YT(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new Vt(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=ei.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!yo(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:a,height:l}=r,p=XT(a),y=XT(l);let b;switch(s.width=p,s.height=y,this.params.powerOfTwoResizeMode){case hv.PAD:s.textureCoordinateScaleFactor=[a/p,l/y],b=new Vt(t,s),b.updateData(0,0,0,a,l,i);break;case hv.STRETCH:case null:case void 0:b=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&b.generateMipmap(),b}_stretchToPowerOfTwo(t,i,r,s){const n=new Vt(t,r),a=new Hr(t,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},n),l=new Vt(t,{target:Yt.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),p=Ga(t),y=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,a,p,l,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:p,sourceTexture:l,framebuffer:a}:(p.dispose(!0),l.dispose(),a.detachColorTexture(),a.dispose()),t.bindFramebuffer(y),n}_drawStretchedTexture(t,i,r,s,n,a){t.bindFramebuffer(r);const l=t.getViewport();t.setViewport(0,0,a.descriptor.width,a.descriptor.height);const p=t.useTechnique(i);p.setUniform4f("uColor",1,1,1,1),p.bindTexture(n,"tex"),t.bindVAO(s),t.drawArrays(mi.TRIANGLE_STRIP,0,zo(s,"geometry")),t.bindFramebuffer(null),t.setViewport(l.x,l.y,l.width,l.height)}unload(){if(L(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(L(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),L(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var FM;Sn.DDS_ENCODING="image/vnd-ms.dds",Sn.KTX2_ENCODING="image/ktx2",Sn.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(FM||(FM={}));const tO=128,YJ=.5;function H2e(e,t=tO,i=t*YJ,r=0){const s=Ktt(e,t,i,r);return new Sn(s,{mipmap:!1,wrap:{s:ei.CLAMP_TO_EDGE,t:ei.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Ktt(e,t=tO,i=t*YJ,r=0){switch(e){case"circle":default:return Qtt(t,i);case"square":return eit(t,i);case"cross":return iit(t,i,r);case"x":return rit(t,i,r);case"kite":return tit(t,i);case"triangle":return sit(t,i);case"arrow":return nit(t,i)}}function Qtt(e,t){const i=e/2-.5;return u4(e,X2e(i,i,t/2))}function eit(e,t){return q2e(e,t,!1)}function tit(e,t){return q2e(e,t,!0)}function iit(e,t,i=0){return W2e(e,t,!1,i)}function rit(e,t,i=0){return W2e(e,t,!0,i)}function sit(e,t){return u4(e,Y2e(e/2,t,t/2))}function nit(e,t){const i=t,r=t/2,s=e/2,n=.8*i,a=X2e(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),l=Y2e(s,i,r);return u4(e,(p,y)=>Math.max(l(p,y),-a(p,y)))}function q2e(e,t,i){return i&&(t/=Math.SQRT2),u4(e,(r,s)=>{let n=r-.5*e+.25,a=.5*e-s-.75;if(i){const l=(n+a)/Math.SQRT2;a=(a-n)/Math.SQRT2,n=l}return Math.max(Math.abs(n),Math.abs(a))-.5*t})}function W2e(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return u4(e,(n,a)=>{let l,p=n-.5*e,y=.5*e-a-1;if(i){const b=(p+y)/Math.SQRT2;y=(y-p)/Math.SQRT2,p=b}return p=Math.abs(p),y=Math.abs(y),l=p>y?p>s?Math.sqrt((p-s)*(p-s)+y*y):y:y>s?Math.sqrt(p*p+(y-s)*(y-s)):p,l-=r/2,l})}function X2e(e,t,i){return(r,s)=>{const n=r-e,a=s-t;return Math.sqrt(n*n+a*a)-i}}function Y2e(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const a=Math.abs(s-e)-i,l=n-e+t/2+.75,p=(t*a+i*l)/r,y=-l;return Math.max(p,y)}}function u4(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let a=t(s,r);a=a/e+.5,LD(a,i,4*n)}return i}function Ws(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const i=V`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=V`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.sliceHighlightDisabled?V`#define highlightSlice(_color_, _pos_) (_color_)`:V`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(s)}else{const i=V`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function kw(e,t,i){Nv(e,t,i.slicePlane,{origin:i.origin})}function Nv(e,t,i,r){if(t.slicePlaneEnabled)if(L(i)){if(ke(q0,i.origin),ke(f1,i.basis1),ke(m1,i.basis2),L(r)&&L(r.origin)&&We(q0,i.origin,r.origin),L(r)&&L(r.view)){const s=L(r.origin)?yl(oit,r.view,r.origin):r.view;Xe(f1,f1,q0),Xe(m1,m1,q0),Ct(q0,q0,s),Ct(f1,f1,s),Ct(m1,m1,s),We(f1,f1,q0),We(m1,m1,q0)}e.setUniform3fv("slicePlaneOrigin",q0),e.setUniform3fv("slicePlaneBasis1",f1),e.setUniform3fv("slicePlaneBasis2",m1)}else e.setUniform3fv("slicePlaneBasis1",Jc),e.setUniform3fv("slicePlaneBasis2",Jc),e.setUniform3fv("slicePlaneOrigin",Jc)}const q0=Q(),f1=Q(),m1=Q(),oit=lt();function J2e(e){e.include(Yn),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("nearFar","vec2"),e.code.add(V`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function Z2e(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}function ait(e,t){t.multipassGeometryEnabled&&e.vertex.include(J2e),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(V`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?V`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(Yn),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(qp),e.fragment.code.add(V`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?V`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const lit=_r(1,1,0,1),K2e=_r(1,0,1,1);function Yg(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",lit).add("unoccludedHighlightFlag","vec4",K2e),e.fragment.code.add(V`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function D0(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}function OT(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add(Y.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(V`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(V`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?V`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(V`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(V`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?V`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(V`vec4 vvColor() { return vec4(1.0); }`)}function JJ(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function Q2e(e,t){JJ(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function cit(e,t){JJ(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}const ND=.1,fa=.001;function fg(e,t){const i=e.fragment;switch(t.alphaDiscardMode){case Pr.Blend:i.code.add(V`
        #define discardOrAdjustAlpha(color) { if (color.a < ${V.float(fa)}) { discard; } }
      `);break;case Pr.Opaque:i.code.add(V`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Pr.Mask:i.uniforms.add("textureAlphaCutoff","float"),i.code.add(V`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Pr.MaskBlend:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(V`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function hit(e){const t=new Ir,i=e.signedDistanceFieldEnabled;if(t.include(gJ),t.include(F2e,e),t.include(Ws,e),e.output===Te.Occlusion)return t.include(ait,e),t;t.include(jJ),t.fragment.include(qp),t.fragment.include(P0),t.include(OT,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(Y.UV0,"vec2"),t.attributes.add(Y.COLOR,"vec4"),t.attributes.add(Y.SIZE,"vec2"),t.attributes.add(Y.AUXPOS2,"vec4"),t.vertex.code.add(V`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?V`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:V`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=V`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,s=e.pixelSnappingEnabled?i?V`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:V`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:V`posProj += quadOffset;`;t.vertex.code.add(V`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${V.float(fa)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${V.float(fa)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${s}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?V`} else { vtc = vec2(0.0);
        ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const n=e.debugDrawLabelBorder?V`(isBorder > 0.0 ? 0.0 : ${V.float(ND)})`:V.float(ND),a=V`
    ${e.debugDrawLabelBorder?V`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?V`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${V.float(tO)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${n} ||
          fillPixelColor.a + outlinePixelColor.a < ${V.float(fa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${n}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:V`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${n}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?V`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===Te.Alpha&&t.fragment.code.add(V`
      void main() {
        ${a}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===Te.Color&&t.fragment.code.add(V`
    void main() {
      ${a}
      ${e.frontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===Te.Highlight&&(t.include(Yg),t.fragment.code.add(V`
    void main() {
      ${a}
      ${e.binaryHighlightOcclusionEnabled?V`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function ewe(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",E2),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",FD(t))}function FD(e,t=dit){return e.textureIsSignedDistanceField?uit(e.anchorPos,e.distanceFieldBoundingBox,t):Pn(t,e.anchorPos),t}function uit(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}const dit=St(),pit=Object.freeze({__proto__:null,build:hit,bindHUDMaterialUniforms:ewe,calculateAnchorPosForRendering:FD});function twe(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(jJ),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(V`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${t.viewingMode===vt.Global?V`vec3 worldNormal = normalize(worldPos + localOrigin);`:V`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?V`
          float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:V`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(V`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function ZJ(e,t,i){if(!t.verticalOffset)return;const r=fit(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),s=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*s,r.perDistance,r.minWorldLength,r.maxWorldLength)}function fit(e,t,i,r=mit){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}const mit={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};function nu(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(V`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function Jg(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}const Qc=ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),git=su(ht.ONE,ht.ONE),iwe=su(ht.ZERO,ht.ONE_MINUS_SRC_ALPHA);function Zg(e){return e===Qt.FrontFace?null:e===Qt.Alpha?iwe:git}function e8(e){return e===Qt.FrontFace?ac:null}const t8=5e5,i8={factor:-1,units:-2};function r8(e){return e?i8:null}function Jv(e,t=kr.LESS){return e===Qt.NONE||e===Qt.FrontFace?t:kr.LEQUAL}class d4 extends Xr{initializeProgram(t){const i=d4.shader.get(),r=this.configuration,s=i.build({output:r.output,frontFacePass:r.transparencyPassType===Qt.FrontFace,viewingMode:t.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawLabelBorder:r.debugDrawLabelBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,pixelSnappingEnabled:r.pixelSnappingEnabled,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1,isDraped:r.isDraped,multipassGeometryEnabled:r.multipassGeometryEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,mr)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),ZJ(this.program,t,i),wtt(this.program,t),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio||1),lbe(this.program,i),this.configuration.output===Te.Occlusion?(this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Z2e(this.program,i),Jg(this.program,i)):(k2e(this.program,i),ewe(this.program,t,i.camera.pixelRatio||1),JJ(this.program,t),this.configuration.occlusionTestEnabled&&this.program.bindTexture(i.hudVisibilityTexture,"hudVisibilityTexture")),this.configuration.output===Te.Highlight&&D0(this.program,i)}bindDraw(t){I0(this.program,t),Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),kw(this.program,this.configuration,t),this.program.rebindTextures()}_setPipelineState(t){const i=this.configuration,r=t===Qt.NONE,s=t===Qt.FrontFace,n=kr.LEQUAL,a=this.configuration.polygonOffsetEnabled&&yit,l=(r||s)&&i.output!==Te.Highlight?(i.depthEnabled||i.output===Te.Occlusion)&&ac:null;return Ti({blending:i.output===Te.Color||i.output===Te.Alpha||i.output===Te.Highlight?r?vit:Zg(t):null,depthTest:{func:n},depthWrite:l,colorWrite:Ii,polygonOffset:a})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===Te.Occlusion?mi.POINTS:mi.TRIANGLES}}d4.shader=new Ur(pit,()=>import("./HUDMaterial.glsl.fdd2eecf.js"));const yit={factor:0,units:-4},vit=su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA);class co extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=Xc.World,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=Qt.NONE,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],co.prototype,"output",void 0),_([Oe()],co.prototype,"occlusionTestEnabled",void 0),_([Oe()],co.prototype,"sdf",void 0),_([Oe()],co.prototype,"vvSize",void 0),_([Oe()],co.prototype,"vvColor",void 0),_([Oe()],co.prototype,"verticalOffset",void 0),_([Oe()],co.prototype,"screenSizePerspective",void 0),_([Oe({count:Xc.COUNT})],co.prototype,"screenCenterOffsetUnitsEnabled",void 0),_([Oe()],co.prototype,"debugDrawLabelBorder",void 0),_([Oe()],co.prototype,"binaryHighlightOcclusion",void 0),_([Oe()],co.prototype,"slicePlaneEnabled",void 0),_([Oe()],co.prototype,"polygonOffsetEnabled",void 0),_([Oe()],co.prototype,"depthEnabled",void 0),_([Oe({count:Qt.COUNT})],co.prototype,"transparencyPassType",void 0),_([Oe()],co.prototype,"pixelSnappingEnabled",void 0),_([Oe()],co.prototype,"isDraped",void 0),_([Oe()],co.prototype,"multipassGeometryEnabled",void 0),_([Oe()],co.prototype,"multipassTerrainEnabled",void 0),_([Oe()],co.prototype,"cullAboveGround",void 0);class qS extends Wp{constructor(t){super(t,Mit),this.techniqueConfig=new co}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Xc.Screen:Xc.World,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===Te.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===Te.Highlight&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=i.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,a,l,p,y){L(y)?this._intersectDrapedHudGeometry(t,a,l,p,y):this._intersectHudGeometry(t,i,r,s,l,p)}_intersectDrapedHudGeometry(t,i,r,s,n){const a=t.vertexAttributes.get(Y.POSITION),l=t.vertexAttributes.get(Y.SIZE),p=this.parameters,y=FD(p);let b=1,x=1;if(L(s)){const M=s(_oe);b=M[0],x=M[5]}b*=t.screenToWorldRatio,x*=t.screenToWorldRatio;const A=Ait*t.screenToWorldRatio;for(let M=0;M<a.data.length/a.size;M++){const P=M*a.size,$=a.data[P],k=a.data[P+1],z=M*l.size;let G;g1[0]=l.data[z]*b,g1[1]=l.data[z+1]*x,p.textureIsSignedDistanceField&&(G=p.outlineSize*t.screenToWorldRatio/2),yoe(i,$,k,g1,A,G,p,y)&&r(n.dist,n.normal,-1,!0)}}_intersectHudGeometry(t,i,r,s,n,a){if(!s.options.selectionMode||!s.options.hud||n4(i))return;const l=this.parameters;let p=1,y=1;if(md(Pk,r),L(a)){const G=a(_oe);p=G[0],y=G[5],wit(Pk)}const b=t.vertexAttributes.get(Y.POSITION),x=t.vertexAttributes.get(Y.SIZE),A=t.vertexAttributes.get(Y.NORMAL),M=t.vertexAttributes.get(Y.AUXPOS1);Kt(b.size>=3);const P=s.point,$=s.camera,k=FD(l);p*=$.pixelRatio,y*=$.pixelRatio;const z=this.parameters.centerOffsetUnits==="screen";for(let G=0;G<b.data.length/b.size;G++){const B=G*b.size;ze(Ha,b.data[B],b.data[B+1],b.data[B+2]),Ct(Ha,Ha,r);const W=G*x.size;g1[0]=x.data[W]*p,g1[1]=x.data[W+1]*y,Ct(Ha,Ha,$.viewMatrix);const q=G*M.size;if(ze(Pd,M.data[q+0],M.data[q+1],M.data[q+2]),!z&&(Ha[0]+=Pd[0],Ha[1]+=Pd[1],Pd[2]!==0)){const oe=Pd[2];ot(Pd,Ha),We(Ha,Ha,Ue(Pd,Pd,oe))}const X=G*A.size;if(ze(fA,A.data[X],A.data[X+1],A.data[X+2]),this._normalAndViewAngle(fA,Pk,$,Ik),this._applyVerticalOffsetTransformationView(Ha,Ik,$,Ok),$.applyProjection(Ha,g_),g_[0]>-1){let oe=Math.floor(g_[0])+this.parameters.screenOffset[0],de=Math.floor(g_[1])+this.parameters.screenOffset[1];z&&(oe+=Pd[0],Pd[1]!==0&&(de+=BJ(Pd[1],Ok.factorAlignment))),O2e(g1,Ok.factor,g1);const he=Eit*$.pixelRatio;let fe;if(l.textureIsSignedDistanceField&&(fe=l.outlineSize*$.pixelRatio/2),yoe(P,oe,de,g1,he,fe,l,k)){const me=s.ray;if(Ct(voe,Ha,Ms(Sit,$.viewMatrix)),g_[0]=P[0],g_[1]=P[1],$.unprojectFromRenderScreen(g_,Ha)){const ge=Q();ke(ge,me.direction);const Ce=1/yt(ge);Ue(ge,ge,Ce),n(Er(me.origin,Ha)*Ce,ge,-1,!0,1,voe)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(Y.POSITION),n=t.indices.get(Y.POSITION);return pbe(s,n,i)}createBufferWriter(){return new Oit(this)}_normalAndViewAngle(t,i,r,s){return ftt(i)&&(i=md(Tit,i)),Gc(s.normal,t,i),Ct(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=rt(swe,Cit),s}_updateScaleInfo(t,i,r){const s=this.parameters;s.screenSizePerspective?poe(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),s.screenSizePerspectiveAlignment?poe(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,a,l){const p=this._normalAndViewAngle(i,r,n,Ik);return this._applyVerticalGroundOffsetView(t,p,n,l),this._applyVerticalOffsetTransformationView(l,p,n,a),this._applyPolygonOffsetView(l,p,s[3],n,l),this._applyCenterOffsetView(l,s,l),l}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),L(n)&&ke(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const a=s.aboveGround?1:-1;let l=Math.sign(r);l===0&&(l=a);const p=a*l;if(this.parameters.shaderPolygonOffset<=0)return ke(n,t);const y=Ot(Math.abs(i.cosAngle),.01,1),b=1-Math.sqrt(1-y*y)/y/s.viewport[2];return Ue(n,t,p>0?b:1/b),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=yt(t),a=r.aboveGround?1:-1,l=.5*r.computeRenderPixelSizeAtDist(n),p=Ue(Ha,i.normal,a*l);return Xe(s,t,p),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const y=yt(t);this._updateScaleInfo(s,y,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const a=yt(t),l=n.screenSizePerspectiveAlignment||n.screenSizePerspective,p=L2e(r,a,n.verticalOffset,i.cosAngle,l);return this._updateScaleInfo(s,a,i.cosAngle),Ue(i.normal,i.normal,p),Xe(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&ke(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ot(fA,r),Xe(r,r,Ue(fA,fA,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ke(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ke(s,t),n){const a=r.aboveGround?1:-1,l=a*Math.sign(i[3]);s[2]-=(l||a)*n}return s}requiresSlot(t){if(t===tt.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?tt.LABEL_MATERIAL:tt.HUD_MATERIAL)||r&&t===tt.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha?new _it(t):t.output===Te.Highlight?new rwe(t):null}calculateRelativeScreenBounds(t,i,r=Mi()){return bit(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class rwe extends HJ{constructor(t){super(ie(ie({},t),t.material.parameters))}updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(t)}selectProgram(t){return this.ensureTechnique(d4,t)}beginSlot(t){return this.updateParameters(t)}bind(t,i){this.bindTextures(i.program),this.bindTextureScale(i.program),i.bindPass(this._material.parameters,t)}}class _it extends rwe{_isOcclusionSlot(t){return t.slot===tt.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===Te.Color||this._output===Te.Alpha)}selectProgram(t){return this.ensureTechnique(d4,t,this._isOcclusionSlot(t)?Te.Occlusion:this._output)}bind(t,i){this._isOcclusionSlot(t)||(this.bindTextures(i.program),this.bindTextureScale(i.program)),i.bindPass(this._material.parameters,t)}}function bit(e,t,i,r=xit){return Pn(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function wit(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],l=e[6],p=e[7],y=e[8],b=1/Math.sqrt(t*t+i*i+r*r),x=1/Math.sqrt(s*s+n*n+a*a),A=1/Math.sqrt(l*l+p*p+y*y);return e[0]=t*b,e[1]=i*b,e[2]=r*b,e[3]=s*x,e[4]=n*x,e[5]=a*x,e[6]=l*A,e[7]=p*A,e[8]=y*A,e}function yoe(e,t,i,r,s,n,a,l){let p=t-s-(l[0]>0?r[0]*l[0]:0),y=p+r[0]+2*s,b=i-s-(l[1]>0?r[1]*l[1]:0),x=b+r[1]+2*s;if(a.textureIsSignedDistanceField){const A=a.distanceFieldBoundingBox;p+=r[0]*A[0],b+=r[1]*A[1],y-=r[0]*(1-A[2]),x-=r[1]*(1-A[3]),p-=n,y+=n,b-=n,x+=n}return e[0]>p&&e[0]<y&&e[1]>b&&e[1]<x}const Ok={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},xit=St(),Ha=Q(),fA=Q(),g_=ca(),swe=Q(),voe=Q(),Pk=zs(),Tit=zs(),Sit=lt(),Pd=Q(),Ik={normal:swe,cosAngle:0},_oe=lt(),Eit=1,Ait=2,g1=[0,0],Cit=$t(0,0,1),Mit=ie({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:yr(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawLabelBorder:!1,isDraped:!1},Sd),Rit=on().vec3f(Y.POSITION).vec3f(Y.NORMAL).vec2f(Y.UV0).vec4u8(Y.COLOR).vec2f(Y.SIZE).vec4f(Y.AUXPOS1).vec4f(Y.AUXPOS2);class Oit{constructor(t){this.material=t,this.vertexBufferLayout=Rit}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(Y.POSITION).length}write(t,i,r,s){h4(i.indices.get(Y.POSITION),i.vertexAttributes.get(Y.POSITION).data,t.transformation,r.position,s,6),qJ(i.indices.get(Y.NORMAL),i.vertexAttributes.get(Y.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(Y.UV0).data;let a,l,p,y;if(n==null||n.length<4){const M=this.material.parameters;a=0,l=0,p=M.texCoordScale[0],y=M.texCoordScale[1]}else a=n[0],l=n[1],p=n[2],y=n[3];p=Math.min(1.99999,p+1),y=Math.min(1.99999,y+1);const b=i.indices.get(Y.POSITION).length,x=r.uv0;let A=s;for(let M=0;M<b;++M)x.set(A,0,a),x.set(A,1,l),A+=1,x.set(A,0,p),x.set(A,1,l),A+=1,x.set(A,0,p),x.set(A,1,y),A+=1,x.set(A,0,p),x.set(A,1,y),A+=1,x.set(A,0,a),x.set(A,1,y),A+=1,x.set(A,0,a),x.set(A,1,l),A+=1}DD(i.indices.get(Y.COLOR),i.vertexAttributes.get(Y.COLOR).data,4,r.color,s,6);{const n=i.indices.get(Y.SIZE),a=i.vertexAttributes.get(Y.SIZE).data,l=n.length,p=r.size;let y=s;for(let b=0;b<l;++b){const x=a[2*n[b]],A=a[2*n[b]+1];for(let M=0;M<6;++M)p.set(y,0,x),p.set(y,1,A),y+=1}}i.indices.get(Y.AUXPOS1)&&i.vertexAttributes.get(Y.AUXPOS1)&&HS(i.indices.get(Y.AUXPOS1),i.vertexAttributes.get(Y.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(Y.AUXPOS2)&&i.vertexAttributes.get(Y.AUXPOS2)&&HS(i.indices.get(Y.AUXPOS2),i.vertexAttributes.get(Y.AUXPOS2).data,r.auxpos2,s,6)}}const ef=Q(),ox=nr(),mA=nr(),$k=Q(),Pit=lt(),Iit=qo(),Dk=ua(),$it=Q(),Dit=Mi();class Lit{constructor(){this.aabr=Mi(),this.distance=0,this.culled=!1,this.visible=!1}}class Nit{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class Fit{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class kit{}class Uit{constructor(){this.sortArray=new Ci({allocator:t=>t||new kit})}}var Oc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(Oc||(Oc={}));class nwe{constructor(){this.camera=new br,this.slicePlane=Pw(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),yE(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let nT=class extends st{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new nwe,this._state=Oc.Idle,this.graphics=new Fit,this.iterators=new Uit,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Oc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/Oc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case Oc.Idle:this._startUpdate(),e.madeProgress();case Oc.Process:if(this._state=Oc.Process,!this._processActiveGraphics(e))return;case Oc.Sort:if(this._state=Oc.Sort,!this._sortVisibleGraphics(e))return;case Oc.Deconflict:if(this._state=Oc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:rtt(this,this.graphics.visible),this._state=Oc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(J(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof qS}_startUpdate(){stt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Lit,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),zit(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=Ms(Pit,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Iit:null;let s=0;for(L(r)&&(Ct(r,Jc,this._runningViewState.camera.viewMatrix),r[3]=ir(this.view.spatialReference).radius,s=Jme(r,Jc));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const a=n.value,l=a&&a.info[this.visibilityGroup];l&&(this._collectGraphics3DGraphics(a,i,r,s),l.culled?this._removeFromVisibleGraphics(a):this._addToVisibleGraphics(a))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Fo.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const a=s.graphics3DGraphic,l=(!i||a.isVisible())&&!this._isConflicted(s);l&&this._addToBins(s),n.visible=l,this._setGraphicVisibility(s,l),ott(n,l)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=boe(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=boe(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=Bit(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Fo.GRAPHIC,Gh.DECONFLICTION))return void(n.culled=!0);const a=this.getGraphicsLayers(s);pd(n.aabr);let l=null;for(const p of a){if(!this.layerSupportsDeconfliction(p))continue;const y=p.stageObject.geometryRecords[0].material;if(J(l)){if(l=this._getProjectionInfo(p,t,jit),l.isOutsideScreen||this._isCulledBySlice(e,ef)||L(i)&&this._isCulledByHorizon(l,i,r))return void(n.culled=!0);!ur.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(l.distance*=.7)}this._expandBoundingRect(n,p,y,l)}J(l)?n.culled=!0:(n.distance=l.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],a=n.material,l=ru(s.boundingVolumeWorldSpace.bounds);Ct(ef,l,r.viewMatrix);const p=n.geometry.vertexAttributes,y=p.get(Y.NORMAL).data,b=p.get(Y.AUXPOS1).data;return a.applyShaderOffsetsView(ef,y,s.transformation,b,r,i.scaleInfo,ef),fl(ox,ef[0],ef[1],ef[2],1),ld(mA,ox,r.projectionMatrix),Ue(i.positionNDC,mA,1/mA[3]),a.applyShaderOffsetsNDC(i.positionNDC,b,r,i.positionNDC,$k),i.distanceWithoutPolygonOffset=r.depthNDCToWorld($k[2]),i.distance=$k[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),fl(mA,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),ld(ox,mA,t),OO(ox,ox,1/ox[3]),ze(i.positionView,ef[0],ef[1],ef[2]),i}_isCulledByHorizon(e,t,i){return ke(Dk.direction,e.positionView),ze(Dk.origin,0,0,0),!!qv(t,Dk,$it)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&NX(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,a=t.getScreenSize(Vit);O2e(a,s.factor,a),a[0]*=n.pixelRatio,a[1]*=n.pixelRatio;const l=M6(i.calculateRelativeScreenBounds(a,s.factorAlignment.scale,Dit),Vi(0,n.fullWidth,.5+.5*r[0]),Vi(0,n.fullHeight,.5+.5*r[1])),p=this.iconMarginFactor;if(p!==0){const y=p*Math.min(Jm(l),H2(l));l[0]-=y,l[1]-=y,l[2]+=y,l[3]+=y}lv(e.aabr,l,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let a=0;a<n.length;a++){const l=n.data[a],p=l.info[this.visibilityGroup];if(p&&p.visible&&l.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,BL(p.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new Ci)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let a=i;a<=r;a++)if(!(a<0||a>=this.accBinsNumX))for(let l=s;l<=n;l++)l<0||l>=this.accBinsNumY||this.accBins[a][l].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(Gh.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Fo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function zit(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(Gh.DECONFLICTION,t)}function*boe(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*Bit(e,t,i){t.clear(),e.forEach((s,n)=>{const a=t.pushNew();a.id=n,a.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}_([S({constructOnly:!0})],nT.prototype,"view",void 0),_([S({type:Boolean,readOnly:!0})],nT.prototype,"updating",null),nT=_([re("esri.views.3d.layers.graphics.Deconflictor")],nT);const Vit=St();class Git{constructor(){this.positionView=Q(),this.positionNDC=Q(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const jit=new Git,Hit=2e3;let l$=class extends nT{constructor(){super(...arguments),this.visibilityGroup=Fo.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===po.IDLE||t-this._lastDeconfliction>Hit)&&(super.runTask(e),this.state===Oc.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};_([S({constructOnly:!0})],l$.prototype,"parent",void 0),l$=_([re("esri.views.3d.layers.graphics.LabelDeconflictor")],l$);let _H=class extends nT{constructor(){super(...arguments),this._handles=new Ei,this._contexts=new Map,this._viewState=new nwe,this.visibilityGroup=Fo.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([this.view.watch("state.camera",()=>{this._updateViewState(),this.setDirty()}),this.view.watch("map.ground.opacity",(e,t)=>{e!==1&&t!==1||this.setDirty()}),Pi(this.view,"slicePlane",()=>{this._updateSlicePlane(),this._slicePlaneChanged()})]),this._frameTask=this.view.resourceController.scheduler.registerTask(ii.GRAPHICS_DECONFLICTOR,this),this._labels=new l$({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&Lk(e));t.setVisibilityFlag(Gh.DECONFLICTION,i,Fo.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;L(e)&&uge(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=L(e)}_slicePlaneChanged(){rn(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new Nit(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),Lk(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=Lk(e);i||qit(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function Lk(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function qit(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(Gh.DECONFLICTION))}_H=_([re("esri.views.3d.layers.graphics.GraphicsDeconflictor")],_H);const KJ=(e,t,i)=>[t,i],WS=(e,t,i)=>[t,i,e[2]],QJ=(e,t,i)=>[t,i,e[2],e[3]];function woe(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:L(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function owe({scale:e,translate:t},i){return i*e[0]+t[0]}function awe({scale:e,translate:t},i){return t[1]-i*e[1]}function lwe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let a=owe(e,i[0][0]),l=awe(e,i[0][1]);r[0]=t(i[0],a,l);for(let p=1;p<i.length;p++){const y=i[p];a+=y[0]*s,l-=y[1]*n,r[p]=t(y,a,l)}return r}function cwe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=lwe(e,t,i[s]);return r}function Wit(e,t,i,r){return lwe(e,i?r?QJ:WS:r?WS:KJ,t)}function Xit(e,t,i,r){return cwe(e,i?r?QJ:WS:r?WS:KJ,t)}function Yit(e,t,i,r){return cwe(e,i?r?QJ:WS:r?WS:KJ,t)}function hwe(e,t,i,r,s){return L(i)&&(t.points=Wit(e,i.points,r,s)),t}function uwe(e,t,i,r,s){return J(i)||(t.x=owe(e,i.x),t.y=awe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function dwe(e,t,i,r,s){return L(i)&&(t.rings=Yit(e,i.rings,r,s)),t}function pwe(e,t,i,r,s){return L(i)&&(t.paths=Xit(e,i.paths,r,s)),t}function fwe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function mwe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!fwe(e[i],t[i]))return!1;return!0}function Jit(e,t){return!!p4(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Zit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!p4(e.spatialReference,t.spatialReference)&&mwe(e.paths,t.paths)}function Kit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!p4(e.spatialReference,t.spatialReference)&&mwe(e.rings,t.rings)}function Qit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!p4(e.spatialReference,t.spatialReference)&&fwe(e.points,t.points)}function ert(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!p4(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function p4(e,t){return e===t||e&&t&&e.equals(t)}function trt(e,t){if(e===t)return!0;if(J(e)||J(t)||e.type!==t.type)return!1;switch(e.type){case"point":return Jit(e,t);case"extent":return ert(e,t);case"polyline":return Zit(e,t);case"polygon":return Kit(e,t);case"multipoint":return Qit(e,t);case"mesh":return!1;default:return}}function irt(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function gSt(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!trt(e.geometry,t.geometry)&&!!irt(e.attributes,t.attributes)}class ySt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function vSt(e){return L(e.geometry)}class _St{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function bSt(e){const t=Dfe.fromJSON(e.geometryType),i=It.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const a=rrt(n,t,i,e.objectIdFieldName),l=a.geometry;if(L(l)&&r)switch(l.type){case"point":a.geometry=uwe(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=hwe(r,l,l,l.hasZ,l.hasM);break;case"polygon":a.geometry=dwe(r,l,l,l.hasZ,l.hasM);break;case"polyline":a.geometry=pwe(r,l,l,l.hasZ,l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>VO.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function rrt(e,t,i,r){return{uid:ec(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:srt(e.geometry,t,i),visible:!0}}function srt(e,t,i){if(J(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Kg(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function nrt(e){if(J(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=N4(e.vertexAttributes.position),t+=N4(e.vertexAttributes.normal),t+=N4(e.vertexAttributes.uv),t+=N4(e.vertexAttributes.tangent)}return t}function wSt(e){let t=32;return t+=Mme(e.attributes),t+=3,t+=8+nrt(e.geometry),t}function ort(e){if(J(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function xSt(e){if(J(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function TSt(e,t){switch(jr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)BF(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)BF(t,e.rings[i],e.hasZ);break;case"multipoint":BF(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function art(e,t){switch(pd(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)zF(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)zF(t,e.rings[i]);break;case"multipoint":zF(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function SSt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}On();Mi();function gwe(e){return"declaredClass"in e}function xoe(e){return"declaredClass"in e}function lrt(e){return"declaredClass"in e}function crt(e,t){if(!e)return null;if(lrt(e))return e;const i=new gl({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Fe(e.symbol),i.attributes=Fe(e.attributes),i.geometry=ywe(e.geometry),i}function ywe(e){return J(e)?null:gwe(e)?e:Lp(hrt(e))}function hrt(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:Toe(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:Toe(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:a,zmax:l,mmin:p,mmax:y,hasZ:b,hasM:x}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:a,zmax:l,mmin:p,mmax:y,hasZ:b,hasM:x,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:_we(i)?vwe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function Toe(e){return urt(e)?e.map(t=>vwe(t)):e}function vwe(e){return e.map(t=>cMe(t))}function urt(e){for(const t of e)if(t.length!==0)return _we(t);return!1}function _we(e){return e.length&&(iue(e[0])||rue(e[0]))}function drt(e,t){if(!e)return null;let i;if(xoe(e)){if(t==null)return e.clone();if(xoe(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Kg(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const prt=Ge.getLogger("esri.layers.support.labelFormatUtils"),Soe={type:"simple",evaluate:()=>null},frt={getAttribute:(e,t)=>e.field(t)};async function bwe(e,t,i){if(!e||!e.symbol)return Soe;const r=e.where,s=ON(e),n=r?await Promise.resolve().then(function(){return uK}):null;let a;if(s.type==="arcade"){const l=await d$e(s.expression,i,t);a={type:"arcade",evaluate(p){try{const y=l.evaluate({$feature:"attributes"in p?l.repurposeFeature(p):p});if(y!=null)return y.toString()}catch{prt.error(new Se("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:p,expression:s}))}return null},needsHydrationToEvaluate:()=>kY(s.expression)==null}}else a={type:"simple",evaluate:l=>s.expression.replace(/{[^}]*}/g,p=>{const y=p.slice(1,-1),b=t.get(y);if(!b)return p;let x=null;return"attributes"in l?l&&l.attributes&&(x=l.attributes[b.name]):x=l.field(b.name),x==null?"":wwe(x,b)})};if(r){let l;try{l=n.WhereClause.create(r,t)}catch{return Soe}const p=a.evaluate;a.evaluate=y=>{const b="attributes"in y?void 0:frt;return l.testFeature(y,b)?p(y):null}}return a}function wwe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,a="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=a)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=xg(r,uW("short-date")):$L(t)&&(r=Tg(+r)),r||""}var ESt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:bwe,formatField:wwe});function eZ(e,t){if(e.type==="point")return y1(e,t,!1);if(gwe(e))switch(e.type){case"extent":return y1(e.center,t,!1);case"polygon":return y1(e.centroid,t,!1);case"polyline":return y1(Eoe(e),t,!0);case"mesh":return y1(e.origin,t,!1)}else switch(e.type){case"extent":return y1(mrt(e),t,!0);case"polygon":return y1(grt(e),t,!0);case"polyline":return y1(Eoe(e),t,!0)}}function Eoe(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=_fe(t,vfe(t)/2);return Kg(i[0],i[1],i[2],e.spatialReference)}function mrt(e){const t=isFinite(e.zmin);return Kg(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function grt(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=wfe(e.rings,e.hasZ);return Kg(i[0],i[1],i[2],e.spatialReference)}function y1(e,t,i){const r=i?e:drt(e);return t&&e?jLe(e,r,t)?r:null:r}function ASt(e,t,i,r=0){if(e){t||(t=Mi());const s=e;let n=.5*s.width*(i-1),a=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=a/20:s.height<1e-7*s.width&&(a+=n/20),fl(t,s.xmin-n-r,s.ymin-a-r,s.xmax+n+r,s.ymax+a+r),t}return null}function xwe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(Y.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function kM(e,t){const i=rN(Xf);return L(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),L(t)?i[3]=t:L(e)&&e.length>3&&(i[3]=e[3]),i}function CSt(e,t,i,r,s,n=[0,0,0,0]){for(let a=0;a<3;++a)L(e)&&e[a]!=null?n[a]=e[a]:L(i)&&i[a]!=null?n[a]=i[a]:n[a]=s[a];return L(t)?n[3]=t:L(r)?n[3]=r:n[3]=s[3],n}function Aoe(e=Jf,t,i,r=1){const s=new Array(3);if(J(t)||J(i))s[0]=1,s[1]=1,s[2]=1;else{let n,a=0;for(let l=2;l>=0;l--){const p=e[l];let y;const b=p!=null,x=l===0&&!n&&!b,A=i[l];p==="symbol-value"||x?y=A!==0?t[l]/A:1:b&&p!=="proportional"&&isFinite(p)&&(y=A!==0?p/A:1),y!=null&&(s[l]=y,n=y,a=Math.max(a,Math.abs(y)))}for(let l=2;l>=0;l--)s[l]==null?s[l]=n:s[l]===0&&(s[l]=.001*a)}for(let n=2;n>=0;n--)s[n]/=r;return zl(s)}function yrt(e){return e.isPrimitive!=null}function s8(e){return yrt(e)&&(e=[e.width,e.depth,e.height]),kD(e)?null:"Symbol sizes may not be negative values"}function kD(e){if(Array.isArray(e)){for(const t of e)if(!kD(t))return!1;return!0}return e==null||e>=0}function vrt(e,t,i,r=lt()){const s=e||0,n=t||0,a=i||0;return s!==0&&pS(r,r,-s/180*Math.PI),n!==0&&dS(r,r,n/180*Math.PI),a!==0&&KL(r,r,a/180*Math.PI),r}function tZ(e,t){return t.minDemResolution!=null?t.minDemResolution:GL(e)?t.minDemResolutionForPoints:.01*b6e(e)}function iZ(e,t,i,r,s,n,a,l,p,y,b){const x=Art[b.mode];let A,M,P=0;if(ys(e,t,i,r,p.spatialReference,s,l))return x.requiresAlignment(b)?(P=x.applyElevationAlignmentBuffer(r,s,n,a,l,p,y,b),A=n,M=a):(A=r,M=s),ys(A,p.spatialReference,M,n,y.spatialReference,a,l)?P:void 0}function Ig(e,t,i,r,s){const n=(uD(e)?e.z:zve(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const a=Wt(wp(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=a,void(s.z=a)}case"relative-to-ground":{const a=Wt(wp(t,e,"ground"),0),l=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=l,s.sampledElevation=a,void(s.z=l+a)}case"relative-to-scene":{const a=Wt(wp(t,e,"scene"),0),l=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=l,s.sampledElevation=a,void(s.z=l+a)}case"absolute-height":{const a=i.geometryZWithOffset(n,r),l=Wt(wp(t,e,"ground"),0);return s.verticalDistanceToGround=a-l,s.sampledElevation=l,void(s.z=a)}default:return i.mode,void(s.z=0)}}function _rt(e,t,i,r){return Ig(e,t,i,r,oT),oT.z}function f4(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Us.UPDATE:e.onTheGroundChanged}function bd(e){return e==="relative-to-ground"||e==="relative-to-scene"}function Fv(e){return e!=="absolute-height"}function brt(e,t,i,r,s){Ig(t,i,s,r,oT),xwe(e,oT.verticalDistanceToGround);const n=oT.sampledElevation,a=nn(Crt,e.transformation);return dP[0]=t.x,dP[1]=t.y,dP[2]=oT.z,kp(t.spatialReference,dP,a,r.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function wrt(e,t,i,r,s,n){let a=0;const l=n.spatialReference;t*=3,r*=3;for(let p=0;p<s;++p){const y=e[t+0],b=e[t+1],x=e[t+2],A=Wt(n.getElevation(y,b,x,l,"ground"),0);a+=A,i[r+0]=y,i[r+1]=b,i[r+2]=A,t+=3,r+=3}return a/s}function xrt(e,t,i,r,s,n,a,l){let p=0;const y=l.calculateOffsetRenderUnits(a),b=l.featureExpressionInfoContext,x=n.spatialReference;t*=3,r*=3;for(let A=0;A<s;++A){const M=e[t+0],P=e[t+1],$=e[t+2],k=Wt(n.getElevation(M,P,$,x,"ground"),0);p+=k,i[r+0]=M,i[r+1]=P,i[r+2]=b==null?$+k+y:k+y,t+=3,r+=3}return p/s}function Trt(e,t,i,r,s,n,a,l){let p=0;const y=l.calculateOffsetRenderUnits(a),b=l.featureExpressionInfoContext,x=n.spatialReference;t*=3,r*=3;for(let A=0;A<s;++A){const M=e[t+0],P=e[t+1],$=e[t+2],k=Wt(n.getElevation(M,P,$,x,"scene"),0);p+=k,i[r+0]=M,i[r+1]=P,i[r+2]=b==null?$+k+y:k+y,t+=3,r+=3}return p/s}function Srt(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function Ert(e,t,i,r,s,n,a,l){const p=l.calculateOffsetRenderUnits(a),y=l.featureExpressionInfoContext;t*=3,r*=3;for(let b=0;b<s;++b){const x=e[t+0],A=e[t+1],M=e[t+2];i[r+0]=x,i[r+1]=A,i[r+2]=y==null?M+p:p,t+=3,r+=3}return 0}class m4{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Us;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Us||(Us={}));const Art={"absolute-height":{applyElevationAlignmentBuffer:Ert,requiresAlignment:Srt},"on-the-ground":{applyElevationAlignmentBuffer:wrt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:xrt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Trt,requiresAlignment:()=>!0}},Crt=lt(),oT=new m4,dP=Q();function Twe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let a=0;for(const l of n){const{update:p,averageGeometrySampledElevation:y}=Ewe(l,t,i,r);a+=y,p&&s.geometryVertexAttrsUpdated(l)}return a/n.length}function iO(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let a=0;s.metadata.usesVerticalDistanceToGround?(Ig(n,i,t,r,Hl),xwe(s,Hl.verticalDistanceToGround),a=Hl.sampledElevation):(Ig(n,i,t,r,Hl),t.mode!=="absolute-height"&&(a=Hl.sampledElevation));const l=nn(Mrt,s.transformation),p=ze(Swe,l[12],l[13],l[14]);ur.TESTS_DISABLE_OPTIMIZATIONS?(jl[0]=n.x,jl[1]=n.y,jl[2]=Hl.z,kp(n.spatialReference,jl,l,r.spatialReference)&&(s.transformation=l)):r.setAltitudeOfTransformation(Hl.z,l);const y=rZ/r.unitInMeters;return(Math.abs(l[12]-p[0])>=y||Math.abs(l[13]-p[1])>=y||Math.abs(l[14]-p[2])>=y)&&(s.transformation=l),a}const Mrt=lt();function Rrt(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(J(s))return 0;const n=t.centerPointInElevationSR;Ig(n,i,t,r,Hl);const a=t.mode!=="absolute-height"?Hl.sampledElevation:0,l=s.instanceData,p=e.instanceIndex,y=Prt;l.getGlobalTransform(p,y);const b=ze(Swe,y[12],y[13],y[14]);ur.TESTS_DISABLE_OPTIMIZATIONS?(jl[0]=n.x,jl[1]=n.y,jl[2]=Hl.z,kp(n.spatialReference,jl,y,r.spatialReference)&&l.setGlobalTransform(p,y)):r.setAltitudeOfTransformation(Hl.z,y);const x=rZ/r.unitInMeters;return(ur.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(y[12]-b[0])>=x||Math.abs(y[13]-b[1])>=x||Math.abs(y[14]-b[2])>=x)&&l.setGlobalTransform(p,y),a}function Ort(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let a=0,l=null,p=0,y=!1;for(const b of n){const x=b.geometry.vertexAttributes.get(Y.POSITION);if(x!==l){const{update:A,averageGeometrySampledElevation:M}=Ewe(b,t,i,r);p=M,l=x,y=A}y&&s.geometryVertexAttrsUpdated(b),a+=p}return a/n.length}const rZ=.01,jl=Q(),du=Q(),ax=Q(),Prt=lt(),Swe=Q(),Hl=new m4;function Ewe(e,t,i,r){let s=!1;const n=i.spatialReference,a=e.geometry,l=e.getShaderTransformation(),p=t.requiresSampledElevationInfo;du[0]=l[12],du[1]=l[13],du[2]=l[14],a.invalidateBoundingInfo();const y=a.getMutableAttribute(Y.POSITION),b=y.data,x=a.vertexAttributes.get(Y.MAPPOS).data,A=y.size,M=b.length/A,P=new Uve(x,n);let $=0,k=0;for(let z=0;z<M;z++){if(ax[0]=b[$],ax[1]=b[$+1],ax[2]=b[$+2],Ig(P,i,t,r,Hl),p&&(k+=Hl.sampledElevation),ur.TESTS_DISABLE_OPTIMIZATIONS)b[$]=P.array[P.offset],b[$+1]=P.array[P.offset+1],b[$+2]=Hl.z,ys(b,n,$,b,r.spatialReference,$,1),b[$]-=du[0],b[$+1]-=du[1],b[$+2]-=du[2],s=!0;else{jl[0]=b[$]+du[0],jl[1]=b[$+1]+du[1],jl[2]=b[$+2]+du[2],r.setAltitude(jl,Hl.z),b[$]=jl[0]-du[0],b[$+1]=jl[1]-du[1],b[$+2]=jl[2]-du[2];const G=rZ/r.unitInMeters;(Math.abs(ax[0]-b[$])>=G||Math.abs(ax[1]-b[$+1])>=G||Math.abs(ax[2]-b[$+2])>=G)&&(s=!0)}$+=A,P.offset+=3}return k/=M,{update:s,averageGeometrySampledElevation:k}}const Irt=Ge.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function $rt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function MSt(e){const t=e&&e.expression;if(typeof t=="string"){const i=Mwe(t);if(i!=null)return{cachedResult:i}}return null}async function RSt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=Mwe(r);if(s!=null)return{cachedResult:s};const n=await Np(),a=n.arcadeUtils,l=a.createSyntaxTree(r);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:n}}}function Awe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function sZ(e,t){if(e!=null&&!Cwe(e)){if(!t||!e.arcade)return void Irt.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=ywe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Drt(e){if(e!=null){if(Cwe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function OSt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const Lrt={cachedResult:0};function Cwe(e){return e.cachedResult!=null}function Mwe(e){return e==="0"?0:null}class cu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=rve(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Drt(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=qGe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=Wt(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(J(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&L(i)&&L(r)?(this._featureExpressionInfoContext=$rt(t),sZ(this._featureExpressionInfoContext,Awe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new cu;return L(t)&&i.setFromElevationInfo(t),i}}var wi;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(wi||(wi={}));class L0{constructor(t,i,r,s,n,a,l,p=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=a,this.elevationContext=l,this._edgeState=p,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),L(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(J(this._edgeState))return;const r=Coe(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){J(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:t},!i),this._edgeState.properties.slicePlaneEnabled=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),L(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(L(r)&&sZ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=Q()){return ke(t,ru(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(t=On()){const i=this.stageObject.boundingVolumeObjectSpace;return f0e(t,i.min),m0e(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(W0)&&(Ct(W0,W0,this.stageObject.transformation),Xe(t.render.origin,t.render.origin,W0),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const a=this.getBoundingBoxObjectSpace(n),l=Nrt,p=GL(a)?1:l.length;for(let b=0;b<p;b++){const x=l[b];v1[0]=a[x[0]],v1[1]=a[x[1]],v1[2]=a[x[2]],Ct(v1,v1,this.stageObject.transformation),y_[3*b+0]=v1[0],y_[3*b+1]=v1[1],y_[3*b+2]=v1[2]}if(!t(y_,0,p))return null;jr(a);let y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(let b=0;b<3*p;b+=3){for(let x=0;x<3;x++)a[x]=Math.min(a[x],y_[b+x]),a[x+3]=Math.max(a[x+3],y_[b+x]);y&&r.push({location:y_.slice(b,b+3),screenSpaceBoundingRect:y})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){yp(a,W0);const b=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let x=0;if(i.useViewElevation)x=Wt(i.service.getElevation(W0[0],W0[1],b),0);else try{const A=tZ(a,i);x=Wt(await i.service.queryElevation(W0[0],W0[1],s,A,b),0)}catch{}p0e(a,0,0,-this.alignedSampledElevation+x)}return a}addObjectState(t,i){t===Rg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===Rg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(J(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(J(r))return;const s=Coe(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Coe(e){return e.isVisible?e.parameters.transparent?wi.TRANSPARENT:wi.OPAQUE:wi.INVISIBLE}const y_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v1=Q(),W0=Q(),Nrt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var Hn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(Hn||(Hn={}));class nZ{constructor(t){this.schedule=t,this._loadStatus=Uh.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Uh.LOADED?(t&&t(),this._loader):this._loadStatus===Uh.FAILED?(i&&i(this._loadError),this._loader):(J(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Uh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Uh.FAILED,!Cs(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){L(this._abortController)?this._abortController=Ql(this._abortController):this._loadStatus===Uh.LOADING&&(this._loadStatus=Uh.FAILED),this._loader=null}}var Uh;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Uh||(Uh={}));function Frt(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Rwe(e,t){const i=(r,s,n=!1)=>({levels:r.map(a=>{const l=s(a.tesselation);return n&&$c.cgToGIS(l),{components:[{geometry:l,material:t}],faceCount:l.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>$c.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createBoxGeometry(1));case"cone":return i(Nk,r=>$c.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(Nk,r=>$c.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(Nk,r=>$c.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createDiamondGeometry(1),!0);default:return}}const Nk=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function krt(e){return e.type==="fill"}function Urt(e){return e.type==="extrude"}function zrt(e){return e&&e.enabled&&(Urt(e)||krt(e))&&L(e.edges)}function Brt(e){return e&&e.enabled&&e.edges||null}function Owe(e,t){return Vrt(Brt(e),t)}function Vrt(e,t){if(J(e))return null;const i=L(e.color)?MX(Ft.toUnitRGBA(e.color)):_r(0,0,0,0),r=La(e.size),s=La(e.extensionLength);switch(e.type){case"solid":return Grt(ie({color:i,size:r,extensionLength:s},t));case"sketch":return jrt(ie({color:i,size:r,extensionLength:s},t));default:return}}function Grt(e){return qe(ie(ie({},Hrt),e),{type:"solid"})}function jrt(e){return qe(ie(ie({},qrt),e),{type:"sketch"})}const Hrt={color:_r(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:wi.OPAQUE},qrt={color:_r(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:wi.OPAQUE};function pP(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),mL(t)}function Wrt(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),mL(t)}function oZ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),mL(t)}function Xrt(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),mL(t)}function Yrt(e){return oZ(e).reduce((t,i)=>t+i.indexCount/3,0)}const aZ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function PSt(e){return e.type==="web-style"?aZ:lZ(e.symbolLayers.toArray().map(t=>Pwe(e,t)))}function lZ(e){let t=0,i=0,r=0,s=!1,n=0;const a={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const l of e)J(l)||(t+=l.primitivesPerFeature,i+=l.primitivesPerCoordinate,r+=l.drawCallsPerFeature,a.bytesPerFeature+=l.memory.bytesPerFeature,a.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,a.bytesPerCoordinate+=l.memory.bytesPerCoordinate,a.draped.bytesPerFeature+=l.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,a.draped.bytesPerCoordinate+=l.memory.bytesPerCoordinate,s=s||l.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:a,numComplexities:n}}function ISt(e){const t=lZ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Moe={};function Pwe(e,t){const i=Iwe(e,t),r=zrt(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:L(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:qe(ie({},Jrt(t.resource&&t.resource.primitive||w0e)),{memory:i});case"path":{let l=0,p=0;switch(t.profile){case"circle":l=10;break;case"quad":l=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":p=3;break;case"miter":case"bevel":p=1;break;default:return void(t.join,void 0)}const y=2*l,b=l*p*2;let x=-2*b-y;switch(t.cap){case"none":break;case"butt":case"square":x+=2*(l-1);break;case"round":x+=2*(l*(3-1)*2+l);break;default:return}return{primitivesPerFeature:x,primitivesPerCoordinate:b+y,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function Iwe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Sl.EXTRUDE_EDGES:Sl.EXTRUDE;case"fill":return L(t.outline)&&t.outline.size>0?Sl.FILL_OUTLINE:Sl.FILL;case"water":return Sl.FILL;case"line":return t.join==="round"?Sl.LINE_ROUND:Sl.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Sl.PATH_ROUND_CIRCLE;case"quad":return Sl.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Sl.PATH_MITER_CIRCLE;case"quad":return Sl.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?Sl.OBJECT_POINT:Sl.OBJECT_POLYGON;case"icon":case"text":return i?Sl.ICON_POINT:Sl.ICON_POLYGON;default:return}}function Jrt(e){let t=Moe[e];if(t)return t;const i=Rwe(e,null);return t={primitivesPerFeature:oZ(i.levels[0]).reduce((r,s)=>r+s.indices.get(Y.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Moe[e]=t,t}const Sl={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},fP=Ge.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class N0 extends nZ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=fP,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new cu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Roe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Roe(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,a="polygons"in t?t.polygons:null,l=`${s} geometry failed to be created`;let p=null;n?!i.length||i.length===1&&!i[0].length?p=`${l} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?a&&a.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(p=`${l} (filled rings should use clockwise winding - try reversing the order of vertices)`):p=`${l} (${r} should be defined as a 2D array)`:p=`${l} (failed to project geometry to view spatial reference)`,p&&fP.warnOncePerTick(p)}_validateGeometry(t,i=null,r=null){if(L(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return fP.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Zrt}_defaultElevationInfoZ(){return Krt}_updateElevationContext(){L(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=Wt(this._elevationContext.meterUnitOffset,Wt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const a=n?Lrt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(a,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=Ooe){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(L(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=Ooe){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return kM(null,r);const s=L(t)?Ft.toUnitRGB(t):Jf;return kM(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=kM(r,s);return L(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Pwe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Us.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Us.UPDATE;return t.forEach(n=>{const a=i(n);if(L(a)){const l=n.graphic;this.setGraphicElevationContext(l,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else s=Us.RECREATE}),s}applyRendererDiff(t,i){return Hn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?mg(i.size.field,t):0,s=i.color?mg(i.color.field,t):0,n=i.opacity?mg(i.opacity.field,t):0;return _r(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&fP.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}}function mg(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Roe(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Zrt={mode:"on-the-ground",offset:0,unit:"meters"},Krt={mode:"absolute-height",offset:0,unit:"meters"},Ooe={hasIntrinsicColor:!1};class dw{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,a){this.id=ec(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return L(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(Ct(t,t,this.getStaticTransformation()),!0)}}dw.pool=new mn(dw);class UD{constructor(t){this.channel=t,this.id=ec()}}class Qg extends s4{constructor(t={}){super(),this.type=Vp.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=lt(),this._bvObjectSpace=new Poe,this._bvWorldSpace=new Poe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new $we),this.transformation=lt();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){Kt(r.length===i.length,"Object3D: materials don't match geometries"),Kt(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let a=0;a<i.length;a++)this._geometries[a]=i[a],this._geometryRecords[a]=dw.pool.acquire(i[a],r[a],S2(s[a]),{highlights:null,occludees:null,visible:this._visible},n&&n[a])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){nn(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){Kt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||Rn,this._geometries.push(t);const a=dw.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||L(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=L(i.shaderTransformation)?this._geometryRecords.some(r=>L(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new UD(Rg.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=nH(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=oH(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new UD(Rg.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=nH(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=oH(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return As(Wt(i,lt()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||lt(),As(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],a=this._geometryRecords[s],l=n.boundingInfo;L(l)&&(this._calculateTransformedBoundingVolume(l,this._bvObjectSpace,a.getShaderTransformation()),this._calculateTransformedBoundingVolume(l,this._bvWorldSpace,this._getCombinedShaderTransformation(a)))}Wn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Wn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=Q(),i=Q(),r=z2(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(J(n))continue;const a=this._geometryRecords[s].getShaderTransformation(),l=z2(a);Ct(t,n.getCenter(),a);const p=Er(t,this._bvObjectSpace.bounds),y=n.getBSRadius()*l;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],p+y),Ct(i,t,this.transformation);const b=Er(i,this._bvWorldSpace.bounds),x=y*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],b+x)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),a=qn(s),l=qn(n);Ct(a,a,r),Ct(l,l,r);for(let p=0;p<3;++p)i.min[p]=Math.min(i.min[p],a[p],l[p]),i.max[p]=Math.max(i.max[p],a[p],l[p]);for(let p=0;p<3;++p){ke(a,s),ke(l,n),a[p]=n[p],l[p]=s[p],Ct(a,a,r),Ct(l,l,r);for(let y=0;y<3;++y)i.min[y]=Math.min(i.min[y],a[y],l[y]),i.max[y]=Math.max(i.max[y],a[y],l[y])}}_invalidateBoundingVolume(){this._bvDirty=!0,L(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){L(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.indexOf(i)>-1,getGeometryIndex:i=>t._geometries.indexOf(i)}}}class $we{constructor(){this.min=$t(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=$t(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Poe extends $we{constructor(){super(...arguments),this.bounds=qo()}init(){ze(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ze(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Wme(this.bounds)}}const iv=Q();function cZ(e,t,i,r,s,n,a,l){const p=i?i.length:0,y=e.clippingExtent;if(To(t,iv,e.elevationProvider.spatialReference),L(y)&&!eX(y,iv))return null;To(t,iv,e.renderCoordsHelper.spatialReference);const b=e.localOriginFactory.getOrigin(iv),x=new Qg({castShadow:!1,metadata:{layerUid:n,graphicUid:a,usesVerticalDistanceToGround:!0}});for(let A=0;A<p;A++){const M=Rn;x.addGeometry(i[A],r[A],M,b,l)}return{object:x,sampledElevation:brt(x,t,e.elevationProvider,e.renderCoordsHelper,s)}}function rO(e,t,i){const r=e.elevationContext,s=i.spatialReference;To(t,iv,s),r.centerPointInElevationSR=Kg(iv[0],iv[1],t.hasZ?iv[2]:0,s)}function sO(e){switch(e.type){case"point":return e;case"polygon":case"extent":return eZ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=_fe(t,vfe(t)/2);return Kg(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function $St(e,t,i,r,s){const n=new Float64Array(3*e.length),a=new Float64Array(n.length);e.forEach((y,b)=>{n[3*b+0]=y[0],n[3*b+1]=y[1],n[3*b+2]=y.length>2?y[2]:0});const l=iZ(n,t,0,a,0,n,0,n.length/3,i,r,s),p=l!=null;return{numVertices:e.length,position:n,mapPosition:a,projectionSuccess:p,sampledElevation:l}}function hZ(){return new Float32Array(2)}function Qrt(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Ju(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function est(e,t){return new Float32Array(e,t,2)}function Dwe(){return hZ()}function Lwe(){return Ju(1,1)}function Nwe(){return Ju(1,0)}function Fwe(){return Ju(0,1)}const tst=Dwe(),ist=Lwe(),rst=Nwe(),sst=Fwe();Object.freeze({__proto__:null,create:hZ,clone:Qrt,fromValues:Ju,createView:est,zeros:Dwe,ones:Lwe,unitX:Nwe,unitY:Fwe,ZEROS:tst,ONES:ist,UNIT_X:rst,UNIT_Y:sst});function nst(e){const t=new Ir;return t.include(gJ),t.include(F2e,e),t.include(Ws,e),t.attributes.add(Y.UV0,"vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassGeometryEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(V`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?V`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.screenSizePerspectiveEnabled?V`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:V`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassGeometryEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?V`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:V`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.screenSizePerspectiveEnabled?V`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:V`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),t.fragment.uniforms.add("uColor","vec4"),t.fragment.uniforms.add("borderColor","vec4"),e.multipassGeometryEnabled&&(t.fragment.include(J2e,e),t.fragment.uniforms.add("inverseViewport","vec2")),t.fragment.code.add(V`
    void main() {
      ${e.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?V`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:V`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function kwe(e,t,i){Ioe(e,"uColor",t.color),e.setUniform1f("pixelRatio",i),e.setUniform2f("screenOffset",t.screenOffset[0]*i,t.screenOffset[1]*i),t.borderColor!==null?(Ioe(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",i)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))}function Ioe(e,t,i){i.length===3?e.setUniform4f(t,i[0],i[1],i[2],1):e.setUniform4fv(t,i)}const ost=Object.freeze({__proto__:null,build:nst,bindLineCalloutUniforms:kwe});class n8 extends Xr{initializeProgram(t){const i=n8.shader.get(),r=this.configuration,s=i.build({occlusionTestEnabled:r.occlusionTestEnabled,verticalOffsetEnabled:r.verticalOffset,screenSizePerspectiveEnabled:r.screenSizePerspective,depthHudEnabled:r.depthHudEnabled,depthHudAlignStartEnabled:r.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:t.viewingMode,isDraped:!1,multipassGeometryEnabled:r.multipassGeometryEnabled});return new $r(t.rctx,s,mr)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),kwe(this.program,t,i.camera.pixelRatio||1),ZJ(this.program,t,i),k2e(this.program,i),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Z2e(this.program,i),this.program.bindTexture(i.hudVisibilityTexture,"hudVisibilityTexture"),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),lbe(this.program,i),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/i.camera.fullViewport[2],2/i.camera.fullViewport[3]);const r=i.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(t.size)*r),eO(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")}bindDraw(t){I0(this.program,t),Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),kw(this.program,this.configuration,t),this.program.rebindTextures()}setPipelineState(t){const i=t?kr.ALWAYS:kr.LESS;return this.configuration.depthHudEnabled?Ti({depthTest:{func:i},depthWrite:ac}):Ti({blending:ga(ht.ONE,ht.SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Ii})}initializePipeline(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)}}n8.shader=new Ur(ost,()=>import("./LineCallout.glsl.f23666a8.js"));class Am extends Rs{constructor(){super(...arguments),this.occlusionTestEnabled=!0,this.verticalOffset=!1,this.screenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.screenCenterOffsetUnitsEnabled=Xc.World,this.slicePlaneEnabled=!1,this.multipassGeometryEnabled=!1}}_([Oe()],Am.prototype,"occlusionTestEnabled",void 0),_([Oe()],Am.prototype,"verticalOffset",void 0),_([Oe()],Am.prototype,"screenSizePerspective",void 0),_([Oe()],Am.prototype,"depthHudEnabled",void 0),_([Oe()],Am.prototype,"depthHudAlignStartEnabled",void 0),_([Oe({count:Xc.COUNT})],Am.prototype,"screenCenterOffsetUnitsEnabled",void 0),_([Oe()],Am.prototype,"slicePlaneEnabled",void 0),_([Oe()],Am.prototype,"multipassGeometryEnabled",void 0);class f2 extends Wp{constructor(t){super(t,lst),this.techniqueConfig=new Am,this._uniqueMaterialIdentifier=f2.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getTechniqueConfig(t,i){const r=(i==null?void 0:i.slot)!==tt.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Xc.Screen:Xc.World,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!i&&i.multipassGeometryEnabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case tt.LINE_CALLOUTS:case tt.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===Te.Color?new ast(t):null}createBufferWriter(){return new hst}validateParameters(t){const i=f2.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class ast extends Xg{updateParameters(t){return this.ensureTechnique(n8,t)}beginSlot(t){return this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const lst=ie({verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},Sd),cst=on().vec3f(Y.POSITION).vec3f(Y.NORMAL).vec2f(Y.UV0).vec4f(Y.AUXPOS1),$oe=[Ju(0,0),Ju(1,0),Ju(0,1),Ju(1,0),Ju(1,1),Ju(0,1)];class hst{constructor(){this.vertexBufferLayout=cst}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(Y.POSITION).length}write(t,i,r,s){h4(i.indices.get(Y.POSITION),i.vertexAttributes.get(Y.POSITION).data,t.transformation,r.position,s,6),qJ(i.indices.get(Y.NORMAL),i.vertexAttributes.get(Y.NORMAL).data,t.invTranspTransformation,r.normal,s,6),HS(i.indices.get(Y.AUXPOS1),i.vertexAttributes.get(Y.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<$oe.length;++n)r.uv0.setVec(s+n,$oe[n])}}class o8 extends N0{constructor(t,i){super(t,null,i,pst),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new f2(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||[0,0],i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=L(i.color)?Ft.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=La(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:x,minWorldLength:A,maxWorldLength:M}=t.verticalOffset;n={screenLength:La(x),minWorldLength:A||0,maxWorldLength:M!=null?M:1/0}}const a=L(i.border)&&L(i.border.color)?Ft.toUnitRGBA(i.border.color):null,l=t.symbolLayers.getItemAt(0).type==="object",p=!l,y=l?0:void 0,b=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:a,occlusionTest:p,shaderPolygonOffset:y,depthHUDAlignStart:b,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:Sd.renderOccluded}}_defaultElevationInfoNoZ(){return dst}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new cu,i.elevationOffset||0),n=i.symbol,a=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(p=>p.type==="object"||p.type==="text"));if(n.type!=="label-3d"&&a||n.type==="point-3d"&&n.symbolLayers.every(p=>p.type==="text"&&!A0e(p)))return null;const l=eZ(r.geometry);return J(l)?null:this._createAs3DShape(l,s,i,r.uid)}layerOpacityChanged(){return J(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=f4(o8.elevationModeChangeTypes,r,s);return n!==Us.UPDATE||t.forEach(a=>{const l=i(a);L(l)&&this.updateGraphicElevationContext(a.graphic,l)}),n}slicePlaneEnabledChanged(){return J(this._material)||this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=bd(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:aZ.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[Y.POSITION,s],[Y.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[Y.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=f2.uniqueMaterialIdentifier(i);if(L(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return J(s)&&(s=new f2(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new f2(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new ws(this._createVertexData(r),ust,rc.Point)],a=this._getOrCreateMaterial(r),l=cZ(this._context,t,n,[a.material],i,this._context.layer.uid,s);if(l===null)return null;const p=new L0(this,l.object,n,a.isUnique?[a.material]:null,null,iO,i);return p.metadata={elevationOffset:r.elevationOffset||0},p.alignedSampledElevation=l.sampledElevation,p.needsElevationUpdates=bd(i.mode),rO(p,t,this._context.elevationProvider),p}}o8.elevationModeChangeTypes={definedChanged:Us.UPDATE,staysOnTheGround:Us.UPDATE,onTheGroundChanged:Us.RECREATE};const Fk=new Uint16Array([0]),ust=[[Y.POSITION,Fk],[Y.NORMAL,Fk],[Y.AUXPOS1,Fk]],dst={mode:"relative-to-ground",offset:0},pst={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Doe=Ge.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function fst(e,t){if(!cX(e))return Doe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=mst[e.callout.type];return i?new i(e,t):(Doe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const mst={line:o8};class gst{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const Loe=new mn(Array,e=>VL(e,g0e),null,10,5),yst=Mi();class vst{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=_st(Fo._COUNT,Gh._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?Awe(n,t,s):null;for(const a of r)L(a)&&(this.isElevationSource=this.isElevationSource||a.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i,r){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(s=>{s.initialize(t,i,r),s.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(Fo.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=Fo.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===Fo.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(n));else{this._forEachSymbolLayerGraphic(l=>l.setVisibility(n));const a=this.isVisible(Fo.LABEL);this._forEachLabelGraphic(l=>l.setVisibility(a))}return!0}clearVisibilityFlag(t,i=Fo.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(J(i))return!1;this._extent=Mi(),art(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!tN(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return L(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Fa.fromExtent(s.type==="mesh"?s.extent:s)),h1e(s,i,r)}get usedMemory(){let t=Mme(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(J(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=ort(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:Q(),num:0},draped:{origin:St(),num:0}};for(const i of this.graphics)J(i)||i.computeAttachmentOrigin(t);return t.render.num&&Ue(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Wl(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?jr(n.boundingBox):n.boundingBox=jr(),n.requiresDrapedElevation=!1,await YL(this.graphics,async a=>{if(J(a))return;const l=a.type==="draped"?i:t,p=Loe.acquire(),y=await a.getProjectedBoundingBox(l,r,n.screenSpaceObjects,s,p);isFinite(y[2])&&isFinite(y[5])||(n.requiresDrapedElevation=!0),y&&cS(n.boundingBox,p),Loe.release(p)}),v6e(n.boundingBox)||zB(tX(n.boundingBox,yst))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(L(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function _st(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Noe,Foe,koe,Uwe={exports:{}};Noe=Uwe,Foe=function(){function e(ne,pe,ye){ye=ye||2;var we,Ee,Ie,xe,$e,et,ct,Mt=pe&&pe.length,at=Mt?pe[0]*ye:ne.length,nt=t(ne,0,at,ye,!0),dt=[];if(!nt||nt.next===nt.prev)return dt;if(Mt&&(nt=p(ne,pe,nt,ye)),ne.length>80*ye){we=Ie=ne[0],Ee=xe=ne[1];for(var xt=ye;xt<at;xt+=ye)($e=ne[xt])<we&&(we=$e),(et=ne[xt+1])<Ee&&(Ee=et),$e>Ie&&(Ie=$e),et>xe&&(xe=et);ct=(ct=Math.max(Ie-we,xe-Ee))!==0?1/ct:0}return r(nt,dt,ye,we,Ee,ct),dt}function t(ne,pe,ye,we,Ee){var Ie,xe;if(Ee===De(ne,pe,ye,we)>0)for(Ie=pe;Ie<ye;Ie+=we)xe=Ce(Ie,ne[Ie],ne[Ie+1],xe);else for(Ie=ye-we;Ie>=pe;Ie-=we)xe=Ce(Ie,ne[Ie],ne[Ie+1],xe);if(xe&&q(xe,xe.next)){var $e=xe.next;Ae(xe),xe=$e}return xe}function i(ne,pe){if(!ne)return ne;pe||(pe=ne);var ye,we=ne;do if(ye=!1,we.steiner||!q(we,we.next)&&W(we.prev,we,we.next)!==0)we=we.next;else{var Ee=we.prev;if(Ae(we),(we=pe=Ee)===we.next)break;ye=!0}while(ye||we!==pe);return pe}function r(ne,pe,ye,we,Ee,Ie,xe){if(ne){!xe&&Ie&&P(ne,we,Ee,Ie);for(var $e,et,ct=ne;ne.prev!==ne.next;)if($e=ne.prev,et=ne.next,Ie?n(ne,we,Ee,Ie):s(ne))pe.push($e.i/ye),pe.push(ne.i/ye),pe.push(et.i/ye),Ae(ne),ne=et.next,ct=et.next;else if((ne=et)===ct){xe?xe===1?r(ne=a(i(ne),pe,ye),pe,ye,we,Ee,Ie,2):xe===2&&l(ne,pe,ye,we,Ee,Ie):r(i(ne),pe,ye,we,Ee,Ie,1);break}}}function s(ne){var pe=ne.prev,ye=ne,we=ne.next;if(W(pe,ye,we)>=0)return!1;for(var Ee=ne.next.next;Ee!==ne.prev;){if(G(pe.x,pe.y,ye.x,ye.y,we.x,we.y,Ee.x,Ee.y)&&W(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.next}return!0}function n(ne,pe,ye,we){var Ee=ne.prev,Ie=ne,xe=ne.next;if(W(Ee,Ie,xe)>=0)return!1;for(var $e=Ee.x<Ie.x?Ee.x<xe.x?Ee.x:xe.x:Ie.x<xe.x?Ie.x:xe.x,et=Ee.y<Ie.y?Ee.y<xe.y?Ee.y:xe.y:Ie.y<xe.y?Ie.y:xe.y,ct=Ee.x>Ie.x?Ee.x>xe.x?Ee.x:xe.x:Ie.x>xe.x?Ie.x:xe.x,Mt=Ee.y>Ie.y?Ee.y>xe.y?Ee.y:xe.y:Ie.y>xe.y?Ie.y:xe.y,at=k($e,et,pe,ye,we),nt=k(ct,Mt,pe,ye,we),dt=ne.prevZ,xt=ne.nextZ;dt&&dt.z>=at&&xt&&xt.z<=nt;){if(dt!==ne.prev&&dt!==ne.next&&G(Ee.x,Ee.y,Ie.x,Ie.y,xe.x,xe.y,dt.x,dt.y)&&W(dt.prev,dt,dt.next)>=0||(dt=dt.prevZ,xt!==ne.prev&&xt!==ne.next&&G(Ee.x,Ee.y,Ie.x,Ie.y,xe.x,xe.y,xt.x,xt.y)&&W(xt.prev,xt,xt.next)>=0))return!1;xt=xt.nextZ}for(;dt&&dt.z>=at;){if(dt!==ne.prev&&dt!==ne.next&&G(Ee.x,Ee.y,Ie.x,Ie.y,xe.x,xe.y,dt.x,dt.y)&&W(dt.prev,dt,dt.next)>=0)return!1;dt=dt.prevZ}for(;xt&&xt.z<=nt;){if(xt!==ne.prev&&xt!==ne.next&&G(Ee.x,Ee.y,Ie.x,Ie.y,xe.x,xe.y,xt.x,xt.y)&&W(xt.prev,xt,xt.next)>=0)return!1;xt=xt.nextZ}return!0}function a(ne,pe,ye){var we=ne;do{var Ee=we.prev,Ie=we.next.next;!q(Ee,Ie)&&X(Ee,we,we.next,Ie)&&fe(Ee,Ie)&&fe(Ie,Ee)&&(pe.push(Ee.i/ye),pe.push(we.i/ye),pe.push(Ie.i/ye),Ae(we),Ae(we.next),we=ne=Ie),we=we.next}while(we!==ne);return i(we)}function l(ne,pe,ye,we,Ee,Ie){var xe=ne;do{for(var $e=xe.next.next;$e!==xe.prev;){if(xe.i!==$e.i&&B(xe,$e)){var et=ge(xe,$e);return xe=i(xe,xe.next),et=i(et,et.next),r(xe,pe,ye,we,Ee,Ie),void r(et,pe,ye,we,Ee,Ie)}$e=$e.next}xe=xe.next}while(xe!==ne)}function p(ne,pe,ye,we){var Ee,Ie,xe,$e=[];for(Ee=0,Ie=pe.length;Ee<Ie;Ee++)(xe=t(ne,pe[Ee]*we,Ee<Ie-1?pe[Ee+1]*we:ne.length,we,!1))===xe.next&&(xe.steiner=!0),$e.push(z(xe));for($e.sort(y),Ee=0;Ee<$e.length;Ee++)ye=i(ye=x($e[Ee],ye),ye.next);return ye}function y(ne,pe){return ne.x-pe.x}function b(ne){if(ne.next.prev===ne)return ne;let pe=ne;for(;;){const ye=pe.next;if(ye.prev===pe||ye===pe||ye===ne)break;pe=ye}return pe}function x(ne,pe){var ye=A(ne,pe);if(!ye)return pe;var we=ge(ye,ne),Ee=i(ye,ye.next);let Ie=b(we);return i(Ie,Ie.next),Ee=b(Ee),b(pe===ye?Ee:pe)}function A(ne,pe){var ye,we=pe,Ee=ne.x,Ie=ne.y,xe=-1/0;do{if(Ie<=we.y&&Ie>=we.next.y&&we.next.y!==we.y){var $e=we.x+(Ie-we.y)*(we.next.x-we.x)/(we.next.y-we.y);if($e<=Ee&&$e>xe){if(xe=$e,$e===Ee){if(Ie===we.y)return we;if(Ie===we.next.y)return we.next}ye=we.x<we.next.x?we:we.next}}we=we.next}while(we!==pe);if(!ye)return null;if(Ee===xe)return ye;var et,ct=ye,Mt=ye.x,at=ye.y,nt=1/0;we=ye;do Ee>=we.x&&we.x>=Mt&&Ee!==we.x&&G(Ie<at?Ee:xe,Ie,Mt,at,Ie<at?xe:Ee,Ie,we.x,we.y)&&(et=Math.abs(Ie-we.y)/(Ee-we.x),fe(we,ne)&&(et<nt||et===nt&&(we.x>ye.x||we.x===ye.x&&M(ye,we)))&&(ye=we,nt=et)),we=we.next;while(we!==ct);return ye}function M(ne,pe){return W(ne.prev,ne,pe.prev)<0&&W(pe.next,ne,ne.next)<0}function P(ne,pe,ye,we){var Ee=ne;do Ee.z===null&&(Ee.z=k(Ee.x,Ee.y,pe,ye,we)),Ee.prevZ=Ee.prev,Ee.nextZ=Ee.next,Ee=Ee.next;while(Ee!==ne);Ee.prevZ.nextZ=null,Ee.prevZ=null,$(Ee)}function $(ne){var pe,ye,we,Ee,Ie,xe,$e,et,ct=1;do{for(ye=ne,ne=null,Ie=null,xe=0;ye;){for(xe++,we=ye,$e=0,pe=0;pe<ct&&($e++,we=we.nextZ);pe++);for(et=ct;$e>0||et>0&&we;)$e!==0&&(et===0||!we||ye.z<=we.z)?(Ee=ye,ye=ye.nextZ,$e--):(Ee=we,we=we.nextZ,et--),Ie?Ie.nextZ=Ee:ne=Ee,Ee.prevZ=Ie,Ie=Ee;ye=we}Ie.nextZ=null,ct*=2}while(xe>1);return ne}function k(ne,pe,ye,we,Ee){return(ne=1431655765&((ne=858993459&((ne=252645135&((ne=16711935&((ne=32767*(ne-ye)*Ee)|ne<<8))|ne<<4))|ne<<2))|ne<<1))|(pe=1431655765&((pe=858993459&((pe=252645135&((pe=16711935&((pe=32767*(pe-we)*Ee)|pe<<8))|pe<<4))|pe<<2))|pe<<1))<<1}function z(ne){var pe=ne,ye=ne;do(pe.x<ye.x||pe.x===ye.x&&pe.y<ye.y)&&(ye=pe),pe=pe.next;while(pe!==ne);return ye}function G(ne,pe,ye,we,Ee,Ie,xe,$e){return(Ee-xe)*(pe-$e)-(ne-xe)*(Ie-$e)>=0&&(ne-xe)*(we-$e)-(ye-xe)*(pe-$e)>=0&&(ye-xe)*(Ie-$e)-(Ee-xe)*(we-$e)>=0}function B(ne,pe){return ne.next.i!==pe.i&&ne.prev.i!==pe.i&&!he(ne,pe)&&(fe(ne,pe)&&fe(pe,ne)&&me(ne,pe)&&(W(ne.prev,ne,pe.prev)||W(ne,pe.prev,pe))||q(ne,pe)&&W(ne.prev,ne,ne.next)>0&&W(pe.prev,pe,pe.next)>0)}function W(ne,pe,ye){return(pe.y-ne.y)*(ye.x-pe.x)-(pe.x-ne.x)*(ye.y-pe.y)}function q(ne,pe){return ne.x===pe.x&&ne.y===pe.y}function X(ne,pe,ye,we){var Ee=de(W(ne,pe,ye)),Ie=de(W(ne,pe,we)),xe=de(W(ye,we,ne)),$e=de(W(ye,we,pe));return Ee!==Ie&&xe!==$e||!(Ee!==0||!oe(ne,ye,pe))||!(Ie!==0||!oe(ne,we,pe))||!(xe!==0||!oe(ye,ne,we))||!($e!==0||!oe(ye,pe,we))}function oe(ne,pe,ye){return pe.x<=Math.max(ne.x,ye.x)&&pe.x>=Math.min(ne.x,ye.x)&&pe.y<=Math.max(ne.y,ye.y)&&pe.y>=Math.min(ne.y,ye.y)}function de(ne){return ne>0?1:ne<0?-1:0}function he(ne,pe){var ye=ne;do{if(ye.i!==ne.i&&ye.next.i!==ne.i&&ye.i!==pe.i&&ye.next.i!==pe.i&&X(ye,ye.next,ne,pe))return!0;ye=ye.next}while(ye!==ne);return!1}function fe(ne,pe){return W(ne.prev,ne,ne.next)<0?W(ne,pe,ne.next)>=0&&W(ne,ne.prev,pe)>=0:W(ne,pe,ne.prev)<0||W(ne,ne.next,pe)<0}function me(ne,pe){var ye=ne,we=!1,Ee=(ne.x+pe.x)/2,Ie=(ne.y+pe.y)/2;do ye.y>Ie!=ye.next.y>Ie&&ye.next.y!==ye.y&&Ee<(ye.next.x-ye.x)*(Ie-ye.y)/(ye.next.y-ye.y)+ye.x&&(we=!we),ye=ye.next;while(ye!==ne);return we}function ge(ne,pe){var ye=new Pe(ne.i,ne.x,ne.y),we=new Pe(pe.i,pe.x,pe.y),Ee=ne.next,Ie=pe.prev;return ne.next=pe,pe.prev=ne,ye.next=Ee,Ee.prev=ye,we.next=ye,ye.prev=we,Ie.next=we,we.prev=Ie,we}function Ce(ne,pe,ye,we){var Ee=new Pe(ne,pe,ye);return we?(Ee.next=we.next,Ee.prev=we,we.next.prev=Ee,we.next=Ee):(Ee.prev=Ee,Ee.next=Ee),Ee}function Ae(ne){ne.next.prev=ne.prev,ne.prev.next=ne.next,ne.prevZ&&(ne.prevZ.nextZ=ne.nextZ),ne.nextZ&&(ne.nextZ.prevZ=ne.prevZ)}function Pe(ne,pe,ye){this.i=ne,this.x=pe,this.y=ye,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function De(ne,pe,ye,we){for(var Ee=0,Ie=pe,xe=ye-we;Ie<ye;Ie+=we)Ee+=(ne[xe]-ne[Ie])*(ne[Ie+1]+ne[xe+1]),xe=Ie;return Ee}return e.deviation=function(ne,pe,ye,we){var Ee=pe&&pe.length,Ie=Ee?pe[0]*ye:ne.length,xe=Math.abs(De(ne,0,Ie,ye));if(Ee)for(var $e=0,et=pe.length;$e<et;$e++){var ct=pe[$e]*ye,Mt=$e<et-1?pe[$e+1]*ye:ne.length;xe-=Math.abs(De(ne,ct,Mt,ye))}var at=0;for($e=0;$e<we.length;$e+=3){var nt=we[$e]*ye,dt=we[$e+1]*ye,xt=we[$e+2]*ye;at+=Math.abs((ne[nt]-ne[xt])*(ne[dt+1]-ne[nt+1])-(ne[nt]-ne[dt])*(ne[xt+1]-ne[nt+1]))}return xe===0&&at===0?0:Math.abs((at-xe)/xe)},e.flatten=function(ne){for(var pe=ne[0][0].length,ye={vertices:[],holes:[],dimensions:pe},we=0,Ee=0;Ee<ne.length;Ee++){for(var Ie=0;Ie<ne[Ee].length;Ie++)for(var xe=0;xe<pe;xe++)ye.vertices.push(ne[Ee][Ie][xe]);Ee>0&&(we+=ne[Ee-1].length,ye.holes.push(we))}return ye},e},(koe=Foe())!==void 0&&(Noe.exports=koe);const XS=Uwe.exports,a8=Ge.getLogger("esri.views.3d.support.buffer.math");function g4(e,t,i){if(e.count!==t.count)return void a8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],a=i[2],l=i[4],p=i[5],y=i[6],b=i[8],x=i[9],A=i[10],M=i[12],P=i[13],$=i[14],k=e.typedBuffer,z=e.typedBufferStride,G=t.typedBuffer,B=t.typedBufferStride;for(let W=0;W<r;W++){const q=W*z,X=W*B,oe=G[X],de=G[X+1],he=G[X+2];k[q]=s*oe+l*de+b*he+M,k[q+1]=n*oe+p*de+x*he+P,k[q+2]=a*oe+y*de+A*he+$}}function pw(e,t,i){if(e.count!==t.count)return void a8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],a=i[2],l=i[3],p=i[4],y=i[5],b=i[6],x=i[7],A=i[8],M=e.typedBuffer,P=e.typedBufferStride,$=t.typedBuffer,k=t.typedBufferStride;for(let z=0;z<r;z++){const G=z*P,B=z*k,W=$[B],q=$[B+1],X=$[B+2];M[G]=s*W+l*q+b*X,M[G+1]=n*W+p*q+x*X,M[G+2]=a*W+y*q+A*X}}function bH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,l=t.typedBufferStride;for(let p=0;p<r;p++){const y=p*n,b=p*l;s[y]=i*a[b],s[y+1]=i*a[b+1],s[y+2]=i*a[b+2]}}function uZ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const p=l*s,y=l*a,b=n[y],x=n[y+1],A=n[y+2],M=Math.sqrt(b*b+x*x+A*A);if(M>0){const P=1/M;r[p]=P*b,r[p+1]=P*x,r[p+2]=P*A}}}function bst(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,l=t.typedBufferStride;for(let p=0;p<r;p++){const y=p*n,b=p*l;s[y]=a[b]>>i,s[y+1]=a[b+1]>>i,s[y+2]=a[b+2]>>i}}Object.freeze({__proto__:null,transformMat4:g4,transformMat3:pw,scale:bH,normalize:uZ,shiftRight:bst});function l8(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&L(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function wst(e,t){if(L(e.symbol))return e.symbol;const i=l8(e,t);return L(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function DSt(e,t){const i=l8(e,t),r=wst(e,t);if(J(r))return null;const s={renderer:i,symbol:r};if(J(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=TY(i,e,t),a=["proportional","proportional","proportional"];for(const{variable:l,value:p}of n)switch(l.type){case"color":s.color=p.toRgba();break;case"size":if(l.target==="outline")s.outlineSize=p;else{const y=l.axis,b=l.useSymbolValue?"symbol-value":p;switch(y){case"width":a[0]=b;break;case"depth":a[1]=b;break;case"height":a[2]=b;break;case"width-and-depth":a[0]=a[1]=b;break;default:a[0]=a[1]=a[2]=b}}break;case"opacity":s.opacity=p;break;case"rotation":switch(l.axis){case"tilt":s.tilt=p;break;case"roll":s.roll=p;break;default:s.heading=p}}return a[0]==="proportional"&&a[1]==="proportional"&&a[2]==="proportional"||(s.size=a),s}async function xst(e,t){if(L(e.symbol))return e.symbol;const i=l8(e,t);return L(i)&&i.getSymbolAsync(e,qe(ie({},t),{abortOptions:{signal:t.signal}}))}async function LSt(e,t){const i=l8(e,t),r=await xst(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=TY(i,e,t),a=["proportional","proportional","proportional"];for(const{variable:l,value:p}of n)if(l.type==="color")s.color=Ft.toUnitRGBA(p);else if(l.type==="size")if(l.target==="outline")s.outlineSize=p;else{const y=l.axis,b=l.useSymbolValue?"symbol-value":p;y==="width"?a[0]=b:y==="depth"?a[1]=b:y==="height"?a[2]=b:a[0]=a[1]=y==="width-and-depth"?b:a[2]=b}else l.type==="opacity"?s.opacity=p:l.type==="rotation"&&l.axis==="tilt"?s.tilt=p:l.type==="rotation"&&l.axis==="roll"?s.roll=p:l.type==="rotation"&&(s.heading=p);return(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(s.size=a),s}function Tst(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function Sst(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function zwe(e,t,i){var r;const s=e.byteLength/(4*t),n=new Uint32Array(e,0,s*t);let a=new Uint32Array(s);const l=(r=i==null?void 0:i.minReduction)!=null?r:0,p=(i==null?void 0:i.originalIndices)||null,y=p?p.length:0,b=(i==null?void 0:i.componentOffsets)||null;let x=0;if(b)for(let X=0;X<b.length-1;X++){const oe=b[X+1]-b[X];oe>x&&(x=oe)}else x=s;const A=Math.floor(1.1*x)+1;(tf==null||tf.length<2*A)&&(tf=new Uint32Array(XT(2*A)));for(let X=0;X<2*A;X++)tf[X]=0;let M=0;const P=!!b&&!!p,$=P?y:s,k=P?new Uint32Array(y):null,z=1.96;let G=l!==0?Math.ceil(4*z*z/(l*l)*l*(1-l)):$,B=1,W=b?b[1]:$;for(let X=0;X<$;X++){if(X===G){const ge=1-M/X;if(ge+z*Math.sqrt(ge*(1-ge)/X)<l)return null;G*=2}if(X===W){for(let ge=0;ge<2*A;ge++)tf[ge]=0;if(p)for(let ge=b[B-1];ge<b[B];ge++)k[ge]=a[p[ge]];W=b[++B]}const oe=P?p[X]:X,de=oe*t,he=Cst(n,de,t);let fe=he%A,me=M;for(;tf[2*fe+1]!==0;){if(tf[2*fe]===he){const ge=tf[2*fe+1]-1;if(Est(n,de,ge*t,t)){me=a[ge];break}}fe++,fe>=A&&(fe-=A)}me===M&&(tf[2*fe]=he,tf[2*fe+1]=oe+1,M++),a[oe]=me}if(l!==0&&1-M/s<l)return null;if(P){for(let X=b[B-1];X<k.length;X++)k[X]=a[p[X]];a=k}const q=new Uint32Array(t*M);M=0;for(let X=0;X<$;X++)a[X]===M&&(Ast(n,(P?p[X]:X)*t,q,M*t,t),M++);if(p&&!P){const X=new Uint32Array(y);for(let oe=0;oe<X.length;oe++)X[oe]=a[p[oe]];a=X}return{buffer:q.buffer,indices:a,uniqueCount:M}}function Est(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function Ast(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function Cst(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let tf=null;function NSt(e){const t=y4(e.rings,e.hasZ,_0.CCW_IS_HOLE),i=[];let r=0,s=0;for(const l of t.polygons){const p=l.count,y=l.index,b=new Float64Array(t.position.buffer,3*y*t.position.BYTES_PER_ELEMENT,3*p),x=l.holeIndices.map(M=>M-y),A=new Uint32Array(XS(b,x,3));i.push({position:b,faces:A}),r+=b.length,s+=A.length}const n=Mst(i,r,s),a=zwe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(a.buffer),n.faces=a.indices,n}function Mst(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,a=0,l=0;for(const p of e){for(let y=0;y<p.position.length;y++)r[n++]=p.position[y];for(let y=0;y<p.faces.length;y++)s[a++]=p.faces[y]+l;l=n/3}return{position:r,faces:s}}function y4(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),a=new Array(r);let l=0,p=0,y=0,b=0;for(let M=0;M<r;++M)b+=e[M].length;const x=new Float64Array(3*b);let A=0;for(let M=r-1;M>=0;M--){const P=e[M],$=i===_0.CCW_IS_HOLE&&Rst(P);if($&&r!==1)s[l++]=P;else{let k=P.length;for(let G=0;G<l;++G)k+=s[G].length;const z={index:A,pathLengths:new Array(l+1),count:k,holeIndices:new Array(l)};z.pathLengths[0]=P.length,P.length>0&&(a[y++]={index:A,count:P.length}),A=$?mP(P,P.length-1,-1,x,A,P.length,t):mP(P,0,1,x,A,P.length,t);for(let G=0;G<l;++G){const B=s[G];z.holeIndices[G]=A,z.pathLengths[G+1]=B.length,B.length>0&&(a[y++]={index:A,count:B.length}),A=mP(B,0,1,x,A,B.length,t)}l=0,z.count>0&&(n[p++]=z)}}for(let M=0;M<l;++M){const P=s[M];P.length>0&&(a[y++]={index:A,count:P.length}),A=mP(P,0,1,x,A,P.length,t)}return p<r&&(n.length=p),y<r&&(a.length=y),{position:x,polygons:n,outlines:a}}function mP(e,t,i,r,s,n,a){s*=3;for(let l=0;l<n;++l){const p=e[t];r[s++]=p[0],r[s++]=p[1],r[s++]=a?p[2]:0,t+=i}return s/3}function Rst(e){return!kW(e,!1,!1)}var _0;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(_0||(_0={}));var UM,wH,aT;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(UM||(UM={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(wH||(wH={})),function(e){e[e.LAYER_VIEW=0]="LAYER_VIEW",e[e.EXTERNAL=1]="EXTERNAL"}(aT||(aT={}));var Tn,Ia,YS,Do,vo;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Tn||(Tn={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ia||(Ia={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(YS||(YS={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(Do||(Do={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(vo||(vo={}));class Ost{constructor(t,i){this.vec3=t,this.id=i}}function zM(e,t,i,r){return new Ost($t(e,t,i),r)}var ia;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(ia||(ia={}));class Uoe{constructor(t,i){this.index=t,this.renderTargets=i,this.extent=Mi(),this.resolution=0,this.renderLocalOrigin=zM(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Ist,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTarget(t){return this.validTargets[t]?this.renderTargets.getTarget(t):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===ia.ColorAndWater?this.renderTargets.getTarget(Do.Color):t===ia.Highlight?this.renderTargets.getTarget(Do.Highlight):this.renderTargets.getTarget(Do.Occluded);return i?i.getTexture():null}getNormalTexture(t){const i=t===ia.ColorAndWater?this.renderTargets.getTarget(Do.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield(),s=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)n.type===Do.ColorNoRasterImage&&s===!1?this.validTargets[n.type]=!1:this.validTargets[n.type]=t.drawTarget(this,n,i);return r^this.computeRenderTargetValidityBitfield()?PS.CHANGED:PS.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Do.Color]|+t[Do.ColorNoRasterImage]<<1|+t[Do.Highlight]<<2|+t[Do.Water]<<3|+t[Do.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this.extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];M6(this.extent,t.range,0,r)}if(this.extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];M6(this.extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,bv(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Tn.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function Pst(e,t,i){return Math.min(XT(Math.max(e,t)+256),i)}class Ist{constructor(){this.extents=[Mi(),Mi(),Mi()],this.numViews=0}}class Bwe{constructor(t,i){this.size=hZ(),this._fbo=null,this._fbo=new Hr(t,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Xt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(t=(i=this._fbo)==null?void 0:i.gpuMemoryUsage)!=null?t:0}}class $st{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new Bwe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(bt.MATERIAL,Do.Color),i(bt.MATERIAL,Do.ColorNoRasterImage),i(bt.MATERIAL_HIGHLIGHT,Do.Highlight,!1),i(bt.MATERIAL_NORMAL,Do.Water),i(bt.MATERIAL,Do.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>Dst)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const Dst=1e3;class dZ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class Lst{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}class Vwe{constructor(t){this._context=t,this._perConstructorInstances=new dZ,this._frameCounter=0,this._keepAliveFrameCount=zoe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(J(s)){const n=new t(this._context,i,()=>this.release(n));s=new Lst(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(L(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(J(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);J(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==zoe&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,a)=>{const l=a.shader;l&&(await l.reload(),n.forEach(p=>{p.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}const zoe=-1,c8=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const s of(r=this._managedDisposables)!=null?r:[]){var r;const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class h8 extends c8(class{}){}function ra(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(i=(r=e._managedDisposables)==null?void 0:r.slice())!=null?i:[]),e._managedDisposables.unshift(t)}}class Gwe{constructor(){this.adds=new Ci,this.removes=new Ci,this.updates=new Ci({allocator:t=>t||new Nst,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Nst{}class Fst{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}function jwe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new Fst,t.set(r,s)),s};return e.removes.forAll(r=>{kk(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{kk(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{kk(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function kk(e){return e.data.indexCount>=1}class Hwe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{L(t)&&this._repository.release(this._material,fw(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,fw(i)));const r=this._map.get(i);if(L(r)){if(r.ensureResources(t)===Gl.LOADED)return r;this._repository.requestRender()}return null}}function fw(e){switch(e){default:case bt.MATERIAL:return Te.Color;case bt.MATERIAL_ALPHA:return Te.Alpha;case bt.MATERIAL_DEPTH_SHADOWMAP_ALL:return Te.Shadow;case bt.MATERIAL_NORMAL:return Te.Normal;case bt.MATERIAL_DEPTH:return Te.Depth;case bt.MATERIAL_HIGHLIGHT:return Te.Highlight;case bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return Te.Shadow}}var Ni;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(Ni||(Ni={}));function $g(e){e.fragment.include(qp),e.fragment.uniforms.add("shadowMapTex","sampler2D"),e.fragment.uniforms.add("numCascades","int"),e.fragment.uniforms.add("cascadeDistances","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(V`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = cascadeDistances;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function kst(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function Ust(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}function zst(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}function Bst(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMatrix","mat4"),e.fragment.uniforms.add("proj","mat4"),e.fragment.code.add(V`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function Vst(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMatrix",t.reprojectionMatrix),e.setUniformMatrix4fv("proj",t.camera.projectionMatrix)}function Gst(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("view","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(Yn),e.include(Bst),e.fragment.code.add(V`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function pZ(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("view",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),Vst(e,t))}function jst(e){e.fragment.code.add(V`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Hst(e){e.fragment.code.add(V`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Boe(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(jst),e.fragment.code.add(V`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function qst(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}function v4(e,t){t.output===Te.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(V`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===Te.Depth||t.output===Te.Shadow?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("nearFar","vec2"),e.vertex.code.add(V`void forwardLinearDepth() {
linearDepth = (-position_view().z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(V`void forwardLinearDepth() {}`)}function rv(e,t){t.viewingMode===vt.Global?e.vertex.code.add(V`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(V`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.viewingMode===vt.Global?e.vertex.code.add(V`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(V`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Wst(e){const t=e.fragment.code;t.add(V`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(V`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(V`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function u8(e,t){const i=e.fragment.code;e.include(FN),t.pbrMode===fi.Water||t.pbrMode===fi.WaterOnIntegratedMesh?(i.add(V`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(V`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(V`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(V`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(V`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==fi.Normal&&t.pbrMode!==fi.Schematic||(e.include(Wst),i.add(V`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(V`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(V`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(V`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(V`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(V`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function qwe(e,t){e.include(u8,t),e.include(DN),e.include(Hst),t.cloudsReflectionsEnabled&&e.include(Q_e),t.ssrEnabled&&e.include(Gst,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),e.fragment.code.add(V`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(V`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.cloudsReflectionsEnabled&&e.fragment.code.add(V`vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);`),t.ssrEnabled?e.fragment.code.add(V`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):e.fragment.code.add(V`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.cloudsReflectionsEnabled?t.ssrEnabled?e.fragment.code.add(V`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):e.fragment.code.add(V`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):e.fragment.code.add(V`return waterRenderedColor;
}`)}function Xst(e){const t=new Ir;return t.include(da,{linearDepth:!1}),t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.UV0,"vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),e.output!==Te.Color&&e.output!==Te.Alpha||(t.include(rv,e),t.include(v4,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.fragment.uniforms.add("localOrigin","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(V`
      void main(void) {
        if (waterColor.a < ${V.float(fa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===Te.Color?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),e.output===Te.Alpha&&(t.include(Ws,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(V`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===Te.Color&&(t.include(NN),t.include(rJ,{pbrMode:fi.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Boe,e),t.include(Ws,e),e.receiveShadows&&t.include($g,e),t.include(qwe,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("lightingSpecularStrength","float").add("lightingEnvironmentStrength","float").add("cameraPosition","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(P0),t.fragment.code.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?V`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===Te.Normal&&(t.include(rv,e),t.include(Boe,e),t.include(Ws,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(V`
        void main(void) {
          if (waterColor.a < ${V.float(fa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(V`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===Te.Draped&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(V`
        void main(void) {
          if (waterColor.a < ${V.float(fa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(V`void main() {
gl_FragColor = waterColor;
}`)),e.output===Te.Highlight&&(t.include(Yg),t.varyings.add("vpos","vec3"),t.vertex.code.add(V`
      void main(void) {
        if (waterColor.a < ${V.float(fa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Ws,e),t.fragment.code.add(V`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Yst=Object.freeze({__proto__:null,build:Xst});class d8 extends Xr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeProgram(t){const i=d8.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,viewingMode:t.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:fi.Water,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,cloudsReflectionsEnabled:je("enable-feature:clouds-reflections"),highStepCount:!0,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,mr)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),i.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i)),this.configuration.output===Te.Color&&(i.lighting.setUniforms(this.program,!1,!1),pZ(this.program,i),je("enable-feature:clouds-reflections")&&L(i.cloudsCompositionParams)&&ebe(this.program,i.camera,i.cloudsCompositionParams)),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Normal||(qst(this.program,t),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",t.color),this.configuration.output===Te.Highlight&&D0(this.program,i)}bindDraw(t){I0(this.program,t),this.program.rebindTextures(),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Alpha||Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),this.configuration.output===Te.Color&&kst(this.program,t),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Alpha&&this.configuration.output!==Te.Highlight||kw(this.program,this.configuration,t)}_setPipelineState(t){const i=this.configuration,r=t===Qt.NONE,s=t===Qt.FrontFace;return Ti({blending:i.output!==Te.Normal&&i.output!==Te.Highlight&&i.transparent?r?Qc:Zg(t):null,depthTest:{func:Jv(t)},depthWrite:r?i.writeDepth&&ac:e8(t),colorWrite:Ii,polygonOffset:r||s?null:r8(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}d8.shader=new Ur(Yst,()=>import("./WaterSurface.glsl.b81be066.js"));class Pu extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],Pu.prototype,"output",void 0),_([Oe()],Pu.prototype,"receiveShadows",void 0),_([Oe()],Pu.prototype,"slicePlaneEnabled",void 0),_([Oe()],Pu.prototype,"transparent",void 0),_([Oe()],Pu.prototype,"enableOffset",void 0),_([Oe()],Pu.prototype,"writeDepth",void 0),_([Oe()],Pu.prototype,"useSSR",void 0),_([Oe()],Pu.prototype,"isDraped",void 0),_([Oe({count:Qt.COUNT})],Pu.prototype,"transparencyPassType",void 0),_([Oe()],Pu.prototype,"multipassTerrainEnabled",void 0),_([Oe()],Pu.prototype,"cullAboveGround",void 0);class Voe extends Xg{updateParameters(t){return this.ensureTechnique(d8,t)}setElapsedTimeUniform(t){const i=.001*this._material.animation.time;t.setUniform1f("timeElapsed",i*this._material.parameters.animationSpeed)}_updateShadowState(t){t.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMappingEnabled})}_updateSSRState(t){t.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:t.ssrEnabled})}ensureResources(t){const i=this._techniqueRep.constructionContext.waterTextureRepository;return i.ready||i.updating||i.loadTextures(t),i.ready?Gl.LOADED:Gl.LOADING}beginSlot(t){return this._output===Te.Color&&(this._updateShadowState(t),this._updateSSRState(t)),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.parameters,t),this._output!==Te.Normal&&this._output!==Te.Color||this.setElapsedTimeUniform(i.program)}}const Jst=on().vec3f(Y.POSITION),Zst=on().vec3f(Y.POSITION).vec2f(Y.UV0),Wwe=on().vec3f(Y.POSITION).vec4u8(Y.COLOR);class p8{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(Y.POSITION).length}write(t,i,r,s){QN(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const Xwe=ie({waveStrength:.06,waveTextureRepeat:32,waveDirection:yr(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1},Sd),Kst={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};class Ywe extends Wp{constructor(t){super(t,Xwe),this._techniqueConfig=new Pu,this.animation=new fbe}getTechniqueConfig(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<t8,this._techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=i.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<Qst;const r=this.animation.advance(t);return this.animation.enabled&&r}intersect(t,i,r,s,n,a,l){KN(t,i,s,n,a,void 0,l)}requiresSlot(t,i){switch(fw(i)){case Te.Normal:return t===tt.DRAPED_WATER;case Te.Color:if(this.parameters.isDraped)return t===tt.DRAPED_MATERIAL;break;case Te.Highlight:return t===tt.OPAQUE_MATERIAL||t===tt.DRAPED_MATERIAL}let r=tt.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===Te.Color&&this.parameters.isDraped)return t.output=Te.Draped,new Voe(t);switch(t.output){case Te.Color:case Te.Normal:case Te.Highlight:case Te.Alpha:return new Voe(t)}return null}createBufferWriter(){return new p8(Zst)}}const Qst=35e3;class Goe{constructor(t){this.first=t.from,this.count=t.to-t.from}}class A3{constructor(t=0,i=0){this.from=t,this.to=i}}class ent extends A3{constructor(t,i,r,s,n,a){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=a}}function joe(e){return Array.from(e.values()).sort(tnt)}function tnt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function gP(e,t){if(e.length===0)return void e.push(new Goe(t));const i=e[e.length-1];if(int(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new Goe(t))}function int(e,t){return e.first+e.count>=t.from}class rnt{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(xH(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=snt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const a=this._pool.newBuffer(s);i&&(a.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),a.vao.vertexBuffers.geometry.setSubData(a.array,0,0,a.array.byteLength)),r=this._buffer,this._buffer=a}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(a,l,p)=>this._buffer.array.set(r.array.subarray(l,p),a),hasNewBuffer:!0}:{dispose:()=>{},copy:(a,l,p)=>{a!==l&&this._buffer.array.copyWithin(a,l,p)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const Hoe=65536;function xH(e){return Math.ceil(e/Hoe)*Hoe}function snt(e,t,i){return t<=i?e>=i?e:xH(Math.max(2*e,i)):e<=2*i?e:xH(i)}class nnt{constructor(t,i,r,s){this.vao=new In(t,i,{geometry:r},{geometry:Fi.createVertex(t,tr.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const ont=R9+1;class ant{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${ec()}`,lnt)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(L(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,ont),s}return new nnt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return L(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function lnt(e,t){if(t===Hm.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class Jwe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Ci,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Hwe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new ant(t,r.vertexAttributeLocations,ch(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof Ywe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==qs.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,a=hnt(t,i);a.forEach((l,p)=>{a.delete(p);const y=l.toAdd.reduce((z,G)=>z+r.elementCount(G.data),0);let b=n.get(p);if(b==null)Kt(l.toRemove.length===0),b=new dnt(l.origin,new rnt(this._bufferPool,y*s)),n.set(p,b);else if(l.toAdd.length===0&&b.instances.size===l.toRemove.length)return b.buffer.dispose(),void n.delete(p);let x=0;b.instances.forEach(z=>x+=z.to-z.from);const A=l.toRemove.reduce((z,G)=>z+r.elementCount(G.data),0),M=b.buffer.size,P=(x+y-A)*s,$=fnt;if(P<M/2?this._removeAndRebuild(b,l.toRemove,s,P,$):l.toRemove.length>0&&this._remove(b,l.toRemove,s,$),l.toAdd.length>0){const z=mnt;cbe(z,-l.origin[0],-l.origin[1],-l.origin[2]),this._add(b,l.toAdd,s,z,$)}const k=b.buffer.vao.vertexBuffers.geometry;Xoe($),$.forAll(({from:z,to:G})=>{if(z<G){const B=b.buffer.array,W=4,q=z*W,X=G*W;k.setSubData(B,q,q,X)}}),$.clear(),b.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,a=this._dataByOrigin.get(n.origin.id),l=a&&a.instances.get(n.id);if(!l)return;const p=s.updateType;if(p&Ni.State.VISIBILITIES&&(l.isVisible=n.instanceParameters.visible),p&(Ni.State.HIGHLIGHTS|Ni.State.VISIBILITIES)){const y=n.instanceParameters.visible;l.hasHighlights=!!n.instanceParameters.highlights&&y}if(p&Ni.State.OCCLUDEES&&(l.hasOccludees=!!n.instanceParameters.occludees),p&(Ni.State.VERTEXATTRS|Ni.State.TRANSFORMATION)){const{array:y,vao:b}=a.buffer;KZe(n,Uk,gA),i.write({transformation:Uk,invTranspTransformation:gA},n.data,i.vertexBufferLayout.createView(y.buffer),l.from),Kt(l.from+i.elementCount(n.data)===l.to,"material VBO layout has changed"),b.vertexBuffers.geometry.setSubData(y,l.from*r*4,l.from*r*4,l.to*r*4)}a.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,rn(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!Woe(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=joe(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?gP(i.drawCommandsOccludees,s):gP(i.drawCommandsDefault,s),s.hasHighlights?gP(i.drawCommandsHighlight,s):gP(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i,r){if(!this.requiresSlot(t,i))return!1;const s=i===bt.MATERIAL_HIGHLIGHT||i===bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(s&&!this._hasHighlights)return!1;const n=i===bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,a=!(s||n);if(this._dataByOrigin.forEach(b=>{if(s&&!b.hasHighlights)return;const x=(s?b.drawCommandsHighlight:n&&Woe(b)?b.drawCommandsShadowHighlightRest:b.drawCommandsDefault)||null,A=a&&b.drawCommandsOccludees||null;(L(x)||L(A))&&this._renderCommandData.push(new pnt(b.origin,b.buffer,x,A))}),this._renderCommandData.length===0)return!1;const l=this._rctx,p=this._glMaterials.load(l,i);if(J(p))return this._renderCommandData.clear(),!1;const y=p.beginSlot(r);return l.useTechnique(y,t,!1),p.bind(r,y),this._renderCommandData.forAll(({origin:b,buffer:x,renderCommands:A,occludeeCommands:M})=>{r.origin=b,y.bindDraw(r),y.ensureAttributeLocations(x.vao),l.bindVAO(x.vao);const P=y.primitiveType;L(A)&&this._renderCommands(l,P,A),L(M)&&(y.bindPipelineState(l,t,!0),this._renderCommands(l,P,M),y.bindPipelineState(l,t,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const b of i)t.instances.delete(b.id);const a=joe(t.instances);t.instances.clear();const l=t.buffer.size,p=t.buffer.alloc(s);let y=0;for(const b of a){const x=b.from*r,A=b.to*r;p.copy(y,x,A),b.from=y/r,y+=A-x,b.to=y/r,t.instances.set(b.id,b)}n.push(new A3(0,p.hasNewBuffer?t.buffer.array.length:l)),p.dispose(),t.buffer.erase(y,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const a=n.id,l=t.instances.get(a),p=l.from*r,y=l.to*r;t.buffer.erase(p,y),t.holes.push(new A3(l.from,l.to)),t.instances.delete(a),s.push(new A3(p,y))}Xoe(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const a=this._bufferWriter;let l=a.vertexBufferLayout.createView(t.buffer.array.buffer);const p=t.holes.length>0;let y=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;for(const x of i){const A=L(x.transformation)?As(Uk,s,x.transformation):s;Ms(gA,A);const M=oc(gA,gA),P=a.elementCount(x.data),$=P*r;let k=unt(t.holes,P);J(k)&&(k=t.buffer.size/r,t.buffer.grow($),l=a.vertexBufferLayout.createView(t.buffer.array.buffer)),a.write({transformation:A,invTranspTransformation:M},x.data,l,k);const z=x.instanceParameters.visible,G=!!x.instanceParameters.highlights&&z,B=!!x.instanceParameters.occludees,W=new ent(x.id,k,k+P,z,G,B);Kt(t.instances.get(x.id)==null),t.instances.set(x.id,W),p?n.push(new A3(W.from*r,W.to*r)):(y=Math.min(W.from,y),b=Math.max(W.to,b))}p||n.push(new A3(y*r,b*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class cnt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function hnt(e,t){const i=new Map;for(const r of e)qoe(i,r,!0);for(const r of t)qoe(i,r,!1);return i}function qoe(e,t,i){const r=t.origin;if(J(r))return;let s=e.get(r.id);s==null&&(s=new cnt(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function Woe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function unt(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Xoe(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class dnt{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new Ci({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class pnt{constructor(t,i,r,s){this.origin=t,this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const fnt=new Ci({deallocator:null}),mnt=lt(),Uk=lt(),gA=lt();let Kb=class extends st{constructor(){super(...arguments),this._pending=new gnt,this._changes=new Gwe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Ci,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return rn(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=jwe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let a=this._materialRenderers.get(n);if(!a&&s.adds.length>0&&(a=new Jwe(this.rctx,this.materialRepository,n),this._materialRenderers.set(n,a),t=!0,i=!0,r=!0),!a)return;const l=i||a.hasHighlights,p=r||a.hasWater;a.modify(s),i=i||l!==a.hasHighlights,r=r||p!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=rn(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=rn(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}add(e){if(e.length===0)return;const t=this._pending.empty;for(const i of e)this._pending.adds.add(i);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const i of e)this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=r,s.updateType=t}i&&this._changes.updates.length>0&&this.notifyChange("updating")}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(t.slot,e.pass,t)}}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};_([S()],Kb.prototype,"rctx",void 0),_([S()],Kb.prototype,"materialRepository",void 0),_([S()],Kb.prototype,"updating",null),Kb=_([re("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Kb);class gnt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const FSt=(()=>{if(!("document"in globalThis))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d"),i=512;return e.height=i,e.width=1,r=>{t.clearRect(0,0,1,e.height);const s=t.createLinearGradient(0,0,0,e.height);for(const{ratio:n,color:a}of r)s.addColorStop(Math.max(n,.001),`rgba(${a.r}, ${a.g}, ${a.b}, ${a.a})`);return t.fillStyle=s,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function kSt(e,t,i,r){const{blurRadius:s,fieldOffset:n,field:a}=t,l=new Float64Array(i*r),p=Zwe(s),y=Math.round(3*s);let b,x=Number.NEGATIVE_INFINITY;const A=ynt(a,n),M=new Set;for(const P of e){const $=P.getCursor();for(;$.next();){const k=$.getObjectId();if(M.has(k))continue;M.add(k);const z=$.readLegacyPointGeometry(),G=128;if(z.x<-G||z.x>=i+G||z.y<-G||z.y>r+G)continue;const B=+A($),W=Math.round(z.x)-y,q=Math.round(z.y)-y,X=Math.max(0,W),oe=Math.max(0,q),de=Math.min(r,Math.round(z.y)+y),he=Math.min(i,Math.round(z.x)+y);for(let fe=oe;fe<de;fe++){const me=p[fe-q];for(let ge=X;ge<he;ge++){const Ce=p[ge-W];b=l[fe*i+ge]+=me*Ce*B,b>x&&(x=b)}}}}return{matrix:l.buffer,max:x}}function Zwe(e){const t=Math.round(3*e),i=2*e*e,r=new Float64Array(2*t+1);for(let s=0;s<=r.length;s++)r[s]=Math.exp(-((s-t)**2)/i)/Math.sqrt(2*Math.PI)*(e/2);return r}function ynt(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var ou;function vnt(e){const t=new Ir,{mode:i,isAttributeDriven:r}=e;return t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.UV0,"vec2"),e.isAttributeDriven&&(t.attributes.add(Y.FEATUREATTRIBUTE,"float"),t.varyings.add("attributeValue","float")),t.varyings.add("unitCirclePos","vec2"),t.vertex.uniforms.add("radius","float"),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),t.vertex.code.add(V`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${Y.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${r?V`attributeValue = ${Y.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `),i===ou.KernelDensity?t.fragment.code.add(V`
      void main() {
        float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
        if (radiusRatioSquared > 1.0) {
          discard;
        }

        float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
        float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${r?V` * attributeValue`:""};
        gl_FragColor = vec4(density);
      }
    `):i===ou.GaussianBlur&&(t.fragment.uniforms.add("kernel","sampler2D"),t.fragment.code.add(V`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      vec2 uv = abs(unitCirclePos);
      vec2 uvX = vec2(uv.x, 0.5);
      vec2 uvY = vec2(uv.y, 0.5);
      float intensity = texture2D(kernel, uvX).r * texture2D(kernel, uvY).r${r?V` * attributeValue`:""};
      gl_FragColor = vec4(intensity);
    }
  `)),t}(function(e){e[e.GaussianBlur=0]="GaussianBlur",e[e.KernelDensity=1]="KernelDensity"})(ou||(ou={}));const _nt=Object.freeze({__proto__:null,get HeatmapMode(){return ou},build:vnt});var Yoe;(function(e){e[e.Screen=0]="Screen",e[e.World=1]="World"})(Yoe||(Yoe={}));class f8 extends Xr{constructor(t,i,r){super(t,i,r),this._kernelBlurRadius=1;const{R32F:s,textureFloatLinear:n}=t.rctx.capabilities.textureFloat,a=s!=null;this._kernelTextureChannels=a?1:4,this._floatInterpolationDisabled=!n;const l={target:Yt.TEXTURE_2D,pixelFormat:a?_t.RED:_t.RGBA,internalFormat:a?Jt.R32F:_t.RGBA,dataType:ai.FLOAT,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:1,height:1};this._kernel=new Vt(t.rctx,l)}initializeProgram(t){const i=f8.shader.get().build({isAttributeDriven:this.configuration.isAttributeDriven,mode:this.configuration.mode});return new $r(t.rctx,i,mr)}initializePipeline(){return Ti({blending:su(ht.ONE,ht.ONE,f0.ADD),colorWrite:Ii,depthTest:null,depthWrite:null})}bindPass(t,i){const{camera:r}=i,{mode:s}=this.configuration;switch(hh(this.program,r.projectionMatrix),s){case ou.KernelDensity:this._bindKernelDensityPass(t,i);break;case ou.GaussianBlur:this._bindGaussianBlurPass(t,i)}}bindDraw(t){I0(this.program,t)}_bindKernelDensityPass({searchRadius:t,resolutionForScale:i},{camera:r,screenToWorldRatio:s}){i!==0&&(t/=s/i),this.program.setUniform1f("radius",t*r.pixelRatio/r.fullViewport[2])}_bindGaussianBlurPass({searchRadius:t,resolutionForScale:i},{camera:r,screenToWorldRatio:s}){const n=Math.round(t),a=3*(i===0?n:n*i/s);i===0||this._floatInterpolationDisabled?this._kernel.setSamplingMode(Pt.NEAREST):this._kernel.setSamplingMode(Pt.LINEAR),this._kernelBlurRadius!==n&&this._recomputeKernel(n),this.program.setUniform1f("radius",2*a*r.pixelRatio/r.fullViewport[2]),this.program.bindTexture(this._kernel,"kernel")}_recomputeKernel(t){const i=Zwe(t),r=Math.ceil(i.length/2),s=this._kernelTextureChannels,n=new Float32Array(r*s);for(let a=0;a<r;++a){const l=i[r-1-a];for(let p=0;p<s;++p)n[a*s+p]=l}this._kernel.resize(r,1),this._kernel.setData(n),this._kernelBlurRadius=t}destroy(){this._kernel=Xt(this._kernel),super.destroy()}}f8.shader=new Ur(_nt,()=>import("./HeatmapDensity.glsl.7d27125b.js"));class TH extends Rs{constructor(){super(...arguments),this.isAttributeDriven=!1,this.mode=ou.GaussianBlur}}_([Oe()],TH.prototype,"isAttributeDriven",void 0),_([Oe()],TH.prototype,"mode",void 0);const bnt=ie({searchRadius:128,resolutionForScale:0,colorRampData:null,isAttributeDriven:!1,minDensity:0,maxDensity:100,fieldTotal:0,pixelRatio:1},Sd);class wnt extends Wp{constructor(t){super(t,bnt),this._techniqueConfig=new TH}requiresSlot(t,i){return t===tt.DRAPED_MATERIAL&&i===bt.MATERIAL}getTechniqueConfig(){return this._techniqueConfig.isAttributeDriven=this.parameters.isAttributeDriven,this._techniqueConfig}createGLMaterial(t){return new xnt(t)}intersect(){}createBufferWriter(){return new Tnt(this.parameters.isAttributeDriven?Snt:Kwe)}}class xnt extends Xg{constructor(t){super(t)}beginSlot(t){return this.updateParameters(t)}updateParameters(t){return this.ensureTechnique(f8,t)}bind(t,i){i.bindPass(this._material.parameters,t)}}class Tnt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(Y.POSITION).length*zk}write(t,i,r,s){h4(i.indices.get(Y.POSITION),i.vertexAttributes.get(Y.POSITION).data,t.transformation,r.position,s,zk);const n=i.indices.get(Y.POSITION).length,a=r.uv0;let l=s;for(let y=0;y<n;++y)a.setValues(l++,-1,-1),a.setValues(l++,1,-1),a.setValues(l++,1,1),a.setValues(l++,1,1),a.setValues(l++,-1,1),a.setValues(l++,-1,-1);const p="featureAttribute"in r?r.featureAttribute:null;p&&xtt(i.indices.get(Y.FEATUREATTRIBUTE),i.vertexAttributes.get(Y.FEATUREATTRIBUTE).data,p,s,zk)}}const Kwe=on().vec3f(Y.POSITION).vec2f(Y.UV0),Snt=Kwe.clone().f32(Y.FEATUREATTRIBUTE),zk=6;function Ent(e){return e instanceof wnt}function Ant(e){const t=new Ir,{mode:i}=e;return t.include(Xv),t.include(fg,{alphaDiscardMode:Pr.Blend}),t.fragment.uniforms.add("densityMap","sampler2D"),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("densityNormalizer","float"),t.fragment.uniforms.add("minDensity","float"),i===ou.KernelDensity&&t.fragment.uniforms.add("densityMultiplier","float"),t.fragment.code.add(V`
    void main() {
      float density = texture2D(densityMap, uv).r${i===ou.KernelDensity?V` * densityMultiplier`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `),t}const Cnt=Object.freeze({__proto__:null,build:Ant,get HeatmapMode(){return ou}});class m8 extends Xr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=m8.shader.get().build({mode:this.configuration.mode});return new $r(t.rctx,i,mr)}initializePipeline(t){return Ti({blending:Qc,colorWrite:Ii,depthTest:null,depthWrite:null})}bindPass(t,i){const{densityMap:r,colorRamp:s,maxDensity:n,minDensity:a,searchRadius:l}=t;this.program.bindTexture(r,"densityMap"),this.program.bindTexture(s,"tex"),this.configuration.mode===ou.KernelDensity&&this.program.setUniform1f("densityMultiplier",3/(l*l*Math.PI)),this.program.setUniform1f("densityNormalizer",1/(n-a)),this.program.setUniform1f("minDensity",a)}get primitiveType(){return mi.TRIANGLE_STRIP}}m8.shader=new Ur(Cnt,()=>import("./Heatmap.glsl.b89a085c.js"));class Qwe extends Rs{constructor(){super(...arguments),this.mode=ou.GaussianBlur}}_([Oe()],Qwe.prototype,"mode",void 0);let zD=class extends Kb{constructor(){super(...arguments),this.type="draped-heatmap"}initialize(){super.initialize();const e={colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE,width:0,height:0},{capabilities:t}=this.rctx,{R32F:i}=t.colorBufferFloat,{textureFloatLinear:r}=t.textureFloat,s=i!=null,n={target:Yt.TEXTURE_2D,pixelFormat:s?_t.RED:_t.RGBA,internalFormat:s?Jt.R32F:_t.RGBA,dataType:ai.FLOAT,samplingMode:r?Pt.LINEAR:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:0,height:0};this._densityMap=new Hr(this.rctx,e,n),this._quad=Ga(this.rctx);const a={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:1,height:1},l=new Vt(this.rctx,a,new Uint8ClampedArray(4));this._colorRamp=l,this._technique=new m8({rctx:this.rctx,viewingMode:vt.Local},new Qwe),this._heatmapParameters={colorRamp:l,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}}destroy(){this._technique=es(this._technique),this._densityMap=Xt(this._densityMap),this._quad=Xt(this._quad),this._colorRamp=Xt(this._colorRamp)}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccluded(){return!1}get _heatmapDensityMaterialRenderers(){return this._sortedMaterialRenderers.filter(Mnt)}add(e){super.add(e)}remove(e){super.remove(e)}render(e,t){const i=this._heatmapDensityMaterialRenderers,r=i.length;if(r<1)return;const s=this.rctx.getBoundFramebufferObject(),n=this.rctx.getViewport(),a=i[0].material.parameters,{pixelRatio:l}=a,p=Math.ceil(n.width*l),y=Math.ceil(n.height*l);this._densityMap.resize(p,y),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,p,y),this.rctx.clear(Sr.COLOR_BUFFER_BIT);let b=!1;for(let z=0;z<r;z++){const G=i[z];G.material.shouldRender(e)&&(b=b||G.materialRenderer.render(t.slot,e.pass,t))}if(this.rctx.bindFramebuffer(s),this.rctx.setViewport(n.x,n.y,n.width,n.height),!b)return;const{searchRadius:x,minDensity:A,maxDensity:M,fieldTotal:P,colorRampData:$}=a,k=this._heatmapParameters;if(k.searchRadius=x,k.fieldTotal=P,k.searchRadius=x,k.minDensity=A,k.maxDensity=M,L($)&&$!==this._colorRampData){const{colorRamp:z}=k,G=z.descriptor.width,B=$.length/4;B!==G&&z.resize(B,1),z.setData($),this._colorRampData=$}this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(k,t),this.rctx.drawArrays(this._technique.primitiveType,0,zo(this._quad,"geometry"))}};function Mnt(e){return Ent(e.material)}zD=_([re("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],zD);const Rnt=Ge.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class Ont{constructor(t){this._glMaterial=t,this.refCnt=0,this._glMaterial=t}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Kt(this.refCnt>=0)}getRefCnt(){return this.refCnt}get glMaterial(){return this._glMaterial}}class exe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new dZ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(J(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new Ont(s),this._id2glMaterialRef.set(i,t.id,r)}return r.incRefCnt(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);L(r)&&(r.decRefCnt(),r.getRefCnt()===0&&(Xt(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){L(t.repository)&&t.repository!==this&&Rnt.error("Material is already owned by a different material repository"),t.repository=this}}const Pnt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class txe{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new js,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),js.clearPool(),SH[0]=null,v_.prune(),Sb.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=js.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}js.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=js.acquire();for(const s of t){const n=L(i)?i:gS(this._objectToBoundingSphere(s),Nnt);WC(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}js.release(r),this._shrink()}update(t,i){if(!WC(i[3])&&this._isDegenerate(t))return;const r=Lnt(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=iu(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const a=n.node;return a.terminals.forAll(l=>{this._intersectsObject(s,l)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObject(s,l)&&r(l)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=iu(t,i);this._forEachNode(this._root,a=>{if(!this._intersectsNodeWithOffset(n,a,s))return!1;const l=a.node;return l.terminals.forAll(p=>{this._intersectsObjectWithOffset(n,p,s)&&r(p)}),l.residents!==null&&l.residents.forAll(p=>{this._intersectsObjectWithOffset(n,p,s)&&r(p)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let a=1/0,l=1/0,p=null;const y=Bk(t,i),b=x=>{if(--n,!s(x))return;const A=this._objectToBoundingSphere(x);if(!ev(r,A))return;const M=Ay(t,i,ru(A)),P=M-A[3],$=M+A[3];P<a&&(a=P,l=$,p=x)};return this._forEachNodeDepthOrdered(this._root,x=>{if(n<=0||!ev(r,x.bounds)||(Ue(pu,y,x.halfSize),Xe(pu,pu,x.bounds),Ay(t,i,pu)>l))return!1;const A=x.node;return A.terminals.forAll(M=>b(M)),A.residents!==null&&A.residents.forAll(M=>b(M)),!0},t,i),p}forEachInDepthRange(t,i,r,s,n,a,l){let p=-1/0,y=1/0;const b={setRange:$=>{r===qh.FRONT_TO_BACK?(p=Math.max(p,$.near),y=Math.min(y,$.far)):(p=Math.max(p,-$.far),y=Math.min(y,-$.near))}};b.setRange(s);const x=Ay(i,r,t),A=Bk(i,r),M=Bk(i,-r),P=$=>{if(!l($))return;const k=this._objectToBoundingSphere($),z=ru(k),G=Ay(i,r,z)-x,B=G-k[3],W=G+k[3];B>y||W<p||!ev(a,k)||n($,b)};this._forEachNodeDepthOrdered(this._root,$=>{if(!ev(a,$.bounds)||(Ue(pu,A,$.halfSize),Xe(pu,pu,$.bounds),Ay(i,r,pu)-x>y)||(Ue(pu,M,$.halfSize),Xe(pu,pu,$.bounds),Ay(i,r,pu)-x<p))return!1;const k=$.node;return k.terminals.forAll(z=>P(z)),k.residents!==null&&k.residents.forAll(z=>P(z)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}_intersectsNode(t,i){return yP(i.bounds,2*-i.halfSize,$h),yP(i.bounds,2*i.halfSize,Dh),nne(t.origin,t.direction,$h,Dh)}_intersectsNodeWithOffset(t,i,r){return yP(i.bounds,2*-i.halfSize,$h),yP(i.bounds,2*i.halfSize,Dh),r.applyToMinMax($h,Dh),nne(t.origin,t.direction,$h,Dh)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||NV(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||NV(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=js.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(js.acquire().init(r).advance(n));js.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=qh.FRONT_TO_BACK){let n=js.acquire().init(t);const a=[n];for(Dnt(r,s,Koe);a.length!==0;){if(n=a.pop(),i(n)&&!n.isLeaf())for(let l=7;l>=0;--l){const p=Koe[l];n.node.children[p]&&a.push(js.acquire().init(n).advance(p))}js.release(n)}}_remove(t,i,r){v_.clear();const s=r.advanceTo(i,(n,a)=>{v_.push(n.node),v_.push(a)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=v_.length-2;n>=0;n-=2){const a=v_.data[n],l=v_.data[n+1];if(!this._purge(a,l))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Ci({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=js.acquire().init(t);this._add(i.getItemAt(r),s),js.release(s)}}_grow(t,i){if(i!==0&&(Joe(t,i,r=>this._objectToBoundingSphere(r),rf),WC(rf[3])&&!this._fitsInsideTree(rf)))if(this._nodeIsEmpty(this._root.node))gS(rf,this._root.bounds),this._root.halfSize=1.25*rf[3];else{const r=this._rootBoundsForRootAsSubNode(rf);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(rf,r):this._growRootAsSubNode(r),js.release(r)}}_rebuildTree(t,i){ke(Gk,i.bounds),Gk[3]=i.halfSize,Joe([t,Gk],2,s=>s,jk);const r=js.acquire().init(this._root);this._root.initFrom(null,jk,1.25*jk[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),js.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let l=0;l<3;l++){const p=n[l]-a-(r[l]-i),y=r[l]+i-(n[l]+a),b=Math.max(0,Math.ceil(p/(2*a))),x=Math.max(0,Math.ceil(y/(2*a)))+1,A=2**Math.ceil(Math.log(b+x)*Math.LOG2E);s=Math.max(s,A),vP[l].min=b,vP[l].max=x}for(let l=0;l<3;l++){let p=vP[l].min,y=vP[l].max;const b=(s-(p+y))/2;p+=Math.ceil(b),y+=Math.floor(b);const x=n[l]-a-p*a*2;Vk[l]=x+(y+p)*a}return Vk[3]=s*a*rxe,js.acquire().initFrom(null,Vk,s*a,0)}_growRootAsSubNode(t){const i=this._root.node;ke(rf,this._root.bounds),rf[3]=this._root.halfSize,this._root.init(t),t.advanceTo(rf,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!WC(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class js{constructor(){this.bounds=qo(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=L(t)?t:js.createEmptyNode(),L(i)&&gS(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=js.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=ixe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*rxe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Ci({shrink:!0}),residents:new Ci({shrink:!0})}}static acquire(){return js._pool.acquire()}static release(t){js._pool.release(t)}static clearPool(){js._pool.prune()}}var qh;function Int(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function $nt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function yP(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Joe(e,t,i,r){if(t===1){const s=i(e[0]);gS(s,r)}else{$h[0]=1/0,$h[1]=1/0,$h[2]=1/0,Dh[0]=-1/0,Dh[1]=-1/0,Dh[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);WC(n[3])&&(Int($h,n),$nt(Dh,n))}Wn(r,$h,Dh,.5),r[3]=Math.max(Dh[0]-$h[0],Dh[1]-$h[1],Dh[2]-$h[2])/2}}function Dnt(e,t,i){if(!Sb.length)for(let r=0;r<8;++r)Sb.push({index:0,distance:0});for(let r=0;r<8;++r){const s=ixe[r];Sb.data[r].index=r,Sb.data[r].distance=Ay(e,t,s)}Sb.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Sb.data[r].index}function Bk(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=Ay(e,t,Zoe[s]);n<i&&(i=n,r=Zoe[s])}return r}function Ay(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function WC(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}js._pool=new mn(js),function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(qh||(qh={}));const ixe=[$t(-1,-1,-1),$t(1,-1,-1),$t(-1,1,-1),$t(1,1,-1),$t(-1,-1,1),$t(1,-1,1),$t(-1,1,1),$t(1,1,1)],Zoe=[$t(-1,-1,-1),$t(-1,-1,1),$t(-1,1,-1),$t(-1,1,1),$t(1,-1,-1),$t(1,-1,1),$t(1,1,-1),$t(1,1,1)],rxe=Math.sqrt(3),SH=[null];function Lnt(e){return SH[0]=e,SH}const Vk=qo(),pu=Q(),$h=Q(),Dh=Q(),v_=new Ci,Nnt=qo(),rf=qo(),Gk=qo(),jk=qo(),vP=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Sb=new Ci,Koe=[0,0,0,0,0,0,0,0];class sxe extends s4{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=Vp.Layer,this.events=new ps,this.isSliceable=!1,this._objects=new Ci,this._stageHandles=new Ei,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)==null||r,this.isPickable=(s=t==null?void 0:t.isPickable)==null||s,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:OS.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of Pnt)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),L(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),L(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),L(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),L(this._octree)&&this._octree.remove(i)}}sync(){L(this._stage)&&this.updatePolicy!==OS.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){L(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return J(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Ht(this._octree)}_createOctree(){this._octree=new txe(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function BD(e){return L(e)&&e.type===Vp.Layer}const fZ={vvSizeEnabled:!1,vvSizeMinSize:Bi(1,1,1),vvSizeMaxSize:Bi(100,100,100),vvSizeOffset:Bi(0,0,0),vvSizeFactor:Bi(1,1,1),vvSizeValue:Bi(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:zs()};function nxe(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add(Y.SIZEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(V`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(Y.SIZE,"float"),e.vertex.code.add(V`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(Y.OPACITYFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(V`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(V`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(Y.COLORFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(V`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(Y.COLOR,"vec4"),e.vertex.code.add(V`vec4 getColor(){
return applyOpacity(color);
}`))}function Zv(e,t){e.fragment.include(qp),t.output===Te.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(V`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===Te.Depth&&e.fragment.code.add(V`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function oxe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Fnt(e,t):knt(e)}function Fnt(e,t){const i=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(qp),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("cameraPosition","vec3"),e.vertex.code.add(V`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),e.vertex.code.add(V`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Unt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),e.vertex.code.add(V`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),e.vertex.code.add(V`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),e.vertex.code.add(V`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?V`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(V`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),e.fragment.code.add(V`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?V`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:V`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?V`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?V`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:V`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?V`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:V`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?e.fragment.code.add(V`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(V`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function knt(e){e.fragment.code.add(V`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const Unt=V.float(.4),VD=1;var Op;function znt(e){const t=new Ir,i=e.capType!==Op.BUTT,r=e.capType===Op.ROUND,s=e.stippleEnabled&&r,n=e.falloffEnabled||s,a=e.innerColorEnabled||r,l=e.stippleEnabled&&e.stippleScaleWithLineWidth||r,p=e.stippleEnabled&&e.stippleScaleWithLineWidth,y=e.stippleEnabled||r;return t.include(FN),t.include(nxe,e),t.include(oxe,qe(ie({},e),{stippleRequiresStretchMeasure:!0})),e.output===Te.Depth&&t.include(Zv,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4"),t.vertex.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.SUBDIVISIONFACTOR,"float"),t.attributes.add(Y.UV0,"vec2"),t.attributes.add(Y.AUXPOS1,"vec3"),t.attributes.add(Y.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),l&&t.varyings.add("vLineWidth","float"),p&&t.varyings.add("vLineSizeInv","float"),a&&t.varyings.add("vLineDistance","float"),n&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),r&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),t.vertex.code.add(V`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(V`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(V`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),t.vertex.code.add(V`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?V`vLineWidth = lineWidth;`:""}
      ${p?V`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),y&&t.vertex.code.add(V`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${r?V`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),t.vertex.code.add(V`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(V`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?V`min(1.0, subdivisionFactor * ${V.float((VD+2)/(VD+1))})`:V`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):t.vertex.code.add(V`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(V`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${i?V`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),t.vertex.code.add(V`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${n||a?V`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${a?V`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${n?V`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),r&&t.vertex.code.add(V`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped||t.vertex.code.add(V`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(V`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?t.vertex.code.add(V`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):t.vertex.code.add(V`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(V`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),t.vertex.code.add(V`
      // Convert back into NDC
      pos.xy = (pos.xy / screenSize) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.include(Ws,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(P0),t.fragment.code.add(V`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?t.fragment.code.add(V`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(r&&t.fragment.code.add(V`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${V.float(fa)}) {
        discard;
      }
    `),s?t.fragment.code.add(V`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${V.float(fa)}, stippleCoverage);
      `):t.fragment.code.add(V`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(V`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&t.fragment.code.add(V`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),t.fragment.code.add(V`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(V`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.fragment.code.add(V`
    if (finalColor.a < ${V.float(fa)}) {
      discard;
    }

    ${e.output===Te.Alpha?V`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===Te.Color?V`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Te.Color&&e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===Te.Highlight?V`gl_FragColor = vec4(1.0);`:""}
    ${e.output===Te.Depth?V`outputDepth(linearDepth);`:""}
  }
  `),t}(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Op||(Op={}));const Bnt=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:VD,get CapType(){return Op},build:znt}),mZ={func:kr.LESS},GD={func:kr.ALWAYS},b0={mask:255},axe={mask:0},Vnt=e=>({function:{func:kr.NOTEQUAL,ref:e,mask:e},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}}),Gnt=e=>({function:{func:kr.ALWAYS,ref:e,mask:e},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.REPLACE}}),Kv={function:{func:kr.ALWAYS,ref:ic.OutlineVisualElementMask,mask:ic.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.ZERO}},kv={function:{func:kr.ALWAYS,ref:ic.OutlineVisualElementMask,mask:ic.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.REPLACE}},lxe={function:{func:kr.EQUAL,ref:ic.OutlineVisualElementMask,mask:ic.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}},cxe={function:{func:kr.NOTEQUAL,ref:ic.OutlineVisualElementMask,mask:ic.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}},hxe=new Map([[Y.POSITION,0],[Y.SUBDIVISIONFACTOR,1],[Y.UV0,2],[Y.AUXPOS1,3],[Y.AUXPOS2,4],[Y.SIZE,6],[Y.SIZEFEATUREATTRIBUTE,6],[Y.COLOR,5],[Y.COLORFEATUREATTRIBUTE,5],[Y.OPACITYFEATUREATTRIBUTE,7]]);class g8 extends Xr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==Te.Highlight}initializeProgram(t){const i=g8.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:r.stippleScaleWithLineWidth,stipplePreferContinuous:r.stipplePreferContinuous,capType:r.capType,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround,wireframe:r.wireframe});return new $r(t.rctx,s,hxe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(hh(this.program,i.camera.projectionMatrix),this.configuration.output===Te.Highlight&&D0(this.program,i),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i)),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit",t.join!=="miter"?0:t.miterLimit),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio),this.program.setUniform2f("screenSize",i.camera.fullViewport[2],i.camera.fullViewport[3]),Q2e(this.program,t),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=L(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/i.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/i.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){const a=t.stippleOffColor;this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],a.length>3?a[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Wt(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*i.camera.pixelRatio))}bindDraw(t){I0(this.program,t),this.stippleEnabled&&!this.configuration.draped&&Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),Nv(this.program,this.configuration,t.slicePlane,{origin:t.origin,view:t.camera.viewMatrix}),this.program.setUniformMatrix4fv("inverseProjectionMatrix",Ms(zO.get(),t.camera.projectionMatrix)),this.program.rebindTextures()}_makePipelineState(t,i){const r=this.configuration,s=t===Qt.NONE,n=t===Qt.FrontFace;return Ti({blending:r.output===Te.Color||r.output===Te.Alpha?s?Qc:Zg(t):null,depthTest:{func:Jv(t)},depthWrite:s?r.writeDepth&&ac:e8(t),colorWrite:Ii,stencilWrite:r.sceneHasOcludees?b0:null,stencilTest:r.sceneHasOcludees?i?kv:Kv:null,polygonOffset:s||n?r.polygonOffset&&Qoe:i8})}initializePipeline(){const t=this.configuration,i=t.polygonOffset&&Qoe;return t.occluder&&(this._occluderPipelineTransparent=Ti({blending:Qc,polygonOffset:i,depthTest:GD,depthWrite:null,colorWrite:Ii,stencilWrite:null,stencilTest:cxe}),this._occluderPipelineOpaque=Ti({blending:Qc,polygonOffset:i,depthTest:GD,depthWrite:null,colorWrite:Ii,stencilWrite:axe,stencilTest:lxe}),this._occluderPipelineMaskWrite=Ti({blending:null,polygonOffset:i,depthTest:mZ,depthWrite:null,colorWrite:null,stencilWrite:b0,stencilTest:kv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?mi.LINES:mi.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===tt.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===tt.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}g8.shader=new Ur(Bnt,()=>import("./RibbonLine.glsl.389b2d7a.js"));const Qoe={factor:0,units:-4};class hn extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.capType=Op.BUTT,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1}}_([Oe({count:Te.COUNT})],hn.prototype,"output",void 0),_([Oe()],hn.prototype,"occluder",void 0),_([Oe()],hn.prototype,"slicePlaneEnabled",void 0),_([Oe()],hn.prototype,"transparent",void 0),_([Oe()],hn.prototype,"polygonOffset",void 0),_([Oe()],hn.prototype,"writeDepth",void 0),_([Oe()],hn.prototype,"draped",void 0),_([Oe()],hn.prototype,"stippleEnabled",void 0),_([Oe()],hn.prototype,"stippleOffColorEnabled",void 0),_([Oe()],hn.prototype,"stippleScaleWithLineWidth",void 0),_([Oe()],hn.prototype,"stipplePreferContinuous",void 0),_([Oe({count:Op.COUNT})],hn.prototype,"capType",void 0),_([Oe()],hn.prototype,"roundJoins",void 0),_([Oe()],hn.prototype,"vvSize",void 0),_([Oe()],hn.prototype,"vvColor",void 0),_([Oe()],hn.prototype,"vvOpacity",void 0),_([Oe()],hn.prototype,"falloffEnabled",void 0),_([Oe()],hn.prototype,"innerColorEnabled",void 0),_([Oe()],hn.prototype,"sceneHasOcludees",void 0),_([Oe({count:Qt.COUNT})],hn.prototype,"transparencyPassType",void 0),_([Oe()],hn.prototype,"multipassTerrainEnabled",void 0),_([Oe()],hn.prototype,"cullAboveGround",void 0),_([Oe()],hn.prototype,"wireframe",void 0);const jnt=Ge.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Rc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Rc||(Rc={}));class lT extends Wp{constructor(t){super(t,qnt),this._vertexAttributeLocations=hxe,this.techniqueConfig=new hn,this.layout=this.createLayout()}isClosed(t,i){return uxe(this.parameters,t,i)}dispose(){}getPassParameters(){return this.parameters}getTechniqueConfig(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===tt.DRAPED_MATERIAL;const r=L(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&L(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&L(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===qs.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,a,l,p,y){L(y)?this._intersectDrapedLineGeometry(t,s,y,a,l):this._intersectLineGeometry(t,i,r,s,l)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const a=t.vertexAttributes.get(Y.POSITION).data,l=t.vertexAttributes.get(Y.SIZE);let p=this.parameters.width;if(this.parameters.vvSizeEnabled){const P=t.vertexAttributes.get(Y.SIZEFEATUREATTRIBUTE).data[0];p*=Ot(this.parameters.vvSizeOffset[0]+P*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(p*=l.data[0]);const y=s[0],b=s[1],x=(p/2+4)*t.screenToWorldRatio;let A=Number.MAX_VALUE,M=0;for(let P=0;P<a.length-5;P+=3){const $=a[P],k=a[P+1],z=y-$,G=b-k,B=a[P+3]-$,W=a[P+4]-k,q=Ot((B*z+W*G)/(B*B+W*W),0,1),X=B*q-z,oe=W*q-G,de=X*X+oe*oe;de<A&&(A=de,M=P/3)}A<x*x&&n(r.dist,r.normal,M,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||n4(i))return;if(!hbe(r))return void jnt.error("intersection assumes a translation-only matrix");const a=t.vertexAttributes,l=a.get(Y.POSITION).data;let p=this.parameters.width;if(this.parameters.vvSizeEnabled){const z=a.get(Y.SIZEFEATUREATTRIBUTE).data[0];p*=Ot(this.parameters.vvSizeOffset[0]+z*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(Y.SIZE)&&(p*=a.get(Y.SIZE).data[0]);const y=s.camera,b=Xnt;Pn(b,s.point);const x=p*y.pixelRatio/2+4*y.pixelRatio;ze(yA[0],b[0]-x,b[1]+x,0),ze(yA[1],b[0]+x,b[1]+x,0),ze(yA[2],b[0]+x,b[1]-x,0),ze(yA[3],b[0]-x,b[1]-x,0);for(let z=0;z<4;z++)if(!y.unprojectFromRenderScreen(yA[z],X0[z]))return;Pa(y.eye,X0[0],X0[1],qk),Pa(y.eye,X0[1],X0[2],Wk),Pa(y.eye,X0[2],X0[3],Xk),Pa(y.eye,X0[3],X0[0],Yk);let A=Number.MAX_VALUE,M=0;const P=EH(this.parameters,a,t.indices)?l.length-2:l.length-5;for(let z=0;z<P;z+=3){El[0]=l[z]+r[12],El[1]=l[z+1]+r[13],El[2]=l[z+2]+r[14];const G=(z+3)%l.length;if(Al[0]=l[G]+r[12],Al[1]=l[G+1]+r[13],Al[2]=l[G+2]+r[14],Kr(qk,El)<0&&Kr(qk,Al)<0||Kr(Wk,El)<0&&Kr(Wk,Al)<0||Kr(Xk,El)<0&&Kr(Xk,Al)<0||Kr(Yk,El)<0&&Kr(Yk,Al)<0)continue;if(y.projectToRenderScreen(El,b_),y.projectToRenderScreen(Al,w_),b_[2]<0&&w_[2]>0){We(sf,El,Al);const W=y.frustum,q=-Kr(W[Qr.NEAR],El)/rt(sf,W[Qr.NEAR]);Ue(sf,sf,q),Xe(El,El,sf),y.projectToRenderScreen(El,b_)}else if(b_[2]>0&&w_[2]<0){We(sf,Al,El);const W=y.frustum,q=-Kr(W[Qr.NEAR],Al)/rt(sf,W[Qr.NEAR]);Ue(sf,sf,q),Xe(Al,Al,sf),y.projectToRenderScreen(Al,w_)}else if(b_[2]<0&&w_[2]<0)continue;b_[2]=0,w_[2]=0;const B=OX(A2(b_,w_,iae),b);B<A&&(A=B,ke(eae,El),ke(tae,Al),M=z/3)}const $=s.rayBegin,k=s.rayEnd;if(A<x*x){let z=Number.MAX_VALUE;if(Gme(A2(eae,tae,iae),A2($,k,Ynt),__)){We(__,__,$);const G=yt(__);Ue(__,__,1/G),z=G/Er($,k)}n(z,__,M,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(Y.POSITION);return mJ(n,s?s.get(Y.POSITION):null,s&&EH(this.parameters,r,s),i)}createLayout(){const t=on().vec3f(Y.POSITION).f32(Y.SUBDIVISIONFACTOR).vec2f(Y.UV0).vec3f(Y.AUXPOS1).vec3f(Y.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(Y.SIZEFEATUREATTRIBUTE):t.f32(Y.SIZE),this.parameters.vvColorEnabled?t.f32(Y.COLORFEATUREATTRIBUTE):t.vec4f(Y.COLOR),this.parameters.vvOpacityEnabled&&t.f32(Y.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Wnt(this.layout,this.parameters)}requiresSlot(t,i){if(t===tt.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===qs.OccludeAndTransparentStencil)return t===tt.OPAQUE_MATERIAL||t===tt.OCCLUDER_MATERIAL||t===tt.TRANSPARENT_OCCLUDER_MATERIAL;const r=fw(i);return r===Te.Color||r===Te.Alpha?t===(this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===tt.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Highlight||t.output===Te.Depth?new Hnt(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0),this._requiresTransparent(t)&&(t.transparent=!0)}_requiresTransparent(t){return!!((t.color&&t.color[3])<1||t.innerWidth>0&&this._colorRequiresTransparent(t.innerColor)||t.stipplePattern&&this._colorRequiresTransparent(t.stippleOffColor)||t.falloff>0)}_colorRequiresTransparent(t){return L(t)&&t[3]<1&&t[3]>0}}class Hnt extends Xg{updateParameters(t){return this.ensureTechnique(g8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||this._updateOccludeeState(t),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const qnt=ie(ie({width:0,color:[1,1,1,1],join:"miter",cap:Op.BUTT,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,wireframe:!1},Sd),fZ);class Wnt{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=VD+r}}_isClosed(t){return EH(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(Y.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var n;const a=Jnt,l=Znt,p=Knt,y=i.vertexAttributes.get(Y.POSITION).data,b=i.indices&&i.indices.get(Y.POSITION),x=(n=i.vertexAttributes.get(Y.DISTANCETOSTART))==null?void 0:n.data;b&&b.length!==2*(y.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let A=1,M=0;this.parameters.vvSizeEnabled?M=i.vertexAttributes.get(Y.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(Y.SIZE)&&(A=i.vertexAttributes.get(Y.SIZE).data[0]);let P=[1,1,1,1],$=0;this.parameters.vvColorEnabled?$=i.vertexAttributes.get(Y.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(Y.COLOR)&&(P=i.vertexAttributes.get(Y.COLOR).data);let k=0;this.parameters.vvOpacityEnabled&&(k=i.vertexAttributes.get(Y.OPACITYFEATUREATTRIBUTE).data[0]);const z=y.length/3,G=t.transformation,B=new Float32Array(r.buffer),W=this.vertexBufferLayout.stride/4;let q=s*W;const X=q;let oe=0;const de=x?(Ce,Ae,Pe)=>oe=x[Pe]:(Ce,Ae,Pe)=>oe+=Er(Ce,Ae),he=(Ce,Ae,Pe,De,ne,pe,ye)=>{if(B[q++]=Ae[0],B[q++]=Ae[1],B[q++]=Ae[2],B[q++]=De,B[q++]=ye,B[q++]=ne,B[q++]=Ce[0],B[q++]=Ce[1],B[q++]=Ce[2],B[q++]=Pe[0],B[q++]=Pe[1],B[q++]=Pe[2],this.parameters.vvSizeEnabled?B[q++]=M:B[q++]=A,this.parameters.vvColorEnabled)B[q++]=$;else{const we=Math.min(4*pe,P.length-4);B[q++]=P[we+0],B[q++]=P[we+1],B[q++]=P[we+2],B[q++]=P[we+3]}this.parameters.vvOpacityEnabled&&(B[q++]=k)};q+=W,ze(l,y[0],y[1],y[2]),G&&Ct(l,l,G);const fe=this._isClosed(i);if(fe){const Ce=y.length-3;ze(a,y[Ce],y[Ce+1],y[Ce+2]),G&&Ct(a,a,G)}else ze(p,y[3],y[4],y[5]),G&&Ct(p,p,G),he(l,l,p,1,Rc.LEFT_CAP_START,0,0),he(l,l,p,1,Rc.RIGHT_CAP_START,0,0),ke(a,l),ke(l,p);const me=fe?0:1,ge=fe?z:z-1;for(let Ce=me;Ce<ge;Ce++){const Ae=(Ce+1)%z*3;ze(p,y[Ae+0],y[Ae+1],y[Ae+2]),G&&Ct(p,p,G),de(a,l,Ce),he(a,l,p,0,Rc.LEFT_JOIN_END,Ce,oe),he(a,l,p,0,Rc.RIGHT_JOIN_END,Ce,oe);const Pe=this.numJoinSubdivisions;for(let De=0;De<Pe;++De){const ne=(De+1)/(Pe+1);he(a,l,p,ne,Rc.LEFT_JOIN_END,Ce,oe),he(a,l,p,ne,Rc.RIGHT_JOIN_END,Ce,oe)}he(a,l,p,1,Rc.LEFT_JOIN_START,Ce,oe),he(a,l,p,1,Rc.RIGHT_JOIN_START,Ce,oe),ke(a,l),ke(l,p)}fe?(ze(p,y[3],y[4],y[5]),G&&Ct(p,p,G),oe=de(a,l,ge),he(a,l,p,0,Rc.LEFT_JOIN_END,me,oe),he(a,l,p,0,Rc.RIGHT_JOIN_END,me,oe)):(oe=de(a,l,ge),he(a,l,l,0,Rc.LEFT_CAP_END,ge,oe),he(a,l,l,0,Rc.RIGHT_CAP_END,ge,oe)),Hk(B,X+W,B,X,W),q=Hk(B,q-W,B,q,W),this.parameters.wireframe&&this._addWireframeVertices(r,X,q,W)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let l=0;const p=y=>l=Hk(a,y,n,l,s);for(let y=0;y<a.length-1;y+=2*s)p(y),p(y+2*s),p(y+1*s),p(y+2*s),p(y+1*s),p(y+3*s)}}function Hk(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function EH(e,t,i){return uxe(e,t.get(Y.POSITION).data,i?i.get(Y.POSITION):null)}function uxe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const El=Q(),Al=Q(),sf=Q(),__=Q(),Xnt=Q(),b_=ca(),w_=ca(),eae=Q(),tae=Q(),iae=M0(),Ynt=M0(),Jnt=Q(),Znt=Q(),Knt=Q(),yA=[ca(),ca(),ca(),ca()],X0=[Q(),Q(),Q(),Q()],qk=er(),Wk=er(),Xk=er(),Yk=er();class gZ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+ec()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){if(L(_P))return this._origins.set(this._rootOriginId,zM(_P[0],_P[1],_P[2],this._rootOriginId)),this.getOrigin(t);const b=zM(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,b),b}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),a=Math.round(t[2]/r),l=`${s}/${n}/${a}`;let p=this._origins.get(l);const y=.5*r;if(We(Ao,t,i.vec3),Ao[0]=Math.abs(Ao[0]),Ao[1]=Math.abs(Ao[1]),Ao[2]=Math.abs(Ao[2]),Ao[0]<y&&Ao[1]<y&&Ao[2]<y){if(p){const b=Math.max(...Ao);if(We(Ao,t,p.vec3),Ao[0]=Math.abs(Ao[0]),Ao[1]=Math.abs(Ao[1]),Ao[2]=Math.abs(Ao[2]),Math.max(...Ao)<b)return p}return i}return p||(p=zM(s*r,n*r,a*r,l),this._origins.set(l,p)),p}_drawOriginBox(t,i=[1,1,0,1]){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new lT({width:2,color:i}),s.add(this._material);const M=new sxe({isPickable:!1}),P=new Qg({castShadow:!1});s.add(P),M.add(P),s.add(M),this._objects.set(n,P)}const a=this._objects.get(n),l=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=l.length,y=new Array(3*p),b=new Uint16Array(2*(p-1)),x=.5*this._gridSize;for(let M=0;M<p;M++)y[3*M+0]=t[0]+(1&l[M]?x:-x),y[3*M+1]=t[1]+(2&l[M]?x:-x),y[3*M+2]=t[2]+(4&l[M]?x:-x),M>0&&(b[2*M+0]=M-1,b[2*M+1]=M);ys(y,this._originSR,0,y,r.renderSpatialReference,0,p);const A=new ws([[Y.POSITION,{size:3,data:y,exclusive:!0}]],[[Y.POSITION,b]],rc.Line);s.add(A),a.addGeometry(A,this._material,Rn)}}let _P=null;const Ao=Q();class dxe{constructor(t){this.rctx=t,this.camera=null,this.lastFrameCamera=new br,this.pass=bt.MATERIAL,this.slot=tt.OPAQUE_MATERIAL,this.highlightDepthTexture=null,this.renderOccludedMask=rae,this.hasOccludees=!1,this.hasFillLights=!0}resetRenderOccludedMask(){this.renderOccludedMask=rae}get isHighlightPass(){return this.pass===bt.MATERIAL_HIGHLIGHT}}class Qnt extends dxe{constructor(t,i,r,s,n,a){super(t),this.offscreenRenderingHelper=i,this.scenelightingData=r,this.shadowMap=s,this.ssaoHelper=n,this.sliceHelper=a}}const rae=qs.Occlude|qs.OccludeAndTransparent|qs.OccludeAndTransparentStencil;function eot(){const e=new Ir;return e.include(Xv),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("uColor","vec4"),e.fragment.code.add(V`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const tot=Object.freeze({__proto__:null,build:eot});class _4 extends Xr{initializeProgram(t){const i=_4.shader.get().build();return new $r(t.rctx,i,mr)}initializePipeline(){return this.configuration.hasAlpha?Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),colorWrite:Ii}):Ti({colorWrite:Ii})}}_4.shader=new Ur(tot,()=>import("./TextureOnly.glsl.2901d529.js"));class yZ extends Rs{constructor(){super(...arguments),this.hasAlpha=!1}}_([Oe()],yZ.prototype,"hasAlpha",void 0);function iot(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function Jk(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function PT(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function pxe(e){return(e+1)*(e+1)}function rot(e){return Ot(Math.floor(Math.sqrt(e)-1),0,2)}function fxe(e,t,i){const r=e[0],s=e[1],n=e[2],a=i||[];return a.length=pxe(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*r,a[2]=.4886025119*n,a[3]=.4886025119*s),t>=2&&(a[4]=1.09254843059*r*s,a[5]=1.09254843059*s*n,a[6]=.31539156525*(3*n*n-1),a[7]=1.09254843059*r*n,a[8]=.54627421529*(r*r-s*s)),a}function sot(e,t){const i=pxe(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function not(e,t){const i=rot(t.r.length);for(const r of e)Na(AH,r.direction),fxe(AH,i,Qm),iot(Qm,c$),Jk(Qm,r.intensity[0],lx),PT(t.r,lx),Jk(Qm,r.intensity[1],lx),PT(t.g,lx),Jk(Qm,r.intensity[2],lx),PT(t.b,lx);return t}function oot(e,t){fxe(AH,0,Qm);for(const i of e)t.r[0]+=Qm[0]*c$[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Qm[0]*c$[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Qm[0]*c$[0]*i.intensity[2]*4*Math.PI;return t}function aot(e,t,i,r){sot(t,r),ze(i.intensity,0,0,0);let s=!1;const n=lot,a=cot,l=hot;n.length=0,a.length=0,l.length=0;for(const p of e)p instanceof rH&&!s?(ke(i.direction,p.direction),ke(i.intensity,p.intensity),i.specularStrength=p.specularStrength,i.environmentStrength=p.environmentStrength,i.castShadows=p.castShadows,s=!0):p instanceof rH||p instanceof vbe?n.push(p):p instanceof yJ?a.push(p):p instanceof _be&&l.push(p);not(n,r),oot(a,r);for(const p of l)PT(r.r,p.r),PT(r.g,p.g),PT(r.b,p.b)}const lot=[],cot=[],hot=[],Qm=[0],lx=[0],AH=Q(),c$=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class mxe{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Q(),ambient:{color:Q(),intensity:1},diffuse:{color:Q(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new _be,this._mainLight={intensity:Q(),direction:$t(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(t){t.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(t,i,r){const s=i?(1-this.groundLightingFactor)*(1-this.globalFactor):0;t.setUniform1f("lightingFixedFactor",s),t.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(t),t.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),t.setUniform1f("lightingSpecularStrength",this._mainLight.specularStrength),t.setUniform1f("lightingEnvironmentStrength",this._mainLight.environmentStrength),t.setUniform1f("ambientBoostFactor",this._ambientBoost),t.setUniform1b("hasFillLights",r);const n=this._sphericalHarmonics;this._shOrder===0?t.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):this._shOrder===1?(t.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),t.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),t.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):this._shOrder===2&&(t.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),t.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),t.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),t.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),t.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),t.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),t.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))}set(t){aot(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ke(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,Ue(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),ke(bP,this._oldSunlight.diffuse.color),Ue(bP,bP,this._ambientBoost*this.globalFactor),Xe(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,bP)}get old(){return this._oldSunlight}}const bP=Q();class gxe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Xt(t.texture)),this.cache.clear()}_acquire(t){if(J(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:a,pixels:l,paddedPixels:p}=uot(t.pattern,s),y=l/s,b={refCount:1,texture:null,bind:x=>(J(b.texture)&&(b.texture=new Vt(this._rctx,{width:p,height:1,internalFormat:_t.RGBA,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE},n)),x.bindTexture(b.texture,"stipplePatternTexture"),{pixelSize:y,sdfNormalizer:a,pixels:l})};return this.cache.set(i,b),b.bind}release(t){if(J(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(L(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function uot(e,t){const i=e.map(P=>Math.round(P*t)),r=1/t,s=Math.floor(i.reduce((P,$)=>P+$)),n=i.reduce((P,$)=>Math.max(P,$)),a=(Math.floor(.5*(n-1))+.5)*r,l=[];let p=1;for(const P of i){for(let $=0;$<P;$++){const k=p*(Math.min($,P-1-$)+.5)*r/a*.5+.5;l.push(k)}p=-p}const y=Math.round(i[0]/2),b=[...l.slice(y),...l.slice(0,y)],x=s+2,A=new Uint8Array(4*x);let M=4;for(const P of b)LD(P,A,M),M+=4;return A.copyWithin(0,M-4,M),A.copyWithin(M,4,8),{encodedData:A,sdfNormalizer:a,paddedPixels:x,pixels:s}}var Kl;function dot(e){const t=new Ir;return t.include(Xv),t.fragment.uniforms.add("tex","sampler2D"),e.function===Kl.Standard&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(V`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):t.fragment.code.add(V`void main() {
gl_FragColor = texture2D(tex, uv);
}`)),e.function===Kl.OverlayWithTransparency&&(t.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(V`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
      }`)),e.function===Kl.TransparentToHUDVisibility&&t.fragment.code.add(V`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),e.function===Kl.Transparency&&(t.fragment.uniforms.add("colorTexture","sampler2D"),t.fragment.uniforms.add("alphaTexture","sampler2D"),t.fragment.uniforms.add("frontFaceTexture","sampler2D"),t.fragment.code.add(V`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`)),t}(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Kl||(Kl={}));const pot=Object.freeze({__proto__:null,get CompositingFunction(){return Kl},build:dot});var la;(function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"})(la||(la={}));class nO extends Xr{initializeProgram(t){const i=nO.shader.get().build(this.configuration);return new $r(t.rctx,i,mr)}initializePipeline(){if(this.configuration.function===Kl.TransparentToHUDVisibility)return Ti({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case la.None:return Ti({colorWrite:Ii});case la.Alpha:return Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),colorWrite:Ii});default:return Ti({blending:su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA),colorWrite:Ii})}}}nO.shader=new Ur(pot,()=>import("./Compositing.glsl.187474d7.js"));class h$ extends Rs{constructor(){super(...arguments),this.function=Kl.Standard,this.alphaMode=la.None,this.hasOpacityFactor=!1}}_([Oe({count:Kl.COUNT})],h$.prototype,"function",void 0),_([Oe({count:la.COUNT})],h$.prototype,"alphaMode",void 0),_([Oe()],h$.prototype,"hasOpacityFactor",void 0);const sae=Ge.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let ep=class extends c8(st){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new mxe,this._handles=new Ei,this._frameTask=AS,this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new Ci,this._geometries=new Map,this.worldToPCSRatio=1,this.events=new ps,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new dxe(this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new gxe(e.renderingContext),this._shaderTechniqueRepository=new Vwe({rctx:this._rctx,viewingMode:vt.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Pi(t,"loadingState",()=>this.events.emit("content-changed")),Pi(this,"spatialReference",i=>this._localOrigins=new gZ(i))]),this._materialRepository=new exe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&jD)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new yJ($t(1,1,1))]),this._bindParameters={slot:tt.DRAPED_MATERIAL,highlightDepthTexture:k_e(this._rctx),camera:m2,inverseViewport:St(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:Rn,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:Qt.NONE,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0},this._frameTask=this.view.resourceController.scheduler.registerTask(ii.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._layerRenderers.forEach(e=>e.destroy()),this._layerRenderers.clear(),this._debugTextureTechnique=es(this._debugTextureTechnique),this._debugPatternTexture=Xt(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Xt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Xt(this._shaderTechniqueRepository),this._temporaryFBO=Xt(this._temporaryFBO),this._quadVAO=Xt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||this._frameTask.updating||rn(this._layerRenderers,e=>e.updating)}get hasOverlays(){return L(this._overlays)&&L(this._overlayRenderTarget)}get gpuMemoryUsage(){return L(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(L(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Wt(this._overlays,[])}ensureDrapeTargets(e){L(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=_ue(e,i=>i.drapeTargetType===wH.WithoutRasterImage)})}ensureDrapeSources(e){L(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=rn(e,(i,r)=>r.drapeSourceType===UM.Features),t.hasDrapedRasterSource=rn(e,(i,r)=>r.drapeSourceType===UM.RasterImage)})}ensureOverlays(e,t){J(this._overlays)&&(this._overlayRenderTarget=new $st(this._rctx),this._overlays=[new Uoe(Tn.INNER,this._overlayRenderTarget),new Uoe(Tn.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Xt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}_processLayers(e,t){let i=!1;for(const[r,s]of this._layerRenderers){if(e.done)break;(r.destroyed||t(r))&&(s.commitChanges()&&(i=!0,e.madeProgress()),s.isEmpty&&(i=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(r),this._handles.remove(r),s.destroy()))}this._updateSortedLayerRenderers(),i&&(L(this._overlays)&&this._layerRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncLayers(){this._processLayers(SE,e=>e.updatePolicy===OS.SYNC)}addGeometries(e,t,i,r=!1){for(const s of e)J(s.origin)&&(s.origin=this._localOrigins.getOrigin(s.boundingSphere)),this._geometries.set(s.id,s);this._ensureLayerRenderer(t,r).add(e),i===Ni.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,i){for(const s of e)this._geometries.delete(s.id);const r=this._layerRenderers.get(t);r&&(r.remove(e),i===Ni.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,i){const r=this._layerRenderers.get(t);if(r)switch(r.modify(e,i),i){case Ni.State.TRANSFORMATION:case Ni.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e,t);case Ni.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e,t)}else sae.warn("Attempted to update geometry for nonexistent layer")}_notifyGraphicGeometryChanged(e,t){if(J(t.notifyGraphicGeometryChanged))return;let i;for(const r of e){const s=r.graphicUid;L(s)&&s!==i&&(t.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e,t){if(J(t.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const s=r.graphicUid;L(s)&&s!==i&&(t.notifyGraphicVisibilityChanged(s),i=s)}}updateHighlights(e,t){const i=this._layerRenderers.get(t);i?i.modify(e,Ni.State.HIGHLIGHTS):sae.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return this._geometries.size===0&&!ur.OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._layerRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===bt.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===bt.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const a=2*e.resolution,l=e.resolution;n.resize(a,l);const p=this._rctx;m2.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===bt.MATERIAL_NORMAL?tt.DRAPED_WATER:tt.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(p),e.index===Tn.INNER&&(p.setClearColor(0,0,0,0),p.clearSafe(Sr.COLOR_BUFFER_BIT));const y=t.type===Do.ColorNoRasterImage?Cy.ExcludeRasterImage:t.type===Do.Occluded?Cy.OccludedOnly:Cy.Normal;if(y===Cy.OccludedOnly&&(this._renderContext.renderOccludedMask=jD),ur.OVERLAY_DRAW_DEBUG_TEXTURE&&y!==Cy.OccludedOnly)for(let b=0;b<r.numViews;b++)this._setViewParameters(r.extents[b],e,m2),this._drawDebugTexture(e.resolution,mot[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll(({overlayLayer:b,renderer:x})=>{if(y===Cy.ExcludeRasterImage&&b.drapeSourceType===UM.RasterImage)return;const{fullOpacity:A}=b,M=L(A)&&A<1&&s===bt.MATERIAL;M&&(this.bindTemporaryFramebuffer(this._rctx,a,l),p.clearSafe(Sr.COLOR_BUFFER_BIT));for(let P=0;P<r.numViews;P++)this._setViewParameters(r.extents[P],e,m2),x.render(this._renderContext,this._bindParameters);M&&L(this._temporaryFBO)&&(n.bind(p),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),la.PremultipliedAlpha,A,Kl.OverlayWithTransparency,e.index))}),p.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){J(this._temporaryFBO)&&(this._temporaryFBO=new Bwe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,i,r){let s=0;this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const a=this.longitudeCyclical;a&&(n.boundingSphere[0]-n.boundingSphere[3]<a.min&&this._intersectRenderGeometry(n,i,t,a.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>a.max&&this._intersectRenderGeometry(n,i,t,-a.range,e,s)),s++})}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let a=0;L(e.transformation)&&(r+=e.transformation[12],a=e.transformation[13]),wP[0]=i[0]-r,wP[1]=i[1]-a,wP[2]=1,xP[0]=i[0]-r,xP[1]=i[1]-a,xP[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,wP,xP,(l,p,y)=>{got(t,y,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_ensureLayerRenderer(e,t){let i=this._layerRenderers.get(e);return i&&t===i instanceof zD||(i=t?new zD({rctx:this._rctx,materialRepository:this._materialRepository}):new Kb({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,i),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",()=>this.events.emit("content-changed")),e),this._handles.add(Pi(i,"updating",()=>this.notifyChange("updating")),e)),i}_updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty||(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),this._layerRenderers.size===0))return;const e=this.view.map.allLayers;this._layerRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedLayerRenderers.push(new fot(i,t,r<0?1/0:r))}),this._sortedLayerRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,gX(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),QL(i.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=i,this._bindParameters.camera=i,this._bindParameters.inverseViewport[0]=1/i.fullViewport[2],this._bindParameters.inverseViewport[1]=1/i.fullViewport[3]}_updateHasWater(){const e=rn(this._layerRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=rn(this._layerRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=rn(this._layerRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.useTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture(this._debugPatternTexture,"tex"),i.bindVAO(this._quadVAO),i.drawArrays(mi.TRIANGLE_STRIP,0,zo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let a=0;a<e;a++){const l=Math.floor(a/10),p=Math.floor(n/10);l<2||p<2||10*l>e-20||10*p>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&l&&1&p?1&a^1&n?0:255:1&l^1&p?0:128)}this._debugPatternTexture=new Vt(this._rctx,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:e,height:t},i);const s=new yZ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(_4,s),this._quadVAO=Ga(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};var Cy;_([S()],ep.prototype,"_frameTask",void 0),_([S()],ep.prototype,"_sortedLayerRenderersDirty",void 0),_([ra()],ep.prototype,"_shaderTechniqueRepository",void 0),_([ra()],ep.prototype,"_stippleTextureRepository",void 0),_([S({constructOnly:!0})],ep.prototype,"view",void 0),_([S()],ep.prototype,"worldToPCSRatio",void 0),_([S()],ep.prototype,"spatialReference",void 0),_([S({type:Boolean,readOnly:!0})],ep.prototype,"updating",null),ep=_([re("esri.views.3d.terrain.OverlayRenderer")],ep),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(Cy||(Cy={}));class fot{constructor(t,i,r){this.overlayLayer=t,this.renderer=i,this.index=r}}const mot=[[1,.5,.5],[.5,.5,1]];function got(e,t,i,r,s,n,a){const l={layerUid:n,graphicUid:a,triangleNr:t},p=y=>{y.set(Ts.OVERLAY,l,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&p(s.results.min),s.options.store!==ma.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&p(s.results.max),s.options.store===ma.ALL){const y=jN(s.ray);p(y),s.results.all.push(y)}}const m2=new br;m2.near=1,m2.far=1e4,m2.relativeElevation=null;const wP=Q(),xP=Q(),vZ=-2,jD=qs.OccludeAndTransparent;function nae(e){const t=[[Y.POSITION,e.indices]],i=[[Y.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return L(e.attributeData.color)&&(i.push([Y.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([Y.COLOR,new Uint32Array(e.indices.length)])),L(e.attributeData.uvMapSpace)&&(i.push([Y.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([Y.UVMAPSPACE,e.indices])),L(e.attributeData.boundingRect)&&(i.push([Y.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([Y.BOUNDINGRECT,e.indices])),L(e.attributeData.mapPosition)&&(i.push([Y.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([Y.MAPPOS,e.indices])),new ws(i,t)}function oae(e){const t=[[Y.POSITION,e.indices],[Y.UV0,e.indices]],i=[[Y.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[Y.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return L(e.attributeData.mapPosition)&&(i.push([Y.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([Y.MAPPOS,e.indices])),new ws(i,t)}function oO(e){switch(e.type){case"extent":if(e instanceof ki)return Fa.fromExtent(e);break;case"polygon":return e}return null}function _Z(e,t,i,r){const s=y4(e.rings,e.hasZ,_0.CCW_IS_HOLE),n=new Float64Array(s.position.length),a=iZ(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),l=a!=null;return{position:s.position,mapPosition:n,polygons:_xe(s.polygons,s.position,n),outlines:vxe(s.outlines,s.position,n),projectionSuccess:l,sampledElevation:a}}function yxe(e,t){const i=y4(e.rings,!1,_0.CCW_IS_HOLE),r=ys(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=vZ;return{position:i.position,polygons:_xe(i.polygons,i.position),outlines:vxe(i.outlines,i.position),projectionSuccess:r}}function vxe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const a=3*s,l=a+3*n;r.push({index:s,count:n,position:t.subarray(a,l),mapPosition:i?i.subarray(a,l):void 0})}return r}function _xe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:a,pathLengths:l}of e){if(n<=1)continue;const p=3*s,y=p+3*n,b=a.map(x=>x-s);r.push({index:s,count:n,holeIndices:b,pathLengths:l,position:t.subarray(p,y),mapPosition:i?i.subarray(p,y):void 0})}return r}function bxe(e,t){const i=e.fragment;switch(i.code.add(V`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Es.None:i.code.add(V`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Es.View:i.code.add(V`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Es.WindingOrder:i.code.add(V`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Es.COUNT:}}var Es;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Es||(Es={}));function bZ({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(V`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(V`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function y8(e){return!!je("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function wxe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(Y.MODELORIGINHI,"vec3"),e.attributes.add(Y.MODELORIGINLO,"vec3"),e.attributes.add(Y.MODEL,"mat3"),e.attributes.add(Y.MODELNORMAL,"mat3")),t.instancedDoublePrecision&&(e.vertex.include(bZ,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const i=[V`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,V`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?V`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,V`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,V`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,t.vertexTangents?V`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:V``];e.vertex.code.add(i[0]),e.vertex.code.add(i[1]),e.vertex.code.add(i[2]),t.output===Te.Normal&&e.vertex.code.add(i[3]),e.vertex.code.add(i[4])}function yot(e,t){ZZe(t,aae,lae,3),e.setUniform3fv("viewOriginHi",aae),e.setUniform3fv("viewOriginLo",lae)}const aae=Q(),lae=Q();function vot(e){const t=V`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function v8(e,t){t.normalType===Xs.Attribute&&(e.attributes.add(Y.NORMAL,"vec3"),e.vertex.code.add(V`vec3 normalModel() {
return normal;
}`)),t.normalType===Xs.CompressedAttribute&&(e.include(vot),e.attributes.add(Y.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(V`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Xs.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(V`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Xs;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Xs||(Xs={}));function xxe(e){e.vertex.code.add(V`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function _8(e){e.attributes.add(Y.POSITION,"vec3"),e.vertex.code.add(V`vec3 positionModel() { return position; }`)}var Bn;function _ot(e){switch(e){case"multiply":default:return Bn.Multiply;case"ignore":return Bn.Ignore;case"replace":return Bn.Replace;case"tint":return Bn.Tint}}function Txe(e,t,i){if(J(e)||t===Bn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Ot(Math.round(e[3]*HD),0,HD),s=r===0||t===Bn.Tint?0:t===Bn.Replace?bot:wot;i[0]=Ot(Math.round(e[0]*cx),0,cx),i[1]=Ot(Math.round(e[1]*cx),0,cx),i[2]=Ot(Math.round(e[2]*cx),0,cx),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Bn||(Bn={}));const cx=255,HD=85,bot=HD,wot=2*HD;function Sxe(e){e.vertex.code.add(V`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${V.int(Bn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${V.int(Bn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${V.int(Bn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${V.int(Bn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function Exe(e,t){t.symbolColor?(e.include(Sxe),e.attributes.add(Y.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(V`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):e.vertex.code.add(V`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)}function Uw(e,t){t.attributeColor?(e.attributes.add(Y.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(V`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(V`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(V`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function IT(e,t){e.include(_8),e.vertex.include(bZ,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("transformWorldFromModelRS","mat3"),e.vertex.uniforms.add("transformWorldFromModelTH","vec3"),e.vertex.uniforms.add("transformWorldFromModelTL","vec3"),e.vertex.uniforms.add("transformWorldFromViewTH","vec3"),e.vertex.uniforms.add("transformWorldFromViewTL","vec3"),e.vertex.uniforms.add("transformViewFromCameraRelativeRS","mat3"),e.vertex.uniforms.add("transformProjFromView","mat4"),e.vertex.code.add(V`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return transformViewFromCameraRelativeRS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.uniforms.add("transformWorldFromViewTL","vec3"),e.fragment.code.add(V`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class xot{constructor(){this.transformWorldFromModelRS=zs(),this.transformWorldFromModelTH=Q(),this.transformWorldFromModelTL=Q()}}class Axe{constructor(){this.transformWorldFromViewTH=Q(),this.transformWorldFromViewTL=Q(),this.transformViewFromCameraRelativeRS=zs(),this.transformProjFromView=lt()}}function Cxe(e,t){e.setUniformMatrix3fv("transformWorldFromModelRS",t.transformWorldFromModelRS),e.setUniform3fv("transformWorldFromModelTH",t.transformWorldFromModelTH),e.setUniform3fv("transformWorldFromModelTL",t.transformWorldFromModelTL)}function Mxe(e,t){e.setUniform3fv("transformWorldFromViewTH",t.transformWorldFromViewTH),e.setUniform3fv("transformWorldFromViewTL",t.transformWorldFromViewTL),e.setUniformMatrix4fv("transformProjFromView",t.transformProjFromView),e.setUniformMatrix3fv("transformViewFromCameraRelativeRS",t.transformViewFromCameraRelativeRS)}function b8(e,t){t.normalType===Xs.Attribute||t.normalType===Xs.CompressedAttribute?(e.include(v8,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("transformNormalGlobalFromModel","mat3"),e.vertex.uniforms.add("transformNormalViewFromGlobal","mat3"),e.vertex.code.add(V`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Xs.Ground?(e.include(IT,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(V`
    void forwardNormal() {
      vNormalWorld = ${t.viewingMode===vt.Global?V`normalize(vPositionWorldCameraRelative);`:V`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(V`void forwardNormal() {}`)}function Tot(e,t){e.setUniformMatrix4fv("viewNormal",t)}function Rxe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==Te.Depth&&t.output!==Te.Shadow||(e.include(da,{linearDepth:!0,hasModelTransformation:s}),e.include(dg,t),e.include(OT,t),e.include(Zv,t),e.include(Ws,t),e.vertex.uniforms.add("nearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),i.add(V`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(fg,t),r.add(V`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===Te.Normal&&(e.include(da,{linearDepth:!1,hasModelTransformation:s}),e.include(v8,t),e.include(b8,t),e.include(dg,t),e.include(OT,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),i.add(V`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Xs.Attribute?V`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ws,t),e.include(fg,t),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Xs.ScreenDerivative?V`
            vec3 normal = screenDerivativeNormal(vPositionView);`:V`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===Te.Highlight&&(e.include(da,{linearDepth:!1,hasModelTransformation:s}),e.include(dg,t),e.include(OT,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),i.add(V`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ws,t),e.include(fg,t),e.include(Yg),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function Oxe(e,t){const i=e.fragment;t.vertexTangents?(e.attributes.add(Y.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Es.WindingOrder?i.code.add(V`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(V`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(V`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.attributeTextureCoordinates!==Go.None&&(e.include(tJ,t),i.uniforms.add("normalTexture","sampler2D"),i.uniforms.add("normalTextureSize","vec2"),i.code.add(V`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))}function w8(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add("ssaoTex","sampler2D"),i.uniforms.add("viewportPixelSz","vec4"),i.code.add(V`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):i.code.add(V`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}function mw(e,t){const i=e.fragment;e.include(NN),e.include(w8,t),t.pbrMode!==fi.Disabled&&e.include(u8,t),e.include(rJ,t),t.receiveShadows&&e.include($g,t),i.uniforms.add("lightingGlobalFactor","float"),i.uniforms.add("ambientBoostFactor","float"),i.uniforms.add("hasFillLights","bool"),e.include(FN),i.code.add(V`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===fi.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.code.add(V`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.viewingMode===vt.Global?V`normalize(vPosWorld)`:V`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.code.add(V`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===fi.Disabled||t.pbrMode===fi.WaterOnIntegratedMesh?i.code.add(V`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`):t.pbrMode!==fi.Normal&&t.pbrMode!==fi.Schematic||(i.code.add(V`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(V`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),i.code.add(V`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.code.add(V`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(V`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===fi.Schematic?V`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:V`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function Pxe(e,t){const i=V`
  /*
  *  ${t.name}
  *  ${t.output===Te.Color?"RenderOutput: Color":t.output===Te.Depth?"RenderOutput: Depth":t.output===Te.Shadow?"RenderOutput: Shadow":t.output===Te.Normal?"RenderOutput: Normal":t.output===Te.Highlight?"RenderOutput: Highlight":""}
  */
  `;PR()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function aO(e){e.include(P0),e.code.add(V`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${V.int(Bn.Multiply)}) {
        return allMixed;
      }
      else if (mode == ${V.int(Bn.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${V.int(Bn.Replace)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${V.int(Bn.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${V.int(Bn.Replace)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)}function Sot(e){const t=new Ir,i=t.vertex.code,r=t.fragment.code;t.include(Pxe,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");const s=e.hasModelTransformation;return s&&t.vertex.uniforms.add("model","mat4"),t.include(_8),t.varyings.add("vpos","vec3"),t.include(OT,e),t.include(wxe,e),t.include(twe,e),e.output!==Te.Color&&e.output!==Te.Alpha||(t.include(v8,e),t.include(da,{linearDepth:!1,hasModelTransformation:s}),e.normalType===Xs.Attribute&&e.offsetBackfaces&&t.include(xxe),t.include(Oxe,e),t.include(b8,e),e.instancedColor&&t.attributes.add(Y.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(dg,e),t.include(v4,e),t.include(Exe,e),t.include(Uw,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i.add(V`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${V.float(fa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Xs.Attribute?V`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
          ${e.normalType===Xs.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===Te.Alpha&&(t.include(Ws,e),t.include(fg,e),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(aO),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:V`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?V`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:V`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===Te.Color&&(t.include(Ws,e),t.include(mw,e),t.include(w8,e),t.include(fg,e),e.receiveShadows&&t.include($g,e),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(iJ,e),t.include(u8,e),t.fragment.include(aO),t.include(bxe,e),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:V`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Xs.ScreenDerivative?V`
        vec3 normal = screenDerivativeNormal(localvpos);`:V`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===fi.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.viewingMode===vt.Global?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?V`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:V`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${e.hasNormalTexture?V`
              mat3 tangentSpace = ${e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal = normal;"}
        ${e.pbrMode===fi.Normal||e.pbrMode===fi.Schematic?e.viewingMode===vt.Global?V`vec3 normalGround = normalize(vpos + localOrigin);`:V`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:V``}
        ${e.pbrMode===fi.Normal||e.pbrMode===fi.Schematic?V`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(Rxe,e),t}const Eot=Object.freeze({__proto__:null,build:Sot}),Aot=Ge.getLogger("esri.views.3d.webgl-engine.shaders.DefaultTechnique");class b4 extends Xr{initializeProgram(t){const i=b4.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,viewingMode:t.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?r.isSchematic?fi.Schematic:fi.Normal:fi.Disabled,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,hasModelTransformation:r.hasModelTransformation,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?Xs.ScreenDerivative:Xs.Attribute,doubleSidedMode:r.doubleSidedMode,vertexTangents:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?Go.Default:Go.None,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:y8(t.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,mr)}bindPass(t,i){var r,s;hh(this.program,i.camera.projectionMatrix);const n=this.configuration.output;this.configuration.hasModelTransformation&&(L(t.modelTransformation)?this.program.setUniformMatrix4fv("model",t.modelTransformation):Aot.warnOnce("hasModelTransformation true, but no modelTransformation found.")),(this.configuration.output===Te.Depth||i.multipassTerrainEnabled||n===Te.Shadow)&&this.program.setUniform2fv("nearFar",i.camera.nearFar),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i)),n===Te.Alpha&&(this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",vH[t.colorMixMode])),n===Te.Color?(i.lighting.setUniforms(this.program,!1,i.hasFillLights),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",vH[t.colorMixMode]),this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.configuration.usePBR&&K_e(this.program,t,this.configuration.isSchematic)):n===Te.Highlight&&D0(this.program,i),cit(this.program,t),ZJ(this.program,t,i),eO(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),t.textureAlphaMode!==Pr.Mask&&t.textureAlphaMode!==Pr.MaskBlend||this.program.setUniform1f("textureAlphaCutoff",t.textureAlphaCutoff),(r=i.shadowMap)==null||r.bind(this.program),(s=i.ssaoHelper)==null||s.bind(this.program,i.camera)}bindDraw(t){const i=this.configuration.instancedDoublePrecision?$t(t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]):t.origin;abe(this.program,i,t.camera.viewMatrix),this.program.rebindTextures(),(this.configuration.output===Te.Color||this.configuration.output===Te.Alpha||this.configuration.output===Te.Depth&&this.configuration.screenSizePerspective||this.configuration.output===Te.Normal&&this.configuration.screenSizePerspective||this.configuration.output===Te.Highlight&&this.configuration.screenSizePerspective)&&Yv(this.program,i,t.camera.viewInverseTransposeMatrix),this.configuration.output===Te.Normal&&this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&yot(this.program,i),Nv(this.program,this.configuration,t.slicePlane,{origin:i}),this.configuration.output===Te.Color&&Ust(this.program,t,i)}_convertDepthTestFunction(t){return t===ew.Lequal?kr.LEQUAL:kr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===Qt.NONE,n=t===Qt.FrontFace;return Ti({blending:r.output!==Te.Color&&r.output!==Te.Alpha||!r.transparent?null:s?Qc:Zg(t),culling:Cot(r)&&LN(r.cullFace),depthTest:{func:Jv(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&ac:null,colorWrite:Ii,stencilWrite:r.sceneHasOcludees?b0:null,stencilTest:r.sceneHasOcludees?i?kv:Kv:null,polygonOffset:s||n?null:r8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function Cot(e){return e.cullFace?e.cullFace!==Fr.None:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}b4.shader=new Ur(Eot,()=>import("./DefaultMaterial.glsl.1ad5c1e9.js"));class cr extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.alphaDiscardMode=Pr.Opaque,this.doubleSidedMode=Es.None,this.isSchematic=!1,this.vertexColors=!1,this.offsetBackfaces=!1,this.symbolColors=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.receiveAmbientOcclusion=!1,this.screenSizePerspective=!1,this.textureAlphaPremultiplied=!1,this.hasColorTexture=!1,this.usePBR=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.vertexTangents=!1,this.normalsTypeDerivate=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparent=!1,this.enableOffset=!0,this.cullFace=Fr.None,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1,this.hasModelTransformation=!1,this.customDepthTest=ew.Less}}_([Oe({count:Te.COUNT})],cr.prototype,"output",void 0),_([Oe({count:Pr.COUNT})],cr.prototype,"alphaDiscardMode",void 0),_([Oe({count:Es.COUNT})],cr.prototype,"doubleSidedMode",void 0),_([Oe()],cr.prototype,"isSchematic",void 0),_([Oe()],cr.prototype,"vertexColors",void 0),_([Oe()],cr.prototype,"offsetBackfaces",void 0),_([Oe()],cr.prototype,"symbolColors",void 0),_([Oe()],cr.prototype,"vvSize",void 0),_([Oe()],cr.prototype,"vvColor",void 0),_([Oe()],cr.prototype,"verticalOffset",void 0),_([Oe()],cr.prototype,"receiveShadows",void 0),_([Oe()],cr.prototype,"slicePlaneEnabled",void 0),_([Oe()],cr.prototype,"sliceHighlightDisabled",void 0),_([Oe()],cr.prototype,"receiveAmbientOcclusion",void 0),_([Oe()],cr.prototype,"screenSizePerspective",void 0),_([Oe()],cr.prototype,"textureAlphaPremultiplied",void 0),_([Oe()],cr.prototype,"hasColorTexture",void 0),_([Oe()],cr.prototype,"usePBR",void 0),_([Oe()],cr.prototype,"hasMetalnessAndRoughnessTexture",void 0),_([Oe()],cr.prototype,"hasEmissionTexture",void 0),_([Oe()],cr.prototype,"hasOcclusionTexture",void 0),_([Oe()],cr.prototype,"hasNormalTexture",void 0),_([Oe()],cr.prototype,"instanced",void 0),_([Oe()],cr.prototype,"instancedColor",void 0),_([Oe()],cr.prototype,"instancedDoublePrecision",void 0),_([Oe()],cr.prototype,"vertexTangents",void 0),_([Oe()],cr.prototype,"normalsTypeDerivate",void 0),_([Oe()],cr.prototype,"writeDepth",void 0),_([Oe()],cr.prototype,"sceneHasOcludees",void 0),_([Oe()],cr.prototype,"transparent",void 0),_([Oe()],cr.prototype,"enableOffset",void 0),_([Oe({count:Fr.COUNT})],cr.prototype,"cullFace",void 0),_([Oe({count:Qt.COUNT})],cr.prototype,"transparencyPassType",void 0),_([Oe()],cr.prototype,"multipassTerrainEnabled",void 0),_([Oe()],cr.prototype,"cullAboveGround",void 0),_([Oe()],cr.prototype,"hasModelTransformation",void 0),_([Oe({count:ew.COUNT})],cr.prototype,"customDepthTest",void 0);function Mot(e){const t=new Ir,i=t.vertex.code,r=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3"),t.include(_8),t.varyings.add("vpos","vec3"),t.include(OT,e),t.include(wxe,e),t.include(twe,e),e.output!==Te.Color&&e.output!==Te.Alpha||(t.include(v8,e),t.include(da,{linearDepth:!1}),e.offsetBackfaces&&t.include(xxe),e.instancedColor&&t.attributes.add(Y.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(dg,e),t.include(v4,e),t.include(Exe,e),t.include(Uw,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),i.add(V`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${V.float(fa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.multipassTerrainEnabled?V`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===Te.Alpha&&(t.include(Ws,e),t.include(fg,e),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(aO),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?V`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:V`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?V`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:V`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===Te.Color&&(t.include(Ws,e),t.include(mw,e),t.include(w8,e),t.include(fg,e),e.receiveShadows&&t.include($g,e),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(iJ,e),t.include(u8,e),t.fragment.include(aO),r.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?V`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?V`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:V`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===fi.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.viewingMode===vt.Global?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?V`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:V`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${V`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===fi.Normal||e.pbrMode===fi.Schematic?e.viewingMode===vt.Global?V`vec3 normalGround = normalize(vpos + localOrigin);`:V`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:V``}
        ${e.pbrMode===fi.Normal||e.pbrMode===fi.Schematic?V`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(Rxe,e),t}const Rot=Object.freeze({__proto__:null,build:Mot});class x8 extends b4{initializeProgram(t){const i=x8.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,viewingMode:t.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?fi.Normal:fi.Disabled,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,hasModelTransformation:!1,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:Xs.Attribute,doubleSidedMode:Es.WindingOrder,vertexTangents:!1,attributeTextureCoordinates:r.hasColorTexture?Go.Default:Go.None,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:y8(t.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,mr)}}x8.shader=new Ur(Rot,()=>import("./RealisticTree.glsl.b64d580d.js"));class gw extends Wp{constructor(t){super(t,Pot),this.supportsEdges=!0,this.techniqueConfig=new cr,this.vertexBufferLayout=$ot(this.parameters),this.instanceBufferLayout=t.instanced?Ixe(this.parameters):null}isVisibleInPass(t){return t!==bt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const i=t.instanced,r=t.vertexColors,s=t.symbolColors,n=!!i&&i.indexOf("color")>-1,a=t.vvColorEnabled,l=t.colorMixMode==="replace",p=t.opacity>0,y=t.externalColor&&t.externalColor[3]>0;return r&&(n||a||s)?!!l||p:r?l?y:p:n||a||s?!!l||p:l?y:p}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=this.parameters.verticalOffset!==null,this.techniqueConfig.screenSizePerspective=this.parameters.screenSizePerspective!==null,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate=this.parameters.normals==="screenDerivative",this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,L(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?Fr.None:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig.hasModelTransformation=L(this.parameters.modelTransformation),t!==Te.Color&&t!==Te.Alpha||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Es.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Es.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Es.WindingOrder:Es.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<t8),this.techniqueConfig}intersect(t,i,r,s,n,a,l){if(this.parameters.verticalOffset!==null){const p=s.camera;ze(Kk,r[12],r[13],r[14]);let y=null;switch(s.viewingMode){case vt.Global:y=ot(cae,Kk);break;case vt.Local:y=ke(cae,Not)}let b=0;if(this.parameters.verticalOffset!==null){const x=We(Fot,Kk,p.eye),A=yt(x),M=Ue(x,x,1/A);let P=null;this.parameters.screenSizePerspective&&(P=rt(y,M)),b+=L2e(p,A,this.parameters.verticalOffset,P,this.parameters.screenSizePerspective)}Ue(y,y,b),Gc(Zk,y,s.transform.inverseRotation),n=We(Dot,n,Zk),a=We(Lot,a,Zk)}KN(t,i,s,n,a,sH(s.verticalOffset),l)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:tt.OPAQUE_MATERIAL)||t===tt.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Depth||t.output===Te.Normal||t.output===Te.Shadow||t.output===Te.Highlight?new Oot(t):null}createBufferWriter(){return new Iot(this.vertexBufferLayout,this.instanceBufferLayout)}}class Oot extends HJ{constructor(t){super(ie(ie({},t),t.material.parameters))}updateParameters(t){const i=this._material.parameters;return this.updateTexture(i.textureId),this.ensureTechnique(i.treeRendering?x8:b4,t)}_updateShadowState(t){t.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMappingEnabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.parameters,t),this.bindTextures(i.program)}}const Pot=ie({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:Fr.Back,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:zs(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:ew.Less,textureAlphaMode:Pr.Blend,textureAlphaCutoff:ND,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},Sd);class Iot{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(Y.POSITION).length}write(t,i,r,s){QN(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function $ot(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=on().vec3f(Y.POSITION).vec3f(Y.NORMAL);return e.vertexTangents&&i.vec4f(Y.TANGENT),t&&i.vec2f(Y.UV0),e.vertexColors&&i.vec4u8(Y.COLOR),e.symbolColors&&i.vec4u8(Y.SYMBOLCOLOR),i}function Ixe(e){let t=on();return t=e.instancedDoublePrecision?t.vec3f(Y.MODELORIGINHI).vec3f(Y.MODELORIGINLO).mat3f(Y.MODEL).mat3f(Y.MODELNORMAL):t.mat4f(Y.MODEL).mat4f(Y.MODELNORMAL),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f(Y.INSTANCECOLOR)),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f(Y.INSTANCEFEATUREATTRIBUTE)),t}const Dot=Q(),Lot=Q(),Not=$t(0,0,1),cae=Q(),Zk=Q(),Kk=Q(),Fot=Q(),kot=["polygon","extent"];class Uot extends N0{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const l=s8(this._getSymbolSize());if(l)throw new Se("graphics3dextrudesymbollayer:invalid-size",l)}const t=Ss(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=zl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Fr.None:Fr.Back,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new gw(a),this._bottomMaterial=new gw(qe(ie({},a),{cullFace:Fr.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,kot,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new cu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=Ss(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const a=this._getLayerOpacity();return t.forEach(l=>{const p=i(l);L(p)&&p.layerOpacityChanged(a,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Fv)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);L(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){let i;var r;return t.size&&this._drivenProperties.size?i=(r=Tst(t.size,2))!=null?r:0:i=this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?Hn.Recreate_Symbol:Hn.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const a=oO(t.geometry);if(J(a))return null;const l=_Z(a,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(l,a.rings,"rings","ExtrudeSymbol3DLayer"),a.rings.length===0||!a.rings.some(Pe=>Pe.length>0))return null;const p=eZ(a);if(J(p))return null;const y=new Array,b=new Array,x=new Array,A=On(),M=lt(),P=Q(),$=this._context.renderCoordsHelper.viewingMode===vt.Global;$||this._context.renderCoordsHelper.worldUpAtPosition(null,P),kp(a.spatialReference,[p.x,p.y,0],M,this._context.renderCoordsHelper.spatialReference);const k=lt();Ms(k,M);const z=zs();IS(z,k);const{polygons:G,mapPosition:B,position:W}=l,q=W.length/3,X=new Float64Array(3*q*6),oe=new Float64Array(3*q*6),de=new Float64Array(3*q*6),he=new Float64Array(1*q*6);let fe=0;for(let Pe=0;Pe<G.length;++Pe){const De=G[Pe],ne=De.count;if(this._context.clippingExtent&&(jr(A),Hh(A,De.mapPosition),!vp(A,this._context.clippingExtent)))continue;const pe=XS(De.mapPosition,De.holeIndices,3);if(pe.length===0)continue;const ye=3*ne*2+pe.length,we=new Uint32Array(ye),Ee=new Uint32Array(pe.length),Ie=6*ne,xe=3*X.BYTES_PER_ELEMENT,$e=new gn(X.buffer,fe*xe,xe,(fe+Ie)*xe),et=3*oe.BYTES_PER_ELEMENT,ct=new gn(oe.buffer,fe*et,et,(fe+Ie)*et),Mt=new Float64Array(de.buffer,3*fe*de.BYTES_PER_ELEMENT,3*Ie),at=new Float64Array(he.buffer,1*fe*he.BYTES_PER_ELEMENT,1*Ie),nt=this._getExtrusionSize(i);zot(W,B,pe,De,$e.typedBuffer,Mt,ct.typedBuffer,at,0,we,Ee,nt,P,$),g4($e,$e,k),pw(ct,ct,z),fe+=6*ne;const dt=hae(we,we.length-Ee.length,{positions:$e.typedBuffer,elevation:Mt,normals:ct.typedBuffer,heights:at},r);y.push(dt),b.push(this._material),x.push(Rn);const xt=hae(Ee,0,{positions:$e.typedBuffer,elevation:Mt,normals:ct.typedBuffer,heights:at},r);y.push(xt),b.push(this._bottomMaterial),x.push(Rn)}if(y.length===0)return null;const me=new Qg({geometries:y,materials:b,transformations:x,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});me.transformation=M;const ge=Owe(this.symbolLayer,{opacity:this._getLayerOpacity()}),Ce=L(ge)?{baseMaterial:this._material,edgeMaterials:[ge],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,Ae=new L0(this,me,y,null,null,Got,s,Ce);return Ae.alignedSampledElevation=l.sampledElevation,Ae.needsElevationUpdates=Fv(s.mode),Ae}}function hae(e,t,i,r){const s=new Uint32Array(e.length),n=[[Y.POSITION,{size:3,data:i.positions,exclusive:!0}],[Y.NORMAL,{size:3,data:i.normals,exclusive:!0}],[Y.COLOR,{size:4,data:r,exclusive:!0}],[Y.SIZE,{size:1,data:i.heights,exclusive:!0}]],a=[[Y.POSITION,e],[Y.NORMAL,e],[Y.COLOR,s]];return i.elevation&&(n.push([Y.MAPPOS,{size:3,data:i.elevation}]),a.push([Y.MAPPOS,e])),new ws(n,a,rc.Triangle,t)}function zot(e,t,i,r,s,n,a,l,p,y,b,x,A,M){const P=i.length/3;let $=0,k=2*r.count;Bot(e,t,r.index,r.count,i,0,P,s,n,a,l,p,y,b,k,x,A,M),p+=2*r.count,k=0,uae(s,n,l,a,$,r.pathLengths[0],r.count,p,y,k,x),p+=4*r.pathLengths[0],k+=2*r.pathLengths[0],$+=r.pathLengths[0];for(let z=1;z<r.pathLengths.length;++z)uae(s,n,l,a,$,r.pathLengths[z],r.count,p,y,k,x),p+=4*r.pathLengths[z],k+=2*r.pathLengths[z],$+=r.pathLengths[z]}function Bot(e,t,i,r,s,n,a,l,p,y,b,x,A,M,P,$,k,z){ke(Cl,k);const G=$>0?1:-1;let B=3*i,W=x,q=3*W,X=x+r,oe=3*X;for(let fe=0;fe<r;++fe)z&&(Cl[0]=e[B+0],Cl[1]=e[B+1],Cl[2]=e[B+2],ot(Cl,Cl)),l[q+0]=e[B+0],l[q+1]=e[B+1],l[q+2]=e[B+2],p[q+0]=t[B+0],p[q+1]=t[B+1],p[q+2]=t[B+2],y[q+0]=-G*Cl[0],y[q+1]=-G*Cl[1],y[q+2]=-G*Cl[2],b[W]=0,l[oe+0]=e[B+0]+$*Cl[0],l[oe+1]=e[B+1]+$*Cl[1],l[oe+2]=e[B+2]+$*Cl[2],p[oe+0]=t[B+0],p[oe+1]=t[B+1],p[oe+2]=t[B+2],y[oe+0]=G*Cl[0],y[oe+1]=G*Cl[1],y[oe+2]=G*Cl[2],b[X]=$,q+=3,oe+=3,B+=3,W+=1,X+=1;B=3*n,q=0,oe=3*P;const de=$<0?yae:gae,he=$<0?gae:yae;for(let fe=0;fe<a;++fe)M[q+0]=s[B+de[0]],M[q+1]=s[B+de[1]],M[q+2]=s[B+de[2]],A[oe+0]=s[B+he[0]]+r,A[oe+1]=s[B+he[1]]+r,A[oe+2]=s[B+he[2]]+r,q+=3,oe+=3,B+=3}function TP(e,t,i,r,s,n,a){r[n]=r[a],a*=3,e[(n*=3)+0]=e[a+0],e[n+1]=e[a+1],e[n+2]=e[a+2],t[n+0]=t[a+0],t[n+1]=t[a+1],t[n+2]=t[a+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const vA=Q();function uae(e,t,i,r,s,n,a,l,p,y,b){let x=s,A=s+1,M=s+a,P=s+a+1,$=l,k=l+1,z=l+2*n,G=l+2*n+1;b<0&&(x=s+a+1,P=s),y*=3;for(let B=0;B<n;++B)B===n-1&&(b>0?(A=s,P=s+a):(A=s,x=s+a)),Vot(e,x,A,M,vA),TP(e,t,r,i,vA,$,x),TP(e,t,r,i,vA,k,A),TP(e,t,r,i,vA,z,M),TP(e,t,r,i,vA,G,P),p[y++]=$,p[y++]=z,p[y++]=G,p[y++]=$,p[y++]=G,p[y++]=k,x++,A++,M++,P++,$+=2,k+=2,z+=2,G+=2}const Qk=Q(),dae=Q(),pae=Q(),fae=Q(),mae=Q();function Vot(e,t,i,r,s){t*=3,i*=3,r*=3,ze(Qk,e[t++],e[t++],e[t++]),ze(dae,e[i++],e[i++],e[i++]),ze(pae,e[r++],e[r++],e[r++]),We(fae,dae,Qk),We(mae,pae,Qk),si(s,mae,fae),ot(s,s)}const hx=Q();function Got(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,a=n.length,l=t.mode!=="absolute-height";let p=0;const y=s.transformation,b=Ms(lt(),y);for(let x=0;x<a;x+=2){const A=n[x].geometry,M=A.getMutableAttribute(Y.POSITION).data,P=A.vertexAttributes.get(Y.SIZE).data,$=A.vertexAttributes.get(Y.MAPPOS).data,k=new Uve($),z=M.length/3;let G=0,B=!1,W=0;const q=i.spatialReference;for(let X=0;X<z;X++){hx[0]=M[G],hx[1]=M[G+1],hx[2]=M[G+2],Ig(k,i,t,r,SP),l&&(W+=SP.sampledElevation),ur.TESTS_DISABLE_OPTIMIZATIONS?(ze(fc,k.array[k.offset+0],k.array[k.offset+1],SP.z+P[G/3]),r.toRenderCoords(fc,q,fc),Ct(fc,fc,b)):(ze(fc,M[G+0],M[G+1],M[G+2]),Ct(fc,fc,y),r.setAltitude(fc,SP.z+P[G/3]),Ct(fc,fc,b)),M[G]=fc[0],M[G+1]=fc[1],M[G+2]=fc[2];const oe=jot/r.unitInMeters;(Math.abs(hx[0]-M[G])>=oe||Math.abs(hx[1]-M[G+1])>=oe||Math.abs(hx[2]-M[G+2])>=oe)&&(B=!0),k.offset+=3,G+=3}B&&(A.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[x]),n[x+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[x+1])),p+=W/z}return p/a}const fc=Q(),Cl=Q(),SP=new m4,gae=[0,2,1],yae=[0,1,2],jot=.01;function Hot(e,t,i,r,s){const n=e.referencesGeometry()&&s?qot(t,r,s):t,a=e.repurposeFeature(n);try{return e.evaluate(qe(ie({},i),{$feature:a}))}catch(l){return Ge.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const eU=new Map;function qot(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;eU.has(t)||eU.set(t,Wot(t));const a=eU.get(t)(e.geometry,r,s,n);return qe(ie({},e),{geometry:a})}function Wot(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>uwe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>dwe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>pwe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>hwe(r,t,i,s,n);default:return Ge.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Se("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const USt=1.2,Xot=E2,Yot=Xf;class T8{constructor(t,i,r){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._graphicsCoreOwner=null,this.isElevationSource=!1}initialize(t,i,r){this.stage=t,this._graphicsCoreOwner=r,this._overlayRenderer=this._graphicsCoreOwner.view.basemapTerrain.overlayManager.renderer}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._graphicsCoreOwner,Ni.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._graphicsCoreOwner,Ni.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._graphicsCoreOwner,Ni.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=Q()){return ze(t,0,0,0)}getBoundingBoxObjectSpace(t=On()){return jr(t)}addObjectState(t,i){t===Rg.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(ux)&&(t.draped.origin[0]+=ux[0],t.draped.origin[1]+=ux[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){jr(n);for(let a=0;a<this.renderGeometries.length;a++){const l=this.renderGeometries[a];this._getRenderGeometryProjectedBoundingRect(l,t,vae,r),g6e(n,vae)}if(i){let a;yp(n,ux);const l=tZ(n,i);try{a=await i.service.queryElevation(ux[0],ux[1],s,l,"ground")}catch{}L(a)&&(n[2]=Math.min(n[2],a),n[5]=Math.max(n[5],a))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)VL(nf,this.boundingBox);else{const n=t.boundingSphere,a=n[3];nf[0]=n[0]-a,nf[1]=n[1]-a,nf[2]=n[2]-a,nf[3]=n[0]+a,nf[4]=n[1]+a,nf[5]=n[2]+a}return i(nf,0,2),this.calculateRelativeScreenBounds&&s.push({location:yp(nf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),tX(nf,r)}}const vae=Mi(),nf=On(),ux=Q();class $xe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*Jot}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(J(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case fv.Left:return this.backgroundHorizontalPadding;case fv.Center:return(this.displayWidth-this._lineWidths[t])/2;case fv.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,a=this.haloSize,l=this.firstLineYOffset;i+=a,r+=l+this.baselinePosition;const p=this.haloSize>0;p&&this._renderHalo(t,s,n,a,l),this._setFontProperties(t,this.renderedFontSize);for(let y=0;y<this._lines.length;++y){const b=this._lines[y],x=this._getLineXOffset(y);p&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,b,i+x,r),this._renderLineDecoration(t,i+x,r,this._textWidths[y])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,b,i+this._getLineXOffset(y),r),this._renderLineDecoration(t,i+x,r,this._textWidths[y]),r+=this.lineSpacing}if(ur.TEXT_SHOW_BASELINE){t.strokeStyle=_ae,t.setLineDash([2,2]),t.lineWidth=1;let y=n+l;for(let b=0;b<this._lines.length;++b){const x=y+this.baselinePosition;this._drawLine(t,[s,x],[s+this.displayWidth,x]),y+=this.lineSpacing}}if(ur.TEXT_SHOW_BORDER&&(t.strokeStyle=_ae,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const y=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,y),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const a=1,l=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*l;break;case"line-through":r-=.33*this.baselinePosition}const p=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(l+2*p),t.beginPath(),t.moveTo(this._toRenderUnit(i-p),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+p),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,a=this.renderedHeight;s!==0?(s=Ot(s,0,Math.floor(a/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+a-s),t.arcTo(i+n,r+a,i+n-s,r+a,s),t.lineTo(i+s,r+a),t.arcTo(i,r+a,i,r+a-s,s),t.closePath()):t.rect(i,r,n,a)}_renderHalo(t,i,r,s,n){const a=this.renderedWidth,l=this.renderedHeight,p=u$(tU,Math.max(a,dx),Math.max(l,dx)),y=p.getContext("2d");y.clearRect(0,0,a,l),this._setFontProperties(y,this.renderedFontSize),y.fillStyle=this._parameters.haloStyle,y.strokeStyle=this._parameters.haloStyle;const b=this.renderedHaloSize<3;y.lineJoin=b?"miter":"round",b?this._renderHaloEmulated(y,s,n):this._renderHaloNative(y,s,n);let x=n+this.baselinePosition;for(let A=0;A<this._lines.length;++A){const M=this._getLineXOffset(A);this._renderLineDecoration(y,s+M,x,this._textWidths[A],!0),x+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(p,0,0,a,l,this._toRenderUnit(i),this._toRenderUnit(r),a,l),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],a=this._getLineXOffset(s);for(const[l,p]of Dxe)this._fillText(t,n,i+a+this.haloSize*l,r+this.haloSize*p);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const a=this._lines[n],l=this._getLineXOffset(n),p=5,y=.1;for(let b=0;b<p;b++){const x=1-(p-1)*y+b*y;t.lineWidth=this._toRenderUnit(x*s),this._strokeText(t,a,i+l,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(L(this._displayWidth))return this._displayWidth;const t=u$(tU,dx,dx).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const a=t.measureText(n).width,l=a+i;this._textWidths.push(a),this._lineWidths.push(l),s=Math.max(s,l)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(J(this._heightMetrics)){const t=u$(tU,dx,dx).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+Zot),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),a=this._toRenderUnit(r[0]),l=this._toRenderUnit(r[1]),p=Math.floor(s)+.5,y=Math.ceil(s+a)-.5,b=Math.floor(n)+.5,x=Math.ceil(n+l)-.5;t.beginPath(),t.moveTo(p,b),t.lineTo(y,b),t.lineTo(y,x),t.lineTo(p,x),t.lineTo(p,b),t.stroke()}}const Dxe=[];for(let t=0;t<360;t+=360/16)Dxe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var fv;function u$(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(fv||(fv={}));const tU={canvas:null},Jot=.2,dx=512,_ae="rgb(255, 0, 255, 0.5)",Zot=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),Kot={left:0,center:.5,right:1},d$={"bottom-left":yr(0,0),bottom:yr(.5,0),"bottom-right":yr(1,0),left:yr(0,.5),center:yr(.5,.5),right:yr(1,.5),"top-left":yr(0,1),top:yr(.5,1),"top-right":yr(1,1)};function Lxe(e){switch(e){case"left":return fv.Left;case"right":return fv.Right;default:return fv.Center}}function bae(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Qot(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function eat(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function tat(e){return e==="justify"?"center":e}function iat(e){return e==="middle"?"center":e}var $a,wae,qD;function _A(e){return e!=null}function px(e){return typeof e=="number"}function S8(e){return typeof e=="string"}function rat(e){return e==null||S8(e)}function Vn(e,t){e&&e.push(t)}function sat(e,t,i,r=lt()){const s=e||0,n=t||0,a=i||0;return s!==0&&pS(r,r,-s/180*Math.PI),n!==0&&dS(r,r,n/180*Math.PI),a!==0&&KL(r,r,a/180*Math.PI),r}function _1(e,t,i,r,s){const n=e.minSize,a=e.maxSize;if(e.expression)return Vn(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const l=r.symbolSize[i];return t.minSize[i]=l,t.maxSize[i]=l,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=$a.DefinedSize,!0}if(_A(e.field))return _A(e.stops)?e.stops.length===2&&px(e.stops[0].size)&&px(e.stops[1].size)?(xae(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=$a.DefinedSize,!0):(Vn(s,"Could not convert size info: stops only supported with 2 elements"),!1):px(n)&&px(a)&&_A(e.minDataValue)&&_A(e.maxDataValue)?(xae(n,a,e.minDataValue,e.maxDataValue,t,i),t.type[i]=$a.DefinedSize,!0):xS[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/xS[e.valueUnit],t.type[i]=$a.DefinedSize,!0):e.valueUnit==="unknown"?(Vn(s,"Could not convert size info: proportional size not supported"),!1):(Vn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!_A(e.field)){if(e.stops&&e.stops[0]&&px(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=$a.DefinedSize,!0;if(px(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=$a.DefinedSize,!0}return Vn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function xae(e,t,i,r,s,n){const a=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=a>0?e:t,s.maxSize[n]=a>0?t:e,s.offset[n]=e-i*a,s.factor[n]=a}function nat(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return Vn(r,"Could not convert size info: unsupported property"),null;if(!rat(e.field))return Vn(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Vn(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[$a.Undefined,$a.Undefined,$a.Undefined]};let s;switch(e.axis){case"width":return s=_1(e,t.size,0,i,r),s?t:null;case"height":return s=_1(e,t.size,2,i,r),s?t:null;case"depth":return s=_1(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=_1(e,t.size,0,i,r),s&&_1(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=_1(e,t.size,0,i,r),s=s&&_1(e,t.size,1,i,r),s=s&&_1(e,t.size,2,i,r),s?t:null;default:return Vn(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function oat(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===$a.DefinedSize&&(n*=t.modelSize[s],e.type[s]=$a.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==$a.Undefined)r=0;else if(e.type[1]!==$a.Undefined)r=1;else{if(e.type[2]===$a.Undefined)return Vn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===$a.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function Tae(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function aat(e,t,i){if(e.normalizationField)return Vn(i,"Could not convert color info: unsupported property"),null;if(S8(e.field)){if(!e.stops)return Vn(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Vn(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,Tae(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Vn(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Tae(t.color.colors,s,r)}}return t}function lat(e,t,i){if(e.normalizationField)return Vn(i,"Could not convert opacity info: unsupported property"),null;if(S8(e.field)){if(!e.stops)return Vn(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Vn(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Vn(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function iU(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function cat(e,t,i){if(!S8(e.field))return Vn(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Vn(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return iU(e,t.rotation,0),t;case"roll":return iU(e,t.rotation,1),t;case null:case void 0:case"heading":return iU(e,t.rotation,2),t;default:return Vn(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function Nxe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,a=!!t.supportedTypes&&!!t.supportedTypes.opacity,l=e.reduce((p,y)=>{if(!p)return p;if(y.valueExpression)return Vn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(y.type){case"size":return r?nat(y,p,t,i):p;case"color":return s?aat(y,p,i):p;case"opacity":return a?lat(y,p,i):null;case"rotation":return n?cat(y,p,i):p;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!oat(l.size,t,i)?null:l:null}function wZ(e){return e&&e.size!=null}function lO(e,t){if(!e)return{enabled:!1};if(ur.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=Nxe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:Fxe(i,t),requiresShaderTransformation:wZ(i)}:{enabled:!1}}function cO(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=Nxe(t.visualVariables,i);return!!s&&!!(EP(r.size,s.size,"size")&&EP(r.color,s.color,"color")&&EP(r.rotation,s.rotation,"rotation")&&EP(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=Fxe(s,i),e.requiresShaderTransformation=wZ(s),!0)}function EP(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function Fxe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=wZ(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=zs(),p0(BM),sat(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],BM),md(i.vvSymbolRotationMatrix,BM)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})($a||($a={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(wae||(wae={})),function(e){const t=lt(),i=Q();function r(n,a,l){if(!n.vvSizeEnabled)return l;nn(t,l);const p=n.vvSymbolRotationMatrix;C0(BM,p[0],p[1],p[2],0,p[3],p[4],p[5],0,p[6],p[7],p[8],0,0,0,0,1),As(t,t,BM);for(let y=0;y<3;++y){const b=n.vvSizeOffset[y]+a[0]*n.vvSizeFactor[y];i[y]=Ot(b,n.vvSizeMinSize[y],n.vvSizeMaxSize[y])}return ZL(t,t,i),yl(t,t,n.vvSymbolAnchor),t}function s(n,a,l){if(!a.vvSizeEnabled)return ze(n,1,1,1);for(let p=0;p<3;++p){const y=a.vvSizeOffset[p]+l[0]*a.vvSizeFactor[p];n[p]=Ot(y,a.vvSizeMinSize[p],a.vvSizeMaxSize[p])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(qD||(qD={}));const BM=lt(),CH=qD.evaluateModelTransform,hat=qD.evaluateModelTransformScale;class uat{constructor(){this.visible=!0}}class JS{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=nr(),this.instanceParameters=new uat,this._transformation=lt(),this._shaderTransformationDirty=!0,this.layerUid=Wt(r.layerUid,null),this.graphicUid=Wt(r.graphicUid,null),this.id=r.id?r.id:ec(),this.boundingInfo=Wt(r.boundingInfo,null),this.calculateShaderTransformation=Wt(this.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=z2(t)){J(this.boundingInfo)||(Ct(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return L(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return J(this.calculateShaderTransformation)?Wt(this.transformation,Rn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=lt()),nn(this._shaderTransformation,this.calculateShaderTransformation(Wt(this.transformation,Rn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(L(this._transformation)&&Ct(t,t,this._transformation),!0);const i=this.indices.get(Y.POSITION),r=this.vertexAttributes.get(Y.POSITION);return!!dbe(r,i,t)&&(L(this._transformation)&&Ct(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new UD(Rg.Highlight),i=this.instanceParameters;return i.highlights=nH(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=oH(i.highlights,t)}}const dat=lt(),Sae=$t(0,0,1),pat=16,fat=1.5,g2=YJ,mat=[g2/2,g2/2,1-g2/2,1-g2/2],gat=[tO*g2,tO*g2];class hO extends N0{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(L(r))this._prepareResourcesPrimitive(i,r);else{const s=jHe(this.symbol,this.symbolLayer),n=RL(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=s8(this._getIconSize());if(t)throw new Se("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?La(t.size):pat);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",n.anchorPosition);const a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:hv.PAD};r=new Sn(n.imageData,a),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(yat(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:La(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.slicePlaneEnabled=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(rU(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>H2e(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=mat,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/g2,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!je("esri-canvas-svg-support")&&_W(i))throw new Se("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.pixelRatio,a=await nh(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(a.ok===!1)throw Fg(a.error),new Se("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=a.value;const l=a.value.texture,p=l.params;this._size=this._computeSize(p,s),t.textureId=l.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new hE({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const b=(await import("./CIMSymbolRasterizer.730b4e55.js")).CIMSymbolRasterizer;Gi(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new b(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(b=>b.toJSON()):null;let a,l;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const b=this._context.renderer;if(isNaN(b.scaleExpression)){const x=b.scaleExpression,A=await p$e(x,this._context.layer.spatialReference,n);l=(M,P,$)=>{const k=Hot(A,M,{$view:$},"esriGeometryPoint",P);return k!==null?k:1}}else a=Number(b.scaleExpression)}this._cimScaleFactorOrFunction=a||l||1;const p=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Gi(r);const y=this._context.layer.fieldsIndex;this._cimRequiredFields=p.map(b=>y.get(b).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||V6e}_getOutlineSize(){let t=0;const i=this.symbolLayer;return L(i.outline)&&i.outline.size!=null?Math.max(La(i.outline.size),0):(t=rU(this._getPrimitive())?fat:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=Ss(i,"outline","color");if(L(r)){const s=Ft.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(rU(this._getPrimitive()))return Xot;const t=J(this._getPrimitive()),i=Ss(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?yr((i.x||0)+.5,.5-(i.y||0)):t in d$?d$[t]:d$.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=lO(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=this._cimSymbolMaterials.get(t.textureId);return r||(r=new qS(t),this._cimSymbolMaterials.set(t.textureId,r),i.add(r)),r}return this._material=new qS(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=es(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=La(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const x=this._generateTextureCIM(i),A=ie({textureId:x.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(A,this._context.stage),r=[x.params.width,x.params.height]}else r=this._size,s=this._material;const n=sO(i.geometry);if(J(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const a=t.renderingInfo,l=this._getVertexOpacityAndColor(a);let p=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const x=r[0]>r[1]?r[0]:r[1];p=this._getScaleFactor(a,x)}p*=this._symbolTextureRatio;const y=[r[0]*p,r[1]*p],b=this.setGraphicElevationContext(i,new cu);return this.ensureDrapedStatus(b.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,l,y,t.layer.uid):this._createAs3DShape(i,n,s,l,y,b,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=f4(hO.elevationModeChangeTypes,r,s);if(n!==Us.UPDATE)return n;const a=bd(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cO(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Hn.Recreate_Symbol;L(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Hn.Fast_Update}_defaultElevationInfoNoZ(){return vat}_createAs3DShape(t,i,r,s,n,a,l){const p=this.getFastUpdateAttrValues(t),y=p?M=>CH(this._fastUpdates.materialParameters,p,M):null,b=[$c.createPointGeometry(Sae,null,s,n,_at,null,p)],x=cZ(this._context,i,b,[r],a,this._context.layer.uid,l,y);if(x===null)return null;const A=new L0(this,x.object,b,null,null,iO,a);return A.alignedSampledElevation=x.sampledElevation,A.needsElevationUpdates=bd(a.mode)||a.mode==="absolute-height",A.getScreenSize=this._createScreenSizeGetter(n,y),A.calculateRelativeScreenBounds=M=>r.calculateRelativeScreenBounds(A.getScreenSize(),1,M),rO(A,i,this._context.elevationProvider),A}_createAsOverlay(t,i,r,s,n,a){r.renderPriority=this._renderPriority;const l=nr();To(i,l,this._context.overlaySR),l[2]=vZ;const p=this._context.clippingExtent;if(L(p)&&!eX(p,l))return null;const y=this.getFastUpdateAttrValues(t),b=y?P=>CH(this._fastUpdates.materialParameters,y,P):null,x=$c.createPointGeometry(Sae,l,s,n,null,null,y),A=new JS(x,r,{layerUid:a,graphicUid:t.uid,calculateShaderTransformation:b});l[3]=0,Yl(A.boundingSphere,l);const M=new T8(this,[A],null);return M.getScreenSize=this._createScreenSizeGetter(n,b),M.calculateRelativeScreenBounds=P=>r.calculateRelativeScreenBounds(M.getScreenSize(),1,P),M}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(a=St())=>{const l=i(dat);return a[0]=l[0]*s+r,a[1]=l[5]*n+r,a}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(a=St())=>(a[0]=s,a[1]=n,a)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=$t(t,t,t),r=Fp(1),s=t*r;return{modelSize:i,symbolSize:$t(s,s,s),unitInMeters:r,transformation:{anchor:Jc,scale:Jf,rotation:Jc}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){L(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}get test(){return{material:this._material}}}function yat(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function rU(e){return!!L(e)&&(e==="cross"||e==="x")}hO.PRIMITIVE_SIZE=gat,hO.elevationModeChangeTypes={definedChanged:Us.UPDATE,staysOnTheGround:Us.NONE,onTheGroundChanged:Us.RECREATE};const vat={mode:"relative-to-ground",offset:0},_at=_r(0,0,0,1);function MH(e){const t=[],i=[];xat(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return Tat(e,i,t),Sat(e,i,t,n),Aat(e,i,t,n),Eat(e,i,t,n),Cat(e,i,t,n),Mat(e,i,t,n),Rat(e,i,t,r),new ws(i,t,rc.Line)}function bat(e,t,i,r){const s=e.type==="polygon"?_0.CCW_IS_HOLE:_0.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:a,outlines:l}=y4(n,e.hasZ,s),p=new Float64Array(a.length),y=iZ(a,e.spatialReference,0,p,0,a,0,a.length/3,t,i,r),b=y!=null;return{lines:b?kxe(l,a,p):[],projectionSuccess:b,sampledElevation:y}}function kxe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const a=3*s,l=a+3*n;r.push({position:t.subarray(a,l),mapPosition:i?i.subarray(a,l):void 0})}return r}function wat(e,t){const i=e.type==="polygon"?_0.CCW_IS_HOLE:_0.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=y4(r,!1,i),a=ys(s,e.spatialReference,0,s,t,0,s.length/3);for(let l=2;l<s.length;l+=3)s[l]=vZ;return{lines:a?kxe(n,s):[],projectionSuccess:a}}function xat(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=Oat(r)&&s===yw.REMOVE,a=r.length/3-(n?1:0),l=new Uint32Array(2*(a-1)),p=n?$q(r,0,r.length-3):r;let y=0;for(let b=0;b<a-1;b++)l[y++]=b,l[y++]=b+1;t.push([Y.POSITION,{size:3,data:p,exclusive:n}]),i.push([Y.POSITION,l])}function Tat(e,t,i){const r=e.attributeData.mapPosition;J(r)||(i.push([Y.MAPPOS,i[0][1]]),t.push([Y.MAPPOS,{size:3,data:r}]))}function Sat(e,t,i,r){if(L(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([Y.COLOR,{size:4,data:Wt(s,Yot)}]),i.push([Y.COLOR,r])}function Eat(e,t,i,r){const s=e.attributeData.colorFeature;J(s)||(t.push([Y.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([Y.COLOR,r]))}function Aat(e,t,i,r){if(L(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([Y.SIZE,{size:1,data:[Wt(s,1)]}]),i.push([Y.SIZE,r])}function Cat(e,t,i,r){const s=e.attributeData.sizeFeature;J(s)||(t.push([Y.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([Y.SIZEFEATUREATTRIBUTE,r]))}function Mat(e,t,i,r){const s=e.attributeData.opacityFeature;J(s)||(t.push([Y.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([Y.OPACITYFEATUREATTRIBUTE,r]))}function Rat(e,t,i,r){if(J(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==vt.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=ir(e.overlayInfo.spatialReference);for(let A=0;A<s.length;A+=3)wX(r,A,s,A,n);const a=r.length/3,l=new Float32Array(a+1);let p=Pat,y=Iat,b=0,x=0;ze(p,s[x++],s[x++],s[x++]),l[0]=0;for(let A=1;A<a+1;++A)A===a&&(x=0),ze(y,s[x++],s[x++],s[x++]),b+=w_e(p,y),l[A]=b,[p,y]=[y,p];t.push([Y.DISTANCETOSTART,{size:1,data:l}]),i.push([Y.DISTANCETOSTART,i[0][1]])}function Oat(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var yw;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(yw||(yw={}));const Pat=Q(),Iat=Q();function RH(e){switch(e){case"butt":return Op.BUTT;case"square":return Op.SQUARE;case"round":return Op.ROUND;default:return null}}const WD=64,Uxe=WD/2,zxe=Uxe/5;function $at(e,t){return L(t)?Dat(e,Lat(t.style)):null}function Dat(e,t){return e.fromData(t,()=>H2e(t,WD,Uxe,zxe))}function Lat(e){return e==="diamond"?"kite":e}function Nat(e){const t=new Ir;return t.include(nxe,e),e.output===Te.Depth&&t.include(Zv,e),t.fragment.include(qp),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4"),t.fragment.uniforms.add("tex","sampler2D"),t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.UV0,"vec2"),t.attributes.add(Y.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(V`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),t.vertex.code.add(V`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(V`
    void clipAndTransform(inout vec4 pos, inout vec4 prev) {
      float vnp = nearFar[0] * 0.99;

      if (prev.z > -nearFar[0]) {
        //previous behind ncp
        prev = mix(pos, prev, interp(vnp, pos, prev));
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      prev = projectAndScale(prev);
    }
  `),t.vertex.code.add(V`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clipAndTransform(pos, prev);

        // normalize vector along line segment
        vec2 segment = pos.xy - prev.xy;
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = uv0.x * PERPENDICULAR(segment);
        vec2 displacementDirV = uv0.y * segment;

        vSize = ${V.float(WD/zxe)} * lineWidth;
        pos.xy += displacementDirU * vSize + displacementDirV * vSize;

        // Convert back into NDC
        pos.xy = (pos.xy / screenSize) * pos.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        vColor = getColor();
        vColor.a *= coverage;

        // transform final position to camera space for slicing
        vpos = (inverseProjectionMatrix * pos).xyz;
        gl_Position = pos;
      }
    }
  `),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.include(Ws,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(P0),t.fragment.code.add(V`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${V.float(1/WD)};
    vec2 samplePos = vUV + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${V.float(fa)}) {
      discard;
    }

    ${e.output===Te.Alpha?V`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===Te.Color?V`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Te.Color&&e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===Te.Highlight?V`gl_FragColor = vec4(1.0);`:""}
    ${e.output===Te.Depth?V`outputDepth(linearDepth);`:""}
  }
  `),t}const Fat=Object.freeze({__proto__:null,build:Nat}),Bxe=new Map([[Y.POSITION,0],[Y.UV0,2],[Y.AUXPOS1,3],[Y.SIZE,6],[Y.SIZEFEATUREATTRIBUTE,6],[Y.COLOR,5],[Y.COLORFEATUREATTRIBUTE,5],[Y.OPACITYFEATUREATTRIBUTE,7]]);class E8 extends Xr{constructor(t,i,r){super(t,i,r)}initializeProgram(t){const i=E8.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,Bxe)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),this.configuration.output===Te.Highlight&&D0(this.program,i),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i)),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio),this.program.setUniform2f("screenSize",i.camera.fullViewport[2],i.camera.fullViewport[3]),Q2e(this.program,t)}bindDraw(t){I0(this.program,t),Nv(this.program,this.configuration,t.slicePlane,{origin:t.origin,view:t.camera.viewMatrix}),this.program.setUniformMatrix4fv("inverseProjectionMatrix",Ms(zO.get(),t.camera.projectionMatrix)),this.program.rebindTextures()}_makePipelineState(t,i){const r=this.configuration,s=t===Qt.NONE;return Ti({blending:r.output===Te.Color||r.output===Te.Alpha?s?Qc:Zg(t):null,depthTest:{func:Jv(t)},depthWrite:s?r.writeDepth&&ac:e8(t),colorWrite:Ii,stencilWrite:r.sceneHasOcludees?b0:null,stencilTest:r.sceneHasOcludees?i?kv:Kv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ti({blending:Qc,depthTest:GD,depthWrite:null,colorWrite:Ii,stencilWrite:null,stencilTest:cxe}),this._occluderPipelineOpaque=Ti({blending:Qc,depthTest:GD,depthWrite:null,colorWrite:Ii,stencilWrite:axe,stencilTest:lxe}),this._occluderPipelineMaskWrite=Ti({blending:null,depthTest:mZ,depthWrite:null,colorWrite:null,stencilWrite:b0,stencilTest:kv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===tt.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===tt.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}E8.shader=new Ur(Fat,()=>import("./LineMarker.glsl.1f0e01d3.js"));class Ec extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!1,this.draped=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],Ec.prototype,"output",void 0),_([Oe()],Ec.prototype,"occluder",void 0),_([Oe()],Ec.prototype,"slicePlaneEnabled",void 0),_([Oe()],Ec.prototype,"transparent",void 0),_([Oe()],Ec.prototype,"writeDepth",void 0),_([Oe()],Ec.prototype,"draped",void 0),_([Oe()],Ec.prototype,"vvSize",void 0),_([Oe()],Ec.prototype,"vvColor",void 0),_([Oe()],Ec.prototype,"vvOpacity",void 0),_([Oe()],Ec.prototype,"sceneHasOcludees",void 0),_([Oe({count:Qt.COUNT})],Ec.prototype,"transparencyPassType",void 0),_([Oe()],Ec.prototype,"multipassTerrainEnabled",void 0),_([Oe()],Ec.prototype,"cullAboveGround",void 0);class kat extends Wp{constructor(t){super(t,zat),this._vertexAttributeLocations=Bxe,this.techniqueConfig=new Ec,this.layout=this.createLayout()}dispose(){}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===tt.DRAPED_MATERIAL,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===qs.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=on().vec3f(Y.POSITION).vec2f(Y.UV0).vec3f(Y.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(Y.SIZEFEATUREATTRIBUTE):t.f32(Y.SIZE),this.parameters.vvColorEnabled?t.f32(Y.COLORFEATUREATTRIBUTE):t.vec4f(Y.COLOR),this.parameters.vvOpacityEnabled&&t.f32(Y.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Bat(this.layout,this.parameters)}requiresSlot(t,i){if(t===tt.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===qs.OccludeAndTransparentStencil)return t===tt.OPAQUE_MATERIAL||t===tt.OCCLUDER_MATERIAL||t===tt.TRANSPARENT_OCCLUDER_MATERIAL;const r=fw(i);return r===Te.Color||r===Te.Alpha?t===(this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===tt.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Highlight||t.output===Te.Depth?new Uat(t):null}validateParameters(t){t.color&&t.color[3]<1&&(t.transparent=!0)}}class Uat extends HJ{constructor(t){super(ie(ie({},t),t.material.parameters))}updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this.ensureTechnique(E8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||this._updateOccludeeState(t),this.updateParameters(t)}bind(t,i){this.bindTextures(i.program),this.bindTextureScale(i.program),i.bindPass(this._material.parameters,t)}}const zat=ie(ie({width:0,color:[1,1,1,1],placement:"end",textureId:null,writeDepth:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,sceneHasOcludees:!1},Sd),fZ);class Bat{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(Y.POSITION).data,a=n.length/3;let l=1,p=0;this.parameters.vvSizeEnabled?p=i.vertexAttributes.get(Y.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(Y.SIZE)&&(l=i.vertexAttributes.get(Y.SIZE).data[0]);let y=[1,1,1,1],b=0;this.parameters.vvColorEnabled?b=i.vertexAttributes.get(Y.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(Y.COLOR)&&(y=i.vertexAttributes.get(Y.COLOR).data);let x=0;this.parameters.vvOpacityEnabled&&(x=i.vertexAttributes.get(Y.OPACITYFEATUREATTRIBUTE).data[0]);const A=t.transformation,M=new Float32Array(r.buffer);let P=s*(this.vertexBufferLayout.stride/4);const $=(B,W,q,X)=>{if(M[P++]=B[0],M[P++]=B[1],M[P++]=B[2],M[P++]=q[0],M[P++]=q[1],M[P++]=W[0],M[P++]=W[1],M[P++]=W[2],this.parameters.vvSizeEnabled?M[P++]=p:M[P++]=l,this.parameters.vvColorEnabled)M[P++]=b;else{const oe=Math.min(4*X,y.length-4);M[P++]=y[oe+0],M[P++]=y[oe+1],M[P++]=y[oe+2],M[P++]=y[oe+3]}this.parameters.vvOpacityEnabled&&(M[P++]=x)};let k;(function(B){B[B.ASCENDING=1]="ASCENDING",B[B.DESCENDING=-1]="DESCENDING"})(k||(k={}));const z=(B,W)=>{const q=ze(Vat,n[3*B],n[3*B+1],n[3*B+2]),X=Gat;let oe=B+W;do ze(X,n[3*oe],n[3*oe+1],n[3*oe+2]),oe+=W;while(WT(q,X)&&oe>=0&&oe<a);A&&(Ct(q,q,A),Ct(X,X,A)),$(q,X,[-1,-1],B),$(q,X,[1,-1],B),$(q,X,[1,1],B),$(q,X,[-1,-1],B),$(q,X,[1,1],B),$(q,X,[-1,1],B)},G=this.parameters.placement;G!=="begin"&&G!=="begin-end"||z(0,k.ASCENDING),G!=="end"&&G!=="begin-end"||z(a-1,k.DESCENDING)}}const Vat=Q(),Gat=Q(),wa={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},jat={dash:wa.dash,"dash-dot":[...wa.dash,...wa.dot],dot:wa.dot,"long-dash":wa["long-dash"],"long-dash-dot":[...wa["long-dash"],...wa.dot],"long-dash-dot-dot":[...wa["long-dash"],...wa.dot,...wa.dot],none:null,"short-dash":wa["short-dash"],"short-dash-dot":[...wa["short-dash"],...wa["short-dot"]],"short-dash-dot-dot":[...wa["short-dash"],...wa["short-dot"],...wa["short-dot"]],"short-dot":wa["short-dot"],solid:null},Hat=8;function qat(e,t=2){return J(e)?e:{pattern:e.slice(),pixelRatio:t}}function zSt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function Vxe(e){return L(e)&&e.type==="style"?Wat(e.style):null}function Wat(e){return L(e)?qat(jat[e],Hat):null}const Xat=["polyline","polygon","extent"];class A8 extends N0{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=lO(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:Fp(1);if(t<0)throw new Se("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=$at(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var r;const s=Da(this.symbolLayer.marker,y=>y.color),n=Da(this.symbolLayer.material,y=>y.color),a=this._getCombinedOpacityAndColor(i&&s||n);this._patternHidesLine&&!i&&(a[3]=0);const l=a[3],p={width:this._computeMaterialWidth((r=this.symbolLayer)==null?void 0:r.size),color:a,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:RH(this.symbolLayer.cap||"butt"),transparent:l<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:Vxe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?ie(ie({},p),this._fastUpdates.materialParameters):p}get lineMaterial(){return J(this._lineMaterial)&&(this._lineMaterial=new lT(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return J(this._ringMaterial)&&(this._ringMaterial=new lT(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return J(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new lT(qe(ie({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return J(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new lT(qe(ie({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return J(this._markerMaterial)&&L(this.symbolLayer.marker)&&L(this._markerTexture)&&(this._markerMaterial=new kat(qe(ie({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=es(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?La(Sst(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?mg(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=_r(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?mg(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?mg(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Xat,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cO(this._fastUpdates,i,this._vvConvertOptions))return Hn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return Hn.Fast_Update}prepareSymbolLayerPatch(t){var i,r;if(t.diff.type!=="partial")return;const s=t.diff.diff,n={};((i=s.size)==null?void 0:i.type)==="complete"&&(n.width=this._computeMaterialWidth(s.size.newValue),delete s.size),((r=s.cap)==null?void 0:r.type)==="complete"&&(n.cap=RH(Wt(s.cap.newValue,"butt")),delete s.cap);const a=this._prepareMarkerPatch(t,s);this._prepareMaterialPatch(t,s,a),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(l=>l.setParameters(n)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){L(this._lineMaterial)&&t(this._lineMaterial),L(this._ringMaterial)&&t(this._ringMaterial),L(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),L(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),L(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=Ss(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),a=n<1||this.needsDrivenTransparentPass,l=[r[0],r[1],r[2],n];t.setParameters({color:l,transparent:a})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=f4(A8.elevationModeChangeTypes,r,s);if(n!==Us.UPDATE)return n;const a=bd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>a)}slicePlaneEnabledChanged(){const t={slicePlaneEnabled:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof ki)return Fa.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),a=n.type==="polygon"?n.rings:n.paths,l=new Array,p=new Array,y=new Array,b=On(),x=bat(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),A=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(x,a,A,"LineSymbol3DLayer");for(let $=0;$<x.lines.length;$++){const{position:k,mapPosition:z}=x.lines[$];if(L(this._context.clippingExtent)&&(jr(b),Hh(b,z),!vp(b,this._context.clippingExtent)))continue;const G=this._createGeometry(t,k,z,n.type,VM.ELEVATED);l.push(G),p.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),y.push(Rn),ur.LINE_WIREFRAMES&&(l.push(G.cloneShallow()),p.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),y.push(Rn));const B=this.markerMaterial;L(B)&&(l.push(G.cloneShallow()),p.push(B),y.push(Rn))}if(l.length===0)return null;const M=new Qg({geometries:l,materials:p,transformations:y,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),P=new L0(this,M,l,null,null,Ort,i);return P.alignedSampledElevation=x.sampledElevation,P.needsElevationUpdates=bd(i.mode),P}_createGeometry(t,i,r,s,n){const a=s==="polygon"?yw.REMOVE:yw.KEEP,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,p=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return MH({overlayInfo:n===VM.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:a,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:p?null:this._getDrivenSize(t.renderingInfo),color:l?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,a=s.type==="polygon"?this.ringMaterial:this.lineMaterial;a.renderPriority=this._renderPriority;const l=ur.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,p=this.markerMaterial;L(l)&&(l.renderPriority=this._renderPriority-.001),L(p)&&(p.renderPriority=this._renderPriority-.002);const y=new Array,b=On(),x=jr(),A=wat(s,this._context.overlaySR),M=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(A,n,M,"LineSymbol3DLayer");for(const P of A.lines){if(jr(b),Hh(b,P.position),!vp(b,this._context.clippingExtent))continue;cS(x,b);const $=this._createGeometry(t,P.position,null,s.type,VM.DRAPED),k=G=>{const B=new JS($,G,{layerUid:i,graphicUid:r.uid});return y.push(B),B};if(L(p)){const G=k(p),B=this.symbolLayer.marker.placement;B!=="begin"&&B!=="begin-end"||Hh(b,P.position,0,1),B!=="end"&&B!=="begin-end"||Hh(b,P.position,P.position.length-3,1),this._updateBoundingSphere(G,b)}const z=k(a);if(this._updateBoundingSphere(z,b),ur.LINE_WIREFRAMES){const G=k(l);this._updateBoundingSphere(G,b)}}return new T8(this,y,x)}_updateBoundingSphere(t,i){fl(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return L(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=Wt(t,Fp(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?La(1):1:La(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(J(s)||s.type==="collection")return;const n=s.type==="complete"?Da(s.newValue,l=>l.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,a=this._getCombinedOpacityAndColor(n);r&&this._patchMaterialColor(rN(a),this._markerMaterial,t),this._patternHidesLine&&(a[3]=0),this._patchMaterialColor(a,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(J(r)||r.type!=="partial"||L(r.diff.style)||L(r.diff.placement)||L(r.diff.color)&&r.diff.color.type!=="complete")return!1;const s=r.diff.color;if(J(s))return delete i.marker,J(this.symbolLayer)||J(this.symbolLayer.marker)||J(this.symbolLayer.marker.color);const n=s.newValue;return J(n)?(delete i.marker,!0):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,!1)}_patchMaterialColor(t,i,r){if(J(i))return;const s=t[3];r.symbolLayerStatePatches.push(()=>i.setParameters({color:t,transparent:s<1||this.needsDrivenTransparentPass}))}}var VM;A8.elevationModeChangeTypes={definedChanged:Us.RECREATE,staysOnTheGround:Us.NONE,onTheGroundChanged:Us.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(VM||(VM={}));const Eae=2048,Yat=1.5,Jat=8;function Zat(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},a=xZ(e,t.padding),l=olt(e,{width:t.width-a.left-a.right,height:t.height-a.top-a.bottom}),{width:p,height:y}=nlt(e,l),b=clt(i),x=flt[b];return{format:b,quality:Ot(r!=null?r:x,0,100),area:l,width:p,height:y,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Kat(e,t){const i=Zat(e,t),r=i.area,s=i.width/r.width,n=xZ(i,t.padding),a=n.left+n.right,l=n.top+n.bottom,p=t.width-a,y=t.height-l,b=Math.floor(p*s+a),x=Math.floor(y*s+l),A=e&&e.layers?e.layers:[],M=i.ignoreBackground,P=i.ignorePadding;return{framebufferWidth:b,framebufferHeight:x,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:A,disableDecorations:i.disableDecorations,ignoreBackground:M,ignorePadding:P}}function Qat(e,t,i,r){r.premultipliedAlpha&&ult(e),i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.putImageData(e,0,0),r.flipY&&hlt(s);const n=s.getImageData(0,0,e.width,e.height),a=elt(i,t);return i.width=0,i.height=0,{dataUrl:a,data:n}}function elt(e,t){const i=dlt[t.format],r=t.quality/100;return e.toDataURL(i,r)}function sU(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(XD)try{return new ImageData(e,t)}catch{XD=!1}return Gxe(e,t,i)}function tlt(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(XD)try{return new ImageData(e,t,i)}catch{XD=!1}const s=Gxe(t,i,r);return s.data.set(e,0),s}function ilt(e,t,i,r=0,s=0,n=e.width-r,a=e.height-s,l=!1){const{data:p}=e,{width:y,height:b,data:x}=t,A=n/y,M=a/b,P=Math.ceil(A/2),$=Math.ceil(M/2),k=e.width;for(let z=0;z<b;z++)for(let G=0;G<y;G++){const B=4*(G+(l?b-z-1:z)*y);let W=0,q=0,X=0,oe=0,de=0,he=0;const fe=(z+.5)*M;for(let me=Math.floor(z*M);me<(z+1)*M;me++){const ge=Math.abs(fe-(me+.5))/$,Ce=(G+.5)*A,Ae=ge*ge;for(let Pe=Math.floor(G*A);Pe<(G+1)*A;Pe++){const De=Math.abs(Ce-(Pe+.5))/P,ne=Math.sqrt(Ae+De*De);if(ne>=1)continue;let pe=2*ne*ne*ne-3*ne*ne+1;const ye=4*(r+Pe+(s+me)*k);he+=pe*p[ye+3],q+=pe,!i&&p[ye+3]<255&&(pe=pe*p[ye+3]/255),X+=pe*p[ye],oe+=pe*p[ye+1],de+=pe*p[ye+2],W+=pe}}x[B]=X/W,x[B+1]=oe/W,x[B+2]=de/W,x[B+3]=he/q}return t}function rlt(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:a}=e,l=xZ(e,i),p=l.left+l.right,y=l.top+l.bottom,b=r-p,x=s-y,A=Math.min(Jat,Math.min((Eae-p)/b,(Eae-y)/x));return A<Yat?e:qe(ie({},e),{framebufferWidth:Math.round(b*A)+p,framebufferHeight:Math.round(x*A)+y,pixelRatio:n*A,resample:{region:{x:Math.round((a.x-l.left)*A)+l.left,y:Math.round((a.y-l.top)*A)+l.top,width:Math.round(a.width*A),height:Math.round(a.height*A)},width:r,height:s}})}function Gxe(e,t,i){return i||(i=slt()),i.getContext("2d").createImageData(e,t)}let bA=null,XD=!0;function slt(){return bA||(bA=document.createElement("canvas"),bA.width=1,bA.height=1),bA}function nlt(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function olt(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return alt(llt(i,e),t)}function alt(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,a=e.width/e.height;if(a===n)return s;if(a>n){const y=Math.floor(s.width/a),b=s.height-y;return{x:s.x,y:Math.floor(s.y+b/2),width:s.width,height:y}}const l=Math.floor(s.height*a),p=s.width-l;return{x:Math.floor(s.x+p/2),y:s.y,width:l,height:s.height}}function llt(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function xZ(e,t){return!t||e&&e.ignorePadding?mlt:t}function clt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return plt}}function hlt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function ult(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s>0){const n=s/255;t[r+0]=t[r+0]/n,t[r+1]=t[r+1]/n,t[r+2]=t[r+2]/n}}}const dlt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Aae=98,plt="png",flt={png:100,jpg:Aae,jpeg:Aae},mlt={top:0,right:0,bottom:0,left:0};var C3;const nU=new WeakMap;let glt=0,Of=C3=class extends Ye{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:W2(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:W2(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(nU.has(this.data)||nU.set(this.data,++glt),t(nU.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new C3(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return tlt(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new C3({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new C3({data:e}):ZT(C3,e)}};_([S({type:String,json:{write:wv}})],Of.prototype,"url",null),_([S({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),S()],Of.prototype,"data",null),_([Et("data")],Of.prototype,"writeData",null),_([wt("data")],Of.prototype,"readData",null),_([S({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Of.prototype,"transparent",null),_([S({json:{write:!0}})],Of.prototype,"wrap",void 0),_([S({readOnly:!0})],Of.prototype,"contentHash",null),Of=C3=_([re("esri.geometry.support.MeshTexture")],Of);const GM=Of;var OH;let Cm=OH=class extends Ye{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=L(e)?e.get(this):null;if(i)return i;const r=new OH(this.clonePropertiesWithDeduplication(t));return L(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:L(this.color)?this.color.clone():null,colorTexture:L(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:L(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};_([S({type:Ft,json:{write:!0}})],Cm.prototype,"color",void 0),_([S({type:GM,json:{write:!0}})],Cm.prototype,"colorTexture",void 0),_([S({type:GM,json:{write:!0}})],Cm.prototype,"normalTexture",void 0),_([S({nonNullable:!0,json:{write:!0}})],Cm.prototype,"alphaMode",void 0),_([S({nonNullable:!0,json:{write:!0}})],Cm.prototype,"alphaCutoff",void 0),_([S({nonNullable:!0,json:{write:!0}})],Cm.prototype,"doubleSided",void 0),Cm=OH=_([re("esri.geometry.support.MeshMaterial")],Cm);const TZ=Cm;var PH;let Mm=PH=class extends TZ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=L(e)?e.get(this):null;if(i)return i;const r=new PH(this.clonePropertiesWithDeduplication(t));return L(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return qe(ie({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:L(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:L(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:L(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:L(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};_([S({type:Ft,json:{write:!0}})],Mm.prototype,"emissiveColor",void 0),_([S({type:GM,json:{write:!0}})],Mm.prototype,"emissiveTexture",void 0),_([S({type:GM,json:{write:!0}})],Mm.prototype,"occlusionTexture",void 0),_([S({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Mm.prototype,"metallic",void 0),_([S({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Mm.prototype,"roughness",void 0),_([S({type:GM,json:{write:!0}})],Mm.prototype,"metallicRoughnessTexture",void 0),Mm=PH=_([re("esri.geometry.support.MeshMaterialMetallicRoughness")],Mm);const jxe=Mm;var p$;const fx=Ge.getLogger("esri.geometry.support.MeshVertexAttributes");let fu=p$=class extends Ye{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return M3(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},fx)}castPosition(e){return e&&e instanceof Float32Array&&fx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),M3(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},fx)}castUv(e){return M3(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},fx)}castNormal(e){return M3(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},fx)}castTangent(e){return M3(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},fx)}clone(){const e={position:Fe(this.position),uv:Fe(this.uv),normal:Fe(this.normal),tangent:Fe(this.tangent),color:Fe(this.color)};return new p$(e)}clonePositional(){const e={position:Fe(this.position),normal:Fe(this.normal),tangent:Fe(this.tangent),uv:this.uv,color:this.color};return new p$(e)}};function oU(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function M3(e,t,i,r,s){if(!e)return e;if(e instanceof t)return oU(e,r,t,s);for(const n of i)if(e instanceof n)return oU(new t(e),r,t,s);if(Array.isArray(e))return oU(new t(e),r,t,s);{const n=i.map(a=>`'${a.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function wA(e,t,i){t[i]=ylt(e)}function ylt(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}_([S({json:{write:wA}})],fu.prototype,"color",void 0),_([_i("color")],fu.prototype,"castColor",null),_([S({nonNullable:!0,json:{write:wA}})],fu.prototype,"position",void 0),_([_i("position")],fu.prototype,"castPosition",null),_([S({json:{write:wA}})],fu.prototype,"uv",void 0),_([_i("uv")],fu.prototype,"castUv",null),_([S({json:{write:wA}})],fu.prototype,"normal",void 0),_([_i("normal")],fu.prototype,"castNormal",null),_([S({json:{write:wA}})],fu.prototype,"tangent",void 0),_([_i("tangent")],fu.prototype,"castTangent",null),fu=p$=_([re("esri.geometry.support.MeshVertexAttributes")],fu);var XC;const vlt=Ge.getLogger("esri.geometry.support.MeshComponent");let Rm=XC=class extends Ye{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return ZT(XC,e)}castFaces(e){return M3(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},vlt)}castMaterial(e){return ZT(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?jxe:TZ,e)}clone(){return new XC({faces:Fe(this.faces),shading:this.shading,material:Fe(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:Fe(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new XC(i)}};_([S({json:{write:!0}})],Rm.prototype,"faces",void 0),_([_i("faces")],Rm.prototype,"castFaces",null),_([S({type:TZ,json:{write:!0}})],Rm.prototype,"material",void 0),_([_i("material")],Rm.prototype,"castMaterial",null),_([S({type:String,json:{write:!0}})],Rm.prototype,"shading",void 0),_([S({type:Boolean})],Rm.prototype,"trustSourceNormals",void 0),Rm=XC=_([re("esri.geometry.support.MeshComponent")],Rm);const _lt=Rm,C8=Ge.getLogger("esri.geometry.support.meshUtils.normalProjection");function blt(e,t,i,r,s){return R8(r)?(M8(gg.TO_PCPF,Cr.fromTypedArray(e),gn.fromTypedArray(t),gn.fromTypedArray(i),r,Cr.fromTypedArray(s)),s):(C8.error("Cannot convert spatial reference to PCPF"),s)}function BSt(e,t,i,r,s){return R8(r)?(M8(gg.FROM_PCPF,Cr.fromTypedArray(e),gn.fromTypedArray(t),gn.fromTypedArray(i),r,Cr.fromTypedArray(s)),s):(C8.error("Cannot convert to spatial reference from PCPF"),s)}function VSt(e,t,i){return ys(e,t,0,i,JL(t),0,e.length/3),i}function GSt(e,t,i){return ys(e,JL(i),0,t,i,0,e.length/3),t}function wlt(e,t,i){if(J(e))return t;const r=gn.fromTypedArray(e),s=gn.fromTypedArray(t);return g4(s,r,i),t}function xlt(e,t,i){if(J(e))return t;IS(ho,i);const r=Cr.fromTypedArray(e),s=Cr.fromTypedArray(t);return pw(s,r,ho),cJ(ho)||uZ(s,s),t}function Tlt(e,t,i){if(J(e))return t;IS(ho,i);const r=Cr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Cr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(pw(s,r,ho),cJ(ho)||uZ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Slt(e,t,i,r,s){if(!R8(r))return C8.error("Cannot convert spatial reference to PCPF"),s;M8(gg.TO_PCPF,Cr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),gn.fromTypedArray(t),gn.fromTypedArray(i),r,Cr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function jSt(e,t,i,r,s){if(!R8(r))return C8.error("Cannot convert to spatial reference from PCPF"),s;M8(gg.FROM_PCPF,Cr.fromTypedArray(e,16),gn.fromTypedArray(t),gn.fromTypedArray(i),r,Cr.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function M8(e,t,i,r,s,n){if(!t)return;const a=i.count,l=JL(s);if(Hxe(s))for(let p=0;p<a;p++)r.getVec(p,AP),t.getVec(p,of),kp(l,AP,CP,l),md(ho,CP),e===gg.FROM_PCPF&&gd(ho,ho),Gc(of,of,ho),n.setVec(p,of);else for(let p=0;p<a;p++){r.getVec(p,AP),t.getVec(p,of),kp(l,AP,CP,l),md(ho,CP);const y=S6(i.get(p,1));let b=Math.cos(y);e===gg.TO_PCPF&&(b=1/b),ho[0]*=b,ho[1]*=b,ho[2]*=b,ho[3]*=b,ho[4]*=b,ho[5]*=b,e===gg.FROM_PCPF&&gd(ho,ho),Gc(of,of,ho),ot(of,of),n.setVec(p,of)}return n}function R8(e){return Hxe(e)||Elt(e)}function Hxe(e){return e.isWGS84||dfe(e)||S0(e)||E0(e)}function Elt(e){return e.isWebMercator}var gg;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(gg||(gg={}));const AP=Q(),of=Q(),CP=lt(),ho=zs();function Alt(e){const t=new Ir;return t.include(da,{linearDepth:!1}),t.include(Uw,e),t.include(oxe,qe(ie({},e),{stippleRequiresStretchMeasure:!1})),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add(Y.UV0,"vec2"),t.attributes.add(Y.AUXPOS1,"vec3")),t.attributes.add(Y.POSITION,"vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(V`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.vertex.code.add(V`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped||t.vertex.code.add(V`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(V`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?t.vertex.code.add(V`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):t.vertex.code.add(V`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(V`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),t.vertex.code.add(V`}`),e.output===Te.Highlight&&t.include(Yg),t.include(Ws,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(V`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${V.float(fa)}) {
      discard;
    }

    ${e.output===Te.Color?V`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Te.Highlight?V`outputHighlight();`:""}
  }
  `),t}const Clt=Object.freeze({__proto__:null,build:Alt});class O8 extends Xr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==Te.Highlight}initializeProgram(t){const i=O8.shader.get(),r=this.configuration,s=i.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:r.stipplePreferContinuous});return new $r(t.rctx,s,mr)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(hh(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=L(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/i.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/i.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const r=t.stippleOffColor;this.program.setUniform4f("stippleOffColor",r[0],r[1],r[2],r.length>3?r[3]:1)}this.configuration.output===Te.Highlight&&D0(this.program,i)}bindDraw(t){I0(this.program,t),this.stippleEnabled&&!this.configuration.draped&&Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),kw(this.program,this.configuration,t),this.program.rebindTextures()}initializePipeline(){const t=this.configuration,i=ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),r=(s,n=null,a=null)=>Ti({blending:n,depthTest:mZ,depthWrite:a,colorWrite:Ii,stencilWrite:t.sceneHasOcludees?b0:null,stencilTest:t.sceneHasOcludees?s?kv:Kv:null});return t.output===Te.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,ac),r(!1,t.transparent||this.stippleEnabled?i:null,ac)):r(!1)}get primitiveType(){return mi.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}O8.shader=new Ur(Clt,()=>import("./NativeLine.glsl.a6c38b3b.js"));class Pf extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.sceneHasOcludees=!1}}_([Oe({count:Te.COUNT})],Pf.prototype,"output",void 0),_([Oe()],Pf.prototype,"slicePlaneEnabled",void 0),_([Oe()],Pf.prototype,"vertexColors",void 0),_([Oe()],Pf.prototype,"transparent",void 0),_([Oe()],Pf.prototype,"draped",void 0),_([Oe()],Pf.prototype,"stippleEnabled",void 0),_([Oe()],Pf.prototype,"stippleOffColorEnabled",void 0),_([Oe()],Pf.prototype,"stipplePreferContinuous",void 0),_([Oe()],Pf.prototype,"sceneHasOcludees",void 0);const Mlt=Ge.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var YD;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(YD||(YD={}));class Cae extends Wp{constructor(t){super(t,Plt),this._techniqueConfig=new Pf}getTechniqueConfig(t,i){this._techniqueConfig.output=t,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===tt.DRAPED_MATERIAL;const r=L(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&L(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}getPassParameters(){return this.parameters}intersect(t,i,r,s,n,a,l,p,y){L(y)?vtt(t,s,y,a,1,l):this._intersectLineGeometry(t,i,r,s,l)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||n4(i))return;if(!hbe(r))return void Mlt.error("intersection assumes a translation-only matrix");const a=t.vertexAttributes.get(Y.POSITION).data,l=s.camera,p=$lt;Pn(p,s.point);const y=2;ze(xA[0],p[0]-y,p[1]+y,0),ze(xA[1],p[0]+y,p[1]+y,0),ze(xA[2],p[0]+y,p[1]-y,0),ze(xA[3],p[0]-y,p[1]-y,0);for(let P=0;P<4;P++)if(!l.unprojectFromRenderScreen(xA[P],Y0[P]))return;Pa(l.eye,Y0[0],Y0[1],aU),Pa(l.eye,Y0[1],Y0[2],lU),Pa(l.eye,Y0[2],Y0[3],cU),Pa(l.eye,Y0[3],Y0[0],hU);let b=Number.MAX_VALUE,x=0;for(let P=0;P<a.length-5;P+=3){if(el[0]=a[P]+r[12],el[1]=a[P+1]+r[13],el[2]=a[P+2]+r[14],tl[0]=a[P+3]+r[12],tl[1]=a[P+4]+r[13],tl[2]=a[P+5]+r[14],Kr(aU,el)<0&&Kr(aU,tl)<0||Kr(lU,el)<0&&Kr(lU,tl)<0||Kr(cU,el)<0&&Kr(cU,tl)<0||Kr(hU,el)<0&&Kr(hU,tl)<0)continue;if(l.projectToRenderScreen(el,T_),l.projectToRenderScreen(tl,S_),T_[2]<0&&S_[2]>0){We(af,el,tl);const k=l.frustum,z=-Kr(k[Qr.NEAR],el)/rt(af,k[Qr.NEAR]);Ue(af,af,z),Xe(el,el,af),l.projectToRenderScreen(el,T_)}else if(T_[2]>0&&S_[2]<0){We(af,tl,el);const k=l.frustum,z=-Kr(k[Qr.NEAR],tl)/rt(af,k[Qr.NEAR]);Ue(af,af,z),Xe(tl,tl,af),l.projectToRenderScreen(tl,S_)}else if(T_[2]<0&&S_[2]<0)continue;T_[2]=0,S_[2]=0;const $=OX(A2(T_,S_,Oae),p);$<b&&(b=$,ke(Mae,el),ke(Rae,tl),x=P/3)}const A=s.rayBegin,M=s.rayEnd;if(b<y*y){let P=Number.MAX_VALUE;if(Gme(A2(Mae,Rae,Oae),A2(A,M,Ilt),x_)){We(x_,x_,A);const $=yt(x_);Ue(x_,x_,1/$),P=$/Er(A,M)}n(P,x_,x,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(Y.POSITION);return mJ(s,null,!1,i)}requiresSlot(t){return t===tt.OPAQUE_MATERIAL||t===tt.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Highlight?new Rlt(t):null}createBufferWriter(){const t=this.parameters.vertexColors?Wwe:Jst;return J(this.parameters.stipplePattern)?new p8(t):new Olt(t.clone().vec3f(Y.AUXPOS1).vec2f(Y.UV0))}}class Rlt extends Xg{updateParameters(t){return this.ensureTechnique(O8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output===Te.Color&&this._updateOccludeeState(t),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}class Olt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(Y.POSITION).length}write(t,i,r,s){QN(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(Y.AUXPOS1,Cr),a=i.indices.get(Y.POSITION),l=i.vertexAttributes.get(Y.POSITION).data,p=t.transformation,y=n.typedBufferStride,b=n.typedBuffer;s*=y;for(let x=0;x<a.length-1;x+=2)for(const A of[1,0]){const M=3*a[x+A],P=l[M],$=l[M+1],k=l[M+2],z=p[0]*P+p[4]*$+p[8]*k+p[12],G=p[1]*P+p[5]*$+p[9]*k+p[13],B=p[2]*P+p[6]*$+p[10]*k+p[14];b[s]=z,b[s+1]=G,b[s+2]=B,s+=y}}_writeUV0(t,i,r,s){var n;const a=r.getField(Y.UV0,vd),l=i.indices.get(Y.POSITION),p=i.vertexAttributes.get(Y.POSITION).data,y=(n=i.vertexAttributes.get(Y.DISTANCETOSTART))==null?void 0:n.data,b=t.transformation,x=a.typedBufferStride,A=a.typedBuffer;let M=0;A[s*=x]=YD.START,A[s+1]=M,s+=x;const P=3*l[0],$=ze(el,p[P],p[P+1],p[P+2]);b&&Ct($,$,b);const k=tl,z=l.length-1;let G=1;const B=y?(q,X,oe)=>M=y[oe]:(q,X,oe)=>M+=Er(q,X);for(let q=1;q<z;q+=2){const X=3*l[q];ze(k,p[X],p[X+1],p[X+2]),b&&Ct(k,k,b),B($,k,G++);for(let oe=0;oe<2;++oe)A[s]=1-oe,A[s+1]=M,s+=x;ke($,k)}const W=3*l[z];ze(k,p[W],p[W+1],p[W+2]),b&&Ct(k,k,b),B($,k,G),A[s]=YD.END,A[s+1]=M}}const Plt=ie({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1},Sd),el=Q(),tl=Q(),af=Q(),x_=Q(),T_=ca(),S_=ca(),Mae=Q(),Rae=Q(),Oae=M0(),Ilt=M0(),$lt=Q(),xA=[ca(),ca(),ca(),ca()],Y0=[Q(),Q(),Q(),Q()],aU=er(),lU=er(),cU=er(),hU=er(),Dlt=["mesh"];class Llt extends N0{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ur.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Cae({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Cae({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Dlt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new cu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);L(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Fv)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);L(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return J(t)?"-":t instanceof Ft?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:a,normalTexture:l,doubleSided:p,alphaCutoff:y,alphaMode:b}=i.material,x=this._colorOrTextureUid(n),A=this._colorOrTextureUid(a),M=this._colorOrTextureUid(l);if(s.color=n,s.colorTexture=a,s.normalTexture=l,s.uid=`${s.uid},cmuid:${x},ctmuid:${A},ntmuid:${M},ds:${p},ac:${y},am:${b}`,i.material instanceof jxe){const{metallic:P,roughness:$,metallicRoughnessTexture:k,emissiveColor:z,emissiveTexture:G,occlusionTexture:B}=i.material,W=this._colorOrTextureUid(k),q=this._colorOrTextureUid(z),X=this._colorOrTextureUid(G),oe=this._colorOrTextureUid(B);s.metallic=P,s.roughness=$,s.metallicRoughnessTexture=k,s.emissiveColor=z,s.emissiveTexture=G,s.occlusionTexture=B,s.uid=`${s.uid},mrm:${P},mrr:${$},mrt:${W},emuid:${q},etmuid:${X},otmuid:${oe}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=Ft.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,Pr.Opaque);return L(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new Sn(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==Pr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return ei.CLAMP_TO_EDGE;case"mirror":return ei.MIRRORED_REPEAT;default:return ei.REPEAT}}_setInternalMaterialParameters(t,i){if(L(t.color)&&this._setInternalColorValueParameters(t.color,i),L(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);L(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}L(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),L(t.emissiveColor)&&(i.emissiveFactor=Ft.toUnitRGB(t.emissiveColor)),L(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),L(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),L(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=L(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=Xf;else{const s=L(this.symbolLayer.material)?this.symbolLayer.material.color:null;L(s)?t.externalColor=Ft.toUnitRGBA(s):(r=null,t.externalColor=Xf)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(J(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var r,s,n;const a=(r=i.material)==null?void 0:r.color,l=(s=i.material)==null?void 0:s.colorTexture,p=(n=i.material)==null?void 0:n.alphaMode,y=p==="blend",b=p!=="opaque"&&(this._hasTransparentVertexColors(t)||L(a)&&a.a<1||L(l)&&l.transparent||y),x=this._materialProperties(t,i,b),A=this._materials.get(x.uid);if(A)return A.material;const M={material:null,isComponentTransparent:b,alphaMode:i.material?i.material.alphaMode:"opaque"},P=x.metallicRoughnessTexture==null&&x.metallic==null&&x.roughness==null,$={usePBR:this._usePBR(),isSchematic:P,vertexColors:x.hasVertexColors,symbolColors:x.hasSymbolVertexColors,vertexTangents:x.hasVertexTangents,ambient:Jc,diffuse:Jf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Fr.None,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};P||($.mrrFactors=[x.metallic!=null?x.metallic:1,x.roughness!=null?x.roughness:1,.5]),i.material&&($.doubleSided=i.material.doubleSided,$.cullFace=i.material.doubleSided?Fr.None:Fr.Back,$.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters($),this._setMaterialTransparentParameter($,M),this._setInternalMaterialParameters(x,$);const k=new gw($);return M.material=k,this._materials.set(x.uid,M),this._context.stage.add(k),k}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Pr.MaskBlend:Pr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?Pr.Opaque:i.alphaMode==="mask"?Pr.Mask:Pr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,a=t.spatialReference.isGeographic?20015077/180:1,l=.1*Math.max(t.extent.width*a,t.extent.height*a,t.extent.zmax-t.extent.zmin),p=[],y=[],b=[],x=[];for(let P=0;P<n;P++){const $=i[P],k=$.vertexAttributes.get(Y.POSITION),z=$.vertexAttributes.get(Y.NORMAL),G=$.indices.get(Y.POSITION),B=$.indices.get(Y.NORMAL),W=k.data,q=z.data;for(let X=0;X<G.length;X++){const oe=3*G[X],de=3*B[X];for(let he=0;he<3;he++)p.push(W[oe+he]);for(let he=0;he<3;he++)p.push(W[oe+he]+q[de+he]*l);if(y.push(y.length),y.push(y.length),X%3==0){this._calculateFaceNormal(W,G,X,yx),this._getFaceVertices(W,G,X,Yo,mx,gx),Xe(Yo,Yo,mx),Xe(Yo,Yo,gx),Ue(Yo,Yo,1/3);for(let he=0;he<3;he++)b.push(Yo[he]);for(let he=0;he<3;he++)b.push(Yo[he]+yx[he]*l);x.push(x.length),x.push(x.length)}}}const A=new ws([[Y.POSITION,{data:p,size:3,exclusive:!0}]],[[Y.POSITION,new Uint32Array(y)]],rc.Line);i.push(A),r.push(this._debugVertexNormalMaterial),s.push(S2(s[0]));const M=new ws([[Y.POSITION,{data:b,size:3,exclusive:!0}]],[[Y.POSITION,new Uint32Array(x)]],rc.Line);i.push(M),r.push(this._debugFaceNormalMaterial),s.push(S2(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const a=this._createGeometryInfo(n,i);if(!a)return null;const{geometries:l,materials:p,transformations:y,objectTransformation:b}=a;ur.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,l,p,y);const x=new Qg({geometries:l,materials:p,transformations:y,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});x.transformation=b;const A=this._createEdgeMaterial(),M=L(A)?{baseMaterial:p[0],edgeMaterials:[A],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,P=new L0(this,x,l,null,null,iO,r,M);return P.needsElevationUpdates=Fv(r.mode),P.useObjectOriginAsAttachmentOrigin=!0,P.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(x),P.alignedSampledElevation=iO(P,P.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),P}_getCenterPointInElevationSR(t){const i=Kg(0,0,0,this._context.elevationProvider.spatialReference);return mme([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(J(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let a=0;a<s.length;a+=3){this._calculateFaceNormal(t,s,a,yx);for(let l=0;l<3;l++){const p=3*s[a+l];Yo[0]=i[p+0],Yo[1]=i[p+1],Yo[2]=i[p+2],rt(yx,Yo)<0&&(i[p+0]=-i[p+0],i[p+1]=-i[p+1],i[p+2]=-i[p+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const a=this._calculateFaceNormal(t,i,n,yx);for(let l=0;l<3;l++)r[n+l]=a[l],s[n+l]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let a=0;a<i.length;a+=3){const l=this._calculateFaceNormal(t,i,a,yx);for(let p=0;p<3;p++){const y=i[a+p];let b=r[y];b||(b={normal:Q(),count:0},r[y]=b),Xe(b.normal,b.normal,l),b.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let a=0;a<i.length;a++){const l=r[i[a]];l.count!==1&&(ot(l.normal,l.normal),l.count=1);for(let p=0;p<3;p++)s[3*a+p]=l.normal[p];n[a]=a}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,a){const l=3*i[r+0],p=3*i[r+1],y=3*i[r+2];s[0]=t[l+0],s[1]=t[l+1],s[2]=t[l+2],n[0]=t[p+0],n[1]=t[p+1],n[2]=t[p+2],a[0]=t[y+0],a[1]=t[y+1],a[2]=t[y+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Yo,mx,gx),We(mx,mx,Yo),We(gx,gx,Yo),si(Yo,mx,gx),ot(s,Yo),s}_getOrCreateComponents(t){return Wt(t.components,Nlt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===Ch.ECEF?i.transformBeforeProject:null;if(L(s)&&(r=wlt(r,new Float64Array(r.length),s)),i.reprojection===Ch.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=L(s)?r:new Float64Array(r.length);return ys(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(J(s))return null;const n=r.reprojection===Ch.ECEF?r.transformBeforeProject:null;if(L(n)&&(s=xlt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ch.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const a=t.vertexAttributes.position,l=L(n)?s:new Float32Array(s.length);return blt(s,a,i,t.spatialReference,l)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(J(s))return null;const n=r.reprojection===Ch.ECEF?r.transformBeforeProject:null;if(L(n)&&(s=Tlt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ch.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const a=t.vertexAttributes.position,l=L(n)?s:new Float32Array(s.length);return Slt(s,a,i,t.spatialReference,l)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=_ot(Ss(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return Txe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,a=t.vertexAttributes.tangent;if(L(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(L(a)&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(L(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const l=this._computeReprojectionInfo(t),p=this._createPositionBuffer(t,l),y=this._createColorBuffer(t),b=this._createSymbolColorBuffer(i),x=this._createNormalBuffer(t,p,l),A=this._createTangentBuffer(t,p,l);return{positionBuffer:p,normalBuffer:x,tangentBuffer:A,uvBuffer:n,colorBuffer:y,symbolColorBuffer:b,objectTransformation:l.reprojection===Ch.NONE&&L(l.objectTransformation)?l.objectTransformation:this._transformOriginLocal(t,p,x,A),geometryTransformation:l.reprojection===Ch.NONE&&L(l.geometryTransformation)?l.geometryTransformation:lt()}}_computeReprojectionInfo(t){const i=L(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===vt.Local?Ch.NONE:Ch.ECEF;if(i){if(r===Ch.NONE){const n=lt();return kp(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:S2(t.transform.localMatrix),needsBufferCopy:!1}}const s=QL(lt(),t.transform.origin);return As(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,a=t.anchor;MP[0]=a.x,MP[1]=a.y,MP[2]=a.z;const l=lt();kp(t.spatialReference,MP,l,n);const p=gn.fromTypedArray(i);if(Ms(Pae,l),g4(p,p,Pae),L(r)||L(s)){if(md(TA,l),gd(TA,TA),L(r)){const y=Cr.fromTypedArray(r);pw(y,y,TA)}if(L(s)){const y=Cr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);pw(y,y,TA)}}return l}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let a=0;a<s.length;a++){const l=s[a];l>n&&(n=l)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:BS(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),ys(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),jr(uU),Hh(uU,s,0,n),!vp(uU,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!Tv(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(J(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:a,symbolColorBuffer:l,normalBuffer:p,tangentBuffer:y,objectTransformation:b,geometryTransformation:x}=r,A=this._getOrCreateComponents(t),M=[],P=[],$=[];let k=!1;for(const z of A){if(!this._validateFaces(t,z))return null;const G=this._getOrCreateFaces(t,z);if(G.length===0)continue;const B=this._createComponentNormals(s,p,z,G);B.didFlipNormals&&(k=!0);const W=[[Y.POSITION,{size:3,data:s,exclusive:!0}],[Y.NORMAL,{size:3,data:B.normals,exclusive:!0}]],q=[[Y.POSITION,G],[Y.NORMAL,B.indices]];L(a)&&(W.push([Y.COLOR,{size:4,data:a,exclusive:!0}]),q.push([Y.COLOR,G])),L(l)&&(W.push([Y.SYMBOLCOLOR,{size:4,data:l,exclusive:!0}]),q.push([Y.SYMBOLCOLOR,new Uint16Array(G.length)])),L(n)&&(W.push([Y.UV0,{size:2,data:n,exclusive:!0}]),q.push([Y.UV0,G])),L(y)&&(W.push([Y.TANGENT,{size:4,data:y,exclusive:!0}]),q.push([Y.TANGENT,G]));const X=new ws(W,q);M.push(X),P.push(x),$.push(this._getOrCreateMaterial(t,z))}return k&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:M,transformations:P,materials:$,objectTransformation:b}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return Owe(this.symbolLayer,t)}}const MP=Q(),Yo=Q(),mx=Q(),gx=Q(),yx=Q(),Pae=lt(),TA=zs(),uU=On(),Nlt=[new _lt];var Ch;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(Ch||(Ch={}));class Flt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){sZ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);L(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=Q()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,lf),Ct(t,this.lodRenderer.baseBoundingSphere.center,lf)}getBoundingBoxObjectSpace(t=On()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,lf);const i=this.lodRenderer.baseBoundingBox;jr(t);for(let r=0;r<8;++r)ze(mu,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),Ct(mu,mu,lf),u0(t,mu);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,lf),t.render.origin[0]+=lf[12],t.render.origin[1]+=lf[13],t.render.origin[2]+=lf[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const a=this.getBoundingBoxObjectSpace(n),l=klt,p=GL(a)?1:l.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,lf);for(let b=0;b<p;b++){const x=l[b];mu[0]=a[x[0]],mu[1]=a[x[1]],mu[2]=a[x[2]],Ct(mu,mu,lf),E_[3*b+0]=mu[0],E_[3*b+1]=mu[1],E_[3*b+2]=mu[2]}if(!t(E_,0,p))return null;jr(a);let y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(let b=0;b<3*p;b+=3){for(let x=0;x<3;x++)a[x]=Math.min(a[x],E_[b+x]),a[x+3]=Math.max(a[x+3],E_[b+x]);y&&r.push({location:E_.slice(b,b+3),screenSpaceBoundingRect:y})}if(i&&(yp(a,dU),this.elevationContext.mode!=="absolute-height")){let b;const x=tZ(a,i);try{b=await i.service.queryElevation(dU[0],dU[1],s,x,"ground")}catch{}L(b)&&p0e(a,0,0,-this.alignedSampledElevation+b)}return a}addObjectState(t,i){if(t===Rg.Highlight){const r=new UD(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const E_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],mu=Q(),dU=Q(),klt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],lf=lt();function Ult(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function zlt(e){return{levels:e.map(t=>Ult(t))}}function Blt(e,t=Glt){const i=Yrt(e);return Math.sqrt(i/(t*Math.PI))}function Vlt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=Blt(t))})}const Glt=.05;function HSt(e){return e=e||globalThis.location.hostname,Hlt.some(t=>{var i;return((i=e)==null?void 0:i.match(t))!=null})}function jlt(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(qxe)!=null||t.match(Xxe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(Wxe)!=null||t.match(Yxe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const qxe=/^devext.arcgis.com$/,Wxe=/^qaext.arcgis.com$/,Xxe=/^[\w-]*\.mapsdevext.arcgis.com$/,Yxe=/^[\w-]*\.mapsqa.arcgis.com$/,Hlt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,qxe,Wxe,/^jsapps.esri.com$/,Xxe,Yxe];function qlt(e,t,i){if(e.count!==t.count)return void a8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],a=i[2],l=i[3],p=i[4],y=i[5],b=i[6],x=i[7],A=i[8],M=i[9],P=i[10],$=i[11],k=i[12],z=i[13],G=i[14],B=i[15],W=e.typedBuffer,q=e.typedBufferStride,X=t.typedBuffer,oe=t.typedBufferStride;for(let de=0;de<r;de++){const he=de*q,fe=de*oe,me=X[fe],ge=X[fe+1],Ce=X[fe+2],Ae=X[fe+3];W[he]=s*me+p*ge+A*Ce+k*Ae,W[he+1]=n*me+y*ge+M*Ce+z*Ae,W[he+2]=a*me+b*ge+P*Ce+G*Ae,W[he+3]=l*me+x*ge+$*Ce+B*Ae}}function Jxe(e,t,i){if(e.count!==t.count)return void a8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],a=i[2],l=i[3],p=i[4],y=i[5],b=i[6],x=i[7],A=i[8],M=e.typedBuffer,P=e.typedBufferStride,$=t.typedBuffer,k=t.typedBufferStride;for(let z=0;z<r;z++){const G=z*P,B=z*k,W=$[B],q=$[B+1],X=$[B+2],oe=$[B+3];M[G]=s*W+l*q+b*X,M[G+1]=n*W+p*q+x*X,M[G+2]=a*W+y*q+A*X,M[G+3]=oe}}function IH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,l=t.typedBufferStride;for(let p=0;p<r;p++){const y=p*n,b=p*l;s[y]=i*a[b],s[y+1]=i*a[b+1],s[y+2]=i*a[b+2],s[y+3]=i*a[b+3]}}function Wlt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,l=t.typedBufferStride;for(let p=0;p<r;p++){const y=p*n,b=p*l;s[y]=a[b]>>i,s[y+1]=a[b+1]>>i,s[y+2]=a[b+2]>>i,s[y+3]=a[b+3]>>i}}Object.freeze({__proto__:null,transformMat4:qlt,transformMat3:Jxe,scale:IH,shiftRight:Wlt});function Xlt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b){for(let x=0;x<9;++x)r[p+x]=n[y+x];p+=s,y+=a}}Object.freeze({__proto__:null,copy:Xlt});function Ylt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b){for(let x=0;x<16;++x)r[p+x]=n[y+x];p+=s,y+=a}}Object.freeze({__proto__:null,copy:Ylt});function Jlt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b)r[p]=n[y],p+=s,y+=a}function f$(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze({__proto__:null,copy:Jlt,makeDense:f$});function Zxe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b)r[p]=n[y],r[p+1]=n[y+1],p+=s,y+=a}function Kxe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;if(AJe(t.elementType)){const b=CJe(t.elementType);if(EJe(t.elementType))for(let x=0;x<l;++x)r[p]=Math.max(n[y]/b,-1),r[p+1]=Math.max(n[y+1]/b,-1),p+=s,y+=a;else for(let x=0;x<l;++x)r[p]=n[y]/b,r[p+1]=n[y+1]/b,p+=s,y+=a}else Zxe(e,t,i);return e}function Zlt(e,t,i,r){var s,n;const a=e.typedBuffer,l=e.typedBufferStride,p=(s=r==null?void 0:r.count)!=null?s:e.count;let y=((n=r==null?void 0:r.dstIndex)!=null?n:0)*l;for(let b=0;b<p;++b)a[y]=t,a[y+1]=i,y+=l}Object.freeze({__proto__:null,copy:Zxe,normalizeIntegerBuffer:Kxe,fill:Zlt});function SZ(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b)r[p]=n[y],r[p+1]=n[y+1],r[p+2]=n[y+2],p+=s,y+=a}function Klt(e,t,i,r,s){var n,a;const l=e.typedBuffer,p=e.typedBufferStride,y=(n=s==null?void 0:s.count)!=null?n:e.count;let b=((a=s==null?void 0:s.dstIndex)!=null?a:0)*p;for(let x=0;x<y;++x)l[b]=t,l[b+1]=i,l[b+2]=r,b+=p}Object.freeze({__proto__:null,copy:SZ,fill:Klt});function Qxe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,l=i?i.count:t.count;let p=(i&&i.dstIndex?i.dstIndex:0)*s,y=(i&&i.srcIndex?i.srcIndex:0)*a;for(let b=0;b<l;++b)r[p]=n[y],r[p+1]=n[y+1],r[p+2]=n[y+2],r[p+3]=n[y+3],p+=s,y+=a}function e3e(e,t,i,r,s,n){var a,l;const p=e.typedBuffer,y=e.typedBufferStride,b=(a=n==null?void 0:n.count)!=null?a:e.count;let x=((l=n==null?void 0:n.dstIndex)!=null?l:0)*y;for(let A=0;A<b;++A)p[x]=t,p[x+1]=i,p[x+2]=r,p[x+3]=s,x+=y}Object.freeze({__proto__:null,copy:Qxe,fill:e3e});function Qb(e,t){return new e(new ArrayBuffer(t*e.ElementCount*obe(e.ElementType)))}class t3e{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return x0(t)?(Gi(i),_pe(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(J(this.streamDataRequester))return(await Ar(i,{responseType:Qlt[t]})).data;const s=await nh(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw Fg(s.error),new Se("",`Request for resource failed: ${s.error}`)}}const Qlt={image:"image",binary:"array-buffer",json:"json"},ect=Ge.getLogger("esri.views.3d.glTF");class tct{error(t){throw new Se("gltf-loader-error",t)}errorUnsupported(t){throw new Se("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){ect.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function ict(e={}){return ie({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function rct(e,t={}){return{data:e,parameters:ie({wrap:ie({s:ei.REPEAT,t:ei.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class Uv{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new Se(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new Uv(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new Se((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new Se((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const a=parseInt(r,10),l=parseInt(s,10);return new Uv(a,l,i)}}class Iae{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var jM,$ae;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(jM||(jM={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}($ae||($ae={}));const i3e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},sct={pbrMetallicRoughness:i3e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},nct={ESRI_externalColorMixMode:"tint"},Dae=(e={})=>{const t=ie(ie({},i3e),e.pbrMetallicRoughness),i=oct(ie(ie({},nct),e.extras));return qe(ie(ie({},sct),e),{pbrMetallicRoughness:t,extras:i})};function oct(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const act={magFilter:Pt.LINEAR,minFilter:Pt.LINEAR_MIPMAP_LINEAR,wrapS:ei.REPEAT,wrapT:ei.REPEAT},lct=e=>ie(ie({},act),e);function cct(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const RP={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Vm{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=cct(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(x0(r)){const l=RL(r);if(l.mediaType!=="model/gltf-binary")try{const y=JSON.parse(l.isBase64?atob(l.data):l.data);return new Vm(t,i,r,y)}catch{}const p=_pe(r);if(Vm._isGLBData(p))return this._fromGLBData(t,i,r,p)}if(r.endsWith(".gltf")){const l=await t.loadJSON(r,s);return new Vm(t,i,r,l)}const n=await t.loadBinary(r,s);if(Vm._isGLBData(n))return this._fromGLBData(t,i,r,n);const a=await t.loadJSON(r,s);return new Vm(t,i,r,a)}static _isGLBData(t){const i=new Iae(t);return i.remainingBytes()>=4&&i.readUint32()===RP.MAGIC}static async _fromGLBData(t,i,r,s){const n=await Vm._parseGLBData(i,s);return new Vm(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new Iae(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),a=r.readUint32();t.assert(s===RP.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=a,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let l,p,y=0;for(;r.remainingBytes()>=8;){const b=r.readUint32(),x=r.readUint32();y===0?(t.assert(x===RP.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(b>=0,"No JSON data found."),l=await mct(r.readUint8Array(b))):y===1?(t.errorUnsupportedIf(x!==RP.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),p=r.readUint8Array(b)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),y+=1}return l||t.error("No GLB JSON chunk detected."),{json:l,binaryData:p}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(a=>new Uint8Array(a));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[jM.MAT2,jM.MAT3,jM.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],a=await this.getBuffer(n.buffer,i),l=dct[s.type],p=pct[s.componentType],y=l*p,b=n.byteStride||y;return{raw:a.buffer,byteStride:b,byteOffset:a.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:b===y,componentCount:l,componentByteSize:p,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Zt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Zt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Zt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Zt.UNSIGNED_BYTE:return f$(this._wrapAccessor(Og,r));case Zt.UNSIGNED_SHORT:return f$(this._wrapAccessor(nw,r));case Zt.UNSIGNED_INT:return f$(this._wrapAccessor(aw,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==Zt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+PP[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Cr,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==Zt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+PP[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Cr,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==Zt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+PP[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new So(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===Zt.FLOAT?this._wrapAccessor(vd,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),fct(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===Zt.FLOAT)return this._wrapAccessor(So,s);if(s.componentType===Zt.UNSIGNED_BYTE)return this._wrapAccessor(lc,s);if(s.componentType===Zt.UNSIGNED_SHORT)return this._wrapAccessor(Pv,s)}else if(s.componentCount===3){if(s.componentType===Zt.FLOAT)return this._wrapAccessor(Cr,s);if(s.componentType===Zt.UNSIGNED_BYTE)return this._wrapAccessor(Ov,s);if(s.componentType===Zt.UNSIGNED_SHORT)return this._wrapAccessor(ow,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+PP[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?Dae(this.json.materials[t.material]):Dae(),a=n.pbrMetallicRoughness,l=this.hasVertexColors(t),p=this.getTexture(a.baseColorTexture,i),y=this.getTexture(n.normalTexture,i),b=r?this.getTexture(n.occlusionTexture,i):null,x=r?this.getTexture(n.emissiveTexture,i):null,A=r?this.getTexture(a.metallicRoughnessTexture,i):null,M=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:a.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await p,normalTexture:await y,name:n.name,id:M,occlusionTexture:await b,emissiveTexture:await x,emissiveFactor:n.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:await A,vertexColors:l,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],a=lct(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const l=this.json.images[n.source],p=await this._loadTextureImageData(r,n,i);return yde(this.textureCache,r,()=>{const y=x=>x===33071||x===33648||x===10497,b=x=>(s.error(`Unexpected TextureSampler WrapMode: ${x}. Using default REPEAT(10497).`),10497);return{data:p,wrapS:y(a.wrapS)?a.wrapS:b(a.wrapS),wrapT:y(a.wrapT)?a.wrapT:b(a.wrapT),minFilter:a.minFilter,name:l.name,id:r}})}getNodeTransform(t){if(t===void 0)return uct;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=As(lt(),r,s.matrix):s.translation||s.rotation||s.scale?(i=S2(r),s.translation&&yl(i,i,s.translation),s.rotation&&(OP[3]=z_e(OP,s.rotation),qc(i,i,OP[3],OP)),s.scale&&ZL(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return nd(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=Uv.parse(this.json.asset.version,"glTF");hct.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],a=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),gct(new Uint8Array(a.buffer,a.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const hct=new Uv(2,0,"glTF"),uct=ime(lt(),Math.PI/2),OP=Hv(),dct={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},pct={[Zt.BYTE]:1,[Zt.UNSIGNED_BYTE]:1,[Zt.SHORT]:2,[Zt.UNSIGNED_SHORT]:2,[Zt.FLOAT]:4,[Zt.UNSIGNED_INT]:4};function fct(e){switch(e.componentType){case Zt.BYTE:return new lw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Zt.UNSIGNED_BYTE:return new sw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Zt.SHORT:return new cw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Zt.UNSIGNED_SHORT:return new kS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Zt.UNSIGNED_INT:return new US(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Zt.FLOAT:return new vd(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function mct(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function gct(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),a=new Image;a.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in a?a.decode().then(()=>i(a),()=>i(a)):i(a)}),a.addEventListener("error",l=>{URL.revokeObjectURL(n),r(l)}),a.src=n})}const PP={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let yct=0;async function r3e(e,t,i={},r=!0){const s=await Vm.load(e,m$,t,i),n="gltf_"+yct++,a={lods:[],materials:new Map,textures:new Map,meta:vct(s)},l=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),p=new Map;await _ct(s,async(y,b,x,A)=>{var M;const P=(M=p.get(x))!=null?M:0;p.set(x,P+1);const $=y.mode!==void 0?y.mode:mi.TRIANGLES,k=$===mi.TRIANGLES||$===mi.TRIANGLE_STRIP||$===mi.TRIANGLE_FAN?$:null;if(J(k))return void m$.warnUnsupported("Unsupported primitive mode ("+Tct[$]+"). Skipping primitive.");if(!s.hasPositions(y))return void m$.warn("Skipping primitive without POSITION vertex attribute.");const z=s.getPositionData(y,i),G=s.getMaterial(y,i,r),B=s.hasNormals(y)?s.getNormalData(y,i):null,W=s.hasTangents(y)?s.getTangentData(y,i):null,q=s.hasTextureCoordinates(y)?s.getTextureCoordinates(y,i):null,X=s.hasVertexColors(y)?s.getVertexColors(y,i):null,oe=s.getIndexData(y,i),de={transform:S2(b),attributes:{position:await z,normal:B?await B:null,texCoord0:q?await q:null,color:X?await X:null,tangent:W?await W:null},indices:await oe,primitiveType:k,material:wct(a,await G,n)};let he=null;L(a.meta)&&L(a.meta.ESRI_lod)&&a.meta.ESRI_lod.metric==="screenSpaceRadius"&&(he=a.meta.ESRI_lod.thresholds[x]),a.lods[x]=a.lods[x]||{parts:[],name:A,lodThreshold:he},a.lods[x].parts[P]=de});for(const y of a.lods)y.parts=y.parts.filter(b=>!!b);return{model:a,meta:{isEsriSymbolResource:l,uri:s.uri},customMeta:{}}}function vct(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;L(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function _ct(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const l of r){const p=i.nodes[l];n.push(a(l,0)),bct(p)&&!s&&p.extensions.MSFT_lod.ids.forEach((y,b)=>a(y,b+1))}async function a(l,p){const y=i.nodes[l],b=e.getNodeTransform(l);if(m$.warnUnsupportedIf(y.weights!=null,"Morph targets are not supported."),y.mesh!=null){const x=i.meshes[y.mesh];for(const A of x.primitives)n.push(t(A,b,p,x.name))}for(const x of y.children||[])n.push(a(x,p))}await Promise.all(n)}function bct(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function wct(e,t,i){const r=n=>{const a=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(a)){const l=rct(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:xct.some(p=>p===n.minFilter),noUnpackFlip:!0});e.textures.set(a,l)}return a},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=ict({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const m$=new tct,xct=[Pt.LINEAR_MIPMAP_LINEAR,Pt.LINEAR_MIPMAP_NEAREST],Tct=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function Sct(e,t=BS){return typeof e=="number"?t(e):V$(e)||Ub(e)?new Uint32Array(e):e}function Ect(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const a=e[n],l=e[n+1],p=e[n+2];r[s++]=a,r[s++]=l,r[s++]=p}else{const a=e[n+1],l=e[n],p=e[n+2];r[s++]=a,r[s++]=l,r[s++]=p}}return r}function Act(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],a=0;for(let l=0;l<i;++l){const p=e[l+2];r[a++]=s,r[a++]=n,r[a++]=p,n=p}return r}}const Om=Ge.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function s3e(e,t){const i=await Cct(e,t);return{resource:i,textures:await Ict(i.textureDefinitions,t)}}async function Cct(e,t){const i=L(t)&&t.streamDataRequester;if(i)return Mct(e,i,t);const r=await nh(Ar(e,t));if(r.ok===!0)return r.value.data;Fg(r.error),n3e(r.error)}async function Mct(e,t,i){const r=await nh(t.request(e,"json",i));if(r.ok===!0)return r.value;Fg(r.error),n3e(r.error.details.url)}function n3e(e){throw new Se("",`Request for object resource failed: ${e}`)}function Rct(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(Om.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const a in t.vertexAttributes){const l=n[a];l&&l.values?(l.valueType!=null&&l.valueType!=="UInt32"&&(Om.warn(`Unsupported indexed geometry indices type '${l.valueType}', only UInt32 is currently supported`),r=!1),l.valuesPerElement!=null&&l.valuesPerElement!==1&&(Om.warn(`Unsupported indexed geometry values per element '${l.valuesPerElement}', only 1 is currently supported`),r=!1)):(Om.warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else Om.warn("Indexed geometries must specify faces"),r=!1;break}default:Om.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(Om.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Om.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Oct(e,t){const i=[],r=[],s=[],n=[],a=e.resource,l=Uv.parse(a.version||"1.0","wosr");Dct.validate(l);const p=a.model.name,y=a.model.geometries,b=a.materialDefinitions,x=e.textures;let A=0;const M=new Map;for(let P=0;P<y.length;P++){const $=y[P];if(!Rct($))continue;const k=$ct($),z=$.params.vertexAttributes,G=[];for(const he in z){const fe=z[he],me=fe.values;G.push([he,{data:me,size:fe.valuesPerElement,exclusive:!0}])}const B=[];if($.params.topology!=="PerAttributeArray"){const he=$.params.faces;for(const fe in he)B.push([fe,new Uint32Array(he[fe].values)])}const W=x&&x[k.texture];if(W&&!M.has(k.texture)){const{image:he,params:fe}=W,me=new Sn(he,fe);n.push(me),M.set(k.texture,me)}const q=M.get(k.texture),X=q?q.id:void 0;let oe=s[k.material]?s[k.material][k.texture]:null;if(!oe){const he=b[k.material.substring(k.material.lastIndexOf("/")+1)].params;he.transparency===1&&(he.transparency=0);const fe=W&&W.alphaChannelUsage,me=he.transparency>0||fe==="transparency"||fe==="maskAndTransparency",ge=W?o3e(W.alphaChannelUsage):void 0,Ce={ambient:zl(he.diffuse),diffuse:zl(he.diffuse),opacity:1-(he.transparency||0),transparent:me,textureAlphaMode:ge,textureAlphaCutoff:.33,textureId:X,initTextureTransparent:!0,doubleSided:!0,cullFace:Fr.None,colorMixMode:he.externalColorMixMode||"tint",textureAlphaPremultiplied:!!W&&!!W.params.preMultiplyAlpha};L(t)&&t.materialParamsMixin&&Object.assign(Ce,t.materialParamsMixin),oe=new gw(Ce),s[k.material]||(s[k.material]={}),s[k.material][k.texture]=oe}r.push(oe);const de=new ws(G,B);A+=B.position?B.position.length:0,i.push(de)}return{name:p,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:a.model.pivotOffset,boundingBox:Pct(i),numberOfVertices:A,lodThreshold:null}}function Pct(e){const t=jr();return e.forEach(i=>{const r=i.boundingInfo;L(r)&&(u0(t,r.getBBMin()),u0(t,r.getBBMax()))}),t}async function Ict(e,t){const i=[];for(const n in e){const a=e[n],l=a.images[0].data;if(!l){Om.warn("Externally referenced texture data is not yet supported");continue}const p=a.encoding+";base64,"+l,y="/textureDefinitions/"+n,b=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",x={noUnpackFlip:!0,wrap:{s:ei.REPEAT,t:ei.REPEAT},preMultiplyAlpha:o3e(b)!==Pr.Opaque},A=L(t)&&t.disableTextures?Promise.resolve(null):yd(p,t);i.push(A.then(M=>({refId:y,image:M,params:x,alphaChannelUsage:b})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function o3e(e){switch(e){case"mask":return Pr.Mask;case"maskAndTransparency":return Pr.MaskBlend;case"none":return Pr.Opaque;default:return Pr.Blend}}function $ct(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Dct=new Uv(1,2,"wosr"),vx=2.1;async function a3e(e,t){const i=l3e(jlt(e));if(i.fileType==="wosr"){const p=await(t.cache?t.cache.loadWOSR(i.url,t):s3e(i.url,t)),y=Oct(p,t);return{lods:[y],referenceBoundingBox:y.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:p.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):r3e(new t3e(t.streamDataRequester),i.url,t,t.usePBR)),s=Ss(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&L(s)&&r.meta.uri.indexOf("/RealisticTrees/")!==-1&&Fct(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},a=qe(ie({},t.materialParamsMixin),{treeRendering:r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const p=g$(r,n,a,i.specifiedLodIndex);let y=p[0].boundingBox;return i.specifiedLodIndex!==0&&(y=g$(r,n,a,0)[0].boundingBox),{lods:p,referenceBoundingBox:y,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const l=g$(r,n,a);return{lods:l,referenceBoundingBox:l[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function l3e(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function g$(e,t,i,r){const s=e.model,n=zs(),a=new Array,l=new Map,p=new Map;return s.lods.forEach((y,b)=>{if(r!==void 0&&b!==r)return;const x={name:y.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:L(y.lodThreshold)?y.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:jr()};a.push(x),y.parts.forEach(A=>{const M=A.material+(A.attributes.normal?"_normal":"")+(A.attributes.color?"_color":"")+(A.attributes.texCoord0?"_texCoord0":"")+(A.attributes.tangent?"_tangent":""),P=s.materials.get(A.material),$=L(A.attributes.texCoord0),k=L(A.attributes.normal),z=Lct(P.alphaMode);if(!l.has(M)){if($){if(L(P.textureColor)&&!p.has(P.textureColor)){const De=s.textures.get(P.textureColor),ne=qe(ie({},De.parameters),{preMultiplyAlpha:z!==Pr.Opaque});p.set(P.textureColor,new Sn(De.data,ne))}if(L(P.textureNormal)&&!p.has(P.textureNormal)){const De=s.textures.get(P.textureNormal);p.set(P.textureNormal,new Sn(De.data,De.parameters))}if(L(P.textureOcclusion)&&!p.has(P.textureOcclusion)){const De=s.textures.get(P.textureOcclusion);p.set(P.textureOcclusion,new Sn(De.data,De.parameters))}if(L(P.textureEmissive)&&!p.has(P.textureEmissive)){const De=s.textures.get(P.textureEmissive);p.set(P.textureEmissive,new Sn(De.data,De.parameters))}if(L(P.textureMetallicRoughness)&&!p.has(P.textureMetallicRoughness)){const De=s.textures.get(P.textureMetallicRoughness);p.set(P.textureMetallicRoughness,new Sn(De.data,De.parameters))}}const he=P.color[0]**(1/vx),fe=P.color[1]**(1/vx),me=P.color[2]**(1/vx),ge=P.emissiveFactor[0]**(1/vx),Ce=P.emissiveFactor[1]**(1/vx),Ae=P.emissiveFactor[2]**(1/vx),Pe=L(P.textureColor)&&$?p.get(P.textureColor):null;l.set(M,new gw(ie(qe(ie({},t),{transparent:z===Pr.Blend,customDepthTest:ew.Lequal,textureAlphaMode:z,textureAlphaCutoff:P.alphaCutoff,diffuse:[he,fe,me],ambient:[he,fe,me],opacity:P.opacity,doubleSided:P.doubleSided,doubleSidedType:"winding-order",cullFace:P.doubleSided?Fr.None:Fr.Back,vertexColors:!!A.attributes.color,vertexTangents:!!A.attributes.tangent,normals:k?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,fillLightsEnabled:!0,textureId:L(Pe)?Pe.id:void 0,colorMixMode:P.colorMixMode,normalTextureId:L(P.textureNormal)&&$?p.get(P.textureNormal).id:void 0,textureAlphaPremultiplied:L(Pe)&&!!Pe.params.preMultiplyAlpha,occlusionTextureId:L(P.textureOcclusion)&&$?p.get(P.textureOcclusion).id:void 0,emissiveTextureId:L(P.textureEmissive)&&$?p.get(P.textureEmissive).id:void 0,metallicRoughnessTextureId:L(P.textureMetallicRoughness)&&$?p.get(P.textureMetallicRoughness).id:void 0,emissiveFactor:[ge,Ce,Ae],mrrFactors:[P.metallicFactor,P.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const G=Nct(A.indices||A.attributes.position.count,A.primitiveType),B=A.attributes.position.count,W=Qb(Cr,B);g4(W,A.attributes.position,A.transform);const q=[[Y.POSITION,{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]],X=[[Y.POSITION,G]];if(L(A.attributes.normal)){const he=Qb(Cr,B);IS(n,A.transform),pw(he,A.attributes.normal,n),q.push([Y.NORMAL,{data:he.typedBuffer,size:he.elementCount,exclusive:!0}]),X.push([Y.NORMAL,G])}if(L(A.attributes.tangent)){const he=Qb(So,B);IS(n,A.transform),Jxe(he,A.attributes.tangent,n),q.push([Y.TANGENT,{data:he.typedBuffer,size:he.elementCount,exclusive:!0}]),X.push([Y.TANGENT,G])}if(L(A.attributes.texCoord0)){const he=Qb(vd,B);Kxe(he,A.attributes.texCoord0),q.push([Y.UV0,{data:he.typedBuffer,size:he.elementCount,exclusive:!0}]),X.push([Y.UV0,G])}if(L(A.attributes.color)){const he=Qb(lc,B);if(A.attributes.color.elementCount===4)A.attributes.color instanceof So?IH(he,A.attributes.color,255):A.attributes.color instanceof lc?Qxe(he,A.attributes.color):A.attributes.color instanceof Pv&&IH(he,A.attributes.color,1/256);else{e3e(he,255,255,255,255);const fe=new Ov(he.buffer,0,4);A.attributes.color instanceof Cr?bH(fe,A.attributes.color,255):A.attributes.color instanceof Ov?SZ(fe,A.attributes.color):A.attributes.color instanceof ow&&bH(fe,A.attributes.color,1/256)}q.push([Y.COLOR,{data:he.typedBuffer,size:he.elementCount,exclusive:!0}]),X.push([Y.COLOR,G])}const oe=new ws(q,X);x.stageResources.geometries.push(oe),x.stageResources.materials.push(l.get(M)),$&&(L(P.textureColor)&&x.stageResources.textures.push(p.get(P.textureColor)),L(P.textureNormal)&&x.stageResources.textures.push(p.get(P.textureNormal)),L(P.textureOcclusion)&&x.stageResources.textures.push(p.get(P.textureOcclusion)),L(P.textureEmissive)&&x.stageResources.textures.push(p.get(P.textureEmissive)),L(P.textureMetallicRoughness)&&x.stageResources.textures.push(p.get(P.textureMetallicRoughness))),x.numberOfVertices+=B;const de=oe.boundingInfo;L(de)&&(u0(x.boundingBox,de.getBBMin()),u0(x.boundingBox,de.getBBMax()))})}),a}function Lct(e){switch(e){case"BLEND":return Pr.Blend;case"MASK":return Pr.Mask;case"OPAQUE":case null:case void 0:return Pr.Opaque}}function Nct(e,t){switch(t){case mi.TRIANGLES:return Sct(e);case mi.TRIANGLE_STRIP:return Ect(e);case mi.TRIANGLE_FAN:return Act(e)}}function Fct(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(J(n))return;const a=s.attributes.position,l=a.count,p=Q(),y=Q(),b=Q(),x=Qb(lc,l),A=Qb(Cr,l),M=Ms(lt(),s.transform);for(let P=0;P<l;P++){a.getVec(P,y),n.getVec(P,p),Ct(y,y,s.transform),We(b,y,t.center),s6(b,b,t.radius);const $=b[2],k=yt(b),z=Math.min(.45+.55*k*k,1);s6(b,b,t.radius),Ct(b,b,M),ot(b,b),i+1!==e.model.lods.length&&e.model.lods.length>1&&Wn(b,b,p,$>-1?.2:Math.min(-4*$-3.8,1)),A.setVec(P,b),x.set(P,0,255*z),x.set(P,1,255*z),x.set(P,2,255*z),x.set(P,3,255)}s.attributes.normal=A,s.attributes.color=x}}}var qSt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:a3e,gltfToEngineResources:g$,parseUrl:l3e}),cs;function kct(e){let t=on().mat4f64(Y.LOCALTRANSFORM).mat4f64(Y.GLOBALTRANSFORM).vec4f64(Y.BOUNDINGSPHERE).vec3f64(Y.MODELORIGIN).mat3f(Y.MODEL).mat3f(Y.MODELNORMAL).vec2f(Y.MODELSCALEFACTORS);return e.indexOf("color")>=0&&(t=t.vec4f(Y.COLOR)),e.indexOf("featureAttribute")>=0&&(t=t.vec4f(Y.FEATUREATTRIBUTE)),t=t.u8(Y.STATE).u8(Y.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(cs||(cs={}));class Uct{constructor(t){this.localTransform=t.getField(Y.LOCALTRANSFORM,Rv),this.globalTransform=t.getField(Y.GLOBALTRANSFORM,Rv),this.modelOrigin=t.getField(Y.MODELORIGIN,gn),this.model=t.getField(Y.MODEL,Bp),this.modelNormal=t.getField(Y.MODELNORMAL,Bp),this.modelScaleFactors=t.getField(Y.MODELSCALEFACTORS,vd),this.boundingSphere=t.getField(Y.BOUNDINGSPHERE,rw),this.color=t.getField(Y.COLOR,So),this.featureAttribute=t.getField(Y.FEATUREATTRIBUTE,So),this.state=t.getField(Y.STATE,Og),this.lodLevel=t.getField(Y.LODLEVEL,Og)}}class zct extends ps{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=kct(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,cs.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;Kt(t>=0&&t<this._capacity&&i.get(t)&cs.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,cs.ACTIVE)?this._setStateFlags(t,cs.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;Kt(t>=0&&t<this._capacity&&i.get(t)&cs.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=b1,s=Id;i.localTransform.getMat(t,Lae),i.globalTransform.getMat(t,pU);const n=As(pU,pU,Lae);ze(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),md(s,n),i.model.setMat(t,s);const a=P9e(b1,n);a.sort(),i.modelScaleFactors.set(t,0,a[1]),i.modelScaleFactors.set(t,1,a[2]),iw(s,s),gd(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,cs.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,Id),r.modelOrigin.getVec(t,b1),i[0]=Id[0],i[1]=Id[1],i[2]=Id[2],i[3]=0,i[4]=Id[3],i[5]=Id[4],i[6]=Id[5],i[7]=0,i[8]=Id[6],i[9]=Id[7],i[10]=Id[8],i[11]=0,i[12]=b1[0],i[13]=b1[1],i[14]=b1[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(b1,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(b1,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,cs.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,cs.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,cs.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,cs.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(Bct,Math.floor(this._capacity*Vct)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new Uct(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&cs.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const Bct=1024,Vct=2,b1=Q(),Id=zs(),Lae=lt(),pU=lt();class Gct extends txe{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=qo(),this._tmpMat4=lt(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Ct(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*z2(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class jct{constructor(t,i){this.thresholdScale=1,this._camera=new br,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let a=-1;for(let l=0;l<n.length;++l)s>=n[l]*this.thresholdScale&&(a=l);return a}}class Hct{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const a=n.createBufferWriter(),l=a.vertexBufferLayout,p=a.elementCount(s),y=a.allocate(p);a.write({},s,y,0),this.geometry=s,this.material=n,this.glMaterials=new Hwe(n,this._materialRepository),this.vertexBufferLayout=l,this.vbo=Fi.createVertex(r,tr.STATIC_DRAW,y.buffer),this.vao=new In(r,mr,{geometry:ch(l)},{geometry:this.vbo}),this.vertexCount=p}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,a){const l=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(p,y,b,x,A)=>{if(p>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,p))return;const M={layerUid:a.layerUid,graphicUid:a.graphicUid(n),geometryId:l,triangleNr:b};if((t.results.min.drapedLayerOrder==null||A>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||p<t.results.min.dist)&&t.results.min.set(Ts.LOD,M,p,y,t.transform.transform,A),t.options.store!==ma.MIN&&(t.results.max.drapedLayerOrder==null||A>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||p>t.results.max.dist)&&t.results.max.set(Ts.LOD,M,p,y,t.transform.transform,A),t.options.store===ma.ALL){const P=jN(t.results.min.ray);P.set(Ts.LOD,M,p,y,t.transform.transform,A),t.results.all.push(P)}}})}}class EZ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(a=>t.schedule(()=>new Hct(t,a),r))),n=s.map(a=>a.status==="fulfilled"?a.value:null).filter(a=>a);if(zn(r)||n.length!==s.length){n.forEach(a=>a.destroy()),Gi(r);for(const a of s)if(a.status==="rejected")throw a.reason}return new EZ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,a))}get boundingBox(){if(J(this._boundingBox)){const t=jr();this.components.forEach(i=>{L(i.boundingInfo)&&(u0(t,i.boundingInfo.bbMin),u0(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(J(this._boundingSphere)){const t=this.boundingBox,i=Q();yp(t,i),this._boundingSphere={center:i,radius:.5*_6e(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class qct{constructor(t,i,r){this._elementSize=i,this._buffer=Fi.createVertex(t,tr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class Wct{constructor(t){this.modelOriginHi=t.getField(Y.MODELORIGINHI,Cr),this.modelOriginLo=t.getField(Y.MODELORIGINLO,Cr),this.model=t.getField(Y.MODEL,Bp),this.modelNormal=t.getField(Y.MODELNORMAL,Bp),this.color=t.getField(Y.INSTANCECOLOR,So),this.featureAttribute=t.getField(Y.INSTANCEFEATUREATTRIBUTE,So)}}class Nae{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Kt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Kt(this._updating,"not updating"),this.size<Yct*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Kt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),Kt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){Kt(this._updating,"not updating"),Kt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(Fae,Math.floor(this._capacity*Xct));this._resize(t)}_shrink(){const t=Math.max(Fae,Math.floor(this._capacity*Jct));this._resize(t)}_resize(t){if(Kt(this._updating,"not updating"),t===this._capacity)return;const i=new qct(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);Kt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new Wct(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const Fae=1024,Xct=2,Yct=.3,Jct=.5;let Zct=function(e){const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new jct(t,i)};class Kct{constructor(t,i,r,s){this.type=Ts.LOD,this.isGround=!1,this._inverseViewport=St(),this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new br,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[tt.OPAQUE_PLUGIN,tt.TRANSPARENT_PLUGIN],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=Ixe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=ch(this._instanceBufferLayout,1),this._instanceData=new zct(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],a=this._highlightRenderInstanceData[s],l=n.size+a.size,p=r.triangleCount;i.push({renderedInstances:l,renderedTriangles:l*p,trianglesPerInstance:p})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(a=>(this._defaultRenderInstanceData.push(new Nae(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Nae(r,this._instanceBufferLayout)),EZ.create(t,a,i)))),n=s.map(a=>a.status==="fulfilled"?a.value:null).filter(a=>a);if(zn(i)||n.length!==s.length){n.forEach(a=>a.destroy()),Gi(i);for(const a of s)if(a.status==="rejected")throw a.reason}this._levels=n,this._levelSelector=Zct(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(tt.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t,i){if(ur.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const s=i.equals(this._lastCamera);this._lastCamera.copyFrom(i),s||this._requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(i,r),this.needsUpdates&&this._context.requestRender()}render(t){var i,r,s,n;const a=t.slot===tt.OPAQUE_PLUGIN?tt.OPAQUE_MATERIAL:t.slot===tt.TRANSPARENT_PLUGIN?tt.TRANSPARENT_MATERIAL:null;if(!a||!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;const l=t.camera;this._inverseViewport[0]=1/l.fullViewport[2],this._inverseViewport[1]=1/l.fullViewport[3];const p={slot:a,origin:[0,0,0],camera:l,inverseViewport:this._inverseViewport,shadowMap:t.shadowMap,shadowMappingEnabled:t.shadowMap.enabled,ssaoHelper:t.ssaoHelper,ssaoEnabled:t.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:t.sliceHelper&&t.sliceHelper.plane,hudVisibilityTexture:(i=(r=t.offscreenRenderingHelper)==null?void 0:r.hudVisibilityTexture)!=null?i:null,highlightDepthTexture:(s=(n=t.offscreenRenderingHelper)==null?void 0:n.depthTexture)!=null?s:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:Rn,ssrEnabled:!1,lighting:t.scenelightingData,transparencyPassType:t.transparencyPassType,terrainLinearDepthTexture:t.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:t.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:t.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:t.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:t.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:t.hasFillLights};t.rctx.bindVAO();const y=t.pass!==bt.MATERIAL_HIGHLIGHT&&t.pass!==bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,b=t.pass!==bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;y&&this._renderComponents(t,a,p,this._defaultRenderInstanceData),b&&this._renderComponents(t,a,p,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=Q();We(n,s,r);const a=l=>{this._instanceData.getCombinedModelTransform(l,zae),t.transform.set(zae),Ct(Bae,r,t.transform.inverse),Ct(Vae,s,t.transform.inverse);const p=this._instanceData.getState(l),y=this._instanceData.getLodLevel(l);Kt(p&cs.ACTIVE,"invalid instance state"),Kt(y>=0&&y<this._levels.length,"invaid lod level"),this._levels[y].intersect(t,i,Bae,Vae,l,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(a):this.octree.forEachAlongRay(r,n,a)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new Gct(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&cs.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,qh.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,qh.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,cf),We(cf,cf,i);const a=rt(cf,r)-cf[3];this._instanceData.view.boundingSphere.getVec(n,cf),We(cf,cf,i);const l=rt(cf,r)+cf[3];return{near:Math.max(t.near,a),far:Math.min(t.far,l)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(b=>{b.beginUpdate()}),this._highlightRenderInstanceData.forEach(b=>{b.beginUpdate()});const n=this._instanceData,a=this._instanceData.view,l=n.size,p=n.capacity;let y=this._instanceIndex;i=Math.min(l,i);for(let b=0;b<i;++b){y===0&&this._startUpdateCycle();const x=a.state.get(y);let A=0;if(!(x&cs.ALLOCATED)){y=(y+1)%p,i++;continue}const M=a.lodLevel.get(y);if(x&cs.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[M].freeTail(),x&cs.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[M].freeTail(),x&cs.REMOVE)n.freeInstance(y);else if(x&cs.VISIBLE){let P=0;r&&(a.modelOrigin.getVec(y,Uae),P=s.selectLevel(Uae,n.getCombinedMedianScaleFactor(y))),A=x&~(cs.ACTIVE|cs.TRANSFORM_CHANGED),P>=0&&(x&cs.HIGHLIGHT?(kae(this._highlightRenderInstanceData[P],a,y),A|=cs.HIGHLIGHT_ACTIVE):(kae(this._defaultRenderInstanceData[P],a,y),A|=cs.DEFAULT_ACTIVE)),a.state.set(y,A),a.lodLevel.set(y,P)}else A=x&~(cs.ACTIVE|cs.TRANSFORM_CHANGED),a.state.set(y,A);if(this._octree){const P=!!(x&cs.ACTIVE),$=!!(A&cs.ACTIVE);!P&&$?this._octree.addInstance(y):P&&!$?this._octree.removeInstance(y):P&&$&&x&cs.TRANSFORM_CHANGED&&(this._octree.removeInstance(y),this._octree.addInstance(y))}y=(y+1)%p}this._instanceIndex=y,this._defaultRenderInstanceData.forEach(b=>{b.endUpdate()}),this._highlightRenderInstanceData.forEach(b=>{b.endUpdate()})}_renderComponents(t,i,r,s){this.levels.forEach((n,a)=>{n.components.forEach(l=>{this._renderComponent(t,i,r,s[a],l,a)})})}_renderComponent(t,i,r,s,n,a){if(s.size===0||!n.material.requiresSlot(i))return;const{rctx:l,pass:p}=t,y=n.glMaterials.load(l,p);if(J(y))return;const b=y.beginSlot(r),x=l.useTechnique(b,i);y.bind(r,b),l.bindVAO(n.vao),b.ensureAttributeLocations(n.vao),t.isHighlightPass&&D0(x,r),b.bindDraw(r),ur.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===bt.MATERIAL&&(x.setUniform4fv("externalColor",Gae[Math.min(a,Gae.length-1)]),x.setUniform1i("colorMixMode",vH.replace));const A=l.capabilities.instancing,M=s.capacity,P=s.headIndex,$=s.tailIndex,k=s.firstIndex,z=this._glInstanceBufferLayout,G=(B,W)=>{ZY(l,mr,s.buffer,z,B),A.drawArraysInstanced(b.primitiveType,0,n.vertexCount,W-B),KY(l,mr,s.buffer,z)};n.material.parameters.transparent&&k!=null?P>$?(Kt(k>=$&&k<=P,"invalid firstIndex"),G(k,P),G($,k)):P<$&&(k<=P?(Kt(k>=0&&k<=P,"invalid firstIndex"),G(k,P),G($,M),G(0,k)):(Kt(k>=$&&k<=M,"invalid firstIndex"),G(k,M),G(0,P),G($,k))):P>$?G($,P):P<$&&(G(0,P),G($,M)),l.bindVAO(null)}}function kae(e,t,i){const r=e.allocateHead();Qct(t,i,e.view,r)}function Qct(e,t,i,r){QZe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const Uae=Q(),cf=nr(),zae=lt(),Bae=Q(),Vae=Q(),Gae=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];class eht extends N0{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=L(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&s8(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:w0e;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return L(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Ss(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=Ss(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?Fr.None:Fr.Back,t}async _createResourcesForPrimitive(t,i){if(!Frt(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=On(C6e(t)),n=zl(e5(s)),a=zl(VF(n,r)),l=yt(a),p=!1,y=!1,b={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:Jf,diffuse:Jf,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},x=b.usePBR;this._setMaterialTransparencyParams(b);const A=this.symbol;if(A.type==="point-3d"&&A.verticalOffset){const{screenLength:z,minWorldLength:G,maxWorldLength:B}=A.verticalOffset;b.verticalOffset={screenLength:La(z),minWorldLength:G||0,maxWorldLength:B!=null?B:1/0},b.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)b.externalColor=Xf;else{const z=L(r.material)&&r.material.color,G=L(z)?Ft.toUnitRGBA(z):Xf;b.externalColor=G}this._fastUpdates=lO(this._context.renderer,this._fastVisualVariableConvertOptions(s,a,n,F1)),this._fastUpdates.enabled?(Object.assign(b,this._fastUpdates.materialParameters),b.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(b.instanced.push("color"),this._optionalFields.push("color"));const M=new gw(b),P=Rwe(t,M);if(!P)throw new Error(`Unknown object symbol primitive: ${t}`);const $=pP(P).map(z=>({opacity:1,transparent:z.parameters.transparent})),k=await this._createStageResources(P,x);return{lodResources:P,lodRenderer:await this._createLodRenderer(P,i),stageResources:k,symbolSize:a,extentPadding:l,isEsriSymbolResource:p,isWosr:y,originalMaterialParameters:$,physicalBasedRenderingEnabled:x,resourceBoundingBox:s,resourceSize:n,dispose:F1,pivotOffset:F1}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=lO(this._context.renderer,this._fastVisualVariableConvertOptions(F1,F1,F1,F1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:fe,minWorldLength:me,maxWorldLength:ge}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:La(fe),minWorldLength:me||0,maxWorldLength:ge!=null?ge:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const a=s.usePBR,l=await a3e(t,s),p=l.isEsriSymbolResource,y=l.isWosr,b=l.remove,x=zlt(l.lods);Vlt(x),x.levels.sort((fe,me)=>fe.minScreenSpaceRadius-me.minScreenSpaceRadius),x.levels[0].minScreenSpaceRadius=Math.min(2,x.levels[0].minScreenSpaceRadius);const A=this._context,M=this.symbolLayer.material,P=this._getExternalColorParameters(M),$=Ss(this.symbolLayer,"material","color"),k=this._getCombinedOpacity($,{hasIntrinsicColor:!0}),z=this.needsDrivenTransparentPass,G=pP(x),B=pP(x).map(fe=>({opacity:fe.parameters.opacity||1,transparent:fe.parameters.transparent}));G.forEach(fe=>{const me=fe.parameters;fe.setParameters(P);const ge=me.opacity*k,Ce=ge<1||z||me.transparent;fe.setParameters({opacity:ge,transparent:Ce}),A.screenSizePerspectiveEnabled&&fe.setParameters({screenSizePerspective:A.sharedResources.screenSizePerspectiveSettings})});const W=l.referenceBoundingBox,q=zl(e5(W)),X=zl(x.levels[0].pivotOffset),oe=zl(VF(q,this.symbolLayer)),de=yt(oe);cO(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(W,oe,q,X))&&G.forEach(fe=>fe.setParameters(this._fastUpdates.materialParameters));const he=await this._createStageResources(x,a);return{lodResources:x,lodRenderer:await this._createLodRenderer(x,i),stageResources:he,symbolSize:oe,extentPadding:de,isEsriSymbolResource:p,isWosr:y,originalMaterialParameters:B,physicalBasedRenderingEnabled:a,resourceBoundingBox:W,resourceSize:q,dispose:b,pivotOffset:X}}async _createStageResources(t,i){const r=this._context.stage,s=pP(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s);const n=Wrt(t);r.addMany(n),await r.load(n);const a=Xrt(t);return r.addMany(a),{materials:s,textures:n,geometries:a}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates.enabled?{applyTransform:(l,p,y)=>{l.getFeatureAttribute(p,IP),nn(y,CH(this._fastUpdates.materialParameters,IP,y))},scaleFactor:(l,p,y)=>(p.getFeatureAttribute(y,IP),hat(l,this._fastUpdates.materialParameters,IP))}:null,a=new Kct(t,this._optionalFields,s,n);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,await r.addRenderPlugin(a.slots,a,i),a}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=Xf:L(t)&&L(t.color)?i.externalColor=Ft.toUnitRGBA(t.color):(i.externalColor=Xf,i.colorMixMode="ignore"),i}destroy(){if(super.destroy(),L(this._resources)){const t=this._context.stage;t.removeRenderPlugin(this._resources.lodRenderer);const i=this._resources.stageResources;t.removeMany(i.materials),t.removeMany(i.textures),t.removeMany(i.geometries),L(this._resources.dispose)&&this._resources.dispose(),this._resources=null}}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=sO(i.geometry);if(J(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new cu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(J(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const a=r[n],l=Ss(this.symbolLayer,"material","color"),p=s[n],y=this._getCombinedOpacity(l,{hasIntrinsicColor:i})*p.opacity,b=y<1||t||p.transparent;a.setParameters({opacity:y,transparent:b}),this.isPrimitive&&a.setParameters({cullFace:b?Fr.None:Fr.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Fv)}slicePlaneEnabledChanged(){if(J(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(J(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(J(this._resources))return Hn.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:a,resourceSize:l,pivotOffset:p}=this._resources;for(const y in t.diff){if(y!=="visualVariables"||!cO(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,a,l,p)))return Hn.Recreate_Symbol;for(const b of r)b.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Hn.Fast_Update}computeComplexity(){return J(this._resources)?super.computeComplexity():{primitivesPerFeature:oZ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(Y.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Iwe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return L(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||J(this._resources))return null;const a=this.getFastUpdateAttrValues(t),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?kM(r.color,r.opacity):null,p=this._context.clippingExtent;if(To(i,_x,this._context.elevationProvider.spatialReference),L(p)&&!eX(p,_x))return null;const y=this._requiresTerrainElevation(s),b=this._computeGlobalTransform(i,s,fU,$P),x=this._computeLocalTransform(this._resources,this.symbolLayer,r,jae),A=this._resources.lodRenderer.instanceData,M=A.addInstance();this._instanceIndexToGraphicUid.set(M,n),A.setLocalTransform(M,x,!1),A.setGlobalTransform(M,b),a&&A.setFeatureAttribute(M,a),l&&A.setColor(M,l);const P=new Flt(this,M,Rrt,s);return y&&(P.alignedSampledElevation=$P.sampledElevation),P.needsElevationUpdates=Fv(s.mode),rO(P,i,this._context.elevationProvider),P}_computeGlobalTransform(t,i,r,s){return Ig(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),_x[0]=t.x,_x[1]=t.y,_x[2]=s.z,kp(t.spatialReference,_x,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return p0(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Aoe(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||ZL(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(J(this._resources))return!0;const r=i&&sO(i);if(J(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,fU,$P),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=$P.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,fU,!0),rO(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||J(this._resources))return;const r=(P,$,k)=>Wt(P!=null&&P.type==="complete"?P.newValue:$,k),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),a=r(i.roll,this.symbolLayer.roll,0),l=r(i.width,this.symbolLayer.width,void 0),p=r(i.height,this.symbolLayer.height,void 0),y=r(i.depth,this.symbolLayer.depth,void 0),b=r(i.anchor,this.symbolLayer.anchor,void 0),x=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const A={heading:s,tilt:n,roll:a,anchor:b,anchorPosition:x},M=this._resources;this.loadStatus===Uh.LOADED&&t.symbolLayerStatePatches.push(()=>{M.symbolSize=zl(VF(M.resourceSize,{width:l,height:p,depth:y,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((P,$)=>{const k=this._computeLocalTransform(M,A,$,jae),z=P.instanceIndex;M.lodRenderer.instanceData.setLocalTransform(z,k,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=L(s)?Ft.toUnitRGBA(s):Xf;delete r.color;const a=this._resources;J(a)||t.graphics3DGraphicPatches.push(l=>{let p;this._hasPerInstanceColor()?(a.lodRenderer.instanceData.setColor(l.instanceIndex,n),p=this._setMaterialTransparencyParams({},s)):p=this._setMaterialTransparencyParams({externalColor:n},s);for(const y of a.stageResources.materials)y.setParameters(p)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return vrt(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=Q();switch(r.anchor){case"center":ke(s,yp(t)),Na(s,s);break;case"top":{const n=yp(t);ze(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=yp(t);ze(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=yp(t),a=e5(t),l=r.anchorPosition,p=l?$t(l.x,l.y,l.z):Jc;Xq(s,a,p),Xe(s,s,n),Na(s,s);break}default:L(i)?Na(s,i):ke(s,Jc)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&yl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=L(t)?zl(e5(t)):Jf,a=L(t)?this._computeAnchor(t,s,this.symbolLayer):Jc,l=this._context.renderCoordsHelper.unitInMeters,p=Aoe(L(i)?i:void 0,i,r,l),y=$t(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:L(i)?i:Jf,unitInMeters:l,transformation:{anchor:a,scale:p,rotation:y}}}}const _x=Q(),jae=lt(),fU=lt(),IP=nr(),$P=new m4;function tht(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function iht(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function AZ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function rht(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function sht(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let a=i*n-s*r;return a?(a=1/a,e[0]=n*a,e[1]=-r*a,e[2]=-s*a,e[3]=i*a,e):null}function nht(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function oht(e){return e[0]*e[3]-e[2]*e[1]}function c3e(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=i[0],p=i[1],y=i[2],b=i[3];return e[0]=r*l+n*p,e[1]=s*l+a*p,e[2]=r*y+n*b,e[3]=s*y+a*b,e}function aht(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=Math.sin(i),p=Math.cos(i);return e[0]=r*p+n*l,e[1]=s*p+a*l,e[2]=r*-l+n*p,e[3]=s*-l+a*p,e}function lht(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=i[0],p=i[1];return e[0]=r*l,e[1]=s*l,e[2]=n*p,e[3]=a*p,e}function cht(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function hht(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function uht(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function dht(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function pht(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function fht(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function h3e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function mht(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ght(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],a=t[0],l=t[1],p=t[2],y=t[3];return Math.abs(i-a)<=pi*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=pi*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-p)<=pi*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(n-y)<=pi*Math.max(1,Math.abs(n),Math.abs(y))}function yht(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function vht(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const _ht=c3e,bht=h3e;Object.freeze({__proto__:null,copy:tht,identity:iht,set:AZ,transpose:rht,invert:sht,adjoint:nht,determinant:oht,multiply:c3e,rotate:aht,scale:lht,fromRotation:cht,fromScaling:hht,str:uht,frob:dht,LDU:pht,add:fht,subtract:h3e,exactEquals:mht,equals:ght,multiplyScalar:yht,multiplyScalarAndAdd:vht,mul:_ht,sub:bht});class wht extends ws{constructor(t,i,r,s,n,a){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=a}}function u3e(e){return"upVectorAlignment"in e}function d3e(){return[1,0,0,1]}function xht(e){return[e[0],e[1],e[2],e[3]]}function Tht(e,t,i,r){return[e,t,i,r]}function Sht(e,t){return new Float64Array(e,t,4)}Object.freeze({__proto__:null,create:d3e,clone:xht,fromValues:Tht,createView:Sht});function $H(){return{up:Q(),right:Q()}}function Eht(e,t,i){Ct(e.up,t.up,i),Ct(e.right,t.right,i)}function Aht(e,t,i){ds(e,rt(i,t.right),rt(i,t.up))}class Cht{constructor(){this.pos=Q(),this.posES=Q(),this.posGS=Q(),this.vRight=Q(),this.vLeft=Q(),this.frame=$H(),this.rotationFrame=$H(),this.rotationRight=St(),this.rotationAngle=0,this.miterStretch=d3e()}setFrameFromUpVector(t){ke(this.frame.up,t),Xe(Iu,this.vLeft,this.vRight),ot(Iu,Iu),Ue(tp,this.frame.up,rt(Iu,this.frame.up)),We(LP,Iu,tp),ot(LP,LP),si(this.frame.right,LP,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ke(this.rotationFrame.up,this.frame.up),ke(this.rotationFrame.right,this.frame.right),ds(this.rotationRight,1,0),Ue(tp,this.frame.up,rt(this.frame.up,this.vLeft)),We(tp,this.vLeft,tp),Na(tp,tp),ot(tp,tp),Ue(Iu,this.frame.up,rt(this.frame.up,this.vRight)),We(Iu,this.vRight,Iu),ot(Iu,Iu),si(DH,this.rotationFrame.up,this.vLeft);const t=Math.sign(rt(DH,this.vRight));if(this.rotationAngle=t*(Math.PI-Xn(rt(tp,Iu))),Math.abs(this.rotationAngle)>0){const r=Pz(Math.cos(.5*this.rotationAngle));AZ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class uO{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(a2(t)),this.vertexNormals.push(a2(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:a2(t),normal:i?a2(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new uO,s={v0:0,v1:0};r.addPole(yr(0,0));for(let l=0;l<t;++l){const p=2*l*Math.PI/t,y=Math.cos(p),b=Math.sin(p),x=yr(y*.5,b*.5),A=yr(y,b);r.addVertex(x,A),r.addUV(l/t)}r.addUV(1);for(let l=0;l<t-1;++l){const p={v0:l,v1:l+1},y=p;r.addSegment(p,y,s)}const n={v0:t-1,v1:0},a={v0:t-1,v1:t};return r.addSegment(n,a,s),r}static rect(){const r=new uO,s=yr(.5*-1,.5*-1),n=yr(.5*1,.5*-1),a=yr(.5*1,.5*1),l=yr(.5*-1,.5*1),p=yr(0,-1),y=yr(1,0),b=yr(0,1),x=yr(-1,0);r.addUV(0),r.addUV(1),r.addPole(yr(0,.5*1),b),r.addPole(yr(0,.5*1)),r.addPole(yr(0,.5*-1)),r.addPole(yr(0,.5*-1),p);const A={v0:0,v1:1};return r.addVertex(s,p),r.addVertex(n,p),r.addSegment({v0:0,v1:1},A,{v0:3,v1:3}),r.addVertex(n,y),r.addVertex(a,y),r.addSegment({v0:2,v1:3},A,{v0:2,v1:1}),r.addVertex(a,b),r.addVertex(l,b),r.addSegment({v0:4,v1:5},A,{v0:0,v1:0}),r.addVertex(l,x),r.addVertex(s,x),r.addSegment({v0:6,v1:7},A,{v0:1,v1:2}),r}}class Mht{constructor(t){this.vertices=[],this.offset=Q(),this.xform=lt(),this.vertices=t;const i=Math.floor((t.length-1)/2);ke(this.offset,this.vertices[i].pos);for(const r of this.vertices)We(r.pos,r.pos,this.offset);yl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,ze(i.vLeft,0,0,0),i.vLeftLength=0,We(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=yt(i.vRight),ot(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,ke(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(We(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=yt(i.vRight),ot(i.vRight,i.vRight)):(ke(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function Rht(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=Q(),a=Q(),l=Q(),p=Q(),y=Q(),b=Q(),x=er();let A=e.vertices[0];ke(a,t),ze(n,0,1,0),$c.makeOrthoBasisDirUpFallback(A.vRight,a,n,n,l,a,s),ke(A.frame.up,a),ke(A.frame.right,l),i=A;for(let M=1;M<r;++M){A=e.vertices[M],Xe(y,A.vLeft,A.vRight);let P=yt(y);P>0?(P=1/Math.sqrt(P),y[0]=y[0]*P,y[1]=y[1]*P,y[2]=y[2]*P):(y[0]=A.vRight[0],y[1]=A.vRight[1],y[2]=A.vRight[2]),Xe(b,i.pos,i.frame.up),yS(A.pos,y,x),Ow(x,iu(b,A.vLeft),p)?(We(p,p,A.pos),ot(a,p),si(l,y,a),ot(l,l)):$c.makeOrthoBasisDirUpFallback(y,i.frame.up,i.frame.right,n,l,a,s),ke(A.frame.up,a),ke(A.frame.right,l),i=A}}class Oht{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class mU{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=Fht;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){ah(Wae,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),Eht(s,t.frame,Wae);for(let a=0;a<i.vertices.length;++a)bs(i.vertices[a],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[a],i.vertexNormals[a],!1):(Zj(y2,i.vertices[a],t.miterStretch),r(t.index,t.frame,y2,i.vertexNormals[a],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let a=0;a<i.vertices.length;++a){const l=bs(i.vertices[a],t.rotationRight)*t.rotationAngle>=0;Zj(y2,i.vertices[a],t.miterStretch),r(t.index,t.frame,y2,i.vertexNormals[a],!l)}}}const Pht={generateUV:!1};class CZ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class Hae extends CZ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class DP extends CZ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=MZ;ds(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],a=this.profile.vertexIndices[2*s+1],l=this.vertexBufferStart+n,p=this.vertexBufferStart+a;this.flip?i(p,l,r):i(r,l,p)}}}class qae extends CZ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=y2,a=MZ;ds(a,0,0);for(let l=0;l<this.profile.poles.length;++l){const p=this.profile.poles[l];p.normal?i(t.index,r,p.position,p.normal,s,0):i(t.index,r,p.position,a,s,this.sign)}if(this.breakNormals)for(let l=0;l<this.profile.vertices.length;++l)i(t.index,r,this.profile.vertices[l],this.profile.vertexNormals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const p=(1-(l+1)/this.numSegments)*Math.PI*.5,y=Math.sin(p),b=Math.cos(p);for(let x=0;x<this.profile.vertices.length;++x){const A=this.profile.poles[this.profile.poleIndices[x]];Fs(n,this.profile.vertices[x],A.position),Wl(n,n,y),A.normal?(kh(n,n,A.position),i(t.index,r,n,A.normal,s*b,0)):(OR(a,n),Wl(a,a,y),kh(n,n,A.position),i(t.index,r,n,a,s*b,this.sign*b))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const a=this.profile.vertexIndices[2*n+0],l=this.profile.vertexIndices[2*n+1],p=this.vertexBufferStart+this.profile.poleIndices[a],y=this.vertexBufferStart+this.profile.poleIndices[l];let b=r+a,x=r+l;for(let A=0;A<this.numSegments-1;++A){const M=s+A*this.profile.vertices.length+a,P=s+A*this.profile.vertices.length+l;this.flip?(i(M,x,b),i(x,M,P)):(i(b,x,M),i(P,M,x)),b=M,x=P}this.flip?(i(p,x,b),p!==y&&i(p,y,x)):(i(b,x,p),p!==y&&i(x,y,p))}}}class Iht{constructor(t,i,r,s,n,a=Pht){this.options=a,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const l=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*l+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const p=this.startCap.getNumVertices();this.numVerticesTotal+=p,this.numNormalsTotal+=p,this.endCap.vertexBufferStart=this.numVerticesTotal;const y=this.endCap.getNumVertices();this.numVerticesTotal+=y,this.numNormalsTotal+=y,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const a=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,a,l)=>this.emitVertex(r,s,n,a,l),i=(r,s,n,a,l,p)=>this.emitCapVertex(r,s,n,a,l,p);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(a,l,p)=>this.emitTriangle(a,l,p);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let a=0;a<r;++a){const l=this.profile.vertexIndices[2*a],p=this.profile.vertexIndices[2*a+1];for(let y=0;y<s;++y){const b=y*i+l,x=(y+1)*i+p,A=y*i+p;t(b,(y+1)*i+l,x),t(b,x,A)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class p3e{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class f3e extends p3e{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Dht;ze(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const a=4*i,l=tp,p=y2,y=Iu,b=DH,x=Nht;let A=0,M=0;if(ze(b,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),ze(x,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),ds(p,this.builder.profileVertexAndNormalData[a]*t[0],this.builder.profileVertexAndNormalData[a+1]*t[1]),s)si(y,x,b),A=this.builder.profileRightAxisData[a+3]*t[0],M=this.builder.profileUpAxisData[a+3];else{const $=MZ,k=Lht;ds($,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);const z=$N($);OR($,$);const G=bs(p,$);if(Math.abs(G)>z){ds(k,-$[1],$[0]);const B=bs(p,k);Wl($,$,z*Math.sign(G)),Wl(k,k,B),kh(p,$,k)}ze(y,0,0,0)}ze(l,b[0]*p[0]+x[0]*p[1],b[1]*p[0]+x[1]*p[1],b[2]*p[0]+x[2]*p[1]),this.vertexAttributePosition[3*i+0]=n[0]+l[0]+y[0]*A,this.vertexAttributePosition[3*i+1]=n[1]+l[1]+y[1]*A,this.vertexAttributePosition[3*i+2]=n[2]+l[2]+y[2]*A;const P=y2;ds(P,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*i+0]=b[0]*P[0]+x[0]*P[1]+y[0]*M,this.vertexAttributeNormal[3*i+1]=b[1]*P[0]+x[1]*P[1]+y[1]*M,this.vertexAttributeNormal[3*i+2]=b[2]*P[0]+x[2]*P[1]+y[2]*M}}createGeometryData(){const t=[[Y.POSITION,this.builder.vertexIndices],[Y.NORMAL,this.builder.normalIndices]],i=[[Y.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[Y.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([Y.COLOR,new Uint32Array(r)]),i.push([Y.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},a=s.length/3;l4(t,i,0,a,s,n,void 0,void 0,r)}}class $ht extends p3e{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new f3e(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const a=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=a?1:0}}createGeometryData(){return{vertexAttributes:[[Y.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[Y.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[Y.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[Y.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[Y.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[Y.POSITION,this.builder.pathVertexIndices],[Y.PROFILERIGHT,this.builder.vertexIndices],[Y.PROFILEUP,this.builder.vertexIndices],[Y.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[Y.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Dht=Q(),y2=St(),MZ=St(),Lht=St(),tp=Q(),Iu=Q(),DH=Q(),Nht=Q(),LP=Q(),Fht=$H(),Wae=lt();function kht(e,t){e.attributes.add(Y.FEATUREVALUE,"vec4"),e.vertex.code.add(V`bool isCapVertex() {
return featureValue.w == 1.0;
}`),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(V`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):e.vertex.code.add(V`vec2 getSize(){
return size.xy;
}`),t.vvOpacity?(e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(V`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):e.vertex.code.add(V`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(V`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):e.vertex.code.add(V`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(_8),e.attributes.add(Y.PROFILERIGHT,"vec4"),e.attributes.add(Y.PROFILEUP,"vec4"),e.attributes.add(Y.PROFILEVERTEXANDNORMAL,"vec4"),e.vertex.code.add(V`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),e.vertex.code.add(V`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),e.vertex.code.add(V`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),e.vertex.code.add(V`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}function Uht(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function zht(e){const t=new Ir;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(kht,e),e.output!==Te.Color&&e.output!==Te.Alpha||(t.include(da,{linearDepth:!1}),e.receiveShadows&&t.include($g,e),t.include(v4,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(V`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===Te.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),e.output===Te.Alpha&&(t.include(Ws,e),t.fragment.uniforms.add("cameraPosition","vec3"),t.fragment.uniforms.add("localOrigin","vec3"),t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===Te.Color&&(t.include(Ws,e),t.include(mw,e),t.include(w8,e),e.receiveShadows&&t.include($g,e),t.include(bxe,e),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.include(P0),t.fragment.code.add(V`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.viewingMode===vt.Global?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==Te.Depth&&e.output!==Te.Shadow||(t.include(da,{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(V`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Ws,e),t.include(Zv,e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(V`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===Te.Normal&&(t.include(da,{linearDepth:!1}),t.include(rv,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(V`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ws,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(V`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===Te.Highlight&&(t.include(da,{linearDepth:!1}),t.include(rv,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(V`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ws,e),t.include(Yg),t.fragment.code.add(V`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Bht=Object.freeze({__proto__:null,build:zht}),m3e=new Map([[Y.POSITION,0],[Y.PROFILERIGHT,1],[Y.PROFILEUP,2],[Y.PROFILEVERTEXANDNORMAL,3],[Y.FEATUREVALUE,4]]);class P8 extends Xr{initializeProgram(t){const i=P8.shader.get(),r=this.configuration,s=i.build({oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,viewingMode:t.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,pbrMode:fi.Disabled,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:r.receiveSSAO,doubleSidedMode:r.doubleSidedMode,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,m3e)}bindPass(t,i){var r,s;hh(this.program,i.camera.projectionMatrix),this.program.setUniform3fv("size",t.size),i.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i)),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Alpha||this.program.setUniform1f("opacity",t.opacity),this.configuration.output===Te.Color?(i.lighting.setUniforms(this.program,!1,!1),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform3fv("specular",t.specular),this.program.setUniform1f("opacity",t.opacity)):this.configuration.output!==Te.Depth&&this.configuration.output!==Te.Shadow||this.program.setUniform2fv("nearFar",i.camera.nearFar),Uht(this.program,t),(r=i.shadowMap)==null||r.bind(this.program),(s=i.ssaoHelper)==null||s.bind(this.program,i.camera)}bindDraw(t){I0(this.program,t),kw(this.program,this.configuration,t),this.program.rebindTextures(),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Alpha||Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),this.configuration.output===Te.Color&&zst(this.program,t),this.configuration.output===Te.Normal&&Tot(this.program,t.camera.viewInverseTransposeMatrix)}_setPipelineState(t){const i=this.configuration,r=t===Qt.NONE,s=t===Qt.FrontFace,n=a=>!a.slicePlaneEnabled&&!(a.transparent||a.doubleSidedMode===Es.None);return Ti({blending:i.output!==Te.Color&&i.output!==Te.Alpha||!i.transparent?null:r?Qc:Zg(t),culling:n(i)&&E_e,depthTest:{func:Jv(t)},depthWrite:r||s?ac:null,colorWrite:Ii,stencilWrite:i.sceneHasOcludees?b0:null,stencilTest:i.sceneHasOcludees?Kv:null,polygonOffset:r||s?null:i8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}P8.shader=new Ur(Bht,()=>import("./Path.glsl.18bb2e5b.js"));class Ac extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.doubleSidedMode=Es.None,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],Ac.prototype,"output",void 0),_([Oe({count:Es.COUNT})],Ac.prototype,"doubleSidedMode",void 0),_([Oe()],Ac.prototype,"receiveShadows",void 0),_([Oe()],Ac.prototype,"receiveSSAO",void 0),_([Oe()],Ac.prototype,"vvSize",void 0),_([Oe()],Ac.prototype,"vvColor",void 0),_([Oe()],Ac.prototype,"vvOpacity",void 0),_([Oe()],Ac.prototype,"slicePlaneEnabled",void 0),_([Oe()],Ac.prototype,"transparent",void 0),_([Oe()],Ac.prototype,"sceneHasOcludees",void 0),_([Oe({count:Qt.COUNT})],Ac.prototype,"transparencyPassType",void 0),_([Oe()],Ac.prototype,"multipassTerrainEnabled",void 0),_([Oe()],Ac.prototype,"cullAboveGround",void 0);class RZ extends Wp{constructor(t){super(t,Ght),this.supportsEdges=!0,this._vertexAttributeLocations=m3e,this.techniqueConfig=new Ac,this.vertexBufferLayout=RZ.getVertexBufferLayout(this.parameters)}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,t!==Te.Color&&t!==Te.Alpha||(this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Es.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Es.WindingOrder:Es.None,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows,this.techniqueConfig.receiveSSAO=!!i.ssaoEnabled&&this.parameters.receiveSSAO),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}isVisibleInPass(t){return t!==bt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,a,l){const p=t;if(!u3e(p))return;const y=p.path,b=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const z=this.parameters.vvSizeOffset,G=this.parameters.vvSizeFactor,B=this.parameters.vvSizeMinSize,W=this.parameters.vvSizeMaxSize,q=y.sizeAttributeValue;b[0]*=Ot(z[0]+q*G[0],B[0],W[0]),b[1]*=Ot(z[2]+q*G[2],B[2],W[2])}const x=Math.max(b[0],b[1]),A=t.boundingInfo;if(J(A))return void this._intersectTriangles(y,b,n,a,l);const M=q2(A.bbMin[0]-x,A.bbMin[1]-x,A.bbMin[2]-x,A.bbMax[0]+x,A.bbMax[1]+x,A.bbMax[2]+x),P=[a[0]-n[0],a[1]-n[1],a[2]-n[2]],$=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2]),k=[$/P[0],$/P[1],$/P[2]];VJ(M,n,k,s.tolerance)&&this._intersectTriangles(y,b,n,a,l)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(Y.POSITION);return mJ(s,null,!1,i)}createBufferWriter(){return new jht(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?tt.TRANSPARENT_MATERIAL:tt.OPAQUE_MATERIAL)||t===tt.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Depth||t.output===Te.Normal||t.output===Te.Highlight||t.output===Te.Shadow&&this.parameters.castShadows?new Vht(t):null}static getVertexBufferLayout(t){let i=on().vec3f(Y.POSITION).vec4f(Y.PROFILERIGHT).vec4f(Y.PROFILEUP).vec4f(Y.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(Y.FEATUREVALUE)),i}}class Vht extends Xg{updateParameters(t){return this.ensureTechnique(P8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}_updateShadowState(t){(J(this.technique)||t.shadowMappingEnabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMappingEnabled})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const Ght=ie(ie({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},fZ),Sd);class jht{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(Y.POSITION).length}write(t,i,r,s){const n=a=>{if(i.vertexAttributes.has(a)){const l=i.vertexAttributes.get(a),p=i.indices.get(a);Kt(l.size===4);const y=r.getField(a,So);if(!y)throw new Error("unable to acquire view for "+a);HS(p,l.data,y,s)}};n(Y.PROFILERIGHT),n(Y.PROFILEUP),n(Y.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(Y.FEATUREVALUE)&&n(Y.FEATUREVALUE),QN(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const Hht=["polyline"];class qht extends N0{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=yr(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=L(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=L(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=lO(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=uO.circle(Zht);break;case"quad":this._profile=uO.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new mU(0,Jht);break;case"bevel":this._extruder=new mU(0,1);break;case"miter":this._extruder=new mU(.8*Math.PI,1);break;default:this._extruder=new Oht}const a=this.symbolLayer.cap||"butt";switch(a){case"none":this._startCap=new Hae,this._endCap=new Hae;break;case"butt":default:this._startCap=new DP(this._profile,0),this._endCap=new DP(this._profile,0,!0);break;case"square":this._startCap=new DP(this._profile,-.5),this._endCap=new DP(this._profile,.5,!0);break;case"round":{const M=s==="quad";this._startCap=new qae({profile:this._profile,flip:!1,breakNormals:M,subdivisions:Jae}),this._endCap=new qae({profile:this._profile,flip:!0,breakNormals:M,subdivisions:Jae});break}}const l=Ss(this.symbolLayer,"material","color"),p=this._getCombinedOpacityAndColor(l),y=zl(p),b=p[3],x=b<1||this.needsDrivenTransparentPass,A={diffuse:y,ambient:y,opacity:b,transparent:x,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:x||a==="none"?Fr.None:Fr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(ds(this._intrinsicSize,t,i),!kD(this._intrinsicSize[0])||!kD(this._intrinsicSize[1])))throw new Se("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Wl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(A,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new RZ(A)):(A.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new gw(A)),this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Hht,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=Ss(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Fv)}slicePlaneEnabledChanged(){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cO(this._fastUpdates,i,this._vvConvertOptions))return Hn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Hn.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,a=this._context.elevationProvider.spatialReference,l=this._context.renderCoordsHelper.spatialReference;for(const M of r)i+=M.length;const p=new Float64Array(3*i),y=new Float64Array(3*i),b=new Float64Array(3*i);let x=0;for(const M of r){s.push({index:x,numVertices:M.length});for(const P of M)p[x++]=P[0],p[x++]=P[1],p[x++]=t.hasZ?P[2]:0}let A=!0;return n.equals(a)?this._copyVertices(p,0,y,0,i):A=ys(p,n,0,y,a,0,i),a.equals(l)?this._copyVertices(y,0,b,0,i):ys(y,a,0,b,l,0,i),{pathVertexDataInfos:s,vertexDataGS:p,vertexDataES:y,vertexDataRS:b,projectionSuccess:A,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let a=0;a<n;++a)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,a=new Array,l=new Array,p=new Array,y=n.spatialReference,b=On(),x=this._context.renderCoordsHelper;y3e.spatialReference=y;const A=this.getVertexData(n);if(!A.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(A.pathVertexDataInfos.length>0){for(let M=0;M<A.pathVertexDataInfos.length;++M){const P=A.pathVertexDataInfos[M],$=P.index,k=P.numVertices;if(k<2||L(this._context.clippingExtent)&&(jr(b),Hh(b,A.vertexDataES,3*$,k),!vp(b,this._context.clippingExtent)))continue;const z=[];for(let de=$;de<$+3*k;){const he=de++,fe=de++,me=de++,ge=new Cht;ze(ge.posGS,A.vertexDataGS[he],A.vertexDataGS[fe],A.vertexDataGS[me]),ze(ge.posES,A.vertexDataES[he],A.vertexDataES[fe],A.vertexDataES[me]);const Ce=_rt(ge.posES,this._context.elevationProvider,r,x);ze(rd,A.vertexDataRS[he],A.vertexDataRS[fe],A.vertexDataRS[me]),x.setAltitude(rd,Ce),ze(ge.pos,rd[0],rd[1],rd[2]),z.push(ge)}const G=new Mht(z);g3e(G,this.upVectorAlignment,this._context.renderCoordsHelper);const B=new Iht(G,this._profile,this._extruder,this._startCap,this._endCap);let W=null;if(this._fastUpdates.enabled){const de=this._fastUpdates.visualVariables,he=de.size?mg(de.size.field,t):0,fe=de.color?mg(de.color.field,t):0,me=de.opacity?mg(de.opacity.field,t):0;W=new $ht(B,he,fe,me)}else{const de=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(de[0]*=Xae(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),de[1]*=Xae(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let he=null;this._drivenProperties.color&&(he=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(he=he?[he[0],he[1],he[2],i.opacity]:[1,1,1,i.opacity]);const fe=new f3e(B);fe.bake(de),he&&fe.bakeVertexColors(he),W=fe}const{vertexAttributes:q,indices:X}=W.createGeometryData(),oe=new wht(q,X,W,y,this.upVectorAlignment,this.stencilWidth);a.push(oe),l.push(this._material),p.push(W.xform)}if(a.length>0){const M={layerUid:this._context.layer.uid,graphicUid:s},P=new Qg({geometries:a,materials:l,transformations:p,metadata:M}),$=new L0(this,P,a,null,null,Xht,r);return $.alignedSampledElevation=A.terrainElevation,$.needsElevationUpdates=Fv(r.mode),$}}else n.paths.length!==0&&n.paths.some(M=>M.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function g3e(e,t,i){switch(t){case"world":for(const r of e.vertices)Xe(hf,r.pos,e.offset),i.worldUpAtPosition(hf,rd),r.setFrameFromUpVector(rd),r.computeRotationAxisAndAngleFromUpVector();break;case"path":Xe(hf,e.vertices[0].pos,e.offset),i.worldUpAtPosition(hf,rd),Rht(e,rd);for(const r of e.vertices){const s=Math.sign(rt(r.frame.right,r.vRight));si(r.rotationFrame.up,r.vRight,r.vLeft),Ue(r.rotationFrame.up,r.rotationFrame.up,s),ot(r.rotationFrame.up,r.rotationFrame.up);const n=rt(r.rotationFrame.up,r.frame.up),a=rt(r.rotationFrame.up,r.frame.right);if(Ue(hf,r.frame.up,-a),Ue(Yae,r.frame.right,n),Xe(hf,hf,Yae),ot(r.rotationFrame.right,hf),Aht(r.rotationRight,r.frame,r.rotationFrame.right),Na(hf,r.vLeft),r.rotationAngle=-s*(Math.PI-Xn(rt(hf,r.vRight))),Math.abs(r.rotationAngle)>0){const p=Pz(Math.cos(.5*r.rotationAngle));AZ(r.miterStretch,1+(p-1)*r.rotationRight[0]*r.rotationRight[0],(p-1)*r.rotationRight[0]*r.rotationRight[1],(p-1)*r.rotationRight[0]*r.rotationRight[1],1+(p-1)*r.rotationRight[1]*r.rotationRight[1])}const l=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*Pz(Math.cos(.5*l)))}}}function Xae(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Wht(e,t,i,r){let s=0;for(const n of e.vertices)Ig(n.posES,i,t,r,gU),s+=gU.sampledElevation,Xe(rd,n.pos,e.offset),r.setAltitude(rd,gU.z),We(n.pos,rd,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Xht(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let a=0;Yht.spatialReference=r.spatialReference;for(const l of n){const p=l.geometry;if(!u3e(p))continue;const y=p.path,b=y.builder.path,x=p.geometrySR;y3e.spatialReference=x,a+=Wht(b,t,i,r),p.upVectorAlignment!=="world"&&g3e(b,p.upVectorAlignment,r),y.onPathChanged(),p.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/n.length}const Yht=Kg(0,0,0,null),y3e=Kg(0,0,0,null),rd=Q(),hf=fr(),Yae=fr(),gU=new m4,Jht=3,Jae=3,Zht=10;function Kht(e,t,i,r,s=1){if(i.isGeographic&&r===vt.Global){const l=new Float64Array(t.typedBuffer.length),p=3*t.count,y=ir(i);for(let b=0;b<p;b+=3)wX(t.typedBuffer,b,l,b,y);t=gn.fromTypedArray(l)}ds(kn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let l=0;l<t.count;l++)t.getVec(l,zc),kn[0]=Math.min(kn[0],zc[0]),kn[1]=Math.min(kn[1],zc[1]);const n=kn[0]%s,a=kn[1]%s;Zu[0]=kn[0]-n,Zu[1]=kn[1]-a;for(let l=0;l<t.count;l++)t.getVec(l,zc),e.setValues(l,(zc[0]-Zu[0])/s,(zc[1]-Zu[1])/s,Zu[0]/s,Zu[1]/s)}function v3e(e,t,i,r,s=1){ze(A_,1,0,0),ze(C_,0,1,0),ze(bx,0,0,1),tut(yU,t),Qht(t,Zae)&&eut(Zae,A_,C_,bx,i,yU),ds(kn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ds(M_,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let p=0;p<t.count;p++){t.getVec(p,zc);const y=rt(A_,zc),b=rt(C_,zc);kn[0]=Math.min(kn[0],y),kn[1]=Math.min(kn[1],b),M_[0]=Math.max(M_[0],y),M_[1]=Math.max(M_[1],b)}const n=rt(bx,yU);_U(w1,kn[0],kn[1],n,A_,C_,bx),_U(R_,M_[0],kn[1],n,A_,C_,bx),_U(O_,kn[0],M_[1],n,A_,C_,bx),We(R_,R_,w1),Ue(R_,R_,.5),We(O_,O_,w1),Ue(O_,O_,.5),Xe(w1,w1,R_),Xe(w1,w1,O_);const a=kn[0]%s,l=kn[1]%s;Zu[0]=kn[0]-a,Zu[1]=kn[1]-l;for(let p=0;p<t.count;p++){t.getVec(p,zc),e.setValues(p,(rt(A_,zc)-Zu[0])/s,(rt(C_,zc)-Zu[1])/s,Zu[0]/s,Zu[1]/s);for(let y=0;y<3;y++)r.set(p,y,w1[y]),r.set(p,y+3,R_[y]),r.set(p,y+6,O_[y])}}const yU=Q(),zc=Q(),Zae=er(),A_=Q(),C_=Q(),bx=Q(),kn=St(),M_=St(),Zu=St(),w1=Q(),R_=Q(),O_=Q();function Qht(e,t){const i=e.count-1;return tge(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function eut(e,t,i,r,s,n){L(s)?(s.basisMatrixAtPosition(n,uf),ze(NP,uf[0],uf[1],uf[2]),ze(FP,uf[4],uf[5],uf[6]),ze(vU,uf[8],uf[9],uf[10])):(ze(NP,1,0,0),ze(FP,0,1,0),ze(vU,0,0,1));const a=e;rt(a,vU)<0&&Ue(a,a,-1),ke(r,a);const l=rt(a,FP),p=rt(a,NP);Math.abs(l)<Math.abs(p)?(Rz(t,NP,a,-p),ot(t,t),si(i,t,a),ot(i,i),Ue(i,i,-1)):(Rz(i,FP,a,-l),ot(i,i),si(t,i,a),ot(t,t))}const uf=lt(),NP=Q(),FP=Q(),vU=Q();function tut(e,t){ze(kP,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,zc),Xe(kP,kP,zc);Ue(e,kP,1/(t.count-1))}const kP=Q();function _U(e,t,i,r,s,n,a){ze(e,t*s[0]+i*n[0]+r*a[0],t*s[1]+i*n[1]+r*a[1],t*s[2]+i*n[2]+r*a[2])}function iut(e){const t=new Ir,i=e.output===Te.Depth;return t.include(da,{linearDepth:i}),t.include(Uw,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add(Y.POSITION,"vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(Zv,e),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(V`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?V`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:V`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ws,e),t.fragment.include(P0),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.uniforms.add("eColor","vec4"),e.output===Te.Highlight&&t.include(Yg),t.fragment.code.add(V`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${V.float(fa)}) {
      discard;
    }

    ${e.output===Te.Alpha?V`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===Te.Color?V`gl_FragColor = highlightSlice(fColor, vpos); ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===Te.Highlight?V`outputHighlight();`:""};
    ${e.output===Te.Depth?V`outputDepth(linearDepth);`:""};
  }
  `),t}const rut=Object.freeze({__proto__:null,build:iut});class I8 extends Xr{initializeProgram(t){const i=I8.shader.get(),r=this.configuration,s=i.build({output:r.output,oitEnabled:r.transparencyPassType===Qt.Color,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,mr)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("eColor",t.color),this.configuration.output===Te.Highlight&&D0(this.program,i),(this.configuration.output===Te.Depth||i.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",i.camera.nearFar),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i))}bindDraw(t){I0(this.program,t),this.program.rebindTextures(),kw(this.program,this.configuration,t)}_createPipeline(t,i){const r=this.configuration,s=t===Qt.NONE,n=t===Qt.FrontFace;return Ti({blending:r.output!==Te.Color&&r.output!==Te.Alpha||!r.transparent?null:s?Qc:Zg(t),culling:LN(r.cullFace),depthTest:{func:Jv(t)},depthWrite:s||n?r.writeDepth&&ac:null,colorWrite:Ii,stencilWrite:r.sceneHasOcludees?b0:null,stencilTest:r.sceneHasOcludees?i?kv:Kv:null,polygonOffset:s||n?r.polygonOffset&&sut:r8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}I8.shader=new Ur(rut,()=>import("./ColorMaterial.glsl.91c0ce12.js"));const sut={factor:1,units:1};class Th extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.cullFace=Fr.None,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],Th.prototype,"output",void 0),_([Oe({count:Fr.COUNT})],Th.prototype,"cullFace",void 0),_([Oe()],Th.prototype,"slicePlaneEnabled",void 0),_([Oe()],Th.prototype,"vertexColors",void 0),_([Oe()],Th.prototype,"transparent",void 0),_([Oe()],Th.prototype,"polygonOffset",void 0),_([Oe()],Th.prototype,"enableOffset",void 0),_([Oe()],Th.prototype,"writeDepth",void 0),_([Oe()],Th.prototype,"sceneHasOcludees",void 0),_([Oe({count:Qt.COUNT})],Th.prototype,"transparencyPassType",void 0),_([Oe()],Th.prototype,"multipassTerrainEnabled",void 0),_([Oe()],Th.prototype,"cullAboveGround",void 0);class Kae extends Wp{constructor(t){super(t,out),this.supportsEdges=!0,this.techniqueConfig=new Th}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<t8,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(t,i,r,s,n,a,l){KN(t,i,s,n,a,void 0,l)}requiresSlot(t,i){return t===tt.DRAPED_MATERIAL?!0:fw(i)===Te.Highlight?t===tt.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:tt.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Highlight||t.output===Te.Depth&&this.parameters.writeLinearDepth?new nut(t):null}createBufferWriter(){return new p8(Wwe)}}class nut extends Xg{updateParameters(t){return this.ensureTechnique(I8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||this._updateOccludeeState(t),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const out=ie({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:Fr.None,sceneHasOcludees:!1},Sd);var ko;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(ko||(ko={}));const LH=.70710678118,Qae=LH,aut=.08715574274;function lut(e){const t=new Ir;e.draped||t.extensions.add("GL_OES_standard_derivatives");const i=e.output===Te.Depth;t.include(da,{linearDepth:i}),t.include(Uw,e),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),i&&(t.include(Zv,e),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("linearDepth","float")),e.draped?t.vertex.uniforms.add("worldToScreenRatio","float"):(t.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),t.vertex.uniforms.add("cameraPosition","vec3"),t.attributes.add(Y.BOUNDINGRECT,"mat3")),t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const r=e.style===ko.ForwardDiagonal||e.style===ko.BackwardDiagonal||e.style===ko.DiagonalCross;return r&&t.vertex.code.add(V`
      const mat2 rotate45 = mat2(${V.float(LH)}, ${V.float(-Qae)},
                                 ${V.float(Qae)}, ${V.float(LH)});
    `),e.draped||(t.vertex.code.add(V`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),t.vertex.code.add(V`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),t.vertex.code.add(V`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${V.float(aut)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),t.vertex.code.add(V`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${r?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${r?" * rotate45":""};

      ${e.draped?"":V`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${V.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),t.vertex.code.add(V`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${i?V`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:V`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ws,e),t.fragment.include(P0),t.fragment.uniforms.add("uColor","vec4"),e.draped&&t.fragment.uniforms.add("texelSize","float"),e.output===Te.Highlight&&t.include(Yg),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),e.output!==Te.Highlight&&(t.fragment.code.add(V`
      const float lineWidth = ${V.float(e.lineWidth)};
      const float spacing = ${V.float(e.patternSpacing)};
      const float spacingINV = ${V.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||t.fragment.code.add(V`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.fragment.code.add(V`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.attributeColor?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==Te.Highlight?V`color.a *= ${cut(e)};`:""}

      if (color.a < ${V.float(fa)}) {
        discard;
      }

      ${e.output===Te.Alpha?V`gl_FragColor = vec4(color.a);`:""}

      ${e.output===Te.Color?V`gl_FragColor = color; ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===Te.Highlight?V`outputHighlight();`:""}
      ${e.output===Te.Depth?V`outputDepth(linearDepth);`:""};
    }
  `),t}function cut(e){function t(i){return e.draped?V`coverage(vuv.${i}, texelSize)`:V`sample(vuv.${i})`}switch(e.style){case ko.ForwardDiagonal:case ko.Horizontal:return t("y");case ko.BackwardDiagonal:case ko.Vertical:return t("x");case ko.DiagonalCross:case ko.Cross:return V`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const hut=Object.freeze({__proto__:null,build:lut});class $8 extends Xr{initializeProgram(t){const i=$8.shader.get(),r=this.configuration,s=i.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:r.style,patternSpacing:r.patternSpacing,lineWidth:r.lineWidth,draped:r.draped,oitEnabled:r.transparencyPassType===Qt.Color,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,_3e)}bindPass(t,i){hh(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("uColor",t.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/i.screenToPCSRatio),this.program.setUniform1f("texelSize",1/i.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/i.camera.perScreenPixelRatio),this.configuration.output===Te.Highlight&&D0(this.program,i),(this.configuration.output===Te.Depth||i.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",i.camera.nearFar),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Jg(this.program,i))}bindDraw(t){I0(this.program,t),Yv(this.program,t.origin,t.camera.viewInverseTransposeMatrix),kw(this.program,this.configuration,t),this.program.rebindTextures()}_setPipelineState(t,i){const r=this.configuration,s=t===Qt.NONE,n=t===Qt.FrontFace;return Ti({blending:r.output===Te.Color||r.output===Te.Alpha?s?Qc:Zg(t):null,culling:LN(r.cullFace),depthTest:{func:Jv(t)},depthWrite:s?r.writeDepth&&ac:e8(t),colorWrite:Ii,stencilWrite:r.sceneHasOcludees?b0:null,stencilTest:r.sceneHasOcludees?i?kv:Kv:null,polygonOffset:s||n?r.polygonOffset&&uut:r8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}$8.shader=new Ur(hut,()=>import("./Pattern.glsl.633e6186.js"));const uut={factor:1,units:1};class il extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.cullFace=Fr.None,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=Qt.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],il.prototype,"output",void 0),_([Oe({count:Fr.COUNT})],il.prototype,"cullFace",void 0),_([Oe()],il.prototype,"slicePlaneEnabled",void 0),_([Oe()],il.prototype,"vertexColors",void 0),_([Oe()],il.prototype,"polygonOffset",void 0),_([Oe()],il.prototype,"writeDepth",void 0),_([Oe()],il.prototype,"sceneHasOcludees",void 0),_([Oe({count:ko.COUNT})],il.prototype,"style",void 0),_([Oe()],il.prototype,"patternSpacing",void 0),_([Oe()],il.prototype,"lineWidth",void 0),_([Oe()],il.prototype,"enableOffset",void 0),_([Oe()],il.prototype,"draped",void 0),_([Oe({count:Qt.COUNT})],il.prototype,"transparencyPassType",void 0),_([Oe()],il.prototype,"multipassTerrainEnabled",void 0),_([Oe()],il.prototype,"cullAboveGround",void 0);const _3e=new Map([[Y.POSITION,0],[Y.COLOR,3],[Y.UVMAPSPACE,4],[Y.BOUNDINGRECT,5]]);class OZ extends Wp{constructor(t){super(t,fut),this.supportsEdges=!0,this._vertexAttributeLocations=_3e,this.techniqueConfig=new il}getTechniqueConfig(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<t8,this.techniqueConfig.multipassTerrainEnabled=i.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=i.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(t,i,r,s,n,a,l){KN(t,i,s,n,a,void 0,l)}requiresSlot(t,i){return t===tt.DRAPED_MATERIAL?!0:fw(i)===Te.Highlight?t===tt.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?tt.TRANSPARENT_MATERIAL:tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===Te.Color||t.output===Te.Alpha||t.output===Te.Highlight||t.output===Te.Depth&&this.parameters.writeLinearDepth?new dut(t):null}createBufferWriter(){const t=on().vec3f(Y.POSITION).vec4u8(Y.COLOR).vec4f(Y.UVMAPSPACE);return this.parameters.draped||t.mat3f(Y.BOUNDINGRECT),new put(t)}}class dut extends Xg{updateParameters(t){return this.ensureTechnique($8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})}beginSlot(t){return this._output!==Te.Color&&this._output!==Te.Alpha||this._updateOccludeeState(t),this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}class put extends p8{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(n),l=i.indices.get(n);if(a&&l)switch(n){case Y.POSITION:{Kt(a.size===3);const p=r.getField(n,Cr);p&&h4(l,a.data,t.transformation,p,s);break}case Y.COLOR:{Kt(a.size===3||a.size===4);const p=r.getField(n,lc);p&&DD(l,a.data,a.size,p,s);break}case Y.UVMAPSPACE:{Kt(a.size===4);const p=r.getField(n,So);p&&HS(l,a.data,p,s);break}case Y.BOUNDINGRECT:{Kt(a.size===9);const p=r.getField(n,Bp);p&&this.writeBoundingRect(l,a.data,t.transformation,p,s);break}}}}writeBoundingRect(t,i,r,s,n){const a=r,l=s.typedBuffer,p=s.typedBufferStride,y=t.length;n*=p;for(let b=0;b<y;++b){const x=9*t[b],A=i[x],M=i[x+1],P=i[x+2];l[n]=a[0]*A+a[4]*M+a[8]*P+a[12],l[n+1]=a[1]*A+a[5]*M+a[9]*P+a[13],l[n+2]=a[2]*A+a[6]*M+a[10]*P+a[14];for(let $=3;$<9;++$)l[n+$]=i[x+$];n+=p}}}const fut=ie({color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:Fr.None,sceneHasOcludees:!1,style:ko.Cross,patternSpacing:10,lineWidth:1,draped:!0},Sd);function mut(e,t,i){return yut(gut(e),t,i)}function gut(e){return e&&e.pattern||null}function yut(e,t,i){return L(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=_r(0,0,0,0),t.transparent=!0),new Kae(t)):(t.style=vut(e.style),t.draped=i.isDraped,new OZ(t)):new Kae(t)}function vut(e){switch(e){case"horizontal":return ko.Horizontal;case"vertical":return ko.Vertical;case"cross":return ko.Cross;case"forward-diagonal":return ko.ForwardDiagonal;case"backward-diagonal":return ko.BackwardDiagonal;case"diagonal-cross":return ko.DiagonalCross;default:return}}function _ut(e){return e.material instanceof OZ&&!e.material.parameters.draped}function but(e,t){if(_ut(e)){const i=e.geometry.vertexAttributes,r=i.get(Y.POSITION).data,s=i.get(Y.UVMAPSPACE).data,n=i.get(Y.BOUNDINGRECT).data;v3e(So.fromTypedArray(s),gn.fromTypedArray(r),t,Mv.fromTypedArray(n))}}function wut(e,t,i,r){const s=Twe(e,t,i,r),n=e.stageObject.geometryRecords;for(let a=0;a<n.length;a++)but(n[a],r);return s}const xut=["polyline","polygon","extent"];class D8 extends N0{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(L(this._material))return;const t=Ss(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=mut(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof OZ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(L(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=Vxe(t.pattern);return new lT({width:r,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:RH(t.patternCap||"butt")})};this._outlineMaterial=i(La(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return L(t)&&t.size&&t.size>0&&L(t.color)&&(J(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,xut,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new cu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(L(this._material)){const t=this._material.parameters.color,i=Ss(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(L(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=f4(D8.elevationModeChangeTypes,r,s);if(n!==Us.UPDATE)return n;const a=bd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>a)}slicePlaneEnabledChanged(){if(L(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),L(this._outlineMaterial)){const t={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=oO(t.geometry);if(J(s))return null;Qn.renderData=_Z(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),Qn.color=i;const n=Qn.renderData.position.length/3;if(this._needsUV&&(Qn.uvMapSpace=new Float32Array(4*n),Qn.boundingRect=new Float64Array(9*n)),Qn.outNum=0,Qn.outGeometries=[],Qn.outTransforms=[],Qn.outMaterials=[],this._createAs3DShapeFill(Qn),this._hasOutline&&this._createAs3DShapeOutline(Qn),this._logGeometryCreationWarnings(Qn.renderData,s.rings,"rings","FillSymbol3DLayer"),Qn.outNum===0)return null;this._needsUV&&v3e(So.fromTypedArray(Qn.uvMapSpace),gn.fromTypedArray(Qn.renderData.position),this._context.renderCoordsHelper,Mv.fromTypedArray(Qn.boundingRect));const a=new Qg({geometries:Qn.outGeometries,materials:Qn.outMaterials,transformations:Qn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),l=new L0(this,a,Qn.outGeometries,null,null,wut,r);return l.alignedSampledElevation=Qn.renderData.sampledElevation,l.needsElevationUpdates=bd(r.mode),l}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:a,count:l}of i){if(L(this._context.clippingExtent)&&(jr(qa),Hh(qa,s),!vp(qa,this._context.clippingExtent)))continue;const p=XS(s,n,3);if(p.length===0)continue;const y=new Uint32Array(p),b=nae({indices:y,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*a*t.uvMapSpace.BYTES_PER_ELEMENT,4*l):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*a*t.boundingRect.BYTES_PER_ELEMENT,9*l):null}});t.outGeometries.push(b),t.outMaterials.push(this._material),t.outTransforms.push(Rn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(L(this._context.clippingExtent)&&(jr(qa),Hh(qa,s),!vp(qa,this._context.clippingExtent)))continue;const a=MH({overlayInfo:null,removeDuplicateStartEnd:yw.REMOVE,attributeData:{position:n,mapPosition:s}}),l=a.vertexAttributes.get(Y.POSITION);l.data===n&&(l.data=new Float64Array(n)),t.outGeometries.push(a),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Rn),t.outNum++}}_createAsOverlay(t,i){const r=oO(t.geometry);if(J(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,L(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Jo.renderData=yxe(r,this._context.overlaySR),Jo.color=i;const s=Jo.renderData.position.length/3;return this._needsUV&&(Jo.uvMapSpace=new Float32Array(4*s)),Jo.outNum=0,Jo.outGeometries=[],Jo.outBoundingBox=jr(),Jo.layerUid=this._context.layer.uid,Jo.graphicsUid=t.uid,this._createAsOverlayFill(Jo),this._hasOutline&&this._createAsOverlayOutline(Jo),this._logGeometryCreationWarnings(Jo.renderData,r.rings,"rings","FillSymbol3DLayer"),Jo.outNum===0?null:(this._needsUV&&Kht(So.fromTypedArray(Jo.uvMapSpace),gn.fromTypedArray(Jo.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Jo.outNum>0?new T8(this,Jo.outGeometries,Jo.outBoundingBox):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:a}of i){if(jr(qa),Hh(qa,r),!vp(qa,this._context.clippingExtent))continue;const l=XS(r,s,3);if(l.length===0)continue;cS(t.outBoundingBox,qa);const p=new Uint32Array(l),y=nae({indices:p,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null}}),b=new JS(y,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),x=qa;fl(b.boundingSphere,.5*(x[0]+x[3]),.5*(x[1]+x[4]),0,.5*Math.sqrt((x[3]-x[0])*(x[3]-x[0])+(x[4]-x[1])*(x[4]-x[1]))),t.outGeometries.push(b),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(jr(qa),Hh(qa,s),!vp(qa,this._context.clippingExtent))continue;cS(t.outBoundingBox,qa);const n=MH({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:yw.REMOVE,attributeData:{position:s}}),a=new JS(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),l=qa;fl(a.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),t.outGeometries.push(a),t.outNum++}}_getOutlineOpacity(){const t=Ss(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(L(t)?t.a:0)}_getOutlineColor(){const t=Ss(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return kM(L(t)?Ft.toUnitRGB(t):null,i)}get test(){return{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)}}}D8.elevationModeChangeTypes={definedChanged:Us.RECREATE,staysOnTheGround:Us.NONE,onTheGroundChanged:Us.RECREATE};const qa=On(),Qn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Jo={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Tut=Ge.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class L8{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=Ss(t,"material","color"),s=kc(r,E2,Ft.toUnitRGBA),n=kc(t.size,12,La),a=t.lineHeight,l=L(t.background)?Ft.toUnitRGBA(t.background.color):E2,p={family:kc(t.font,"sans-serif",M=>M.family),decoration:kc(t.font,"none",M=>M.decoration),weight:kc(t.font,"normal",M=>M.weight),style:kc(t.font,"normal",M=>M.style)},y=t.halo,b=L(y)&&L(y.color)&&y.size>0?{size:La(y.size),color:Ft.toUnitRGBA(y.color)}:{size:0,color:E2},x=new L8({color:s,size:n,background:{color:l,padding:L(t.background)?[.65*n,.5*n]:[0,0],borderRadius:L(t.background)?n*(6/16):0},lineSpacingFactor:a,font:p,halo:b,pixelRatio:i}),A=x.fontString(n);try{await document.fonts.load(A)}catch{Tut.warnOnce(`Failed to preload font '${A}'. Some text symbology may be rendered using the default browser font.`)}return x}}class Sut{constructor(t,i,r){this._renderer=new $xe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=u$(Eut,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Sn(t,{wrap:{s:ei.CLAMP_TO_EDGE,t:ei.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:hv.PAD})}}const Eut={canvas:null},Aut=[0,0,1];class Cut extends N0{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=s8(this.symbolLayer.size);if(t)throw new Se("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.pixelRatio;this._textRenderParameters=await L8.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=sO(i.geometry);if(J(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(J(s)||s==="")return null;const n=cX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(L(n)&&!A0e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const a=qe(ie({},Out),{verticalOffset:n,horizontalPlacement:tat(this.symbolLayer.horizontalAlignment),verticalPlacement:iat(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,a)}createLabel(t,i,r,s){const n=t.graphic,a=sO(n.geometry);if(J(a))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(n,a,l,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return ele(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Us.UPDATE}slicePlaneEnabledChanged(t,i){return ele(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=bd(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Rut}_createAs3DShape(t,i,r,s,n,a){const l=this.setGraphicElevationContext(t,new cu,s.elevationOffset),p=Ss(t.geometry,"type")==="polyline",y=t.uid;let b=null,x=null;if(J(a)){const ge=Lxe(s.horizontalPlacement);b=new Sut(r,ge,this._textRenderParameters);let Ce=null;x=this._context.sharedResources.textures.fromData(b.key,()=>b.create(),()=>{L(Ce)&&Ce.release()});const Ae=this._context.stage.renderView.textureRepository.acquire(x.texture.id);if(J(Ae)||au(Ae))return x.release(),null;Ce=Ae}const A=Mut(b,s),M={occlusionTest:!0,screenOffset:s.screenOffset,anchorPos:A,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(L(x)&&(M.textureId=x.texture.id),L(a)&&(M.textureId=a.id),L(s.verticalOffset)){const{screenLength:ge,minWorldLength:Ce,maxWorldLength:Ae}=s.verticalOffset;M.verticalOffset={screenLength:La(ge),minWorldLength:Ce||0,maxWorldLength:Ae!=null?Ae:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:ge,screenSizePerspectiveSettingsLabels:Ce}=this._context.sharedResources;M.screenSizePerspective=Ce.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),M.screenSizePerspectiveAlignment=ge}let P;if(p&&(M.shaderPolygonOffset=1e-4),M.slicePlaneEnabled=this._context.slicePlaneEnabled,L(n)){const ge=JSON.stringify(M);P=n.get(ge),J(P)&&(P=new qS(M),n.add(ge,P))}else P=new qS(M);const $=[P],k=s.translation,z=L(b)?[b.displayWidth,b.displayHeight]:[0,0],G=s.centerOffset,B=Aut,W=[0,0],q=[$c.createPointGeometry(B,k,null,z,G,W,null)],X=this._context.layer.uid,oe=cZ(this._context,i,q,$,l,X,y);if(oe===null)return null;const de=new L0(this,oe.object,q,J(n)?$:null,x,iO,l);de.alignedSampledElevation=oe.sampledElevation,de.needsElevationUpdates=bd(l.mode)||l.mode==="absolute-height";const{displayWidth:he,displayHeight:fe}=L(b)?b:s;de.getScreenSize=(ge=St())=>(ge[0]=he,ge[1]=fe,ge);const me={labelText:r,elevationOffset:s.elevationOffset};return de.metadata=me,rO(de,i,this._context.elevationProvider),de}}function ele(e,t,i){e&&e.forEach(r=>{const s=t(r);L(s)&&i(s,r.graphic)})}function Mut(e,t){if(t.verticalPlacement==="baseline"){const r=Kot[t.horizontalPlacement],s=L(e)?e.baselineAnchorY:0;return yr(r,s)}const i=eat(t.horizontalPlacement,t.verticalPlacement);return d$[i]}const Rut={mode:"relative-to-ground",offset:0},Out={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},Put=["polyline","polygon","extent"];class Hf extends N0{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Put,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(L(this._material))return;const t=ie({},Xwe),i=this.symbolLayer.color;L(i)&&(t.color=Ft.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=L(this.symbolLayer.waveDirection)?Hf.headingVectorFromAngle(this.symbolLayer.waveDirection):yr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Kst[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.slicePlaneEnabled=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new Ywe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(J(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=f4(Hf.elevationModeChangeTypes,r,s);if(n!==Us.UPDATE)return n;const a=bd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>a)}slicePlaneEnabledChanged(){return L(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=oO(t.geometry);if(J(s))return null;xa.renderData=_Z(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=xa.renderData.position.length/3;if(xa.uvCoords=new Float64Array(2*n),xa.outNum=0,xa.outGeometries=[],xa.outTransforms=[],xa.outMaterials=[],this._create3DShapeGeometries(xa),this._logGeometryCreationWarnings(xa.renderData,s.rings,"rings","WaterSymbol3DLayer"),xa.outNum===0)return null;this._createUVCoordsFromVertices(xa.uvCoords,xa.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const a=new Qg({geometries:xa.outGeometries,materials:xa.outMaterials,transformations:xa.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),l=new L0(this,a,xa.outGeometries,null,null,Twe,i);return l.alignedSampledElevation=xa.renderData.sampledElevation,l.needsElevationUpdates=bd(i.mode),l}_createUVCoordsFromVertices(t,i,r,s){const n=lh(s);pd(x1);for(let p=0;p<r;p++)ds(tle,i[3*p+0],i[3*p+1]),u0e(x1,tle);OO(x1,x1,n);const a=x1[0]%Hf.unitSizeOfTexture,l=x1[1]%Hf.unitSizeOfTexture;UP[0]=x1[0]-a,UP[1]=x1[1]-l;for(let p=0;p<r;p++)t[2*p+0]=(i[3*p+0]*n-UP[0])/Hf.unitSizeOfTexture,t[2*p+1]=(i[3*p+1]*n-UP[1])/Hf.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:a,mapPosition:l,holeIndices:p}of i){if(L(this._context.clippingExtent)&&(jr(T1),Hh(T1,l),!vp(T1,this._context.clippingExtent)))continue;const y=XS(l,p,3);if(y.length===0)continue;const b=new Uint32Array(y),x=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),A=oae({indices:b,attributeData:{position:a,uv0:x,mapPosition:l}});t.outGeometries.push(A),t.outMaterials.push(this._material),t.outTransforms.push(Rn),t.outNum++}}_createAsOverlay(t){const i=oO(t.geometry);if(J(i))return null;this._material.renderPriority=this._renderPriority,Wa.renderData=yxe(i,this._context.overlaySR);const r=Wa.renderData.position.length/3;return Wa.uvCoords=new Float64Array(2*r),Wa.outNum=0,Wa.outGeometries=[],Wa.outBoundingBox=jr(),Wa.layerUid=this._context.layer.uid,Wa.graphicsUid=t.uid,this._createAsOverlayWater(Wa),this._logGeometryCreationWarnings(Wa.renderData,i.rings,"rings","WaterSymbol3DLayer"),Wa.outNum===0?null:(this._createUVCoordsFromVertices(Wa.uvCoords,Wa.renderData.position,r,this._context.overlaySR),Wa.outNum>0?new T8(this,Wa.outGeometries,Wa.outBoundingBox):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:a,count:l}of r){if(jr(T1),Hh(T1,s),!vp(T1,this._context.clippingExtent))continue;cS(t.outBoundingBox,T1);const p=XS(s,n,3);if(p.length===0)continue;const y=new Uint32Array(p),b=new Float64Array(i.buffer,2*a*i.BYTES_PER_ELEMENT,2*l),x=oae({indices:y,attributeData:{position:s,uv0:b}}),A=new JS(x,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),M=T1;fl(A.boundingSphere,.5*(M[0]+M[3]),.5*(M[1]+M[4]),0,.5*Math.sqrt((M[3]-M[0])*(M[3]-M[0])+(M[4]-M[1])*(M[4]-M[1]))),t.outGeometries.push(A),t.outNum++}}static headingVectorFromAngle(t){const i=St(),r=TL(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}get test(){return{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Hf.unitSizeOfTexture=100,Hf.elevationModeChangeTypes={definedChanged:Us.RECREATE,staysOnTheGround:Us.NONE,onTheGroundChanged:Us.RECREATE};const UP=St(),x1=Mi(),tle=St(),T1=On(),xa={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Wa={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Iut=Ge.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function $ut(e,t,i,r){const s=ile[e.type]&&ile[e.type][t.type]||Dut[t.type];return s?new s(e,t,i,r):(Iut.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const Dut={icon:hO,object:eht,line:A8,path:qht,fill:D8,extrude:Uot,text:Cut,water:Hf},ile={"mesh-3d":{fill:Llt}};class Lut extends nZ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];J(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const a=i.getItemAt(n);if(a.enabled===!1)continue;zP.renderPriority=1-(1+n)/r,zP.renderPriorityStep=1/r,zP.ignoreDrivers=a._ignoreDrivers;const l=$ut(this.symbol,a,this._context,zP);s.push(TO(t,()=>{this.symbolLayers[n]=null,l.destroy()})),this.symbolLayers[n]=l}await YL(this.symbolLayers,async(n,a)=>{if(L(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[a]=null}});for(const n of s)n==null||n.remove();if(s.length=0,Gi(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return L(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let a=0;a<this.symbolLayers.length;a++){const l=this.symbolLayers[a];s[a]=L(l)?l.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new vst(r,i||this,s,t.layer,n)}get complexity(){return lZ(this.symbolLayers.map(t=>Ss(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],a=l=>{const p=l.graphics[s];return p instanceof L0?p:null};if(L(n)&&!n.globalPropertyChanged(t,i,a))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Uh.LOADED?Hn.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==Hn.Recreate_Symbol&&L(s)?Math.min(r,s.applyRendererDiff(t,i)):r,Hn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Uh.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(J(s))return;const a=r[n];if(a){const l={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(l),t.symbolStatePatches.push(...l.symbolLayerStatePatches),l.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((p,y)=>{const b=p.graphics[n];L(b)&&l.graphics3DGraphicPatches.forEach(x=>x(b,y))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(J(s))continue;const n=t.graphics[r];if(J(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(J(r))continue;const s=t.graphics[i];L(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{J(s)||(s.loadStatus===Uh.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)L(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const zP={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Nut extends nZ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return L(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return L(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return L(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),L(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return L(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return L(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:aZ}globalPropertyChanged(t,i){return!!L(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return L(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):Hn.Recreate_Symbol}prepareSymbolPatch(t){L(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!L(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return L(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){L(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function PZ(e){return e instanceof Nut?e.graphics3DSymbol:e instanceof Lut?e:null}const dO=Ge.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Fut(e){const t=qut(e);if(J(t))return null;const i=kut(e,t);if(J(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return zut({anchor:r,verticalOffset:t.verticalOffset,screenOffset:St(),centerOffset:_r(0,0,0,-1),centerOffsetUnits:"world",translation:Q(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function kut(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=xp[i],s=r||JD(e);return i&&!r&&dO.warnOncePerTick(`the requested label placement '${i}' is not currently supported in SceneView`),Uut(s,e)}function IZ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=PZ(t);return L(i)?i.symbol.symbolLayers.getItemAt(0):null}function Uut(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(J(i))return null;if(L(t.disablePlacement))return t.labelClass.labelPlacement?(dO.warnOncePerTick(rle(e.placement,t.disablePlacement.logEntityDescription)),JD(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return dO.warnOncePerTick(rle(e.placement,`'${r}' geometries`)),JD(t);break;case"point":case"mesh":return e}return e}function rle(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView`}function JD(e){const t=e.graphics3DGraphic.graphic.geometry;if(J(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=IZ(e);return L(i)&&i.type==="extrude"?xp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return xp["above-center"];default:return}}function zut(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(J(r))return null;switch(r.type){case"point":Vut(e,t,i);break;case"polygon":But(e,t,i);break;case"mesh":$Z(e,t,i.graphics3DGraphic.graphics[0])}return e}function But(e,t,i){const r=IZ(i);if(!J(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];L(s)?(s.getBoundingBoxObjectSpace(HM),yp(HM,e.translation),e.translation[2]=Gv(HM)/2):ze(e.translation,0,0,0),$Z(e,t,s);break}}}function Vut(e,t,i){const r=IZ(i);if(J(r))return;const s=i.graphics3DGraphic.graphics[0];switch(L(s)?s.getCenterObjectSpace(e.translation):ze(e.translation,0,0,0),r.type){case"icon":case"text":Gut(e,t,i,s);break;case"object":$Z(e,t,s)}}function Gut(e,t,i,r){const{graphics3DGraphic:s}=i,n=L(r)?r.getScreenSize():null;if(!s.isDraped&&L(n)){const a=jut(i);SA[0]=n[0]/2*(t.normalizedOffset[0]-a[0]),SA[1]=n[1]/2*(t.normalizedOffset[1]-a[1]),e.screenOffset[0]=SA[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=SA[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=SA[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(xp[i.labelClass.labelPlacement]&&dO.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function jut(e,t=Wut){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=L(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof qS){const n=s.parameters.anchorPos;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function $Z(e,t,i){const r=L(i)?i.getBoundingBoxObjectSpace(HM):HM,s=$t(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const a=e.translation[2],l=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=a+l;const p=yt(s);e.centerOffset[2]=p/2*t.normalizedOffset[2]}function Hut(e){return e==="above-center"}function qut(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=PZ(r.graphics3DSymbol),n=Da(s,l=>l.symbol.type==="point-3d"?l.symbol:null),a=xp[t]||JD(e);return L(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:sle(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(J(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?Hut(a.placement)?{placement:"above-center",verticalOffset:sle(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(dO.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function sle(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const xp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},nle={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in nle){const t=nle[e],i=xp[e];t.forEach(r=>{xp[r]=i})}Object.freeze&&(Object.freeze(xp),Object.keys(xp).forEach(function(e){Object.freeze(xp[e]),Object.freeze(xp[e].normalizedOffset)}));const SA=[0,0],Wut=[0,0],HM=On();class ole{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var NH;const bU=512,wU=4096,Xut=.85,Yut=.95;let R3=NH=class extends st{constructor(e){super(e),this.type=Vp.Texture,this.id=ec(),this.events=new ps,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Xt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,flipped:!0,samplingMode:Pt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return L(this._glTexture)||(this._glTexture=new Vt(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(ii.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=_o(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Xt(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",bU.toString()),e.setAttribute("height",bU.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=bU){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=XT(i),i=Math.min(i,wU),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,L(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=EA,e.cursor.y=EA+ale,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:a,displayWidth:l,displayHeight:p}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=a,e.placement.size.displayWidth=l,e.placement.size.displayHeight=p,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(Y.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,a=s+EA,l=n+EA+ale;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,r,a,l),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const p=this._getExpectedAtlasUsage(),y=p>Xut&&i.size.width<wU;return y&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!y&&p>Yut&&i.size.width===wU?(this._processRemovals(),cT.OK):(this._repack(),cT.REPACK)}i.cursor.x=EA,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,a,l),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return cT.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(Y.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(Y.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(rn(this.elementsToAddOrUpdate,(s,n)=>{const a=this.elements.get(n);if(a&&a.rendered){const l=this.stageObjects.get(n);return l&&l.forEach(p=>{const y=p.geometries[0].vertexAttributes,b=this.elements.get(n);y.get(Y.UV0).data=new Float32Array(b.placement.uvMinMax),y.get(Y.SIZE).data=new Float32Array([b.placement.size.displayWidth,b.placement.size.displayHeight]),p.geometryVertexAttrsUpdated(p.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===cT.REPACK&&(i=!0,!0)}),i)return void this.runTask(SE,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),rn(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&L(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&NH.test.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,a)=>s._resizeAtlas(n,a),run:(n,a)=>s.runTask(n,a)}}};R3.test={orderedRepackingEnabled:!1},_([S({constructOnly:!0})],R3.prototype,"view",void 0),_([S({type:Boolean})],R3.prototype,"updating",void 0),R3=NH=_([re("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],R3);const EA=2,ale=2;var cT;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(cT||(cT={}));const Jut=R3,lle=Ge.getLogger("esri.views.3d.layers.graphics.Labeler");let Eb=class extends st{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ei,this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ii.LABELER,this)]),this._textTextureAtlas=new Jut({view:this.view}),this._hudMaterialCollection=new ole(this.view._stage),this._calloutMaterialCollection=new ole(this.view._stage)}dispose(){this._handles=Ht(this._handles),this._textTextureAtlas=Xt(this._textTextureAtlas),this._hudMaterialCollection=Xt(this._hudMaterialCollection),this._calloutMaterialCollection=Xt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(Gh.USER_SETTING,!0,Fo.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(Gh.USER_SETTING,!1,Fo.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];L(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];L(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Zut(t)){if(!cle(t)){if(Kut(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),xU(t)){this._dirty=!0;continue}if(!cle(t))continue}rn(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Gi(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(l=>!!l.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let a=!1;await YL(s,async(l,p)=>{const y=l.symbol,b=PZ(i.getOrCreateGraphics3DSymbol(y));if(J(b))return void lle.error("Failed to create Graphics3DSymbol for label");await b.load(),Gi(t);let x=null;cX(y)&&y.hasVisibleCallout()&&(x=fst(y,i.symbolCreationContext),await x.load(),Gi(t));const A=await nh(bwe(l,e.layer.fieldsIndex,this.view.spatialReference));if(Gi(t),A.ok===!0){const M=await this._createTextRenderParameters(b.symbol);Gi(t),n[p]={labelClass:l,labelFunction:A.value,graphics3DSymbol:b,graphics3DCalloutSymbolLayer:x,calloutSymbolLayerIndex:0,textRenderParameters:M}}else lle.error(`Label expression failed to evaluate: ${A.error}`),a=!0}),Gi(t),a||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Cs(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?L8.fromSymbol(t,this.view.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:bae(i.anchor),verticalPlacement:Qot(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:ur.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return S1.graphic=t,S1.renderingInfo=null,S1.layer=r,s.createLabel(S1,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return S1.graphic=e,S1.renderingInfo=n,S1.layer=s,i.createGraphics3DGraphic(S1)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const a=t.graphic,l=r.layer,p=GV(r.layer),y=this.view._stage;for(let b=0;b<s.length;b++){const x=i.textRenderers[b],A=i.labelPlacements[b];if(J(x)||J(A))continue;const M=s[b],P=M.graphics3DSymbol,$=P.symbol&&P.symbol.type==="label-3d"?P.symbol:null,k=P.symbolLayers[0];if(!k)continue;k.setElevationInfoOverride(r.elevationInfoOverride);const z=this._createTextSymbolGraphic(x,a,A,l,k);if(!z)return!1;z._labelClass=M.labelClass,z._labelIndex=b,t.addLabelGraphic(z,y,r.stageLayer),t.setVisibilityFlag(Gh.USER_SETTING,p,Fo.LABEL),t.clearVisibilityFlag(Gh.SCALE_RANGE,Fo.LABEL),t.setVisibilityFlag(Gh.DECONFLICTION,!1,Fo.LABEL),n=!0;const G=M.graphics3DCalloutSymbolLayer;if(G&&A.hasLabelVerticalOffset){G.setElevationInfoOverride(r.elevationInfoOverride);const B=this._createLineCalloutGraphic(a,$,G,A,l);L(B)&&(M.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(B,y,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const a=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let p;if(l.type==="arcade")try{const z=l.needsHydrationToEvaluate()?crt(s,i.layer):s;p=l.evaluate(z)}catch{p=null}else p=l.evaluate(s);if(J(p)||p===""||/^\s+$/.test(p))continue;const y=a.graphics3DSymbol,b=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null;if(!y.symbolLayers[0])continue;const x=e.graphics3DGraphic,A=a.labelClass,M=i.disablePlacement,P=Fut({graphics3DGraphic:x,labelSymbol:b,labelClass:A,disablePlacement:M});if(J(P))continue;const $=bae(P.anchor),k=Lxe($);t.textRenderers[n]=new $xe(p,k,a.textRenderParameters),t.labelPlacements[n]=P}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const a=n.graphics3DGraphic;r.set(a.graphic.uid,a)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=a=>a.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l={graphics3DCore:e,layer:a,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:a.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new sxe({isPickable:!0},a.uid)};return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:p=>this._addGraphic(l,p),removeGraphic:p=>this._removeGraphic(l,p),featureReductionChange:()=>{},layerLabelsEnabled:()=>GV(l.layer),labelingInfoChange:p=>this._labelingInfoChange(l,p),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>xU(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(xU(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Zut(e){return e.active&&GV(e.layer)}function xU(e){return e.labelClassPromise&&!!e.labelClassAbortController}function cle(e){return e.labelClassContexts&&e.labelClassContexts.length}function Kut(e){return e.labelClassContexts===null}_([S({constructOnly:!0})],Eb.prototype,"view",void 0),_([S({constructOnly:!0})],Eb.prototype,"deconflictor",void 0),_([S()],Eb.prototype,"_textTextureAtlas",void 0),_([S({type:Boolean,readOnly:!0})],Eb.prototype,"updating",null),Eb=_([re("esri.views.3d.layers.graphics.Labeler")],Eb);const S1=new gst(null,null,null);class Qut{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Ei}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>r3e(new t3e(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>s3e(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,a)=>{if(zn(s))return void a(rr());const l=ka(s,()=>{this._remove(t,i),a(rr())}),p=t.get(i);if(p)return this.evictHandles.remove(i),p.refCount++,void p.item.then(n,a);const y=new AbortController,b=qe(ie({},s),{signal:y.signal}),x={refCount:1,abortController:y,item:r(b).then(A=>(x.abortController=null,A.remove=()=>this._remove(t,i),A))};t.set(i,x),x.item.then(A=>{L(l)&&l.remove(),n(A)},A=>{L(l)&&l.remove(),a(A)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(YCe(()=>{t.delete(i),L(r.abortController)&&r.abortController.abort()},tdt),i))}}const edt=1e4;let tdt=edt;class fp{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Mi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ma.VISIBLE_ON_SURFACE,screenRect:Mi(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=fp.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new fp(i,r,s,this.tilingScheme),new fp(i,r+1,s,this.tilingScheme),new fp(i,r,s+1,this.tilingScheme),new fp(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,bv(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var Ma;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ma||(Ma={}));class Ny{constructor(t){this.renderCoordsHelper=t,this.frustum=JR(),this._points=$be(),this.lines=new Array(12),this._origin=Q(),this._direction=Q(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:Q(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){Dbe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ke(this._origin,t.eye),ke(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)ke(this._points[i],t[i]);Lbe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return ev(this.frustum,t)}intersectsRay(t){return jKe(this.frustum,t)}intersectsLineSegment(t,i){return HKe(this.frustum,t,i)}intersectsPoint(t){return Nbe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;TU(this.lines[i],t[i],t[r]),TU(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),TU(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function TU(e,t,i){e.origin=t,e.endpoint=i,kg(e.direction,t,i)}Ny.planePointIndices=WKe,Ny.nearFarLineIndices=[[zt.NEAR_BOTTOM_LEFT,zt.FAR_BOTTOM_LEFT],[zt.NEAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_RIGHT],[zt.NEAR_TOP_RIGHT,zt.FAR_TOP_RIGHT],[zt.NEAR_TOP_LEFT,zt.FAR_TOP_LEFT]];const b3e=.5*Math.PI,idt=b3e/Math.PI*180;class rdt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Q(),direction:Q()};for(let i=0;i<4;i++)this.extent[i]={origin:Q(),direction:Q(),cap:{next:null,direction:Q()}},this.planes[i]=er();this.planes[Qr.NEAR]=er(),this.planes[Qr.FAR]=er(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),Xe(this.center.origin,n[0].origin,n[2].origin),Ue(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||Ue(this.center.direction,this.center.direction,-1);for(let a=0;a<4;a++){const l=n[a];this.renderCoordsHelper.worldUpAtPosition(l.origin,l.direction);const p=n[a===3?0:a+1];l.cap.next=p.origin,kg(l.cap.direction,l.origin,p.origin),vR(l.direction,l.cap.direction,l.origin,this.planes[a]),s||Ue(l.direction,l.direction,-1)}vR(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[Qr.NEAR]),s?UV(this.planes[Qr.NEAR],this.planes[Qr.FAR]):(nN(this.planes[Qr.FAR],this.planes[Qr.NEAR]),UV(this.planes[Qr.NEAR],this.planes[Qr.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*ir(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===vt.Global){const n=this.maxSpanSpatialReference.isGeographic?idt:b3e*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(iu(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const a=this.extent[n];if(!r&&t.intersectsRay(iu(a.origin,a.direction))||t.intersectsLineSegment(A2(a.origin,a.cap.next,ndt),a.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const a=t.lines[n];if(TZe(s,a.origin,a.endpoint,a.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){KW(t,$d),$d[2]=r,kp(i,$d,SU,this.renderCoordsHelper.spatialReference),Ms(hle,SU),jr(mc);for(const{x0:n,x1:a,y0:l,y1:p}of sdt)for(let y=0;y<5;y++){const b=y/4;$d[0]=Vi(t[n],t[a],b),$d[1]=Vi(t[l],t[p],b),$d[2]=r,Ho($d,i,$d,this.renderCoordsHelper.spatialReference),Ct($d,$d,hle),u0(mc,$d)}ze(this.extent[0].origin,mc[0],mc[1],mc[2]),ze(this.extent[1].origin,mc[3],mc[1],mc[2]),ze(this.extent[2].origin,mc[3],mc[4],mc[2]),ze(this.extent[3].origin,mc[0],mc[4],mc[2]);for(let n=0;n<4;++n)Ct(this.extent[n].origin,this.extent[n].origin,SU)}_toRenderBoundingExtentLocal(t,i,r){tN(t,i,J0,this.renderCoordsHelper.spatialReference),ze(this.extent[0].origin,J0[0],J0[1],r),ze(this.extent[1].origin,J0[2],J0[1],r),ze(this.extent[2].origin,J0[2],J0[3],r),ze(this.extent[3].origin,J0[0],J0[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case vt.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case vt.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(rt(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(rt(r.direction,t.direction)<0)return!0}return!1}}const sdt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],$d=Q(),SU=lt(),hle=lt(),mc=On(),J0=Mi(),ndt=M0();class odt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new Ny(t),this.extendedFrustum=new Ny(t),this.intersector=new rdt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return Ma.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===vt.Global&&t.lij[0]>=adt&&t.lij[0]<ldt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==Ma.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=Ny.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,a]=s,l=r[n],p=r[a];We(fh,p,l),Ue(fh,fh,hdt),Xe(r[a],l,fh)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=Ma.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=fle.acquire();t.getChildren(s);for(const n of s){const a=this.calculate(n);if(a!==Ma.INVISIBLE&&(i=a,a===Ma.VISIBLE_ON_SURFACE))break}return fle.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===vt.Global&&t.lij[0]<cdt?this._calculateSingleTileVisibilitySided(t,!1)===Ma.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=ir(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?Ma.VISIBLE_ON_SURFACE:Ma.VISIBLE_WHEN_EXTENDED:Ma.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,fh);this.aboveGround||Na(i,i);const r=Xn(-rt(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let a=0;a<4;a++){const l=s.pointIndices[a],p=n[l],y=this.renderCoordsHelper.getAltitude(p);if(s.needsAltitudeAdjustment(y)){switch(this.renderCoordsHelper.worldUpAtPosition(p,fh),l){case zt.FAR_BOTTOM_LEFT:case zt.FAR_TOP_LEFT:case zt.NEAR_BOTTOM_LEFT:case zt.NEAR_TOP_LEFT:zV(this.extendedFrustum.planes[Qr.LEFT],fh,fh);break;case zt.FAR_BOTTOM_RIGHT:case zt.FAR_TOP_RIGHT:case zt.NEAR_BOTTOM_RIGHT:case zt.NEAR_TOP_RIGHT:zV(this.extendedFrustum.planes[Qr.RIGHT],fh,fh)}Ue(fh,fh,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(iu(p,fh),s.zWithMargin,p)}}if(this.extendedFrustum.updatePoints(n),Pa(n[zt.NEAR_BOTTOM_LEFT],n[zt.NEAR_BOTTOM_RIGHT],n[zt.NEAR_TOP_RIGHT],dle),Pa(n[zt.NEAR_BOTTOM_RIGHT],n[zt.NEAR_TOP_RIGHT],n[zt.NEAR_TOP_LEFT],ple),rt(dle,ple)<0){const a=this.extendedFrustum.mutablePoints;this.aboveGround?[a[zt.NEAR_BOTTOM_LEFT],a[zt.NEAR_BOTTOM_RIGHT]]=[a[zt.NEAR_BOTTOM_RIGHT],a[zt.NEAR_BOTTOM_LEFT]]:[a[zt.NEAR_TOP_LEFT],a[zt.NEAR_TOP_RIGHT]]=[a[zt.NEAR_TOP_RIGHT],a[zt.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(a)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-ule;return{zWithMargin:t,pointIndices:Ny.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+ule;return{zWithMargin:t,pointIndices:Ny.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const adt=2,ldt=6,cdt=12,hdt=.95,ule=1,fh=Q(),dle=er(),ple=er(),fle=new mn(Array,e=>{e.length!==4&&(e[0]=new fp,e[1]=new fp,e[2]=new fp,e[3]=new fp)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class udt{constructor(t){this.camera=new br,this.focusOnMap=[0,0],this.screenRect=Mi(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new odt(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,h6e(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=p6e(t.extent,this.focusOnMap),t.measures.visibility!==Ma.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=ddt,r=1<<i,s=t.measures.screenRect;pd(s);let n=0;const a=t.lij[0]+i,l=t.lij[1]<<i,p=t.lij[2]<<i,y=this._tileSizeWithBias(t),b=y*y;for(let x=0;x<r;x++)for(let A=0;A<r;A++)if(n+=this._computeScreenArea(t,a,l+x,p+A,s),n>b)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Ma.VISIBLE_WHEN_EXTENDED?this.tileSize*pdt:this.tileSize}_computeScreenArea(t,i,r,s,n){const a=t.measures.visibility===Ma.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,a,E1),pd(EU);for(let l=0;l<4;l++)u0e(EU,E1[l]);return lv(n,EU,n),ane(E1[0],E1[1],E1[2])+ane(E1[0],E1[2],E1[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,AA),this._toRenderCoords(AA,0,3,A1[0]),this._toRenderCoords(AA,2,3,A1[1]),this._toRenderCoords(AA,2,1,A1[2]),this._toRenderCoords(AA,0,1,A1[3]),s&&(this._projectToPlane(A1,this.camera.frustum[Qr.NEAR]),this._projectToPlane(A1,this.camera.frustum[Qr.TOP]),this._projectToPlane(A1,this.camera.frustum[Qr.BOTTOM]));for(let a=0;a<4;a++)this.camera.projectToRenderScreen(A1[a],mle),this.camera.renderToScreen(mle,n[a])}_projectToPlane(t,i){for(let s=0;s<4;s++)MA[s]=Kr(i,t[s]);const r=Math.max(MA[0],MA[1],MA[2],MA[3]);if(r>0){const s=Ue(CA,i,-r);for(let n=0;n<4;n++)Xe(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return CA[0]=t[i],CA[1]=t[r],CA[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(CA,this.tilingScheme.spatialReference,s),s}}const EU=Mi(),ddt=2,pdt=5,E1=[Ns(),Ns(),Ns(),Ns()],AA=Mi(),CA=Q(),A1=[Q(),Q(),Q(),Q()],MA=[0,0,0,0],mle=ca();function WSt(e,t,i){if(J(e)||J(i))return!1;let r=!0;return Fn[0]=e.xmin!=null?e.xmin:0,Fn[1]=e.ymin!=null?e.ymin:0,Fn[2]=e.zmin!=null?e.zmin:0,r=r&&ys(Fn,e.spatialReference,0,t,i,0,1),Fn[0]=e.xmax!=null?e.xmax:0,Fn[1]=e.ymax!=null?e.ymax:0,Fn[2]=e.zmax!=null?e.zmax:0,r=r&&ys(Fn,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function w3e(e,t,i){if(J(e)||J(i))return!1;let r=!0;return Fn[0]=e.xmin!=null?e.xmin:0,Fn[1]=e.ymin!=null?e.ymin:0,Fn[2]=e.zmin!=null?e.zmin:0,r=r&&ys(Fn,e.spatialReference,0,Fn,i,0,1),t[0]=Fn[0],t[1]=Fn[1],Fn[0]=e.xmax!=null?e.xmax:0,Fn[1]=e.ymax!=null?e.ymax:0,Fn[2]=e.zmax!=null?e.zmax:0,r=r&&ys(Fn,e.spatialReference,0,Fn,i,0,1),t[2]=Fn[0],t[3]=Fn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Fn=Q(),fdt=Ge.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let Ko=class extends st{constructor(e){super(e),this.tiles=new kt,this.tileSize=512,this._idToTile=new Map,this._handles=new Ei,this._clients=new Set,this._dirty=!1,this._newTiles=new Ci}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(L(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void fdt.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||L(t)&&e&&t.equals(e))return;const i=L(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(J(this.filterExtent)||!this.tilingScheme)return null;const e=Mi();return w3e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0)),this._handles.add(Pi(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0)),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ii.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=_o(this._frameWorker),this._handles=Ht(this._handles)}addClient(){const e=gdt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(SE))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),L(this._frameWorker)&&(this._frameWorker.priority=ii.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&L(this._frameWorker)&&(this._frameWorker.priority=ii.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new udt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new fp(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),pd(BP);for(let t=0;t<e.length;t++)if(lv(BP,e.data[t].measures.screenRect,BP),H2(BP)>ydt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!BL(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Ma.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Ma.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};_([S({constructOnly:!0})],Ko.prototype,"scheduler",void 0),_([S({constructOnly:!0})],Ko.prototype,"renderCoordsHelper",void 0),_([S({constructOnly:!0})],Ko.prototype,"tilingSchemeOwner",void 0),_([S({constructOnly:!0})],Ko.prototype,"cameraOnSurface",void 0),_([S({constructOnly:!0})],Ko.prototype,"focus",void 0),_([S({constructOnly:!0})],Ko.prototype,"viewState",void 0),_([S({constructOnly:!0})],Ko.prototype,"terrain",void 0),_([S()],Ko.prototype,"tiles",void 0),_([S()],Ko.prototype,"tileSize",void 0),_([S({readOnly:!0})],Ko.prototype,"tilingScheme",null),_([S()],Ko.prototype,"filterExtent",null),_([S({readOnly:!0})],Ko.prototype,"filterExtentRect",null),_([S({readOnly:!0})],Ko.prototype,"rootTileIds",null),_([S({value:!1})],Ko.prototype,"suspended",null),_([S({readOnly:!0})],Ko.prototype,"updating",null),Ko=_([re("esri.views.3d.layers.support.FeatureTileTree3D")],Ko);let mdt=0;function gdt(){return mdt++}const BP=Mi(),ydt=10,x3e=Ko;class zv{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new pue(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=$ue(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)EQ(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)EQ(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}let Qo=class extends st{constructor(){super(...arguments),this._propertiesPool=new zv({camera:br},this),this._lastSeenCameraProjectionValues=new br,this.events=new ps,this.viewingMode=vt.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new qWe({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new zv({camera:br},this)}createInitialCamera(){if(this.viewingMode===vt.Global){const e=ir(this.spatialReference).radius;this.camera=new br($t(4*e,0,0),$t(e,0,0),$t(0,0,1))}else this.camera=new br($t(0,0,100),$t(0,0,0),$t(0,1,0))}get animation(){return this.cameraController instanceof ZR&&L(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==gu&&gu.copyFrom(e),gu.computeUp(this.viewingMode),gle.camera=gu,this.events.emit("before-camera-change",gle);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,gu)&&(this._lastSeenCameraProjectionValues.copyFrom(gu),yle.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",yle)),(!t||!t.equals(gu))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(gu)),this._cameraChanged=!t||!t.almostEquals(gu),this._cameraChanged)){const i=$ue(()=>{this._cameraChanged=!1,i.remove()})}}get contentCamera(){return L(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=L(e)?e.clone():null}get fixedContentCamera(){return!!L(this._contentCamera)}get isGlobal(){return this.viewingMode===vt.Global}get isLocal(){return this.viewingMode===vt.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(e.watch("state",t=>{t!==xs.Finished&&t!==xs.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},!0),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=xs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==xs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();gu.copyFrom(this._get("camera")),e(gu),this.camera=gu,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[di.TOP]!==t.padding[di.TOP]||e.padding[di.RIGHT]!==t.padding[di.RIGHT]||e.padding[di.BOTTOM]!==t.padding[di.BOTTOM]||e.padding[di.LEFT]!==t.padding[di.LEFT]}};_([S({readOnly:!0,type:CS})],Qo.prototype,"animation",null),_([S({type:br})],Qo.prototype,"camera",null),_([S({})],Qo.prototype,"_contentCamera",void 0),_([S({type:br})],Qo.prototype,"contentCamera",null),_([S({readOnly:!0})],Qo.prototype,"fixedContentCamera",null),_([S({readOnly:!0})],Qo.prototype,"constraints",void 0),_([S({readOnly:!0})],Qo.prototype,"events",void 0),_([S({readOnly:!0})],Qo.prototype,"isGlobal",null),_([S({readOnly:!0})],Qo.prototype,"isLocal",null),_([S({readOnly:!0})],Qo.prototype,"viewingMode",void 0),_([S({readOnly:!0})],Qo.prototype,"spatialReference",void 0),_([S({readOnly:!0})],Qo.prototype,"navigating",null),_([S({readOnly:!0})],Qo.prototype,"stationary",null),_([S()],Qo.prototype,"_cameraChanged",void 0),_([S()],Qo.prototype,"cameraController",null),Qo=_([re("esri.views.3d.state.ViewState")],Qo);const vdt=Qo,gu=new br,gle={camera:null},yle={camera:null};function _dt(e,t,i){return e===vt.Global?new wdt(i):new bdt(t,i)}class bdt{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=ir(i),this.unitInMeters=lh(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let a=t[2]*this.unitInMeters;const l=a,p=a-s,y=this.elevationProvider?this.elevationProvider.elevationBounds:null;y&&(a=p>=0?l-this.unitInMeters*y.min:this.unitInMeters*y.max-l);const b={x:(r=L(r)?r:new ki({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},x=Math.max(b.x,b.y,b.z);We(P_,i,t),wx[0]=P_[0]>0?r.xmax:r.xmin,wx[1]=P_[1]>0?r.ymax:r.ymin,wx[2]=P_[2]>0?x/2:-x/2,We(wx,wx,t),ot(P_,P_);const A=1.1*rt(wx,P_)*this.unitInMeters,M=Math.sqrt(a*(a+2*this._referenceEllipsoid.radius)),P=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),$=P*Sdt*this.unitInMeters,k=P*Edt*this.unitInMeters;let z=Ot((a-k)/($-k),0,1);z*=z*z;let G=Vi(M,A,z);return G*=Math.max(Math.log(Math.abs(p)),1),G=Math.min(G,Math.max(34064e4,x)),G/=this.unitInMeters,T3e(G,xdt,this.unitInMeters,n)}}class wdt{constructor(t){this._referenceEllipsoid=ir(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const a=yt(t)-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),p=Math.abs(a-s),y=Math.max(p,Math.abs(a));return T3e(1.2*Math.sqrt(y*(y+2*l)),Ot(2e4-(Math.log(y)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function T3e(e,t,i,r){const s=Tdt/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const xdt=2e4,Tdt=2,Sdt=.001,Edt=1e-4,wx=Q(),P_=Q();let y$=class extends st{constructor(e){super(e),this.handles=new Ei}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;xbe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{AE(this.view,e,ad.EYE_AND_CENTER)})}};_([S({constructOnly:!0})],y$.prototype,"view",void 0),y$=_([re("esri.views.3d.state.ElevationCollisionConstraint")],y$);const Adt=y$;let YC=class extends st{constructor(e){super(e),this._handles=new Ei,this.nearFarHeuristic=_dt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),this.view.watch("renderDataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],()=>this._updateCollision(),!0)]),this.view.state.isLocal&&this._handles.add(Pi(this.view,"renderDataExtent",e=>this._updateLocalSurfaceDistance(e))),this._updateNearFar(),this.view.state.viewingMode!==vt.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Adt({view:this.view}))}destroy(){this._handles=Ht(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var e;const t=(e=this.view.constraints)==null?void 0:e.clipDistance;t&&t.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,t),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,HN(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var e,t,i;const r=(e=this.view.map)==null||(t=e.ground)==null||(i=t.navigationConstraint)==null?void 0:i.type,s=!r||r==="stay-above",n=this.view.state.constraints.collision;if(s!==n.enabled){n.enabled=s,s&&this._reapplyConstraints(ts.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==vt.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(xi(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(th(i))}}_updateLocalSurfaceDistance(e){if(J(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=ts.ALL){this.view.state.updateCamera(t=>sn(this.view,t,{selection:e,interactionType:Si.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:xo.TUMBLE}))}};_([S({constructOnly:!0})],YC.prototype,"view",void 0),_([S({readOnly:!0})],YC.prototype,"surfaceCollisionConstraint",void 0),YC=_([re("esri.views.3d.state.ConstraintsManager")],YC);const Cdt=YC;let hT=class extends p2{constructor(e){super(e),this.handles=new Ei}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=xs.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){xbe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),AE(this.view,e,ad.EYE_AND_CENTER)||this.constraintEnabled||(this.state=xs.Stopped)})}};_([S({constructOnly:!0})],hT.prototype,"view",void 0),_([S({constructOnly:!0})],hT.prototype,"desiredCamera",null),hT=_([re("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],hT);const Mdt=.66;function S3e(e){return 360-NW.normalize(e)}function N8(e){return NW.normalize(360-e)}function VP(e){return L(e)&&e.resolver&&e.resolver.reject(),null}function Rdt(e,t){return L(e)&&e.resolver&&e.resolver.resolve(t),t}function DZ(e,t,i,r=null){if(!t)return VP(r);const s=e.spatialReference||It.WGS84;if(L(t.camera)){const y=Tw(t.camera.position,s);if(J(y))return VP(r);const b=t.camera.clone();return b.position=y,Rdt(r,b)}if(J(t.targetGeometry))return VP(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Mp(n,s))return VP(r);const a=jS(e,e.state.camera);let l=pa.ADJUST;if(t.rotation!=null&&(a.heading=S3e(t.rotation),l=pa.LOCKED),i!=null&&(a.tilt=i),t.targetGeometry.type==="point"){const y=t.targetGeometry;let b;const x=t.targetGeometry.clone();return b=t.scale!=null?UJ(e,t.scale,y.latitude):e.state.camera.distance,d2e(e,x,b,a,l,r)}const p=t.targetGeometry.extent;return DM(e,p,a.heading,a.tilt,l,r)}function Odt(e,t,i=null){return J(i)&&(i=new oh),FZ(e,null,t.clone(),i)}async function Pdt(e,t,i){const r=Bdt(e,t);if(!r)throw new Se("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new sh({fov:e.camera.fov}),n=new oh({camera:s});if(r.target instanceof oh)return I_(await Ddt(e,r.target,r,i,n));if(r.target instanceof sh)return I_(A3e(e,r.target,n));const a=r.scale!=null||r.zoom!=null;if(r.target instanceof ki){const y=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return I_(a||y?await FH(e,r,r.target.center,s,i,n):await kdt(e,r,r.target,s,i,n))}const l={boundingBox:jr(),hasZ:!1,screenSpaceObjects:[]},p=a?Idt(e,r):void 0;if(await E3e(e,r.target,p,l),isFinite(l.boundingBox[0])){let y;if(yp(l.boundingBox,tn),Lh.x=tn[0],Lh.y=tn[1],Lh.z=tn[2],Lh.spatialReference=e.spatialReference,isFinite(Lh.z)&&l.hasZ?y=GL(l.boundingBox):(Lh.z=void 0,y=f6e(tX(l.boundingBox,Gdt))),a||y)return I_(await FH(e,r,Lh,s,i,n));const b=Vdt(e,l.screenSpaceObjects);return I_(await zdt(e,r,Lh,l.boundingBox,b,s,i,n))}return r.position?I_(Ndt(e,r,s,n)):I_(await Fdt(e,r,s,i,n))}function LZ(e,t){return t.scale==null&&t.zoom!=null?m2e(e,t.zoom):t.scale}function Idt(e,t){return get(e,LZ(e,t))}function NZ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=S3e(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function FZ(e,t,i,r){const s=e.spatialReference||It.WGS84;return t=L(t)?t:Bm(e,i),J(t)||(r.targetGeometry=Sv(t.center,e.renderSpatialReference,s),r.scale=g2e(e,t),r.rotation=N8(i.heading),r.camera=i),r}function ZD(e,t,i){if(!t)return;if(!Mp(t.spatialReference,e.spatialReference))throw new Se("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let a;switch(t.type){case"point":a=t;break;case"multipoint":case"polyline":a=t.extent.center;break;case"mesh":a=t.origin;break;case"extent":a=t.center;break;case"polygon":a=t.centroid}a&&Mp(a,e.basemapTerrain.spatialReference)?tn[2]=Wt(wp(e.elevationProvider,a),0):tn[2]=0}(0,jdt[t.type])(t,a=>{r.push(a[0],a[1],a[2])},tn);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(ys(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let a=0;a<n.length;a+=3)t.hasZ?(tn[0]=n[a+0],tn[1]=n[a+1],tn[2]=n[a+2]):(tn[0]=n[a+0],tn[1]=n[a+1]),u0(i.boundingBox,tn)}}async function $dt(e,t,i,r){const s=await nh(e.whenViewForGraphic(t));if(s.ok===!1||J(s.value)||!("whenGraphicBounds"in s.value))return void ZD(e,t.geometry,r);const n=s.value,a=await nh(n.whenGraphicBounds(t,{minDemResolution:i}));if(a.ok===!1)return void ZD(e,t.geometry,r);const{screenSpaceObjects:l,boundingBox:p}=a.value;cS(r.boundingBox,p),l&&l.forEach(y=>{r.screenSpaceObjects.push(y)}),isFinite(p[2])&&(r.hasZ=!0)}async function E3e(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Lh.x=s,Lh.y=n,Lh.z=void 0,Lh.spatialReference=e.spatialReference.isGeographic?e.spatialReference:It.WGS84,void ZD(e,Lh,r)}t&&typeof t.map=="function"?await bo(t.map(s=>E3e(e,s,i,r))):t instanceof rh?ZD(e,t,r):t instanceof gl&&await $dt(e,t,i,r)}async function Ddt(e,t,i,r,s){if(L(t.camera))return A3e(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=L(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=N8(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=LZ(e,i);n!=null&&(s.scale=n);const a=new RE(r);return DZ(e,s,i.tilt,a),s.camera=await a.resolver.promise,s}function A3e(e,t,i){const r=e.spatialReference,s=Tw(t.position,r);return J(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,FZ(e,null,t,i))}function Ldt(e,t,i,r,s,n){const a=e.renderSpatialReference;return To(i.position,jP,a),To(t,AU,a),n.targetGeometry=new Gt(t),s.position=new Gt(i.position),We(KD,AU,jP),XN(e,jP,KD,r.up,s),n.scale=uw(e,Er(jP,AU),n.targetGeometry.latitude),n.rotation=N8(s.heading),n.camera=s,n}async function FH(e,t,i,r,s,n){if(J(i))throw new Se("createfromcenter","invalid point");n.targetGeometry=i.clone();const a=Fw(e);if(t.position)return Ldt(e,n.targetGeometry,t,a,r,n);if(t.zoomFactor){const p=a.distance/t.zoomFactor,y=Ue(tn,a.viewForward,-p);a.eye=Xe(tn,a.center,y),n.scale=uw(e,p,i.latitude)}jS(e,a,r);const l=NZ(r,t)?pa.LOCKED:pa.ADJUST;if(!t.zoomFactor){n.scale=LZ(e,t),n.scale==null&&(To(i,tn,e.renderSpatialReference),Nbe(a.frustum,tn)?n.scale=uw(e,Er(a.eye,tn),i.latitude):n.scale=g2e(e,a));const p=new RE(s);u2e(e,n.targetGeometry,n.scale,r,l,p),n.camera=await p.resolver.promise}return n}function Ndt(e,t,i,r){const s=Fw(e);return ke(KD,s.viewForward),XN(e,s.eye,KD,s.up,CU),i.position=new Gt(t.position),i.heading=t.heading!=null?t.heading:CU.heading,i.tilt=t.tilt!=null?t.tilt:CU.tilt,FZ(e,null,i,r)}async function Fdt(e,t,i,r,s){const n=Fw(e);return FH(e,t,Sv(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function kdt(e,t,i,r,s,n){n.targetGeometry=i.clone();const a=Fw(e);jS(e,a,r);const l=NZ(r,t)?pa.LOCKED:pa.ADJUST,p=new RE(s);return DM(e,i,r.heading,r.tilt,l,p),n.camera=await p.resolver.promise,n}function Udt(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=wp(e.elevationProvider,i)),ze(tn,i.x,i.y,n),kp(e.spatialReference,tn,vle,e.renderSpatialReference),md(GP,vle),gd(GP,GP),jr(RA);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let P=0;P<a.length;P++){const $=a[P];let k=r[$[2]];isFinite(k)||(k=n),ze(tn,r[$[0]],r[$[1]],k),Ho(tn,e.spatialReference,tn,e.renderSpatialReference),u0(RA,Gc(tn,tn,GP))}const l=Aw(RA),p=Gv(RA),y=Cw(RA),b=1/Math.tan(t.fovX/2),x=1/Math.tan(t.fovY/2),A=.5*Math.sqrt(l*l+y*y)*Math.max(x,b)+.5*p,M=.5*p*x+.5*Math.max(l,y);return Math.max(A,M)/s}async function zdt(e,t,i,r,s,n,a,l){l.targetGeometry=i.clone();const p=Fw(e),y=Udt(e,p,i,r,s);jS(e,p,n);const b=NZ(n,t)?pa.LOCKED:pa.ADJUST;l.scale=uw(e,y,l.targetGeometry.latitude);const x=new RE(a);return u2e(e,l.targetGeometry,l.scale,n,b,x),l.camera=await x.resolver.promise,l}function Bdt(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function I_(e){return e&&L(e.camera)&&(e.rotation=N8(e.camera.heading)),e}function Vdt(e,t){const i=Mdt;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const tn=Q(),vle=lt(),GP=zs(),RA=On(),Gdt=Mi(),KD=Q(),jP=Q(),AU=Q(),CU={heading:0,tilt:0},Lh=new Gt,jdt={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(ze(i,e.xmin,e.ymin,e.zmin)),t(ze(i,e.xmax,e.ymin,e.zmin)),t(ze(i,e.xmin,e.ymax,e.zmin)),t(ze(i,e.xmax,e.ymax,e.zmin)),t(ze(i,e.xmin,e.ymin,e.zmax)),t(ze(i,e.xmax,e.ymin,e.zmax)),t(ze(i,e.xmin,e.ymax,e.zmax)),t(ze(i,e.xmax,e.ymax,e.zmax))):(t(ze(i,e.xmin,e.ymin,i[2])),t(ze(i,e.xmax,e.ymin,i[2])),t(ze(i,e.xmin,e.ymax,i[2])),t(ze(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(ze(i,r[s+0],r[s+1],r[s+2]))}};class Hdt{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const a=new AbortController;L(this.options.signal)&&ka(this.options.signal,()=>{this.abort()}),this.abortController=a,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(rr());break;case"wait-for-animation-finish":!t&&L(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(rr())}}waitForReady(){this.state="wait-for-ready",this.view.ready?this.createViewPoint():xge(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},t=>{this.reject(t)})}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,Pdt(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!J(i))if(this.options.animate){if(J(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof oh&&this.target.camera||this.target instanceof sh),r=t.camera;if(J(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,a=n&&n.spatialReference,l=a?a.wkid:"none",p=this.view.spatialReference.wkid;return this.reject(new Se("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${p})`,{camera:r})),null}const s=Bm(this.view,r);return J(s)?(this.reject(new Se("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(J(r))return void this.reject(new Se("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||J(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new hT({view:this.view,desiredCamera:t.camera}),AE(this.view,t.camera,ad.EYE_AND_CENTER)):sn(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const l=this.view.state.cameraController;s&&(l&&l.active?l instanceof ng&&L(l.viewAnimation)&&l.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):L(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},a=l=>{if(!J(this.view.state))switch(i.state){case xs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case xs.Ready:case xs.Rejected:case xs.Running:case xs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(l)}}};r.when(n,l=>a(l)),i.asyncResult={resolve:()=>a(),reject:l=>a(l)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof ng&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new ng({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(L(i)&&i.stop(),this.reject(new Se("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const yu=Ge.getLogger("esri.views.3d.state.ViewStateManager");let Ea=class extends st{constructor(e){super(e),this.propertiesPool=new zv({frustum:Ny},this),this.handles=new Ei,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this.updateDevicePixelRatio=null,this.test={contentCameraResetState:new Map}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=jS(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Bm(this.view,e),{applyConstraints:!1})||yu.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=jS(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Bm(this.view,e);J(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=zl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([this.watch("contentCamera",()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),this.view.state.watch("camera",n=>{const a=wo(r,n.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():yu.error("#center=","Invalid center",e):yu.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):yu.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=uet(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return L(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||yu.error("#extent=","Invalid extent",e):yu.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):yu.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return uw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||yu.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[di.TOP]/i),n=Math.round(t[di.RIGHT]/i),a=Math.round(t[di.BOTTOM]/i),l=Math.round(t[di.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===a&&r.left===l?r:{top:s,right:n,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,HP),this.view.state.updateCamera(t=>t.padding=HP))}_paddingToArray(e,t,i){e?fl(i,e.top||0,e.right||0,e.bottom||0,e.left||0):fl(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return dd((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Odt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||yu.error("#viewpoint=","Invalid viewpoint",e);else{const t=L(e.camera)?e.camera.position:e.targetGeometry,i=L(t)&&t.spatialReference;yu.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else yu.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?f2e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||yu.error("#zoom=","Invalid zoom",e)}initialize(){this.handles.add([m0(this.view,"state.events","before-camera-change",e=>this._updateElevation(e.camera))]),L8e(this.view.state,"camera",e=>this._updateElevation(e),!0),this.handles.add(L2({prepare:()=>this._prepareFrame()})),this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0,this.handles.remove(qP)})),this.handles.add(m0(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new Cdt({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===vt.Local&&this.handles.add(xge(this.view.basemapTerrain,"ready",()=>{this.handles.remove(qP),this._setInitialView(this.view.dataExtent)}),qP)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(qP),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=ie({animate:!0},t);return L(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new Hdt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Fw(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){L(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Xdt){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(a=>e.add(a))}return t}_setInitialView(e){if(J(e)||this.cameraSetByUser)return;if(e instanceof sh)return void this.setStateCamera(Bm(this.view,e),{applyConstraints:!1});if(e instanceof oh){if(e.targetGeometry instanceof ki){const s=DM(this.view,e.targetGeometry,0,.5,pa.LOCKED);return void(L(s)&&this.setStateCamera(Bm(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=DM(this.view,e,0,.5,pa.LOCKED);L(t)&&this.setStateCamera(Bm(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Wdt.indexOf(e)!==-1&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!J(e)&&(e instanceof oh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof sh?this.isCompatible(e.position):e.spatialReference&&Mp(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Ydt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=C1){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=QR(this.view,r,s,e,t,pa.ADJUST);return J(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=DM(this.view,e,t,i,pa.ADJUST,Jdt);return L(r)?Bm(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=UJ(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(m2e(this.view,e))}_viewpointToCamera(e){return Bm(this.view,DZ(this.view,e))}setStateCamera(e,t){return!(J(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&sn(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new hT({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{container:e,canvas:t}=this.view;if(!e||!t)return;L(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();const i=this.view.pixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(C1.copyFrom(n),C1.pixelRatio!==i&&(this._paddingToArray(this.padding,i,HP),C1.padding=HP),C1.fullWidth=r,C1.fullHeight=s,C1.pixelRatio=i,this.view.state.camera=C1)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?HN(this.view,e.eye):0;e.relativeElevation=i-r}};_([S({type:sh,dependsOn:["view.state.camera","ready"]})],Ea.prototype,"camera",null),_([S({type:sh,dependsOn:["view.state.contentCamera","ready"]})],Ea.prototype,"contentCamera",null),_([S({type:Gt})],Ea.prototype,"center",null),_([S({type:ki})],Ea.prototype,"extent",null),_([S({readOnly:!0})],Ea.prototype,"frustum",null),_([S({readOnly:!0})],Ea.prototype,"hasInitialView",null),_([S({readOnly:!0,type:Boolean})],Ea.prototype,"ready",void 0),_([S({type:Number})],Ea.prototype,"scale",null),_([S()],Ea.prototype,"padding",null),_([S({readOnly:!0})],Ea.prototype,"screenCenter",null),_([S({constructOnly:!0})],Ea.prototype,"view",void 0),_([S({type:oh})],Ea.prototype,"viewpoint",null),_([S({type:Number})],Ea.prototype,"zoom",null),_([S({constructOnly:!0})],Ea.prototype,"updateDevicePixelRatio",void 0),Ea=_([re("esri.views.3d.state.ViewStateManager")],Ea);const qdt=Ea,Wdt=["camera","viewpoint","extent","scale","center","zoom"],Xdt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Ydt={heading:0,tilt:0},Jdt=new sh,C1=new br,HP=nr(),qP="pending-initial-view";class Zdt{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new Ci,this.tolerance=VS,this.tmpRay=ua(),this.validateHUDIntersector=_d(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i){return this.intersectRay(this._getPickRay(t,this.tmpRay),_le(this.viewingMode),i)}intersectScreenFreePointFallback(t,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i)}intersectRayFreePointFallback(t,i){return this.intersectRay(t,_le(this.viewingMode),i)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=ma.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(YP,r,s),YP[0]+=.0466,YP[1]-=.0123,IJ(t,YP,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||$0(s)&&s.intersector!==Ts.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=VS){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Ts.TERRAIN?1:r.type===Ts.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Ts.TERRAIN?1:r.type===Ts.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return Ube(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==vt.Local||J(t))return!1;const r=this.view.renderDataExtent;if(J(r))return Xe(i,t.origin,ot(Tt.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return Xe(i,t.origin,ot(Tt.get(),t.direction)),!0;const a=this.view.state.camera,l=Math.max(0,r.xmin-a.eye[0],a.eye[0]-r.xmax),p=Math.max(0,r.ymin-a.eye[1],a.eye[1]-r.ymax),y=Math.sqrt(l*l+p*p),b=Math.abs(a.relativeElevation)+Number.MIN_VALUE,x=Math.max(0,Math.log(n/b))**2;let A=n/Math.max(1,x);A=Math.max(A,Math.min(y,n));const M=Ue(Tt.get(),t.direction,A/yt(t.direction));return Xe(i,t.origin,M),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(J(t))return null;const n=L(i)?i.mode:"absolute-height",a=L(i)?Wt(i.offset,0):0,l=n!=="on-the-ground"?a+r:0,p=l/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,l,XP)){const G=this.view.computeMapPointFromVec3d(XP);return G.z-=a,G}return null}const y=this.view.state.camera,b=Tt.get();y.projectToRenderScreen(t.origin,b);const x=new ble(null,this._forEachLayer),A=this.view.slicePlane,M=L(A)?Cne(A):null,P=_d(this.viewingMode);P.options.store=ma.MIN,P.options.verticalOffset=p;const $=t.origin,k=Xe(Tt.get(),$,t.direction);P.reset($,k,y),P.point=b;const z=L(s)?"type"in s&&s.type==="graphics"?G=>G.metadata.layerUid!==s.uid:G=>G.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const G=B=>(J(z)||z(B))&&B.metadata&&B.metadata.isElevationSource;P.intersect(x.layers,b,this.tolerance,null,G),this.externalIntersectionHandlers.forAll(B=>{if(B.type===Ts.I3S||B.type===Ts.TERRAIN){const W=B.slicePlaneEnabled?M:null;B.intersect(P,W,P.rayBegin,P.rayEnd,b)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(G=>{if(G.isGround){const B=G.slicePlaneEnabled?M:null;G.intersect(P,B,P.rayBegin,P.rayEnd,b)}})}if(P.results.min.getIntersectionPoint(XP)){const G=this.view.computeMapPointFromVec3d(XP);return G.z=r,G}return null}computeIntersection(t,i,r){if(J(t))return;const s=this.view.state.camera,n=Tt.get();s.projectToRenderScreen(t.origin,n);const a=new ble(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=t.origin,p=Xe(Tt.get(),t.origin,t.direction);i.reset(l,p,s),i.intersect(a.layers,n,this.tolerance);const y=this.view.slicePlane,b=L(y)?Cne(y):null;i.intersect(a.sliceableLayers,n,this.tolerance,b);const x=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(P=>{if(i.options.isFiltered=!a.filterLayerUid(P.layerUid),P.isGround&&x||!i.options.isFiltered){const $=P.slicePlaneEnabled?b:null;P.intersect(i,$,l,p,n)}});const A=Tt.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(A)){const P=this.view.basemapTerrain.overlayManager.renderer,$=this.view.renderCoordsHelper.spatialReference,k=Tt.get();this.view.renderCoordsHelper.fromRenderCoords(A,k,this.view.spatialReference),k[2]=Wt(this.view.elevationProvider.getElevation(A[0],A[1],A[2],$,"ground"),0),P.intersect(i,k,i.results.ground,z=>a.filterRenderGeometry(z))}i.sortResults();const M=i.results.hud;if(wJ(M)){const P=Tt.get(),$=Tt.get(),k=Tt.get();this._unprojectHUDResultRay(M.target.center,P,$,k);const z=Er(M.target.center,$)/Er($,k)*.99;this.validateHUDIntersector.reset($,k,s),this.validateHUDIntersector.intersect(a.layers,P,this.tolerance),this.validateHUDIntersector.intersect(a.sliceableLayers,P,this.tolerance,b),this.externalIntersectionHandlers.forAll(B=>{if(!a.filterLayerUid(B.layerUid))return;const W=B.slicePlaneEnabled?b:null;B.intersect(this.validateHUDIntersector,W,$,k,P)});const G=this.validateHUDIntersector.results.min;(G.dist==null||z<=G.dist)&&(i.results.min.copy(M),i.results.all.splice(0,0,M))}}_unprojectHUDResultRay(t,i,r,s){const n=this.view.state.camera;n.projectToRenderScreen(t,i);const a=Tt.get();a[0]=i[0],a[1]=i[1],a[2]=0,n.unprojectFromRenderScreen(a,r),a[2]=1,n.unprojectFromRenderScreen(a,s)}}let WP;function _le(e){return WP&&WP.viewingMode===e||(WP=_d(e)),WP}class ble{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return J(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function wle(e){return typeof e=="object"&&"intersect"in e}const XP=Q(),YP=ca();class XSt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Kdt{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=qe(ie({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(ii.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,a)=>{const l={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:a},signal:r};this._queries.push(l),ka(r,()=>{Iq(this._queries,l),a(rr())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(y=>y.result.reject());const r=t.map(y=>[y.x,y.y]),s=t.reduce((y,b)=>Math.min(y,b.minDemResolution),1/0),n=new Bv({points:r,spatialReference:this.spatialReference}),a=t.length>1&&t.some(y=>!!y.signal)?new AbortController:null,l=L(a)?a.signal:t[0].signal;if(L(a)){let y=0;t.forEach(b=>ka(b.signal,()=>{y++,b.result.reject(rr()),y===t.length&&a.abort()}))}const p=qe(ie({},this._queryOptions),{minDemResolution:s,signal:l});i.queryElevation(n,p).then(y=>{t.forEach((b,x)=>{L(b.signal)&&b.signal.aborted?b.result.reject(rr()):b.result.resolve(y.geometry.points[x][2])})}).catch(y=>{t.forEach(b=>b.result.reject(y))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let JC=class extends ps.EventedMixin(st){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=Ht(this._elevationQuery)}get elevationQuery(){return J(this._elevationQuery)&&(this._elevationQuery=new Kdt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&t===a.y&&i===a.z&&r.equals(a.spatialReference)&&s===a.queryContext)return a.result}let n=null;return n=JP(n,this.im,e,t,i,r,s),J(n)&&(n=JP(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=JP(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,a=0){const l=bg();return this.elevationQuery.queryElevation(e,t,n,a).then(p=>{s==="scene"&&(p=JP(p,this.scene,e,t,i,r,s)),l.resolve(p)}).catch(p=>{Cs(p)?l.reject(p):l.resolve(this.getElevation(e,t,i,r,s))}),l.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function JP(e,t,i,r,s,n,a){for(const l of t){const p=l.getElevation(i,r,s,n,a);L(p)&&(e=L(e)?Math.max(p,e):p)}return e}_([S({constructOnly:!0})],JC.prototype,"view",void 0),_([S({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],JC.prototype,"spatialReference",void 0),JC=_([re("esri.views.3d.support.CombinedElevationProvider")],JC);class sv{static isValidProfile(t){return t in sv.profiles}static getDefaultProfile(){return je("trident")||je("esri-iPhone")?"low":"medium"}static apply(t,i){const r=sv.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function xle(){const e=!!je("esri-mobile"),t=!!je("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!je("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!je("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}sv.debug={reset(){const e=xle();for(const t in e)sv.profiles[t]=e[t]}},function(e){e.profiles=xle()}(sv||(sv={}));const v$=sv;function kZ(){return new Float32Array(4)}function Qdt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sc(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function ept(e,t){return new Float32Array(e,t,4)}function C3e(){return kZ()}function M3e(){return sc(1,1,1,1)}function R3e(){return sc(1,0,0,0)}function O3e(){return sc(0,1,0,0)}function P3e(){return sc(0,0,1,0)}function I3e(){return sc(0,0,0,1)}const tpt=C3e(),ipt=M3e(),rpt=R3e(),spt=O3e(),npt=P3e(),opt=I3e();Object.freeze({__proto__:null,create:kZ,clone:Qdt,fromValues:sc,createView:ept,zeros:C3e,ones:M3e,unitX:R3e,unitY:O3e,unitZ:P3e,unitW:I3e,ZEROS:tpt,ONES:ipt,UNIT_X:rpt,UNIT_Y:spt,UNIT_Z:npt,UNIT_W:opt});let If=class extends st{constructor(){super(...arguments),this.color=new Ft([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Ft([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Ft.toUnitRGBA(e.color),i=L(e.haloColor)?Ft.toUnitRGBA(e.haloColor):t,r=Ft.toUnitRGBA(e.shadowColor);return{color:sc(t[0],t[1],t[2],t[3]),haloColor:sc(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:sc(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};_([S({type:Ft})],If.prototype,"color",void 0),_([S({type:Ft})],If.prototype,"haloColor",void 0),_([S()],If.prototype,"haloOpacity",void 0),_([S()],If.prototype,"fillOpacity",void 0),_([S()],If.prototype,"shadowOpacity",void 0),_([S({type:Ft})],If.prototype,"shadowColor",void 0),_([S()],If.prototype,"shadowDifference",void 0),If=_([re("esri.views.3d.support.HighlightOptions")],If);const kH=If;function YSt(e){return{geometryType:Vv(e[0]),geometries:e.map(t=>t.toJSON())}}function apt(e,t,i){const r=Nfe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let Ab=class extends Ye{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(function(r){return r.toJSON()}),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Vv(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};_([S()],Ab.prototype,"geometries",void 0),_([S({json:{read:{source:"outSR"}}})],Ab.prototype,"outSpatialReference",void 0),_([S()],Ab.prototype,"transformation",void 0),_([S()],Ab.prototype,"transformForward",void 0),Ab=_([re("esri.rest.support.ProjectParameters")],Ab);const UZ=Ab,lpt=Ys(UZ);async function $3e(e,t,i){t=lpt(t);const r=lu(e),s=ie(qe(ie({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,a=Vv(t.geometries[0]),l=qFe(s,i);return Ar(r.path+"/project",l).then(({data:{geometries:p}})=>apt(p,a,n))}async function zZ(e=null,t){var i,r;if(qr.geometryServiceUrl)return qr.geometryServiceUrl;if(!e)throw new Se("internal:geometry-service-url-not-configured");let s;s="portal"in e?e.portal||ha.getDefault():e,await s.load({signal:t});const n=(i=s.helperServices)==null||(r=i.geometry)==null?void 0:r.url;if(!n)throw new Se("internal:geometry-service-url-not-configured");return n}async function cpt(e,t,i=null,r){const s=await zZ(i,r),n=new UZ;n.geometries=[e],n.outSpatialReference=t;const a=await $3e(s,n,{signal:r});if(a&&Array.isArray(a)&&a.length===1)return a[0];throw new Se("internal:geometry-service-projection-failed")}var hpt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:zZ,projectGeometry:cpt});class upt{constructor(t,i){this.spatialReference=i,this.unitInMeters=lh(this.spatialReference,ir(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=zZ(t&&t.get("portalItem")).catch(()=>{throw new Se("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(p=>p instanceof Gt?p:new Gt(p,this.spatialReference)),a=new UZ({geometries:n,outSpatialReference:It.WGS84}),l=(await $3e(i,a)).map(p=>p.type==="point"?[p.x,p.y]:void 0);return s?l:l[0]}}let zf=class extends st{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};_([S()],zf.prototype,"minTotalNumberOfFeatures",void 0),_([S()],zf.prototype,"maxTotalNumberOfFeatures",void 0),_([S()],zf.prototype,"maxTotalNumberOfPrimitives",void 0),_([S()],zf.prototype,"snapshotAvailable",void 0),_([S()],zf.prototype,"polygonLodFactor",void 0),_([S()],zf.prototype,"polylineLodFactor",void 0),zf=_([re("esri.views.3d.support.QualitySettings.Graphics3DSettings")],zf);let s0=class extends st{constructor(){super(...arguments),this.lodFactor=1}};_([S()],s0.prototype,"lodFactor",void 0),s0=_([re("esri.views.3d.support.QualitySettings.LoDFactorSettings")],s0);let QD=class extends s0{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};QD=_([re("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],QD);let Gm=class extends st{constructor(){super(...arguments),this["3dObject"]=new QD,this.point=new s0,this.integratedMesh=new s0,this.pointCloud=new s0,this.uncompressedTextureDownsamplingEnabled=!1}};_([S({type:QD})],Gm.prototype,"3dObject",void 0),_([S({type:s0})],Gm.prototype,"point",void 0),_([S({type:s0})],Gm.prototype,"integratedMesh",void 0),_([S({type:s0})],Gm.prototype,"pointCloud",void 0),_([S()],Gm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Gm=_([re("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Gm);let My=class extends st{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};_([S()],My.prototype,"lodBias",void 0),_([S()],My.prototype,"angledSplitBias",void 0),_([S()],My.prototype,"reduceTileLevelDifferences",void 0),_([S()],My.prototype,"textureFadeDuration",void 0),My=_([re("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],My);let uT=class extends st{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};_([S()],uT.prototype,"pixelRatio",void 0),_([S()],uT.prototype,"maxTotalNumberOfFeatures",void 0),uT=_([re("esri.views.3d.support.QualitySettings.HeatmapSettings")],uT);let $l=class extends st{constructor(){super(...arguments),this.graphics3D=new zf,this.sceneService=new Gm,this.tiledSurface=new My,this.heatmap=new uT,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};_([S({type:zf})],$l.prototype,"graphics3D",void 0),_([S({type:Gm})],$l.prototype,"sceneService",void 0),_([S({type:My})],$l.prototype,"tiledSurface",void 0),_([S({type:uT})],$l.prototype,"heatmap",void 0),_([S()],$l.prototype,"antialiasingEnabled",void 0),_([S()],$l.prototype,"physicallyBasedRenderingEnabled",void 0),_([S()],$l.prototype,"highQualityTransparency",void 0),_([S()],$l.prototype,"memoryLimit",void 0),_([S()],$l.prototype,"additionalCacheMemory",void 0),_([S()],$l.prototype,"frameRate",void 0),_([S()],$l.prototype,"maximumRenderResolution",void 0),_([S()],$l.prototype,"maximumPixelRatio",void 0),$l=_([re("esri.views.3d.support.QualitySettings.QualitySettings")],$l);const Tle=$l;class eL{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=u8e(s)}set extent(t){t&&d8e(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return b8e(this.coordinateSystem,t)}setAltitude(t,i,r=t){return gge(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){w8e(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return g8e(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return y8e(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Jh.X,Tt.get()),s=this.worldBasisAtPosition(t,Jh.Y,Tt.get()),n=this.worldBasisAtPosition(t,Jh.Z,Tt.get());return C0(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return e7(this.coordinateSystem,i,this._coordinateSystem),_8e(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){e7(this.coordinateSystem,i,this._coordinateSystem);const s=Tt.get();return v8e(this._coordinateSystem,t,s)?ke(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===vt.Global)return this.intersectManifold(t,i,r);e7(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=Tt.get();return Ow(s.plane,t,n)?ke(r,n):null}toRenderCoords(t,i,r){return uD(t)?To(t,i,this.spatialReference):Ho(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return uD(i)?(L(r)&&(i.spatialReference=r),mme(t,this.spatialReference,i)):i instanceof It?Sv(t,this.spatialReference,i):Ho(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case vt.Local:return new eL(vt.Local,i,lh(i),m8e());case vt.Global:return new eL(vt.Global,i,1,f8e(i))}}static renderUnitScaleFactor(t,i){return Sle(t)/Sle(i)}}function Sle(e){if(GS(e,vt.Global))return 1;const t=yge(!1,e);return lh(t)}var Yf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Yf||(Yf={}));const dpt=(()=>{const e=new Array;return e[Yf.ELEVATION]=10,e[Yf.BASEMAP]=10,e[Yf.I3S_INDEX]=10,e[Yf.I3S_DATA]=10,e[Yf.SYMBOLOGY]=5,e})(),ppt=30;function D3e(e){return typeof e.getUsedMemory=="function"}const fpt=Ge.getLogger("esri.views.3d.support.MemoryController");function mpt(e){return new vpt(e)}const ZP=1,MU=1,gpt=.75,ypt=.6,Ele=1.3;class vpt{constructor(t){this._view=t,this.events=new ps,this.minQuality=.1,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryUsed=0,this._memoryPredicted=0,this._cacheStorage=new EY,this._numQualityChanges=0,this._updating=!1}destroy(){this.events=null,this._cacheStorage.destroy()}newCache(t,i){return new sVe(t,this._cacheStorage,i)}set maxMemory(t){t!=null&&t>0&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<t&&this._updateQuality(ZP),this._maxMemory=t)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(t){t!=null&&t>=0&&(this._additionalCacheMemory=t)}disableMemCache(){this._additionalCacheMemory=-4096}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}resetStableQuality(){this._stableQuality=0}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let t=this._layersUpdating();if(this._memoryPredicted<ypt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(ZP);else if(t)(this._memoryPredicted>1.1*MU||this._memoryUsed>MU)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Ele),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>MU)this._stableQuality=0,this._canFastRecover=!1,t=this._updateQuality(this._quality/Ele),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<gpt&&this._quality<ZP){this._stableQuality=this._quality;const i=.05;t=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this.updating!==t&&(this._updating=t,this.events.emit("updating-changed",this.updating))}_updateQuality(t){return(t=Math.min(Math.max(t,this.minQuality),ZP))!==this._quality&&(this._quality=t,this.events.emit("quality-changed",this._quality),++this._numQualityChanges,!0)}_layersUpdating(){return this._view.allLayerViews.some(t=>!!t.updating)}_updateMemory(){let t=0,i=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(t+=this._view.basemapTerrain.getUsedMemory());const r=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;L(r)&&(t+=r.usedMemory),this._view.allLayerViews&&this._view.allLayerViews.forEach(l=>{if(D3e(l)){const p=l.ignoresMemoryFactor()?this._quality:1;t+=l.getUsedMemory()*p,i+=l.getUnloadedMemory()*p}});const s=this._warnMemoryUsage==null||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),n=1048576*this._maxMemory;if(t>n&&s){this._warnMemoryUsage=t;const l=y=>(y/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",p=Math.round(100*this._quality);fpt.warn(`Memory Limit exceeded! Limit: ${l(n)} Current: ${l(t)} Projected: ${l(t+i)} Quality: ${p}%`)}this._memoryUsed=t/n,this._memoryPredicted=(t+i)/n;const a=n-t;this._cacheStorage.maxSize=Math.max(0,a+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)}get test(){const t=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=t._numQualityChanges;return t._numQualityChanges=0,i}}}}class _pt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class bpt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new wpt}}class wpt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class xpt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new bpt(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Kt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let _$=class extends st{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new xpt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(ii.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=_o(this._frameTask),this._tasks.forEach(e=>Ql(e.abortController)),this._loadQueue=Ht(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=bg();s.__signal=L(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return ka(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const a=new Ept(e,t,i,r,s);return this._updateTask(a,n),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,t){gL(e.resolvers,t),t.reject(rr()),e.resolvers.length===0&&(e.status===Uu.DOWNLOADING&&(e.status=Uu.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=Uu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=Apt(L(r)&&r.uid||e,t,i),a=this._tasks.get(n);return a?(this._updateTask(a,s),a):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(Kt(e.status===Uu.DOWNLOADING),e.status=Uu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Gi(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Uu.DOWNLOADED&&(t.err=t.err||rr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Cs(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Cs(t)?r.reject(t):r.reject(new Se("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:Fe(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Uu.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Uu.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Ar(e.url,qe(ie({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const a=p=>{e.duration=performance.now()-e.startTime,e.size=p instanceof ArrayBuffer?p.byteLength:e.size||0,e.result=p,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},l=p=>{e.status===Uu.DOWNLOADING&&t(e,p),n()};return e.docType!=="image+type"?(e.request.then(p=>a(p.data),l),!0):(e.request.then(p=>{const y=p.data,b=Spt(y);if(r="image",e.size=y.byteLength,b==="unknown")return e.request=Ar(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(M=>a(M.data),l);const x=new Blob([y],{type:b}),A=window.URL.createObjectURL(x);n=()=>window.URL.revokeObjectURL(A),e.request=Ar(A,{responseType:r,timeout:i,signal:s}),e.request.then(M=>a(new pO(M.data,b,n)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};_([S({readOnly:!0})],_$.prototype,"updating",void 0),_$=_([re("esri.views.3d.support.StreamDataLoader")],_$);const Tpt={numRetries:0};function Spt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class pO{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class Ept extends _pt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Uu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Tpt.numRetries}}function Apt(e,t,i){return`${e}:${t}:${i}`}var Uu;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Uu||(Uu={}));let KP=class extends st{constructor(){super(...arguments),this.updating=!1}};function Cpt(e,t=()=>performance.now()){return new UH.ResourceController({view:e,now:t})}var UH;_([S({readOnly:!0})],KP.prototype,"updating",void 0),KP=_([re("esri.views.3d.support.ResourceController")],KP),function(e){let t=class extends KP{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._cameraChangeTime=0,this._handles=new Ei,this._frameTask=null,this._scheduleTask=AS,this._state=po.IDLE}initialize(){this._cameraChangeTime=this.now(),this._scheduler=vWe(this.now),this._memoryController=mpt(this.view),this._streamDataLoader=new _$,this._streamDataLoader.setup(ppt,dpt,this._scheduler),this._handles.add([this.view.watch("state.camera",(r,s)=>this._cameraChangedHandler(r,s),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]),this._frameTask=L2({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(ii.RESOURCE_CONTROLLER)}destroy(){this._handles=Ht(this._handles),this._scheduleTask.remove(),this._frameTask=_o(this._frameTask),this._streamDataLoader=Ht(this._streamDataLoader),this._memoryController=Ht(this._memoryController),this._scheduler=Ht(this._scheduler)}get updating(){var r,s;return!!((r=this._memoryController)!=null&&r.updating||(s=this._streamDataLoader)!=null&&s.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,a,l)=>s.request(n,a,r,l),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(mue(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=this._scheduler.now,this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=po.ANIMATING:this.view.interacting?this._state=po.INTERACTING:(this._state===po.ANIMATING&&(this._cameraChangeTime=0),this._scheduler.now-this._cameraChangeTime<=i?this._state=po.INTERACTING:this._state=po.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};_([S({constructOnly:!0})],t.prototype,"view",void 0),_([S({constructOnly:!0})],t.prototype,"now",void 0),_([S()],t.prototype,"_scheduler",void 0),_([S()],t.prototype,"_memoryController",void 0),_([S()],t.prototype,"_streamDataLoader",void 0),_([S({readOnly:!0})],t.prototype,"updating",null),t=_([re("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(UH||(UH={}));function Mpt(e){return"performanceInfo"in e}const xx=Q(),Rpt=Q(),Z0=Q(),K0=Q();function Opt(e,t,i=0){const r=e.extent;if(J(r))return!1;if(i===0)return QW(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return d6e(r,t,i*s)}function QP(e,t,i,r){ke(xx,i),xx[r]=t[r];const s=We(xx,xx,t),n=We(Rpt,e,t),a=rt(n,s),l=rt(s,s);let p;p=a<=0?t:l<=a?i:Xe(xx,t,Ue(s,s,a/l));const y=We(xx,e,p);return Math.PI/2-Math.atan(y[2]/Math.sqrt(y[0]*y[0]+y[1]*y[1]))}function Ppt(e,t,i){const r=e.extent;if(J(r))return 0;Z0[0]=r[0],Z0[1]=r[1],Z0[2]=i,K0[0]=r[2],K0[1]=r[3],K0[2]=i;let s=1/0,n=1/0;return t[0]<Z0[0]?s=QP(t,Z0,K0,0):t[0]>K0[0]&&(s=QP(t,K0,Z0,0)),t[1]<Z0[1]?n=QP(t,Z0,K0,1):t[1]>K0[1]&&(n=QP(t,K0,Z0,1)),Math.min(s,n)}function Ipt(e,t,i){if(J(e))return jY();if(e.spatialReference.isGeographic&&!J2(e.spatialReference))return new Se("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=gs.checkUnsupported(e);if(L(r))return r;const s=$pt(e,i);if(s)return s;const n=e.spatialReference;return t&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new Se("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function $pt(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],a=h0e(t),l=Mi();gs.computeRowColExtent(a,s,n,l);const p=(l[2]-l[0])*(l[3]-l[1]);if(p>Q3){const y=i[0].scale*2**i[0].level;let b=Math.max((a[3]-a[1])/e.size[1],(a[2]-a[0])/e.size[0])*y/r;const x=Math.floor(Math.log(b)/Math.log(10));return b=Math.ceil(b/10**x)*10**x,new Se("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+b.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:b,requiredNumRootTiles:p,allowedNumRootTiles:Q3})}return null}const Dpt=Object.freeze({__proto__:null,isInsideExtent:Opt,tiltToExtentEdge:Ppt,checkIfTileInfoSupportedForViewSR:Ipt});function Lpt(){return!0}function Npt(){return 0}function Fpt(e,t){if(J(e))return jY();const i=e.lods.length-1,r=e.spatialReference,s=J2(r)||S0(r)||E0(r);if(r.isWebMercator){if(!gs.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new Se("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new Se("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!gs.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new Se("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new Se("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t&&!e.spatialReference.equals(t)?new Se("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const kpt=Object.freeze({__proto__:null,isInsideExtent:Lpt,tiltToExtentEdge:Npt,checkIfTileInfoSupportedForViewSR:Fpt}),L3e={[vt.Global]:kpt,[vt.Local]:Dpt};function lp(e,t){e||console.warn("Terrain: "+t)}const Upt=1.2,zpt=80/180*Math.PI,Bpt=110/180*Math.PI;function Vpt(e,t,i){const r=L3e[e.viewingMode];let s;if(r.isInsideExtent(e,t))s=Wt(e.getElevation(t[0],t[1],t[1],e.spatialReference),0);else{if(!r.isInsideExtent(e,t,Upt))return 0;const a=e.getTileWithElevation(t[0],t[1],t[1],e.spatialReference);s=.5*((L(a)?a.elevationBounds[0]:e.elevationBounds.min)+(L(a)?a.elevationBounds[1]:e.elevationBounds.max));const l=r.tiltToExtentEdge(e,t,s);if(l>zpt&&l<Bpt)return 0}const n=t[2]-s;return Math.abs(n)<i?0:n<0?-1:1}function zH(e){return BZ(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function N3e(e){return(e==null?void 0:e.type)==="vector-tile"}function tL(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function BZ(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function F3e(e){return(e==null?void 0:e.type)==="tile-3d"}function iL(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function Gpt(e){return(e==null?void 0:e.type)==="wmts-3d"}function b$(e){return(e==null?void 0:e.type)==="elevation-3d"}function $T(e){return e&&(F3e(e)||BZ(e)||b$(e)||iL(e)||Gpt(e))}function jpt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return L(i)&&"type"in i&&i.type==="raster-tile"}function Hpt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return L(i)&&"type"in i&&i.type==="vector-tile"}function qpt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return L(i)&&"type"in i&&i.type==="tile-texture"}function Wpt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return i instanceof HTMLImageElement||i instanceof pO||i instanceof HTMLCanvasElement||i instanceof ImageData}function DT(e){return L(e)&&"release"in e&&e.release(),null}function Ale(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function F8(e,t,i,r){return L3e[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function k8(e,t,i){let r=null,s=null;if(R8e(e)){const n=Xpt(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=tL(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===vt.Local;if(tL(e))r=e.getCompatibleTileInfo(t,s,n);else if(N3e(e)){const a=n&&!Ypt(t)||Jpt.force512VTL,l=e.tileInfo.spatialReference.isGeographic;r=a?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,l?1:2)}else r=e.tileInfo}return L(r)&&L(s)&&F8(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function Xpt(e,t,i){const r=O8e(e);if(L(r)){if(!kt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>F8(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Ypt(e){return e.isWGS84||e.isWebMercator||dfe(e)||!tS(e)}const Jpt={force512VTL:!1};class Zpt{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=$T(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),Mpt(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class Kpt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*mS.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=L(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(D3e(s)||$T(s))&&this.layerPerformanceInfos.push(new Zpt(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class Qpt extends eT{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){Gi(r);const s=L(r)&&r.signal,n=this.makeUid(t,i);let a=this._textureRequests.get(n);if(!a){const l=new AbortController,p=this._streamDataRequester.request(t,"image",{uid:n,signal:l.signal});a={referenceCount:0,texture:null,textureAsync:null,abortController:l},this._textureRequests.set(n,a),a.textureAsync=p.then(async y=>{const b=this._createTexture(t,y,i);return a.texture=b,a.abortController=null,this._stage.add(b),await this._stage.load(b),{uid:n,texture:b,release:()=>this._release(n)}},y=>{throw a.abortController=null,y})}return a.referenceCount++,new Promise((l,p)=>{ka(s,()=>{p(rr())}),a.textureAsync.then(l,p)}).catch(l=>{throw this._release(n),l})}_createTexture(t,i,r){const s=qe(ie({},this._parameters),{powerOfTwoResizeMode:hv.PAD});if(_W(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new Sn(i,s)}}class eft{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Yf.SYMBOLOGY),this.textures=new Qpt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:ei.CLAMP_TO_EDGE,t:ei.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=ir(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=C2e(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=att(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return{remove(){}};this.graphicsOwners.push(t);const i="layer"in t?t.watch("layer.screenSizePerspectiveEnabled",()=>this._updateScreenSizePerspectiveEnabled()):null;return this._updateScreenSizePerspectiveEnabled(),{remove:()=>{i&&(i.remove(),gL(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled())}}}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>i.get("layer.screenSizePerspectiveEnabled")===!0);if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Ei;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",i,!0),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;eI.distance=t.centerOnSurfaceInfrequent.distance,eI.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(eI),this.screenSizePerspectiveSettingsLabels.update(eI),this.view._stage.renderView.requestRender()}}const eI={distance:0,fovY:0};class uy{constructor(t,i,r=""){this.graphics=t,this._symbol=new jy({symbolLayers:[new tg({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Mw({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(J(i))return;this.hide();const r=new Gt({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new gl({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){L(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Fy=class extends st{constructor(e){super(e),this.handles=new Ei}destroy(){this.handles.destroy()}};_([S({constructOnly:!0})],Fy.prototype,"renderCoordsHelper",void 0),_([S({constructOnly:!0})],Fy.prototype,"surface",void 0),_([S({constructOnly:!0})],Fy.prototype,"state",void 0),Fy=_([re("esri.views.3d.support.PointOfInterest")],Fy);const tft=Array;let $u=class extends Fy{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new zv({location:Gt,renderLocation:tft},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=Q(),this.tmpPoint=new Gt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(m0(this.map,"ground.layers","change",e,e,e))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Er(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return uw(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Cs(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(RU,this._estimatedSurfaceAltitude,this._camera.eye),jc(this._get("renderLocation"),RU)||this._set("renderLocation",ke(this._propertiesPool.get("renderLocation"),RU))}};_([S({constructOnly:!0})],$u.prototype,"scheduler",void 0),_([S({constructOnly:!0})],$u.prototype,"cache",void 0),_([S({constructOnly:!0})],$u.prototype,"task",void 0),_([S({constructOnly:!0})],$u.prototype,"cameraName",void 0),_([S({readOnly:!0})],$u.prototype,"location",null),_([S({constructOnly:!0})],$u.prototype,"map",void 0),_([S({readOnly:!0})],$u.prototype,"renderLocation",void 0),_([S({readOnly:!0})],$u.prototype,"scale",null),_([S({readOnly:!0})],$u.prototype,"updating",null),$u=_([re("esri.views.3d.support.CameraOnSurface")],$u);const RU=Q(),Cle=$u,ift=Array;let ip=class extends Fy{constructor(e){super(e),this._propertiesPool=new zv({location:Gt,renderLocation:ift},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=Q(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=_o(this._frameWorker),this._propertiesPool=Ht(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=sft;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=nft;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ke(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Er(this._camera.eye,e):(Ue(e,this._camera.viewForward,this._get("distance")),Xe(e,e,this._camera.eye)),jc(this._get("renderLocation"),e)||this._set("renderLocation",ke(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=ir(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=dl(i.eye),a=n<s*s,l=Er(i.eye,t);if(a&&l>r/4){const p=s-Math.sqrt(n);return Ue(t,i.viewForward,p),Xe(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;L(r)&&tN(r,this.surface.spatialReference,OA,this.renderCoordsHelper.spatialReference)&&(t[0]=Ot(t[0],OA[0],OA[2]),t[1]=Ot(t[1],OA[1],OA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(ur.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Er(i,e),s=Er(i,t);if(Math.abs(s-r)/r>rft)return!0}return!1}};_([S({constructOnly:!0})],ip.prototype,"scheduler",void 0),_([S({constructOnly:!0})],ip.prototype,"task",void 0),_([S({constructOnly:!0})],ip.prototype,"cameraName",void 0),_([S()],ip.prototype,"distance",void 0),_([S({constructOnly:!0})],ip.prototype,"estimateSurfaceAltitudeAtCenter",void 0),_([S({readOnly:!0})],ip.prototype,"location",null),_([S({readOnly:!0})],ip.prototype,"renderLocation",void 0),_([S()],ip.prototype,"updating",void 0),ip=_([re("esri.views.3d.support.CenterOnSurface")],ip);const rft=.05,sft=Q(),nft=Q(),OA=Mi(),tI=ip;class oft{constructor(t){this.handles=new Ei,this.events=new ps,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",aft)}}const aft={},lft=Array;let $f=class extends Fy{constructor(e){super(e),this._propertiesPool=new zv({location:Gt,renderLocation:lft},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("contentCamera",()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(ii.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Mle);const s=Math.max(0,(Math.acos(rt(Mle,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!WT(e,t)){const p=this._propertiesPool.get("renderLocation");ke(p,t),this._set("renderLocation",p)}return}const n=1-Ot(s/(.5*Math.PI),0,1),a=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Rle);const l=this._propertiesPool.get("renderLocation");Wn(l,t,Rle,a),e&&WT(e,l)||this._set("renderLocation",l)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(ca());if(i[1]=t.aboveGround?t.padding[di.BOTTOM]:t.fullHeight-t.padding[di.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,PA)){We(PA,PA,t.eye);const s=ot(PA,PA);if(this.renderCoordsHelper.intersectManifold(iu(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};_([S()],$f.prototype,"_dirty",void 0),_([S({constructOnly:!0})],$f.prototype,"scheduler",void 0),_([S({constructOnly:!0})],$f.prototype,"centerOnSurface",void 0),_([S({constructOnly:!0})],$f.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),_([S({readOnly:!0})],$f.prototype,"updating",null),_([S({readOnly:!0})],$f.prototype,"location",null),_([S({readOnly:!0})],$f.prototype,"renderLocation",void 0),$f=_([re("esri.views.3d.support.CenterOnSurface")],$f);const Mle=Q(),PA=Q(),Rle=Q(),cft=$f;let Pm=class extends st{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ei}get renderLocation(){if(!this.location)return null;const e=Q();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),m0(this,"surface.layers","change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||J(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=KW(this.surfaceView.extent),t=new Gt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Cs(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};_([S({constructOnly:!0})],Pm.prototype,"view",void 0),_([S({constructOnly:!0})],Pm.prototype,"cache",void 0),_([S({readOnly:!0,aliasOf:"view.map.ground"})],Pm.prototype,"surface",void 0),_([S({readOnly:!0,aliasOf:"view.basemapTerrain"})],Pm.prototype,"surfaceView",void 0),_([S({readOnly:!0})],Pm.prototype,"location",void 0),_([S({readOnly:!0})],Pm.prototype,"renderLocation",null),Pm=_([re("esri.views.3d.terrain.StableSurfaceCenter")],Pm);let Im=class extends st{constructor(){super(...arguments),this.handles=new Ei,this._tileGeometryUpdateExtent=pd(),this._tileGeometryUpdateSpatialReference=null,this.events=new ps,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ii.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=Ht(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",hft),pd(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,lv(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=uft,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,$_,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,D_,t),$_[0]<D_[0]?(r[0]=$_[0],r[2]=D_[0]):(r[0]=D_[0],r[2]=$_[0]),$_[1]<D_[1]?(r[1]=$_[1],r[3]=D_[1]):(r[1]=D_[1],r[3]=$_[1]),BL(r,e)}};_([S({constructOnly:!0})],Im.prototype,"state",void 0),_([S({constructOnly:!0})],Im.prototype,"centerOnSurfaces",void 0),_([S({constructOnly:!0})],Im.prototype,"renderCoordsHelper",void 0),_([S({constructOnly:!0})],Im.prototype,"scheduler",void 0),_([S({constructOnly:!0})],Im.prototype,"surface",void 0),_([S({readOnly:!0})],Im.prototype,"updating",void 0),Im=_([re("esri.views.3d.support.SurfaceGeometryUpdates")],Im);const hft={},$_=Q(),D_=Q(),uft=pd();let rl=class extends st{constructor(e){super(e),this._handles=new Ei,this._tmpRay=ua(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new zv({renderPointOfView:dft},this),this.renderPointOfView=Q(),this._pois=new Array,this._debugCenters=new Map}initialize(){var e;const{state:t,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=_d(t.viewingMode),t.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ma.MIN,this._contentIntersector=_d(t.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,l=(e=this.view.basemapTerrain)==null?void 0:e.elevationQueryCache,p={state:t,scheduler:a,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new tI(qe(ie({},p),{task:ii.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("centerOnSurfaceFrequent",new tI(qe(ie({},p),{task:ii.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("contentCenterOnSurface",new tI(qe(ie({},p),{task:ii.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n,cameraName:"contentCamera"}))),this._set("centerOnContent",new tI(qe(ie({},p),{task:ii.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new Cle(qe(ie({},p),{cache:l,task:ii.POINT_OF_INTEREST_INFREQUENT,map:s}))),this._set("contentCameraOnSurface",new Cle(qe(ie({},p),{cache:l,task:ii.POINT_OF_INTEREST_INFREQUENT,map:s,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new Im(qe(ie({},p),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new oft({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Pm({cache:l,view:this.view})),this._set("focus",new cft({state:t,scheduler:a,surface:i,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(b,x)=>this._estimateSurfaceIntersectionAtRenderPoint(b,this.view.state.contentCamera,x)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const y=this.view.graphics;this._debugCenters.set(this.centerOnContent,new uy(y,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new uy(y,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new uy(y,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new uy(y,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new uy(y,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new uy(y,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new uy(y,"green","Focus")),this._handles.add([t.watch("camera",b=>this._cameraChanged(b),!0),i.watch("extent",()=>this._updateCenterPointsOfInterest()),W6(i,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),Pi(ur,"SHOW_POI",b=>this._setDebug(b))]),this._cameraChanged(this.view.state.camera);for(const b of this._pois)b.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!!((e=this.surfaceGeometryUpdates)!=null&&e.updating||this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return J(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Tx,fft)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Tx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(J(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=Xe(Tx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Tx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Tx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=IJ(t,e,pft);if(J(r))return null;const s=r.origin,n=Xe(Tx,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;jc(this.renderPointOfView,t)||this._set("renderPointOfView",ke(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(Pi(t,"renderLocation",i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference)),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};_([S({readOnly:!0})],rl.prototype,"centerOnContent",void 0),_([S({readOnly:!0})],rl.prototype,"centerOnSurfaceFrequent",void 0),_([S({readOnly:!0})],rl.prototype,"centerOnSurfaceInfrequent",void 0),_([S({readOnly:!0})],rl.prototype,"contentCenterOnSurface",void 0),_([S({readOnly:!0})],rl.prototype,"cameraOnSurface",void 0),_([S({readOnly:!0})],rl.prototype,"contentCameraOnSurface",void 0),_([S({readOnly:!0})],rl.prototype,"focus",void 0),_([S({readOnly:!0})],rl.prototype,"renderPointOfView",void 0),_([S({readOnly:!0})],rl.prototype,"surfaceOrigin",void 0),_([S({readOnly:!0})],rl.prototype,"contentGeometryUpdates",void 0),_([S({readOnly:!0})],rl.prototype,"surfaceGeometryUpdates",void 0),_([S({constructOnly:!0})],rl.prototype,"view",void 0),_([S({readOnly:!0})],rl.prototype,"updating",null),rl=_([re("esri.views.3d.support.PointsOfInterest")],rl);const dft=Array,Tx=Q(),pft=ua(),fft={exclude:new Set([Yb])},k3e=rl;class mft{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const gft=Ge.getLogger("esri.core.workers.WorkerHandle");class U3e{constructor(t,i,r,s={}){this._mainMethod=i,this._listeners=[],this._promise=V0e(t,qe(ie({},s),{schedule:r})).then(n=>{if(this._thread===void 0){this._thread=n,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else n.close()}),this._promise.catch(n=>gft.error(`Failed to initialize ${t} worker: ${n}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Hp(()=>{r.removed=!0,Iq(this._listeners,r),this._thread&&L(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this.getTransferList(i,t);return this._thread.invoke(t,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(Gi(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Ole extends U3e{constructor(t=null){super("LercWorker","_decode",t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}getTransferList(t){return[t.buffer]}release(){--this.ref<=0&&(qM.forEach((t,i)=>{t===this&&qM.delete(i)}),this.destroy())}}const qM=new Map;function yft(e=null){let t=qM.get(e);return t||(L(e)?(t=new Ole(i=>e.schedule(i)),qM.set(e,t)):(t=new Ole,qM.set(null,t))),++t.ref,t}function yg(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function z3e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function vft(e,t,i,r,s,n,a,l,p){const y=new Float32Array(9);return y[0]=e,y[1]=t,y[2]=i,y[3]=r,y[4]=s,y[5]=n,y[6]=a,y[7]=l,y[8]=p,y}function _ft(e,t){return new Float32Array(e,t,9)}Object.freeze({__proto__:null,create:yg,clone:z3e,fromValues:vft,createView:_ft});var Ple,Fc,Ile,$le,Dle;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(Ple||(Ple={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Fc||(Fc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Ile||(Ile={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}($le||($le={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Dle||(Dle={}));class bft{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class JSt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function ZSt(e,t,i,r,s,n){const a=i-s;if(a>=0)return(t>>a)+(r-(n<<a))*(e>>a);const l=-a;return t-(n-(r<<l))*(e>>l)<<l}class KSt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function wft(e,t,i,r,s,n){const a=t[r++];for(let l=0;l<a;l++){const p=new bft(n);p.xTile=t[r++],p.yTile=t[r++],p.hash=t[r++],p.priority=t[r++];const y=t[r++];for(let A=0;A<y;A++){const M=t[r++],P=t[r++],$=t[r++],k=t[r++],z=!!t[r++],G=t[r++],B=i[r++],W=i[r++],q=t[r++],X=t[r++];p.colliders.push({xTile:M,yTile:P,dxPixels:$,dyPixels:k,hard:z,partIndex:G,width:q,height:X,minLod:B,maxLod:W})}const b=e[r++];for(let A=0;A<b;A++)p.textVertexRanges.push([e[r++],e[r++]]);const x=e[r++];for(let A=0;A<x;A++)p.iconVertexRanges.push([e[r++],e[r++]]);s.push(p)}return r}function QSt(e,t,i){for(const[r,s]of e.symbols)xft(e,t,i,s,r)}function xft(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===Fc.SYMBOL){for(const a of r){const l=a.unique;let p;if(a.selectedForRendering){const y=l.parts[0],b=y.startOpacity,x=y.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&x===0;const A=i?Math.floor(127*b)|x<<7:x?255:0;p=A<<24|A<<16|A<<8|A}else p=0;for(const[y,b]of a.iconVertexRanges)for(let x=y;x<y+b;x+=4)n.iconOpacity[x/4]=p;if(a.selectedForRendering){const y=l.parts[1],b=y.startOpacity,x=y.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&x===0;const A=i?Math.floor(127*b)|x<<7:x?255:0;p=A<<24|A<<16|A<<8|A}else p=0;for(const[y,b]of a.textVertexRanges)for(let x=y;x<y+b;x+=4)n.textOpacity[x/4]=p}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class U8{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let a=0;a<n;a++)this.layerUIDs[a]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return J(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){J(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Tft extends U8{constructor(t,i){super(t,i),this.type=Fc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const a=new Map;for(let l=0;l<n;l++){const p=r[s++],y=r[s++],b=r[s++];a.set(p,[y,b])}this.patternMap=a}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){L(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),L(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),L(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++];this.lineVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const l=s[r++];this.lineIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l)),r+=l;const p=this.layer.lineMaterial;this.lineVertexArrayObject=new In(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Sft extends U8{constructor(t,i){super(t,i),this.type=Fc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const a=new Map;for(let l=0;l<n;l++){const p=r[s++],y=r[s++],b=r[s++];a.set(p,[y,b])}this.patternMap=a}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){L(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),L(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),L(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,L(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),L(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),L(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++];this.fillVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const l=s[r++];this.fillIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l)),r+=l;const p=s[r++];this.outlineVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,p)),r+=p;const y=s[r++];this.outlineIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,y)),r+=y;const b=this.layer,x=b.fillMaterial,A=b.outlineMaterial;this.fillVertexArrayObject=new In(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new In(t,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class Eft extends U8{constructor(t,i,r){super(t,i),this.type=Fc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),a=new Float32Array(t);let l=this.bufferDataOffset;this.isIconSDF=!!s[l++];const p=s[l++];for(let A=0;A<p;A++){const M=s[l++],P=s[l++],$=s[l++];this.iconPerPageElementsMap.set(M,[P,$])}const y=s[l++];for(let A=0;A<y;A++){const M=s[l++],P=s[l++],$=s[l++];this.glyphPerPageElementsMap.set(M,[P,$])}const b=s[l++],x=s[l++];this.iconOpacity=new Int32Array(b),this.textOpacity=new Int32Array(x),l=wft(s,n,a,l,this.symbols,r),this.bufferDataOffset=l}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){L(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),L(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),L(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),L(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,L(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),L(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),L(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),L(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++];this.iconVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const l=s[r++];this.iconIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l)),r+=l;const p=s[r++];this.textVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,p)),r+=p;const y=s[r++];this.textIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,y)),r+=y,this.iconOpacityBuffer=Fi.createVertex(t,tr.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Fi.createVertex(t,tr.STATIC_DRAW,this.textOpacity.buffer);const b=this.layer,x=b.iconMaterial,A=b.textMaterial;this.iconVertexArrayObject=new In(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new In(t,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class Aft extends U8{constructor(t,i){super(t,i),this.type=Fc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){L(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),L(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),L(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++];this.circleVertexBuffer=Fi.createVertex(t,tr.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const l=s[r++];this.circleIndexBuffer=Fi.createIndex(t,tr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l)),r+=l;const p=this.layer.circleMaterial;this.circleVertexArrayObject=new In(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const eEt=!0,tEt=32,Lle=200,Cft=1/je("mapview-transitions-duration");class Mft extends ps{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return J(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=bg(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=bg(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Cft;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class qf{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new qf(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,a,l,p]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(a),this.col=parseFloat(l),this.world=parseFloat(p)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new qf(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new qf(t,i,r,s),new qf(t,i,r+1,s),new qf(t,i+1,r,s),new qf(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}qf.pool=new mn(qf,null,null,25,50);class Rft extends Mft{constructor(t,i,r,s,n,a=s,l=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new qf(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*r,p=this.height/this.rangeY*r;sJ(s,l,0,0,0,p,0,n,a,1),UN(this.transforms.dvs,t.displayViewMat3,s)}}class rL extends Rft{constructor(t,i,r,s,n,a,l=null){super(t,i,r,s,n,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Lle}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Lle)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Fc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}L(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(B3e.delete(this),rL._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of n)this._deleteLayerData(a),l.type===Fc.SYMBOL&&(this.symbols.set(a,l.symbols),i=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;L(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Fc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,a=[0,0];t.toScreen(a,[this.x,this.y]);const l=this.transforms.tileUnitsToPixels;nJ(l),gD(l,l,a),oJ(l,l,Math.PI*t.rotation/180),aJ(l,l,[s,n,1])}_createTransforms(){return{dvs:yg(),tileMat3:yg(),tileUnitsToPixels:yg()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const a of n.layerUIDs)i.set(a,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case Fc.FILL:r=new Sft(t,this.styleRepository);break;case Fc.LINE:r=new Tft(t,this.styleRepository);break;case Fc.SYMBOL:r=new Eft(t,this.styleRepository,this);break;case Fc.CIRCLE:r=new Aft(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const B3e=new Map;function Oft(){B3e.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const Pft=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(i){super.postscript(i),s_e(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const i=Tge(this.view.defaultsFromMap,"heightModelInfoReady");this.handles.add(i),await i;const r=DWe(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(r)throw r}canResume(){const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!i||!i.minScale||!i.maxScale||i.minScale>=i.maxScale)}getSuspendInfo(){const i=super.getSuspendInfo(),r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return r&&r.minScale&&r.maxScale&&r.minScale<r.maxScale&&(i.outsideScaleRange=!0),i}};return _([S()],t.prototype,"view",void 0),_([S()],t.prototype,"slicePlaneEnabled",void 0),t=_([re("esri.views.3d.layers.LayerView3D")],t),t},Ift={value:.5,readOnly:!0},V3e={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}},$ft=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const i=this.tileInfo.lods,r=i[0].scale,s=i[i.length-1].scale;return this.levelRangeFromScaleRange(r,s)}get displayLevelRange(){const i=this.tileInfo.lods,r=this.layer.minScale||i[0].scale,s=this.layer.maxScale||i[i.length-1].scale,n=this.levelRangeFromScaleRange(r,s);return this.layer.maxScale&&n.maxLevel++,n}getTileUrl(i,r,s){return this.layer.getTileUrl(i,r,s)}_addTilingSchemeMatchPromise(){if(J(this.fullExtent))return this.addResolvingPromise(Promise.reject(new Se("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const i=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(L(i))return this.addResolvingPromise(Promise.reject(i));const r=Tge(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const s=this.view.basemapTerrain.tilingScheme,n=this._getTileInfoCompatibilityError(this.tileInfo,s);if(n)throw n});this.addResolvingPromise(r)}_getTileInfoSupportError(i,r){const s=F8(i,r,this.view.spatialReference,this.view.state.viewingMode);if(s){const n={layer:this.layer,error:s};let a;switch(s.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":a=new Se("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",n);break;default:a=new Se("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",n)}return a}return null}_getTileInfoCompatibilityError(i,r){return r.compatibleWith(i)?null:new Se("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(i,r){const s={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return s;const a=n.levels[0],l=p=>{const y=Math.log(a.scale/p)/Math.LN2;return .5-Math.abs(.5-y%1)<1e-9?Math.round(y):Math.ceil(y)};return i!=null&&i>0&&(s.minLevel=Math.max(0,l(i))),r!=null&&r>0&&(s.maxLevel=Math.max(0,l(r))),s}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return _([S({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),_([S({readOnly:!0})],t.prototype,"updating",void 0),_([S(V3e)],t.prototype,"updatingProgress",void 0),_([S(Ift)],t.prototype,"updatingProgressValue",void 0),_([S()],t.prototype,"fullExtent",null),_([S({readOnly:!0})],t.prototype,"isOpaque",null),_([S({readOnly:!0})],t.prototype,"dataLevelRange",null),_([S({readOnly:!0})],t.prototype,"displayLevelRange",null),_([S()],t.prototype,"layer",void 0),_([S()],t.prototype,"tileInfo",void 0),t=_([re("esri.views.3d.layers.TiledLayerView3D")],t),t};let Sh=class extends zg(NL(oE(ps.EventedMixin(st)))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if(e.name!=="layerview:create-error"){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw Ge.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){return Wt(this.get("layer.opacity"),1)*Wt(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&this.layer.legendEnabled===!0}get updating(){var e;return!!((e=this.updatingHandles)!=null&&e.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return((e=this.layer)==null?void 0:e.visible)===!0}set visible(e){e!==void 0?this._override("visible",e):this._clearOverride("visible")}canResume(){var e,t,i;return this.visible&&((e=this.layer)==null?void 0:e.loaded)&&!((t=this.parent)!=null&&t.suspended)&&((i=this.view)==null?void 0:i.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};_([S()],Sh.prototype,"fullOpacity",null),_([S()],Sh.prototype,"layer",void 0),_([S()],Sh.prototype,"parent",void 0),_([S({readOnly:!0})],Sh.prototype,"suspended",null),_([S({readOnly:!0})],Sh.prototype,"suspendInfo",null),_([S({readOnly:!0})],Sh.prototype,"legendEnabled",null),_([S({type:Boolean,readOnly:!0})],Sh.prototype,"updating",null),_([S({readOnly:!0})],Sh.prototype,"updatingProgress",null),_([S()],Sh.prototype,"visible",null),_([S()],Sh.prototype,"view",void 0),Sh=_([re("esri.views.layers.LayerView")],Sh);const Dft=Sh;let ZC=class extends $ft(Pft(Dft)){constructor(){super(...arguments),this.type="elevation-3d"}initialize(){var e,t,i,r,s;const n=(e=this.view)==null||(t=e.map)==null?void 0:t.allLayers,a=n&&n.includes(this.layer),l=(i=this.view)==null||(r=i.map)==null||(s=r.ground)==null?void 0:s.layers,p=l&&l.includes(this.layer);if(a&&!p){const y=new Se("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground");this.addResolvingPromise(Promise.reject(y))}this._addTilingSchemeMatchPromise()}};_([S()],ZC.prototype,"layer",void 0),_([S({readOnly:!0,aliasOf:"layer.tileInfo"})],ZC.prototype,"tileInfo",void 0),ZC=_([re("esri.views.3d.layers.ElevationLayerView3D")],ZC);const G3e=ZC;var Lft=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:G3e});class VZ{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class Nft{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let a=1/0,l=-1/0,p=!0,y=!1;for(let b=0;b<n.length;b++){const x=n[b];x!==s?(a=x<a?x:a,l=x>l?x:l,p=!1):y=!0}p&&(a=0,l=0),l=l>-3e38?l:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[a,l],this.hasNoDataValues=y}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const a=2**n;if(!(Math.floor(i/a)===this.i&&Math.floor(r/a)===this.j))return s;let l=1/0,p=-1/0;const y=this.samplerData.width,b=this.samplerData.pixelData,x=.5*MR;let A=(y-1)/a,M=(r-this.j*a)*A,P=(i-this.i*a)*A;if(A<1){const $=Math.floor(M),k=Math.floor(P),z=$+k*y,G=b[z],B=b[z+1],W=b[z+y],q=b[z+y+1];if(G+B+W+q<x){const X=M-$,oe=P-k,de=Q4(G,B,W,q,X,oe),he=Q4(G,B,W,q,X+A,oe),fe=Q4(G,B,W,q,X,oe+A),me=Q4(G,B,W,q,X+A,oe+A);return s.min=Math.min(de,he,fe,me),s.max=Math.max(de,he,fe,me),s}M=$,P=k,A=1}else M=Math.floor(M),P=Math.floor(P),A=Math.ceil(A);for(let $=M;$<=M+A;$++)for(let k=P;k<=P+A;k++){const z=b[$+k*y];z<x?(l=Math.min(l,z),p=Math.max(p,z)):s.hasNoDataValues=!0}return s.min=l,s.max=p,s}}function GZ(e,t,i){if(J(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Ot(r.dy*(r.y1-t),0,s),a=Ot(r.dx*(e-r.x0),0,s);const l=Math.floor(n),p=Math.floor(a),y=r.width,b=l*y+p,x=r.pixelData,A=x[b],M=x[b+1],P=b+y,$=x[P],k=x[P+1];if(A+$+M+k<.5*MR){n-=l,a-=p;const z=A+(M-A)*a;return z+($+(k-$)*a-z)*n}}return null}let Fu=class extends st{constructor(e){super(e),this._handles=new Ei}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=j3e(i.fullExtent,this.viewSpatialReference);L(r)&&e.push(h0e(r))}}),e}};function Fft(e,t){return e===vt.Global?new BH(t):new VH(t)}_([S({readOnly:!0})],Fu.prototype,"layerViewsExtent",null),_([S({readOnly:!0})],Fu.prototype,"tiledLayersExtent",null),_([S({readOnly:!0})],Fu.prototype,"stencilEnabledExtents",null),_([S()],Fu.prototype,"viewSpatialReference",void 0),_([S()],Fu.prototype,"tilingScheme",void 0),_([S()],Fu.prototype,"defaultTiledLayersExtent",void 0),_([S({constructOnly:!0})],Fu.prototype,"layers",void 0),_([S({constructOnly:!0})],Fu.prototype,"layerViews",void 0),Fu=_([re("esri.views.3d.terrain.ExtentHelper")],Fu);let BH=class extends Fu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Gve:Uqe}};BH=_([re("esri.views.3d.terrain.ExtentHelperGlobal")],BH);let VH=class extends Fu{_computeLayerViewsExtent(){const e=pd(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const a=j3e("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);lv(e,a,e)}});const i=zB(e)?e:null,r=this._get("layerViewsExtent");return w2(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=pd();this.layers.forEach(n=>{if(n.loaded&&TM(n)){const a=k8(n,t,vt.Local);if(J(a))return;const{tileInfo:l,fullExtent:p}=a;(L(l)&&tL(n)&&L(p)||L(l)&&e.compatibleWith(l)&&L(p)&&p.spatialReference.equals(e.spatialReference))&&lv(i,p,i)}}),lv(i,this.defaultTiledLayersExtent,i);const r=zB(i)?i:null,s=this._get("tiledLayersExtent");return w2(r,s)?s:r}};function j3e(e,t){return L(e)&&!e.spatialReference.equals(t)?dme(e,e.spatialReference,t):e}VH=_([re("esri.views.3d.terrain.ExtentHelperLocal")],VH);var Oi;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Oi||(Oi={}));const Cb=[Oi.ELEVATION,Oi.MAP];function H3e(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const kft=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let M1,sl=class extends st{constructor(e){super(e),this._handles=new Ei,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Map,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._layerViewsDirty=!0,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=je("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return(this._placementDirty||this._layerViewsDirty)&&(this._drapeSources.size>0||this.view.graphics.length>0||ur.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return L(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?ir(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new ep({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=_d(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),e.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setPlacementDirty()),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),e.watch("graphicsView",()=>this._layerViewsDirty=!0),e.on("resize",()=>this.setPlacementDirty()),L2({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncLayers(),this._updateLayerViews(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,An.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(ii.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,An.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,An.BACKGROUND,t)})]),this._updateLayerViews()}destroy(){this._drapeSources.forEach((e,t)=>this.unregisterDrapeSource(t)),this._drapeTargets.forEach(e=>this._unregisterDrapeTarget(e)),this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),L(M1)&&(M1.hide(),M1=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;L(e)&&L(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new vv(-20037508342787e-6,20037508342787e-6):new vv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}_updateLayerViews(){if(!this._layerViewsDirty)return;const e=new Set;for(const i of this.view.allLayerViews.items)e.add(i.uid),"drapeSourceType"in i&&!this._drapeSources.has(i)&&this._registerDrapeSource(i,aT.LAYER_VIEW),"drapeTargetType"in i&&!this._drapeTargets.has(i)&&this._registerDrapeTarget(i);const t=this.view.graphicsView;L(t)&&!this._drapeSources.has(t)&&(this._registerDrapeSource(t,aT.LAYER_VIEW),e.add(t.uid)),this._drapeSources.forEach((i,r)=>{i!==aT.LAYER_VIEW||e.has(r.uid)||this.unregisterDrapeSource(r)}),this._drapeTargets.forEach(i=>{e.has(i.uid)||this._unregisterDrapeTarget(i)}),this.renderer.updateLayerOrder(),this._setDrawTexturesDirty(),this._layerViewsDirty=!1}registerDrapeSource(e){this._registerDrapeSource(e,aT.EXTERNAL)}_registerDrapeSource(e,t){this._drapeSources.set(e,t),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running")}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&L(e.setDrapingExtent)&&L(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}_registerDrapeTarget(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateDrapeTargets(){this._drapeTargets.forEach(e=>this._updateDrapeTarget(e))}_updateDrapeTarget(e){e.setDrapingTextures(this.renderer.overlays)}_unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this._setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,An.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;this._updateLayerViews();const i=Pst(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Q0);const r=Jm(Q0.inner)/Jm(Q0.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Tn.INNER,Q0.inner,i,1*Q0.pixelRatioAdjustment,Q0.mapUnitsPerPixel),n=this._updateOverlay(Tn.OUTER,Q0.outer,i,r*Q0.pixelRatioAdjustment,Q0.mapUnitsPerPixel);s!==Bf.EXTENT&&n!==Bf.EXTENT||(this._drapeSources.forEach((a,l)=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(t)),s===Bf.NONE&&n===Bf.NONE||this._setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Bf.NONE;const n=this.renderer.overlays[e],a=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,Uft(t,n.extent)&&i===n.resolution)return a===s?Bf.NONE:Bf.RERENDER_ONLY;bv(n.extent,t),n.resolution=i;const l=KW(n.extent);return n.renderLocalOrigin=zM(l[0],l[1],0,"OV_"+this._latestOriginId++),Bf.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Tn.INNER],r=this.renderer.overlays[Tn.OUTER],s=o9(e.extent,this.surface.extent,Nle);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,Tn.INNER,t),this._setTileOverlayData(s,Tn.OUTER,t)):(this._clearTileOverlayData(Tn.INNER,t),this._clearTileOverlayData(Tn.OUTER,t))}else this._clearTileOverlayData(Tn.INNER,t),this._clearTileOverlayData(Tn.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Tn.INNER],i=this.renderer.overlays[Tn.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=Jm(r),n=H2(r);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(r[0],a);const l=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(t,Jm(e)/s,H2(e)/n),i.setOffset(t,(a-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){H3e(),await this.renderer.reloadShaders(),this._setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||L(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}_setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Bft,t,i);if(J(s))return!1;const n=s.origin,a=Xe(iI,s.origin,s.direction);return this._groundIntersector.reset(n,a,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,a),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Ot(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),p=e.aboveGround;if(this.view.viewingMode==="global"){const y=iI;gE(ir(this.view.spatialReference).radius+l,iu(e.eye,e.viewForward),y),We(y,y,e.eye);const b=_v.normalize(MNe(e.viewForward,y,e.viewRight))/e.fovY+.5,x=b<=0||b>=1?.5:r;i=p?x*b:b+x*(1-b)}else{const y=.5*Math.PI-Math.acos(-e.viewForward[2]),b=Math.tan(y),x=_r(0,b,1,0),A=ld(x,x,e.projectionMatrix)[1],M=Ot(.5+.5*A,0,1);i=M===1||M===0?.5:p?M*r:1-(1-M)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&Jq(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=Q();this._findHorizonBasedPointOfInterest(e,s)||ke(s,r);const n=Math.max(.1,Er(e.eye,s)),a=$v(this.view.renderCoordsHelper,r,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);ur.OVERLAY_SHOW_CENTER?(J(M1)&&(M1=new uy(this.view.graphics,"red")),M1.show(s,this._renderSR)):L(M1)&&M1.hide(),this._overlaySREqualsRenderSR||Ho(s,this._renderSR,s,this._spatialReference);const p=this.surface.extent,y=!this._isSpherical&&L(this._spatialReference)&&this._spatialReference.isGeographic,b=y&&L(this._spatialReference)?1/ir(this._spatialReference).metersPerDegree:1,x=e.perRenderPixelRatio*n*b;i.mapUnitsPerPixel=x/this._worldToPCSRatio;let A=t*x/2,M=!1,P=y?90:1/0;this._isSpherical&&L(p)&&L(this._spatialReference)&&(this._spatialReference.isWebMercator?(A/=Math.cos(S6(s[1])),P=p[3]):(M=!0,A/=ir(this._spatialReference).metersPerDegree,P=90),A>=P&&(A=P,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let $=1;M&&($=1/Math.max(.2,Math.cos(Math.abs(xi(s[1])))),A*$>180&&($=180/A),i.mapUnitsPerPixel*=$);const k=Math.log(2)/12;A=Math.exp(Math.round(Math.log(A)/k)*k);const z=A*$,G=32,B=.5*t/(G*z),W=.5*t/(G*A);s[0]=Math.round(s[0]*B)/B,s[1]=Math.round(s[1]*W)/W;const q=i.inner;q[0]=s[0]-z,q[1]=s[1]-A,q[2]=s[0]+z,q[3]=s[1]+A,this._isSpherical&&this._shiftExtentToFitBounds(q,1/0,P);const X=i.outer;if(6*z>Jm(p))bv(X,p);else if(l<=.25*Math.PI)X[0]=q[0]-z,X[1]=q[1]-A,X[2]=q[2]+z,X[3]=q[3]+A;else{Ho(e.eye,this._renderSR,iI,this._spatialReference),Fs(L_,s,iI);let de=-Math.atan2(L_[1],L_[0])+.125*Math.PI;de<0&&(de+=2*Math.PI);const he=Math.floor(de/(.25*Math.PI));OO(L_,kft[he],2*A),L_[0]*=$,L_[2]*=$,Kq(X,q,L_)}if(this._isSpherical)X[0]=this._longitudeCyclical.clamp(X[0]),X[2]=this._longitudeCyclical.clamp(X[2]),X[1]=Math.max(X[1],-P),X[3]=Math.min(X[3],P);else{const de=o9(q,p,Nle),he=o9(X,p,zft);nte(de,he)&&(X[2]=X[0],X[3]=X[1])}const oe=Math.abs(q[2]-q[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,oe),i.pixelRatioAdjustment=i.mapUnitsPerPixel/oe}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Tn.INNER],i),n=this._drawOverlay(e[Tn.OUTER],i);s!==PS.CHANGED&&n!==PS.CHANGED||this.surface.updateTileOverlayParams(An.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateDrapeTargets(),r?(this.surface.requestRender(t),t===An.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(An.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!J(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):BL(e,t))}_rectInsideRect(e,t){return!J(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:nte(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),M6(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function Uft(e,t){const r=ur.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}_([S()],sl.prototype,"_spatialReference",void 0),_([S({readOnly:!0})],sl.prototype,"running",null),_([S()],sl.prototype,"_placementDirty",void 0),_([S()],sl.prototype,"_contentUpdated",void 0),_([S()],sl.prototype,"_layerViewsDirty",void 0),_([S()],sl.prototype,"_isSpherical",null),_([S()],sl.prototype,"_worldToPCSRatio",null),_([S()],sl.prototype,"renderer",void 0),_([S({constructOnly:!0})],sl.prototype,"surface",void 0),_([S({readOnly:!0,aliasOf:"surface.suspended"})],sl.prototype,"suspended",void 0),_([S({readOnly:!0})],sl.prototype,"updating",null),_([S({type:Boolean})],sl.prototype,"hasHighlights",null),_([S({type:Boolean})],sl.prototype,"rendersOccluded",null),sl=_([re("esri.views.3d.terrain.OverlayManager")],sl);const L_=nr(),iI=Q(),Q0={inner:Mi(),outer:Mi(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Nle=Mi(),zft=Mi(),Bft=ua();var Bf;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Bf||(Bf={}));class fO{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!fO.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(fO.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new Ci({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}fO.test={disabled:!1};const Vft=on().vec3f(Y.POSITION).vec2f(Y.UV0),z8=new fO(e=>Vft.createBuffer(e),e=>e.count);class Gft{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=jr(),this.numSurfaceIndices=0,this.numSkirtIndices=0,this.numWithoutSkirtIndices=0,this.numVertsPerRow=0,this.skirtLength=0,this.uvOffsetAndScale=nr()}}class jft{constructor(t,i,r){this.values=t,this.numSurfaceIndices=i,this.numSkirtIndices=r}}function Hft(){z8.clear(),GH.clear()}function qft(e){z8.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}const Wft=65536;function Xft(e,t,i,r,s,n,a,l){const p=s[0],y=s[1],b=s[2],x=s[3],A=.1*a.radius*(x-y),M=e.numVertsPerSide-1,P=e.numVertsPerSide*e.numVertsPerSide,$=4*M,k=n&&(l===Ia.HAS_SOUTH_POLE||l===Ia.HAS_BOTH_POLES),z=n&&(l===Ia.HAS_NORTH_POLE||l===Ia.HAS_BOTH_POLES),G=z8.acquire(P+$),B=G.position.typedBuffer,W=G.uv0.typedBuffer,q=r.geometryInfo.boundingBox;jr(q);const X=t[2]-t[0],oe=t[3]-t[1],de=b-p,he=i[0],fe=i[1],me=i[2];for(let Pe=0;Pe<=M;Pe++){const De=Pe/M,ne=p+De*de;Fle[Pe]=Math.sin(ne),kle[Pe]=Math.cos(ne),Ule[Pe]=De,zle[Pe]=t[0]+De*X}let ge=0;const Ce=e.samplerData,Ae=L(Ce)&&Ce.some(Pe=>L(Pe))?(Pe,De)=>GZ(zle[Pe],De,Ce):()=>0;for(let Pe=0;Pe<=M;Pe++){let De=Pe/M;const ne=Vi(y,x,De),pe=Math.cos(ne),ye=Math.sin(ne);let we;n?(we=a.halfSemiMajorAxis*Math.log((1+ye)/(1-ye)),De=(we-t[1])/oe):we=180*ne/Math.PI;for(let Ee=0;Ee<=M;Ee++){const Ie=Ule[Ee],xe=Fle[Ee],$e=kle[Ee],et=a.radius+Ae(Ee,we),ct=$e*pe*et-he,Mt=xe*pe*et-fe,at=ye*et-me;jH(ct,Mt,at,q);const nt=dD*ge;B[nt+0]=ct,B[nt+1]=Mt,B[nt+2]=at,W[nt+0]=Ie,W[nt+1]=De;const dt=jZ(Ee,Pe,M);if(L(dt)){const xt=dD*(P+dt),wr=k&&Pe===0?-1:z&&Pe===M?1:0,vs=wr===0?ct:-he,ji=wr===0?Mt:-fe,ae=wr===0?at:a.radius*wr-me;B[xt+0]=vs,B[xt+1]=ji,B[xt+2]=ae,W[xt+0]=wr===0?W3e(Ie,De):Ie,W[xt+1]=wr===0?A:De,wr!==0&&jH(vs,ji,ae,q)}++ge}}r.geometryInfo.numVertsPerRow=e.numVertsPerSide,r.geometryInfo.vertexAttributes=G,r.geometryInfo.skirtLength=A,fl(r.geometryInfo.uvOffsetAndScale,0,0,1,1),q3e(r.geometryInfo,e.numVertsPerSide,n?l:Ia.REGULAR,e.wireframe),r.intersectionData=null,r.skirtIntersectionData=null}function Yft(e,t,i,r,s,n){const a=t[0],l=t[1],p=t[2]-a,y=t[3]-l,b=e.clippingArea,x=L(b)?Math.max(0,(b[0]-t[0])/p):0,A=L(b)?Math.max(0,(b[1]-t[1])/y):0,M=L(b)?Math.min(1,(b[2]-t[0])/p):1,P=L(b)?Math.min(1,(b[3]-t[1])/y):1,$=M>x?1/(M-x):1,k=P>A?1/(P-A):1,z=-x*$,G=-A*k,B=p*r*.1,W=e.numVertsPerSide-1,q=e.numVertsPerSide*e.numVertsPerSide,X=4*W,oe=z8.acquire(q+X),de=oe.position.typedBuffer,he=oe.uv0.typedBuffer,fe=n.geometryInfo.boundingBox;jr(fe);let me=0;const ge=ar.radius,Ce=e.samplerData,Ae=L(Ce)&&Ce.some(Pe=>L(Pe))?(Pe,De)=>GZ(Pe,De,Ce):()=>0;for(let Pe=0;Pe<=W;Pe++){const De=Pe/W;let ne=G+De*k,pe=l+De*y;L(b)&&(pe<b[1]?(pe=b[1],ne=0):pe>b[3]&&(pe=b[3],ne=1));const ye=pe,we=(s?(Math.PI/2-2*Math.atan(Math.exp(-ye/ge)))*ge:ye*r)-i[1];for(let Ee=0;Ee<=W;Ee++){const Ie=Ee/W;let xe=z+Ie*$,$e=a+Ie*p;L(b)&&($e<b[0]?($e=b[0],xe=0):$e>b[2]&&($e=b[2],xe=1));const et=Ae($e,ye),ct=$e*r-i[0],Mt=et-i[2];jH(ct,we,Mt,fe);const at=dD*me;de[at+0]=ct,de[at+1]=we,de[at+2]=Mt,he[at+0]=xe,he[at+1]=ne;const nt=jZ(Ee,Pe,W);if(L(nt)){const dt=dD*(q+nt);de[dt+0]=ct,de[dt+1]=we,de[dt+2]=Mt,he[dt+0]=W3e(xe,ne),he[dt+1]=B}++me}}n.geometryInfo.numVertsPerRow=e.numVertsPerSide,n.geometryInfo.vertexAttributes=oe,n.geometryInfo.skirtLength=B,fl(n.geometryInfo.uvOffsetAndScale,x,A,M-x,P-A),q3e(n.geometryInfo,e.numVertsPerSide,Ia.REGULAR,e.wireframe),n.intersectionData=null,n.skirtIntersectionData=null}const GH=new Map;function q3e(e,t,i,r){const s=i===Ia.HAS_NORTH_POLE||i===Ia.HAS_BOTH_POLES,n=t+(r?1024:0)+(s?2048:0);let a=GH.get(n);a||(a=Jft(t,s,r),GH.set(n,a)),e.indices=a.values,e.numSurfaceIndices=a.numSurfaceIndices,e.numSkirtIndices=a.numSkirtIndices,e.numWithoutSkirtIndices=e.numSurfaceIndices+(i===Ia.REGULAR?0:6*(t-1)*(r?2:1))}function Jft(e,t,i){const r=e-1,s=e*e,n=4*r;let a=2*s*3,l=6*n,p=6*(2*r+r-1);i&&(a*=2,l*=2,p*=2);const y=s+n>Wft?new Uint32Array(a+l):new Uint16Array(a+l);let b=0,x=0,A=a;for(let M=0;M<=r;M++){let P=0;t&&(P=M===0?p:M===r?-p:0),A+=P;for(let $=0;$<=r;$++){const k=jZ($,M,r);if(L(k)){const z=Zft($,M,r);if(z!==0){const G=b,B=s+k,W=s+($===0&&M===1?0:k+1),q=b+z;i?(y[A++]=G,y[A++]=B,y[A++]=B,y[A++]=W,y[A++]=W,y[A++]=G,y[A++]=W,y[A++]=q,y[A++]=q,y[A++]=G,y[A++]=G,y[A++]=W):(y[A++]=G,y[A++]=B,y[A++]=W,y[A++]=W,y[A++]=q,y[A++]=G)}}if(++b,$<r&&M<r){const z=M*(r+1)+$,G=z+1,B=G+(r+1),W=B-1;i?(y[x++]=z,y[x++]=G,y[x++]=G,y[x++]=B,y[x++]=B,y[x++]=z,y[x++]=B,y[x++]=W,y[x++]=W,y[x++]=z,y[x++]=z,y[x++]=B):(y[x++]=z,y[x++]=G,y[x++]=B,y[x++]=B,y[x++]=W,y[x++]=z)}}A-=P}return new jft(y,a,l)}function jH(e,t,i,r){e<r[0]&&(r[0]=e),e>r[3]&&(r[3]=e),t<r[1]&&(r[1]=t),t>r[4]&&(r[4]=t),i<r[2]&&(r[2]=i),i>r[5]&&(r[5]=i)}function W3e(e,t){const i=t>e?1:0;return 2+4*i+(1-2*i)*(e+t)}function jZ(e,t,i){return t===0?e:e===i?i+t:t===i?3*i-e:e===0&&t>0?4*i-t:null}function Zft(e,t,i){return t===0&&e!==i?1:e===i&&t!==i?i+1:t===i&&e!==0?-1:e===0&&t!==0?-(i+1):0}function Kft(e,t,i,r,s,n,a,l,p,y){const b=n.position,x=n.uv0,A=e[0],M=e[1],P=e[2],$=t[0]-A,k=t[1]-M,z=t[2]-P;r*=3;for(let G=i*=3;G<r;G+=3){const B=s[G],W=s[G+1],q=s[G+2];let X=b.get(B,0),oe=b.get(B,1),de=b.get(B,2),he=b.get(W,0),fe=b.get(W,1),me=b.get(W,2),ge=b.get(q,0),Ce=b.get(q,1),Ae=b.get(q,2);if(x.get(B,0)>=2){const ji=X+l[0],ae=oe+l[1],sr=de+l[2],Bs=a/Math.sqrt(ji*ji+ae*ae+sr*sr);X+=ji*Bs,oe+=ae*Bs,de+=sr*Bs}if(x.get(W,0)>=2){const ji=he+l[0],ae=fe+l[1],sr=me+l[2],Bs=a/Math.sqrt(ji*ji+ae*ae+sr*sr);he+=ji*Bs,fe+=ae*Bs,me+=sr*Bs}if(x.get(q,0)>=2){const ji=ge+l[0],ae=Ce+l[1],sr=Ae+l[2],Bs=a/Math.sqrt(ji*ji+ae*ae+sr*sr);ge+=ji*Bs,Ce+=ae*Bs,Ae+=sr*Bs}L(p)&&([X,oe,de]=p.applyToVertex(X,oe,de),[he,fe,me]=p.applyToVertex(he,fe,me),[ge,Ce,Ae]=p.applyToVertex(ge,Ce,Ae));const Pe=he-X,De=fe-oe,ne=me-de,pe=ge-X,ye=Ce-oe,we=Ae-de,Ee=k*we-ye*z,Ie=z*pe-we*$,xe=$*ye-pe*k,$e=Pe*Ee+De*Ie+ne*xe;if(Math.abs($e)<=Number.EPSILON)continue;const et=A-X,ct=M-oe,Mt=P-de,at=et*Ee+ct*Ie+Mt*xe;if($e>0){if(at<0||at>$e)continue}else if(at>0||at<$e)continue;const nt=ct*ne-De*Mt,dt=Mt*Pe-ne*et,xt=et*De-Pe*ct,wr=$*nt+k*dt+z*xt;if($e>0){if(wr<0||at+wr>$e)continue}else if(wr>0||at+wr<$e)continue;const vs=(pe*nt+ye*dt+we*xt)/$e;vs>=0&&y(vs,c4(Pe,De,ne,pe,ye,we,X3e))}}function Qft(e,t,i,r,s,n){const a=r.position,l=r.uv0,p=new Map,y=3*t,b=3*i-y,x=new Uint32Array(b);let A=0;for(let P=0;P<b;++P){const $=e[P+y];if(p.has($))x[P]=p.get($);else{const k=A++;p.set($,k),x[P]=k}}const M=new Float64Array(3*A);return p.forEach((P,$)=>{let k=a.get($,0),z=a.get($,1),G=a.get($,2);if(l.get($,0)>=2){const B=k+n[0],W=z+n[1],q=G+n[2],X=s/Math.sqrt(B*B+W*W+q*q);k+=B*X,z+=W*X,G+=q*X}M[3*P+0]=k,M[3*P+1]=z,M[3*P+2]=G}),{vertices:M,indices:x}}function e0t(e,t,i,r,s,n,a,l,p){const y=n.position,b=n.uv0,x=e[0],A=e[1],M=e[2],P=t[0]-x,$=t[1]-A,k=t[2]-M;r*=3;for(let z=i*=3;z<r;z+=3){const G=s[z],B=s[z+1],W=s[z+2];let q=y.get(G,0),X=y.get(G,1),oe=y.get(G,2),de=y.get(B,0),he=y.get(B,1),fe=y.get(B,2),me=y.get(W,0),ge=y.get(W,1),Ce=y.get(W,2);b.get(G,0)>=2&&(oe+=a),b.get(B,0)>=2&&(fe+=a),b.get(W,0)>=2&&(Ce+=a),L(l)&&([q,X,oe]=l.applyToVertex(q,X,oe),[de,he,fe]=l.applyToVertex(de,he,fe),[me,ge,Ce]=l.applyToVertex(me,ge,Ce));const Ae=de-q,Pe=he-X,De=fe-oe,ne=me-q,pe=ge-X,ye=Ce-oe,we=$*ye-pe*k,Ee=k*ne-ye*P,Ie=P*pe-ne*$,xe=Ae*we+Pe*Ee+De*Ie;if(Math.abs(xe)<=Number.EPSILON)continue;const $e=x-q,et=A-X,ct=M-oe,Mt=$e*we+et*Ee+ct*Ie;if(xe>0){if(Mt<0||Mt>xe)continue}else if(Mt>0||Mt<xe)continue;const at=et*De-Pe*ct,nt=ct*Ae-De*$e,dt=$e*Pe-Ae*et,xt=P*at+$*nt+k*dt;if(xe>0){if(xt<0||Mt+xt>xe)continue}else if(xt>0||Mt+xt<xe)continue;const wr=(ne*at+pe*nt+ye*dt)/xe;wr>=0&&p(wr,c4(Ae,Pe,De,ne,pe,ye,X3e))}}const Fle=new Array(e4+1),kle=new Array(e4+1),Ule=new Array(e4+1),zle=new Array(e4+1),X3e=Q();class Y3e{constructor(){this._queue=new Ci,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),L(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class t0t{constructor(){this.q=new Ci}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!J(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function WM(e,t,i){if(J(t)||J(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function J3e(e,t){t.sort((i,r)=>Z3e(i,r,e))}function Z3e(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:0}function i0t(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij))}function r0t(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function s0t(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function iEt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class HZ{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,vo.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return L(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=zH(r),{minLevel:n,maxLevel:a}=r.dataLevelRange,l=this._desiredMinLevelDelta,p=this._progressiveLevelModulo+l,y=this._scaleRangeEnabled?WM:()=>!0;let b=this.tile;const x=b.level;let A;const M=this._tileLayerInfo.upsampleInfo,P=M?M.tile.level:-1,$=Ss(s,"tilemapCache");for(;b&&y(b,s,!1)&&b.level>=n;){const k=b.level,z=x-k,G=b.layerInfo[i][t];if(G.data&&z>=l){k>P&&this._setUpsampleTile(b),G.dataInvalidated&&(A=b);break}if((J($)||$.getAvailability(b.lij[0],b.lij[1],b.lij[2])!=="unavailable")&&k<=a&&!G.data&&!G.dataMissing&&((J(A)||b.level===n||k%Vve==0||x-A.level<l)&&(A=b),z>=p))break;b=b.parent}return L(A)&&x-A.level<l&&this._tileLayerInfo.upsampleInfo&&(A=null),A}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,vo.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class n0t extends HZ{get _desiredMinLevelDelta(){throw Ble}get _progressiveLevelModulo(){throw Ble}dispose(){}}const Ble=new Error("Abstract method called on TileAgent"),gc=new n0t;class K3e extends HZ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return H9(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class Q3e extends HZ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Vve}}function o0t(e,t,i="nearest",r=!1){var s;const n=!(r&&t.pixelType==="u8"),a=n?ai.FLOAT:ai.UNSIGNED_BYTE,l=t.pixels==null||t.pixels.length===0?null:n?t.getAsRGBAFloat():t.getAsRGBA(),p=(s=e.capabilities.textureFloat)==null?void 0:s.textureFloatLinear,y={width:t.width,height:t.height,target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:e.type===Yi.WEBGL2&&n?Jt.RGBA32F:_t.RGBA,samplingMode:!p||i!=="bilinear"&&i!=="cubic"?Pt.NEAREST:Pt.LINEAR,dataType:a,wrapMode:ei.CLAMP_TO_EDGE,flipped:!1};return new Vt(e,y,l)}function a0t(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,a]}=t,l=i[0]>1,p={width:l?4*n:n,height:a,target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:e.type===Yi.WEBGL2?Jt.RGBA32F:_t.RGBA,dataType:ai.FLOAT,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,flipped:!1},y=new Float32Array(l?n*a*16:2*r.length);if(l)for(let b=0,x=0;b<s.length;b++)y[x++]=s[b],b%3==2&&(y[x++]=1);else for(let b=0;b<a;b++)for(let x=0;x<n;x++){const A=4*(b*n+x),M=2*(x*a+b);y[A]=r[M],y[A+1]=r[M+1],y[A+3]=r[M]===-1?0:1}return new Vt(e,p,y)}function Vle(e,t){const i={width:t.length/4,height:1,target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,flipped:!1};return new Vt(e,i,t)}function l0t(e,t,i,r=1,s=!0,n=!1){return{u_flipY:s,u_isFloatTexture:n,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:i}}function c0t(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function h0t(e,t){return{u_scale:e,u_offset:t}}function u0t(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function d0t(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function p0t(e,t){const i=e.gl,r=t.glName,s=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),n=new Map;let a;for(let l=0;l<s;l++)a=i.getActiveUniform(r,l),a&&n.set(a.name,{location:i.getUniformLocation(r,a.name),info:a});return n}function IA(e,t,i){Object.keys(i).forEach(r=>{const s=t.get(r)||t.get(r+"[0]");s&&f0t(e,r,i[r],s)})}function f0t(e,t,i,r){if(r===null||i==null)return!1;const{info:s}=r;switch(s.type){case ol.FLOAT:s.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case ol.FLOAT_VEC2:e.setUniform2fv(t,i);break;case ol.FLOAT_VEC3:e.setUniform3fv(t,i);break;case ol.FLOAT_VEC4:e.setUniform4fv(t,i);break;case ol.FLOAT_MAT3:e.setUniformMatrix3fv(t,i);break;case ol.FLOAT_MAT4:e.setUniformMatrix4fv(t,i);break;case ol.INT:s.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case ol.BOOL:e.setUniform1i(t,i?1:0);break;case ol.INT_VEC2:case ol.BOOL_VEC2:e.setUniform2iv(t,i);break;case ol.INT_VEC3:case ol.BOOL_VEC3:e.setUniform3iv(t,i);break;case ol.INT_VEC4:case ol.BOOL_VEC4:e.setUniform4iv(t,i);break;default:return!1}return!0}const Gle={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class jle{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.scale=1,this.offset=[0,0],this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._memoryUsed=null)}get symbolizerParameters(){return this.isRendereredSource?qe(ie({},Gle),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||Gle}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){L(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,this._rasterTexture){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?Pt.LINEAR:Pt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(this._rasterTexture&&!this._dirty||this._updateRasterTexture(t,this.bandIds),this._rasterTexture&&(this._updateColormapTexture(t),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=a0t(t,this.transformGrid))),!0)}getUniforms(){const t=h0t(this.scale,this.offset),{symbolizerParameters:i,transformGrid:r,width:s,height:n,opacity:a}=this;return{basic:t,common:l0t(r,[s,n],[this.source.width,this.source.height],a),colormap:i.colormap?c0t(i.colormap,i.colormapOffset):null,stretch:this.symbolizerParameters.type==="stretch"?u0t(this.symbolizerParameters):null,hillshade:this.symbolizerParameters.type==="hillshade"?d0t(this.symbolizerParameters):null}}getTextures(){const t=new Array,i=[];return this._rasterTexture&&(i.push(this._rasterTexture),t.push("u_image"),this._transformGridTexture&&(i.push(this._transformGridTexture),t.push("u_transformGrid")),this._colormapTexture&&(i.push(this._colormapTexture),t.push("u_colormap"))),{names:t,textures:i}}get memoryUsage(){if(J(this._memoryUsed)){const t=this.getTextures();if(t==null)return 0;this._memoryUsed=t.textures.map(i=>i.descriptor.width*i.descriptor.height*4).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Xt(this._rasterTexture),this._transformGridTexture=Xt(this._transformGridTexture),this._colormapTexture=Xt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null));const s=J(i)&&J(this.bandIds)||L(i)&&L(this.bandIds)&&i.join("")===this.bandIds.join("");if(this._rasterTexture){if(s)return;this._rasterTexture.dispose(),this._rasterTexture=null}const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=o0t(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Vle(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=Vle(t,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}class w${constructor(){this.waitingAgents=new Ci,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=OU.acquire();return i._init(t),i}release(){this.dispose(),x$.delete(this),OU.release(this)}dispose(){this.loadingAgent=Xt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=DT(this._data)}static prune(){OU.prune(0)}_init(t){this.waitingAgents.clear(),this._data=DT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ql(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||J(i))this._unsetUpsampleInfo();else{if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),r0t(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){DT(this._data),this._data=t}}const OU=new mn(w$,null,()=>{}),x$=new Map;function m0t(){x$.size>0&&(console.log(`${x$.size} live TilePerLayerInfo allocations:`),x$.forEach(e=>console.log(e,`
`)))}class Ry{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var ci;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(ci||(ci={}));const PU=Q(),Sx=Q(),Co=Q(),g0t=.1;class y0t{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class qZ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Mi(),this._elevationBounds=St(),this.layerInfo=[[],[]],this.extentInRadians=Mi(),this.centerAtSeaLevel=Q(),this._center=[Q(),qo(),Q()],this.up=Wq(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=$A,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){WZ.prune(0),XZ.prune(0),w$.prune()}get usedMemory(){return this._usedMemory===$A&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){this._usedMemory===$A&&this._updateMemoryUsed();let t=this._mapTileMemory;for(const{data:i}of this.layerInfo[Oi.MAP])i instanceof rL&&(t+=i.memoryUsage);return t}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[cl.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===YS.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=ir(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[cl.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?Pn(this._elevationBounds,i.elevationBounds):ds(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of Cb){const n=r.numLayers(s),a=this.layerInfo[s];for(const l of a)l.release();a.length=n;for(let l=0;l<n;l++)a[l]=w$.acquire(this._surface.upsampleInfoPool),s===Oi.ELEVATION&&this.findElevationBoundsForLayer(l,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,e4)}release(){lp(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of Cb){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this._usedMemory=$A}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){const t=this.cachedMemory;t>0&&(this._surface.upsampleMapCache.put(this.key,this,t),this.setMemoryDirty())}}setMemoryDirty(){this._usedMemory=$A}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_updateMemoryUsed(){this._usedMemory=0,this._mapTileMemory=0;const t=this.cpuImageMemorySize;for(const{data:i}of this.layerInfo[Oi.MAP])i instanceof Ry?this._mapTileMemory+=uv(i.texture):i instanceof HTMLImageElement||i instanceof pO?this._mapTileMemory+=t:i instanceof jle&&(this._mapTileMemory+=i.memoryUsage);for(const i of this.layerInfo[Oi.ELEVATION])this._usedMemory+=i.data?t:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=uv(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this.cachedMemory)}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];if(!r||!r.data)return 0;if(t!==Oi.MAP||this.isCached){if(t===Oi.ELEVATION)return this.cpuImageMemorySize}else{const s=r.data;if(s instanceof Ry)return uv(s.texture);if(s instanceof HTMLImageElement||s instanceof pO)return this.cpuImageMemorySize;if(s instanceof rL||s instanceof jle)return s.memoryUsage}return 0}updateScreenDepth(t){const i=this._center[cl.MIDDLE],r=t,s=i[0],n=i[1],a=i[2],l=r[2]*s+r[6]*n+r[10]*a+r[14];this._screenDepth=l<0?0:l/(r[3]*s+r[7]*n+r[11]*a+r[15])}shouldSplit(t,i,r){if(L(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return ci.NONE;const s=this.level;We(PU,this._center[cl.MIDDLE],i);let n=dl(PU),a=cl.MIDDLE;We(Sx,this._center[cl.TOP],i);const l=dl(Sx);l<n&&(n=l,a=cl.TOP),We(Sx,this._center[cl.BOTTOM],i);const p=dl(Sx);if(p<n&&(n=p,a=cl.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return ci.SPLIT;const y=Math.sqrt(n),b=t.fovX*y*2,x=this._edgeLen/b,A=()=>{const k=s+Math.ceil(-Math.log2(t.relativeWidthLimit/x));return k!==this.vlevel?(this.vlevel=k,ci.VSPLITMERGE):ci.NONE_HIT_MAXLOD};if(r===YS.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?A():ci.SPLIT;const M=rt(this.up,PU),P=this._elevationBounds[1]-this._elevationBounds[0],$=P/this.edgeLen;if(t.aboveGround&&M>0&&$<.001&&M/y-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-$>0)return ci.NONE;if(x<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,ci.VSPLITMERGE):ci.NONE;if(s>=t.maxLod)return A();if(s>6){We(Sx,this._center[a],i),Ue(Co,this.up,M),We(Co,Co,Sx);const k=dl(Co);if(k>this.radius*this.radius){Ue(Co,Co,this.radius/Math.sqrt(k)),Xe(Co,Co,this._center[a]),We(Co,i,Co);const z=Math.min(1,(Math.abs(rt(Co,this.up))+.5*P+this._curvatureHeight)/yt(Co)),G=g0t/t.angledSplitBias,B=t.fovY*y*2;if(z*(this._edgeLen/B)<G*t.relativeHeightLimit)return ci.NONE}}return ci.SPLIT}setChildren(t,i,r,s){lp(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}load(t){this.refMapData();for(const i of Cb)this._createOrUpdateAgents(0,i);t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of Cb){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==gc&&(rI(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(ci.GEOMETRY),this.resetPendingUpdate(ci.TEXTURE_NOFADING),this.resetPendingUpdate(ci.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Oi.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==gc&&(rI(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(w2(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;L(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(ci.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of Cb){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==gc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(ci.SPLIT)||t!==Oi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===ci.SPLIT||t===ci.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;Ql(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const a=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(a,a),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return dl(We(Co,this._center[cl.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,a=n.removeUnordered(r)!=null;lp(a,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this._updateMemoryUsed())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this._updateMemoryUsed()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this._updateMemoryUsed()}updateRenderData(t,i){switch(t){case Oi.MAP:return this._updateTexture(i);case Oi.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===vo.FADING?ci.TEXTURE_NOFADING:ci.TEXTURE_FADING),this.setPendingUpdate(t===vo.FADING?ci.TEXTURE_FADING:ci.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ci.GEOMETRY);for(const t of this.layerInfo[Oi.ELEVATION])t.pendingUpdates|=ci.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){ds(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const t=this.layerInfo[Oi.ELEVATION];let i=!0;for(const r of t)L(r.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],r.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],r.elevationBounds.max),r.elevationBounds.hasNoDataValues||(i=!1));i&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=.5*(this._elevationBounds[0]+this._elevationBounds[1]);Ue(Co,this.up,t),Xe(this._center[cl.MIDDLE],this.centerAtSeaLevel,Co),Ue(Co,this.up,this._elevationBounds[0]),Xe(this._center[cl.TOP],this.centerAtSeaLevel,Co),Ue(Co,this.up,this._elevationBounds[1]),Xe(this._center[cl.BOTTOM],this.centerAtSeaLevel,Co)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Oi.ELEVATION][t];if(L(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Oi.ELEVATION),n=zH(s);if(!WM(this,n,!1))return;const a=_0t;let l=!1;if(r.data){const p=r.data;a.min=p.bounds[0],a.max=p.bounds[1],a.hasNoDataValues=p.hasNoDataValues,a.level=this.lij[0],l=!0}else{let p,y,b=0;for(let x=this._parent;x&&(!y||b<H9(this.level))&&(b=this.vlevel-x.level,p=y||p,y=x.layerInfo[Oi.ELEVATION][t].data,!(!y&&p&&b>=H9(this.level)));x=x.parent);y=y||p,y&&(y.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],a),a.min!==1/0&&(a.level=y.level,l=!0))}l&&(J(r.elevationBounds)&&(r.elevationBounds=new VZ),r.elevationBounds.copyFrom(a))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const l of s)l.loadingAgent&&l.loadingAgent!==gc&&(rI(l.loadingAgent),l.loadingAgent=null),l.waitingAgents.clear();for(let l=0;l<s.length;++l)t[l]===void 0&&s[l].release();const n=new Array(...s),a=i.length;s.length=a;for(let l=0;l<a;l++){const p=i[l];s[l]=p>-1?n[p]:w$.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,vo.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===gc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of Cb){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==gc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===gc&&this.updateRenderData(t,vo.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==gc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=gc,r.data||r.upsampleInfo||this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this._isSuspended(i),s=this.layerInfo[i];for(let n=t;n<s.length;++n){const a=s[n];let l=!1;const p=this._surface.layerViewByIndex(n,i),y=zH(p);if(a.loadingAgent?WM(this,y,!1)?(a.loadingAgent!==gc&&a.loadingAgent.setSuspension(r),a.loadingAgent!==gc&&(l=a.loadingAgent.update())):a.dispose():WM(this,y,!1)&&(a.loadingAgent=v0t(this,n,i,r),l=a.loadingAgent.startLoading(),l?a.loadingAgent===gc&&this.setPendingUpdate(ci.GEOMETRY):(rI(a.loadingAgent),a.loadingAgent=gc)),a.loadingAgent===gc&&this.updateRenderData(i,vo.FADING),l&&p.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerRow(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,H9(this.level)-i);return Ot(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}}function v0t(e,t,i,r){const s=i===Oi.ELEVATION?XZ.acquire():WZ.acquire();return s.init(e,t,i,r),s}function rI(e){e.dispose(),e instanceof K3e?XZ.release(e):e instanceof Q3e&&WZ.release(e)}const WZ=new mn(Q3e),XZ=new mn(K3e),_0t=new VZ,$A=-1;var cl;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(cl||(cl={}));class b0t extends qZ{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.isWebmercatorOnPlateeCaree=!1,this.extentInRenderSR=Mi(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,a=L(s)&&pfe(s),l=a&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=l,this.isWebmercatorOnPlateeCaree=a&&n.isWebMercator;const p=this.extentInRenderSR,y=this.extent;if(this.isWebmercatorOnPlateeCaree){const b=$t(y[0],y[1],0);Ho(b,It.WebMercator,b,It.PlateCarree);const x=$t(y[2],y[3],0);Ho(x,It.WebMercator,x,It.PlateCarree),p[0]=b[0],p[1]=b[1],p[2]=x[0],p[3]=x[1]}else for(let b=0;b<4;++b)p[b]=y[b]*l;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]),this.centerAtSeaLevel[1]=.5*(p[1]+p[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(s,n);this._center[cl.MIDDLE][3]=a}_isVisible(t){return qKe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return x6e(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s,n){sI[0]=1/i[0],sI[1]=1/i[1],sI[2]=1/i[2];const a=n*(this.extent[2]-this.extent[0])*this.horizontalScaleFactor*.1;return GJ(this._aabb(),t,sI,r+a,s)}createGeometry(t,i){Yft(t,this.extent,i,this.horizontalScaleFactor,this.isWebmercatorOnPlateeCaree,this.renderData),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}}const sI=Q();var mO;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(mO||(mO={}));class w0t extends qZ{constructor(t,i,r){super(),this.obb=new Array(8),this.isWebMercator=!1;for(let s=0;s<8;s++)this.obb[s]=Q();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r),this.isWebMercator=r.tilingScheme.spatialReference.isWebMercator;const s=this.ellipsoid.radius,n=this.extentInRadians[0],a=this.extentInRadians[1],l=this.extentInRadians[2],p=this.extentInRadians[3],y=t[0],b=Vi(a,p,.5),x=Vi(n,l,.5),A=y===0?0:Math.min(Math.abs(a),Math.abs(p));this._edgeLen=(l-n)*Math.cos(A)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),HE(this.centerAtSeaLevel,x,b,this.ellipsoid.radius,0);const M=zl(this.centerAtSeaLevel);ot(M,M),this.up=M,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)ze(this._center[np.MIDDLE],0,0,0),ze(this._center[np.TOP],0,0,0),ze(this._center[np.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=ir(this.surface.spatialReference)),this._center[np.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(wo(this._center[np.MIDDLE],this.obb[0]),wo(this._center[np.MIDDLE],this.obb[1]));this._center[np.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!ev(t,this._center[np.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<Pg.NUM;r++){const s=r===Qr.NEAR,n=t[r];s&&(DA[0]=n[0],DA[1]=n[1],DA[2]=n[2],DA[3]=n[3]-this.surface.view.state.camera.near);const a=s?DA:n;let l;for(l=0;l<8;l++){const p=i[l];if(a[0]*p[0]+a[1]*p[1]+a[2]*p[2]+a[3]<0)break}if(l===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(t,i){const r=this._getPatchType(this.lij[1],this.lij[0]);Xft(t,this.extent,i,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,r),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;HE(i[n++],t[0],t[1],this.ellipsoid.radius,s),HE(i[n++],t[0],t[3],this.ellipsoid.radius,s),HE(i[n++],t[2],t[3],this.ellipsoid.radius,s),HE(i[n++],t[2],t[1],this.ellipsoid.radius,s)}if(this.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ia.HAS_NORTH_POLE:ze(i[1],0,0,this.ellipsoid.radius),ze(i[2],0,0,this.ellipsoid.radius),ze(i[5],0,0,this.ellipsoid.radius),ze(i[6],0,0,this.ellipsoid.radius);break;case Ia.HAS_SOUTH_POLE:ze(i[0],0,0,-this.ellipsoid.radius),ze(i[3],0,0,-this.ellipsoid.radius),ze(i[4],0,0,-this.ellipsoid.radius),ze(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?Ia.HAS_BOTH_POLES:Ia.HAS_SOUTH_POLE:t===0?Ia.HAS_NORTH_POLE:Ia.REGULAR}intersectsRay(t,i,r,s,n){const a=this._center[np.MIDDLE],l=a[3]+r+.2*this.ellipsoid.radius*Math.abs(n*(this.extentInRadians[3]-this.extentInRadians[1])),p=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],y=a[0]-t[0],b=a[1]-t[1],x=a[2]-t[2],A=(y*i[0]+b*i[1]+x*i[2])/p,M=i[0]*A-y,P=i[1]*A-b,$=i[2]*A-x;return M*M+P*P+$*$<l*l}getDefaultVerticesPerRowOnLevel(){return this.level<Hle.length?Hle[this.level]+1:2}}const Hle=[128,64,32,16,16,8,8,4],DA=er();var np;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(np||(np={}));class IU{constructor(){this.numVertsPerSide=0,this.wireframe=!1}}class LT{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ht(this._current),this._next=Ht(this._next),this._waiting=Ht(this._waiting),this._delayed=Ht(this._delayed)}get current(){if(J(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=LT.test.fadeMoment;if(L(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,vg.Immediate),this._delayed=null)),L(this._next)){t=t||performance.now();const i=this._fadeDuration,r=L(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==vo.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(Ht(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(J(this._next))return 1;const t=LT.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return L(this._next)||L(this._delayed)}push(t,i=vg.Immediate){this._delayed=Ht(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),J(this._current))return void(this._current=t);const r=LT.test.fadeMoment||performance.now();return i!==vg.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):J(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(J(t)||(Ht(this._waiting),this._waiting=t))}get _fadeDuration(){return J(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var vg;LT.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(vg||(vg={}));class x0t{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class T0t{constructor(){this.geometryInfo=new Gft,this.intersectionData=null,this.skirtIntersectionData=null,this.geometryState=new IU,this._textureRef=new LT(()=>this.tile.surface.textureFadeDuration),this.overlay=new x0t}init(t){this.tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,jr(i.boundingBox),i.numSurfaceIndices=0,i.numSkirtIndices=0,i.numWithoutSkirtIndices=0,i.numVertsPerRow=0,this.intersectionData=null,this.skirtIntersectionData=null,this.geometryState=new IU,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometry(t,i){return!!this._updateGeometryState(i)&&(this._releaseGeometry(),this._createGeometry(t),!0)}releaseGeometry(){return!!this._releaseGeometry()&&(this.geometryState=new IU,!0)}ensureTexture(t,i){return L(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),J(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){L(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_updateGeometryState(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerRow(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel();let s=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(s=null);const n=this.geometryState;let a=!1;return n.numVertsPerSide!==r&&(n.numVertsPerSide=r,a=!0),i.changed&&(n.samplerData=i.samplerData,a=!0),$2(n.clippingArea,s)||(n.clippingArea=s,a=!0),n.wireframe!==t&&(n.wireframe=t,a=!0),a}_createGeometry(t){this.tile.createGeometry(this.geometryState,this.localOrigin);const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new In(t,mr,{geometry:ch(i.layout)},{geometry:Fi.createVertex(t,s.STATIC_DRAW,i.buffer)},Fi.createIndex(t,s.STATIC_DRAW,r))}_releaseGeometry(){return!!this._vao&&(this._vao.dispose(),this._vao=null,qft(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=vg.Immediate){L(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Oi.ELEVATION],r=i.length;let s=new Array(r),n=0,a=0,l=!1;for(let p=0;p<r;p++){const y=i[p];if(y.upsampleInfo){const b=y.upsampleInfo.tile,x=b.layerInfo[Oi.ELEVATION][p].data,A=x&&x.samplerData;t&&t[n]===A||(l=!0),s[n++]=A,a=Math.max(a,b.lij[0])}else if(y.data){const b=this.tile.surface.layerViewByIndex(p,Oi.ELEVATION);if(WM(this.tile,b.layer,!1)){const x=y.data;t&&t[n]===x.samplerData||(l=!0),s[n++]=x.samplerData,a=this.tile.level}}}return L(t)&&t.length!==n&&(l=!0),n>0?s.length=n:s=null,{changed:l,samplerData:s,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const t=kc(this.intersectionData,0,i=>i.estimatedMemoryUsage)+kc(this.skirtIntersectionData,0,i=>i.estimatedMemoryUsage+i.vertexPositionBuffer.byteLength);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return L(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}}class S0t{constructor(){this.extent=nr(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class E0t{constructor(){this._queries=new Ci({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ci({initialSize:30}),this._queryPool=new mn(S0t)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();Yl(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}var _g,vw;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(_g||(_g={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(vw||(vw={}));function A0t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function C0t(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function M0t(e,t,i,r,s,n,a){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=a,e}function eTe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],l=t[5];let p=i*n-r*s;return p?(p=1/p,e[0]=n*p,e[1]=-r*p,e[2]=-s*p,e[3]=i*p,e[4]=(s*l-n*a)*p,e[5]=(r*a-i*l)*p,e):null}function R0t(e){return e[0]*e[3]-e[1]*e[2]}function tTe(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=i[0],b=i[1],x=i[2],A=i[3],M=i[4],P=i[5];return e[0]=r*y+n*b,e[1]=s*y+a*b,e[2]=r*x+n*A,e[3]=s*x+a*A,e[4]=r*M+n*P+l,e[5]=s*M+a*P+p,e}function YZ(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=Math.sin(i),b=Math.cos(i);return e[0]=r*b+n*y,e[1]=s*b+a*y,e[2]=r*-y+n*b,e[3]=s*-y+a*b,e[4]=l,e[5]=p,e}function iTe(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=i[0],b=i[1];return e[0]=r*y,e[1]=s*y,e[2]=n*b,e[3]=a*b,e[4]=l,e[5]=p,e}function JZ(e,t,i){const r=t[0],s=t[1],n=t[2],a=t[3],l=t[4],p=t[5],y=i[0],b=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=a,e[4]=r*y+n*b+l,e[5]=s*y+a*b+p,e}function O0t(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function P0t(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ZZ(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function I0t(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function $0t(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function D0t(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function rTe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function L0t(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function N0t(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function F0t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function k0t(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],l=e[5],p=t[0],y=t[1],b=t[2],x=t[3],A=t[4],M=t[5];return Math.abs(i-p)<=pi*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-y)<=pi*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(s-b)<=pi*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(n-x)<=pi*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-A)<=pi*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(l-M)<=pi*Math.max(1,Math.abs(l),Math.abs(M))}const U0t=tTe,z0t=rTe;Object.freeze({__proto__:null,copy:A0t,identity:C0t,set:M0t,invert:eTe,determinant:R0t,multiply:tTe,rotate:YZ,scale:iTe,translate:JZ,fromRotation:O0t,fromScaling:P0t,fromTranslation:ZZ,str:I0t,frob:$0t,add:D0t,subtract:rTe,multiplyScalar:L0t,multiplyScalarAndAdd:N0t,exactEquals:F0t,equals:k0t,mul:U0t,sub:z0t});function sTe(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function B0t(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function V0t(e,t,i,r,s,n){const a=new Float32Array(6);return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function G0t(e,t){return new Float32Array(e,t,6)}function nTe(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function j0t(e,t,i,r=0,s=0,n=2){const a=s||t.length/n;for(let l=r;l<a;l++)nTe(e,t,i,l*n)}Object.freeze({__proto__:null,create:sTe,clone:B0t,fromValues:V0t,createView:G0t,transform:nTe,transformMany:j0t});function T$(){return[1,0,0,1,0,0]}function H0t(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function q0t(e,t,i,r,s,n){return[e,t,i,r,s,n]}function W0t(e,t){return new Float64Array(e,t,6)}Object.freeze({__proto__:null,create:T$,clone:H0t,fromValues:q0t,createView:W0t});function X0t(e){return e instanceof Float32Array&&e.length>=2}function Y0t(e){return Array.isArray(e)&&e.length>=2}function $U(e){return X0t(e)||Y0t(e)}const J0t=96,Z0t=39.37;function KZ(e,t){return t.type?ds(e,t.x,t.y):Pn(e,t)}function K0t(e){return lh(e)}function Q0t(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const emt=function(){const e=St();return function(t,i,r){const s=i.targetGeometry;KZ(e,s);const n=.5*B8(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function B8(e){return e.scale*tmt(e.targetGeometry)}function tmt(e){return L(e)&&ml(e.spatialReference)?1/(K0t(e.spatialReference)*Z0t*J0t):1}function imt(e){return TL(e.rotation)||0}const QZ=function(){const e=St(),t=St(),i=St();return function(r,s,n,a,l,p){return XY(e,s),Wl(t,n,.5*p),ds(i,1/a*p,-1/a*p),ZZ(r,t),l&&YZ(r,r,l),iTe(r,r,i),JZ(r,r,e),r}}(),rmt=function(){const e=St();return function(t,i,r,s){const n=B8(i),a=imt(i);return KZ(e,i.targetGeometry),QZ(t,e,r,n,a,s)}}(),smt=function(){const e=St();return function(t,i,r,s){const n=B8(i);return KZ(e,i.targetGeometry),QZ(t,e,r,n,0,s)}}();function nmt(e){if(e.isWrappable){const t=lg(e);return t.valid[1]-t.valid[0]}return 0}function omt(e,t){return Math.round(nmt(e)/t)}var HH;const em=[0,0];let dy=HH=class extends Ye{constructor(e){super(e),this._viewpoint2D={center:St(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new ki,this.id=0,this.inverseTransform=T$(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=T$(),this.transformNoRotation=T$(),this.displayMat3=yg(),this.displayViewMat3=yg(),this.viewMat3=yg(),this.viewMat2d=sTe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Q0t(i,e.viewpoint),this._set("size",Pn(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new HH({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return $U(t)?wb(e,t,this.inverseTransform):(em[0]=t,em[1]=i,wb(e,em,this.inverseTransform))}toScreen(e,t,i){return $U(t)?wb(e,t,this.transform):(em[0]=t,em[1]=i,wb(e,em,this.transform))}toScreenNoRotation(e,t,i){return $U(t)?wb(e,t,this.transformNoRotation):(em[0]=t,em[1]=i,wb(e,em,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return QZ(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),a=new oh({targetGeometry:new Gt(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",a),!n||!t||!i)return;this.resolution=B8(a),this.rotation=r,this.scale=i,this.spatialReference=t,Pn(this.center,e);const l=n[0]!==0?2/n[0]:0,p=n[1]!==0?-2/n[1]:0;sJ(this.displayMat3,l,0,0,0,p,0,-1,1,1);const y=nJ(this.viewMat3),b=Ju(n[0]/2,n[1]/2),x=Ju(-n[0]/2,-n[1]/2),A=TL(r);gD(y,y,b),oJ(y,y,A),gD(y,y,x),UN(this.displayViewMat3,this.displayMat3,y);const M=ZZ(this.viewMat2d,b);return YZ(M,M,A),JZ(M,M,x),emt(this.extent,a,n),rmt(this.transform,a,n,s),eTe(this.inverseTransform,this.transform),smt(this.transformNoRotation,a,n,s),this.worldScreenWidth=omt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};_([S({readOnly:!0})],dy.prototype,"id",void 0),_([S({value:1,json:{write:!0}})],dy.prototype,"pixelRatio",null),_([S({json:{write:!0}})],dy.prototype,"size",null),_([S()],dy.prototype,"spatialReference",void 0),_([S({type:oh,json:{write:!0}})],dy.prototype,"viewpoint",null),dy=HH=_([re("esri.views.2d.ViewState")],dy);const amt=dy,lmt=.125;class cmt{constructor(){this._renderParams={context:null,drawPhase:1,state:new amt({viewpoint:new oh({targetGeometry:new Gt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,a,l,p,y,b){const x=a.adjustLevel(i[0]),A=this._renderParams;A.context=t,A.painter=s,A.glyphMosaic=s.glyphMosaic,A.spriteMosaic=s.spriteMosaic,A.pixelRatio=b,A.displayLevel=x,A.requiredLevel=x;const M=a.getScale(i[0]),[P,$]=a.getShift(i,l*M),k=lmt*l*M/y,z=r.transforms.dvs;z[0]=k,z[4]=-k,z[6]=-1-P-p[0]*l*2,z[7]=1+$+(1-p[1])*l*2-2,A.state.size[0]=y,A.state.size[1]=y,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(A,r,n)}}var wd;(function(e){e[e.NoAlpha=0]="NoAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.OneMinusSourceAlpha=2]="OneMinusSourceAlpha",e[e.COUNT=3]="COUNT"})(wd||(wd={}));function hmt(){const e=new Ir;return e.attributes.add(Y.POSITION,"vec2"),e.attributes.add(Y.UV0,"vec2"),e.vertex.uniforms.add("scale","float"),e.vertex.uniforms.add("offset","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(V`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("opacity","float"),e.fragment.code.add(V`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`),e}const umt=Object.freeze({__proto__:null,build:hmt});class gO extends Xr{initializeProgram(t){const i=gO.shader.get().build();return new $r(t.rctx,i,mr)}initializePipeline(){const t=this.configuration.mode===wd.OneMinusSourceAlpha?su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA):this.configuration.mode===wd.SourceAlpha?su(ht.ZERO,ht.SRC_ALPHA):null;return Ti({blending:t,colorWrite:Ii})}}gO.shader=new Ur(umt,()=>import("./BlendLayers.glsl.9257e3fb.js"));class qH extends Rs{constructor(){super(...arguments),this.mode=wd.NoAlpha}}_([Oe({count:wd.COUNT})],qH.prototype,"mode",void 0);function dmt(e){e.attributes.add(Y.POSITION,"vec2"),e.attributes.add(Y.UV0,"vec2"),e.vertex.uniforms.add("u_scale","float"),e.vertex.uniforms.add("u_offset","vec2"),e.varyings.add("v_texcoord","vec2"),e.vertex.code.add(V`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)}function pmt(e){e.fragment.uniforms.add("u_colormap","sampler2D"),e.fragment.uniforms.add("u_colormapOffset","float"),e.fragment.uniforms.add("u_colormapMaxIndex","float"),e.fragment.code.add(V`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)}function fmt(e){e.fragment.uniforms.add("u_transformGrid","sampler2D"),e.fragment.uniforms.add("u_transformSpacing","vec2"),e.fragment.uniforms.add("u_transformGridSize","vec2"),e.fragment.uniforms.add("u_targetImageSize","vec2"),e.fragment.code.add(V`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}function mmt(e){e.include(fmt),e.fragment.uniforms.add("u_image","sampler2D"),e.fragment.uniforms.add("u_isFloatTexture","bool"),e.fragment.uniforms.add("u_flipY","bool"),e.fragment.uniforms.add("u_applyTransform","bool"),e.fragment.uniforms.add("u_opacity","float"),e.fragment.code.add(V`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function gmt(e){const t=new Ir;return t.include(dmt),t.include(mmt),t.include(pmt),e.output===_g.Stretch?vmt(t,e):e.output===_g.Lut?ymt(t):e.output===_g.Hillshade&&_mt(t,e),t}function ymt(e){e.fragment.code.add(V`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`)}function vmt(e,t){e.fragment.uniforms.add("u_bandCount","int"),e.fragment.uniforms.add("u_minCutOff","float",3),e.fragment.uniforms.add("u_maxCutOff","float",3),e.fragment.uniforms.add("u_factor","float",3),e.fragment.uniforms.add("u_minOutput","float"),e.fragment.uniforms.add("u_maxOutput","float"),e.fragment.uniforms.add("u_useGamma","bool"),e.fragment.uniforms.add("u_gamma","float",3),e.fragment.uniforms.add("u_gammaCorrection","float",3),e.fragment.code.add(V`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?V`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:V`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;e.fragment.code.add(V`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===vw.Noop?V`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:V`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}function _mt(e,t){e.fragment.uniforms.add("u_hillshadeType","int"),e.fragment.uniforms.add("u_sinZcosAs","float",6),e.fragment.uniforms.add("u_sinZsinAs","float",6),e.fragment.uniforms.add("u_cosZs","float",6),e.fragment.uniforms.add("u_weights","float",6),e.fragment.uniforms.add("u_factor","vec2"),e.fragment.uniforms.add("u_applyColormap","bool"),e.fragment.uniforms.add("u_minValue","float"),e.fragment.uniforms.add("u_maxValue","float"),e.fragment.uniforms.add("u_srcImageSize","vec2"),e.fragment.include(P0),e.fragment.code.add(V`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),e.fragment.code.add(V`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?V`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:V`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`;e.fragment.code.add(V`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const bmt=Object.freeze({__proto__:null,build:gmt});class V8 extends Xr{get uniformLocationInfos(){return this._uniformLocationInfos||(this._uniformLocationInfos=p0t(this._context,this.program)),this._uniformLocationInfos}initializeProgram(t){const i=V8.shader.get(),r=this.configuration,s=i.build({output:r.colorizerType,applyColormap:r.applyColormap,stretchType:r.stretchType});return this._context=t.rctx,new $r(t.rctx,s,mr)}initializePipeline(){const t=this.configuration.mode===wd.OneMinusSourceAlpha?su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA):this.configuration.mode===wd.SourceAlpha?su(ht.ZERO,ht.SRC_ALPHA):null;return Ti({blending:t,colorWrite:Ii})}bindPass(t){IA(this.program,this.uniformLocationInfos,t.basic),IA(this.program,this.uniformLocationInfos,t.common),L(t.colormap)&&IA(this.program,this.uniformLocationInfos,t.colormap),this.configuration.colorizerType===_g.Stretch&&L(t.stretch)?IA(this.program,this.uniformLocationInfos,t.stretch):this.configuration.colorizerType===_g.Hillshade&&L(t.hillshade)&&IA(this.program,this.uniformLocationInfos,t.hillshade)}}V8.shader=new Ur(bmt,()=>import("./RasterColorizer.glsl.394b8a33.js"));class KC extends Rs{constructor(){super(...arguments),this.mode=wd.OneMinusSourceAlpha,this.colorizerType=_g.Stretch,this.stretchType=vw.Noop,this.applyColormap=!0}}_([Oe({count:wd.COUNT})],KC.prototype,"mode",void 0),_([Oe({count:_g.COUNT})],KC.prototype,"colorizerType",void 0),_([Oe({count:vw.COUNT})],KC.prototype,"stretchType",void 0),_([Oe()],KC.prototype,"applyColormap",void 0);class DU{constructor(t,i,r,s,n,a,l){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=_r(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=$t(s,l?a:0,n)}destroy(){this.texture.release()}}class wmt{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}release(t){this._getPool(t.width).release(t)}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=Hr.bind(Hr,this._rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.DEPTH_RENDER_BUFFER,width:t,height:t});i=new mn(r),this._pools.set(t,i)}return i}}class xmt{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._backgroundIsGrid=!1,this._backgroundTexture=null,this._backgroundColor=null,this._blackTex=null,this._vectorTileHelper=new cmt,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._vaoQuad=Ga(this._rctx,t4),this._blackTex=new Ry(Jse(this._rctx,[0,0,0,1])),this._fboPool=new wmt(this._rctx)}dispose(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null),this._vaoQuad=Xt(this._vaoQuad),this._backgroundTexture=es(this._backgroundTexture),this._blackTex=es(this._blackTex),this._blendLayersTechnique=es(this._blendLayersTechnique),this._applyOpacityTechnique=es(this._applyOpacityTechnique),this._vectorTileHelper=Xt(this._vectorTileHelper)}get blendLayersTechnique(){if(J(this._blendLayersTechnique)){const t=new qH;t.mode=wd.OneMinusSourceAlpha,this._blendLayersTechnique=this._techniqueRepository.acquire(gO,t)}return this._blendLayersTechnique}get applyOpacityTechnique(){if(J(this._applyOpacityTechnique)){const t=new qH;t.mode=wd.SourceAlpha,this._applyOpacityTechnique=this._techniqueRepository.acquire(gO,t)}return this._applyOpacityTechnique}get backgroundIsGrid(){return this._backgroundIsGrid}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){const r=t.layerInfo[Oi.MAP];for(const $ of r)$.pendingUpdates&=~(ci.TEXTURE_NOFADING&ci.TEXTURE_FADING);if(!t.renderData)return;const s=t.surface,n=s.baseOpacity;let a=0,l=0,p=this.tileSize,y=!1;const b=s.view.pixelRatio;let x=r.length,A=0;for(;A<r.length&&!y;A++){const $=s.layerViewByIndex(A,Oi.MAP),k=$.fullOpacity;if(NU[A]=k,wge($.layer)&&x>=r.length&&(x=A),k===0)continue;++l;const z=LU(t,A,FU);z&&(iL($)?p=Math.max(p,this.tileSize*b):n===1&&k===1&&($.isOpaque||this._dataToTexture(z)&&z.sourceLayerInfo.data.descriptor.isOpaque)&&(y=!0),++a)}this._cleanupFBOPool(b,r.length),p=Tmt(p);const M=p/this.tileSize,P=A-1;a!==0?a===1&&(y||this._backgroundIsGrid||L(this._backgroundColor))&&this._useLayerTexture(t,P,x,NU[P])||this._composeMapLayers(t,i,P,x,y,NU,p,M):this._useBackgroundTexture(t,l)}_useBackgroundTexture(t,i){let r=vg.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=vg.Delayed),this._backgroundTexture&&J(t.renderData.textureReference)&&(r=vg.Immediate),t.renderData.setTextureReference(L(this._backgroundTexture)?new DU(this._backgroundTexture,vo.FADING,qle,t.surface.baseOpacity,1,1,!1):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,a=n?1:t.surface.baseOpacity,l=n?t.surface.baseOpacity:1,p=LU(t,i,FU);return!!this._dataToTexture(p)&&(t.renderData.setTextureReference(new DU(p.sourceLayerInfo.data,vo.FADING,p,a,s,l,!0)),!0)}_composeMapLayers(t,i,r,s,n,a,l,p){const y=this._rctx,b=this._fboPool.acquire(l);y.bindFramebuffer(b),y.setViewport(0,0,l,l),y.setClearColor(0,0,0,0),y.setClearDepth(1),y.clearSafe(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT);let x=!1;!n&&L(this._backgroundTexture)&&this._drawRasterData(this.blendLayersTechnique,this._backgroundTexture.texture,1,LV);const A=t.surface.baseOpacity;let M=!1,P=Pt.LINEAR_MIPMAP_LINEAR;for(let B=r;B>=0;B--){const W=LU(t,B,FU);W&&(B<s&&A<1&&!M&&(this._drawRasterData(this.applyOpacityTechnique,this._blackTex.texture,1,LV,A),M=!0),a[B]!==0&&(Hpt(W)?x=this._drawVectorData(this.blendLayersTechnique,W,p,a[B],l,b,x):jpt(W)?(this._drawImageryTileData(W,a[B]),this._hasNearestInterpolation(W)&&(P=Pt.NEAREST)):this._dataToTexture(W)&&this._drawRasterData(this.blendLayersTechnique,W.sourceLayerInfo.data.texture,W.scale,W.offset,a[B])))}const $=t.renderData.ensureTexture(l,()=>this._buildTexture(l,P)),k=y.bindTexture($.texture,Vt.TEXTURE_UNIT_FOR_UPDATES),z=$.descriptor;y.gl.copyTexImage2D(y.gl.TEXTURE_2D,0,z.pixelFormat,0,0,z.width,z.height,0),$.generateMipmap(),y.bindTexture(k,Vt.TEXTURE_UNIT_FOR_UPDATES),y.bindFramebuffer(null),this._fboPool.release(b);const G=M?1:A;t.renderData.setTextureReference(new DU($,i,qle,G,1,1,!1))}_drawQuad(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(mi.TRIANGLE_STRIP,0,zo(this._vaoQuad,"geometry"))}_drawRasterData(t,i,r,s,n=1){if(J(i))return;const a=this._rctx.useTechnique(t);a.bindTexture(i,"tex"),a.setUniform1f("scale",r),a.setUniform2f("offset",s[0],s[1]),a.setUniform1f("opacity",n),this._drawQuad(a)}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_drawImageryTileData(t,i=1){const r=t.sourceLayerInfo.data;if(!r.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Oi.MAP).ensureSymbolizerParameters(r);const s=this._getRasterColorizerTechnique(r),n=this._rctx,a=n.useTechnique(s);if(!r.bind(n))return;r.opacity=i,r.scale=t.scale,r.offset=t.offset;const{names:l,textures:p}=r.getTextures();l.forEach((y,b)=>a.bindTexture(p[b],y)),s.bindPass(r.getUniforms()),this._drawQuad(a),n.bindVAO()}_getRasterColorizerTechnique(t){const i=t.symbolizerParameters,r=["stretch","lut","hillshade"].indexOf(i.type);return J(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new KC,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.colorizerType=r,this._rasterColorizerConfig.applyColormap=!!i.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?vw.Noop:vw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(V8,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}_drawVectorData(t,i,r,s,n,a,l){const p=this._rctx,y=i.sourceLayerInfo.data,b=i.tile.surface.layerViewByIndex(i.layerIndex,Oi.MAP);let x;return t.bindPipelineState(p),s<1?(x=this._fboPool.acquire(n),p.bindFramebuffer(x),p.setClearColor(1,1,1,0),p.clearSafe(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT)):l&&p.clearSafe(Sr.DEPTH_BUFFER_BIT),this._vectorTileHelper.render(p,i.sourceLod,y,b.painter,b.layer.styleRepository,b.schemaHelper,Math.round(1/i.scale),i.offset,this.tileSize,r),!L(x)||(p.bindFramebuffer(a),this._drawRasterData(t,x.colorTexture,1,[0,0],s),this._fboPool.release(x),l)}_dataToTexture(t){return Wpt(t)&&this._rasterDataToTexture(t),qpt(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t,i){es(this._backgroundTexture),this._backgroundIsGrid=i,t instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(t),this._backgroundColor=null):(this._backgroundTexture=new Ry(Jse(this._rctx,_r(t[0]||0,t[1]||0,t[2]||0,1))),this._backgroundColor=$t(t[0]||0,t[1]||0,t[2]||0))}_buildTexture(t,i=Pt.LINEAR_MIPMAP_LINEAR){if(J(t))return null;const r={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new Ry(new Vt(s,r));else if(t instanceof pO)r.isOpaque=t.isOpaque,n=new Ry(new Vt(s,r,t.image)),t.release();else try{n=new Ry(new Vt(s,r,t))}catch{n=new Ry(F_e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(n.texture,Vt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(a,Vt.TEXTURE_UNIT_FOR_UPDATES),n}_cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPool.clear(),this._lastPixelRatio=t,this._lastNumLayers=i)}get test(){return{backgroundTexture:this._backgroundTexture}}}function Tmt(e){const t=XT(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function LU(e,t,i){i.layerIndex=t;const r=e.layerInfo[Oi.MAP][t];if(r.data)return ds(i.offset,0,0),i.tile=e,i.scale=1,i.sourceLod=e.lij,i.sourceLayerInfo=r,i;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[Oi.MAP][t];return i.tile=s.tile,Pn(i.offset,s.offset),i.scale=s.scale,i.sourceLod=s.tile.lij,i.sourceLayerInfo=n,i}return null}const NU=new Array,FU={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},qle={offset:[0,0],scale:1},WH=40,Wle=20,Smt=.8,Emt=15,QC=1e-6;function Amt(e,t,i){const r=t,s=i;let n=0,a=1/0;for(let l=0;l<3;++l){{const p=e[l];if(r[l]<p){if(s[l]<=QC)return!1;const y=(p-r[l])/s[l];n=Math.max(n,y)}else if(s[l]<=-QC){const y=(p-r[l])/s[l];a=Math.min(a,y)}if(n>a)return!1}{const p=e[l+3];if(r[l]>p){if(s[l]>=-QC)return!1;const y=(p-r[l])/s[l];n=Math.max(n,y)}else if(s[l]>=QC){const y=(p-r[l])/s[l];a=Math.min(a,y)}if(n>a)return!1}}return!0}class Xle{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class _w{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=Q(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,a=n<=oTe?new Uint16Array(n):new Uint32Array(n);this.indices=a;for(let l=0;l<n;++l)a[l]=l;{const l=Pmt(t,i,r,s.data,s.stride),p=(y,b,x)=>{const A=Rmt(a,l,y,b),M=b-y;if(M<=Wle){const B=new Xle(A,void 0,0,y,b);return this.bspNodeTree.push(B),B}const{axis:P,midValue:$}=Omt(A),k=Mmt(a,l,y,b,P,$),z=(B,W)=>{if(x>Emt)return;const q=W-B;return q<Wle||q>=Smt*M?void 0:p(B,W,x+1)},G=new Xle(A,P,$,k.next,k.mid);return this.bspNodeTree.push(G),G.leftNode=z(y,k.next),G.rightNode=z(k.mid,b),G};p(0,n,0),this.triangleVertexIndices=Imt(a,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,a=this.rayOrigin,l=a[0],p=a[1],y=a[2],b=this.rayDirection,x=b[0],A=b[1],M=b[2];for(let P=t,$=3*t;P<i;++P){const k=r[$]*n,z=s[k],G=s[k+1],B=s[k+2],W=r[$+1]*n,q=s[W],X=s[W+1],oe=s[W+2],de=r[$+2]*n,he=s[de],fe=s[de+1],me=s[de+2];$+=3;const ge=q-z,Ce=X-G,Ae=oe-B,Pe=he-z,De=fe-G,ne=me-B,pe=A*ne-De*M,ye=M*Pe-ne*x,we=x*De-Pe*A,Ee=ge*pe+Ce*ye+Ae*we;if(Math.abs(Ee)<=Number.EPSILON)continue;const Ie=l-z,xe=p-G,$e=y-B,et=Ie*pe+xe*ye+$e*we;if(Ee>0){if(et<0||et>Ee)continue}else if(et>0||et<Ee)continue;const ct=xe*Ae-Ce*$e,Mt=$e*ge-Ae*Ie,at=Ie*Ce-ge*xe,nt=x*ct+A*Mt+M*at;if(Ee>0){if(nt<0||et+nt>Ee)continue}else if(nt>0||et+nt<Ee)continue;const dt=(Pe*ct+De*Mt+ne*at)/Ee;if(dt>=0){const xt=this.indices[P]+this.firstTriangleIndex,wr=c4(ge,Ce,Ae,Pe,De,ne,Cmt);this.callback(dt,wr,xt,!1)}}}_w.numFacesTested+=i-t}intersectRay(t,i){_w.numFacesTested=0;const r=$t(t.r0[0],t.r0[1],t.r0[2]),s=$t(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],a=s[1]-r[1],l=s[2]-r[2];if(n*n+a*a+l*l<QC)return;this.rayOrigin=r;const p=this.rayDirection;p[0]=n,p[1]=a,p[2]=l;const y=this.triangleVertexIndices.length/3;this.callback=i;const b=this.bspNodeTree[0];this.intersectRayBSP(b,0,y)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!Amt(t.aabb,s,n))return;const a=t.axis,l=t.d;if(s[a]<l||n[a]<0){const p=i,y=t.midStartIndex;if(p<y){const b=t.leftNode;b!==void 0?this.intersectRayBSP(b,p,y):this.intersectRayTriangleRange(p,y)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[a]>l||n[a]>0){const p=t.rightStartIndex,y=r;if(p<y){const b=t.rightNode;b!==void 0?this.intersectRayBSP(b,p,y):this.intersectRayTriangleRange(p,y)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}_w.numFacesTested=0;const Cmt=Q(),Ex=[1/0,1/0,1/0],Ax=[-1/0,-1/0,-1/0];function Mmt(e,t,i,r,s,n){let a=i,l=r;for(;a<l;){const y=e[a];t[6*y+s+3]<=n?++a:(--l,e[a]=e[l],e[l]=y)}let p=a;for(l=r;p<l;){const y=e[l-1];t[6*y+s]>=n?--l:(e[l-1]=e[p],e[p]=y,++p)}return{next:a,mid:p}}function Rmt(e,t,i,r){if(r<=i)return q2(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)Ex[n]=t[s+0+n],Ax[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let a=0;a<3;++a)Ex[a]=Math.min(Ex[a],t[n+0+a]),Ax[a]=Math.max(Ax[a],t[n+3+a])}return q2(Ex[0],Ex[1],Ex[2],Ax[0],Ax[1],Ax[2])}function Omt(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function Pmt(e,t,i,r,s){const n=i-t,a=new Float32Array(6*n);for(let l=0;l<n;++l){const p=3*(l+t),y=e[p+0]*s,b=e[p+1]*s,x=e[p+2]*s;for(let A=0;A<3;++A){const M=r[y+A],P=r[b+A],$=r[x+A];a[6*l+A]=Math.min(M,P,$),a[6*l+3+A]=Math.max(M,P,$)}}return a}function Imt(e,t,i,r){const s=r-i;let n=0;for(let l=i;l<r;++l)for(let p=0;p<3;++p)n=Math.max(t[3*l+p],n);const a=n<=oTe?new Uint16Array(3*s):new Uint32Array(3*s);for(let l=0;l<s;++l){const p=3*(e[l]+i);for(let y=0;y<3;++y){const b=t[p+y];a[3*l+y]=b}}return a}const oTe=65535;var Ku;function XH(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==fi.Water&&t.pbrMode!==fi.WaterOnIntegratedMesh||e.include(qwe,t),e.vertex.uniforms.add("overlayTexOffset","vec4"),e.vertex.uniforms.add("overlayTexScale","vec4"),e.varyings.add("vtcOverlay","vec4"),e.vertex.code.add(V`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),e.fragment.uniforms.add("ovColorTex","sampler2D"),e.fragment.uniforms.add("overlayOpacity","float"),e.fragment.code.add(V`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.fragment.code.add(V`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==fi.Water&&t.pbrMode!==fi.WaterOnIntegratedMesh||(e.include(NN),e.fragment.code.add(V`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Ku||(Ku={}));function $mt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.viewingMode===vt.Global?e.vertex.code.add(V`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(V`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(V`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function Dmt(e){e.vertex.code.add(V`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)}function Lmt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add("texOffsetAndScale","vec4"),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("textureOpacities","vec3"),t.textureFadingEnabled&&(e.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add("texNext","sampler2D"),e.fragment.uniforms.add("nextTexOpacities","vec3"),e.fragment.uniforms.add("fadeFactor","float")),e.vertex.code.add(V`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${t.textureFadingEnabled?V`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:V``}
  }`),t.useGrid?(e.fragment.code.add(V`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),e.fragment.code.add(V`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):t.hasBackgroundColor?(e.fragment.uniforms.add("backgroundColor","vec3"),e.fragment.code.add(V`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):e.fragment.code.add(V`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`),t.textureFadingEnabled?e.fragment.code.add(V`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(V`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}function Nmt(e){const t=new Ir;if(t.include(Pxe,{name:"Terrain Shader",output:e.output}),t.include(Dmt),t.attributes.add(Y.POSITION,"vec3"),t.attributes.add(Y.UV0,"vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float"),t.fragment.uniforms.add("origin","vec3"),e.output===Te.Color){t.include(da,{linearDepth:!1}),t.include(rv,e),t.include(Lmt,e),t.include(mw,e);const i=e.overlayMode!==Ku.Disabled,r=e.overlayMode===Ku.EnabledWithWater;i&&t.include(XH,{pbrMode:fi.Water,useCustomDTRExponentForWater:!1,ssrEnabled:e.ssrEnabled,highStepCount:e.highStepCount}),r&&t.include($mt,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),e.receiveShadows&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(t.vertex.uniforms.add("lightingMainDirection","vec3"),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.vertex.uniforms.add("screenSizePerspective","vec4"),t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),t.vertex.code.add(V`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${e.atmosphere?V`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?V`vuv = uv;`:""}
        ${e.screenSizePerspective?V`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${e.receiveShadows?V`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${i?V`setOverlayVTC(uv);`:""}
        ${r?V`forwardVertexTangent(vnormal);`:V``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Ws,e),t.include(mw,e),t.fragment.uniforms.add("cameraPosition","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4"),e.screenSizePerspective&&t.fragment.uniforms.add("screenSizePerspective","vec4"),r&&(t.fragment.uniforms.add("ovWaterTex","sampler2D"),t.fragment.uniforms.add("view","mat4")),t.fragment.code.add(V`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),t.fragment.code.add(V`
      void main() {
        ${e.receiveShadows?V`float shadow = readShadowMap(vpos, linearDepth);`:V`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor();
        ${i?V`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?V`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?V`atm + tileColor.rgb;`:V`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${r?V`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?V`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?V`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==Te.Depth&&e.output!==Te.Shadow||(t.include(da,{linearDepth:!0}),t.include(Zv,{output:e.output}),t.include(rv,e),t.varyings.add("linearDepth","float"),t.vertex.uniforms.add("nearFar","vec2"),t.vertex.code.add(V`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),t.fragment.code.add(V`void main() {
outputDepth(linearDepth);
}`)),e.output===Te.Normal&&(t.include(da,{linearDepth:!1}),t.include(rv,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),t.vertex.code.add(V`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),t.fragment.code.add(V`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===Te.Highlight&&(t.include(da,{linearDepth:!1}),t.include(rv,e),t.include(XH,{pbrMode:fi.Disabled}),t.vertex.code.add(V`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Yg),t.fragment.code.add(V`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const Fmt=Object.freeze({__proto__:null,build:Nmt});class G8 extends Xr{constructor(){super(...arguments),this.useStencil=!1}initializeProgram(t){const i=G8.shader.get(),r=this.configuration,s=i.build({overlayMode:r.overlayMode,output:r.output,viewingMode:t.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:r.textureFadingEnabled&&!r.renderOccluded,hasBackgroundColor:r.hasBackgroundColor,useGrid:r.useGrid,receiveShadows:r.receiveShadows&&!r.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:r.atmosphere,tileBorders:r.tileBorders,screenSizePerspective:r.screenSizePerspective,pbrMode:fi.Disabled,ssrEnabled:r.ssrEnabled,highStepCount:!1});return new $r(t.rctx,s,mr)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ti({blending:i.renderOccluded?su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA):null,culling:r&&YY,depthTest:!i.renderOccluded&&{func:kr.LESS},depthWrite:!i.renderOccluded&&ac,colorWrite:Ii,stencilTest:t?Vnt(ic.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}G8.shader=new Ur(Fmt,()=>import("./Terrain.glsl.e22dd4a1.js"));class Dl extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.overlayMode=Ku.Disabled,this.atmosphere=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.hasBackgroundColor=!1,this.useGrid=!1,this.renderOccluded=!1,this.ssrEnabled=!1,this.tileBorders=!1,this.screenSizePerspective=!1}}_([Oe({count:Te.COUNT})],Dl.prototype,"output",void 0),_([Oe({count:Ku.COUNT})],Dl.prototype,"overlayMode",void 0),_([Oe()],Dl.prototype,"atmosphere",void 0),_([Oe()],Dl.prototype,"receiveShadows",void 0),_([Oe()],Dl.prototype,"slicePlaneEnabled",void 0),_([Oe()],Dl.prototype,"backfaceCullingEnabled",void 0),_([Oe()],Dl.prototype,"stencilEnabled",void 0),_([Oe()],Dl.prototype,"textureFadingEnabled",void 0),_([Oe()],Dl.prototype,"hasBackgroundColor",void 0),_([Oe()],Dl.prototype,"useGrid",void 0),_([Oe()],Dl.prototype,"renderOccluded",void 0),_([Oe()],Dl.prototype,"ssrEnabled",void 0),_([Oe()],Dl.prototype,"tileBorders",void 0),_([Oe()],Dl.prototype,"screenSizePerspective",void 0);const kU=7,kmt=10,nI=On(),oI=nr();let nl=class extends st{constructor(e){super(e),this.type=Ts.TERRAIN,this.isGround=!0,this.tileSize=256,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new E0t,this.renderDataPool=new mn(T0t),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new Y3e,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._skirtScale=1,this._velvetOverground=!0,this.castShadows=!0,this._ssrEnabled=!1,this.emptyTex=null,this.tileRenderer=null,this.tileBackgroundInitialized=!1,this.tileBackgroundUpdating=!1,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.overlayOpacity=1,this.needsHighlight=!1,this.renderOccludedFlags=qs.Occlude}get isGlobal(){return this.stage.viewingMode===vt.Global}initialize(){const e=[tt.OPAQUE_TERRAIN,tt.TRANSPARENT_TERRAIN,tt.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),Hft()}get updating(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}get canRender(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}set skirtScale(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())}get skirtScale(){return this._skirtScale}get renderPatchBorders(){return!!this.shaderTechniqueConfig.tileBorders}set renderPatchBorders(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this.shaderTechniqueConfig.backfaceCullingEnabled}set cullBackFaces(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Yb}get slicePlaneEnabled(){return this.shaderTechniqueConfig.slicePlaneEnabled}set slicePlaneEnabled(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}set textureFadingEnabled(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?jD:qs.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}loadTile(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e,ci.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e,t===ci.TEXTURE_FADING?vo.FADING:vo.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometry(e){for(const t of e.layerInfo[Oi.ELEVATION])t.pendingUpdates&=~ci.GEOMETRY;e.resetPendingUpdate(ci.GEOMETRY),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){e.renderData&&(e.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=kmt-kU,i=Math.max(0,Math.floor((e.level-t)/kU)*kU);if(this.isGlobal&&i===0)return Jc;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{var i;return(i=t.renderData)==null?void 0:i.updateGeometry(this.rctx,e)}),this.setNeedsRender())}setNeedsRender(e=An.UPDATE){this.patchGroupsDirty=!0,this.context.requestRender(e)}setTileBackground(e){this.tileBackground=e,this._updateTileBackground()}initializeRenderContext(e){this.context=e,this.rctx=e.renderContext.rctx,this.shaderTechniques=e.shaderTechniqueRepository,this.shaderTechniqueConfig=new Dl,this.tileRenderer=new xmt(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=F_e(this.rctx)}uninitializeRenderContext(){this.emptyTex!=null&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=zmt,n=Bmt;We(s,r,i),ze(n,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,p=e.results.ground,y=e.options.store===ma.MIN,b=!!e.results.ground.target,x=JZe(e.verticalOffset),A=this._skirtScale,M=e.tolerance;let P,$=y&&L(a.dist)?a.dist:1/0;const k=G=>{const B=G.renderData;if(B==null)return;const W=B.geometryInfo;VL(nI,W.boundingBox);const q=B.localOrigin;L(x)&&(x.localOrigin=q,x.applyToAabb(nI));const X=-A*W.skirtLength;if(X!==0){const Pe=G.up;y6e(nI,X*Pe[0],X*Pe[1],X*Pe[2])}const oe=nI;if(tm[0]=i[0]-q[0],tm[1]=i[1]-q[1],tm[2]=i[2]-q[2],!GJ(oe,tm,n,M,$))return;const de=(Pe,De,ne)=>{Pe.set(this.type,G,De,ne,Rn),$=y&&L(a.dist)?a.dist:1/0},he=(Pe,De)=>{if(L(De)&&Pe>=0&&(e.options.backfacesTerrain||rt(De,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,Pe))){if((p.dist==null||Pe<p.dist)&&de(p,Pe,De),e.options.isFiltered)return;e.options.store===ma.ALL&&(J(P)?(P=jN(e.ray),de(P,Pe,De),e.results.all.push(P)):Pe<P.dist&&de(P,Pe,De)),(a.dist==null||Pe<a.dist)&&de(a,Pe,De),e.options.store!==ma.MIN&&(l.dist==null||Pe>l.dist)&&de(l,Pe,De)}},fe=Vmt;We(fe,r,q);const me=W.indices,ge=W.vertexAttributes,Ce={data:ge.getField(Y.POSITION,Cr).typedBuffer,size:3,stride:ge.stride/4},Ae=W.numWithoutSkirtIndices/3;if(!L(x)&&Ae>WH){const Pe=G.renderData;L(Pe.intersectionData)||(Pe.intersectionData=new _w(me,0,Ae,Ce)),Pe.intersectionData.intersectRay({r0:tm,r1:fe},he)}else l4(tm,fe,0,Ae,me,Ce,null,x,he);if(X!==0){const Pe=me.length/3;if(this.isGlobal){const De=Pe-Ae;if(!L(x)&&De>WH){const ne=G.renderData;if(!L(ne.skirtIntersectionData)){const pe=Qft(me,Ae,Pe,ge,X,q);ne.skirtIntersectionData=new _w(pe.indices,0,De,{data:pe.vertices,stride:3})}ne.skirtIntersectionData.intersectRay({r0:tm,r1:fe},he)}else Kft(tm,fe,Ae,Pe,me,ge,X,q,x,he)}else e0t(tm,fe,Ae,Pe,me,ge,X,x,he)}},z=this._rootTiles;L(z)&&(()=>{const G=this.tileIterator;G.reset(z);const B=e.options.invisibleTerrain;for(;!G.done;){const W=G.next();!(W.visible||B&&W.intersectsClippingArea)||!L(x)&&!W.intersectsRay(i,s,M,$,A)||b&&this._useStencilForTile(W)?G.skipSubtree():k(W)}})()}prepareTechnique(e){if(e.slot===tt.OCCLUDED_TERRAIN){if((e.renderOccludedMask&jD)==0)return null}else{const t=this.opaque?tt.OPAQUE_TERRAIN:tt.TRANSPARENT_TERRAIN;if(e.slot!==t)return null}switch(e.pass){case bt.MATERIAL:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const i=this.overlayRenderer.isEmpty()?Ku.Disabled:this.overlayRenderer.hasWater?Ku.EnabledWithWater:Ku.Enabled;this.shaderTechniqueConfig.overlayMode!==i&&(this.shaderTechniqueConfig.overlayMode=i);const r=e.slot===tt.OCCLUDED_TERRAIN?ia.Occluded:ia.ColorAndWater;return this._updateTechnique(Te.Color,r===ia.Occluded)}case bt.MATERIAL_DEPTH_SHADOWMAP_ALL:case bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this.castShadows&&e.scenelightingData.globalFactor===1?this._updateTechnique(Te.Shadow,!1):null;case bt.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:this._updateTechnique(Te.Depth,!1);case bt.MATERIAL_NORMAL:return this._updateTechnique(Te.Normal,!1);case bt.MATERIAL_HIGHLIGHT:return this.needsHighlight?this._updateTechnique(Te.Highlight,!1):null}return null}render(e,t){const i=e.pass,r=e.scenelightingData.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case bt.MATERIAL:{const s=e.slot===tt.OCCLUDED_TERRAIN?ia.Occluded:ia.ColorAndWater;this._renderMaterialPass(e,t,s);break}case bt.MATERIAL_DEPTH_SHADOWMAP_ALL:case bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this.castShadows&&r&&this._renderAuxiliaryPass(e,t,ia.None);break;case bt.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,ia.None);break;case bt.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,ia.None);break;case bt.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,ia.Highlight),e.rctx.clearSafe(Sr.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r,camera:s}=e;this._ssrEnabled=e.ssrParams.ssrEnabled;const n=r.useTechnique(t,e.slot);this.shaderTechniqueConfig.overlayMode!==Ku.Disabled&&i===ia.ColorAndWater&&e.ssrParams&&pZ(n,e.ssrParams),e.shadowMap.bind(n),e.ssaoHelper.bind(n,e.camera),this._bindOverlayData(n,i),n.setUniformMatrix4fv("viewNormal",s.viewInverseTransposeMatrix),hh(n,s.projectionMatrix),e.scenelightingData.setUniforms(n,!0,!1);const a=s.viewMatrix;ze(aI,a[12],a[13],a[14]),ot(aI,aI),n.setUniform3fv("viewDirection",aI),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx.useTechnique(t,e.slot);if(e.pass===bt.MATERIAL_HIGHLIGHT){const s=e.offscreenRenderingHelper;r.bindTexture(s.depthTexture,"depthTex"),r.setUniform4f("highlightViewportPixelSz",0,0,1/s.width,1/s.height)}else r.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),e.pass!==bt.MATERIAL_DEPTH&&e.pass!==bt.MATERIAL_DEPTH_SHADOWMAP_ALL&&e.pass!==bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||r.setUniform2fv("nearFar",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,t,i)}_updateTileBackground(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid,this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!L(this.tileRenderer.backgroundColor),this.allTiles.forAll(t=>this.tileRenderer.updateTileTexture(t,vo.FADING)),this.setNeedsRender()};if(typeof this.tileBackground=="string"){const t=this.tileBackground;yd(t).then(i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i,this.tileBackground===jve),e())})}else{const t=this.tileBackground?Ft.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t,!1),e()}}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==mO.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>J3e(this.renderOrder,t)),e.sort((t,i)=>Z3e(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(!J(e)){this._patchGroups.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){t.program.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.program.setUniform1f("skirtScale",this._skirtScale),i!==ia.None&&this._bindOverlayData(t.program,i);const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;this._bindPatchGroupData(t.program,n,e.camera.eye,e.camera.viewMatrix);for(let a=0;a<s.length;a++)this._renderPatch(e,t,s[a],mi.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.camera,n=s.viewMatrix,a=t.program;if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const A=C2e(this.stage.viewingMode,this.ellipsoidRadius),M=this.pointsOfInterest.centerOnSurfaceFrequent.distance;A.update({distance:M,fovY:s.fovY}),eO(A,a,"screenSizePerspective")}const l=this.stencilEnabledLayerExtents.length>0,p=i===ia.Occluded;p&&(a.bindTexture(this.emptyTex,"tex"),a.setUniform1f("blend",1),a.setUniform4fv("texOffsetAndScale",E2));const y=L(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:Jc;this.shaderTechniqueConfig.hasBackgroundColor&&a.setUniform3fv("backgroundColor",y);const b=p?0:this._skirtScale;a.setUniform1f("skirtScale",b);const x=this.wireframe?mi.LINES:mi.TRIANGLES;this.shaderTechniqueConfig.textureFadingEnabled&&a.bindTexture(this.emptyTex,"texNext"),this._patchGroups.forEach(A=>{const M=A[0].renderData.localOrigin;this._bindPatchGroupData(a,M,s.eye,n);const P=e.sliceHelper&&e.sliceHelper.plane;Nv(a,t.configuration,P,{origin:M}),e.shadowMap&&e.shadowMap.bindView(a,M),this.numOriginsRendered++;for(let $=0;$<A.length;$++){const k=A[$],z=k.renderData.textureReference;if(!J(z)){if(!p){this._scaleRangeQueries.scaleQueriesForTile(k),Yle(k.renderData.geometryInfo.uvOffsetAndScale,z.offsetAndScale,oI),a.setUniform4fv("texOffsetAndScale",oI),a.bindTexture(z.texture.texture,"tex");const G=k.renderData.textureFadeFactor,B=G<1?k.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&L(B)&&G<1?(Yle(k.renderData.geometryInfo.uvOffsetAndScale,B.offsetAndScale,oI),a.setUniform1f("fadeFactor",G),a.setUniform4fv("nextTexOffsetAndScale",oI),a.setUniform3fv("nextTexOpacities",B.opacities),a.bindTexture(B.texture.texture,"texNext")):a.setUniform1f("fadeFactor",1),k.renderData.textureIsFading&&this.setNeedsRender(),a.setUniform3fv("textureOpacities",z.opacities)}this._renderPatch(e,t,k,x,l,i),k.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){if(J(i.renderData.vao.indexBuffer))return;const a=t.program;n!==ia.None&&this._bindOverlayPatchData(a,i.renderData.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.slot));const l=this._skirtScale===0?i.renderData.geometryInfo.numWithoutSkirtIndices:i.renderData.vao.indexBuffer.size;e.rctx.bindVAO(i.renderData.vao),a.assertCompatibleVertexAttributeLocations(i.renderData.vao),e.rctx.drawElements(r,l,i.renderData.vao.indexBuffer.indexType,0)}_bindPatchGroupData(e,t,i,r){e.setUniform3fv("origin",t),yl(Jle,r,t),e.setUniformMatrix4fv("view",Jle),e.setUniform3f("cameraPosition",i[0]-t[0],i[1]-t[1],i[2]-t[2])}_bindOverlayData(e,t){if(this.shaderTechniqueConfig.overlayMode===Ku.Disabled)return;e.setUniform1f("overlayOpacity",this.overlayOpacity);const i=this.overlayRenderer.overlays;if(i.length>Tn.INNER){const r=i[Tn.INNER],s=r.getColorTexture(t);if(e.bindTexture(L(s)?s:this.emptyTex,"ovColorTex"),this.shaderTechniqueConfig.overlayMode===Ku.EnabledWithWater){const n=r.getNormalTexture(t);e.bindTexture(L(n)?n:this.emptyTex,"ovWaterTex")}}}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this.shaderTechniqueConfig.output=e,e===Te.Color&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled),this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this._shaderTechnique=this.shaderTechniques.releaseAndAcquire(G8,this.shaderTechniqueConfig,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};_([S()],nl.prototype,"tileBackgroundInitialized",void 0),_([S()],nl.prototype,"tileBackgroundUpdating",void 0),_([S({constructOnly:!0})],nl.prototype,"overlayRenderer",void 0),_([S({constructOnly:!0})],nl.prototype,"stage",void 0),_([S({readOnly:!0})],nl.prototype,"isGlobal",null),_([S({constructOnly:!0})],nl.prototype,"allTiles",void 0),_([S({constructOnly:!0})],nl.prototype,"ellipsoidRadius",void 0),_([S({readOnly:!0})],nl.prototype,"updating",null),_([S({value:!1})],nl.prototype,"renderingDisabled",null),_([S()],nl.prototype,"renderPatchBorders",null),_([S()],nl.prototype,"cullBackFaces",null),_([S({value:mO.FRONT_TO_BACK})],nl.prototype,"renderOrder",null),_([S()],nl.prototype,"wireframe",null),nl=_([re("esri.views.3d.terrain.TerrainRenderer")],nl);const Umt=nl;function Yle(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const Jle=lt(),aI=Q(),zmt=Q(),Bmt=Q(),tm=Q(),Vmt=Q();class Gmt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let Df=class extends st{constructor(e){super(e),this._handles=new Ei}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Ht(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!TM(t)||t.isRejected())&&!(t.isFulfilled()&&!jmt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!N3e(t)&&!tL(t))),e)if(e.isResolved()){const t=k8(e,this.viewSpatialReference,this.viewingMode);if(L(t)){const i=new gs(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===vt.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=gs.makeWebMercatorAuxiliarySphere(t):J2(e.spatialReference)&&(e=gs.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===vt.Global){const e=this.extentHelper.viewSpatialReference,t=J2(e)||S0(e)||E0(e);e.isWebMercator?this.tilingScheme=gs.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=gs.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;L(e)&&!w2(e,this.extent)&&(this.tilingScheme=gs.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function jmt(e,t,i){return L(k8(e,t,i))}_([S()],Df.prototype,"tilingScheme",void 0),_([S({readOnly:!0})],Df.prototype,"extent",void 0),_([S({value:!1})],Df.prototype,"tilingSchemeLocked",void 0),_([S({constructOnly:!0})],Df.prototype,"viewSpatialReference",void 0),_([S({constructOnly:!0})],Df.prototype,"layers",void 0),_([S({constructOnly:!0})],Df.prototype,"extentHelper",void 0),_([S({constructOnly:!0})],Df.prototype,"viewingMode",void 0),Df=_([re("esri.views.3d.terrain.TilingSchemeLogic")],Df);class Hmt{constructor(){this.offset=St(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const Dd=Ge.getLogger("esri.views.3d.terrain.TerrainSurface"),qmt=.25;let $i=class extends ps.EventedMixin(st){constructor(e){super(e),this._elevationBounds=new VZ,this._iteratorPool=new mn(Y3e,t=>t.remove=()=>this._iteratorPool.release(t)),this._postorderIterator=new t0t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=LA,this._performanceInfo=new Gmt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=Q(),this._eyePosSurfaceSR=Q(),this._splitLimits=new y0t,this._snapLevel=1/0,this._frustum=JR(),this._viewProjectionMatrix=lt(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ei,this._watchUpdatingTracking=new t0,this._frameTask=AS,this._allTiles=new Ci,this._upsampleInfoPool=new mn(Hmt),this._rootTilesExtent=Mi(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundImage=jve,this.backgroundColor=null,this._layerViewsDirty=!1}initialize(){this._lercDecoder=yft(this.view.resourceController),this._tilePool=this.view.state.isLocal?new mn(b0t):new mn(w0t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new mft(e.newCache("elevation-query")),this._set("overlayManager",new sl({surface:this})),this._handles.add([this.watch("overlayManager.hasHighlights",s=>this._renderer.setNeedsHighlight(s)),this.watch("overlayManager.rendersOccluded",s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new Umt({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:ir(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([Pi(this,"baseOpacity",s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},!0),Pi(this,"_background",()=>{this._handleLayerViewChanges(),this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),Pi(ur,"TERRAIN_TILE_TREE_SHOW_TILES",s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.0745d0c6.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&ur.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=Ht(this._treeDebugger))})]),this._extentHelper=Fft(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new MT({getCollections:()=>{var s,n,a;return(s=this.view)==null||(n=s.defaultsFromMap)==null||(a=n.mapCollections)==null?void 0:a.map(({layers:l})=>l)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new Df({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Yf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Yf.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(ii.TERRAIN_SURFACE,this),this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate()),this._handles.add([Pi(this._extentHelper,"stencilEnabledExtents",s=>this._renderer.setStencilEnabledLayerExtents(s)),this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingScheme(),!0),Pi(this,"extent",()=>this._updateRootTiles()),this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),Pi(this.view,"qualitySettings.tiledSurface.textureFadeDuration",s=>this._renderer.textureFadingEnabled=s>0),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),vi(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Pc)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=es(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Ht(this._upsampleMapCache),this._elevationQueryCache=Ht(this._elevationQueryCache),this._set("tilingSchemeLogic",Ht(this.tilingSchemeLogic)),this._extentHelper=Ht(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ht(this.overlayManager)),this._tilePool=Ht(this._tilePool),qZ.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=Ht(this._renderer),this._iteratorPool=Ht(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Ht(this._upsampleInfoPool),Oft(),m0t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;const i=(e=this.view.pointsOfInterest)==null||(t=e.contentCameraOnSurface)==null?void 0:t.scale;if(i){const r=this.view.state.contentCamera;let s=XN(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,a=f2e(this.view,i)-n;Math.abs(this._snapLevel-a)>qmt&&(Math.round(a)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=a)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?YS.ON:YS.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(J(t)||J(e))return null;const i=Mi(),r=w3e(t,i,e)?i:null,s=this._get("extent");return w2(r,s)?s:r}get extent(){const e=o9(this.groundExtent,this._userClippingExtent,Mi()),t=this._get("extent");return w2(e,t)?t:e}get groundExtent(){return L(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return L(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}set skirtScale(e){this._renderer.skirtScale=e}get skirtScale(){return this._renderer.skirtScale}get spatialReference(){var e,t;return(e=(t=this.tilingScheme)==null?void 0:t.spatialReference)!=null?e:null}get _background(){return this.backgroundColor!=null?this.backgroundColor:this.backgroundImage}set slicePlaneEnabled(e){var t,i;this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),(t=this.view)==null||(i=t._stage)==null||i.renderView.setRenderParameters({opaqueTerrain:this.opaque})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Ld);return J(s)?null:GZ(Ld[0],Ld[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Ld){var n;const a=this.rootTiles;if(J(a)||!a.length||a[0].layerInfo[Oi.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!Ho(s,r,s,(n=this.tilingScheme)==null?void 0:n.spatialReference))return Dd.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let l of a){if(!l.containsPoint(s))continue;for(;l&&!l.rendered&&!l.isLeaf;){let y=0;s[0]>.5*(l.extent[0]+l.extent[2])&&(y+=1),s[1]<.5*(l.extent[1]+l.extent[3])&&(y+=2),l=l.children[y]}const p=l.renderData;return(p?p.geometryState.samplerData:null)?l:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!To(e,Ld,this.spatialReference))return Dd.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(L(t)){for(let i of t)if(i.containsPoint(Ld)){for(;i.children[0]!=null;){let r=0;Ld[0]>i.children[0].extent[2]&&(r+=1),Ld[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!To(e,Ld,this.spatialReference))return Dd.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ld[3]=t;let i=null;const r=n=>{if(n&&u6e(n.extent,Ld))if(n.children[0]!=null)for(const a of n.children)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}},s=this.rootTiles;if(L(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,a=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+a,n+a,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this._allTransparentSurfaceLayers();const i=t===this._renderer.opaque?vo.UNFADED:vo.IMMEDIATE;var r,s;i===vo.IMMEDIATE&&((r=this.view)==null||(s=r._stage)==null||s.renderView.setRenderParameters({opaqueTerrain:this.opaque})),this._updateTileTextures(i)}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(lp(!!e,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return lI[0]=e,lI[1]=t,lI[2]=i,s.init(lI,r,this),s}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=Ymt;let r=t.rootTilesInExtent(e,i,5*Q3);if(L(this.rootTiles)){if(r.length>Q3)return void Dd.warn(zqe);const s=this.rootTiles.map(a=>a.lij),n=ZCe(s,r,Zle);if(n.removed.length>0||n.added.length>0){const a=this.rootTiles.filter(l=>!(n.removed.findIndex(p=>Zle(p,l.lij))>-1)||(this._purgeTile(l),!1));n.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else r.length>Q3&&(Dd.warn(Bqe),r=t.rootTilesInExtent(e,i,Q3)),this._setRootTiles(r.map(s=>this._newRootTile(s)));w2(i,this._rootTilesExtent)||(this._rootTilesExtent=Mi(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready")}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ci.SPLIT&&t.setPendingUpdate(ci.SPLIT),this._loadTile(t),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),L(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(ci.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(J(e))return;const t=s0t(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const p=l.next();p.updateClippingStatus(n)&&p.resetPendingUpdate(ci.GEOMETRY)&&this._updateTileGeometry(p),p.setPendingUpdate(ci.RENDERDATA);const y=p.computeVisibility();s||y?(p.updateScreenDepth(a),p.renderData&&(i=Math.min(p.elevationBounds[0],i),r=Math.max(p.elevationBounds[1],r))):l.skipSubtree()}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(J(this._splitLimits.frustum)&&(this._splitLimits.frustum=JR()),TD(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,TD(this._frustum,e.frustum),As(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ke(this._eyePosRenderSR,t.eye),Ho(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateSkirts(){const e=this.view.state.camera,t=this.view.state.constraints.collision.enabled?0:1.11*e.near;this.skirtScale=Vpt(this,this._eyePosSurfaceSR,t)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(eM(e)?this._loadChildren(e):Xmt(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._elevationUpdate(e),this._usedMemory=LA}_updateTileTexture(e,t){const i=e.resetPendingUpdate(ci.TEXTURE_FADING)?ci.TEXTURE_FADING:!!e.resetPendingUpdate(ci.TEXTURE_NOFADING)&&ci.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=LA,t.madeProgress())}_elevationUpdate(e){cI.spatialReference=this.spatialReference,cI.tile=e,cI.extent=e.extent,this.emit("elevation-change",cI),QW(e.extent,this._eyePosSurfaceSR)&&this._updateSkirts()}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===ci.SPLIT){i.resetPendingUpdate(ci.MERGE),i.isLeaf&&(i.setPendingUpdate(ci.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(ci.SPLIT)&&i.updateAgentSuspension(),r===ci.VSPLITMERGE&&i.updateAgents(Oi.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(ci.MERGE),i.resetPendingUpdate(ci.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(i0t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=0;for(;!e.done;){let r=!1;i=0;const s=!this._allTiles.some(n=>{if(i+=n.usedMemory,n.resetPendingUpdate(ci.MERGE)){if(!t)return n.setPendingUpdate(ci.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(ci.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(ci.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(this._usedMemory=i,!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i===0&&(this._allTilesDirty=!0),this._sortTiles(e)}_updateElevation(e){return this._allTiles.some(t=>(t.resetPendingUpdate(ci.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(An.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Fqe}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=Ot(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){L(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeChildTiles(e){if(e.isLeaf)return!1;let t=this._purgeTile(e.children[0]);return t=this._purgeTile(e.children[1])||t,t=this._purgeTile(e.children[2])||t,t=this._purgeTile(e.children[3])||t,e.unsetChildren(),t}_purgeTile(e){const t=this._purgeChildTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),e.unload(this._renderer),this._tilePool.release(e),t}_splitTile(e){lp(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(ci.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){hI.spatialReference=this.spatialReference,hI.extent=e.extent,hI.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",hI)}_createTile(e,t,i,r){lp(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ci.SPLIT&&s.setPendingUpdate(ci.SPLIT)),s}_mergeTile(e){lp(!e.hasPendingUpdate(ci.SPLIT),"_mergeTile sanity check"),this._purgeChildTiles(e)&&(lp(!e.renderData,"_mergeTile sanity check"),this._loadTile(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_loadChildren(e){lp(e.rendered,"parent should be rendered"),e.unload(this._renderer),this._loadTile(e.children[0]),this._loadTile(e.children[1]),this._loadTile(e.children[2]),this._loadTile(e.children[3])}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t)}_unloadChildren(e){e.isLeaf||(this._unloadChildren(e.children[0]),e.children[0].unload(this._renderer),this._unloadChildren(e.children[1]),e.children[1].unload(this._renderer),this._unloadChildren(e.children[2]),e.children[2].unload(this._renderer),this._unloadChildren(e.children[3]),e.children[3].unload(this._renderer))}_loadTile(e){e.load(this._renderer),e.setPendingUpdate(ci.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_elevationDataArrived(e,t,i){const r=new Nft(e.lij,e.extent,i);e.dataArrived(t,Oi.ELEVATION,r);const s=[e],n=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(t,n),l.computeElevationBounds()}a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=SE){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),$T(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),a=this._layerIndexByUid[n].get(s.uid);a<r&&(t=!0),r=a}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allTransparentSurfaceLayers(),e.madeProgress()}_allTransparentSurfaceLayers(){var e,t;let i=((e=this.view.map)==null||(t=e.ground)==null?void 0:t.opacity)===0;for(const r of this.view.allLayerViews.items)if($T(r)&&!b$(r)&&!wge(r.layer)&&r.fullOpacity!==0)return i=!1,i;return i}_layerClassFromLayerView(e){return b$(e)?Oi.ELEVATION:Oi.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(e.watch("suspended",()=>this._updateTiledLayers())),t.push(e.watch("fullOpacity",()=>this._updateTileTextures(vo.UNFADED))),t.push(e.layer.watch("effectiveScaleRange",()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const r=this._layerIndexByUid[i].get(e.uid);r!=null&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;const r=pd();e.forEach(s=>{const n=s.layer;if(!n||s.suspended||!$T(s))return;const a=s.fullExtent;if(!a)return void Dd.warn("Terrain: Map or elevation layer does not have fullExtent: "+n.id);lv(r,a,r);const l=this._layerClassFromLayerView(s);if(l===Oi.MAP){const p=s.displayLevelRange;p.maxLevel!==1/0&&(i===null||p.maxLevel>i)&&(i=p.maxLevel)}t[l].push(s)});for(const s of Cb){const n=this._layerViews[s],a=t[s];a.reverse();const l=a.length;let p=n.length!==l;const y=new Array(l),b=new Array(n.length);this._layerIndexByUid[s].clear();for(let x=0;x<l;x++){const A=a[x].uid;this._layerIndexByUid[s].set(A,x);const M=n.indexOf(a[x]);y[x]=M,x!==M&&(p=!0),M>-1&&(b[M]=x)}if(p){const x=this._postorderIterator;for(x.reset(this.rootTiles);!x.done;)x.next().modifyLayers(b,y,s);this._layerViews[s]=a,this._restartAllAgents(s),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Oi.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Oi.MAP),e===vo.IMMEDIATE?this.renderer.updateTileTexture(t,ci.TEXTURE_NOFADING):t.updateRenderData(Oi.MAP,e)}),this._renderer.isTransparent=this._allTransparentSurfaceLayers()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=An.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||iL(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],qe(ie({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Cs(a)||this._dataMissing(e,i,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Oi.ELEVATION?this._requestElevationTileData(e,i,r):this._requestMapTileData(e,i,r)}_requestElevationTileData(e,t,i){if(!b$(t))return void lp(!1,"_requestElevationTileData can only be called for elevation layer views");const r=a=>{if(--this._asyncWorkItems,zn(i))return;const l=this._layerIndexByUid[Oi.ELEVATION].get(t.uid);l!=null?(this._usedMemory=LA,this.requestUpdate(),this._elevationDataArrived(e,l,a)):Dd.warn("TerrainSurface: received data from unknown layer %d %s",Oi.ELEVATION,e.lij.toString())},s=a=>{--this._asyncWorkItems,Cs(a)||(this._dataMissing(e,Oi.ELEVATION,t,a),this.requestUpdate())};if(++this._asyncWorkItems,Ale(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:MR,signal:i.signal}).then(a=>{if(zn(i))return Dd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void s(rr());this._frameTask.schedule(()=>r(a),i.signal,s)},s);const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:MR},i.signal)).then(a=>{r({values:a.pixelData,width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},s)}_requestMapTileData(e,t,i){if(t instanceof G3e)return Promise.reject();++this._asyncWorkItems;const r=(y,b)=>{--this._asyncWorkItems,DT(b),zn(i)||(this._dataMissing(e,Oi.MAP,t,y),this.requestUpdate())},s=y=>b=>r(b,y),n=y=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),zn(i)?DT(y):this._mapTileDataArrived(e,t,y)},i.signal,s(y)).catch(s(y)),a=(y,b=null)=>this._frameTask.schedule(()=>r(y,b));if(iL(t)){const y=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(y[0],y[1],y[2],i).then(n,a)}if(BZ(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,a);if(F3e(t)&&Ale(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(y=>{if(zn(i))return Dd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(rr());n(y)},a);let l=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);mje(t.layer)&&t.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const p=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,p,i).then(n,a)}_mapTileDataArrived(e,t,i){const r=this._layerIndexByUid[Oi.MAP].get(t.uid);r!=null?e.dataArrived(r,Oi.MAP,i):(DT(i),Dd.warn("TerrainSurface: received data from unknown layer"))}_dataMissing(e,t,i,r){const s=this._layerIndexByUid[t].get(i.uid);s!=null?e.dataMissing(s,t,r):Dd.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(this._usedMemory===LA&&(this._usedMemory=0,this._allTiles.forAll(e=>this._usedMemory+=e.usedMemory)),this._usedMemory):0}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._layerIndexByUid[i].get(e.uid);return this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(J(e)||J(this.rootTiles))return null;const t=e.split("/").map(a=>+a);if(t[0]===0)return this.rootTiles.find(a=>a.lij[1]===t[1]&&a.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(a=>a.lij[1]===r&&a.lij[2]===s&&(n=a,!0)),n){let a=1<<t[0]-1;for(;n.lij[0]<t[0];){let l=t[1]&a?2:0;if((t[2]&a)>0&&l++,!n.children[l])return null;n=n.children[l],a>>=1}return lp(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{L(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){UU.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&UU.push(i)});const t=UU.toArray();return J3e(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}};_([S()],$i.prototype,"_renderer",void 0),_([S()],$i.prototype,"_hasPendingUpdates",void 0),_([S()],$i.prototype,"_asyncWorkItems",void 0),_([S()],$i.prototype,"_allTilesDirty",void 0),_([S()],$i.prototype,"_allTilesSorted",void 0),_([S()],$i.prototype,"_viewChanged",void 0),_([S({readOnly:!0})],$i.prototype,"_watchUpdatingTracking",void 0),_([S()],$i.prototype,"_frameTask",void 0),_([S({readOnly:!0})],$i.prototype,"snapLevel",null),_([S({readOnly:!0})],$i.prototype,"lodSnapping",null),_([S({constructOnly:!0})],$i.prototype,"view",void 0),_([S()],$i.prototype,"_userClippingExtent",null),_([S()],$i.prototype,"_rootTilesExtent",void 0),_([S({readOnly:!0})],$i.prototype,"extent",null),_([S({readOnly:!0})],$i.prototype,"groundExtent",null),_([S({readOnly:!0})],$i.prototype,"_tilingSchemeExtent",null),_([S({readOnly:!0})],$i.prototype,"updating",null),_([S(V3e)],$i.prototype,"updatingProgress",void 0),_([S({readOnly:!0})],$i.prototype,"updatingProgressValue",null),_([S()],$i.prototype,"_maxNumUpdating",void 0),_([S({aliasOf:"view.map.ground.opacity"})],$i.prototype,"baseOpacity",void 0),_([S({readOnly:!0})],$i.prototype,"overlayManager",void 0),_([S({readOnly:!0})],$i.prototype,"viewingMode",null),_([S()],$i.prototype,"maxTextureScale",void 0),_([S({readOnly:!0})],$i.prototype,"ready",null),_([S({value:mO.FRONT_TO_BACK})],$i.prototype,"renderOrder",null),_([S({readOnly:!0})],$i.prototype,"rootTiles",void 0),_([S({readOnly:!0})],$i.prototype,"spatialReference",null),_([S()],$i.prototype,"backgroundImage",void 0),_([S({type:Ft,aliasOf:"view.map.ground.surfaceColor"})],$i.prototype,"backgroundColor",void 0),_([S()],$i.prototype,"_background",null),_([S({value:!1})],$i.prototype,"slicePlaneEnabled",null),_([S({readOnly:!0})],$i.prototype,"tilingScheme",void 0),_([S({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],$i.prototype,"tilingSchemeLocked",void 0),_([S({readOnly:!0})],$i.prototype,"tilingSchemeLogic",void 0),_([S({value:!0})],$i.prototype,"velvetOverground",null),_([oi("_renderer.wireframe")],$i.prototype,"wireframe",void 0),_([S({value:!1})],$i.prototype,"suspended",null),_([S({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],$i.prototype,"textureFadeDuration",void 0),_([S()],$i.prototype,"_layerViewsDirty",void 0),_([oi("_renderer.renderPatchBorders")],$i.prototype,"renderPatchBorders",void 0),_([oi("_renderer.renderingDisabled")],$i.prototype,"renderingDisabled",void 0),$i=_([re("esri.views.3d.terrain.TerrainSurface")],$i);const Wmt=$i;function Zle(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function eM(e){return!e.isLeaf&&(e.children[0].shouldLoad||e.children[1].shouldLoad||e.children[2].shouldLoad||e.children[3].shouldLoad||eM(e.children[0])||eM(e.children[1])||eM(e.children[2])||eM(e.children[3]))}function Xmt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const LA=-1,Ld=nr(),Ymt=Mi(),lI=[0,0,0],UU=new Ci,cI={spatialReference:null,tile:null,extent:null,context:"ground"},hI={spatialReference:null,extent:null,scale:0};let tM=class extends st{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((a,l)=>{const p=a[0],y=a[1],b=a[2];let x=!1;if(y&Ni.Geometry.UPDATE){const A=n.get(l);if(A){const M=A[1];if(b&Ni.State.TRANSFORMATION){const P=this.model.getObject(s);this.model.updateRenderGeometryTransformation(P,p,M)&&(x=!0)}x||t.updates.push({renderGeometry:M,updateType:b})}else Kt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(y&Ni.Geometry.REMOVE||x){const A=n.get(l);A?(t.removes.push(A[1]),n.delete(l),A[0].disposed&&dw.pool.release(A[0])):y===Ni.Geometry.REMOVE&&Kt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(y&Ni.Geometry.ADD||x){const A=this.model.getObject(s);if(L(A)){const M=this.model.getRenderGeometry(A,p),P=[p,M];t.adds.push(M),n.set(l,P)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,Ni.Geometry.UPDATE,0,0,Ni.Geometry.UPDATE,Ni.Geometry.ADD|Ni.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(Ni.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(Ni.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(Ni.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,Ni.Geometry.UPDATE,0,0,Ni.Geometry.UPDATE,Ni.Geometry.ADD|Ni.Geometry.REMOVE,Ni.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,Ni.Geometry.UPDATE,0,0,Ni.Geometry.UPDATE,Ni.Geometry.ADD|Ni.Geometry.REMOVE,Ni.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Ni.Geometry.ADD,Ni.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Ni.Geometry.REMOVE,Ni.Geometry.ADD,Ni.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,a,l,p){i=Wt(i,this._getParentLayerId(e));const y=e.id,b=t.id,x=this._ensureDirtyRecord(i,y),A=x.get(b);if(A){const M=A[1];M&s?(x.delete(b),A[0].disposed&&dw.pool.release(A[0])):M&n?(A[1]=r,A[2]=p):M&a?A[2]|=p:M&l||Kt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else x.set(b,[t,r,p]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return rn(this._dirtyGeomRecords,e=>rn(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return L(e.parentLayer)?e.parentLayer.id:CMe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const a=[];s.forEach(l=>{const p=l[1];a[p]||(a[p]=[]),a[p].push(l[0].geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){t+=" "+e[l-1]+": ";for(let p=0;p<a[l].length;p++)t+=a[l][p]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};_([S({constructOnly:!0})],tM.prototype,"model",void 0),_([S()],tM.prototype,"dirty",void 0),tM=_([re("esri.views.3d.webgl-engine.lib.ModelDirtySet")],tM);const Jmt=tM;let S$=class extends st{constructor(){super(...arguments),this.dirtySet=new Jmt({model:this}),this._content=new Map,this._originFactory=new gZ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Kt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),BD(e)&&this.dirtySet.layerAdded(e)}remove(e){Kt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),BD(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)L(t)&&(Kt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)Kt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:a,instanceParameters:l}=t,p=new JS(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return p.updateTransformation(y=>e.getCombinedStaticTransformation(t,y)),p.origin=a||this._originFactory.getOrigin(p.boundingSphere),p.instanceParameters=l,p}updateRenderGeometryTransformation(e,t,i){if(J(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<Vp.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};_([S({constructOnly:!0})],S$.prototype,"dirtySet",void 0),S$=_([re("esri.views.3d.webgl-engine.parts.Model")],S$);function Zmt(){const e=new Float32Array(4);return e[3]=1,e}function aTe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Kmt(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function lTe(e,t){return new Float32Array(e,t,4)}Object.freeze({__proto__:null,create:Zmt,clone:aTe,fromValues:Kmt,createView:lTe});const ZS=1e-6,NA=[0,0,0],uI=[0,0,0];function Qmt(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new lgt(e);E$(NA,n.minProj,n.maxProj),e2(NA,NA,.5),Qu(uI,n.maxProj,n.minProj);const a=YH(uI),l=new cgt;l.quality=a,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const p=[0,0,0],y=[0,0,0],b=[0,0,0],x=[0,0,0],A=[0,0,0],M=[0,0,0],P=[0,0,0];switch(egt(n,e,P,p,y,b,x,A,M,l)){case 1:return void tce(NA,uI,t);case 2:return void agt(e,x,t)}tgt(e,P,p,y,b,x,A,M,l),cTe(e,l.b0,l.b1,l.b2,FT,kT);const $=[0,0,0];Qu($,kT,FT),l.quality=YH($),l.quality<a?hTe(l.b0,l.b1,l.b2,FT,kT,$,t):tce(NA,uI,t)}function egt(e,t,i,r,s,n,a,l,p,y){return igt(e,r,s),JH(r,s)<ZS?1:(Qu(a,r,s),sa(a,a),rgt(t,r,a,n)<ZS?2:(Qu(l,s,n),sa(l,l),Qu(p,n,r),sa(p,p),ed(i,l,a),sa(i,i),Mb(t,i,a,l,p,y),0))}const FA=[0,0,0],kA=[0,0,0],vu=[0,0,0],_u=[0,0,0],bu=[0,0,0],R1=[0,0,0],O1=[0,0,0],P1=[0,0,0];function tgt(e,t,i,r,s,n,a,l,p){sgt(e,t,i,FA,kA),FA[0]!==void 0&&(Qu(vu,FA,i),sa(vu,vu),Qu(_u,FA,r),sa(_u,_u),Qu(bu,FA,s),sa(bu,bu),ed(R1,_u,n),sa(R1,R1),ed(O1,bu,a),sa(O1,O1),ed(P1,vu,l),sa(P1,P1),Mb(e,R1,n,_u,vu,p),Mb(e,O1,a,bu,_u,p),Mb(e,P1,l,vu,bu,p)),kA[0]!==void 0&&(Qu(vu,kA,i),sa(vu,vu),Qu(_u,kA,r),sa(_u,_u),Qu(bu,kA,s),sa(bu,bu),ed(R1,_u,n),sa(R1,R1),ed(O1,bu,a),sa(O1,O1),ed(P1,vu,l),sa(P1,P1),Mb(e,R1,n,_u,vu,p),Mb(e,O1,a,bu,_u,p),Mb(e,P1,l,vu,bu,p))}function igt(e,t,i){let r=JH(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const a=JH(e.maxVert[n],e.minVert[n]);a>r&&(r=a,s=n)}Yc(t,e.minVert[s]),Yc(i,e.maxVert[s])}const wu=[0,0,0];function rgt(e,t,i,r){const{data:s,size:n}=e;let a=Number.NEGATIVE_INFINITY,l=0;for(let p=0;p<s.length;p+=n){wu[0]=s[p]-t[0],wu[1]=s[p+1]-t[1],wu[2]=s[p+2]-t[2];const y=i[0]*wu[0]+i[1]*wu[1]+i[2]*wu[2],b=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],x=wu[0]*wu[0]+wu[1]*wu[1]+wu[2]*wu[2]-y*y/b;x>a&&(a=x,l=p)}return Yc(r,s,l),a}const ro=[0,0];function sgt(e,t,i,r,s){ogt(e,t,ro,s,r);const n=dTe(i,t);ro[1]-ZS<=n&&(r[0]=void 0),ro[0]+ZS>=n&&(s[0]=void 0)}const Kle=[0,0,0],Qle=[0,0,0],ece=[0,0,0],Cx=[0,0,0],Mx=[0,0,0],dI=[0,0,0];function Mb(e,t,i,r,s,n){if(uTe(t)<ZS)return;ed(Kle,i,t),ed(Qle,r,t),ed(ece,s,t),NT(e,t,ro),Mx[1]=ro[0],Cx[1]=ro[1],dI[1]=Cx[1]-Mx[1];const a=[i,r,s],l=[Kle,Qle,ece];for(let p=0;p<3;++p){NT(e,a[p],ro),Mx[0]=ro[0],Cx[0]=ro[1],NT(e,l[p],ro),Mx[2]=ro[0],Cx[2]=ro[1],dI[0]=Cx[0]-Mx[0],dI[2]=Cx[2]-Mx[2];const y=YH(dI);y<n.quality&&(Yc(n.b0,a[p]),Yc(n.b1,t),Yc(n.b2,l[p]),n.quality=y)}}const ngt=[0,0,0];function NT(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const a=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a)}}function ogt(e,t,i,r,s){const{data:n,size:a}=e;Yc(r,n),Yc(s,r),i[0]=dTe(ngt,t),i[1]=i[0];for(let l=a;l<n.length;l+=a){const p=n[l]*t[0]+n[l+1]*t[1]+n[l+2]*t[2];p<i[0]&&(i[0]=p,Yc(r,n,l)),p>i[1]&&(i[1]=p,Yc(s,n,l))}}function tce(e,t,i){Yc(i.center,e),e2(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const im=[0,0,0],Rx=[0,0,0],UA=[0,0,0],FT=[0,0,0],kT=[0,0,0],ice=[0,0,0];function agt(e,t,i){Yc(im,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?im[0]=0:Math.abs(t[1])>Math.abs(t[2])?im[1]=0:im[2]=0,uTe(im)<ZS&&(im[0]=im[1]=im[2]=1),ed(Rx,t,im),sa(Rx,Rx),ed(UA,t,Rx),sa(UA,UA),cTe(e,t,Rx,UA,FT,kT),Qu(ice,kT,FT),hTe(t,Rx,UA,FT,kT,ice,i)}function cTe(e,t,i,r,s,n){NT(e,t,ro),s[0]=ro[0],n[0]=ro[1],NT(e,i,ro),s[1]=ro[0],n[1]=ro[1],NT(e,r,ro),s[2]=ro[0],n[2]=ro[1]}const pI=[0,0,0],df=[1,0,0,0,1,0,0,0,1],Ox=[0,0,0];function hTe(e,t,i,r,s,n,a){df[0]=e[0],df[1]=e[1],df[2]=e[2],df[3]=t[0],df[4]=t[1],df[5]=t[2],df[6]=i[0],df[7]=i[1],df[8]=i[2],hgt(a.quaternion,df),E$(Ox,r,s),e2(Ox,Ox,.5),e2(a.center,e,Ox[0]),e2(pI,t,Ox[1]),E$(a.center,a.center,pI),e2(pI,i,Ox[2]),E$(a.center,a.center,pI),e2(a.halfSize,n,.5)}const mh=7;class lgt{constructor(t){this.minVert=new Array(mh),this.maxVert=new Array(mh);const i=64*mh;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,mh),r+=8*mh,this.maxProj=new Float64Array(this.buffer,r,mh),r+=8*mh;for(let p=0;p<mh;++p)this.minVert[p]=new Float64Array(this.buffer,r,3),r+=24;for(let p=0;p<mh;++p)this.maxVert[p]=new Float64Array(this.buffer,r,3),r+=24;for(let p=0;p<mh;++p)this.minProj[p]=Number.POSITIVE_INFINITY,this.maxProj[p]=Number.NEGATIVE_INFINITY;const s=new Array(mh),n=new Array(mh),{data:a,size:l}=t;for(let p=0;p<a.length;p+=l){let y=a[p];y<this.minProj[0]&&(this.minProj[0]=y,s[0]=p),y>this.maxProj[0]&&(this.maxProj[0]=y,n[0]=p),y=a[p+1],y<this.minProj[1]&&(this.minProj[1]=y,s[1]=p),y>this.maxProj[1]&&(this.maxProj[1]=y,n[1]=p),y=a[p+2],y<this.minProj[2]&&(this.minProj[2]=y,s[2]=p),y>this.maxProj[2]&&(this.maxProj[2]=y,n[2]=p),y=a[p]+a[p+1]+a[p+2],y<this.minProj[3]&&(this.minProj[3]=y,s[3]=p),y>this.maxProj[3]&&(this.maxProj[3]=y,n[3]=p),y=a[p]+a[p+1]-a[p+2],y<this.minProj[4]&&(this.minProj[4]=y,s[4]=p),y>this.maxProj[4]&&(this.maxProj[4]=y,n[4]=p),y=a[p]-a[p+1]+a[p+2],y<this.minProj[5]&&(this.minProj[5]=y,s[5]=p),y>this.maxProj[5]&&(this.maxProj[5]=y,n[5]=p),y=a[p]-a[p+1]-a[p+2],y<this.minProj[6]&&(this.minProj[6]=y,s[6]=p),y>this.maxProj[6]&&(this.maxProj[6]=y,n[6]=p)}for(let p=0;p<mh;++p){let y=s[p];Yc(this.minVert[p],a,y),y=n[p],Yc(this.maxVert[p],a,y)}}}class cgt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function YH(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function E$(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function Qu(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function e2(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function Yc(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function ed(e,t,i){const r=t[0],s=t[1],n=t[2],a=i[0],l=i[1],p=i[2];e[0]=s*p-n*l,e[1]=n*a-r*p,e[2]=r*l-s*a}function sa(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function uTe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function JH(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function dTe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function hgt(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let a=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*a,a=.5/a,e[3]=(t[3*s+n]-t[3*n+s])*a,e[s]=(t[3*s+r]+t[3*r+s])*a,e[n]=(t[3*n+r]+t[3*r+n])*a}}const XM=Hv(),v2=Q(),ugt=Q(),dgt=zs();class rEt{constructor(t){const a=t*56;this.buffer=new ArrayBuffer(a),this.obbs=new Array(t);for(let l=0;l<t;l++)this.obbs[l]={center:qq(this.buffer,56*l+0),halfSize:q_e(this.buffer,56*l+24),quaternion:lTe(this.buffer,56*l+36)}}}function pTe(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:qn(e),halfSize:mD(t),quaternion:aTe(i)}}function pgt(e){return pTe(e.center,e.halfSize,e.quaternion)}function sEt(e,t){ke(t.center,e.center),ke(t.halfSize,e.halfSize),G_e(t.quaternion,e.quaternion)}function nEt(e,t){return t=t||pTe(),Qmt(e,t),t}function Rb(e,t){const i=Kr(t,e.center),r=j8(e,t);return i>r?1:i<-r?-1:0}function oEt(e,t){t||(t=On());const i=lJ(dgt,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function aEt(e,t){return Kr(t,e.center)-j8(e,t)}function lEt(e,t){return Kr(t,e.center)+j8(e,t)}function cEt(e,t){return Rb(e,t[0])<=0&&Rb(e,t[1])<=0&&Rb(e,t[2])<=0&&Rb(e,t[3])<=0&&Rb(e,t[4])<=0&&Rb(e,t[5])<=0}function hEt(e,t,i,r=0){i4(XM,e.quaternion),We(v2,t,e.center);const s=yv(v2,v2,XM),n=yv(ugt,i,XM);let a=-1/0,l=1/0;for(let p=0;p<3;p++)if(Math.abs(n[p])>1e-6){const y=(r+e.halfSize[p]-s[p])/n[p],b=(-r-e.halfSize[p]-s[p])/n[p];a=Math.max(a,Math.min(y,b)),l=Math.min(l,Math.max(y,b))}else if(s[p]>e.halfSize[p]+r||s[p]<-e.halfSize[p]-r)return!1;return a<=l}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function j8(e,t){i4(XM,e.quaternion),yv(v2,t,XM);const i=e.halfSize;return Math.abs(v2[0]*i[0])+Math.abs(v2[1]*i[1])+Math.abs(v2[2]*i[2])}function uEt(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],yv(r,r,e.quaternion),Xe(r,r,e.center)}}function fgt(e){return Zq(e.halfSize)}class mgt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=ggt(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let a=s;a<n;a++)if(!t(a))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],a=n+r[s+1],l=t[n],p=t[a];i[s]=l,i[s+1]=p-l}return i}}function ggt(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class ygt extends h8{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=$q(i);const r=this.count;this.visibility=new mgt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return J(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return J(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return J(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((J(this.cachedHighlightRanges)||J(this.cachedDefaultRanges))&&L(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=vgt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function vgt(e,t,i){const r=[],s=[];let n=i.length,a=i.length;return t.forEachComponent(l=>(e[l]>0?(n!==l-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[l])),n=l):(a!==l-1&&(s.length&&s.push(i[a+1]-s[s.length-1]),s.push(i[l])),a=l),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[a+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class ZH extends h8{constructor(){super(...arguments),this.visible=UT.Hidden}}var UT;_([ra()],ZH.prototype,"renderable",void 0),_([ra()],ZH.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(UT||(UT={}));function _gt(e){return typeof e=="function"}function bgt(e,t,i,r){if(i>=t)return e;e==null&&(e=wgt());const s=e.isVisibleBit;let n=e.data;const a=mTe(n),l=i/a|0,p=i-a*l,y=(t-1)/a|0,b=n,x=r===s;if(!(i<b.length*a)&&x){const M=l+1,P=Math.ceil(b.length*1.5),$=y+1;let k=Math.max(M,P);k=Math.min(k,$),n=new Uint32Array(k),n.set(b)}return l<n.length&&(n[l]=Tgt(n[l],p,x)),e.data=n,e}function fTe(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=mTe(r);return t<r.length*s?xgt(i,r,t,s):!e.isVisibleBit}function wgt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function xgt(e,t,i,r){const s=i/r|0,n=i-s*r;return Sgt(t[s],n)===e}function mTe(e){return e.BYTES_PER_ELEMENT*8}function Tgt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function Sgt(e,t){return(e&1<<t)!=0}class Egt{constructor(t,i){this._indices=L(t.indices)?t.indices:BS(t.positions.length/3),this._positions=new Cr(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(L(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},p=this._indices,y=this._components.offsets,b=D2e(t,i,Agt);this._components.visibility.forEachComponent(x=>{if(!fTe(this._components.pickability,x))return!0;const A=this.getComponentAabb(x,Cgt);if(L(n)&&n.applyToAabb(A),!VJ(A,t,b,r))return!0;const M=y[x]/3,P=y[x+1]/3,$=(z,G,B)=>{a(x,z,Gc(G,G,s),B)},k=P-M;return J(n)&&k>WH?(this._componentIntersectionData[x]==null&&(this._componentIntersectionData[x]=new _w(this._indices,M,P,l)),this._componentIntersectionData[x].intersectRay({r0:t,r1:i},$)):l4(t,i,M,P,p,l,void 0,n,$),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);for(let i=0;i<t;i++)this._computeAABB(i)}_computeAABB(t){const i=this._indices,r=this._positions,s=this._components.offsets,n=s[t],a=s[t+1],l=[0,0,0],p=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];for(let x=n;x<a;x++){const A=i[x];r.getVec(A,l),ode(p,p,l),ade(y,y,l)}let b=6*t;this._perComponentAabbs[b++]=p[0],this._perComponentAabbs[b++]=p[1],this._perComponentAabbs[b++]=p[2],this._perComponentAabbs[b++]=y[0],this._perComponentAabbs[b++]=y[1],this._perComponentAabbs[b]=y[2]}get positions(){return this._positions}get indices(){return this._indices}}const Agt=Q(),Cgt=On();class Mgt{constructor(t,i,r,s){this.material=t,this.drawParameters=i,this.geometry=r,this.meta=s}dispose(){this.material.dispose(),this.geometry.dispose()}}class gTe extends h8{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}_([ra()],gTe.prototype,"vao",void 0);function Rgt(e,t){return{near:e,far:t}}function w4(e){return e?yO(e,1/0,-1/0):Rgt(1/0,-1/0)}function yO(e,t,i){return e.near=t,e.far=i,e}function KS(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function fI(e,t){return e.near<=t&&t<=e.far}const KH={near:0,far:0};function Ogt(e,t){const i=w4(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(a=>{const l=a.obb,p=rt(a0(Eh,l.center,r),n),y=j8(l,n);if(fI(i,p-y)&&fI(i,p+y))return;const b=Lgt(l,s);if(b===-1)return;if(b===0)return rm.far=p+y,rm.near=p-y,void KS(i,rm);const x=mI.pushNew();x.near=p-y,x.far=p+y,x.mask=b,x.object=a});for(let a=0;a<mI.length;a++){const l=mI.data[a];if(fI(i,l.near)&&fI(i,l.far))continue;rm.far=l.far,rm.near=1/0,Dgt(l.object.obb,r,Pgt,y=>{let b=Igt;for(let x=0;x<yTe&&y.length>0;x++){if((l.mask&1<<x)==0)continue;$gt(s[x],y,b);const A=y;y=b,b=A}for(let x=0;x<y.length;x+=3){ze(kl,y.data[x+0],y.data[x+1],y.data[x+2]);const A=rt(a0(kl,kl,r),n);rm.near=Math.min(rm.near,A)}})===0&&(rm.near=0),KS(i,rm)}return mI.length=0,i}const mI=new Ci({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),rm=w4(),kl=Q(),N_=Q(),Pgt=new Ci({deallocator:null}),Igt=new Ci({deallocator:null});function $gt(e,t,i){i.length=0;const r=t.length-3;zU(kl,t,r);const s=Kr(e,kl);s<=0&&(i.push(kl[0]),i.push(kl[1]),i.push(kl[2]));let n=0,a=s;for(;n<r;n+=3){zU(N_,t,n);const l=Kr(e,N_);a*l<0&&(Wn(kl,N_,kl,l/(l-a)),Ul(i,kl)),l<=0&&Ul(i,N_),a=l,ke(kl,N_)}a*s<0&&(zU(N_,t,r),Wn(kl,N_,kl,s/(s-a)),Ul(i,kl))}function zU(e,t,i){return ze(e,t.data[i+0],t.data[i+1],t.data[i+2])}function Ul(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Dgt(e,t,i,r){i4(sce,e.quaternion),a0(Eh,t,e.center),yv(Eh,Eh,sce);const s=8*((Eh[0]<-e.halfSize[0]?-1:Eh[0]>e.halfSize[0]?1:0)+3*(Eh[1]<-e.halfSize[1]?-1:Eh[1]>e.halfSize[1]?1:0)+9*(Eh[2]<-e.halfSize[2]?-1:Eh[2]>e.halfSize[2]?1:0)+13),n=rce[s];if(n===0)return n;lJ(gI,e.quaternion),aJ(gI,gI,e.halfSize);const a=(l,p)=>{const y=rce[s+p+1];return ze(l,((1&y)<<1)-1,(2&y)-1,((4&y)>>1)-1),Gc(l,l,gI),Xe(l,e.center,l)};return i.length=0,Ul(i,a(BU,0)),Ul(i,a(nce,1)),Ul(i,a(Eh,2)),Ul(i,a(oce,3)),r(i),n===1||(i.length=0,Ul(i,BU),Ul(i,oce),Ul(i,a(Eh,4)),Ul(i,a(ace,5)),r(i),n===2||(i.length=0,Ul(i,BU),Ul(i,ace),Ul(i,a(Eh,6)),Ul(i,nce),r(i))),n}const rce=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),yTe=4;function Lgt(e,t){let i=0;for(let r=0;r<yTe;r++){const s=Rb(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const gI=zs(),sce=Hv(),Eh=Q(),BU=Q(),nce=Q(),oce=Q(),ace=Q();class Ngt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Ogt(t,this._objects.visibleObjects):null}}function Fgt(e){const t=on().vec3f(Y.POSITION);return e.normals&&t.vec2i16(Y.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Go.Default?t.vec2f(Y.UV0):e.textureCoordinates===Go.Atlas&&(t.vec2f(Y.UV0),t.vec4u16(Y.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(Y.COLOR,{glNormalized:!0}),t.alignTo(4)}var w0;function kgt(e,t){t.componentData===w0.Varying&&(e.vertex.uniforms.add("componentColorTex","sampler2D"),e.vertex.uniforms.add("componentColorTexInvDim","vec2"),e.attributes.add(Y.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(Sxe),e.vertex.code.add(V`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),e.fragment.code.add(V`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)),t.componentData===w0.Uniform&&(e.vertex.uniforms.add("externalColor","vec4"),e.fragment.uniforms.add("externalColorMixMode","int"),e.varyings.add("vExternalColor","vec4"),e.vertex.code.add(V`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),e.fragment.code.add(V`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`))}(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(w0||(w0={}));var sd;function Ugt(e,t){const i=e.vertex;switch(i.code.add(V`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case sd.None:i.code.add(V`#define vertexDiscardByOpacity(_opacity_) {}`);break;case sd.Opaque:i.code.add(V`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case sd.Transparent:i.code.add(V`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(sd||(sd={}));function lce(e,t){e.include(Uw,t),e.fragment.include(aO);const i=e.fragment;i.uniforms.add("baseColor","vec4"),i.uniforms.add("objectOpacity","float"),t.attributeColor?i.code.add(V`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(V`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(V`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function cce(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Es.None:i.code.add(V`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Es.View:e.include(IT,t),i.code.add(V`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Es.WindingOrder:i.code.add(V`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Es.COUNT:}switch(t.normalType){case Xs.Attribute:case Xs.CompressedAttribute:e.include(b8,t),i.code.add(V`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Xs.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(IT,t),i.code.add(V`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Xs.Ground:t.viewingMode===vt.Global?(e.include(IT,t),i.code.add(V`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):t.viewingMode===vt.Local&&i.code.add(V`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(V`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Xs.COUNT:}}function zgt(e,t){const i=e.fragment;t.baseColorTexture?(e.include(tJ,t),i.uniforms.add("baseColorTexture","sampler2D"),i.uniforms.add("baseColorTextureSize","vec2"),t.attributeTextureCoordinates===Go.Atlas?(e.include(Z_e),i.code.add(V`vec4 readBaseColorTexture() {
return textureAtlasLookup(
baseColorTexture,
baseColorTextureSize,
vuv0,
vuvRegion
);
}`)):i.code.add(V`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)):i.code.add(V`vec4 readBaseColorTexture() { return vec4(1.0); }`)}var n0;function dEt(e){return e&&S0(e)?n0.Mars:e&&E0(e)?n0.Moon:n0.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(n0||(n0={}));const vTe=new Map([[Y.POSITION,0],[Y.NORMAL,1],[Y.NORMALCOMPRESSED,1],[Y.COLOR,2],[Y.UV0,3],[Y.UVREGION,4],[Y.COMPONENTINDEX,5]]);function Bgt(e){const t=new Ir;t.include(IT,e),t.include(b8,e),t.include(Uw,e),t.include(dg,e),t.include(v4,e),t.include(kgt,e),t.include(fg,e),t.include(Ws,e),t.include(zgt,e),t.include(Ugt,e),t.fragment.uniforms.add("view","mat4"),e.pbrMode!==fi.Normal&&e.pbrMode!==fi.Schematic||(t.include(iJ,e),e.hasNormalTexture&&t.include(Oxe,e)),e.output===Te.Shadow&&e.componentData===w0.Varying?t.vertex.code.add(V`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):t.vertex.code.add(V`#define discardShadows(castShadows) {}`);const i=e.overlayEnabled&&e.output===Te.Color&&e.pbrMode===fi.WaterOnIntegratedMesh;return e.overlayEnabled&&(t.include(mw,e),t.include(XH,e),e.viewingMode===vt.Global?t.vertex.code.add(V`
      const float invEllipsoidRadius = ${V.float(1/(e.ellipsoidMode===n0.Earth?ar.radius:e.ellipsoidMode===n0.Mars?Qf.radius:Sg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):t.vertex.code.add(V`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),i&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"),t.varyings.add("positionView","vec3")),t.vertex.code.add(V`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${V.float(fa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${i?V`
        positionView = position_view();
        ${e.viewingMode===vt.Global?V`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:V`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${e.overlayEnabled?V`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `),e.output===Te.Alpha&&(t.fragment.include(Yn),e.multipassTerrainEnabled&&t.include(nu,e),t.include(lce,e),t.fragment.code.add(V`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?V`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?V`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===Te.Color&&(t.fragment.include(Yn),e.multipassTerrainEnabled&&t.include(nu,e),t.include(lce,e),t.include(cce,e),t.include(mw,e),i&&t.fragment.uniforms.add("ovNormalTex","sampler2D"),e.receiveShadows?(t.include($g,e),t.fragment.code.add(V`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):t.fragment.code.add(V`float evaluateShadow() { return 0.0; }`),t.fragment.code.add(V`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?V`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?V`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),e.pbrMode===fi.Normal||e.pbrMode===fi.Schematic?(t.fragment.code.add(V`
        ${e.pbrMode===fi.Normal?V`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?t.fragment.code.add(V`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):t.fragment.code.add(V`vec3 shadingNormal = normalVertex;`),t.fragment.code.add(V`${e.viewingMode===vt.Global?V`vec3 normalGround = normalize(positionWorld());`:V`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),t.fragment.code.add(V`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(e.receiveShadows?t.fragment.code.add(V`float shadow = evaluateShadow();`):e.viewingMode===vt.Global?t.fragment.code.add(V`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):t.fragment.code.add(V`float shadow = 0.0;`),t.fragment.code.add(V`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${i?V`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView, positionWorld());
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),t.fragment.code.add(V`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==Te.Depth&&e.output!==Te.Shadow||(t.include(Zv,e),t.fragment.code.add(V`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===Te.Normal&&(t.include(cce,e),t.fragment.code.add(V`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Xs.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===Te.Highlight&&(t.include(Yg),t.fragment.code.add(V`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${e.overlayEnabled?V`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `)),t}const Vgt=Object.freeze({__proto__:null,attributeLocations:vTe,build:Bgt});var Un,pn;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Un||(Un={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(pn||(pn={}));class eK{constructor(){this.viewTransform=new Axe,this.slicePlane=Pw()}}class Ggt extends eK{constructor(){super(...arguments),this.identifier=Un.Material,this.slicePlaneEnabled=!0,this.transparent=!1,this.integratedMesh=!1,this.transformNormalViewFromGlobal=zs(),this.nearFar=St(),this.inverseViewport=St(),this.ambientOcclusionEnabled=!0,this.shadowsEnabled=!0,this.hasFillLights=!0,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE}}class jgt extends eK{constructor(){super(...arguments),this.identifier=Un.ShadowMap,this.nearFar=St()}}class Hgt extends eK{constructor(){super(...arguments),this.identifier=Un.Highlight,this.inverseViewport=St(),this.viewport=nr()}}class H8 extends Xr{bindPass(t){const i=this.program;Mxe(i,t.viewTransform),Nv(this.program,this.configuration,t.slicePlane),t.identifier===Un.Material&&(t.ssrParams!==void 0&&pZ(this.program,t.ssrParams),i.setUniformMatrix3fv("transformNormalViewFromGlobal",t.transformNormalViewFromGlobal),t.subPass===pn.Depth&&i.setUniform2fv("nearFar",t.nearFar),t.subPass===pn.Color&&t.lighting.setUniforms(this.program,t.integratedMesh,t.hasFillLights)),t.identifier===Un.ShadowMap&&this.program.setUniform2fv("nearFar",t.nearFar)}bindMaterial(t,i){this._material=t;const r=this.program;r.setUniform4fv("baseColor",t.baseColor),r.setUniform1f("objectOpacity",t.objectOpacity),r.setUniform1f("textureAlphaCutoff",t.alphaCutoff),t.componentParameters.type===w0.Varying?t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim"):(r.setUniform4fv("externalColor",t.componentParameters.externalColor),r.setUniform1i("externalColorMixMode",t.componentParameters.externalColorMixMode)),L(t.baseColorTexture)&&t.baseColorTexture.bind(r,"baseColorTexture","baseColorTextureSize"),this.configuration.output!==Te.Color&&this.configuration.output!==Te.Alpha||(K_e(this.program,t,this.configuration.isSchematic),L(t.metallicRoughnessTexture)&&t.metallicRoughnessTexture.bind(r,"texMetallicRoughness","texMetallicRoughnessSize"),L(t.emissionTexture)&&t.emissionTexture.bind(r,"texEmission","texEmissionSize"),L(t.occlusionTexture)&&t.occlusionTexture.bind(r,"texOcclusion","texOcclusionSize"),L(t.normalTexture)&&t.normalTexture.bind(r,"normalTexture","normalTextureSize")),t.isIntegratedMesh&&(i.identifier===Un.Material&&i.subPass===pn.Color?(r.bindTexture(t.overlayColor,"ovColorTex"),r.bindTexture(t.overlayNormal,"ovNormalTex")):i.identifier===Un.Highlight&&r.bindTexture(t.overlayHighlight,"ovColorTex"),r.setUniform1f("overlayOpacity",1)),i.identifier===Un.Highlight&&D0(this.program,i),i.identifier===Un.Material&&i.subPass===pn.Color&&(i.ambientOcclusionEnabled&&i.bindAmbientOcclusion(r),i.shadowsEnabled&&i.bindShadowMap(r)),i.identifier!==Un.Material||i.subPass!==pn.Color&&i.subPass!==pn.Alpha||!i.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("nearFar",i.nearFar),r.setUniform2fv("inverseViewport",i.inverseViewport),i.multipassTerrainParams.terrainLinearDepthTexture&&r.bindTexture(i.multipassTerrainParams.terrainLinearDepthTexture,"terrainDepthTexture"))}bindDraw(t){if(Cxe(this.program,t),this.program.setUniformMatrix3fv("transformNormalGlobalFromModel",t.transformNormalGlobalFromModel),this.program.rebindTextures(),L(this._material)&&this._material.isIntegratedMesh){const i=this._material.overlayTexScale,r=this._material.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[t.toMapSpace[0]*i[0]+r[0],t.toMapSpace[1]*i[1]+r[1],t.toMapSpace[0]*i[2]+r[2],t.toMapSpace[1]*i[3]+r[3]]),this.program.setUniform4fv("overlayTexScale",[t.toMapSpace[2]*i[0],t.toMapSpace[3]*i[1],t.toMapSpace[2]*i[2],t.toMapSpace[3]*i[3]])}}initializeProgram(t){const i=H8.shader.get(),r=this.configuration,s=i.build({multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround,oitEnabled:r.transparencyPassType===Qt.Color,output:r.output,normalType:r.integratedMeshMode===jh.None?r.hasNormals?Xs.CompressedAttribute:Xs.ScreenDerivative:Xs.Ground,attributeColor:r.hasVertexColors,attributeTextureCoordinates:r.vertexTextureCoordinates,componentData:r.componentData,alphaDiscardMode:r.alphaDiscardMode,baseColorTexture:r.baseColorTexture,doubleSidedMode:r.doubleSidedMode,receiveAmbientOcclusion:r.receiveAmbientOcclusion,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:t.viewingMode,vertexDiscardMode:r.vertexDiscardMode,pbrMode:r.integratedMeshMode===jh.ColorOverlayWithWater?fi.WaterOnIntegratedMesh:r.usePBR?r.isSchematic?fi.Schematic:fi.Normal:fi.Disabled,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:y8(t.rctx),overlayEnabled:r.integratedMeshMode===jh.ColorOverlay||r.integratedMeshMode===jh.ColorOverlayWithWater,ssrEnabled:r.ssrEnabled,highStepCount:!1,ellipsoidMode:r.ellipsoidMode});return new $r(t.rctx,s,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==jh.None,s=t===Qt.NONE,n=t===Qt.FrontFace;return Ti({blending:i.output!==Te.Color&&i.output!==Te.Alpha||!i.blendingEnabled?null:s?Qc:Zg(t),culling:LN(i.cullFace),depthTest:{func:Jv(t)},depthWrite:s||n?ac:null,colorWrite:Ii,stencilWrite:r||i.sceneHasOcludees?b0:null,stencilTest:r?Gnt(ic.IntegratedMeshMaskExcluded):i.sceneHasOcludees?Kv:null,polygonOffset:s||n?i.polygonOffsetEnabled?{factor:2,units:2}:null:i8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}H8.shader=new Ur(Vgt,()=>import("./ComponentShader.glsl.25b57395.js"));class _Te extends xot{constructor(){super(...arguments),this.transformNormalGlobalFromModel=zs(),this.toMapSpace=nr()}}var hce,jh;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(hce||(hce={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(jh||(jh={}));class fs extends Rs{constructor(){super(...arguments),this.output=Te.Color,this.hasVertexColors=!1,this.hasNormals=!1,this.vertexTextureCoordinates=Go.None,this.componentData=w0.Uniform,this.slicePlaneEnabled=!1,this.cullFace=Fr.Back,this.baseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.vertexDiscardMode=sd.None,this.doubleSidedMode=Es.WindingOrder,this.blendingEnabled=!0,this.alphaDiscardMode=Pr.Opaque,this.integratedMeshMode=jh.None,this.ssrEnabled=!1,this.polygonOffsetEnabled=!1,this.usePBR=!1,this.isSchematic=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.sceneHasOcludees=!1,this.transparencyPassType=Qt.NONE,this.ellipsoidMode=n0.Earth,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe({count:Te.COUNT})],fs.prototype,"output",void 0),_([Oe()],fs.prototype,"hasVertexColors",void 0),_([Oe()],fs.prototype,"hasNormals",void 0),_([Oe({count:Go.COUNT})],fs.prototype,"vertexTextureCoordinates",void 0),_([Oe({count:w0.COUNT})],fs.prototype,"componentData",void 0),_([Oe()],fs.prototype,"slicePlaneEnabled",void 0),_([Oe({count:Fr.COUNT})],fs.prototype,"cullFace",void 0),_([Oe()],fs.prototype,"baseColorTexture",void 0),_([Oe()],fs.prototype,"receiveAmbientOcclusion",void 0),_([Oe()],fs.prototype,"receiveShadows",void 0),_([Oe({count:sd.COUNT})],fs.prototype,"vertexDiscardMode",void 0),_([Oe({count:Es.COUNT})],fs.prototype,"doubleSidedMode",void 0),_([Oe()],fs.prototype,"blendingEnabled",void 0),_([Oe({count:Pr.COUNT})],fs.prototype,"alphaDiscardMode",void 0),_([Oe({count:jh.COUNT})],fs.prototype,"integratedMeshMode",void 0),_([Oe()],fs.prototype,"ssrEnabled",void 0),_([Oe()],fs.prototype,"polygonOffsetEnabled",void 0),_([Oe()],fs.prototype,"usePBR",void 0),_([Oe()],fs.prototype,"isSchematic",void 0),_([Oe()],fs.prototype,"hasMetalnessAndRoughnessTexture",void 0),_([Oe()],fs.prototype,"hasEmissionTexture",void 0),_([Oe()],fs.prototype,"hasOcclusionTexture",void 0),_([Oe()],fs.prototype,"hasNormalTexture",void 0),_([Oe()],fs.prototype,"sceneHasOcludees",void 0),_([Oe({count:Qt.COUNT})],fs.prototype,"transparencyPassType",void 0),_([Oe({count:n0.COUNT})],fs.prototype,"ellipsoidMode",void 0),_([Oe()],fs.prototype,"multipassTerrainEnabled",void 0),_([Oe()],fs.prototype,"cullAboveGround",void 0);class qgt{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class tK{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Vr(e={}){return(t,i)=>{var r;const s=(r=t._parameterCount)!=null?r:0;if(t._parameterCount=s+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[s]},set(a){const l=this[s];if(l==null)this[s]=a;else{if(n.equals(l,a))return;n.copy(l,a)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[s]},set(n){this[s]!==n&&(e.dispose&&this[s]&&this[s].dispose(),this[s]=n,this._setDirty())}})}}function uce(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(this[r]=s,this._setDirty())}})}}class Qs extends qgt{constructor(){super(...arguments),this.baseColor=sc(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Bi(1,1,.5),this.emissiveFactor=Bi(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.overlayTexOffset=_r(-1,-1,-1,-1),this.overlayTexScale=_r(0,0,0,0),this.overlayColor=null,this.overlayHighlight=null,this.overlayNormal=null,this.objectOpacity=1,this.commonMaterialParameters=new A$,this.componentParameters=new zT,this.alphaCutoff=ND,this.alphaDiscardMode=Pr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=n0.Earth,this.sceneHasOcludees=!1,this._techniqueConfig=new fs}dispose(){this._technique=es(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}prepareTechnique(t,i,r){const s=this._techniqueConfig;if(s.hasVertexColors=r.colors,s.hasNormals=r.normals,s.vertexTextureCoordinates=r.textureCoordinates,s.usePBR=this.usePBR,s.hasMetalnessAndRoughnessTexture=L(this.metallicRoughnessTexture),s.hasEmissionTexture=L(this.emissionTexture),s.hasOcclusionTexture=L(this.occlusionTexture),s.hasNormalTexture=L(this.normalTexture),s.transparencyPassType=i.identifier===Un.Material&&i.transparencyPassType!=null?i.transparencyPassType:Qt.NONE,s.multipassTerrainEnabled=i.identifier===Un.Material&&i.multipassTerrainParams!=null&&i.multipassTerrainParams.multipassTerrainEnabled,s.cullAboveGround=i.identifier===Un.Material&&i.multipassTerrainParams!=null&&i.multipassTerrainParams.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,this.dirty){s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Es.View:Es.None,s.baseColorTexture=L(this.baseColorTexture),s.isSchematic=this.hasParametersFromSource&&!L(this.baseColorTexture);const n=this._computeWhichMaterialPass();s.blendingEnabled=n===al.Transparent||n===al.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?jh.ColorOverlayWithWater:jh.ColorOverlay:jh.NoOverlay:jh.None,s.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return s.slicePlaneEnabled=i.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,i.identifier===Un.ShadowMap?(s.output=Te.Shadow,s.vertexDiscardMode=sd.None):i.identifier===Un.Highlight?(s.output=Te.Highlight,s.vertexDiscardMode=sd.None):(this._computeWhichMaterialPass()===al.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?sd.Opaque:sd.Transparent:s.vertexDiscardMode=sd.None,s.output=Wgt(i.subPass),i.subPass===pn.Alpha&&(s.sceneHasOcludees=i.sceneHasOcludees),i.subPass===pn.Color?(s.receiveAmbientOcclusion=i.ambientOcclusionEnabled,s.sceneHasOcludees=i.sceneHasOcludees,s.receiveShadows=i.shadowsEnabled,s.ssrEnabled=i.ssrParams.ssrEnabled):(s.receiveAmbientOcclusion=!1,s.receiveShadows=!1)),this._technique=t.releaseAndAcquire(H8,s,this._technique),this._technique}submit(t,i){if(this.objectOpacity===0)return;const r=i.renderable.geometry,s=i.components,n=i.renderable.drawParameters,a=i.renderable.meta.cameraDepthSquared,l=s.geometryRanges,p=s.highlightRanges,y=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case al.Opaque:t.materialOpaque.submitDraw(this,r,l,n,a);break;case al.Transparent:t.materialTransparent.submitDraw(this,r,l,n,a);break;case al.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,r,l,n,a),t.materialTransparent.submitDraw(this,r,l,n,a);break;case al.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,r,l,n,a),this.overlayHighlight&&t.highlightIntegratedMesh.submitDraw(this,r,l,n,a)}const b=this.componentParameters.castShadows!==Cn.None;b&&t.shadowMap.submitDraw(this,r,l,n,a),L(p)&&(t.highlight.submitDraw(this,r,p,n,a),b&&t.highlightShadowMap.submitDraw(this,r,p,n,a)),b&&L(y)&&t.defaultShadowMap.submitDraw(this,r,y,n,a)}get attributeLocations(){return vTe}_computeWhichMaterialPass(){return this.isIntegratedMesh?al.IntegratedMesh:this.objectOpacity<1?al.Transparent:this.componentParameters.opaqueOverride===Cn.All?al.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Pr.Blend||this.alphaDiscardMode===Pr.MaskBlend?al.Transparent:this.componentParameters.transparent===Cn.None?al.Opaque:this.componentParameters.transparent===Cn.All?al.Transparent:al.OpaqueAndTransparent}}var dce,al,Cn;_([Vr({vectorOps:mde})],Qs.prototype,"baseColor",void 0),_([Vr()],Qs.prototype,"usePBR",void 0),_([Vr()],Qs.prototype,"hasParametersFromSource",void 0),_([Vr({vectorOps:kQ})],Qs.prototype,"mrrFactors",void 0),_([Vr({vectorOps:kQ})],Qs.prototype,"emissiveFactor",void 0),_([Vr({dispose:!0})],Qs.prototype,"baseColorTexture",void 0),_([Vr({dispose:!0})],Qs.prototype,"metallicRoughnessTexture",void 0),_([Vr({dispose:!0})],Qs.prototype,"emissionTexture",void 0),_([Vr({dispose:!0})],Qs.prototype,"occlusionTexture",void 0),_([Vr({dispose:!0})],Qs.prototype,"normalTexture",void 0),_([Vr({vectorOps:{equals:F2,copy:Yl}})],Qs.prototype,"overlayTexOffset",void 0),_([Vr({vectorOps:{equals:F2,copy:Yl}})],Qs.prototype,"overlayTexScale",void 0),_([Vr()],Qs.prototype,"overlayColor",void 0),_([Vr()],Qs.prototype,"overlayHighlight",void 0),_([Vr()],Qs.prototype,"overlayNormal",void 0),_([Vr()],Qs.prototype,"objectOpacity",void 0),_([uce()],Qs.prototype,"commonMaterialParameters",void 0),_([uce()],Qs.prototype,"componentParameters",void 0),_([Vr()],Qs.prototype,"alphaCutoff",void 0),_([Vr()],Qs.prototype,"alphaDiscardMode",void 0),_([Vr()],Qs.prototype,"isIntegratedMesh",void 0),_([Vr()],Qs.prototype,"polygonOffsetEnabled",void 0),_([Vr()],Qs.prototype,"ellipsoidMode",void 0),_([Vr()],Qs.prototype,"sceneHasOcludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(dce||(dce={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(al||(al={}));class A$ extends tK{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Fr.Back,this.slicePlaneEnabled=!0}}_([Vr()],A$.prototype,"doubleSided",void 0),_([Vr()],A$.prototype,"cullFace",void 0),_([Vr()],A$.prototype,"slicePlaneEnabled",void 0);class zT extends tK{constructor(){super(...arguments),this.externalColor=sc(1,1,1,1),this.externalColorMixMode=Bn.Multiply,this.castShadows=Cn.All}get transparent(){return this.externalColor[3]<1?Cn.All:Cn.None}get opaqueOverride(){return this.externalColorMixMode===Bn.Replace&&this.externalColor[3]===1?Cn.All:Cn.None}get visible(){return this.externalColor[3]>0?Cn.All:Cn.None}get type(){return w0.Uniform}}_([Vr({vectorOps:mde})],zT.prototype,"externalColor",void 0),_([Vr()],zT.prototype,"externalColorMixMode",void 0),_([Vr()],zT.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(Cn||(Cn={}));class iM extends tK{constructor(){super(...arguments),this.texture=null,this.transparent=Cn.None,this.opaqueOverride=Cn.None,this.castShadows=Cn.None}get type(){return w0.Varying}}function Wgt(e){switch(e){case pn.Color:return Te.Color;case pn.Alpha:return Te.Alpha;case pn.Depth:return Te.Depth;case pn.Normal:return Te.Normal}}_([Vr()],iM.prototype,"texture",void 0),_([Vr()],iM.prototype,"transparent",void 0),_([Vr()],iM.prototype,"opaqueOverride",void 0),_([Vr()],iM.prototype,"castShadows",void 0);class q8{constructor(t){this._low=fr(),this._high=fr(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;ke(i,t),a0(r,t,i)}setElements(t,i,r){ze(pce,t,i,r),this.set(pce)}get(t){return Xe(t,this._low,this._high)}getLowScaled(t){return Ue(t,this._low,1)}}const pce=Q();class Xgt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class Ygt{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new Vt(this.rctx,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new lc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,a){const l=t*this.fieldCount+i;this.dirty=!0,this.data.set(l,0,r),this.data.set(l,1,s),this.data.set(l,2,n),this.data.set(l,3,a)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new lc(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(this.texture,i),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const bTe=65536;class Jgt{constructor(t,i=1){this.textureBuffer=new Ygt(t,i),this.indexManager=new Xgt(bTe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class wTe{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>bTe)return null;const i=new Jgt(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const fce=Ge.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Zgt{constructor(t){this._renderManager=t,this._objects=[new Ci,new Ci],this._renderSubmit=new Ngt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new wTe(t.rctx)}dispose(){Kt(this._objects[UT.Hidden].length===0&&this._objects[UT.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new ZH;return i.toMapSpace=t.toMapSpace.slice(),i.transform=t.transform,i.obb=pgt(t.obb),i.components=new ygt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new Egt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>{const s=wo(i,r.obb.center);r.renderable.meta.cameraDepthSquared=s})}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material;if(_gt(i)){const n=r.components,a=n.materialDataBuffer,l=n.materialDataIndices,p={castShadows:!0,pickable:!0,externalColor:kZ(),externalColorMixMode:Bn.Multiply},y=a.textureBuffer,b=new Uint8Array(4),x=new Uint32Array(b.buffer);let A=0,M=0,P=0,$=!1,k=0;for(let z=0;z<n.count;z++)i(z,p),A+=+(p.externalColor[3]<1),M+=+(p.externalColorMixMode===Bn.Replace&&p.externalColor[3]===1),P+=+p.castShadows,Txe(p.externalColor,p.externalColorMixMode,b),b[2]=254&b[2]|+p.castShadows,y.setData(l[z],0,b[0],b[1],b[2],b[3]),$=$||z>0&&k!==x[0],k=x[0],p.pickable!==fTe(n.pickability,z)&&(n.pickability=bgt(n.pickability,n.count,z,p.pickable));$?(s.componentParameters=new iM,s.componentParameters.castShadows=VU(P,n.count),s.componentParameters.transparent=VU(A,n.count),s.componentParameters.opaqueOverride=VU(M,n.count),s.componentParameters.texture=y,y.updateTexture()):(s.componentParameters=new zT,s.componentParameters.castShadows=p.castShadows?Cn.All:Cn.None,s.componentParameters.externalColor=p.externalColor,s.componentParameters.externalColorMixMode=p.externalColorMixMode)}else s.componentParameters=new zT,s.componentParameters.castShadows=i.castShadows?Cn.All:Cn.None,s.componentParameters.externalColor=i.externalColor,s.componentParameters.externalColorMixMode=i.externalColorMixMode;this._notifyDirty()}getComponentAabb(t,i,r){return t.intersectionGeometry.getComponentAabb(i,r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,a){const l=t;L(n)&&(n.localOrigin=l.transform.position);const p=iw(mce,l.transform.rotationScale);a0(yI,i,l.transform.position),a0(vI,r,l.transform.position),Gc(yI,yI,p),Gc(vI,vI,p);const y=gd(mce,p);return l.intersectionGeometry.intersect(yI,vI,s,y,n,a)}addEdges(t,i,r,s){const n=t,{indices:a,positions:l}=n.intersectionGeometry,p=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:fgt(n.obb)},l,a,p,r,s)}addComponentHighlight(t,i){const r=t.components;J(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(J(r.highlightCounts))return void fce.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else fce.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;L(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[UT.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,a=Fi.createVertex(r,tr.STATIC_DRAW,s.vertices.data),l=Da(s.indices,G=>Fi.createIndex(r,tr.STATIC_DRAW,G)),p=ch(Fgt(n)),y=new Uint16Array(s.vertices.count);for(let G=0;G<i.count;G++){const B=i.offsets[G],W=i.offsets[G+1],q=i.materialDataIndices[G];if(L(s.indices))for(let X=B;X<W;X++)y[s.indices[X]]=q;else for(let X=B;X<W;X++)y[X]=q}const b=Fi.createVertex(r,tr.STATIC_DRAW,y.buffer),x=new q8(t.transform.position),A=z3e(t.transform.rotationScale);iw(A,A),gd(A,A);const M=new _Te;ke(M.transformWorldFromModelTL,x.low),ke(M.transformWorldFromModelTH,x.high),LR(M.transformWorldFromModelRS,t.transform.rotationScale),LR(M.transformNormalGlobalFromModel,A),Yl(M.toMapSpace,t.toMapSpace);const P=new Qs,$=new In(r,P.attributeLocations,{data:p,componentIndices:Kgt},{data:a,componentIndices:b},l),k=new gTe($,mi.TRIANGLES,n,L(l)),z={cameraDepthSquared:.5,gpuMemoryEstimate:a.byteSize+b.byteSize+(L(l)?l.byteSize:0)};return new Mgt(P,M,k,z)}_notifyDirty(){this._renderManager.notifyDirty()}}const Kgt=ch(on().u16(Y.COMPONENTINDEX));function VU(e,t){return e===t?Cn.All:e===0?Cn.None:Cn.Some}const mce=yg(),yI=Q(),vI=Q();class Qgt{constructor(t,i){this._rctx=t,this._techniqueRepository=i}dispose(){this._vao=Xt(this._vao)}compositeTransparent(t,i,r,s=1){const n=this._rctx;sm.alphaMode=la.Alpha,sm.function=Kl.Transparency,sm.hasOpacityFactor=s!==1;const a=this._techniqueRepository.acquire(nO,sm),l=n.useTechnique(a);l.bindTexture(t,"colorTexture"),l.bindTexture(i,"alphaTexture"),l.bindTexture(r,"frontFaceTexture");const p=this._ensureVAO();n.bindVAO(p),n.drawArrays(mi.TRIANGLE_STRIP,0,zo(p,"geometry")),a.release()}composite(t,i=la.None,r=1,s=Kl.Standard,n=Tn.INNER){const a=this._rctx;sm.alphaMode=i,sm.function=s,sm.hasOpacityFactor=r!==1;const l=this._techniqueRepository.acquire(nO,sm),p=a.useTechnique(l);p.bindTexture(t,"tex"),sm.hasOpacityFactor&&p.setUniform1f("opacity",r),s===Kl.OverlayWithTransparency&&p.setUniform1i("overlayIdx",n);const y=this._ensureVAO();a.bindVAO(y),a.drawArrays(mi.TRIANGLE_STRIP,0,zo(y,"geometry")),l.release()}_ensureVAO(){return J(this._vao)&&(this._vao=Ga(this._rctx)),this._vao}}const sm=new h$,e1t=1e4,QH=100,t1t=500,i1t=500,r1t=.1;function s1t(e,t,i){return WJ(t,e)*(i[1]-i[0])+i[0]}function n1t(e,t,i){if(t.size<e1t)return p1t.compute(e,t);const r=w4();return i.forAll(s=>{s.isVisible&&KS(r,o1t(e,s))}),r}function o1t(e,t){if(!t.isVisible)return;const i=w4(),r=t.getSpatialQueryAccelerator();return L(r)?a1t(i,e,r):l1t(i,e,t.objects),i}function a1t(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,a=p=>p.isVisible,l=i.objectCount;if(l<t1t)yO(ju,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,qh.FRONT_TO_BACK,ju,(p,y)=>{eq(e,t,p),ju.far=e.near,y.setRange(ju)},n,a),yO(ju,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,qh.BACK_TO_FRONT,ju,(p,y)=>{eq(e,t,p),ju.near=e.far,y.setRange(ju)},n,a);else{const p=Math.max(Math.min(l,i1t),Math.ceil(l*r1t)),y=i.findClosest(s,qh.FRONT_TO_BACK,n,a,p),b=i.findClosest(s,qh.BACK_TO_FRONT,n,a,p);y&&b&&(gce(e,t,y.boundingVolumeWorldSpace.bounds),gce(e,t,b.boundingVolumeWorldSpace.bounds))}}function l1t(e,t,i){Px.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&Px.add(r)}),Px.empty||(Px.sort(t),yO(ju,t.near,Math.min(e.near,t.far)),Px.forEachInDepthRange(ju,qh.FRONT_TO_BACK,(r,s)=>{s<e.near&&eq(e,t,r)}),yO(ju,Math.max(e.far,t.near),t.far),Px.forEachInDepthRange(ju,qh.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function eq(e,t,i){if(!i.isVisible||!ev(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=d1t;i.geometryRecords.forEach(n=>{As(s,r,n.getShaderTransformation());const a=z2(s);xTe(e,t,n.geometry.boundingInfo,s,a)})}function xTe(e,t,i,r,s){if(J(i))return;const n=t.eye,a=t.viewForward;Ct(na,i.center,r);const l=a[0]*(na[0]-n[0])+a[1]*(na[1]-n[1])+a[2]*(na[2]-n[2]);if(na[3]=i.radius*s,!(l-na[3]>e.near&&l+na[3]<e.far)&&ev(t.frustum,na))if(i.radius>QH&&i.getChildren()){const p=i.getChildren();for(let y=0;y<8;++y)p[y]&&xTe(e,t,p[y],r,s)}else tq.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function gce(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class c1t{constructor(){this._items=new Ci({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,a=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=a,s.near=a-n[3],s.far=a+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===qh.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class h1t{constructor(){this.view=lt(),this.viewProj=lt(),this.frustum=JR(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),nn(this.view,t.viewMatrix),As(this.viewProj,t.projectionMatrix,this.view),TD(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],a=r[10],l=r[14],p=this.range;let y=0;if(i.forEach(M=>{if(!M.instanceParameters.visible||!M.castShadow)return;let P;M.hasShaderTransformation?(M.computeBoundingSphere(M.getShaderTransformation(),na,1),P=na):P=M.boundingSphere;const $=s*P[0]+n*P[1]+a*P[2]+l,k=$-P[3],z=$+P[3];this.geometries[y]=M,this.near[y]=-z,this.far[y]=-k,++y}),this.geometries.length===0)return p;for(let M=0;M<this.geometries.length;++M)this.near[M]>p.far&&(p.far=this.near[M]),this.near[M]>2&&this.far[M]<p.near&&(p.near=this.far[M]);const b=this.looseRange;b.near=Math.max(.5*p.near,2),b.far=2*p.far;let x=0,A=0;for(let M=0;M<this.geometries.length;++M)this.near[M]<p.near&&(this.near[M]>=b.near?p.near=this.near[M]:this.nearCandidates[x++]=M),this.far[M]>p.far&&(this.far[M]<=b.far?p.far=this.far[M]:this.farCandidates[A++]=M);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return p;this.nearCandidates.sort((M,P)=>this.near[M]<this.near[P]?-1:this.near[M]>this.near[P]?1:0),this.farCandidates.sort((M,P)=>this.far[M]<this.far[P]?1:this.far[M]>this.far[P]?-1:0);for(let M=0;M<this.nearCandidates.length;++M){const P=this.nearCandidates[M];if(this.near[P]<p.near){const $=this.geometries[P],k=$.boundingInfo;this._includeNearBoundingInfoRec(k,$.getShaderTransformation())}}for(let M=0;M<this.farCandidates.length;++M){const P=this.farCandidates[M];if(this.far[P]>p.far){const $=this.geometries[P],k=$.boundingInfo;this._includeFarBoundingInfoRec(k,$.getShaderTransformation())}}return p}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(J(t))return;const r=t.getCenter();Ct(na,r,i);const s=z2(i),n=na[0],a=na[1],l=na[2],p=t.getBSRadius()*s,y=this.frustum;if(y[0][0]*n+y[0][1]*a+y[0][2]*l+y[0][3]>p||y[1][0]*n+y[1][1]*a+y[1][2]*l+y[1][3]>p||y[2][0]*n+y[2][1]*a+y[2][2]*l+y[2][3]>p||y[3][0]*n+y[3][1]*a+y[3][2]*l+y[3][3]>p)return;const b=this.view[2]*n+this.view[6]*a+this.view[10]*l+this.view[14],x=b+p;if(!(-(b-p)<2||-x>=this.range.near))if(-x>this.looseRange.near)this.range.near=-x;else{if(p>QH){const A=t.getChildren();if(A!==void 0){for(let M=0;M<8;++M)A[M]!==void 0&&this._includeNearBoundingInfoRec(A[M],i);return}}tq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(J(t))return;let r=t.getBSRadius();const s=t.getCenter();Ct(na,s,i);const n=z2(i),a=na[0],l=na[1],p=na[2];r*=n;const y=this.frustum;if(y[0][0]*a+y[0][1]*l+y[0][2]*p+y[0][3]>r||y[1][0]*a+y[1][1]*l+y[1][2]*p+y[1][3]>r||y[2][0]*a+y[2][1]*l+y[2][2]*p+y[2][3]>r||y[3][0]*a+y[3][1]*l+y[3][2]*p+y[3][3]>r)return;const b=this.view[2]*a+this.view[6]*l+this.view[10]*p+this.view[14]-r;if(!(-b<=this.range.far))if(-b<this.looseRange.far)this.range.far=-b;else{if(r>QH){const x=t.getChildren();if(x!==void 0){for(let A=0;A<8;++A)x[A]!==void 0&&this._includeFarBoundingInfoRec(x[A],i);return}}tq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class u1t{constructor(){this.modelViewProj=lt(),this.clipPosition=[nr(),nr(),nr(),nr(),nr(),nr(),nr(),nr()]}unionDepthRangeWithAABB(t,i,r,s,n){const a=this.modelViewProj;As(a,i,r);let l=!1;for(let p=0;p<8;++p){const y=this.clipPosition[p],b=p===0||p===3||p===4||p===7?s[0]:n[0],x=p===0||p===1||p===4||p===5?s[1]:n[1],A=p<4?s[2]:n[2];y[0]=a[0]*b+a[4]*x+a[8]*A+a[12],y[1]=a[1]*b+a[5]*x+a[9]*A+a[13],y[2]=a[2]*b+a[6]*x+a[10]*A+a[14],y[3]=a[3]*b+a[7]*x+a[11]*A+a[15]}for(let p=0;p<12;++p){const y=this.clipPosition[GU[p][0]],b=this.clipPosition[GU[p][1]],x=this.clipPosition[GU[p][2]],A=this._clipTriangle(y,b,x);let M=!0;for(let P=0;P<A.length;++P)if(A[P][3]>=2){M=!1;break}if(!M){l=!0;for(let P=0;P<A.length;++P){const $=A[P][3];$<t.near&&(t.near=$),$>t.far&&(t.far=$)}}}return l}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void Kt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),tW(nr(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const a=s;s=[];for(let l=0;l<a.length;++l){const p=a[l],y=a[(l+1)%a.length];this._inside(y,n)?(this._inside(p,n)||s.push(this._intersect(p,y,n)),s.push(y)):this._inside(p,n)&&s.push(this._intersect(p,y,n))}}return s}}const GU=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],na=qo(),d1t=lt(),ju=w4(),Px=new c1t,p1t=new h1t,tq=new u1t;function f1t(){const e=new Ir;return e.attributes.add(Y.POSITION,"vec2"),e.vertex.uniforms.add("proj","mat4"),e.vertex.uniforms.add("drawPosition","vec4"),e.varyings.add("vUV","vec2"),e.vertex.code.add(V`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add("textureInput","sampler2D"),e.fragment.uniforms.add("textureMask","sampler2D"),e.fragment.uniforms.add("textureOverlay","sampler2D"),e.fragment.uniforms.add("maskEnabled","bool"),e.fragment.uniforms.add("overlayEnabled","bool"),e.fragment.code.add(V`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function m1t(e){const t=import("./mask-svg.318fc328.js"),i=import("./overlay-svg.5292dcb7.js"),r=yd((await t).default,{signal:e}),s=yd((await i).default,{signal:e}),n={mask:await r,overlay:await s};return Gi(e),n}let O3=class extends st{constructor(){super(...arguments),this._handles=new Ei,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this.events=new ps,this.attributeLocations=new Map([[Y.POSITION,0]]),this.tmpScreenPoint=Ns(),this.tmpRenderPoint=J$e()}get updating(){return J(this._imageSources)&&L(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};L(this._magnifier)&&this._handles.add(this._magnifier.watch("version",t)),t()}get enabled(){return L(this._validMagnifier)}get _validMagnifier(){return L(this._magnifier)&&this._magnifier.visible&&L(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return L(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),L(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(J(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),J(this._resources))return;const n=this._resources.program;e.useProgram(n);const a=this._resources.textures,l=Math.ceil(1/this.factor*s);a.input.resize(l,l);const p=t.camera.fullWidth,y=t.camera.fullHeight;Ym(i.position,this.tmpScreenPoint);const b=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),x=.5*l,A=.5*l;b[0]=Ot(b[0],x,p-x-1),b[1]=Ot(b[1],A,y-A-1);const M=Math.floor(b[0]-x),P=Math.floor(b[1]-A);n.bindTexture(a.input,"textureInput"),e.gl.copyTexImage2D(a.input.descriptor.target,0,a.input.descriptor.pixelFormat,M,P,l,l,0);const $=i.offset.x*r,k=i.offset.y*r,z=(b[0]+$)/p*2-1,G=(b[1]-k)/y*2-1,B=s/p*2,W=s/y*2;e.bindVAO(this._resources.vao),n.bindTexture(a.overlay,"textureOverlay"),n.bindTexture(a.mask,"textureMask"),n.setUniform4f("drawPosition",z,G,B,W),n.setUniform1b("maskEnabled",i.maskEnabled),n.setUniform1b("overlayEnabled",i.overlayEnabled),e.setPipelineState(this._resources.pipelineState),e.drawArrays(mi.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(J(e))return;const t=e.maskUrl,i=e.overlayUrl;!L(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),L(this._imageSources)||L(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:SO(async r=>{const s=J(t)||J(i)?m1t(r):null,n=L(t)?yd(t,{signal:r}):s.then(l=>l.mask),a=L(i)?yd(i,{signal:r}):s.then(l=>l.overlay);this._imageSources={mask:await n,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(L(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(J(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);J(i)||(this._resources={textures:i,program:this._createProgram(e),vao:Ga(e,JY,this.attributeLocations,0,1),pipelineState:Ti({blending:su(ht.ONE,ht.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ii})})}_disposeResources(){J(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(J(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!0,preMultiplyAlpha:!_W(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.ALPHA,internalFormat:_t.ALPHA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){const t=f1t();return new $r(e,t,this.attributeLocations)}};_([S()],O3.prototype,"_imageSources",void 0),_([S()],O3.prototype,"_imageLoadTask",void 0),_([S({readOnly:!0})],O3.prototype,"updating",null),O3=_([re("esri/views/3d/webgl-engine/lib/MagnifierHelper")],O3);const g1t=.5,y1t=1e3/30;var vO;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(vO||(vO={}));class I1{constructor(t,i,r=vO.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new Ci({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s,n){const a=this._draws.pushNew();a.geometry=i,a.geometryRanges=r,a.material=t,a.bindDrawParams=s,a.depthSquaredHint=n,a.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t){const i=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let r=null;const s=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,a.geometry.parameters)),n=this._draws.length;for(let a=0;a<n;a++){const l=s[a];l===r&&l.configuration.transparencyPassType===Qt.NONE||(i.useTechnique(l,t.slot),r=l),this._passBoundTechniques.has(l)||(l.bindPass(t),this._passBoundTechniques.add(l));const p=this._draws.data[a],y=p.geometry;i.bindVAO(y.vao),this._previouslyBoundMaterials.get(l)!==p.material&&(l.bindMaterial(p.material,t),this._previouslyBoundMaterials.set(l,p.material)),this._previouslyBoundDraw.get(l)!==p.bindDrawParams&&(l.bindDraw(p.bindDrawParams),this._previouslyBoundDraw.set(l,p.bindDrawParams));const b=p.geometryRanges,x=b.length;if(p.indexType!==0){const A=C$.get(p.indexType);for(let M=0;M<x;M+=2){const P=b[M],$=b[M+1];i.drawElements(y.primitiveType,$,p.indexType,P*A)}}else for(let A=0;A<x;A+=2){const M=b[A],P=b[A+1];i.drawArrays(y.primitiveType,M,P)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===vO.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const C$=new Map;C$.set(Zt.UNSIGNED_BYTE,1),C$.set(Zt.UNSIGNED_SHORT,2),C$.set(Zt.UNSIGNED_INT,4);class v1t{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParams=new Ggt,this._shadowPassParams=new jgt,this._highlightPassParams=new Hgt,this._systems=new Set,this._passes={materialOpaque:new I1(t,this.shaderTechniqueRepository),materialTransparent:new I1(t,this.shaderTechniqueRepository,vO.BackToFront),materialIntegratedMesh:new I1(t,this.shaderTechniqueRepository),shadowMap:new I1(t,this.shaderTechniqueRepository),highlight:new I1(t,this.shaderTechniqueRepository),highlightIntegratedMesh:new I1(t,this.shaderTechniqueRepository),highlightShadowMap:new I1(t,this.shaderTechniqueRepository),defaultShadowMap:new I1(t,this.shaderTechniqueRepository)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,{camera:t}));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.slot){case tt.OPAQUE_PLUGIN:switch(t.pass){case bt.MATERIAL:return this._materialPassParams.subPass=pn.Color,this._configureMaterialColorPass(t),this._passes.materialOpaque.dispatch(this._materialPassParams);case bt.MATERIAL_DEPTH:return this._materialPassParams.subPass=pn.Depth,this._passes.materialOpaque.dispatch(this._materialPassParams);case bt.MATERIAL_NORMAL:return this._materialPassParams.subPass=pn.Normal,this._passes.materialOpaque.dispatch(this._materialPassParams);case bt.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParams);case bt.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParams);case bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParams);case bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParams)}return;case tt.TRANSPARENT_PLUGIN:switch(t.pass){case bt.MATERIAL:return this._materialPassParams.subPass=pn.Color,this._configureMaterialColorPass(t),this._passes.materialTransparent.dispatch(this._materialPassParams);case bt.MATERIAL_ALPHA:return this._materialPassParams.subPass=pn.Alpha,this._configureMaterialColorPass(t),this._passes.materialTransparent.dispatch(this._materialPassParams);case bt.MATERIAL_DEPTH:return this._materialPassParams.subPass=pn.Depth,this._passes.materialTransparent.dispatch(this._materialPassParams);case bt.MATERIAL_NORMAL:return this._materialPassParams.subPass=pn.Normal,this._passes.materialTransparent.dispatch(this._materialPassParams)}return;case tt.INTEGRATED_MESH:switch(t.pass){case bt.MATERIAL:return this._materialPassParams.subPass=pn.Color,this._configureMaterialColorPass(t),this._materialPassParams.ssrParams=t.ssrParams,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case bt.MATERIAL_DEPTH:return this._materialPassParams.subPass=pn.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case bt.MATERIAL_NORMAL:return this._materialPassParams.subPass=pn.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case bt.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return}}notifyDirty(){this._context.requestRender()}slots(){return[tt.OPAQUE_PLUGIN,tt.TRANSPARENT_PLUGIN,tt.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);L(s)&&KS(i,s,i)}),i}get shadowCastingEnabled(){return this._materialPassParams.shadowsEnabled}set shadowCastingEnabled(t){this._materialPassParams.shadowsEnabled=t}get fillLightsEnabled(){return this._materialPassParams.hasFillLights}set fillLightsEnabled(t){this._materialPassParams.hasFillLights=t}get screenSpaceReflectionsEnabled(){return L(this._materialPassParams.ssrParams.ssrEnabled)}set screenSpaceReflectionsEnabled(t){this._materialPassParams.ssrParams.ssrEnabled=!!t}_configureMaterialColorPass(t){this._materialPassParams.bindShadowMap=i=>{t.shadowMap.bind(i);const r=this._materialPassParams.viewTransform;Xe(zA,r.transformWorldFromViewTL,r.transformWorldFromViewTH),t.shadowMap.bindView(i,zA)},this._materialPassParams.bindAmbientOcclusion=i=>t.ssaoHelper.bind(i,t.camera),this._materialPassParams.ambientOcclusionEnabled=!!t.ssaoHelper&&t.ssaoHelper.ready,this._materialPassParams.sceneHasOcludees=t.hasOccludees}_configure(t){const i=t.pass===bt.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParams:t.pass===bt.MATERIAL_HIGHLIGHT?this._highlightPassParams:this._materialPassParams;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.camera,s=r.viewInverseTransposeMatrix;ze(zA,s[3],s[7],s[11]),jU.set(zA),ke(i.viewTransform.transformWorldFromViewTH,jU.high),ke(i.viewTransform.transformWorldFromViewTL,jU.low),md(i.viewTransform.transformViewFromCameraRelativeRS,r.viewMatrix),nn(i.viewTransform.transformProjFromView,r.projectionMatrix),i.identifier===Un.Material?(this._materialPassParams.transparent=t.slot===tt.TRANSPARENT_PLUGIN,this._materialPassParams.integratedMesh=t.slot===tt.INTEGRATED_MESH,this._materialPassParams.lighting=t.scenelightingData,gd(yce,i.viewTransform.transformViewFromCameraRelativeRS),iw(i.transformNormalViewFromGlobal,yce),Pn(i.nearFar,r.nearFar)):i.identifier===Un.ShadowMap?Pn(i.nearFar,r.nearFar):i.identifier===Un.Highlight&&(i.highlightDepthTexture=t.highlightDepthTexture,Yl(i.viewport,r.fullViewport)),i.identifier!==Un.Material&&i.identifier!==Un.Highlight||(i.inverseViewport[0]=1/r.fullViewport[2],i.inverseViewport[1]=1/r.fullViewport[3]),sge(t.sliceHelper.plane,i.slicePlane),We(i.slicePlane.origin,i.slicePlane.origin,zA),i.slicePlaneEnabled=t.sliceHelper.isEnabled,this._materialPassParams.slot=t.slot,this._materialPassParams.transparencyPassType=t.transparencyPassType,this._materialPassParams.multipassTerrainParams=t.multipassTerrainParams}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const zA=Q(),yce=zs(),jU=new q8;var Vc;function _1t(e){const t=new Ir,i=t.vertex.code,r=t.fragment.code;return t.attributes.add(Y.POSITION,"vec2"),e.highlightStage===Vc.Downsample&&(i.add(V`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("invFramebufferDim","vec2"),r.add(V`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`)),e.highlightStage===Vc.Blur&&(t.attributes.add(Y.UV0,"vec2"),e.gridOptimization?(t.vertex.uniforms.add("coverageTex","sampler2D"),t.fragment.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinate","vec3")):(t.vertex.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinates[5]","vec2")),i.add(V`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e.gridOptimization?V`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:V`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),t.fragment.uniforms.add("tex","sampler2D"),r.add(V`
    void main() {
      ${e.gridOptimization?V`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:V`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`)),e.highlightStage===Vc.Apply&&(t.varyings.add("uv","vec2"),e.gridOptimization&&(t.attributes.add(Y.UV0,"vec2"),t.vertex.uniforms.add("coverageTex","sampler2D")),i.add(V`
      void main() {
        ${e.gridOptimization?V`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("origin","sampler2D"),t.fragment.uniforms.add("uColor","vec4"),t.fragment.uniforms.add("haloColor","vec4"),t.fragment.uniforms.add("outlineSize","float"),t.fragment.uniforms.add("blurSize","float"),t.fragment.uniforms.add("opacities","vec4"),r.add(V`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`)),t}(function(e){e[e.Blur=0]="Blur",e[e.Apply=1]="Apply",e[e.Downsample=2]="Downsample",e[e.COUNT=3]="COUNT"})(Vc||(Vc={}));const b1t=Object.freeze({__proto__:null,get HighlightCompositionPass(){return Vc},build:_1t}),w1t=8.6,x1t=.4;class ky extends Xr{initializeProgram(t){const i=ky.shader.get().build(this.configuration);return new $r(t.rctx,i,mr)}bindApplyPass(t){this.program.setUniform4fv("uColor",t.color),this.program.setUniform4fv("haloColor",t.haloColor),this.program.setUniform1f("outlineSize",w1t),this.program.setUniform1f("blurSize",x1t),this.program.setUniform4f("opacities",t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)}initializePipeline(){return this.configuration.highlightStage===Vc.Apply?Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),colorWrite:Ii}):Ti({colorWrite:Ii})}get primitiveType(){return this.configuration.gridOptimization?mi.TRIANGLES:mi.TRIANGLE_STRIP}}ky.shader=new Ur(b1t,()=>import("./HighlightComposition.glsl.e594df6d.js"));class iq extends Rs{constructor(){super(...arguments),this.highlightStage=Vc.Blur,this.gridOptimization=!1}}_([Oe({count:Vc.COUNT})],iq.prototype,"highlightStage",void 0),_([Oe()],iq.prototype,"gridOptimization",void 0);const T1t=32;class S1t{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=nr(),this.defaultOptions={color:sc(1,0,1,1),haloColor:sc(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:sc(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075},this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=Ga(this._rctx);const t={colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE,width:0,height:0},i={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Hr(this._rctx,t,i),this.blur1Fbo=new Hr(this._rctx,t,i);const r=new iq;r.highlightStage=Vc.Blur,r.gridOptimization=!1,this.blurTechnique=this._techniqueRep.acquire(ky,r),r.highlightStage=Vc.Blur,r.gridOptimization=!0,this.blurGridTechnique=this._techniqueRep.acquire(ky,r),r.highlightStage=Vc.Apply,r.gridOptimization=!1,this.applyTechnique=this._techniqueRep.acquire(ky,r),r.highlightStage=Vc.Apply,r.gridOptimization=!0,this.applyGridTechnique=this._techniqueRep.acquire(ky,r),r.highlightStage=Vc.Downsample,r.gridOptimization=!1,this.downsampleTechnique=this._techniqueRep.acquire(ky,r)}dispose(){if(this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Xt(this.blur0Fbo),this.blur1Fbo=Xt(this.blur1Fbo)}get profilingCallback(){return ur.HIGHLIGHTS_PROFILE_TO_CONSOLE?t=>console.log(t):null}setDefaultOptions(t){this.defaultOptions=t}render(t,i,r){const s=t.pixelRatio,n=ur.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,a=this._rctx;this._assertResources(),Yl(this.viewportToRestore,t.fullViewport);const l=t.fullWidth,p=t.fullHeight,y=Math.ceil(l/s),b=Math.ceil(p/s);this.blur0Fbo.resize(y,b),this.blur1Fbo.resize(y,b),a.bindVAO(this.quadVAO);let x=null;const A=n?this.blurGridTechnique:this.blurTechnique,M=a.useTechnique(A);n?(this._gridUpdateResources(i,T1t),this._gridComputeMipmap(),x=this._grid.vao,M.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):x=this.quadVAO,a.bindVAO(x),a.bindFramebuffer(this.blur0Fbo),a.setViewport(0,0,y,b),a.setClearColor(0,0,0,0),a.clear(Sr.COLOR_BUFFER_BIT),M.bindTexture(i.colorTexture,"tex"),M.setUniform2f("blurSize",1/y,0),a.drawArrays(A.primitiveType,0,zo(x,"geometry")),a.bindFramebuffer(this.blur1Fbo),a.clear(Sr.COLOR_BUFFER_BIT),M.bindTexture(this.blur0Fbo.colorTexture,"tex"),M.setUniform2f("blurSize",0,1/b),a.drawArrays(A.primitiveType,0,zo(x,"geometry")),a.bindFramebuffer(r),a.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);const P=n?this.applyGridTechnique:this.applyTechnique,$=a.useTechnique(P);if($.bindTexture(this.blur1Fbo.colorTexture,"tex"),$.bindTexture(i.colorTexture,"origin"),n){const k=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;$.bindTexture(k,"coverageTex")}P.bindApplyPass(this.defaultOptions),a.drawArrays(P.primitiveType,0,zo(x,"geometry")),a.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let p=1;p<s.coverageMipmap.length;p++)s.coverageMipmap[p].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let p=0;p<s.mipmapLevels;p++){const y=s.coverageMipmap[p],b={target:Yt.TEXTURE_2D,pixelFormat:_t.RGB,dataType:ai.UNSIGNED_SHORT_5_6_5,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:Math.ceil(y.width/2),height:Math.ceil(y.height/2)},x={colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE,width:Math.ceil(y.width/2),height:Math.ceil(y.height/2)};s.coverageMipmap[p+1]=new Hr(r,x,b)}}const a=Math.ceil(t.height/s.cellPixelSize),l=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==a||s.horizontalCellCount!==l){s.verticalCellCount=a,s.horizontalCellCount=l;const p=a+1,y=l+1,b=1/a,x=1/l,A=6,M=4,P=new Float32Array(A*M*p*y);let $=0;for(let k=0;k<p;k++)for(let z=0;z<y;z++)P[$+0]=(z-.5)*x*2-1,P[$+1]=(k-.5)*b*2-1,P[$+2]=z*x,P[$+3]=k*b,P[$+4]=(z+.5)*x*2-1,P[$+5]=(k-.5)*b*2-1,P[$+6]=z*x,P[$+7]=k*b,P[$+8]=(z-.5)*x*2-1,P[$+9]=(k+.5)*b*2-1,P[$+10]=z*x,P[$+11]=k*b,P[$+12]=(z-.5)*x*2-1,P[$+13]=(k+.5)*b*2-1,P[$+14]=z*x,P[$+15]=k*b,P[$+16]=(z+.5)*x*2-1,P[$+17]=(k-.5)*b*2-1,P[$+18]=z*x,P[$+19]=k*b,P[$+20]=(z+.5)*x*2-1,P[$+21]=(k+.5)*b*2-1,P[$+22]=z*x,P[$+23]=k*b,$+=A*M;s.vao&&s.vao.dispose(!0),s.vao=new In(r,mr,{geometry:t4},{geometry:Fi.createVertex(r,tr.STATIC_DRAW,P)})}}_gridComputeMipmap(){const t=this._rctx,i=this._grid,r=t.useTechnique(this.downsampleTechnique);t.bindVAO(this.quadVAO);for(let s=0;s<i.mipmapLevels;s++){t.bindFramebuffer(i.coverageMipmap[s+1]),r.bindTexture(i.coverageMipmap[s].colorTexture,"tex");const n=i.coverageMipmap[s+1].width,a=i.coverageMipmap[s+1].height;r.setUniform2f("invFramebufferDim",1/n,1/a),t.setViewport(0,0,n,a),t.drawArrays(mi.TRIANGLE_STRIP,0,zo(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(L(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(L(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const E1t={dataType:ai.UNSIGNED_BYTE,internalFormat:_t.RGBA},A1t={};class C1t{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new Vt(this.rctx,{target:Yt.TEXTURE_2D,pixelFormat:_t.DEPTH_STENCIL,dataType:ai.UNSIGNED_INT_24_8,samplingMode:Pt.NEAREST,wrapMode:ei.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new E3(this.rctx,ie({internalFormat:hl.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new Vt(this.rctx,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return ie(ie({id:ec()},A1t),t)}registerColorTarget(t={}){return ie(ie({id:ec()},E1t),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const a=this.getColorTexture(i,t);if(this.depthTextureSupported){const p=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==a||n.depthStencilTexture!==p)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(a),n.attachDepthStencilTexture(p)),n):(n=L(r)?new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.DEPTH_STENCIL_TEXTURE},a,p):new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},a),this._framebuffers.set(s,n),n)}const l=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==a)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(a),n.attachDepthStencilBuffer(l)),n):(n=new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:r?Qi.DEPTH_STENCIL_RENDER_BUFFER:Qi.NONE},a,l),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=uv(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class M1t{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===Yi.WEBGL2;this._renderTargetHelper=new C1t(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=a=>s.registerColorTarget({name:a,dataType:ai.FLOAT,internalFormat:r?Jt.RGBA32F:_t.RGBA,samplingMode:Pt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Pt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Jt.RGBA4:_t.RGBA,dataType:ai.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Jt.RGBA4:_t.RGBA,dataType:ai.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT|Sr.STENCIL_BUFFER_BIT)}composite(){L(this.colorTexture)&&this._compositingHelper.composite(this.colorTexture,la.None)}renderTmpAndCompositeToMain(t,i,r=!1){this.renderToTargets(t,this.tmpColor,r?this.tmpDepth:this.mainDepth,R1t),this._compositingHelper.composite(this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,O1t)}compositeTransparentTerrainOntoHUDVisibility(){this.renderToTargets(()=>this._compositingHelper.composite(this._getColorTexture(this.tmpColor),la.None,1,Kl.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case Qt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Qt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Qt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(){this.bindFramebuffer(),this._compositingHelper.composite(this._getColorTexture(this.tmpColor),la.PremultipliedAlpha)}compositeOccludedOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(this._getColorTexture(this.tmpColor),la.PremultipliedAlpha,t)}compositeTransparentOntoOpaque(t){t?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Sr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,a=!1){const l=this._rctx,p=this.bindTarget(i,r);let y=0;if(s){const x=Math.max(1e-13,s[3]);l.setClearColor(s[0],s[1],s[2],x),y|=Sr.COLOR_BUFFER_BIT}return n&&(y|=Sr.DEPTH_BUFFER_BIT),a===!1?a=0:(a===!0&&(a=255),y|=Sr.STENCIL_BUFFER_BIT),y&&l.clearSafe(y,a),t(),l.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),p}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const R1t=[0,0,0,0],O1t=[0,1,0,1];class P1t{constructor(t){this.context=t,this.renderPlugins=new Array,this.slots=[];for(let i=0;i<tt.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{this.renderPlugins.push(i);for(const a of t)this.slots[a].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(au(n))return n.then(s);s()}remove(t){const i=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(r=>r!==t),Kt(this.renderPlugins.length<i,"Removing non-added render plugin");for(let r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter(s=>s!==t);t.uninitializeRenderContext(),this.context.requestRender()}prepareRender(t,i){for(const r of this.renderPlugins)r.prepareRender&&r.prepareRender(t,i)}updateAnimation(t){let i=!1;return this.renderPlugins.forEach(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(I1t(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=$1t;i.near=1/0,i.far=-1/0;for(const r of this.renderPlugins)if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&KS(i,s,i)}return i}get needsTransparentPass(){return this.renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this.renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this.renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[tt.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){let t=0;return this.renderPlugins.forEach(i=>{i.renderOccludedFlags&&(t|=i.renderOccludedFlags)}),t}}function I1t(e){return"prepareTechnique"in e}const $1t={near:0,far:0};function iK(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(V`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}var aa,Dg;(function(e){e[e.Accumulate=0]="Accumulate",e[e.Visualize=1]="Visualize",e[e.VisualizeCurrent=2]="VisualizeCurrent",e[e.COUNT=3]="COUNT"})(aa||(aa={})),function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold"}(Dg||(Dg={}));const W8=255,D1t=1/W8;function L1t(e){const t=new Ir;t.fragment.include(qp),t.fragment.include(Yn),t.include(iK),t.include(Xv);const{pass:i}=e;if(i===aa.Visualize){const{visualization:r,bandsEnabled:s}=e;t.fragment.constants.add("inverseSampleValue","float",W8),t.fragment.uniforms.add("shadowCastMap","sampler2D"),t.fragment.uniforms.add("sampleScale","float"),t.fragment.uniforms.add("opacityFromElevation","float");const n=r===Dg.Gradient,a=r===Dg.Threshold;t.fragment.uniforms.add("uColor","vec4"),n?s&&t.fragment.uniforms.add("bandSize","float"):a&&t.fragment.uniforms.add("threshold","float"),t.fragment.code.add(V`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${a?V`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?V`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?V`* strength`:""});
      }
    `)}else i!==aa.Accumulate&&i!==aa.VisualizeCurrent||(t.include($g),t.fragment.uniforms.add("depthMap","sampler2D"),t.fragment.uniforms.add("inverseViewMatrix","mat4"),t.fragment.uniforms.add("nearFar","vec2"),i===aa.Accumulate?t.fragment.constants.add("sampleValue","float",D1t):t.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),t.fragment.code.add(V`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= numCascades) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${i===aa.Accumulate?V`vec4(sampleValue)`:V`shadowColor`};
      }
    `));return t}const N1t=Object.freeze({__proto__:null,get ShadowCastPass(){return aa},get ShadowCastVisualization(){return Dg},shadowCastMaxSamples:W8,build:L1t});class x4 extends Xr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=x4.shader.get().build(this.configuration);return new $r(t.rctx,i,mr)}initializePipeline(t){switch(this.configuration.pass){case aa.Accumulate:return Ti({blending:ga(ht.ONE,ht.ONE,ht.ONE,ht.ONE),colorWrite:Ii,depthTest:null,depthWrite:null});case aa.Visualize:case aa.VisualizeCurrent:return Ti({blending:Qc,colorWrite:Ii,depthTest:null,depthWrite:null})}return Ti({})}bindPass(t){if(this.configuration.pass===aa.Accumulate||this.configuration.pass===aa.VisualizeCurrent){const i=t;this.program.bindTexture(i.linearDepthTexture,"depthMap"),i.shadowMap.bind(this.program),i.shadowMap.bindView(this.program,i.camera.center),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",i.inverseViewMatrix),this.program.setUniform4fv("projInfo",i.projInfo),this.program.setUniform2fv("zScale",i.zScale)}else if(this.configuration.pass===aa.Visualize){const i=t;if(this.program.bindTexture(i.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",i.sampleScale),this.program.setUniform1f("opacityFromElevation",i.opacityFromElevation),this.program.setUniform4fv("uColor",i.color),this.configuration.visualization===Dg.Gradient&&this.configuration.bandsEnabled){const r=t;this.program.setUniform1f("bandSize",r.bandSize)}else if(this.configuration.visualization===Dg.Threshold){const r=t;this.program.setUniform1f("threshold",r.threshold)}}}get primitiveType(){return mi.TRIANGLE_STRIP}}x4.shader=new Ur(N1t,()=>import("./ShadowCast.glsl.2240121e.js"));class YM extends Rs{constructor(){super(...arguments),this.pass=aa.Accumulate,this.visualization=Dg.Gradient,this.bandsEnabled=!1}}_([Oe({count:aa.COUNT})],YM.prototype,"pass",void 0),_([Oe()],YM.prototype,"visualization",void 0),_([Oe()],YM.prototype,"bandsEnabled",void 0);const F1t=_r(.01,0,.25,1),k1t=4e4,U1t=5e4,TTe=1/512;let M$=class extends st{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._visualizationParams={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:F1t,threshold:.5,bandSize:.1,opacityFromElevation:1},this._techniqueConfig=new YM,this._enabled=!1,this._vao=Ga(t),this._techniqueConfig.pass=aa.Visualize,this._techniqueConfig.visualization=Dg.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Xt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(x4,this._techniqueConfig,this._technique),this._technique}render(){if(!this._isRenderingVisualization)return;this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao);const e=this.visualizeShadowCastTechnique;this._rctx.useTechnique(e),e.bindPass(this._visualizationParams),this._rctx.drawArrays(e.primitiveType,0,zo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._visualizationParams.opacityFromElevation}set opacityFromElevation(e){this._visualizationParams.opacityFromElevation!==e&&(this._visualizationParams.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>TTe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _sampleScale(){return this._visualizationParams.sampleScale}set _sampleScale(e){this._visualizationParams.sampleScale=e}get _threshold(){return this._visualizationParams.threshold}set _threshold(e){this._threshold!==e&&(this._visualizationParams.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._visualizationParams.bandSize}set _bandSize(e){e!==this._bandSize&&(this._visualizationParams.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._visualizationParams.color;F2(e,t)||(Yl(this._visualizationParams.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};_([S()],M$.prototype,"opacityFromElevation",null),M$=_([re("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],M$);class z1t{constructor(){this.camera=new br,this.lightMat=lt()}}class STe{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this.textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(let s=0;s<4;++s)this.cascades.push(new z1t);this.snapshotCount=r}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=Ot(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)qU[t]=this.cascades[t];return qU.length=this.numCascades,qU}start(t,i,r){Kt(this.enabled),this.textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const a=t.viewMatrix,l=t.projectionMatrix;for(let p=0;p<this.numCascades;++p)this._constructCascade(p,l,a,i);this.lastOrigin=null,this.clear()}finish(t){Kt(this.enabled),this.rctx.bindFramebuffer(t)}bind(t){this.enabled?(this._depthTextureUnit=t.bindTexture(this._depthTexture,"shadowMapTex"),t.setUniform1f("depthHalfPixelSz",.5/this.textureSize),t.setUniform1i("numCascades",this.numCascades),t.setUniform4f("cascadeDistances",this.cascadeDistances[0],this.numCascades>1?this.cascadeDistances[1]:1/0,this.numCascades>2?this.cascadeDistances[2]:1/0,this.numCascades>3?this.cascadeDistances[3]:1/0)):t.setUniform1f("depthHalfPixelSz",-1)}bindView(t,i){if(!this.enabled)return;const r=this.lastOrigin;if(!(r&&r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2])){this.lastOrigin=this.lastOrigin||Q(),ke(this.lastOrigin,i);for(let s=0;s<this.numCascades;++s){yl(Cce,this.cascades[s].lightMat,i);for(let n=0;n<16;++n)Mce[16*s+n]=Cce[n]}}t.setUniformMatrix4fv("shadowMapMatrix",Mce)}takeCascadeSnapshotTo(t,i){Kt(this.enabled),this._ensureSnapshot(i),this._bindFbo();const r=this.rctx,s=r.bindTexture(this._snapshots[i],Vt.TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(Yt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),r.bindTexture(s,Vt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(this._depthTexture!=null&&this._depthTexture.descriptor.width===this.textureSize)return;this._discardDepthTexture();const t={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize};this._depthTexture=new Vt(this.rctx,t),this.fbo=new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.DEPTH_RENDER_BUFFER,width:this.textureSize,height:this.textureSize},this._depthTexture)}_ensureSnapshot(t){const i=this._snapshots[t];if(L(i)&&i.descriptor.width===this.textureSize)return;this._discardSnapshot(t);const r={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize};this._snapshots[t]=new Vt(this.rctx,r)}_discardDepthTexture(){this.fbo=Xt(this.fbo),this._depthTexture=Xt(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Xt(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;L(this._depthTextureUnit)&&(t.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null),t.bindFramebuffer(this.fbo)}_constructCascade(t,i,r,s){const n=this.cascades[t],a=-this.cascadeDistances[t],l=-this.cascadeDistances[t+1],p=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]),y=(i[10]*l+i[14])/Math.abs(i[11]*l+i[15]);Kt(p<y);for(let x=0;x<8;++x){fl(wce,x%4==0||x%4==3?-1:1,x%4==0||x%4==1?-1:1,x<4?p:y,1),ld(Cc[x],wce,bce);for(let A=0;A<3;++A)Cc[x][A]/=Cc[x][3]}Na(HU,Cc[0]),yl(vce,Ace,HU),n.camera.viewMatrix=vce;for(let x=0;x<8;++x)Ct(Cc[x],Cc[x],n.camera.viewMatrix);ke(pf,Cc[0]),ke(ff,Cc[0]);for(let x=1;x<8;++x)for(let A=0;A<3;++A)pf[A]=Math.min(pf[A],Cc[x][A]),ff[A]=Math.max(ff[A],Cc[x][A]);pf[2]-=200,ff[2]+=200,n.camera.near=-ff[2],n.camera.far=-pf[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),As(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const b=this.textureSize/2;n.camera.viewport[0]=t%2==0?0:b,n.camera.viewport[1]=Math.floor(t/2)===0?0:b,n.camera.viewport[2]=b,n.camera.viewport[3]=b}_constructOrthogonalProjection(t){gX(t.camera.projectionMatrix,pf[0],ff[0],pf[1],ff[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/Cc[0][3],n=1/Cc[4][3];Kt(s<n);let a=s+Math.sqrt(s*n);const l=Math.sin(Xn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));a/=l,V1t(Cc,a,l,xce,Tce,B1t,Sce,Ece),G1t(xce,Tce,Sce,Ece,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(pf[2]-ff[2]),r.camera.projectionMatrix[14]=-(pf[2]+ff[2])/(pf[2]-ff[2])}_setupMatrices(t,i){As(_ce,t.projectionMatrix,t.viewMatrix),Ms(bce,_ce);const r=this.viewingMode===vt.Global?t.eye:ze(HU,0,0,1);eN(Ace,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(RJe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,a=i;for(let l=0;l<this.numCascades+1;++l)this.cascadeDistances[l]=Vi(n,a,this.splitSchemeLambda),n*=s,a+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+uv(s),(t=(i=this.fbo)==null?void 0:i.gpuMemoryUsage)!=null?t:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,depthTexture:this._depthTexture,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const vce=lt(),_ce=lt(),bce=lt(),wce=nr(),Cc=[];for(let e=0;e<8;++e)Cc.push(nr());const pf=Q(),ff=Q(),xce=St(),Tce=St(),B1t=St(),Sce=St(),Ece=St(),Ace=lt(),HU=Q(),qU=[],Cce=lt(),Mce=new Float32Array(64),gh=St(),Ix=St(),F_=[St(),St(),St(),St()],eo=St(),WU=St(),$1=St(),BA=St(),$x=St(),Dx=St(),_I=St();function V1t(e,t,i,r,s,n,a,l){ds(gh,0,0);for(let q=0;q<4;++q)kh(gh,gh,e[q]);Wl(gh,gh,.25),ds(Ix,0,0);for(let q=4;q<8;++q)kh(Ix,Ix,e[q]);Wl(Ix,Ix,.25),$y(F_[0],e[4],e[5],.5),$y(F_[1],e[5],e[6],.5),$y(F_[2],e[6],e[7],.5),$y(F_[3],e[7],e[4],.5);let p=0,y=v0(F_[0],gh);for(let q=1;q<4;++q){const X=v0(F_[q],gh);X<y&&(y=X,p=q)}Fs(eo,F_[p],e[p+4]);const b=eo[0];let x,A;eo[0]=-eo[1],eo[1]=b,Fs(WU,Ix,gh),bs(WU,eo)<0&&XY(eo,eo),$y(eo,eo,WU,i),OR(eo,eo),x=A=bs(Fs($1,e[0],gh),eo);for(let q=1;q<8;++q){const X=bs(Fs($1,e[q],gh),eo);X<x?x=X:X>A&&(A=X)}Pn(r,gh),Wl($1,eo,x-t),kh(r,r,$1);let M=-1,P=1,$=0,k=0;for(let q=0;q<8;++q){Fs(BA,e[q],r),OR(BA,BA);const X=eo[0]*BA[1]-eo[1]*BA[0];X>0?X>M&&(M=X,$=q):X<P&&(P=X,k=q)}Kw(M>0,"leftArea"),Kw(P<0,"rightArea"),Wl($x,eo,x),kh($x,$x,gh),Wl(Dx,eo,A),kh(Dx,Dx,gh),_I[0]=-eo[1],_I[1]=eo[0];const z=k5(r,e[k],Dx,kh($1,Dx,_I),1,s),G=k5(r,e[$],Dx,$1,1,n),B=k5(r,e[$],$x,kh($1,$x,_I),1,a),W=k5(r,e[k],$x,$1,1,l);Kw(z,"rayRay"),Kw(G,"rayRay"),Kw(B,"rayRay"),Kw(W,"rayRay")}function qi(e,t){return 3*t+e}const Rce=St();function yc(e,t){return ds(Rce,e[t],e[t+3]),Rce}const Ml=St(),Ut=zs();function G1t(e,t,i,r,s){Fs(Ml,i,r),Wl(Ml,Ml,.5),Ut[0]=Ml[0],Ut[1]=Ml[1],Ut[2]=0,Ut[3]=Ml[1],Ut[4]=-Ml[0],Ut[5]=0,Ut[6]=Ml[0]*Ml[0]+Ml[1]*Ml[1],Ut[7]=Ml[0]*Ml[1]-Ml[1]*Ml[0],Ut[8]=1,Ut[qi(0,2)]=-bs(yc(Ut,0),e),Ut[qi(1,2)]=-bs(yc(Ut,1),e);let n=bs(yc(Ut,0),i)+Ut[qi(0,2)],a=bs(yc(Ut,1),i)+Ut[qi(1,2)],l=bs(yc(Ut,0),r)+Ut[qi(0,2)],p=bs(yc(Ut,1),r)+Ut[qi(1,2)];n=-(n+l)/(a+p),Ut[qi(0,0)]+=Ut[qi(1,0)]*n,Ut[qi(0,1)]+=Ut[qi(1,1)]*n,Ut[qi(0,2)]+=Ut[qi(1,2)]*n,n=1/(bs(yc(Ut,0),i)+Ut[qi(0,2)]),a=1/(bs(yc(Ut,1),i)+Ut[qi(1,2)]),Ut[qi(0,0)]*=n,Ut[qi(0,1)]*=n,Ut[qi(0,2)]*=n,Ut[qi(1,0)]*=a,Ut[qi(1,1)]*=a,Ut[qi(1,2)]*=a,Ut[qi(2,0)]=Ut[qi(1,0)],Ut[qi(2,1)]=Ut[qi(1,1)],Ut[qi(2,2)]=Ut[qi(1,2)],Ut[qi(1,2)]+=1,n=bs(yc(Ut,1),t)+Ut[qi(1,2)],a=bs(yc(Ut,2),t)+Ut[qi(2,2)],l=bs(yc(Ut,1),i)+Ut[qi(1,2)],p=bs(yc(Ut,2),i)+Ut[qi(2,2)],n=-.5*(n/a+l/p),Ut[qi(1,0)]+=Ut[qi(2,0)]*n,Ut[qi(1,1)]+=Ut[qi(2,1)]*n,Ut[qi(1,2)]+=Ut[qi(2,2)]*n,n=bs(yc(Ut,1),t)+Ut[qi(1,2)],a=bs(yc(Ut,2),t)+Ut[qi(2,2)],l=-a/n,Ut[qi(1,0)]*=l,Ut[qi(1,1)]*=l,Ut[qi(1,2)]*=l,s[0]=Ut[0],s[1]=Ut[1],s[2]=0,s[3]=Ut[2],s[4]=Ut[3],s[5]=Ut[4],s[6]=0,s[7]=Ut[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ut[6],s[13]=Ut[7],s[14]=0,s[15]=Ut[8]}var rM;let Aa=rM=class extends st{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._cachedCamera=new br,this._contentCamera=new br,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=KH,this._previewing=!1,this._handles=new Ei,this._cameraForcedForScreenshot=!1,this._shadowMap=new STe(e,i.viewingMode),this._shadowMap.enabled=!0,this._vao=Ga(e);const a={colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE,width:0,height:0},l={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Hr(e,a,l),this._accumulationParams={camera:this._cachedCamera,linearDepthTexture:null,shadowMap:this._shadowMap,inverseViewMatrix:lt(),projInfo:nr(),zScale:St()},this._accumulationRenderer=new M$(t,e,this,n);const p=this._stage.resourceController.scheduler;this._handles.add(p.registerTask(ii.SHADOW_ACCUMULATOR,this)),this._handles.add(vi(()=>i.renderView,y=>{this._handles.remove(rM.renderViewHandleKey),J(y)||this._handles.add(y.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),rM.renderViewHandleKey)},Oa))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(J(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode},t=new YM;t.pass=aa.Accumulate,this._accumulationTechnique=new x4(e,t)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get _canAccumulate(){return this._accumulationParams.linearDepthTexture!==null&&this._depthRange!==KH&&this._opacityFromElevation>TTe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if($2(t,e,WT))return;const i=e.length;t.length=i,this._sampleCount=Math.min(W8,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||Q();ke(n,s),t[r]=n}this._invalidate()}get _projInfo(){return this._accumulationParams.projInfo}get _zScale(){return this._accumulationParams.zScale}get _inverseView(){return this._accumulationParams.inverseViewMatrix}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this._canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._cachedCamera,this._contentCamera);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}accumulateFixedSamples(){if(!this.isAccumulating||!this._canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const e=this._cameraForcedForScreenshot?this._sampleCount:Math.min(rM.previewSamples,this._sampleCount-this._progress);for(let t=0;t<e;++t)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(){this._accumulationRenderer.render()}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Xt(this._accumulationRenderer),this._shadowMap=Xt(this._shadowMap),this._fbo=Xt(this._fbo),this._vao=Xt(this._vao),this._accumulationTechnique=es(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.previewing!==void 0&&this.setPreviewing(e.previewing),e.lightDirections!==void 0&&this.setLightDirections(e.lightDirections),this._accumulationRenderer.setOptions(e)}setPreviewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}setLightDirections(e){this._lightDirections=e}setAccumulationDependencies(e,t,i,r){this._accumulationParams.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._contentCamera=r,this.notifyChange("_canAccumulate")}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=j1t;return this._fbo.readPixels(e,t,1,1,_t.RGBA,ai.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Sr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress],t=this._cachedCamera;this._renderToShadowMap(this._shadowMap,e,t,this._depthRange),this._rctx.bindFramebuffer(this._fbo);const i=this.accumulationTechnique;this._rctx.useTechnique(i),i.bindPass(this._accumulationParams),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,zo(this._vao,"geometry")),this._progress++}_updateCamera(e){if(e.equals(this._cachedCamera))return;const{fullWidth:t,fullHeight:i,projectionMatrix:r,viewMatrix:s,center:n}=e;this._cachedCamera.copyFrom(e),this._fbo.resize(t,i),fJ(r,t,i,this._projInfo,this._zScale),yl(this._inverseView,s,n),Ms(this._inverseView,this._inverseView),this._opacityFromElevation=1-JT(k1t,U1t,e.relativeElevation)}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}};Aa.previewSamples=6,Aa.renderViewHandleKey="renderView",_([S()],Aa.prototype,"_progress",void 0),_([S()],Aa.prototype,"_sampleCount",void 0),_([S()],Aa.prototype,"_enabled",void 0),_([S()],Aa.prototype,"_depthRange",void 0),_([S()],Aa.prototype,"_previewing",void 0),_([S()],Aa.prototype,"_accumulationRenderer",void 0),_([S()],Aa.prototype,"_isRefining",null),_([S()],Aa.prototype,"_isActive",null),_([S()],Aa.prototype,"_canAccumulate",null),_([S()],Aa.prototype,"_isDoneAccumulating",null),_([S()],Aa.prototype,"_opacityFromElevation",null),_([S()],Aa.prototype,"running",null),Aa=rM=_([re("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Aa);const j1t=new Uint8Array(4);function H1t(e){const t=new Ir;return t.include($g),t.fragment.include(qp),t.fragment.include(Yn),t.include(iK),t.include(Xv),t.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("uColor","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor","float").add("inverseViewMatrix","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2"),t.fragment.constants.add("unoccludedHighlightFlag","vec4",K2e).add("highlightedThreshold","float",e.highlightedThreshold).add("selfShadowThreshold","float",e.selfShadowThreshold),t.fragment.code.add(V`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.fragment.code.add(V`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),t}const q1t=Object.freeze({__proto__:null,build:H1t}),ETe=0,ATe=1;class X8 extends Xr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=X8.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new $r(t.rctx,i,mr)}initializePipeline(t){return Ti({blending:ga(ht.SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE_MINUS_SRC_ALPHA),colorWrite:Ii,depthTest:null,depthWrite:null})}bindPass(t,i){if(J(i.linearDepthTexture))return;this.program.bindTexture(i.linearDepthTexture,"depthMap"),this.program.bindTexture(i.highlightColorTexture,"highlightMap"),Ct(bI,i.lighting.lightingMainDirection,i.camera.viewInverseTransposeMatrix),ot(bI,bI),fJ(i.camera.projectionMatrix,i.camera.fullWidth,i.camera.fullHeight,Pce,Oce),yl(wI,i.camera.viewMatrix,i.camera.center),Ms(wI,wI),this.program.setUniform4fv("uColor",t.shadowColor),this.program.setUniform1f("opacity",t.shadowOpacity),this.program.setUniform1f("occludedOpacity",t.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",t.opacityElevation*t.dayNightTerminator),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",wI),this.program.setUniform4fv("projInfo",Pce),this.program.setUniform2fv("zScale",Oce),this.program.setUniform3fv("lightingMainDirectionView",bI),this.program.setUniform2f("texelSize",1/i.linearDepthTexture.descriptor.width,1/i.linearDepthTexture.descriptor.height),i.shadowMap.bind(this.program),i.shadowMap.bindView(this.program,i.camera.center);let r=i.shadowMap.getSnapshot(ETe);L(r)&&this.program.bindTexture(r,"highlightDepthTex"),r=i.shadowMap.getSnapshot(ATe),L(r)&&this.program.bindTexture(r,"defaultDepthTex")}get primitiveType(){return mi.TRIANGLE_STRIP}}X8.shader=new Ur(q1t,()=>import("./ShadowHighlight.glsl.114d70ba.js"));const bI=Q(),Oce=St(),Pce=nr(),wI=lt(),W1t=.001953125,X1t=4e4,Y1t=5e4;class J1t{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._parameters={shadowColor:sc(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1},this._vao=Ga(this._rctx)}get technique(){return J(this._technique)&&(this._technique=new X8({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._rctx.bindFramebuffer(i),this._rctx.useTechnique(r),r.bindPass(this._parameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,zo(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(t=(i=this._vao)==null?void 0:i.size)!=null?t:0}setDefaultOptions(t){this._parameters=ie(ie({},this._parameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._parameters.opacityElevation=1-JT(X1t,Y1t,t.relativeElevation);const r=this._viewingMode===vt.Global?ot(Ice,t.center):ze(Ice,0,0,1),s=rt(r,i);this._parameters.dayNightTerminator=JT(0,1,Ot(30*s,0,1))}dispose(){this._vao=Xt(this._vao),this._technique=es(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._parameters;return this._maxOpacity*t*i>=W1t}_updateMaxOpacity(){const t=this._parameters,i=t.shadowColor,r=Math.max(t.shadowOpacity,t.occludedShadowOpacity);this._maxOpacity=r*i[3]}}const Ice=Q(),XU=Pw();class Z1t{constructor(){this._worldPlane=XU}get isEnabled(){return this.plane!==XU}get plane(){return this._worldPlane}set plane(t){this._worldPlane=t||XU}}var Pp;function K1t(e){const t=new Ir;return e.output===Pp.EdgeDetector&&(t.attributes.add(Y.POSITION,"vec2"),t.vertex.uniforms.add("resolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(V`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.code.add(V`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${V.float(e.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${V.float(e.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Pp.BlendWeight&&(t.attributes.add(Y.POSITION,"vec2"),t.vertex.uniforms.add("resolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(V`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${V.int(e.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("resolution","vec4"),t.fragment.code.add(V`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * resolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${V.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${V.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${V.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${V.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${V.int(e.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Pp.Blur&&(t.attributes.add(Y.POSITION,"vec2"),t.vertex.uniforms.add("resolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(V`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add("tBlendWeights","sampler2D"),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.uniforms.add("resolution","vec4"),t.fragment.code.add(V`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Pp||(Pp={}));const Q1t=Object.freeze({__proto__:null,get SMAAOutput(){return Pp},build:K1t});class Y8 extends Xr{initializeProgram(t){const i=Y8.shader.get(),r=this.configuration,s=i.build({output:r.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new $r(t.rctx,s,mr)}initializePipeline(){return Ti({colorWrite:Ii})}}Y8.shader=new Ur(Q1t,()=>import("./SMAA.glsl.c16c07be.js"));class CTe extends Rs{constructor(){super(...arguments),this.output=Pp.EdgeDetector}}_([Oe({count:Pp.COUNT})],CTe.prototype,"output",void 0);let sM=class extends st{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Ql(this._abortController),this.disable()}_loadResources(e){if(L(this._abortController))return!1;if(L(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.69c5bfba.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Gi(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Pt.LINEAR,_t.RGB),this._loadTextureFromBase64(e.searchTexure,Pt.NEAREST,_t.LUMINANCE)]).then(([i,r])=>{zn(t)?(i.dispose(),r.dispose(),Gi(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return L(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new CTe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(Y8,r,s);t.output=Pp.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=Pp.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=Pp.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=lYe(this.rctx),this._edges=new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,pixelFormat:_t.RGB,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Hr(this.rctx,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Xt(this._vao),this._areaTexture=Xt(this._areaTexture),this._searchTexture=Xt(this._searchTexture),this._blend=Xt(this._blend),this._edges=Xt(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(Sr.COLOR_BUFFER_BIT);const s=t.useTechnique(this._edgeDetectTechnique);s.bindTexture(e,"tColor"),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(mi.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(Sr.COLOR_BUFFER_BIT);const n=t.useTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture(this._searchTexture,"tSearch"),n.bindTexture(this._areaTexture,"tArea"),n.bindTexture(this._edges.colorTexture,"tEdges"),t.drawArrays(mi.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(Sr.COLOR_BUFFER_BIT);const a=t.useTechnique(this._blurTechnique);a.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),a.bindTexture(e,"tColor"),a.bindTexture(this._blend.colorTexture,"tBlendWeights"),t.drawArrays(mi.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){const r=new Vt(this.rctx,{pixelFormat:i,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:t},null);return yd(e).then(s=>(r.resize(s.width,s.height),r.setData(s),r))}};_([S()],sM.prototype,"_abortController",void 0),_([S({readOnly:!0})],sM.prototype,"updating",null),sM=_([re("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],sM);var Lg;function eyt(e){const t=new Ir;return t.include(Xv),e.output===Lg.Blur&&(t.fragment.include(Yn),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("projScale","float").add("nearFar","vec2"),t.fragment.code.add(V`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${V.float(e.blurFalloff)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),t.fragment.code.add(V`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${V.int(e.filterRadius)}; r <= ${V.int(e.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)),e.output===Lg.SSAO&&(t.fragment.include(Yn),t.include(iK),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),t.fragment.code.add(V`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),t.fragment.code.add(V`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.code.add(V`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${V.int(e.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${V.int(e.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(Lg||(Lg={}));const tyt=Object.freeze({__proto__:null,get SSAOOutput(){return Lg},build:eyt});class Kf extends Xr{initializeProgram(t){const i=Kf.shader.get(),r=this.configuration,s=(Kf.filterRadius+1)/2,n=1/(2*s*s),a=i.build({output:r.output,samples:Kf.samples,filterRadius:Kf.filterRadius,blurFalloff:n});return new $r(t.rctx,a,mr)}initializePipeline(){return Ti({colorWrite:Ii})}}Kf.shader=new Ur(tyt,()=>import("./SSAO.glsl.d38cf097.js")),Kf.samples=16,Kf.filterRadius=4;class MTe extends Rs{constructor(){super(...arguments),this.output=Lg.SSAO}}_([Oe({count:Lg.COUNT})],MTe.prototype,"output",void 0);class iyt{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new MTe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Xt(this.quadVAO)}disposeOffscreenBuffers(){Da(this._ssaoFBO,t=>t.resize(0,0)),Da(this._blur0FBO,t=>t.resize(0,0)),Da(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&L(this._noiseTexture)&&L(this._ssaoFBO)&&L(this._blur0FBO)&&L(this._blur1FBO)}computeSSAO(t,i,r){if(!this.enabled||J(i)||J(r)||J(this._noiseTexture)||J(this._ssaoFBO)||J(this._blur0FBO)||J(this._blur1FBO))return;const s=this._rctx,n=t.fullViewport,a=n[2],l=n[3],p=a/this._blurSizePx,y=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(p,y),this._blur1FBO.resize(p,y);const b=1,x=1,A=a*b,M=l*x;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const P=s.useTechnique(this._ssaoTechnique);P.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height),fJ(t.projectionMatrix,t.fullWidth,t.fullHeight,Dce,$ce),P.setUniform4fv("projInfo",Dce),P.setUniform2fv("zScale",$ce),P.setUniform2fv("nearFar",t.nearFar);let $=1/t.computeRenderPixelSizeAtDist(1);P.setUniform1f("projScale",$*b),P.setUniform2f("screenDimensions",A,M);const k=Er(t.eye,t.center);let z=20*t.computeRenderPixelSizeAtDist(k);z=Math.max(.1,z),P.setUniform1f("radius",z),P.setUniform1f("intensity",4*this._attenuation/z**6),P.bindTexture(this._noiseTexture,"rnm"),P.bindTexture(r,"normalMap"),P.bindTexture(i,"depthMap"),J(this.quadVAO)&&(this.quadVAO=Ga(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(mi.TRIANGLE_STRIP,0,zo(this.quadVAO,"geometry"));const G=s.useTechnique(this._blurTechnique);G.bindTexture(this._ssaoFBO.colorTexture,"tex"),G.bindTexture(r,"normalMap"),G.bindTexture(i,"depthMap"),s.setViewport(0,0,A/this._blurSizePx,M/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),G.setUniform2f("screenDimensions",A,M),G.setUniform2f("blurSize",0,this._blurSizePx*b/M),G.setUniform2fv("nearFar",t.nearFar),k>5e4&&($=Math.max(0,$-(k-5e4))),G.setUniform1f("projScale",$),s.drawArrays(mi.TRIANGLE_STRIP,0,zo(this.quadVAO,"geometry")),G.setUniform2f("blurSize",this._blurSizePx*x/A,0),s.bindFramebuffer(this._blur1FBO),G.bindTexture(this._blur0FBO.colorTexture,"tex"),s.drawArrays(mi.TRIANGLE_STRIP,0,zo(this.quadVAO,"geometry")),s.setViewport(n[0],n[1],n[2],n[3])}bind(t,i){this.enabled&&L(this._blur1FBO)&&L(this._ssaoFBO)?(t.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),t.setUniform4f("viewportPixelSz",i.fullViewport[0],i.fullViewport[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):t.setUniform4f("viewportPixelSz",-1,-1,-1,-1)}_selectPrograms(){this._ssaoTechniqueConfig.output=Lg.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(Kf,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=Lg.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(Kf,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.256ae0c1.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.LINEAR,wrapMode:ei.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE};yd(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new Hr(this._rctx,i,t),this._blur0FBO=new Hr(this._rctx,i,t),this._blur1FBO=new Hr(this._rctx,i,t),this._noiseTexture=new Vt(this._rctx,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Xt(this._noiseTexture),this._blur1FBO=Xt(this._blur1FBO),this._blur0FBO=Xt(this._blur0FBO),this._ssaoFBO=Xt(this._ssaoFBO)}get gpuMemoryUsage(){return(L(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(L(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(L(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const $ce=St(),Dce=nr();function ryt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],a=i[3],l=i[7],p=i[11],y=i[15];i[0]+=a*r,i[1]+=a*s,i[2]+=a*n,i[4]+=l*r,i[5]+=l*s,i[6]+=l*n,i[8]+=p*r,i[9]+=p*s,i[10]+=p*n,i[12]+=y*r,i[13]+=y*s,i[14]+=y*n}function syt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class nyt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:lt(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{nn(i.viewMatrix,t),syt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}const sL=on().vec3f(Y.POSITION).u16(Y.COMPONENTINDEX).u16(Y.U16PADDING),RTe=on().vec2u8(Y.SIDENESS),Lce=ch(RTe),OTe=on().vec3f(Y.POSITION0).vec3f(Y.POSITION1).u16(Y.COMPONENTINDEX).u8(Y.VARIANTOFFSET,{glNormalized:!0}).u8(Y.VARIANTSTROKE).u8(Y.VARIANTEXTENSION,{glNormalized:!0}).u8(Y.U8PADDING,{glPadding:!0}).u16(Y.U16PADDING,{glPadding:!0}),rq=OTe.clone().vec3f(Y.NORMAL),sq=OTe.clone().vec3f(Y.NORMALA).vec3f(Y.NORMALB),nq=new Map([[Y.POSITION0,0],[Y.POSITION1,1],[Y.COMPONENTINDEX,2],[Y.VARIANTOFFSET,3],[Y.VARIANTSTROKE,4],[Y.VARIANTEXTENSION,5],[Y.NORMAL,6],[Y.NORMALA,6],[Y.NORMALB,7],[Y.SIDENESS,8]]);class PTe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?ayt:oyt}write(t,i,r){const s=this.edgeHashFunction(r);TI.seed=s;const n=TI.getIntRange(0,255),a=TI.getIntRange(0,this.settings.variants-1),l=.7,p=TI.getFloat(),y=255*(.5*lyt(-(1-Math.min(p/l,1))+Math.max(0,p-l)/(1-l),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,a),t.variantExtension.set(i,y)}trim(t,i){return t.slice(0,i)}}const rK=new Float32Array(6),nL=new Uint32Array(rK.buffer),nv=new Uint32Array(1);function oyt(e){const t=rK;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],nv[0]=5381;for(let i=0;i<nL.length;i++)nv[0]=31*nv[0]+nL[i];return nv[0]}function ayt(e){const t=rK;t[0]=Lx(e.position0[0]),t[1]=Lx(e.position0[1]),t[2]=Lx(e.position0[2]),t[3]=Lx(e.position1[0]),t[4]=Lx(e.position1[1]),t[5]=Lx(e.position1[2]),nv[0]=5381;for(let i=0;i<nL.length;i++)nv[0]=31*nv[0]+nL[i];return nv[0]}const Nce=1e4;function Lx(e){return Math.round(e*Nce)/Nce}function lyt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class oL{constructor(){this.commonWriter=new PTe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return rq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),Xe(xI,r.faceNormal0,r.faceNormal1),ot(xI,xI),t.normal.setVec(i,xI)}trim(t,i){return this.commonWriter.trim(t,i)}}oL.Layout=rq,oL.glLayout=ch(rq,1);class aL{constructor(){this.commonWriter=new PTe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return sq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}aL.Layout=sq,aL.glLayout=ch(sq,1);const xI=Q(),TI=new Wu,Ob=-1;var lL;function cyt(e,t,i,r=myt){const s=e.vertices.position,n=e.vertices.componentIndex,a=xi(r.anglePlanar),l=xi(r.angleSignificantEdge),p=Math.cos(l),y=Math.cos(a),b=oq.edge,x=b.position0,A=b.position1,M=b.faceNormal0,P=b.faceNormal1,$=fyt(e),k=pyt(e),z=k.length/4,G=t.allocate(z);let B=0;const W=z,q=i.allocate(W);let X=0,oe=0,de=0;const he=eMe(0,z),fe=new Float32Array(z);sMe(fe,(Pe,De,ne)=>{s.getVec(k[4*De+0],x),s.getVec(k[4*De+1],A),ne[De]=Er(x,A)}),he.sort((Pe,De)=>fe[De]-fe[Pe]);const me=new Array,ge=new Array;for(let Pe=0;Pe<z;Pe++){const De=he[Pe],ne=fe[De],pe=k[4*De+0],ye=k[4*De+1],we=k[4*De+2],Ee=k[4*De+3],Ie=Ee===Ob;if(s.getVec(pe,x),s.getVec(ye,A),Ie)ze(M,$[3*we+0],$[3*we+1],$[3*we+2]),ke(P,M),b.componentIndex=n.get(pe),b.cosAngle=rt(M,P);else{if(ze(M,$[3*we+0],$[3*we+1],$[3*we+2]),ze(P,$[3*Ee+0],$[3*Ee+1],$[3*Ee+2]),b.componentIndex=n.get(pe),b.cosAngle=rt(M,P),uyt(b,y))continue;b.cosAngle<-.9999&&ke(P,M)}oe+=ne,de++,Ie||hyt(b,p)?(t.write(G,B++,b),me.push(ne)):dyt(b,a)&&(i.write(q,X++,b),ge.push(ne))}const Ce=new Float32Array(me.reverse()),Ae=new Float32Array(ge.reverse());return{regular:{instancesData:t.trim(G,B),lodInfo:{lengths:Ce}},silhouette:{instancesData:i.trim(q,X),lodInfo:{lengths:Ae}},averageEdgeLength:oe/de}}function hyt(e,t){return e.cosAngle<t}function uyt(e,t){return e.cosAngle>t}function dyt(e,t){const i=Xn(e.cosAngle),r=oq.fwd,s=oq.ortho;return kg(r,e.position1,e.position0),i*(rt(si(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function pyt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let l=0;l<t;l++){const p=r[3*l+0],y=r[3*l+1],b=r[3*l+2],x=i[3*l+0],A=i[3*l+1],M=i[3*l+2];s+=p===Ob||x<A?1:0,s+=y===Ob||A<M?1:0,s+=b===Ob||M<x?1:0}const n=new Int32Array(4*s);let a=0;for(let l=0;l<t;l++){const p=r[3*l+0],y=r[3*l+1],b=r[3*l+2],x=i[3*l+0],A=i[3*l+1],M=i[3*l+2];(p===Ob||x<A)&&(n[a++]=x,n[a++]=A,n[a++]=l,n[a++]=p),(y===Ob||A<M)&&(n[a++]=A,n[a++]=M,n[a++]=l,n[a++]=y),(b===Ob||M<x)&&(n[a++]=M,n[a++]=x,n[a++]=l,n[a++]=b)}return n}function fyt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=YU.v0,n=YU.v1,a=YU.v2,l=new Float32Array(3*t);for(let p=0;p<t;p++){const y=r[3*p+0],b=r[3*p+1],x=r[3*p+2];i.getVec(y,s),i.getVec(b,n),i.getVec(x,a),We(n,n,s),We(a,a,s),si(s,n,a),ot(s,s),l[3*p+0]=s[0],l[3*p+1]=s[1],l[3*p+2]=s[2]}return l}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(lL||(lL={}));const oq={edge:{position0:Q(),position1:Q(),faceNormal0:Q(),faceNormal1:Q(),componentIndex:0,cosAngle:0},ortho:Q(),fwd:Q()},YU={v0:Q(),v1:Q(),v2:Q()},myt={anglePlanar:4,angleSignificantEdge:35};function gyt(e){const t=V`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}function yyt(e,t){e.vertex.include(gyt),e.include(IT,t);const i=e.vertex;i.uniforms.add("depthBias","vec2"),i.uniforms.add("inverseViewport","vec2"),t.legacy?(i.uniforms.add("view","mat4"),i.uniforms.add("proj","mat4")):i.uniforms.add("transformNormalViewFromGlobal","mat3"),t.legacy?i.code.add(V`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = proj * view * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`):i.code.add(V`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`),i.code.add(V`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function vyt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(V`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(V`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function _yt(e,t){const i=e.vertex;t.silhouette?(i.code.add(V`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(V`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(V`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(V`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function ITe(e,t){const i=e.vertex;i.uniforms.add("distanceFalloffFactor","float"),i.code.add(V`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add("componentDataTex","sampler2D"),i.uniforms.add("componentDataTexInvDim","vec2"),e.attributes.add(Y.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentFieldCount","float",2),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.code.add(V`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`),t.legacy?i.code.add(V`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (view * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add("transformNormalGlobalFromModel","mat3"),i.code.add(V`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(Y.NORMALA,"vec3"),e.attributes.add(Y.NORMALB,"vec3"),i.code.add(V`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(Y.NORMAL,"vec3"),i.code.add(V`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(V`vec3 worldFromModelPosition(vec3 position) {
return (model * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (view * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return proj * vec4(position, 1.0);
}`):(e.vertex.include(bZ,t),i.code.add(V`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return transformViewFromCameraRelativeRS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`)),i.code.add(V`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function $Te(e){return e.mode===Mn.SKETCH||e.mode===Mn.MIXED}var Mn;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Mn||(Mn={}));function byt(e,t){const i=e.vertex;switch(t.mode){case Mn.SKETCH:i.code.add(V`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Mn.MIXED:i.code.add(V`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Mn.SOLID:i.code.add(V`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function sK(e,t){const i=e.vertex;switch(e.include(ITe,t),e.attributes.add(Y.SIDENESS,"vec2"),t.mode===Mn.MIXED?i.code.add(V`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(V`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Mn.MIXED:i.code.add(V`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Mn.SKETCH:i.code.add(V`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Mn.SOLID:i.code.add(V`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Mn.COUNT:break;default:t.mode}}function wyt(e,t){const i=e.vertex;switch(e.include(sK,t),$Te(t)&&i.uniforms.add("strokesAmplitude","float"),t.mode){case Mn.SOLID:i.code.add(V`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Mn.SKETCH:i.code.add(V`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Mn.MIXED:i.code.add(V`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function xyt(e,t){const i=e.vertex;e.include(sK,t);const r=e.fragment;switch($Te(t)&&(i.uniforms.add("strokesTextureScale","vec2"),i.uniforms.add("strokesLog2Resolution","float"),i.uniforms.add("strokeVariants","float"),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add("strokesTexture","sampler2D"),r.uniforms.add("strokesNormalizationScale","float"),i.code.add(V`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(qp),r.code.add(V`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Mn.SOLID:i.code.add(V`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(V`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Mn.SKETCH:i.code.add(V`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(V`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Mn.MIXED:e.varyings.add("vType","float"),i.code.add(V`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(V`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Tyt(e){const t=new Ir,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add("model","mat4"),e.antialiasing&&(i.code.add(V`#define ANTIALIASING 1`),r.code.add(V`#define ANTIALIASING 1`)),t.include(yyt,e),t.include(wyt,e),t.include(ITe,e),t.include(sK,e),t.include(xyt,e),t.include(Ws,e),t.include(_yt,e),t.include(vyt,e),t.include(byt,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add("pixelToNDC","vec2"),i.uniforms.add("ndcToPixel","vec2"),i.uniforms.add("pixelRatio","float"),t.attributes.add(Y.POSITION0,"vec3"),t.attributes.add(Y.POSITION1,"vec3"),t.attributes.add(Y.VARIANTOFFSET,"float"),t.attributes.add(Y.VARIANTSTROKE,"float"),t.attributes.add(Y.VARIANTEXTENSION,"float"),i.code.add(V`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),e.multipassTerrainEnabled&&(t.fragment.include(Yn),t.include(nu,e)),t.fragment.code.add(V`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const Syt=Object.freeze({__proto__:null,build:Tyt}),Eyt=-4e-4,Ayt=.5;class _O extends Xr{bindPass(t){const i=this.program,{edgeRenderParameters:r,bindParameters:s}=t;Mxe(i,r.viewProjectionTransform),i.setUniformMatrix3fv("transformNormalViewFromGlobal",r.transformNormalViewFromGlobal),i.setUniformMatrix4fv("proj",s.camera.projectionMatrix),i.setUniform2f("depthBias",Ayt,Eyt),i.setUniform2f("pixelToNDC",2/s.camera.fullViewport[2],2/s.camera.fullViewport[3]),i.setUniform2f("ndcToPixel",s.camera.fullViewport[2]/2,s.camera.fullViewport[3]/2),i.setUniform1f("distanceFalloffFactor",r.distanceFalloffFactor),i.setUniform2f("inverseViewport",1/s.camera.fullViewport[2],1/s.camera.fullViewport[3]),i.setUniform1f("pixelRatio",s.camera.pixelRatio||1)}initializeProgram(t){const i=_O.shader.get(),r=this.configuration,s=i.build({slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,silhouette:r.silhouette,legacy:r.legacy,antialiasing:r.antialiasing,mode:r.mode,doublePrecisionRequiresObfuscation:r.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new $r(t.rctx,s,nq)}initializePipeline(t){const i=t.rctx.capabilities.blendMinMax;return Ti(i?{blending:ga(ht.ONE,ht.ONE,ht.ZERO,ht.ONE,f0.ADD,i.MAX),depthTest:{func:kr.LEQUAL},colorWrite:Ii}:{depthTest:{func:kr.LEQUAL},depthWrite:ac,colorWrite:Ii})}}_O.shader=new Ur(Syt,()=>import("./EdgeShaderProgram.glsl.fa0587ed.js"));class $m extends Rs{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.mode=Mn.SOLID,this.doublePrecisionRequiresObfuscation=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}_([Oe()],$m.prototype,"slicePlaneEnabled",void 0),_([Oe()],$m.prototype,"silhouette",void 0),_([Oe()],$m.prototype,"legacy",void 0),_([Oe()],$m.prototype,"antialiasing",void 0),_([Oe({count:Mn.COUNT})],$m.prototype,"mode",void 0),_([Oe()],$m.prototype,"doublePrecisionRequiresObfuscation",void 0),_([Oe()],$m.prototype,"multipassTerrainEnabled",void 0),_([Oe()],$m.prototype,"cullAboveGround",void 0);const Cyt=8,JU=128,Myt={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};class Ryt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const Oyt={solid:Mn.SOLID,sketch:Mn.SKETCH,uber:Mn.MIXED};class JM{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this.config=new $m,this.technique=null,this.refCount=new Ryt,this.renderables=new Set,this.sortedRenderables={[wi.TRANSPARENT]:{[wi.TRANSPARENT]:new Ci,[wi.OPAQUE]:new Ci},[wi.OPAQUE]:{[wi.TRANSPARENT]:new Ci,[wi.OPAQUE]:new Ci}},this.renderablesDirty=!1,this.settings=ie(ie({},Myt),r),this.key=JM.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);const s=this.settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ur.TESTS_DISABLE_OPTIMIZATIONS},this.config.legacy=this.settings.legacy,this.config.mode=Oyt[this.settings.type],this.config.silhouette=!1,this.config.antialiasing=!!this.rctx.capabilities.blendMinMax,this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled,this.config.doublePrecisionRequiresObfuscation=y8(t)}dispose(){this.technique=es(this.technique)}addRenderable(t){this.renderables.add(t),this.renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this.renderablesDirty=!0}setRenderablesDirty(){this.renderablesDirty=!0}forEachRenderable(t,i){this.renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][wi.TRANSPARENT].forAll(t),this.sortedRenderables[i][wi.OPAQUE].forAll(t)}setMultipassParameters(t){this.config.multipassTerrainEnabled=!!t.multipassTerrainEnabled&&t.multipassTerrainEnabled,this.config.cullAboveGround=!!t.cullAboveGround&&t.cullAboveGround}bindRegularEdges(t,i){this.setMultipassParameters(t),this.config.silhouette=!1,this.technique=this.shaderTechniqueRepository.releaseAndAcquire(_O,this.config,this.technique),this.rctx.useTechnique(this.technique,t.slot),this.technique.bindPass({bindParameters:t,edgeRenderParameters:i})}bindSilhouetteEdges(t,i){this.setMultipassParameters(t),this.config.silhouette=!0,this.technique=this.shaderTechniqueRepository.releaseAndAcquire(_O,this.config,this.technique),this.rctx.useTechnique(this.technique,t.slot),this.technique.bindPass({bindParameters:t,edgeRenderParameters:i})}renderRegularEdges(t,i,r){this._render(t,t.regular.vao,i,r)}renderSilhouetteEdges(t,i,r){this._render(t,t.silhouette.vao,i,r)}_render(t,i,r,s){this._setUniforms(t,r),this.rctx.bindVAO(i),this.rctx.capabilities.instancing.drawArraysInstanced(mi.TRIANGLE_FAN,0,4,s)}_setUniforms(t,i){const r=this.technique.program;if(t.components.buffer.textureBuffer.bind(r,Pyt,Iyt),i.multipassTerrainEnabled&&(r.setUniform2fv("nearFar",i.camera.nearFar),r.setUniform2fv("inverseViewport",i.inverseViewport),Jg(r,i)),"origin"in t.transform)r.setUniformMatrix4fv("view",i.localViewMatrixForEdges),r.setUniformMatrix4fv("model",t.transform.modelMatrix),Nv(r,this.settings,i.slicePlane,{origin:t.transform.origin.vec3});else{const s=new q8(t.transform.position),n=gd(Fce,iw(Fce,t.transform.rotationScale)),a=new _Te;ke(a.transformWorldFromModelTL,s.low),ke(a.transformWorldFromModelTH,s.high),LR(a.transformWorldFromModelRS,t.transform.rotationScale),LR(a.transformNormalGlobalFromModel,n),Cxe(r,a),r.setUniformMatrix3fv("transformNormalGlobalFromModel",a.transformNormalGlobalFromModel);const l=i.camera.viewInverseTransposeMatrix,p=ze($yt,l[3],l[7],l[11]);Nv(r,this.settings,i.slicePlane,{origin:p})}this.settings.type!=="uber"&&this.settings.type!=="sketch"||this._setSketchUniforms(r)}_setSketchUniforms(t){const i=this.settings.strokesTexture,r=i.texture;J(r)||(t.bindTexture(r,"strokesTexture"),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this.renderablesDirty=!1,this.sortedRenderables[wi.TRANSPARENT][wi.TRANSPARENT].clear(),this.sortedRenderables[wi.TRANSPARENT][wi.OPAQUE].clear(),this.sortedRenderables[wi.OPAQUE][wi.TRANSPARENT].clear(),this.sortedRenderables[wi.OPAQUE][wi.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==wi.INVISIBLE&&i.edgeTransparency!==wi.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[wi.TRANSPARENT][wi.TRANSPARENT].sort(t),this.sortedRenderables[wi.TRANSPARENT][wi.OPAQUE].sort(t),this.sortedRenderables[wi.OPAQUE][wi.TRANSPARENT].sort(t),this.sortedRenderables[wi.OPAQUE][wi.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const Pyt="componentDataTex",Iyt="componentDataTexInvDim",Fce=yg(),$yt=Q();function kce(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:Dyt(e.layout)}}function Uce(e){return Lyt(e.layout).createView(e.buffer)}function Dyt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=qe(ie({},i),{constructor:DTe(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function Lyt(e){const t=on();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],qe(ie({},i[1]),{constructor:Fyt(i[1].constructor)}))),t}const Nyt=[r4,vd,Cr,So,Bp,LS,NS,FS,gn,rw,Mv,Rv,Og,sw,Ov,lc,nw,kS,ow,Pv,aw,US,FR,kR,zS,lw,UR,zR,BR,cw,VR,GR,jR,HR,qR,WR];function DTe(e){return`${e.ElementType}_${e.ElementCount}`}function Fyt(e){return LTe.get(e)}const LTe=new Map;Nyt.forEach(e=>LTe.set(DTe(e),e));function zce(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),a=(z,G)=>{z<G?s[z+1]++:n[G+1]++};for(let z=0;z<r;z++){const G=e[3*z],B=e[3*z+1],W=e[3*z+2];a(G,B),a(B,W),a(W,G)}let l=0,p=0;for(let z=0;z<i;z++){const G=s[z+1],B=n[z+1];s[z+1]=l,n[z+1]=p,l+=G,p+=B}const y=new Uint32Array(6*r),b=s[i],x=(z,G,B)=>{if(z<G){const W=s[z+1]++;y[2*W]=G,y[2*W+1]=B}else{const W=n[G+1]++;y[2*b+2*W]=z,y[2*b+2*W+1]=B}};for(let z=0;z<r;z++){const G=e[3*z],B=e[3*z+1],W=e[3*z+2];x(G,B,z),x(B,W,z),x(W,G,z)}const A=(z,G)=>{const B=2*z,W=G-z;for(let q=1;q<W;q++){const X=y[B+2*q],oe=y[B+2*q+1];let de=q-1;for(;de>=0&&y[B+2*de]>X;de--)y[B+2*de+2]=y[B+2*de],y[B+2*de+3]=y[B+2*de+1];y[B+2*de+2]=X,y[B+2*de+3]=oe}};for(let z=0;z<i;z++)A(s[z],s[z+1]),A(b+n[z],b+n[z+1]);const M=new Int32Array(3*r),P=(z,G)=>z===e[3*G]?0:z===e[3*G+1]?1:z===e[3*G+2]?2:-1,$=(z,G)=>{const B=P(z,G);M[3*G+B]=-1},k=(z,G,B,W)=>{const q=P(z,G);M[3*G+q]=W;const X=P(B,W);M[3*W+X]=G};for(let z=0;z<i;z++){let G=s[z];const B=s[z+1];let W=n[z];const q=n[z+1];for(;G<B&&W<q;){const X=y[2*G],oe=y[2*b+2*W];X===oe?(k(z,y[2*G+1],oe,y[2*b+2*W+1]),G++,W++):X<oe?($(z,y[2*G+1]),G++):($(oe,y[2*b+2*W+1]),W++)}for(;G<B;)$(z,y[2*G+1]),G++;for(;W<q;)$(y[2*b+2*W],y[2*b+2*W+1]),W++}return M}async function kyt(e){const t=Uyt(e),i=nK(t),r=[t.data.buffer];return{result:zyt(i,r),transferList:r}}function nK(e){const t=Byt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Bce.updateSettings(e.writerSettings),Vce.updateSettings(e.writerSettings),cyt(t,Bce,Vce)}function Uyt(e){return{data:sL.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function zyt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:kce(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:kce(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function Byt(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:zce(i,r,e.count),vertices:e};const s=zwe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=zce(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:sL.createView(s.buffer)}}const Bce=new oL,Vce=new aL;var Vyt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",work:nK,wrappedWork:kyt});class Gyt extends U3e{constructor(t){super("EdgeProcessingWorker","wrappedWork",t)}async process(t,i,r){if(r)return nK(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}getTransferList(t){return[t.dataBuffer]}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:G$(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:Uce(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:Uce(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function jyt(e){const i=VA.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,a=VA.amplitude,l=2*a,p=4*i,y=Math.log2(i)+1,b=VA.strokes.length;let x=(y-1)*b*p;for(const{distance:M,pressure:P}of VA.strokes){let $=M,k=P,z=x;for(let G=0;G<y;G++){G!==0&&($=Gce($,bO.DISTANCE),k=Gce(k,bO.PRESSURE));for(let B=0;B<VA.resolution;B++){const W=.5+($?$[B%$.length]/l:0),q=k?k[B%k.length]:1;LD(W,s,z),LD(q,s,z+n),z+=4}z-=p*(b+1)}x+=p}const A=new Vt(e,{pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Pt.LINEAR,width:i,height:i,wrapMode:ei.REPEAT},s);return new qyt(i,l,a,b,A)}function Gce(e,t){if(!e)return null;const i=e.length/2,r=Hyt*i,s=new Array(i);let n=0;const a=t===bO.PRESSURE;for(let l=0;l<e.length;l+=2){const p=(e[l]+e[l+1])/2;s[n++]=a?Math.min(r,1-(1-p)*jce):Math.min(r,p*jce)}return s}var bO;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(bO||(bO={}));const Hyt=.1,jce=.5;class qyt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Xt(this.texture)}}const VA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Hce(e){let t=null;for(const i of e){const r=i.type;if(Wyt(i)){if(J(t))t=r;else if(t!==r)return"uber"}}return L(t)?t:"uber"}function ZU(e){let t=wi.INVISIBLE;for(const{material:i}of e)if(NTe(i)){if(i.color[3]*i.opacity<1)return wi.TRANSPARENT;t=wi.OPAQUE}return t}function KU(e){let t=wi.INVISIBLE;for(const{material:i}of e)if(NTe(i)){switch(i.objectTransparency){case wi.TRANSPARENT:case wi.INVISIBLE:return wi.TRANSPARENT;case wi.OPAQUE:if(i.opacity<1)return wi.TRANSPARENT}t=wi.OPAQUE}return t}function NTe(e){return e.size*e.color[3]*e.opacity>0}function Wyt(e){return e.size*e.color[3]>0}function Xyt(e,t){const i=tMe(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function qce(e,t,i){return e.length-Xyt(e,t*i.minimumEdgeLength)}function Wce(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,a=t[s],l=t[s+1];if(r)for(let p=a;p<l;p++){const y=r[p];i.set(y,n)}else for(let p=a;p<l;p++)i.set(p,n)}}const Yyt=Ge.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let Lf=class extends st{constructor(e){super(e),this.updatingHandles=new t0,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[wi.TRANSPARENT]:0,[wi.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=Q(),this.localOrigins=new nyt(new gZ(e.renderSR))}initialize(){this.worker=new Gyt(this.schedule),this.componentColorManager=new wTe(this.rctx,2);const e=RTe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=Fi.createVertex(this.rctx,tr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Xt(this.strokesTexture),this.componentColorManager=Ht(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Xt(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[wi.TRANSPARENT]+this.numberOfRenderedEdges[wi.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let p;const y=new Xce(new Promise(x=>p=x),i.center,i.radius);this.perObjectData.set(e,y);const b=await this.updatingHandles.addPromise(this._addComponentGeometry(t,y,r,s,n,a,l));return this.setNeedsRender(),p(),b}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void Yyt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const a=e.boundingVolumeWorldSpace.bounds,l=new Xce(new Promise(y=>n=y),ru(a),sN(a));this.perObjectData.set(e,l);const p=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Zyt(e))p.push(this._addObjectMergedGeometries(e,l,t,i,r));else for(let y=0;y<e.geometries.length;y++){const b=e.geometryRecords[y];if(!b.material.supportsEdges)continue;const x=e.geometries[y];p.push(this._addGeometry(e,l,x,b,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(p)),this.perObjectDataEvictionCache.delete(l),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const a=i(n),l=r.components.meta[n],p=l.index;l.material.opacity=a,r.components.buffer.textureBuffer.setDataElement(p,1,3,255*a)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof Qg,n=!!i.slicePlaneEnabled,a=Hce(t),l=JM.getKey(a,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(p=>{if(l!==p.rendererKey){const y=this.renderers.get(p.rendererKey),b=this._acquireRenderer(a,n,s);y.removeRenderable(p),y.refCount.decrement(),p.rendererKey=l,b.addRenderable(p)}for(let y=0;y<t.length;y++)p.components.meta[y].material=t[y];r&&this._updateComponentBuffer(p.components),this._updateTransparency(p)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";return await t.loaded,t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,J(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=Q(),s=new q8,n=new Axe,a=zs();ze(r,i[3],i[7],i[11]),s.set(r),ke(n.transformWorldFromViewTH,s.high),ke(n.transformWorldFromViewTL,s.low),md(n.transformViewFromCameraRelativeRS,e.camera.viewMatrix),nn(n.transformProjFromView,e.camera.projectionMatrix);const l=zs();gd(l,n.transformViewFromCameraRelativeRS),iw(a,l);let p=0,y=0;if(this.renderers.forEach(x=>{x.refCount.value===0?(this.renderers.delete(x.key),x.dispose()):x.forEachRenderable(A=>{A.visible&&(p+=A.statistics.averageEdgeLength,y++)},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),y===0)return;const b={distanceFalloffFactor:40*p/y,minimumEdgeLength:e.camera.perScreenPixelRatio,transparency:t,viewProjectionTransform:n,transformNormalViewFromGlobal:a};this._updateObjectCameraDistances(e),this.renderers.forEach(x=>{this._renderRegularEdges(x,e,b),this._renderSilhouetteEdges(x,e,b)})}_updateTransparency(e){const t=ZU(e.components.meta),i=KU(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),L(t.origin))this.localOrigins.register(t.origin);else{const r=ze(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return ryt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e;for(let r=0;r<t.length;r++){const s=t[r].material,n=t[r].index,a=Ot(Math.round(s.size*Cyt),0,255),l=Ot(s.extensionLength,-JU,255-JU)+JU,p=s.type==="solid"?lL.SOLID:lL.SKETCH,y=255*s.opacity,b=s.color,x=255*b[0],A=255*b[1],M=255*b[2],P=255*b[3];i.textureBuffer.setData(n,0,x,A,M,P),i.textureBuffer.setData(n,1,a,l,p,y)}}_createComponentBuffers(e){if(J(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],a=i.acquireIndex();t.push({index:a,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(J(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new In(this.rctx,nq,{vertices:Lce,instances:oL.glLayout},{vertices:this.verticesBufferObject,instances:Fi.createVertex(this.rctx,tr.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new In(this.rctx,nq,{vertices:Lce,instances:aL.glLayout},{vertices:this.verticesBufferObject,instances:Fi.createVertex(this.rctx,tr.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,a){const l=i.vertexAttributes.get(Y.POSITION),p=i.indices.get(Y.POSITION),y=lt(),b={position:l,indices:p,modelTransform:y,origin:this._computeModelTransformWithLocalOrigin(e,r,y)};return this._addPositionData(t,b,i.edgeIndicesLength,s,n,a)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([r]);if(J(a)||i<=0)return;const l=this._acquireRenderer(r.type,!!s.slicePlaneEnabled),{modelTransform:p,origin:y}=t,b=t.indices,x=t.position,A=x.data.length/x.size,M=sL.createBuffer(A);for(let B=0;B<A;B++)M.position.set(B,0,x.data[B*x.size+0]),M.position.set(B,1,x.data[B*x.size+1]),M.position.set(B,2,x.data[B*x.size+2]);Wce(a.meta,[0,M.componentIndex.count],M.componentIndex);const P=await this.updatingHandles.addPromise(this._extractEdges(l.writerSettings,M,!1,n,b,i));if(e.loaded==null)return;const{regular:$,silhouette:k}=this._createEdgeResources(P),z=($?$.vao.size:0)+(k?k.vao.size:0),G={regular:$,silhouette:k,transform:{modelMatrix:p,origin:y},statistics:{gpuMemoryUsage:z,externalMemoryUsage:!1,averageEdgeLength:P.averageEdgeLength},components:a,visible:!0,edgeTransparency:ZU(a.meta),objectTransparency:KU(a.meta),distanceToCamera:0,rendererKey:l.key};e.renderables.push(G),l.addRenderable(G),this.gpuMemoryUsage+=z}async _addComponentGeometry(e,t,i,r,s,n,a){if(t.loaded==null)return 0;const l=this._createComponentBuffers(n);if(J(l))return 0;const p=Hce(n),y=this._acquireRenderer(p,a.slicePlaneEnabled||!1,!1),b=sL.createBuffer(i.count);SZ(b.position,i),Wce(l.meta,s,b.componentIndex,r);const x=!0,A=y.writerSettings,M=await this.updatingHandles.addPromise(this._extractEdges(A,b,x,!1,r));if(t.loaded==null)return 0;const{regular:P,silhouette:$}=this._createEdgeResources(M),k=(P?P.vao.size:0)+($?$.vao.size:0),z={regular:P,silhouette:$,transform:e,statistics:{gpuMemoryUsage:k,externalMemoryUsage:!0,averageEdgeLength:M.averageEdgeLength},components:l,visible:!0,edgeTransparency:ZU(l.meta),objectTransparency:KU(l.meta),distanceToCamera:0,rendererKey:y.key};return t.renderables.push(z),y.addRenderable(z),k}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let a=0,l=null,p=0;for(let z=0;z<e.geometries.length;z++){const G=e.geometries[z],B=e.geometryRecords[z];if(!B.material.supportsEdges)continue;!l&&B.origin&&(l=B);const W=G.vertexAttributes.get(Y.POSITION);p+=W.data.length/W.size,a+=G.edgeIndicesLength}const y=p>=65536?Uint32Array:Uint16Array,b=a?new y(a):null,x=[];let A=0;for(let z=0;z<e.geometries.length;z++){const G=e.geometries[z];if(!e.geometryRecords[z].material.supportsEdges)continue;const B=G.vertexAttributes.get(Y.POSITION),W=G.indices.get(Y.POSITION);let q=n.get(B.data);if(q==null){q=x.length/3;for(let X=0;X<B.data.length;X+=B.size)x.push(B.data[X+0]),x.push(B.data[X+1]),x.push(B.data[X+2]);n.set(B.data,q)}if(W)for(let X=0;X<G.edgeIndicesLength;X++)b[A++]=q+W[X]}const M=l||e.geometryRecords[0],P=lt(),$=this._computeModelTransformWithLocalOrigin(e,M,P);for(let z=0;z<e.geometryRecords.length;z++)e.geometryRecords[z].origin=$;const k={position:{data:x,size:3},indices:b,modelTransform:P,origin:$};await this.updatingHandles.addPromise(this._addPositionData(t,k,b.length,i[0],r,s))}_acquireRenderer(e,t,i=!0){const r=JM.getKey(e,t,i);let s=this.renderers.get(r);return J(this.strokesTexture)&&(this.strokesTexture=jyt(this.rctx)),s||(s=new JM(this.rctx,this.techniqueRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture,legacy:i}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){Jyt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=Q(),s=n=>{const{center:a,radius:l}=n;a0(r,a,t);const p=rt(r,i),y=p<-l?1/0:p<l?0:p-l;n.renderables.forEach(b=>b.distanceToCamera=y)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){e.bindRegularEdges(t,i);const r=i.transparency;e.forEachRenderable(s=>{if(!s.visible||!s.regular)return;const n=qce(s.regular.lod.lengths,s.distanceToCamera,i);"origin"in s.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(s.transform.origin)),e.renderRegularEdges(s,t,n),this.numberOfRenderedEdges[r]+=n},r)}_renderSilhouetteEdges(e,t,i){e.bindSilhouetteEdges(t,i);const r=i.transparency;e.forEachRenderable(s=>{if(!s.visible||!s.silhouette)return;const n=qce(s.silhouette.lod.lengths,s.distanceToCamera,i);"origin"in s.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(s.transform.origin)),e.renderSilhouetteEdges(s,t,n),this.numberOfRenderedEdges[r]+=n},r)}};function Jyt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function Zyt(e){let t=null,i=null;for(let s=0;s<e.geometries.length;s++){var r;const n=e.geometryRecords[s];if(n.material.supportsEdges){if(t){if(!$2(t,n.transformation))return!1}else t=n.transformation;if(!i&&L(n.origin))i=n;else if(L((r=i)==null?void 0:r.origin)&&L(n.origin)&&i.origin.id!==n.origin.id)return!1}}return!0}_([S({constructOnly:!0})],Lf.prototype,"rctx",void 0),_([S({constructOnly:!0})],Lf.prototype,"renderSR",void 0),_([S({constructOnly:!0})],Lf.prototype,"techniqueRepository",void 0),_([S({constructOnly:!0})],Lf.prototype,"setNeedsRender",void 0),_([S({constructOnly:!0})],Lf.prototype,"schedule",void 0),_([S({readOnly:!0})],Lf.prototype,"updatingHandles",void 0),_([S({readOnly:!0})],Lf.prototype,"updating",null),Lf=_([re("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Lf);class Xce{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}function FTe(e){const t=e.capabilities.disjointTimerQuery;return J(t)?null:t.timestampBits()>0?new Kyt(t):aq?null:new Qyt(t)}class Kyt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class Qyt{constructor(t){this.timer=t,this.query=t.createQuery(),aq=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),aq=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let aq=!1;var wn;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(wn||(wn={}));const evt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class tvt extends ov{constructor(){super("total"),this.total=0,this.frameCount=0}}class ivt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new tvt,this.gpuTime=new ov("gpu",9),this.renderPassTimings=evt.map(t=>new ov(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:Uq(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=FTe(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){L(this._gpuTimer)&&(this._gpuTimer.stop(i=>L(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const Yce=.9;let Dm=class extends st{constructor(e,t,i,r,s,n,a,l,p){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=a,this._stage=p,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new ivt,this._antialiasing=Wb.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._opaqueTerrain=!0,this._lighting=new mxe,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Ei,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new sM(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new M1t(this._rctx,this._compositingHelper),this._sliceHelper=new Z1t,this._shadowMap=new STe(this._rctx,p.viewingMode,2),this._ssaoHelper=new iyt(i,this._rctx,()=>this._requestRender()),this._highlightHelper=new S1t(i,this._rctx),this._shadowHighlightHelper=new J1t(this._rctx,p.viewingMode),this._shadowAccumulator=new Aa(this._rctx,i,p,(y,b)=>{this.renderPassManager.shadowCastingEnabled=!0,this._renderPlugins.prepareRender(y,b),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled},(y,b,x,A)=>{y.start(x,b,A),this._renderShadowCascades(bt.MATERIAL_DEPTH_SHADOWMAP_ALL,y),x.setGLViewport(this._rctx),this._ensureCameraBindParameters(x)},()=>this._requestRender()),this._bindParameters={slot:null,camera:null,inverseViewport:St(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMatrix:Rn,ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0},this._renderContext=new Qnt(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null},this._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null},this._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:Rn,ssrEnabled:!1},this._renderPlugins=new P1t({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:l}),this.renderPassManager=new v1t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([Pi(ur,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",y=>{this._renderHiddenTransparentEdges=y?()=>this._renderEdges(wi.TRANSPARENT):()=>{},this._requestRender()}),Pi(this._stage,"camera",()=>this._requestRender(),!0)])}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=Ht(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Xt(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlightHelper.dispose(),this._shadowHighlightHelper.dispose(),this._shadowAccumulator.dispose(),VN.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Wb.SMAA&&this._smaaPass.updating||L(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return J(this._edgeView)&&(this._edgeView=new Lf({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(this._edgeView.watch("updating",()=>this._requestRender(),!0)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return this._bindParameters.reprojectionMatrix===null||TV(this._bindParameters.reprojectionMatrix,Rn)}set _reprojectionMatrix(e){TV(this._bindParameters.reprojectionMatrix,e)||(this._bindParameters.reprojectionMatrix=e,this.notifyChange("isCameraFinal"))}get hasShadowsEnabled(){var e;return!((e=this._shadowMap)==null||!e.enabled)}setRenderParameters(e){const{renderPassManager:t,_shadowMap:i,_ssaoHelper:r}=this;e.screenSpaceReflectionsEnabled!==void 0&&t.screenSpaceReflectionsEnabled!==e.screenSpaceReflectionsEnabled&&(t.screenSpaceReflectionsEnabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.fillLightsEnabled!==void 0&&t.fillLightsEnabled!==e.fillLightsEnabled&&(t.fillLightsEnabled=e.fillLightsEnabled,this._requestRender()),e.shadowMap===void 0||i.enabled===e.shadowMap&&t.shadowCastingEnabled===e.shadowMap||(i.enabled=e.shadowMap,t.shadowCastingEnabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.ssao!==void 0&&r.enabled!==e.ssao&&(r.enabled=e.ssao,this._requestRender()),e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?Wb.SMAA:Wb.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.waterReflectionEnabled&&(this._waterReflectionEnabled=e.waterReflectionEnabled,this._requestRender()),e.fillLightsEnabled!==void 0&&this._hasFillLights!==e.fillLightsEnabled&&(this._hasFillLights=e.fillLightsEnabled,this._requestRender()),e.opaqueTerrain!==void 0&&this._opaqueTerrain!==e.opaqueTerrain&&(this._opaqueTerrain=e.opaqueTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:a})=>this._content.delete(a)),t.forAll(a=>this._content.set(a.id,a));const s=jwe(e);let n=!1;s.forEach((a,l)=>{let p=this._materialRenderers.get(l);if(!p){if(!(a.adds.length>0))return;p=new Jwe(this._rctx,this._materialRepository,l),this._materialRenderers.set(l,p)}p.modify(a),p.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((a,l)=>{a.isEmpty&&(this._materialRenderers.delete(l),a.dispose())}),this._hasHighlights=rn(this._materialRenderers,a=>a.hasHighlights),this._hasOccludees=rn(this._materialRenderers,a=>a.hasOccludees),this._hasWater=rn(this._materialRenderers,a=>a.hasWater),this._needsTransparentPass=rn(this._materialRenderers,a=>a.requiresSlot(tt.TRANSPARENT_MATERIAL,bt.MATERIAL)),this._hasHUDElements=rn(this._materialRenderers,a=>a.requiresSlot(tt.LINE_CALLOUTS_HUD_DEPTH,bt.MATERIAL)||a.requiresSlot(tt.HUD_MATERIAL,bt.MATERIAL)||a.requiresSlot(tt.LABEL_MATERIAL,bt.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._lighting.groundLightingFactor=t,this._lighting.globalFactor=i,this._lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.lighting=this._lighting,this._renderContext.hasOccludees=this._hasOccludees,this._renderContext.transparencyPassType=this._bindParameters.transparencyPassType=Qt.NONE,this._renderContext.hasFillLights=this._bindParameters.hasFillLights=this._hasFillLights;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=this._sliceHelper.plane;r===tw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this.needsShadowCast&&(this.renderPassManager.shadowCastingEnabled=!0),this._renderPlugins.prepareRender(t,i),this.performanceInfo.advance(wn.Prepare);const a=this._computeDepthRange(t);this._renderShadowMap(e,t,this._lighting.lightingMainDirection,a),this.performanceInfo.advance(wn.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t),this._renderLinearDepth(),this.performanceInfo.advance(wn.Lineardepth),this._accumulateShadows(a,t,i),this._renderNormal(),this.performanceInfo.advance(wn.Normals),this._ensureBindParametersSSR(),this._ensureBindParametersCloudsReflections(),this._ssaoHelper.computeSSAO(t,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(wn.SSAO),this._renderContext.pass=bt.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(wn.Opaque);const l=this._multipassTerrain&&!this._opaqueTerrain;this._renderTerrainLinearDepth(l),this._setMultipassFlags(l),this._setTerrainCulling(l),this._renderEdges(wi.OPAQUE),this.performanceInfo.advance(wn.OpaqueEdges),this._renderHiddenTransparentEdges();const p=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;p&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(wn.Transparent),this._renderGeometryLinearDepth(l);const y=this._renderHUDVisibility();l||this._renderInternalSlot(tt.LINE_CALLOUTS),this.performanceInfo.advance(wn.Hudvisibility),this._renderEdges(wi.TRANSPARENT,l),this.performanceInfo.advance(wn.TransparentEdges),this._renderSlot(tt.VOXEL),this._renderTransparentTerrain(),!this._opaqueTerrain&&y&&(l?this._renderLineCallouts(Gu.OCCLUDED):s.compositeTransparentTerrainOntoHUDVisibility(),this._renderHUD(Gu.OCCLUDED,s.framebuffer),this.performanceInfo.advance(wn.HudOccluded)),this.performanceInfo.advance(wn.TransparentTerrain),this._setTerrainCulling(!1),this._opaqueTerrain||(s.compositeTransparentTerrainOntoMain(),l&&(this._renderEdges(wi.OPAQUE),this.performanceInfo.advance(wn.OpaqueEdges),p&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(wn.Transparent),this._renderEdges(wi.TRANSPARENT),this.performanceInfo.advance(wn.TransparentEdges))),l&&this._renderLineCallouts(Gu.NOTOCCLUDED),this._setMultipassFlags(!1),this._shadowAccumulator.render(),s.renderToTargets(()=>{this._renderInternalSlot(tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(tt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(tt.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(wn.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(tt.LASERLINES_CONTRAST_CONTROL),la.PremultipliedAlpha),this.performanceInfo.advance(wn.Laserline),this._renderOccluded(),this.performanceInfo.advance(wn.Occluded);const b=r===tw.ON&&this._magnifierHelper.enabled,x=b&&J(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(x);const A=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,A)&&L(A)&&this._compositingHelper.composite(A,la.None),this.performanceInfo.advance(wn.Antialiasing),this._renderHUD(Gu.NOTOCCLUDED,x),this.performanceInfo.advance(wn.HudNotoccluded),this._renderHighlights(x,this._bindParameters),this.performanceInfo.advance(wn.Highlights),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),x!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,la.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===An.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/g1t;this._animationTimestep=Math.max(this._animationTimestep*Yce+t*(1-Yce),y1t)}}readDepthPixels(e,t,i,r,s,n){const a=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const l=Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT|Sr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(l),this._renderGeometryAndTransparentTerrainPass(bt.MATERIAL_DEPTH)}a.readPixels(t,i,r,s,_t.RGBA,ai.UNSIGNED_BYTE,n)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassFlags(e){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=e,this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=e}_setTerrainCulling(e){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=e}_renderSlot(e){this._renderContext.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;L(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),la.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlightHelper.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,ETe)),s.clear(),this._renderShadowCascades(bt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,ATe),this._renderGeometryAndTransparentTerrainPass(bt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(bt.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(bt.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=bt.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(bt.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(bt.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return KH;const t=n1t(e,this._content,this._stage.layers);return KS(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(tt.INTEGRATED_MESH),this._renderSlot(tt.OPAQUE_TERRAIN),this._renderInternalSlot(tt.OPAQUE_MATERIAL),this._renderSlot(tt.OPAQUE_PLUGIN),this._renderSlot(tt.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(tt.TRANSPARENT_MATERIAL),this._renderSlot(tt.TRANSPARENT_PLUGIN)}_renderTransparentTerrain(){this._renderSlot(tt.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(tt.OCCLUSION_PIXELS)},this._multipassTerrain&&!this._opaqueTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Gu.OCCLUDED?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(tt.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(tt.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,la.PremultipliedAlpha)):e===Gu.OCCLUDED?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Gu.OCCLUDED),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(tt.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(tt.HUD_MATERIAL),this._renderInternalSlot(tt.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlightHelper,r=i.profilingCallback&&FTe(this._renderContext.rctx);this._renderContext.highlightDepthTexture=t.highlightDepthTexture;const s=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(bt.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(Sr.DEPTH_BUFFER_BIT),this._renderHUDElements(Gu.BOTH)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=s.colorTexture,this.needsShadowHighlight&&this._shadowHighlightHelper.render(t,e),i.render(this._renderContext.camera,s,e),L(r)&&i.profilingCallback&&r.stop(n=>{i.profilingCallback&&i.profilingCallback(n)})}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,e,t,i),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._renderContext.transparencyPassType=s,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=bt.MATERIAL_ALPHA,i(Qt.Alpha),this._renderContext.pass=bt.MATERIAL,i(Qt.Color),i(Qt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(t),this._renderContext.transparencyPassType=Qt.NONE,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,a)=>{a&&a.isVisible()&&a.renderOccluded===qs.OccludeAndTransparentStencil&&(e|=a.renderOccluded,jA.push(a))});const t=this._offscreenRendering,i=(n,a,l,p,y)=>{(e&a)!=0&&(t.renderToTargets(l,t.tmpColor,t.mainDepth,[0,0,0,0],p,y),t.compositeOccludedOntoMain(n))};jA.length!==0&&(this._renderInternalSlot(tt.OCCLUDER_MATERIAL,jA),i(.5,qs.OccludeAndTransparentStencil,()=>this._renderInternalSlot(tt.TRANSPARENT_OCCLUDER_MATERIAL,jA),!1,!1),jA.length=0),this._materialRenderers.forEach((n,a)=>{a&&a.isVisible()&&(a.renderOccluded===qs.OccludeAndTransparent||a.renderOccluded===qs.Transparent||a.renderOccluded===qs.Opaque)&&(e|=a.renderOccluded,GA.push(a))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>qs.Occlude&&this._renderSlot(tt.OCCLUDED_TERRAIN),this._renderInternalSlot(tt.OPAQUE_MATERIAL,GA),this._renderInternalSlot(tt.TRANSPARENT_MATERIAL,GA),this._renderInternalSlot(tt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,GA),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=bt.MATERIAL,i(.5,qs.OccludeAndTransparent,()=>s(qs.OccludeAndTransparent),!0,ic.OutlineVisualElementMask),i(.5,qs.Transparent,()=>s(qs.Transparent),!0,ic.OutlineVisualElementMask),i(1,qs.Opaque,()=>s(qs.Opaque),!0,ic.OutlineVisualElementMask),GA.length=0}_renderAntiAliasing(e,t){if(e===Wb.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&L(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e){this._renderContext.camera=e,this._bindParameters.camera=this._renderContext.camera,this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]}_ensureBindParameters(e){var t;this._ensureCameraBindParameters(e);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap,this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled,this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper,this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled,this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane,this._bindParameters.hasOccludees=this._renderContext.hasOccludees,this._renderContext.multipassTerrainParams.camera=this._renderContext.camera,this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(t=i.depthTexture)!=null?t:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=Rn:(yl(Jce,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),yl(SI,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),Ms(SI,SI),Ms(Zce,this._renderContext.camera.projectionMatrix),As(Nx,SI,Zce),As(Nx,Jce,Nx),As(Nx,this._renderContext.lastFrameCamera.projectionMatrix,Nx),this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=Nx),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection}_ensureBindParametersCloudsReflections(){this._bindParameters.cloudsCompositionParams=this._renderContext.cloudsCompositionParams}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,L(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);L(s)&&(i=s.render(e,this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&(i=r.render(e,this._renderContext.pass,this._bindParameters)||i)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=k_e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,a,l,p,y;return{offscreen:(e=(t=this._offscreenRendering)==null?void 0:t.gpuMemoryUsage)!=null?e:0,highlights:((i=(r=this._highlightHelper)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((s=(n=this._shadowHighlightHelper)==null?void 0:n.gpuMemoryUsage)!=null?s:0),shadows:(a=(l=this._shadowMap)==null?void 0:l.gpuMemoryUsage)!=null?a:0,ssao:(p=(y=this._ssaoHelper)==null?void 0:y.gpuMemoryUsage)!=null?p:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{var i;switch(t){case Oy.Color:return e._offscreenRendering.colorTexture;case Oy.LinearDepth:return e._offscreenRendering.linearDepthTexture;case Oy.Normals:return e._offscreenRendering.normalTexture;case Oy.ShadowMap:return(i=e._shadowMap)==null?void 0:i.test.depthTexture;case Oy.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case Oy.Highlight:return e._offscreenRendering.highlightTexture}}}}};var Oy;_([S()],Dm.prototype,"_shadowAccumulator",void 0),_([S()],Dm.prototype,"_smaaPass",void 0),_([S()],Dm.prototype,"_antialiasing",void 0),_([S()],Dm.prototype,"_edgeView",void 0),_([S()],Dm.prototype,"updating",null),_([S()],Dm.prototype,"isCameraFinal",null),Dm=_([re("esri.views.3d.webgl-engine.lib.Renderer")],Dm),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(Oy||(Oy={}));const GA=[],jA=[],Jce=lt(),Zce=lt(),SI=lt(),Nx=lt(),rvt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Kce,kTe={exports:{}};(Kce=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(kTe.exports=Kce);const svt=kTe.exports;var Qce,UTe={exports:{}};Qce=UTe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Qce.exports=t)}();const ehe=UTe.exports;var zTe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(zTe);const nvt=zTe.exports;var Nd=999,the=9999,QU=0,ez=1,ihe=2,rhe=3,she=4,EI=5,ovt=6,avt=7,lvt=8,nhe=9,cvt=10,ohe=11,hvt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function uvt(){var e,t,i,r=0,s=0,n=Nd,a=[],l=[],p=1,y=0,b=0,x=!1,A=!1,M="";return function(ge){return l=[],ge!==null?$(ge.replace?ge.replace(/\r\n/g,`
`):ge):k()};function P(ge){ge.length&&l.push({type:hvt[n],data:ge,position:b,line:p,column:y})}function $(ge){var Ce;for(r=0,i=(M+=ge).length;e=M[r],r<i;){switch(Ce=r,n){case QU:r=q();break;case ez:r=W();break;case ihe:r=B();break;case rhe:r=X();break;case she:r=he();break;case ohe:r=de();break;case EI:r=fe();break;case the:r=me();break;case nhe:r=G();break;case Nd:r=z()}Ce!==r&&(M[Ce]===`
`?(y=0,++p):++y)}return s+=r,M=M.slice(r),l}function k(ge){return a.length&&P(a.join("")),n=cvt,P("(eof)"),l}function z(){return a=a.length?[]:a,t==="/"&&e==="*"?(b=s+r-1,n=QU,t=e,r+1):t==="/"&&e==="/"?(b=s+r-1,n=ez,t=e,r+1):e==="#"?(n=ihe,b=s+r,r):/\s/.test(e)?(n=nhe,b=s+r,r):(x=/\d/.test(e),A=/[^\w_]/.test(e),b=s+r,n=x?she:A?rhe:the,r)}function G(){return/[^\s]/g.test(e)?(P(a.join("")),n=Nd,r):(a.push(e),t=e,r+1)}function B(){return e!=="\r"&&e!==`
`||t==="\\"?(a.push(e),t=e,r+1):(P(a.join("")),n=Nd,r)}function W(){return B()}function q(){return e==="/"&&t==="*"?(a.push(e),P(a.join("")),n=Nd,r+1):(a.push(e),t=e,r+1)}function X(){if(t==="."&&/\d/.test(e))return n=EI,r;if(t==="/"&&e==="*")return n=QU,r;if(t==="/"&&e==="/")return n=ez,r;if(e==="."&&a.length){for(;oe(a););return n=EI,r}if(e===";"||e===")"||e==="("){if(a.length)for(;oe(a););return P(e),n=Nd,r+1}var ge=a.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||ge){for(;oe(a););return n=Nd,r}return a.push(e),t=e,r+1}function oe(ge){for(var Ce,Ae,Pe=0;;){if(Ce=ehe.indexOf(ge.slice(0,ge.length+Pe).join("")),Ae=ehe[Ce],Ce===-1){if(Pe--+ge.length>0)continue;Ae=ge.slice(0,1).join("")}return P(Ae),b+=Ae.length,(a=a.slice(Ae.length)).length}}function de(){return/[^a-fA-F0-9]/.test(e)?(P(a.join("")),n=Nd,r):(a.push(e),t=e,r+1)}function he(){return e==="."||/[eE]/.test(e)?(a.push(e),n=EI,t=e,r+1):e==="x"&&a.length===1&&a[0]==="0"?(n=ohe,a.push(e),t=e,r+1):/[^\d]/.test(e)?(P(a.join("")),n=Nd,r):(a.push(e),t=e,r+1)}function fe(){return e==="f"&&(a.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(a.push(e),t=e,r+1):/[^\d]/.test(e)?(P(a.join("")),n=Nd,r):(a.push(e),t=e,r+1)}function me(){if(/[^\d\w_]/.test(e)){var ge=a.join("");return n=svt.indexOf(ge)>-1?lvt:nvt.indexOf(ge)>-1?avt:ovt,P(a.join("")),n=Nd,r}return a.push(e),t=e,r+1}}function dvt(e){var t=uvt(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function pvt(e){return dvt(e)}function fvt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const tz=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function mvt(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const a=n[1].replace(/\s\s+/g," ");if(a===i)return a;if(a===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+a)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function gvt(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function nM(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,nM(e,t,r+"_"+t[r],r);return i}function BTe(e,t,i="afterVersion"){function r(p,y){for(let b=y;b<p.length;b++){const x=p[b];if(x.type==="operator"&&x.data===";")return b}return null}function s(p){let y=-1,b=0,x=-1;for(let A=0;A<p.length;A++){const M=p[A];if(M.type==="preprocessor"&&(M.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++b:M.data.match(/\#endif\s*.*/)&&--b),i!=="afterVersion"&&i!=="afterPrecision"||M.type==="preprocessor"&&/^#version/.test(M.data)&&(x=Math.max(x,A)),i==="afterPrecision"&&M.type==="keyword"&&M.data==="precision"){const P=r(p,A);if(P===null)throw new Error("precision statement not followed by any semicolons!");x=Math.max(x,P)}y<x&&b===0&&(y=A)}return y+1}const n={data:`
`,type:"whitespace"},a=p=>p<e.length&&/[^\r\n]$/.test(e[p].data);let l=s(e);a(l-1)&&e.splice(l++,0,n);for(const p of t)e.splice(l++,0,p);a(l-1)&&a(l)&&e.splice(l,0,n)}function yvt(e,t,i,r="lowp"){BTe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function vvt(e,t,i,r,s="lowp"){BTe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function _vt(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const a=e[n];if(a.type==="operator"&&(a.data==="["&&(i=n),a.data==="]")){r=n;break}a.type==="integer"&&(s=parseInt(a.data,10))}return i&&r&&e.splice(i,r-i+1),s}function ahe(e,t){const i=bvt();if(L(i))return i;const r=pvt(e);if(mvt(r,"100","300 es")==="300 es")return e;let s=null,n=null;const a={},l={};for(let p=0;p<r.length;++p){const y=r[p];switch(y.type){case"keyword":t===Bh.VERTEX_SHADER&&y.data==="attribute"?y.data="in":y.data==="varying"&&(y.data=t===Bh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(y.data.trim())&&(y.data=y.data.replace(/(2D|Cube|EXT)/g,"")),t===Bh.FRAGMENT_SHADER&&y.data==="gl_FragColor"&&(s||(s=nM(r,a,"fragColor"),yvt(r,s,"vec4")),y.data=s),t===Bh.FRAGMENT_SHADER&&y.data==="gl_FragData"){const b=_vt(r,p+1),x=nM(r,a,"fragData");vvt(r,x,"vec4",b,"mediump"),y.data=x}else t===Bh.FRAGMENT_SHADER&&y.data==="gl_FragDepthEXT"&&(n||(n=nM(r,a,"gl_FragDepth")),y.data=n);break;case"ident":if(rvt.indexOf(y.data)>=0){if(t===Bh.VERTEX_SHADER&&gvt(r,p))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");y.data in l||(l[y.data]=nM(r,a,y.data)),y.data=l[y.data]}}}for(let p=r.length-1;p>=0;--p){const y=r[p];if(y.type==="preprocessor"){const b=y.data.match(/\#extension\s+(.*)\:/);if(b&&b[1]&&tz.indexOf(b[1].trim())>=0){const M=r[p+1];r.splice(p,M&&M.type==="whitespace"?2:1)}const x=y.data.match(/\#ifdef\s+(.*)/);x&&x[1]&&tz.indexOf(x[1].trim())>=0&&(y.data="#if 1");const A=y.data.match(/\#ifndef\s+(.*)/);A&&A[1]&&tz.indexOf(A[1].trim())>=0&&(y.data="#if 0")}}return wvt(e,fvt(r))}function bvt(e){return null}function wvt(e,t){return t}const xvt=4294967295;class Tvt{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Yi.WEBGL2&&(i=ahe(i,Bh.VERTEX_SHADER),r=ahe(r,Bh.FRAGMENT_SHADER)),this._vShader=lhe(this._context,Bh.VERTEX_SHADER,i),this._fShader=lhe(this._context,Bh.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(so.Shader,this),PR()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(L(this._glName))return this._glName;if(J(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),PR()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Yi.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const a=r.getUniformBlockIndex(i,s);a<xvt&&r.uniformBlockBinding(i,a,n)}}return this._glName=i,this._context.instanceCounter.increment(so.Program,this),i}get hasGLName(){return L(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(so.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(so.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];(r===void 0||i!==r)&&(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){const r=this._nameToUniform1v[t];Vf(r,i)&&(this._context.gl.uniform1iv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform1v[t]=Array.from(i):mf(i,r))}setUniform2iv(t,i){const r=this._nameToUniform2[t];Vf(r,i)&&(this._context.gl.uniform2iv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform2[t]=Array.from(i):mf(i,r))}setUniform3iv(t,i){const r=this._nameToUniform3[t];Vf(r,i)&&(this._context.gl.uniform3iv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform3[t]=Array.from(i):mf(i,r))}setUniform4iv(t,i){const r=this._nameToUniform4[t];Vf(r,i)&&(this._context.gl.uniform4iv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform4[t]=Array.from(i):mf(i,r))}setUniform1f(t,i){const r=this._nameToUniform1[t];(r===void 0||i!==r)&&(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){const r=this._nameToUniform1v[t];Vf(r,i)&&(this._context.gl.uniform1fv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform1v[t]=Array.from(i):mf(i,r))}setUniform2f(t,i,r){const s=this._nameToUniform2[t];(s===void 0||i!==s[0]||r!==s[1])&&(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s===void 0?this._nameToUniform2[t]=[i,r]:(s[0]=i,s[1]=r))}setUniform2fv(t,i){const r=this._nameToUniform2[t];Vf(r,i)&&(this._context.gl.uniform2fv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform2[t]=Array.from(i):mf(i,r))}setUniform3f(t,i,r,s){const n=this._nameToUniform3[t];(n===void 0||i!==n[0]||r!==n[1]||s!==n[2])&&(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n===void 0?this._nameToUniform3[t]=[i,r,s]:(n[0]=i,n[1]=r,n[2]=s))}setUniform3fv(t,i){const r=this._nameToUniform3[t];Vf(r,i)&&(this._context.gl.uniform3fv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform3[t]=Array.from(i):mf(i,r))}setUniform4f(t,i,r,s,n){const a=this._nameToUniform4[t];(a===void 0||i!==a[0]||r!==a[1]||s!==a[2]||n!==a[3])&&(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),a===void 0?this._nameToUniform4[t]=[i,r,s,n]:(a[0]=i,a[1]=r,a[2]=s,a[3]=n))}setUniform4fv(t,i){const r=this._nameToUniform4[t];Vf(r,i)&&(this._context.gl.uniform4fv(this._getUniformLocation(t),i),r===void 0?this._nameToUniform4[t]=Array.from(i):mf(i,r))}setUniformMatrix3fv(t,i,r=!1){const s=this._nameToUniformMatrix3[t];Avt(s,i)&&(this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i),s===void 0?this._nameToUniformMatrix3[t]=Array.from(i):mf(i,s))}setUniformMatrix4fv(t,i,r=!1){const s=this._nameToUniformMatrix4[t];Cvt(s,i)&&(this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i),s===void 0?this._nameToUniformMatrix4[t]=Array.from(i):mf(i,s))}stop(){}}function Vf(e,t){if(J(e)||e.length!==t.length)return!0;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!0;return!1}function lhe(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),PR()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Bh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Svt(i)),e.type===Yi.WEBGL2&&(console.log("Shader source before transpilation:"),console.log(i))),s}function Svt(e){let t=2;return e.replace(/\n/g,()=>`
`+Evt(t++)+":")}function Evt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function mf(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}function Avt(e,t){return!!J(e)||(e.length!==9?Vf(e,t):e.length!==9||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8])}function Cvt(e,t){return!!J(e)||(e.length!==16?Vf(e,t):e.length!==16||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15])}class Mvt{constructor(t){this._rctx=t,this._store=new dZ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(L(n))return n.ref(),n;const a=new Tvt(this._rctx,t,i,r,s);return a.ref(),this._store.set(t,i,a),a}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}class che{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ht.ONE,dstRGB:ht.ZERO,srcAlpha:ht.ONE,dstAlpha:ht.ZERO},this.blendEquation={mode:f0.ADD,modeAlpha:f0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Jl.BACK,this.frontFace=vS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=kr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Jl.FRONT_AND_BACK,func:kr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Jl.FRONT_AND_BACK,fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class Rvt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}class Ovt{constructor(){this.RECORD_ALLOCATIONS=!1}}const Pvt=new Ovt;class Ivt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Rvt(Pvt.RECORD_ALLOCATIONS);this._current.length<so.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<so.COUNT;++t){const i=this._current[t];i>0&&console.log(`${so[t]}: ${i}`)}}this._allocations.print()}}function hhe(e,t){const i=new Hr(e,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,wrapMode:ei.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:1,height:1});function r(z,G){const B=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,W=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,q=e.programCache.acquire(B,W,new Map([["position",0]])),X=new Float32Array(6);wD(z,X,3);const oe=new Float32Array(6);return wD(G,oe,3),e.useProgram(q),q.setUniform3f("u_highA",X[0],X[2],X[4]),q.setUniform3f("u_lowA",X[1],X[3],X[5]),q.setUniform3f("u_highB",oe[0],oe[2],oe[4]),q.setUniform3f("u_lowB",oe[1],oe[3],oe[5]),q}const s=Fi.createVertex(e,tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new In(e,new Map([["position",0]]),{geometry:[new jo("position",2,Zt.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=$t(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=$t(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),p=r(a,l),y=e.getBoundFramebufferObject(),{x:b,y:x,width:A,height:M}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(mi.TRIANGLE_STRIP,0,4);const P=new Uint8Array(4);i.readPixels(0,0,1,1,_t.RGBA,ai.UNSIGNED_BYTE,P),p.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(b,x,A,M),e.bindFramebuffer(y);const $=(a[2]-l[2])/25,k=WJ(P);return Math.abs($-k)}var uhe,dhe,phe,VTe={exports:{}};function $vt(e){var t,i,r,s,n;if(!e.gl)return!1;if(e.type===Yi.WEBGL1)return!((s=e.capabilities.textureFloat)==null||!s.textureFloat||(n=e.capabilities.colorBufferFloat)==null||!n.textureFloat);if(!(((t=e.capabilities.textureFloat)==null?void 0:t.textureFloat)&&((i=e.capabilities.colorBufferFloat)==null?void 0:i.textureFloat)&&((r=e.capabilities.colorBufferFloat)==null?void 0:r.floatBlend)))return!1;const a=new Hr(e,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,wrapMode:ei.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:ai.FLOAT,internalFormat:Jt.RGBA32F,samplingMode:Pt.NEAREST,width:1,height:1}),l=Fi.createVertex(e,tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),p=new In(e,new Map([["a_pos",0]]),{geometry:[new jo("a_pos",2,Zt.UNSIGNED_SHORT,0,4)]},{geometry:l}),y=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,b=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,x=e.programCache.acquire(y,b,new Map([["a_pos",0]]));e.useProgram(x);const A=e.getBoundFramebufferObject(),{x:M,y:P,width:$,height:k}=e.getViewport();e.bindFramebuffer(a),e.setViewport(0,0,1,1),e.bindVAO(p),e.drawArrays(mi.TRIANGLE_STRIP,0,4);const z=Ti({blending:iwe});e.setPipelineState(z),e.drawArrays(mi.TRIANGLE_STRIP,0,4),VTe.exports.init(e);const G=e.gl.getError();return e.setViewport(M,P,$,k),e.bindFramebuffer(A),x.dispose(),p.dispose(!1),l.dispose(),a.dispose(),G!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}uhe=VTe,dhe=function(){var e=function($){window.console&&window.console.log&&window.console.log($)},t=function($){window.console&&window.console.error?window.console.error($):e($)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n($){if(r==null)for(var k in r={},s={},$)typeof $[k]=="number"&&(r[$[k]]=k,s[k]=$[k])}function a(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function l($){return a(),r[$]!==void 0}function p($){a();var k=r[$];return k!==void 0?"gl."+k:"/*UNKNOWN WebGL ENUM*/ 0x"+$.toString(16)}function y($,k,z,G){var B;if((B=i[$])!==void 0&&(B=B[k])!==void 0&&B[z]){if(typeof B[z]=="object"&&B[z].enumBitwiseOr!==void 0){for(var W=B[z].enumBitwiseOr,q=0,X=[],oe=0;oe<W.length;++oe){var de=s[W[oe]];(G&de)!=0&&(q|=de,X.push(p(de)))}return q===G?X.join(" | "):p(G)}return p(G)}return G===null?"null":G===void 0?"undefined":G.toString()}function b($,k){for(var z="",G=k.length,B=0;B<G;++B)z+=(B==0?"":", ")+y($,G,B,k[B]);return z}function x($,k,z){$.__defineGetter__(z,function(){return k[z]}),$.__defineSetter__(z,function(G){k[z]=G})}function A($,k,z,G){G=G||$,n($),k=k||function(de,he,fe){for(var me="",ge=fe.length,Ce=0;Ce<ge;++Ce)me+=(Ce==0?"":", ")+y(he,ge,Ce,fe[Ce]);t("WebGL error "+p(de)+" in "+he+"("+me+")")};var B={};function W(de,he){return function(){z&&z(he,arguments);var fe=de[he].apply(de,arguments),me=G.getError();return me!=0&&(B[me]=!0,k(me,he,arguments)),fe}}var q={};for(var X in $)if(typeof $[X]=="function")if(X!="getExtension")q[X]=W($,X);else{var oe=W($,X);q[X]=function(){return A(oe.apply($,arguments),k,z,G)}}else x(q,$,X);return q.getError=function(){for(var de in B)if(B.hasOwnProperty(de)&&B[de])return B[de]=!1,de;return $.NO_ERROR},q}function M($){var k=$.getParameter($.MAX_VERTEX_ATTRIBS),z=$.createBuffer();$.bindBuffer($.ARRAY_BUFFER,z);for(var G=0;G<k;++G)$.disableVertexAttribArray(G),$.vertexAttribPointer(G,4,$.FLOAT,!1,0,0),$.vertexAttrib1f(G,0);$.deleteBuffer(z);var B=$.getParameter($.MAX_TEXTURE_IMAGE_UNITS);for(G=0;G<B;++G)$.activeTexture($.TEXTURE0+G),$.bindTexture($.TEXTURE_CUBE_MAP,null),$.bindTexture($.TEXTURE_2D,null);for($.activeTexture($.TEXTURE0),$.useProgram(null),$.bindBuffer($.ARRAY_BUFFER,null),$.bindBuffer($.ELEMENT_ARRAY_BUFFER,null),$.bindFramebuffer($.FRAMEBUFFER,null),$.bindRenderbuffer($.RENDERBUFFER,null),$.disable($.BLEND),$.disable($.CULL_FACE),$.disable($.DEPTH_TEST),$.disable($.DITHER),$.disable($.SCISSOR_TEST),$.blendColor(0,0,0,0),$.blendEquation($.FUNC_ADD),$.blendFunc($.ONE,$.ZERO),$.clearColor(0,0,0,0),$.clearDepth(1),$.clearStencil(-1),$.colorMask(!0,!0,!0,!0),$.cullFace($.BACK),$.depthFunc($.LESS),$.depthMask(!0),$.depthRange(0,1),$.frontFace($.CCW),$.hint($.GENERATE_MIPMAP_HINT,$.DONT_CARE),$.lineWidth(1),$.pixelStorei($.PACK_ALIGNMENT,4),$.pixelStorei($.UNPACK_ALIGNMENT,4),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,!1),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),$.UNPACK_COLORSPACE_CONVERSION_WEBGL&&$.pixelStorei($.UNPACK_COLORSPACE_CONVERSION_WEBGL,$.BROWSER_DEFAULT_WEBGL),$.polygonOffset(0,0),$.sampleCoverage(1,!1),$.scissor(0,0,$.canvas.width,$.canvas.height),$.stencilFunc($.ALWAYS,0,4294967295),$.stencilMask(4294967295),$.stencilOp($.KEEP,$.KEEP,$.KEEP),$.viewport(0,0,$.canvas.width,$.canvas.height),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT|$.STENCIL_BUFFER_BIT);$.getError(););}function P($){var k,z,G=[],B=[],W={},q=1,X=!1,oe=[],de=0,he=0,fe=!1,me=0,ge={};function Ce(xe){return typeof xe=="function"?xe:function($e){xe.handleEvent($e)}}$.getContext=(z=$.getContext,function(){var xe=z.apply($,arguments);if(xe instanceof WebGLRenderingContext){if(xe!=k){if(k)throw"got different context";W=Ie(k=xe)}return W}return xe});var Ae=function(xe){G.push(Ce(xe))},Pe=function(xe){B.push(Ce(xe))};function De(xe){var $e=xe.addEventListener;xe.addEventListener=function(et,ct,Mt){switch(et){case"webglcontextlost":Ae(ct);break;case"webglcontextrestored":Pe(ct);break;default:$e.apply(xe,arguments)}}}function ne(){for(var xe=Object.keys(ge),$e=0;$e<xe.length;++$e)delete ge[xe]}function pe(){++he,X||de==he&&$.loseContext()}function ye(xe,$e){var et=xe[$e];return function(){if(pe(),!X)return et.apply(xe,arguments)}}function we(){for(var xe=0;xe<oe.length;++xe){var $e=oe[xe];$e instanceof WebGLBuffer?k.deleteBuffer($e):$e instanceof WebGLFramebuffer?k.deleteFramebuffer($e):$e instanceof WebGLProgram?k.deleteProgram($e):$e instanceof WebGLRenderbuffer?k.deleteRenderbuffer($e):$e instanceof WebGLShader?k.deleteShader($e):$e instanceof WebGLTexture&&k.deleteTexture($e)}}function Ee(xe){return{statusMessage:xe,preventDefault:function(){fe=!0}}}return De($),$.loseContext=function(){if(!X){for(X=!0,de=0,++q;k.getError(););ne(),ge[k.CONTEXT_LOST_WEBGL]=!0;var xe=Ee("context lost"),$e=G.slice();setTimeout(function(){for(var et=0;et<$e.length;++et)$e[et](xe);me>=0&&setTimeout(function(){$.restoreContext()},me)},0)}},$.restoreContext=function(){X&&B.length&&setTimeout(function(){if(!fe)throw"can not restore. webglcontestlost listener did not call event.preventDefault";we(),M(k),X=!1,he=0,fe=!1;for(var xe=B.slice(),$e=Ee("context restored"),et=0;et<xe.length;++et)xe[et]($e)},0)},$.loseContextInNCalls=function(xe){if(X)throw"You can not ask a lost contet to be lost";de=he+xe},$.getNumCalls=function(){return he},$.setRestoreTimeout=function(xe){me=xe},$;function Ie(xe){for(var $e in xe)typeof xe[$e]=="function"?W[$e]=ye(xe,$e):x(W,xe,$e);W.getError=function(){if(pe(),!X)for(;dt=k.getError();)ge[dt]=!0;for(var dt in ge)if(ge[dt])return delete ge[dt],dt;return W.NO_ERROR};for(var et=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ct=0;ct<et.length;++ct){var Mt=et[ct];W[Mt]=function(dt){return function(){if(pe(),X)return null;var xt=dt.apply(xe,arguments);return xt.__webglDebugContextLostId__=q,oe.push(xt),xt}}(xe[Mt])}var at=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ct=0;ct<at.length;++ct)Mt=at[ct],W[Mt]=function(dt){return function(){return pe(),X?null:dt.apply(xe,arguments)}}(W[Mt]);var nt=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ct=0;ct<nt.length;++ct)Mt=nt[ct],W[Mt]=function(dt){return function(){return pe(),!X&&dt.apply(xe,arguments)}}(W[Mt]);return W.checkFramebufferStatus=function(dt){return function(){return pe(),X?W.FRAMEBUFFER_UNSUPPORTED:dt.apply(xe,arguments)}}(W.checkFramebufferStatus),W.getAttribLocation=function(dt){return function(){return pe(),X?-1:dt.apply(xe,arguments)}}(W.getAttribLocation),W.getVertexAttribOffset=function(dt){return function(){return pe(),X?0:dt.apply(xe,arguments)}}(W.getVertexAttribOffset),W.isContextLost=function(){return X},W}}return{init:n,mightBeEnum:l,glEnumToString:p,glFunctionArgToString:y,glFunctionArgsToString:b,makeDebugContext:A,makeLostContextSimulatingCanvas:P,resetToInitialState:M}},(phe=dhe())!==void 0&&(uhe.exports=phe);const Dvt=Ge.getLogger("esri.views.WebGLDriverTest");function Lvt(e){const t=new Hr(e,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,wrapMode:ei.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=Fi.createVertex(e,tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new In(e,new Map([["a_position",0]]),{geometry:[new jo("a_position",2,Zt.SHORT,0,4)]},{geometry:n}),l=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(l);const p=new Vt(e,{target:Yt.TEXTURE_2D,wrapMode:ei.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));l.setUniform1i("u_texture",0),e.bindTexture(p,0);const y=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(l);const{x:b,y:x,width:A,height:M}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(mi.TRIANGLE_STRIP,0,4),e.setViewport(b,x,A,M),t.readPixels(0,0,1,1,_t.RGBA,ai.UNSIGNED_BYTE,s),l.dispose(),a.dispose(!1),n.dispose(),t.dispose();const P=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return P&&Dvt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(y),P}new jo("a_pos",2,Zt.BYTE,0,2);new jo("a_pos",2,Zt.BYTE,0,4),new jo("a_tex",2,Zt.BYTE,2,4);const Nvt={geometry:[new jo("a_pos",2,Zt.UNSIGNED_SHORT,0,4)]};async function Fvt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new Hr(e,{colorTarget:ks.TEXTURE,depthStencilTarget:Qi.NONE},{target:Yt.TEXTURE_2D,wrapMode:ei.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,samplingMode:Pt.NEAREST,width:1,height:1}),r=Fi.createVertex(e,tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new In(e,new Map([["a_pos",0]]),Nvt,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,a=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,l=e.programCache.acquire(n,a,new Map([["a_pos",0]]));e.useProgram(l);const p=new Vt(e,{dataType:ai.UNSIGNED_BYTE,pixelFormat:_t.RGBA,preMultiplyAlpha:!1,wrapMode:ei.CLAMP_TO_EDGE,samplingMode:Pt.LINEAR},t);e.bindTexture(p,0),l.setUniform1i("u_texture",0);const y=e.getBoundFramebufferObject(),{x:b,y:x,width:A,height:M}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(Sr.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(mi.TRIANGLE_STRIP,0,4);const P=new Uint8Array(4);return i.readPixels(0,0,1,1,_t.RGBA,ai.UNSIGNED_BYTE,P),l.dispose(),s.dispose(!1),r.dispose(),i.dispose(),p.dispose(),e.setViewport(b,x,A,M),e.bindFramebuffer(y),t.src="",P[0]===255}class kvt{constructor(t){this.context=t,this._floatBufferBlendWorking=$vt(t),Fvt(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(J(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(J(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(J(this._doublePrecisionRequiresObfuscation)){const t=hhe(this.context,!1),i=hhe(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return J(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=Lvt(this.context)),this._ignoresSamplerPrecision}}class fhe{constructor(t,i,r,s,n,a,l,p){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=p}}function Uvt(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&yo(e)?new fhe(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new fhe(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function zvt(e,t){if(t.disjointTimerQuery)return null;if(yo(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Bvt(e){if(yo(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function Vvt(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Gvt(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function jvt(e,t){if(yo(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function Hvt(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function qvt(e,t){if(yo(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function Wvt(e,t){if(yo(e)){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function AI(e,t,i,r,s){if(r&&yo(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function Xvt(e,t){if(!yo(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function Yvt(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function Jvt(e,t){if(yo(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class Zvt{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=zvt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Bvt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Jvt(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Vvt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Gvt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Hvt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=Uvt(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=qvt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Wvt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=jvt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=AI(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=AI(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=AI(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=AI(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=Yvt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Xvt(this.gl,this._disabledExtensions)),this._textureNorm16}enable(t){return this[t]}}class Kvt{constructor(t,i){this.gl=t,this.instanceCounter=new Ivt,this.programCache=new Mvt(this),this._state=new che,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=yo(t)?Yi.WEBGL2:Yi.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new Zvt(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new che,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new iYe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new kvt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(ni.ARRAY_BUFFER),this.unbindBuffer(ni.ELEMENT_ARRAY_BUFFER),yo(this.gl)&&(this.unbindBuffer(ni.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ni.PIXEL_PACK_BUFFER),this.unbindBuffer(ni.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ni.COPY_READ_BUFFER),this.unbindBuffer(ni.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Bu()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=Jl.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===Jl.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=Jl.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(t7+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&Sr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&Sr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&Sr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(Bu()&&(this._numOfDrawCalls++,this._numOfTriangles+=mhe(t,r)),this.gl.drawArrays(t,i,r),Bu()){const s=Yse(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){if(Bu()&&(this._numOfDrawCalls++,this._numOfTriangles+=mhe(t,i)),this.gl.drawElements(t,i,r,s),Bu()){const a=Yse(this);if(a){var n;const l=this.getBoundVAO(),p=l==null?void 0:l.indexBuffer,y={indexBuffer:p,vertexBuffers:l==null?void 0:l.vertexBuffers},b={mode:t,count:i,type:r,offset:s},x=(n=Da(p,P=>P.size))!=null?n:0,A=s+i,M=x<A?`. Buffer is too small. Attempted to draw index ${A} of ${x}`:"";console.error(`drawElements: ${a}${M}`,{args:b,vao:y})}}}logIno(){Bu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return J(t)||t.glName==null?(L(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTextureAllUnits(t){for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(J(t))return this.gl.bindFramebuffer(uo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(uo.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===uo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(J(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=Wt(t,null):this._state.drawFramebuffer=Wt(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,a=t.height,l=0,p=0,y=i.width,b=i.height,x=Sr.COLOR_BUFFER_BIT,A=Pt.NEAREST){this.bindFramebufferSeparate(t,uo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,uo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,a,l,p,y,b,x,A)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case ni.ARRAY_BUFFER:this._state.vertexBuffer=vc(this.gl,t,i,this._state.vertexBuffer);break;case ni.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=vc(this.gl,t,i,this._state.indexBuffer);break;case ni.UNIFORM_BUFFER:this._state.uniformBuffer=vc(this.gl,t,i,this._state.uniformBuffer);break;case ni.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=vc(this.gl,t,i,this._state.pixelPackBuffer);break;case ni.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=vc(this.gl,t,i,this._state.pixelUnpackBuffer);break;case ni.COPY_READ_BUFFER:this._state.copyReadBuffer=vc(this.gl,t,i,this._state.copyReadBuffer);break;case ni.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=vc(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return J(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);J(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const a=this._getBufferBinding(t,i);if(!J(a)&&!(a.buffer===r&&a.offset===s&&a.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),a.buffer=r,a.offset=s,a.size=n}}bindUBO(t,i,r,s){J(i)?this.bindBufferBase(ni.UNIFORM_BUFFER,t,null):(Bu()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(ni.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(ni.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];L(s)&&s.buffer===t.buffer&&this.bindBufferBase(ni.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case ni.ARRAY_BUFFER:this._state.vertexBuffer=vc(this.gl,null,t,this._state.vertexBuffer);break;case ni.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=vc(this.gl,null,t,this._state.indexBuffer);break;case ni.UNIFORM_BUFFER:this._state.uniformBuffer=vc(this.gl,null,t,this._state.uniformBuffer);break;case ni.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=vc(this.gl,null,t,this._state.pixelPackBuffer);break;case ni.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=vc(this.gl,null,t,this._state.pixelUnpackBuffer);break;case ni.COPY_READ_BUFFER:this._state.copyReadBuffer=vc(this.gl,null,t,this._state.copyReadBuffer);break;case ni.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=vc(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){J(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i={};this.instanceCounter.increment(so.Sync,i);const r=this.gl,s=r.fenceSync(VV.SYNC_GPU_COMMANDS_COMPLETE,0);let n;r.flush();do await jT(t),n=r.clientWaitSync(s,0,0);while(n===q6.TIMEOUT_EXPIRED);if(r.deleteSync(s),this.instanceCounter.decrement(so.Sync,i),n===q6.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=uo.FRAMEBUFFER){return t===uo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(ni.ARRAY_BUFFER),this.unbindBuffer(ni.ELEMENT_ARRAY_BUFFER),yo(this.gl)&&(this.unbindBuffer(ni.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ni.PIXEL_PACK_BUFFER),this.unbindBuffer(ni.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ni.COPY_READ_BUFFER),this.unbindBuffer(ni.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(ht.ONE,ht.ZERO),this.setBlendEquation(f0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Jl.BACK),this.setFrontFace(vS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(kr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(kr.ALWAYS,0,0),this.setStencilOp(Gr.KEEP,Gr.KEEP,Gr.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var t,i;const r=this.gl,s=this.capabilities.vao;s&&s.bindVertexArray(null);for(let y=0;y<this.parameters.maxVertexAttributes;y++)r.disableVertexAttribArray(y);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(ni.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(ni.ELEMENT_ARRAY_BUFFER,null),yo(r)){var n,a;this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(ni.UNIFORM_BUFFER,null);for(let y=0;y<this._parameters.maxUniformBufferBindings;y++){const b=this._state.uniformBufferBindingPoints[y];if(L(b)&&b.buffer!==null){const{buffer:x,offset:A,size:M}=b;A===0&&M===0?r.bindBufferBase(ni.UNIFORM_BUFFER,y,x.glName):r.bindBufferRange(ni.UNIFORM_BUFFER,y,x.glName,A,M)}else r.bindBufferBase(ni.UNIFORM_BUFFER,y,null)}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(ni.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(ni.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(ni.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(ni.COPY_WRITE_BUFFER,null),r.bindFramebuffer(uo.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(uo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Mh.COLOR_ATTACHMENT0)),r.bindFramebuffer(uo.DRAW_FRAMEBUFFER,(n=(a=this._state.drawFramebuffer)==null?void 0:a.glName)!=null?n:null)}else{var l,p;this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(uo.FRAMEBUFFER,(l=(p=this._state.drawFramebuffer)==null?void 0:p.glName)!=null?l:null)}if(s&&this._state.vertexArrayObject){const y=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(y)}r.useProgram((t=(i=this._state.program)==null?void 0:i.glName)!=null?t:null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let y=0;y<this.parameters.maxTextureImageUnits;y++){r.activeTexture(t7+y),r.bindTexture(Yt.TEXTURE_2D,null),r.bindTexture(Yt.TEXTURE_CUBE_MAP,null),yo(r)&&(r.bindTexture(Yt.TEXTURE_3D,null),r.bindTexture(Yt.TEXTURE_2D_ARRAY,null));const b=this._state.textureUnitMap[y];L(b)&&r.bindTexture(b.descriptor.target,b.glName)}r.activeTexture(t7+this._state.activeTexture),r.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),Bu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}_loadExtensions(){this.type===Yi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var i;const r=this.capabilities.textureFilterAnisotropic,s=(i=t.maxAnisotropy)!=null?i:1/0,n=yo(this.gl),a=this.gl,l={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),s):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?a.getParameter(a.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?a.getParameter(a.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?a.getParameter(a.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?a.getParameter(a.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?a.getParameter(a.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?a.getParameter(a.MAX_SAMPLES):1};return Vt.TEXTURE_UNIT_FOR_UPDATES=l.maxTextureImageUnits-1,l}}function vc(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function mhe(e,t){switch(e){case mi.POINTS:return 2*t;case mi.TRIANGLES:return t/3;case mi.TRIANGLE_STRIP:case mi.TRIANGLE_FAN:return t-2;default:return 0}}class Qvt extends Kvt{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}useTechnique(t,i=null,r){return this.useProgram(t.program),t.bindPipelineState(this,i,r),t.program}isTechniqueCompiled(t){return t.program.isCompiled}get test(){return this.programCache.test}}const GTe=Ge.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let P3=class extends st{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ps,this._frameTask=e.resourceController.scheduler.registerTask(ii.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Vp.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return J(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(_4,new yZ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Wt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",An.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(J(t))return Kt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new e_t(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),L(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=l=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,l),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),a=l=>(this._loadingCount--,r.loadingPromise=null,Cs(l)||GTe.error(l),null);return au(s)?s.then(n,a):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",An.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};_([S()],P3.prototype,"_loadingCount",void 0),_([S()],P3.prototype,"_frameTask",void 0),_([S()],P3.prototype,"updating",null),P3=_([re("esri.views.3d.webgl-engine.lib.TextureRepository")],P3);class e_t{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(GTe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const t_t=Ge.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let oM=class extends st{constructor(){super(...arguments),this._data=new Array,this.loadingState=Gl.NOT_LOADED}dispose(){this.loadingState=Gl.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this.loadingState===Gl.LOADING}get ready(){return this.loadingState===Gl.LOADED}loadTextures(e){const t=[hr("esri/images/materials/water/normals.jpg"),hr("esri/images/materials/water/perturbation.jpg")];this.loadingState=Gl.LOADING,Promise.all(t.map(i=>yd(i))).then(i=>{i.forEach(r=>this._data.push(new Vt(e,{target:Yt.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:ai.UNSIGNED_BYTE,wrapMode:ei.REPEAT,samplingMode:Pt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this.loadingState=Gl.LOADED}).catch(i=>{t_t.error("Failed to load textures for water material.",i),this.loadingState=Gl.NOT_LOADED})}bind(e){this.ready&&(e.bindTexture(this._data[0],"texWaveNormal"),e.bindTexture(this._data[1],"texWavePerturbation"))}};_([S()],oM.prototype,"loadingState",void 0),_([S({type:Boolean,readOnly:!0})],oM.prototype,"updating",null),oM=_([re("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],oM);class i_t extends h8{constructor(t,i,r,s,n,a){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=a,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(An.BACKGROUND);const i=bg();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=qe(ie({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._ensureScreenshotEncodeCanvas(),n=this._renderScreenshot(t,r),a=Qat(n,r,s,{flipY:!0,premultipliedAlpha:!0});i.resolver(a)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(J(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:a}=t,l=this._ensureScreenshotEncodeCanvas();let p=sU(r,s,l);this._rctx.gl.readPixels(0,0,r,s,_t.RGBA,Zt.UNSIGNED_BYTE,new Uint8Array(p.data.buffer)),i(),p=this._renderScreenshotOverlay(l,p,qe(ie({},t),{region:null}));const y=sU(n.width,n.height,l);return ilt(p,y,!0,a.region.x,s-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),a=sU(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,_t.RGBA,Zt.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),i(),this._renderScreenshotOverlay(n,a,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:a}=i;let l=!1;const p=i.disableDecorations&&t.frameHasDecorations,y=n!==s.fullWidth||a!==s.fullHeight,b=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,x=y||p||b;if(x){const P=s.clone();if(i.ignorePadding){const z=rN(P.padding);for(let G=0;G<4;G++)z[G]=Math.round(z[G]/P.pixelRatio*i.pixelRatio);P.padding=z}P.fullWidth=n,P.fullHeight=a,P.pixelRatio=i.pixelRatio;const $=s.fovX-P.fovX,k=s.fovY-P.fovY;$<0&&$<k?P.fovX=s.fovX:k<0&&k<$&&(P.fovY=s.fovY),this._forceCameraHook(P),l=!0,r=new Hr(this._rctx,{width:P.fullWidth,height:P.fullHeight,colorTarget:ks.TEXTURE,depthStencilTarget:Qi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,P,i.disableDecorations?tw.OFF:tw.ON),this._disposeOffscreenBuffers()}const A=()=>{this._rctx.bindFramebuffer(null),Xt(r)},M=this._readbackScreenshot(i,A);if(A(),x&&!this._rctx.contextAttributes.alpha)for(let P=3;P<M.data.length;P+=4)M.data[P]=255;return l&&this._forceCameraHook(s),M}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const ghe=Ge.getLogger("esri.views.3d.webgl-engine.parts.View");let ea=class extends c8(st){constructor(e){super({}),this.events=new ps,this.waterTextureRepository=new oM,this._magnifierHelper=new O3,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._initializeContext(e),Pi(this.waterTextureRepository,"loadingState",()=>this.requestRender()),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new gxe(this._rctx),this._shaderTechniqueRepository=new Vwe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new P3(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new exe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Qgt(this._rctx,this._shaderTechniqueRepository),this._renderer=new Dm(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new i_t(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=_o(this._frameTask),this._shaderTechniqueRepository=Xt(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=An.UPDATE){e===An.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}get hasShadowsEnabled(){return this._renderer.hasShadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}getMinimalDepthForArea(e,t,i,r,s,n=s){const a=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),l=this._ensureDepthBuffer(a);this._renderer.readDepthPixels(r,a[0],a[1],a[2],a[3],l);let p=Number.MAX_VALUE;for(let y=0;y<a[2]*a[3];y++){const b=s1t(4*y,l,r.nearFar);p>b&&b!==r.nearFar[0]&&b!==r.nearFar[1]&&(p=b)}if(L(e)){const y=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);L(y)&&p>y&&y!==r.nearFar[0]&&y!==r.nearFar[1]&&(p=y)}return p===Number.MAX_VALUE?void 0:p}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(J(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){H3e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=An.BACKGROUND,n=!1;const a={preRender:l=>{r=this.updating,s=this._needsUpdate?An.UPDATE:An.BACKGROUND,e.processSyncLayers();const p=l.time-this._lastAnimationUpdate;(p>this.animationTimestep||L(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:p,forcedTime:this.forcedAnimationTime})&&this.requestRender(An.BACKGROUND),this._lastAnimationUpdate=l.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,tw.ON),n=!0,l&&this._renderer.hasWaterReflection&&(this.requestRender(An.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=L2(a)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance"},r=S8e("3d",this._canvas,i);if(J(r)){const s=je("esri-force-webgl");ghe.error(s)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&ghe.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&je("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new Qvt(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return J(this._componentObjectCollection)&&(this._componentObjectCollection=new Zgt(this._renderer.renderPassManager)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};_([S({type:Boolean,readOnly:!0})],ea.prototype,"updating",null),_([ra()],ea.prototype,"_rctx",void 0),_([ra()],ea.prototype,"_container",void 0),_([ra()],ea.prototype,"_canvas",void 0),_([ra()],ea.prototype,"_stippleTextureRepository",void 0),_([ra(),S()],ea.prototype,"waterTextureRepository",void 0),_([ra(),S()],ea.prototype,"_magnifierHelper",void 0),_([ra(),S()],ea.prototype,"_textureRepository",void 0),_([ra()],ea.prototype,"_compositingHelper",void 0),_([ra()],ea.prototype,"_renderer",void 0),_([ra()],ea.prototype,"_screenshotManager",void 0),_([ra()],ea.prototype,"componentObjectCollection",null),_([ra()],ea.prototype,"_componentObjectCollection",void 0),_([S()],ea.prototype,"_needsUpdate",void 0),_([S()],ea.prototype,"_needsWaterReflectionUpdate",void 0),ea=_([re("esri.views.3d.webgl-engine.parts.RenderView")],ea);var R$;let Ll=R$=class extends c8(st){constructor(e){super(e),this._handles=new Ei,this._model=new S$,this._layers=new Ci,this._changeSet=new Gwe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ea(this)),this._frameTask=this.resourceController.scheduler.registerTask(ii.STAGE,this),this._handles.add(this._frameTask)}destroy(){dw.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),BD(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){J(e)||(this.renderView.requestRender(),this._model.remove(e),BD(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){L(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){L(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){J(e)||(Array.isArray(e)||(e=[e]),await eR(e.filter(t=>J(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;R$.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),R$.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===OS.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.some(t=>t===e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{wle(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(au(r))return r.then(s);s()}removeRenderPlugin(e){wle(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};Ll.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},_([S({constructOnly:!0})],Ll.prototype,"resourceController",void 0),_([S({constructOnly:!0})],Ll.prototype,"options",void 0),_([S({constructOnly:!0})],Ll.prototype,"state",void 0),_([S({constructOnly:!0})],Ll.prototype,"sceneIntersectionHelper",void 0),_([S({readOnly:!0})],Ll.prototype,"viewingMode",null),_([S({constructOnly:!0})],Ll.prototype,"container",void 0),_([S({constructOnly:!0})],Ll.prototype,"renderSR",void 0),_([S({constructOnly:!0})],Ll.prototype,"_handles",void 0),_([S({readOnly:!0})],Ll.prototype,"updating",null),_([S({constructOnly:!0})],Ll.prototype,"_model",void 0),_([ra(),S()],Ll.prototype,"renderView",void 0),Ll=R$=_([re("esri.views.3d.webgl-engine.Stage")],Ll);function jTe(e){return $0(e)&&e.intersector===Ts.PCL&&!!e.target}function HTe(e){return $0(e)&&e.intersector===Ts.I3S&&!!e.target}function r_t(e){return $0(e)&&e.intersector===Ts.TERRAIN&&!!e.target}function qTe(e){return $0(e)&&e.intersector===Ts.OVERLAY&&!!e.target}function s_t(e){return $0(e)&&e.intersector===Ts.LOD&&!!e.target}function yhe(e,t){return wbe(e)||wJ(e)?cL(e.target.object.metadata,t):r_t(e)?(i=t.map)==null?void 0:i.ground:jTe(e)||HTe(e)||qTe(e)?cL(e.target,t):null;var i}function vhe(e,t){return wbe(e)||wJ(e)?_he(e.target.object.metadata,t):jTe(e)?e.target.createGraphic():qTe(e)||s_t(e)?_he(e.target,t):HTe(e)?n_t(e.target,t):null}function _he(e,t){if(J(e)||J(e.graphicUid))return null;const i=cL(e,t);if(J(i))return null;if(i===t.graphics)return L(t.graphicsView)?t.graphicsView.getGraphicFromGraphicUid(e.graphicUid):null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromGraphicUid"in r&&L(e.graphicUid)?r.getGraphicFromGraphicUid(e.graphicUid):null}function n_t(e,t){const i=cL(e,t);if(J(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?r.getGraphicFromIntersectorTarget(e):null}function cL(e,t){return J(e.layerUid)?null:L(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}async function o_t(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t),r=i.results[0],s=i.results.findIndex(n=>n.distance!==r.distance);return s!==-1&&(i.results=i.results.slice(0,s)),i}let iz,rz;function bhe(e){switch(e){case Yi.WEBGL1:return a_t();case Yi.WEBGL2:return l_t()}}function a_t(){return iz||(iz=u_t()),iz}function l_t(){return rz||(rz=d_t()),rz}class WTe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1}}class c_t extends WTe{constructor(){super(...arguments),this.type=Yi.WEBGL1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1}}class h_t extends WTe{constructor(){super(...arguments),this.type=Yi.WEBGL2}}function XTe(e,t){if(e===Yi.WEBGL1&&typeof WebGLRenderingContext===void 0||e===Yi.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=H6(i,e,{failIfMajorPerformanceCaveat:!0});if(J(r)&&(r=H6(i,e),L(r)&&(t.majorPerformanceCaveat=!0)),J(r))return r;if(e===Yi.WEBGL1){const n=r.getParameter(r.VERSION),a=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(a){const l=parseFloat(a[1]);t.available=l>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function u_t(){const e=new c_t,t=XTe(Yi.WEBGL1,e);return J(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null),e}function d_t(){const e=new h_t,t=XTe(Yi.WEBGL2,e);return J(t),e}function p_t(e){const t=f_t(e);if(!t.available)return new Se("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new Se("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new Se("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new Se("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===Yi.WEBGL1){if(!t.supportsElementIndexUint)return new Se("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new Se("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new Se("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function f_t(e){const t=bge(e);for(;t.length>1;){const i=bhe(t.shift());if(i.available)return i}return bhe(t.shift())}function m_t(e){return e&&"nodeType"in e}function g_t(e){return e&&typeof e.render=="function"}const whe={component:"esri-component"};let Pb=class extends st{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(whe.component),t&&t.classList.remove(whe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||m_t(e)?(this._set("widget",null),OL(e)):(g_t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};_([S({dependsOn:[]})],Pb.prototype,"id",null),_([S()],Pb.prototype,"node",null),_([_i("node")],Pb.prototype,"castNode",null),_([S({readOnly:!0})],Pb.prototype,"widget",void 0),Pb=_([re("esri.views.ui.Component")],Pb);const O$=Pb,y_t={left:0,top:0,bottom:0,right:0},YTe={bottom:30,top:15,right:15,left:15},sz="manual",Rl={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function v_t(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function nz(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function oz(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let Lm=class extends ps.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Ei,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&oz(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&oz(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([vi(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,No),vi(()=>this.padding,this._applyUIPadding,No)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Rl.ui),e.classList.add($5e()),this._attachContainers(e)),t&&(t.classList.remove(Rl.ui),oz(t,{top:"",bottom:"",left:"",right:""}),Rpe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:ie(ie({},YTe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=nz(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||sz)===sz?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Rl.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=nz(e)||nz(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof O$||(e=new O$({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof O$?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||y_t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Rl.innerContainer),e.classList.add(Rl.cornerContainer);const t=document.createElement("div");t.classList.add(Rl.innerContainer),t.classList.add(Rl.manualContainer);const i=document.createElement("div");i.classList.add(Rl.topLeft),i.classList.add(Rl.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(Rl.topRight),r.classList.add(Rl.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Rl.bottomLeft),s.classList.add(Rl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Rl.bottomRight),n.classList.add(Rl.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const a=Uy();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":a?r:i,"top-trailing":a?i:r,"bottom-leading":a?n:s,"bottom-trailing":a?s:n},this._positionNameToContainerLookup=ie({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||sz,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(v_t(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const a=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?vee(t.node,s.firstChild):s.appendChild(t.node));r>=a.length?s.appendChild(t.node):vee(t.node,a[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};_([S()],Lm.prototype,"container",null),_([S()],Lm.prototype,"height",null),_([S({value:YTe})],Lm.prototype,"padding",null),_([_i("padding")],Lm.prototype,"castPadding",null),_([S()],Lm.prototype,"view",void 0),_([S()],Lm.prototype,"width",null),Lm=_([re("esri.views.ui.UI")],Lm);const __t=Lm;function xhe(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function b_t(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function CI(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function w_t(e){return e.type==="bing-maps"}const D1=[];let I3=class extends xv{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new kt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>r.watch(["suspended","attributionVisible"],this._updateAttributionItems)),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this._updateAttributionItems=()=>{const t=this.get("view.allLayerViews");D1.length=0,t?(t.forEach(i=>{if(i.suspended||!i.get("layer.attributionVisible"))return;const r=i.layer;if(xhe(r,"user"))return void CI(D1,i,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(i)){const n=this._fetchedAttributionData.get(i);return void(n?CI(D1,i,this._getDynamicAttribution(n,this.view,r)):xhe(r)&&CI(D1,i,r.copyright))}return void this._fetchAttributionData(i)}const s=r.get("portalItem.accessInformation");CI(D1,i,s||r.copyright)}),b_t(this.items,D1)&&(this.items.removeAll(),this.items.addMany(D1)),D1.length=0,this.notifyChange("state")):this._clear()},this.handles.add([m0(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this._clear),N8e(this,"view.stationary",()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await nh(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,w_t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],a=n.coverageAreas;if(!a)return;for(const l of a){const p=l.bbox,y=l.zoomMin-(t&&l.zoomMin?1:0),b=l.zoomMax-(t&&l.zoomMax?1:0),x={xmin:p[1],ymin:p[0],xmax:p[3],ymax:p[2],spatialReference:It.WGS84},A={extent:e0(x),attribution:n.attribution||"",score:l.score!=null?l.score:100,id:s};for(let M=y;M<=b;M++)r[M]=r[M]||[],r[M].push(A)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const a=e[n],l=Tw(r.center.clone().normalize(),t.spatialReference),p={};return a?a.filter(y=>{const b=!p[y.id]&&l&&LO(y.extent,l);return b&&(p[y.id]=!0),b}).sort((y,b)=>b.score-y.score||y.objectId-b.objectId).map(y=>y.attribution).join(", "):""}};_([S({readOnly:!0,type:kt})],I3.prototype,"items",void 0),_([S({readOnly:!0})],I3.prototype,"state",null),_([S()],I3.prototype,"view",void 0),I3=_([re("esri.widgets.Attribution.AttributionViewModel")],I3);const JTe=I3,L1={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Nl=class extends cc{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass=L1.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new JTe}initialize(){this.own(m0(this,"viewModel.items","change",()=>this.scheduleRender()))}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.indexOf(t.text)===-1&&e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[L1.open]:this._isOpen};return Ve("div",{bind:this,class:this.classes(L1.base,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Ve("div",{class:L1.poweredBy},"Powered by"," ",Ve("a",{class:L1.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?0:-1,{attributionText:r}=this,s=t?"button":void 0,n={[L1.sourcesOpen]:e,[L1.interactive]:t};return Ve("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes(L1.sources,n),innerHTML:r,role:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth}_afterSourcesNodeUpdate(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>=r,a=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,a&&(t=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};_([S()],Nl.prototype,"_isOpen",void 0),_([S()],Nl.prototype,"_isInteractive",null),_([S()],Nl.prototype,"_attributionTextOverflowed",void 0),_([S()],Nl.prototype,"_prevSourceNodeHeight",void 0),_([S({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Nl.prototype,"attributionText",null),_([S()],Nl.prototype,"iconClass",void 0),_([S()],Nl.prototype,"itemDelimiter",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nl.prototype,"label",void 0),_([S(),Zc("esri/widgets/Attribution/t9n/Attribution")],Nl.prototype,"messages",void 0),_([oi("viewModel.view")],Nl.prototype,"view",void 0),_([S({type:JTe})],Nl.prototype,"viewModel",void 0),_([zu()],Nl.prototype,"_toggleState",null),Nl=_([re("esri.widgets.Attribution")],Nl);const x_t=Nl,T_t="esri.widgets.CompassViewModel";let Ib=class extends Ive(st){constructor(e){super(e),this._handles=new Ei,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(Pi(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&(e.type==="2d"?this._handles.add(Pi(this,"view.rotation",this._updateForRotation)):this._handles.add(Pi(this,"view.camera",this._updateForCamera)))}};_([S({readOnly:!0})],Ib.prototype,"canShowNorth",null),_([S()],Ib.prototype,"orientation",void 0),_([S({readOnly:!0})],Ib.prototype,"state",null),_([S()],Ib.prototype,"view",void 0),Ib=_([re(T_t)],Ib);const ZTe=Ib,N1={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Nf=class extends cc{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=N1.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ZTe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[N1.disabled]:i,[N1.interactive]:!i},a={[N1.northIcon]:r,[N1.rotationIcon]:!r},{messages:l}=this;return Ve("div",{bind:this,class:this.classes(N1.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},Ve("span",{"aria-hidden":"true",class:this.classes(N1.icon,a),styles:this._toRotationTransform(e)}),Ve("span",{class:N1.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};_([oi("viewModel.goToOverride")],Nf.prototype,"goToOverride",void 0),_([S()],Nf.prototype,"iconClass",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nf.prototype,"label",void 0),_([S(),Zc("esri/widgets/Compass/t9n/Compass")],Nf.prototype,"messages",void 0),_([oi("viewModel.view")],Nf.prototype,"view",void 0),_([S({type:ZTe})],Nf.prototype,"viewModel",void 0),_([zu()],Nf.prototype,"_reset",null),Nf=_([re("esri.widgets.Compass")],Nf);const S_t=Nf;let $3=class extends st{constructor(e){super(e),this._handles=new Ei,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(BX(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};_([S({readOnly:!0})],$3.prototype,"state",null),_([S()],$3.prototype,"navigationMode",void 0),_([S()],$3.prototype,"view",void 0),$3=_([re("esri.widgets.NavigationToggleViewModel")],$3);const KTe=$3,xu={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Ff=class extends cc{constructor(e,t){super(e,t),this.iconClass=xu.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new KTe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[xu.disabled]:e,[xu.isLayoutHorizontal]:this.layout==="horizontal"},r={[xu.activeButton]:t},s={[xu.activeButton]:!t},n=e?-1:0,a=this.messages.toggle;return Ve("div",{bind:this,class:this.classes(xu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":a,title:a},Ve("div",{class:this.classes(xu.button,xu.panButton,r)},Ve("span",{class:xu.panIcon})),Ve("div",{class:this.classes(xu.button,xu.rotateButton,s)},Ve("span",{class:xu.rotationIcon})))}_toggle(){this.toggle()}};_([S()],Ff.prototype,"iconClass",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ff.prototype,"label",void 0),_([S({value:"vertical"})],Ff.prototype,"layout",null),_([S(),Zc("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Ff.prototype,"messages",void 0),_([oi("viewModel.view")],Ff.prototype,"view",void 0),_([S({type:KTe})],Ff.prototype,"viewModel",void 0),_([zu()],Ff.prototype,"_toggle",null),Ff=_([re("esri.widgets.NavigationToggle")],Ff);const E_t=Ff,HA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let py=class extends cc{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[HA.disabled]:!this.enabled,[HA.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return Ve("div",{bind:this,class:this.classes(HA.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Ve("span",{"aria-hidden":"true",role:"presentation",class:this.classes(HA.icon,i)}),Ve("span",{class:HA.iconText},this.title))}_triggerAction(){this.action.call(this)}};_([S()],py.prototype,"action",void 0),_([S()],py.prototype,"enabled",void 0),_([S()],py.prototype,"iconClass",void 0),_([S()],py.prototype,"title",void 0),_([zu()],py.prototype,"_triggerAction",null),py=_([re("esri.widgets.IconButton")],py);const The=py;let D3=class extends st{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};_([S({readOnly:!0})],D3.prototype,"canZoomIn",null),_([S({readOnly:!0})],D3.prototype,"canZoomOut",null),_([S()],D3.prototype,"view",void 0),D3=_([re("esri.widgets.Zoom.ZoomConditions2D")],D3);const A_t=D3;let L3=class extends st{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};_([S({readOnly:!0})],L3.prototype,"canZoomIn",null),_([S({readOnly:!0})],L3.prototype,"canZoomOut",null),_([S()],L3.prototype,"view",void 0),L3=_([re("esri.widgets.Zoom.ZoomConditions3D")],L3);const C_t=L3;let fy=class extends st{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new A_t({view:e}):e.type==="3d"&&(this._zoomConditions=new C_t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():vz(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():vz(e.goTo({zoomFactor:.5}))}};_([S()],fy.prototype,"_zoomConditions",void 0),_([S({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],fy.prototype,"canZoomIn",void 0),_([S({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],fy.prototype,"canZoomOut",void 0),_([S({readOnly:!0})],fy.prototype,"state",null),_([S()],fy.prototype,"view",null),fy=_([re("esri.widgets.Zoom.ZoomViewModel")],fy);const QTe=fy,qA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Nm=class extends cc{constructor(e,t){super(e,t),this.iconClass=qA.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new QTe}initialize(){this._zoomInButton=new The({action:this.zoomIn.bind(this),iconClass:qA.zoomInIcon}),this._zoomOutButton=new The({action:this.zoomOut.bind(this),iconClass:qA.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[qA.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,Ve("div",{class:this.classes(qA.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};_([S()],Nm.prototype,"iconClass",void 0),_([S({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nm.prototype,"label",void 0),_([S({value:"vertical"})],Nm.prototype,"layout",null),_([S(),Zc("esri/widgets/Zoom/t9n/Zoom")],Nm.prototype,"messages",void 0),_([oi("viewModel.view")],Nm.prototype,"view",void 0),_([S({type:QTe})],Nm.prototype,"viewModel",void 0),Nm=_([re("esri.widgets.Zoom")],Nm);const M_t=Nm,eSe="esri.views.ui.DefaultUI";function R_t(e){return e&&e.view!==void 0}Ge.getLogger(eSe);let P$=class extends __t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([vi(()=>this.components,this._componentsWatcher.bind(this),No),vi(()=>this.view,this._updateViewAwareWidgets.bind(this),No)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;R_t(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(e.indexOf("attribution")===-1&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new O$({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new x_t({view:this.view})}_createCompass(){return new S_t({view:this.view})}_createNavigationToggle(){return new E_t({view:this.view})}_createZoom(){return new M_t({view:this.view})}};_([S()],P$.prototype,"components",void 0),P$=_([re(eSe)],P$);const O_t=P$;let I$=class extends O_t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};_([S()],I$.prototype,"components",void 0),I$=_([re("esri.views.ui.3d.DefaultUI3D")],I$);const tSe=I$,yh=Ge.getLogger("esri.views.SceneView");let jt=class extends $8e(Rqe(jqe(zWe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new zv({slicePlane:rge},this),this._resourceController=Cpt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new _H({view:this}),this.labeler=new Eb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new _S,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new u_e,this.environmentManager=new Qd,this.extent=null,this.floors=new kt,this.windowDevicePixelRatio=1,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new GWe({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new vdt,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new tSe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new kH,HDe(),e&&e.environment||(this._defaults.environment=new T3,this.environment=this._defaults.environment);const t=(r=null)=>{L(r)&&r.type===Rr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async s=>{try{await s.when()}catch{}this._updatingChanged()}))};this.handles.add([av(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),this.watch("map",r=>{r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new itt({view:this});const i=()=>{const r=window.devicePixelRatio;r!==this.windowDevicePixelRatio&&(this.windowDevicePixelRatio=r,this.notifyChange("pixelRatio"))};this.stateManager=new qdt({view:this,updateDevicePixelRatio:i})}initialize(){this.groundView=new Gqe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(av(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},No),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},No),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>xMe(t>0?1e3/Math.ceil(t):0),No),this.updatingHandles.add(()=>ur.SCENEVIEW_LOCKING_LOG,t=>this.defaultsFromMap.logDebugInformation=t,No),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Oa),this.updatingHandles.add(()=>{var t,i;return(t=this.map)==null||(i=t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Oa),this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ht(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=Ht(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=Ht(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||J(e)?(this._clippingArea=null,null):e instanceof ki?this.spatialReference&&(e=MI(e,this.spatialReference),J(e))?(yh.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),J(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(yh.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&L(e)?yh.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===vt.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return J(t)||J(e)||t.spatialReference.equals(e)?t:MI(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||It.WGS84,i=MI(this.clippingArea,t);L(i)&&(e=L(e)?e.intersection(i):i);const r=this._get("dataExtent");return L(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||It.WGS84;let t;const i=n=>{const a=MI(n,e);J(a)||(L(t)?t.union(a):t=a.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new ki({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=a=>{!L(a.fullExtent)||a.type==="graphics"&&a.internal||i(a.fullExtent)};this.map.allLayers.forEach(a=>n(a))}if(J(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof T3?e:e instanceof MS?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):T3.fromWebsceneEnvironment(e):Ys(T3,e):new T3}get pixelRatio(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)}set pixelRatio(e){L(e)?this._override("pixelRatio",e):this._clearOverride("pixelRatio")}get maximumPixelRatio(){let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.width,this.height);e=Math.min(e,r)}return e}set maximumPixelRatio(e){L(e)?this._override("maximumPixelRatio",e):this._clearOverride("maximumPixelRatio")}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||L(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(J(this.state)||this.state.stationary)}set qualityProfile(e){v$.isValidProfile(e)&&(v$.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||v$.getDefaultProfile()}set slicePlane(e){if(L(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),J(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");yE(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?_ge(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?jv.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var e,t,i;if(this.destroyed)return!1;let r=0,s=this.layerViewManager.updating,n=s?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(s=!0,a.suspended||$T(a))return;++n,r+=a.updatingProgress}}else++n});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])L(a)&&a.updating&&(n+=.1,r+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])L(a)&&a.updating&&(++n,r+=a.updatingProgress);if(s=!!(s||n>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||(e=this.inputManager)!=null&&e.hasPendingInputs||(t=this.map)!=null&&(i=t.allLayers)!=null&&i.some(a=>!a.isFulfilled())),s?(this._numUpdating=Math.max(n,this._numUpdating),r+=this._numUpdating-n):this._numUpdating=0,this._numUpdating>0?r/=this._numUpdating:r=s?0:1,this._get("updatingProgress")!==r){const a=this._resourceController.scheduler.now;if(r<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);r=this.updatingProgress*(1-l)+r*l}this._set("updatingProgress",r),this._lastUpdateTime=s&&r<1?a:0}return s}get viewingMode(){var e;const t=this._predeterminedViewingMode;if(L(t))return IM(t);const i=this.spatialReference;return i?L((e=this.defaultsFromMap)==null?void 0:e.viewingMode)&&i.equals(this.defaultsFromMap.spatialReference)?IM(this.defaultsFromMap.viewingMode):GS(i,vt.Global)?"global":"local":"global"}set viewingMode(e){this.ready?yh.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new Kpt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return yh.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=L(i.graphics)&&(L(i.graphics.include)||L(i.graphics.exclude)),s=Ise(e)?Pse(this,e):e,n=Ym(s);i.enableDraped=i.include&&!i.include.has(Yb)||i.exclude&&i.exclude.has(Yb);const a=this.sceneIntersectionHelper,l=_d(this.state.viewingMode);if(l.options.selectionMode=!0,l.options.store=r?ma.ALL:ma.MIN,a.intersectIntersectorScreen(n,l,i),r){for(const p of l.results.all){const y=vhe(p,this);if(J(y))return this._intersectResultToMapPoint(p);if(this._testGraphicUidFilter(i.graphics,y))return this._intersectResultToMapPoint(p)}return null}return this._intersectResultToMapPoint(l.results.min)}toScreen(e){if(!this.ready)return yh.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Wt(e.z==null&&wp(this.elevationProvider,e),0);return To(e,Fx,this.renderSpatialReference,t),this.state.camera.projectToScreen(Fx,az),dd(az[0],az[1])}pixelSizeAt(e){return this.ready?e?(To(e,Fx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Fx)):0:(yh.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return yh.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Ise(e)?Pse(this,e):e,r=Ns(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=_d(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=ma.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const a=this._intersectResultsToHits(n.results.all,s.graphics),l=n.results.ground,p=yhe(l,this),y=L(p)&&"type"in p&&p.type==="integrated-mesh"?p:null,b={screenPoint:i,results:a,ground:{mapPoint:this._intersectResultToMapPoint(l),distance:$0(l)?l.distanceInRenderSpace:0,layer:y}};return ur.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(b.intersector=n),Promise.resolve(b)}popupHitTest(e){return o_t(this,e).then(({results:t,ground:i})=>{let r=null;return!(t.length===0||Math.abs(Wt(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}})}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(await this.whenReady(),J(e.parent))throw new Se("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="analysis"?(await this.whenLayerView(e.parent)).whenAnalysisView(e):this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}takeScreenshot(e){return this.whenReady().then(()=>{const t=Kat(e,this);return t.pixelRatio/=this.pixelRatio,this._stage.renderView.takeScreenshot(rlt(t,this.supersampleScreenshotsEnabled,this.padding))})}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return zse.importLayerView(e)}hasLayerViewModule(e){return zse.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((e=this.map)==null||(t=e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=p_t(this.type);if(je("safari")&&je("safari")<9&&(e=new Se("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:je("safari")})),L(e))throw yh.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var e,t;const i=this._isOverridden("viewingMode")?this._get("viewingMode"):(e=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?e:null;return L(i)?Fse(i):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(L(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,vt.Local),s=this._validateSpatialReferenceForViewingMode(e,t,vt.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,vt.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,vt.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!GS(e,i)&&(!!J(t)||!!qte(t)||(!TM(t)||!J(k8(t,e,i)))&&(!Wte(t)||i!==vt.Global))}_makeSpatialReferenceConstraints(e,t,i){if(J(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return qte(t)&&(r||s)?!s||i===vt.Local||F8(t.tileInfo,t.fullExtent,e,vt.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:It.WebMercator,viewingMode:i}]:[{spatialReference:r?It.WGS84:It.WebMercator,viewingMode:i}]:TM(t)||Wte(t)||!r&&!s?TM(t)&&r&&i!==vt.Global?[{spatialReference:e,viewingMode:i},{spatialReference:It.WGS84,viewingMode:vt.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?It.WGS84:It.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=L(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(L(i)?yh.warnOnce(`Spatial reference defined on view not supported in ${IM(i)} viewing mode.`):e.isGeographic&&yh.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||It.WGS84;return Ho(e,this.renderSpatialReference,e,i)||(i=It.WGS84,Ho(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new Gt(e,i),t}trackGraphicState(e){if(!e.graphic)return yh.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var a;!r&&L(n)&&"processor"in n&&((a=n.processor)==null?void 0:a.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return L(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,L(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return GT(e.map(i=>this.highlight(i)));if(kt.isCollection(e))return GT(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Hp()}maskOccludee(e){if(!e)return yh.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&L(n)&&pqe(n)&&(i=n.maskOccludee(e))};return L(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,L(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){L(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await qT(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new Se("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.indexOf(e.layer)!==-1&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,ZM.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,ZM.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(Fx)?(t=this.computeMapPointFromVec3d(Fx,t),e.intersector===Ts.TERRAIN&&this.basemapTerrain&&(t.z=Wt(wp(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],a=yhe(n,this);if(L(a)&&(a===this.map.ground||"type"in a&&a.type==="integrated-mesh"))break;const l=vhe(n,this);if(!L(l))continue;if(J(r)&&s!==e.length-1&&(r=new Set),L(r)){const b=this._getGraphicFilterUid(l);if(r.has(b))continue;r.add(b)}if(!this._testGraphicUidFilter(t,l))continue;const p=this._intersectResultToMapPoint(n),y=n.distanceInRenderSpace;i.push({graphic:l,mapPoint:p,distance:y})}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return J(e)||(J(e.include)||e.include.has(i))&&(J(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof gl)P_t(i,this._getGraphicFilterUid(e)),t===ZM.INCLUDE&&(L(this.graphicsView)&&e.layer===this?WA(i,this.graphicsView.processor.layer.id):e.layer&&WA(i,e.layer.uid));else if(SDe(e))for(const r of e)r===this.graphics&&L(this.graphicsView)?WA(i,this.graphicsView.processor.layer.id):r instanceof hS?r===this.map.ground&&WA(i,Yb):this._externalToInternalRenderItems(r,t,i);else WA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new Wmt({view:this})),this._set("elevationProvider",new JC({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new k3e({view:this})),this._set("featureTiles",new x3e({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const t=this.basemapTerrain&&this.basemapTerrain.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=L(this.basemapTerrain.extent)?mE(zL(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;L(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>ur.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.18bac778.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&ur.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||ur.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},Oa),this.updatingHandles.add(()=>this.clippingArea,e,Oa),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Oa)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new upt(this.map,e));const t=this.state.isGlobal,i=yge(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",eL.create(this.state.viewingMode,i)),t||this.handles.add(this.watch("basemapTerrain.extent",r=>{const s=this.renderCoordsHelper.spatialReference;r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!tN(r,this.basemapTerrain.spatialReference,She,s)||(this.renderCoordsHelper.extent=She)},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(VS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){L(e)&&e.type===Rr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add([t.watch(["updating","updatingProgress"],()=>this._updatingChanged(),!0)],"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(l,p)=>this._renderScreenshotOverlay(l,p)}},t=new Zdt(this.state.viewingMode,l=>this._stage.layers.forAll(l),this);this._set("sceneIntersectionHelper",t);const i=OL(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new Ll({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=xO(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new Se("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),No),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),No),vi(()=>this.magnifier,l=>this._stage.renderView.magnifier=l,Oa)],"stage");const a=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:kH.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],a),"stage"),a(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(VS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new eft({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Qut})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.0e932315.js")).default;Gi(e),await qT(()=>{var i;return((i=this.basemapTerrain)==null?void 0:i.ready)===!0},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),L(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Fse(this.viewingMode);if(e===vt.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(av(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Yb);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Yb);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}getVoxelWasmPerSceneView(){return Y3.getInstance().getVoxelWasmPerSceneView(this)}};function WA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function P_t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function MI(e,t){return L(e)&&Tv(e.spatialReference,t)?mE(e,t):null}var ZM;_([S()],jt.prototype,"_userClippingArea",void 0),_([S()],jt.prototype,"_resourceController",void 0),_([S()],jt.prototype,"_stage",void 0),_([S({readOnly:!0})],jt.prototype,"deconflictor",void 0),_([S({readOnly:!0})],jt.prototype,"labeler",void 0),_([S(O6(_S,"analyses"))],jt.prototype,"analyses",void 0),_([S({type:CS,readOnly:!0,aliasOf:"state.animation"})],jt.prototype,"animation",void 0),_([S({readOnly:!0})],jt.prototype,"basemapTerrain",void 0),_([S({readOnly:!0})],jt.prototype,"elevationProvider",void 0),_([S({type:sh,aliasOf:"stateManager.camera"})],jt.prototype,"camera",void 0),_([S({type:sh,aliasOf:"stateManager.contentCamera"})],jt.prototype,"contentCamera",void 0),_([S({readOnly:!0})],jt.prototype,"canvas",void 0),_([S({type:Gt,aliasOf:"stateManager.center"})],jt.prototype,"center",void 0),_([S({type:ki})],jt.prototype,"clippingArea",null),_([S({type:u_e})],jt.prototype,"constraints",void 0),_([S({type:ki,readOnly:!0})],jt.prototype,"renderDataExtent",null),_([S({type:ki,readOnly:!0})],jt.prototype,"dataExtent",null),_([S({type:ki,readOnly:!0})],jt.prototype,"groundAndLayersExtent",null),_([S({value:null,type:T3})],jt.prototype,"environment",null),_([_i("environment")],jt.prototype,"castEnvironment",null),_([S({readOnly:!0})],jt.prototype,"environmentManager",void 0),_([S({type:ki,aliasOf:"stateManager.extent"})],jt.prototype,"extent",void 0),_([S()],jt.prototype,"floors",void 0),_([S({readOnly:!0,aliasOf:"stateManager.screenCenter"})],jt.prototype,"screenCenter",void 0),_([S({type:Number})],jt.prototype,"pixelRatio",null),_([S({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],jt.prototype,"maximumPixelRatio",null),_([S({aliasOf:"stateManager.frustum"})],jt.prototype,"frustum",void 0),_([S({type:Number,readOnly:!0})],jt.prototype,"fullOpacity",void 0),_([S({readOnly:!0})],jt.prototype,"graphicsView",void 0),_([S({readOnly:!0})],jt.prototype,"analysisViewManager",void 0),_([S()],jt.prototype,"groundView",void 0),_([S({type:Boolean})],jt.prototype,"initialExtentRequired",null),_([S()],jt.prototype,"_defaultsFromMapSettings",null),_([S({type:Boolean,readOnly:!0})],jt.prototype,"interacting",null),_([S()],jt.prototype,"stationary",null),_([S({aliasOf:"state.navigating"})],jt.prototype,"navigating",void 0),_([S()],jt.prototype,"map",void 0),_([S({readOnly:!0})],jt.prototype,"mapCoordsHelper",void 0),_([S({aliasOf:"stateManager.padding"})],jt.prototype,"padding",void 0),_([S({type:k3e,readOnly:!0})],jt.prototype,"pointsOfInterest",void 0),_([S({type:x3e,readOnly:!0})],jt.prototype,"featureTiles",void 0),_([S()],jt.prototype,"featureTreeDebugger",void 0),_([S({type:Boolean})],jt.prototype,"screenSizePerspectiveEnabled",void 0),_([S({constructOnly:!0})],jt.prototype,"deactivatedWebGLExtensions",void 0),_([S({constructOnly:!0})],jt.prototype,"debugWebGLExtensions",void 0),_([S({constructOnly:!0})],jt.prototype,"renderCanvas",void 0),_([S({constructOnly:!0})],jt.prototype,"state",void 0),_([S({readOnly:!0})],jt.prototype,"inputManager",void 0),_([S({readOnly:!0})],jt.prototype,"stateManager",void 0),_([S({type:["low","medium","high"]})],jt.prototype,"qualityProfile",null),_([S({type:Tle,get(){let e=this._get("qualitySettings");return e||(e=new Tle,v$.apply(this.qualityProfile,e)),e}})],jt.prototype,"qualitySettings",void 0),_([S()],jt.prototype,"slicePlane",null),_([S({readOnly:!0})],jt.prototype,"typeSpecificPreconditionsReady",null),_([S({readOnly:!0})],jt.prototype,"renderCoordsHelper",void 0),_([S({readOnly:!0})],jt.prototype,"sceneIntersectionHelper",void 0),_([S({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],jt.prototype,"resolution",null),_([S({type:Number,aliasOf:"stateManager.scale"})],jt.prototype,"scale",void 0),_([S()],jt.prototype,"heightModelInfo",null),_([S()],jt.prototype,"spatialReference",void 0),_([S({type:Boolean,constructOnly:!0})],jt.prototype,"alphaCompositingEnabled",void 0),_([S({type:Boolean})],jt.prototype,"supersampleScreenshotsEnabled",void 0),_([S({readOnly:!0})],jt.prototype,"type",void 0),_([S({type:tSe})],jt.prototype,"ui",void 0),_([S({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],jt.prototype,"updating",null),_([S({type:Number,readOnly:!0,dependsOn:["updating"]})],jt.prototype,"updatingProgress",void 0),_([S({type:["global","local"]})],jt.prototype,"viewingMode",null),_([S({type:oh,aliasOf:"stateManager.viewpoint"})],jt.prototype,"viewpoint",void 0),_([S({type:Number,aliasOf:"stateManager.zoom"})],jt.prototype,"zoom",void 0),_([S({type:kH})],jt.prototype,"highlightOptions",void 0),jt=_([re("esri.views.SceneView")],jt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(ZM||(ZM={}));const Fx=Q(),az=Ns(),She=Mi(),pEt=jt;function I_t(e){return e&&"getAtOrigin"in e&&"originOf"in e}function Ehe(e){e&&e.writtenProperties&&e.writtenProperties.forEach(t=>{const i=t.target;t.newOrigin&&t.oldOrigin!==t.newOrigin&&I_t(i)&&i.updateOrigin(t.propName,t.newOrigin)})}let my=class extends Ye{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};_([S({type:String,json:{write:!0}})],my.prototype,"facilityIdField",void 0),_([S({type:String,json:{write:!0}})],my.prototype,"layerId",void 0),_([S({type:String,json:{write:!0}})],my.prototype,"nameField",void 0),_([S({type:String,json:{write:!0}})],my.prototype,"siteIdField",void 0),_([S({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],my.prototype,"sublayerId",void 0),my=_([re("esri.layers.support.FacilityLayerInfo")],my);const $_t=my;let rp=class extends Ye{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};_([S({type:String,json:{write:!0}})],rp.prototype,"facilityIdField",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"layerId",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"levelIdField",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"levelNumberField",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"longNameField",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"shortNameField",void 0),_([S({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],rp.prototype,"sublayerId",void 0),_([S({type:String,json:{write:!0}})],rp.prototype,"verticalOrderField",void 0),rp=_([re("esri.layers.support.LevelLayerInfo")],rp);const D_t=rp;let $b=class extends Ye{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};_([S({type:String,json:{write:!0}})],$b.prototype,"layerId",void 0),_([S({type:String,json:{write:!0}})],$b.prototype,"nameField",void 0),_([S({type:String,json:{write:!0}})],$b.prototype,"siteIdField",void 0),_([S({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],$b.prototype,"sublayerId",void 0),$b=_([re("esri.layers.support.SiteLayerInfo")],$b);const L_t=$b;let N3=class extends Ye{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};_([S({type:D_t,json:{write:!0}})],N3.prototype,"levelLayer",void 0),_([S({type:$_t,json:{write:!0}})],N3.prototype,"facilityLayer",void 0),_([S({type:L_t,json:{write:!0}})],N3.prototype,"siteLayer",void 0),N3=_([re("esri.support.MapFloorInfo")],N3);const N_t=N3,F_t="webscene:failed-to-copy-embedded-resources",k_t="webscene:schema-validation";function U_t(){return new Se(F_t,"Copying of embedded resources is currently not supported")}function z_t(e){return new Se(k_t,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}async function B_t(e,t={},i){await e.load(i);const r=ih(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:a="asc",sortField:l="created"}=t,p={query:{start:s,num:n,sortOrder:a,sortField:l,token:e.apiKey},signal:Ss(i,"signal")},y=await e.portal._request(r,p);return{total:y.total,nextStart:y.nextStart,resources:y.resources.map(({created:b,size:x,resource:A})=>({created:new Date(b),size:x,resource:e.resourceFromPath(A)}))}}async function V_t(e,t,i,r){if(!e.hasPath())throw new Se(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(r);const n=ih(s.userItemUrl,t==="add"?"addResources":"updateResources"),[a,l]=iSe(e.path),p=await rSe(i),y=new FormData;return a&&a!=="."&&y.append("resourcesPrefix",a),y.append("fileName",l),y.append("file",p,l),y.append("f","json"),L(r)&&r.access&&y.append("access",r.access),await s.portal._request(n,{method:"post",body:y,signal:Ss(r,"signal")}),e}async function G_t(e,t,i){if(!t.hasPath())throw new Se("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=ih(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:Ss(i,"signal")}),t.portalItem=null}async function j_t(e,t){await e.load(t);const i=ih(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:Ss(t,"signal")})}function iSe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function oK(e){const[t,i]=H_t(e),[r,s]=iSe(t);return[r,s,i]}function H_t(e){const t=TPe(e);return J(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function rSe(e){return e instanceof Blob?e:(await Ar(e.url,{responseType:"blob"})).data}function q_t(e,t){if(!e.hasPath())return null;const[i,,r]=oK(e.path);return e.portalItem.resourceFromPath(ih(i,t+r))}function sSe(e,t){if(!e.hasPath())return null;const[i,,r]=oK(e.path);return e.portalItem.resourceFromPath(ih(i,t+r))}var aM=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:V_t,contentToBlob:rSe,fetchResources:B_t,getSiblingOfSameType:q_t,getSiblingOfSameTypeI:sSe,removeAllResources:j_t,removeResource:G_t,splitPrefixFileNameAndExtension:oK});async function Ahe(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(y=>y.resource.path)),n=new Set,a=[];s.forEach(y=>{r.delete(y),e.paths.push(y)});for(const y of t.resources.toUpdate)if(r.delete(y.resource.path),s.has(y.resource.path)||n.has(y.resource.path)){const{resource:b,content:x,finish:A,error:M}=y,P=sSe(b,Ipe());e.paths.push(P.path),a.push(Che({resource:P,content:x,finish:A,error:M},i))}else e.paths.push(y.resource.path),a.push(W_t(y,i)),n.add(y.resource.path);for(const y of t.resources.toAdd)a.push(Che(y,i)),e.paths.push(y.resource.path);if(r.forEach(y=>{const b=t.portalItem.resourceFromPath(y);a.push(b.portalItem.removeResource(b).catch(()=>{}))}),a.length===0)return;const l=await bo(a);Gi(i);const p=l.filter(y=>"error"in y).map(y=>y.error);if(p.length>0)throw new Se("save:resources","Failed to save one or more resources",{errors:p})}async function Che(e,t){const i=await nh(e.resource.portalItem.addResource(e.resource,e.content,t));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function W_t(e,t){const i=await nh(e.resource.update(e.content,t));if(i.ok!==!0)throw e.error(i.error),i.error;e.finish(e.resource)}const X_t={width:600,height:400},RI=1.5;function Y_t(e,t){t=t||X_t;let{width:i,height:r}=t;const s=i/r;return s<RI?r=i/RI:s>RI&&(i=r*RI),i>e.width&&(r*=e.width/i,i=e.width),r>e.height&&(i*=e.height/r,r=e.height),{width:Math.round(i),height:Math.round(r)}}function Mhe(e){return{enabled:!(e==null||!e.length)}}var lq;let F3=lq=class extends Ye{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new lq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};_([S({type:Boolean,json:{write:!0}})],F3.prototype,"exactMatch",void 0),_([S({type:String,json:{write:!0}})],F3.prototype,"name",void 0),_([ti(YX)],F3.prototype,"type",void 0),F3=lq=_([re("esri.webdoc.applicationProperties.SearchLayerField")],F3);const J_t=F3;var cq;let k3=cq=class extends Ye{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new cq(Fe({field:this.field,id:this.id,subLayer:this.subLayer}))}};_([S({type:J_t,json:{write:{isRequired:!0}}})],k3.prototype,"field",void 0),_([S({type:String,json:{write:{isRequired:!0}}})],k3.prototype,"id",void 0),_([S({type:us,json:{write:!0}})],k3.prototype,"subLayer",void 0),k3=cq=_([re("esri.webdoc.applicationProperties.SearchLayer")],k3);const Z_t=k3;var hq;let U3=hq=class extends Ye{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new hq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};_([S({type:Boolean,json:{write:!0}})],U3.prototype,"exactMatch",void 0),_([S({type:String,json:{write:!0}})],U3.prototype,"name",void 0),_([ti(YX)],U3.prototype,"type",void 0),U3=hq=_([re("esri.webdoc.applicationProperties.SearchTableField")],U3);const K_t=U3;var uq;let lM=uq=class extends Ye{constructor(e){super(e),this.field=null,this.id=null}clone(){return new uq(Fe({field:this.field,id:this.id}))}};_([S({type:K_t,json:{write:{isRequired:!0}}})],lM.prototype,"field",void 0),_([S({type:String,json:{write:{isRequired:!0}}})],lM.prototype,"id",void 0),lM=uq=_([re("esri.webdoc.applicationProperties.SearchTable")],lM);const Q_t=lM;var dq;const nSe=kt.ofType(Z_t),oSe=kt.ofType(Q_t);let kf=dq=class extends Ye{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new nSe,this.tables=new oSe}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,i){t[i]=!e}clone(){return new dq(Fe({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};_([S({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],kf.prototype,"addressSearchEnabled",void 0),_([wt("addressSearchEnabled")],kf.prototype,"readAddressSearchEnabled",null),_([Et("addressSearchEnabled")],kf.prototype,"writeAddressSearchEnabled",null),_([S({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],kf.prototype,"enabled",void 0),_([S({type:String,json:{write:!0}})],kf.prototype,"hintText",void 0),_([S({type:nSe,json:{write:{overridePolicy:Mhe},origins:{"web-scene":{write:{isRequired:!0}}}}})],kf.prototype,"layers",void 0),_([S({type:oSe,json:{read:!0,write:{overridePolicy:Mhe}}})],kf.prototype,"tables",void 0),kf=dq=_([re("esri.webdoc.applicationProperties.Search")],kf);const ebt=kf;var pq;let $$=pq=class extends Ye{constructor(e){super(e),this.search=null}clone(){return new pq(Fe({search:this.search}))}};_([S({type:ebt,json:{write:!0}})],$$.prototype,"search",void 0),$$=pq=_([re("esri.webdoc.applicationProperties.Viewing")],$$);const tbt=$$;var fq;let D$=fq=class extends Ye{constructor(e){super(e),this.viewing=null}clone(){return new fq({viewing:this.viewing?this.viewing.clone():null})}};_([S({type:tbt,json:{write:!0}})],D$.prototype,"viewing",void 0),D$=fq=_([re("esri.webscene.ApplicationProperties")],D$);const ibt=D$;var mq;let Db=mq=class extends Ye{constructor(e){super(e),this.environment=new MS,this.spatialReference=null,this.viewpoint=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new mq({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};_([S({type:MS,json:{write:{isRequired:!0}}})],Db.prototype,"environment",void 0),_([S({type:It})],Db.prototype,"spatialReference",void 0),_([S({type:["local","global"]})],Db.prototype,"viewingMode",null),_([S({type:oh,json:{write:{isRequired:!0}}})],Db.prototype,"viewpoint",void 0),Db=mq=_([re("esri.webscene.InitialViewProperties")],Db);const hL=Db;var gq;let og=gq=class extends Ye{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new gq({url:this.url})}};_([S({type:String,json:{write:{isRequired:!0}}})],og.prototype,"url",void 0),og=gq=_([re("esri.webdoc.support.SlideThumbnail")],og);var yq;let L$=yq=class extends Ye{constructor(){super(...arguments),this.text=""}clone(){return new yq({text:this.text})}};_([S({type:String,json:{write:!0}})],L$.prototype,"text",void 0),L$=yq=_([re("esri.webscene.support.Description")],L$);const N$=L$;var vq;let KM=vq=class extends Ye{constructor(){super(...arguments),this.lighting=new y0}clone(){return new vq({lighting:y0.prototype.clone.call(this.lighting)})}};_([S({type:y0,json:{write:!0}})],KM.prototype,"lighting",void 0),KM=vq=_([re("esri.webscene.Environment")],KM);var F$;let k$=F$=class extends Ye{constructor(){super(...arguments),this.opacity=null}clone(){return new F$({opacity:this.opacity})}cloneAndApplyTo(e){return this.opacity==null||((e=e!=null?e.clone():new hS).opacity=this.opacity),e}static fromGround(e){return new F$({opacity:e.opacity})}};_([S({type:Number,json:{type:us,read:{reader:lS,source:"transparency"},write:{writer:(e,t)=>{t.transparency=UL(e)},target:"transparency"}}})],k$.prototype,"opacity",void 0),k$=F$=_([re("esri.webscene.support.SlideGround")],k$);const aSe=k$;var _q;let dT=_q=class extends Ye{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new _q({id:this.id,sublayerIds:Fe(this.sublayerIds)})}};_([S({type:String,json:{write:!0}})],dT.prototype,"id",void 0),_([S({type:[us],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],dT.prototype,"sublayerIds",void 0),dT=_q=_([re("esri.webscene.support.SlideVisibleLayer")],dT);var bq;let U$=bq=class extends Ye{constructor(){super(...arguments),this.text=""}clone(){return new bq({text:this.text})}};_([S({type:String,json:{write:{isRequired:!0}}})],U$.prototype,"text",void 0),U$=bq=_([re("esri.webscene.support.Title")],U$);const QM=U$;let rbt=0;const wq=kt.ofType(dT),sbt=Ge.getLogger("esri.webscene.Slide");let Ca=class extends Ye{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+rbt++,this.title=new QM,this.description=new N$,this.thumbnail=new og,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new KM,this.visibleLayers=new wq}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail&&this.thumbnail.destroy(),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new QM({text:e}):Ys(QM,e)}castDescription(e){return typeof e=="string"?new N$({text:e}):Ys(N$,e)}castThumbnail(e){return typeof e=="string"?new og({url:e}):Ys(og,e)}castBasemap(e){return qY(e)}set visibleLayers(e){this._set("visibleLayers",Eg(e,this._get("visibleLayers"),wq))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(t=>{if(typeof t=="string")return{id:t};if(t instanceof JO){const i=Rhe(t);return{id:t.id,sublayerIds:i}}return t.id?{id:t.id,sublayerIds:t.sublayerIds}:(sbt.warn('Invalid visible layer, expected { id }, Layer or "id"'),t)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const t=[];return bo(this._getLayers(e.map).map(i=>e.whenLayerView(i).then(r=>{if(r.visible){const s=Rhe(i);t.push(new dT({id:r.layer.id,sublayerIds:s}))}})).toArray()).then(()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)})}updateFrom(e,t){return t={screenshot:ie({format:"png",quality:80,width:120,height:75,disableDecorations:!0},t&&t.screenshot)},e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=y0.prototype.clone.apply(e.environment.lighting),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?aSe.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(t.screenshot)).then(i=>(this.thumbnail=new og({url:i.dataUrl}),this))}async applyTo(e,t){L(this._applyToController)&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const r=TO(t,()=>i.abort()),s=e.resourceController.scheduler.registerTask(ii.SLIDE);let n=!1;t=qe(ie({animate:!0},t),{signal:this._applyToController.signal});const a=async()=>{await eR([s.schedule(()=>n=this._setViewpointOfInterest(e,t)),s.schedule(()=>this._applyBasemap(e,t),t.signal)]),await eR([s.schedule(()=>this._applyLayerVisibility(e),t.signal),s.schedule(()=>this._applyGround(e),t.signal),s.schedule(()=>this._applyViewpoint(e,t),t.signal)])},l=await nh(e.addUpdatingPromise(a()));if(n&&(e.contentCamera=null),s.remove(),this._applyToController===i&&(this._applyToController=null),i=null,r==null||r.remove(),l.ok===!1)throw l.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(i){if(Cs(i))throw i}e.map.basemap=rWe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new kt;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach(i=>{sje(i)&&(t.add(i),"layers"in i&&this._collectLayers(i,t))})}_applyLayerVisibility(e){!this.visibleLayers||this._getLayers(e.map).forEach(t=>{const i=this.visibleLayers.find(n=>n.id===t.id);t.visible=i!=null;const r=i&&i.sublayerIds,s=lSe(t);r&&s&&s.forEach(n=>n.visible=r.indexOf(n.id)>=0)})}_setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||t.ignoreViewpoint||!t.useDestinationCamera)return!1;const i=DZ(e,this.viewpoint);return e.contentCamera=i,L(i)}async _applyViewpoint(e,t){if(this.viewpoint&&!t.ignoreViewpoint){if(L(this.viewpoint.camera)&&(this.viewpoint.camera.fov=e.camera.fov),t.animate&&this.get("environment.lighting.date"))return void await this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let i=null;e.environment.lighting.type==="sun"&&(e.viewingMode==="global"&&(i=this._animateLightingWithCamera(e)),e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.displayUTCOffset!=null&&e.environment.lighting.type==="sun"&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);const r=e.goTo(this.viewpoint,t),s=()=>{i&&i.remove(),e.environment.lighting.type==="sun"&&(e.environment.lighting.cameraTrackingEnabled=!0)};return r.then(()=>{e.environment.applyLighting(this.environment.lighting.clone()),s()},n=>{throw s(),n})}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,i){return e.setTime(t),e.setUTCHours(i/3600),e.setUTCMinutes(i%3600/60),e.setUTCSeconds(i%3600%60),e}_animateLightingWithCamera(e){const t=new Date(e.environment.lighting.date.toString()),[i,r]=this._getTime(t),[s,n]=this._getTime(this.environment.lighting.date),a=nbt(r,n),l=e.renderCoordsHelper,p=Q();l.toRenderCoords(e.camera.position,p);const y=Q(),b=Q();L(this.viewpoint.camera)&&l.toRenderCoords(this.viewpoint.camera.position,y);const x=new Date;return e.watch("camera",A=>{l.toRenderCoords(A.position,b);const M=wo(p,b),P=wo(y,b);let $=0;M+P!==0&&($=M/(M+P));const k=i+(s-i)*$,z=obt(r,a*$);e.environment.lighting.date=this._setTime(x,k,z)})}static createFrom(e,t){return new this().updateFrom(e,t)}};function lSe(e){if(e.type==="building-scene"||e.type==="map-image")return e.allSublayers.toArray()}function Rhe(e){const t=lSe(e);if(t)return t.filter(i=>i.visible).map(i=>i.id)}_([S({type:String,json:{write:{isRequired:!0}}})],Ca.prototype,"id",void 0),_([S({type:QM,json:{default:()=>new QM({text:""}),write:{isRequired:!0}}})],Ca.prototype,"title",void 0),_([_i("title")],Ca.prototype,"castTitle",null),_([S({type:N$,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],Ca.prototype,"description",void 0),_([_i("description")],Ca.prototype,"castDescription",null),_([S({type:og,json:{default:()=>new og({url:""}),write:{isRequired:!0}}})],Ca.prototype,"thumbnail",void 0),_([_i("thumbnail")],Ca.prototype,"castThumbnail",null),_([S({type:oh,nonNullable:!0,json:{write:{isRequired:!0}}})],Ca.prototype,"viewpoint",void 0),_([S({type:ES,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Ca.prototype,"basemap",void 0),_([_i("basemap")],Ca.prototype,"castBasemap",null),_([S({type:aSe,json:{write:!0}})],Ca.prototype,"ground",void 0),_([S({type:wq,json:{write:{isRequired:!0}}})],Ca.prototype,"visibleLayers",null),_([_i("visibleLayers")],Ca.prototype,"castVisibleLayers",null),_([S({type:KM,json:{write:!0}})],Ca.prototype,"environment",void 0),Ca=_([re("esri.webscene.Slide")],Ca);const xq=86400,Ohe=43200;function nbt(e,t){let i=t-e;return i>Ohe&&(i-=xq),i<-Ohe&&(i+=xq),i}function obt(e,t){return I9e(e+t,xq)}const abt=Ca,Tq=kt.ofType(abt);let z$=class extends Ye{constructor(e){super(e),this.slides=new Tq}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(t=>!!t.viewpoint)),this._set("slides",Eg(e,this._get("slides"),Tq))}clone(){return new this.constructor({slides:this.slides.clone()})}};_([S({type:Tq,nonNullable:!0,json:{write:!0}}),_i(sX)],z$.prototype,"slides",null),z$=_([re("esri.webscene.Presentation")],z$);const cSe=z$;var Sq;let z3=Sq=class extends Ye{constructor(e){super(e)}clone(){return new Sq({name:this.name,path:this.path,title:this.title})}};_([S({type:String,json:{write:!0}})],z3.prototype,"name",void 0),_([S({type:String,json:{write:!0}})],z3.prototype,"path",void 0),_([S({type:String,json:{write:!0}})],z3.prototype,"title",void 0),z3=Sq=_([re("esri.webscene.TransportationNetwork")],z3);const lbt=z3;class uL extends Uv{constructor(t,i){super(t,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}const kx=Ge.getLogger("esri.WebScene"),BT=new uL(1,27),cbt=()=>{const t=[],i=BT.major;for(let r=8;r<=BT.minor;r++)t.push(`${i}.${r}`);return t},lz="Web Scene",OI="ViewingMode-Local";let Mr=class extends d0.LoadableMixin(oE(OY(qve))){constructor(e){super(e),this._handles=new Ei,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=null,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new cSe,this.initialViewProperties=new hL,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=kq(async(t,i,r)=>{switch(t){case pT.SAVE:return this._saveImpl(i);case pT.SAVE_AS:return this._saveAsImpl(r,i)}}),this.resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{kx.error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this._handles.destroy(),this.presentation&&this.presentation.destroy();const e=this.portalItem;this.portalItem=null,e==null||e.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,i,r){const s=qe(ie({},r),{layerContainerType:"operational-layers"}),n=e.map(a=>this.verifyWriteLayer(a,r)?a.write({},s):null).filter(a=>!!a);t[i]=n.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new Se("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[i,r]=t.version.split(".");return new uL(parseInt(i,10),parseInt(r,10))}writeSourceVersion(e,t,i){t[i]=`${BT.major}.${BT.minor}`}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=wW}writeGround(e,t,i,r){t[i]=e?e.write({},r):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const i={};return t.initialState&&t.initialState.environment&&(i.environment=MS.fromJSON(t.initialState.environment)),t.spatialReference?i.spatialReference=It.fromJSON(t.spatialReference):i.spatialReference=It.WebMercator,i.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(i.viewpoint=oh.fromJSON(t.initialState.viewpoint)),new hL(i)}get spatialReference(){var e,t;return(e=(t=this.initialViewProperties)==null?void 0:t.spatialReference)!=null?e:It.WebMercator}get viewingMode(){var e,t;return(e=(t=this.initialViewProperties)==null?void 0:t.viewingMode)!=null?e:"global"}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return dX(this,e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map(i=>i.basemap))})}read(e,t){t=qe(ie({},t),{origin:"web-scene"});const i=this._isAuthoringAppVersionSetByUser,r=this._isAuthoringAppSetByUser;if(lfe(this,e,s=>super.read(e,s),t),r||(this._isAuthoringAppSetByUser=!1),i||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(p=>({id:p.id})),n=this.presentation.slides,a=(p,y)=>p.visibleLayers.some(b=>b.id===y),l=s.filter(p=>!n.some(y=>a(y,p.id)));n.forEach(p=>{p.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const t=e.ground&&e.ground.layers;!e.baseMap&&t&&t.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=Fe(t))}write(e,t){var i;if(this.loadStatus!=="loaded"){const n=new Se("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw kx.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const r=!((i=t)!=null&&i.messages);t=qe(ie({messages:[]},t),{origin:"web-scene"});const s=super.write(e,t);if(r){const n=t.messages.filter(a=>a.name==="web-document-write:property-required");if(n.length){const a=new Se("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw kx.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),a}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(pT.SAVE,e)}async _saveImpl(e){this.portalItem||(kx.error("save(): requires the .portalItem property to be set"),await Promise.reject(new Se("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))),this.portalItem.type!==lz&&await Promise.reject(new Se("webscene:portal-item-wrong-type",`Portal item needs to have type "${lz}"`));const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&Gn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||ha.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),r=this.write({},i);return await Promise.all(i.resources.pendingOperations),await this._verifySave(r,i,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:r}),await Ahe(this.resourceReferences,i,null),Ehe(i),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(pT.SAVE_AS,t,e)}async _saveAsImpl(e,t){let i=SS.from(e);i||(kx.error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new Se("webscene:portal-item-required","saveAs requires a portal item to save to"))),i.id&&(i=i.clone(),i.id=null);const r=i.portal||ha.getDefault();await this._ensureLoadBeforeSave(),i.type=lz,i.portal=r;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:r,portalItem:i,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(i),await r._signIn(),await r.user.addItem({item:i,folder:t&&t.folder,data:n}),await Ahe(this.resourceReferences,s,null),this.portalItem=i,QG.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl&&Gn(i.itemUrl)}),Ehe(s),a&&(this.thumbnailUrl=l?bW(a,"w","8192"):a),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,i,r=!1){if(!tS(this.spatialReference))return Promise.reject(new Se("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,n=t.messages.filter(l=>l.type==="error").map(l=>new Se(l.name,l.message,l.details));t.blockedRelativeUrls&&(n=n.concat(t.blockedRelativeUrls.map(l=>new Se("url:unsupported",`Relative url '${l}' is not supported in Web Scene`)))),i&&i.ignoreUnsupported&&(n=n.filter(l=>l.name!=="layer:unsupported"&&l.name!=="symbol:unsupported"&&l.name!=="symbol-layer:unsupported"&&l.name!=="property:unsupported"&&l.name!=="url:unsupported"&&l.name!=="scenemodification:unsupported")),i!=null&&i.requiredPropertyChecksDisabled&&(n=n.filter(l=>l.name!=="web-document-write:property-required"));const a=i&&i.strictSchemaValidationEnabled;return s=a?import("./schemaValidator.eef77b5e.js").then(l=>{const p=l.validate(e);if(p.length>0){const y=`webscene did not validate:
${p.join(`
`)}`;kx.error(`${r?"saveAs":"save"}(): ${y}`)}return p.map(y=>new Se("webscene:schema-validation",y))}).then(l=>{if(a&&l.length>0)throw z_t(l.concat(n));return n}):Promise.resolve(n),s.then(l=>{if(l.length>0)return Promise.reject(new Se("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:l}))})}_verifySaveAs(e,t,i){return this.canNotSaveAs(t)?Promise.reject(U_t()):this._verifySave(e,t,i,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},t);return this._verifySaveAs(i,t,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.length>0}async updateFrom(e,t={}){const i=this._updateFrom(e,t);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){if(await e.whenReady(),!t.environmentExcluded&&e.environment){if(e.environment.lighting.type&&e.environment.lighting.type!=="sun")throw new Se("lighting:unsupported",`${e.environment.lighting.type} lighting cannot be stored in WebScene`);this.initialViewProperties.environment=MS.prototype.clone.apply(e.environment)}if(!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,L(e.clippingArea)?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const i of e.allLayerViews){const r="visible";r in i&&r in i.layer&&i._isOverridden(r)&&(i.layer[r]=i[r])}(t.thumbnailExcluded===!1||t.thumbnailExcluded==null&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize||void 0)}async _updateFromThumbnail(e,t){const i=Y_t(e,t),r=await e.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=r.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const i=this._validateJSON(e);return this.read(i,t),this._loadFromJSON(i,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)t.push(s);const i=[],r=s=>(s.layers&&(s.layers=s.layers.filter(r)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion.supportsGround||i.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(r):[],operationalElevationLayers:i,basemapElevationLayers:t}}_loadFromJSON(e,t){const i=new kt;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>import("./layersCreator.589b64ff.js")).then(({populateOperationalLayers:r})=>{const{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],p={context:qe(ie({},t),{layerContainerType:"operational-layers"})};if(this.portalItem&&(p.context.portal=this.portalItem.portal||ha.getDefault()),a.length>0){const y=qe(ie({},p),{context:qe(ie({},p.context),{layerContainerType:"ground"})});y.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(r(this.ground.layers,a,y))}if(n.length>0){const y=qe(ie({},p),{context:qe(ie({},p.context),{layerContainerType:"ground"})});y.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(r(i,n,y))}return s&&s.length>0&&l.push(r(this.layers,s,p)),bo(l).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(i)})}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[];for(const t of this.allLayers.items)if("beforeSave"in t&&typeof t.beforeSave=="function"){const i=t.beforeSave();i&&e.push(i)}await bo(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(t=>{t.basemap&&e.push(t.basemap.load())}),await bo(e)}async _loadFromItem(e){if(await e.load().catch(r=>{throw new Se("webscene:load-portal-item","Failed to load portal item",{error:r})}),e.type!=="Web Scene")throw new Se("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const i={origin:"web-scene",url:Gn(e.itemUrl),portal:e.portal||ha.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,i),this.resourceReferences={portalItem:e,paths:i.readResourcePaths}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let i;if(e.viewingMode!=="local"){if(!GS(t,vt.Global))return Promise.reject(new Se("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=l=>!l||Tv(l,t)}else{if(!GS(t,vt.Local))return Promise.reject(new Se("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=l=>!l||l.equals(t)}const r=l=>l&&(L(l.camera)&&l.camera.position&&l.camera.position.spatialReference||L(l.targetGeometry)&&l.targetGeometry.spatialReference),s=e.viewpoint,n=r(s);if(n&&!i(n))return Promise.reject(new Se("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!i(r(l.viewpoint)));if(a){const l=r(a.viewpoint);return Promise.reject(new Se("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=$We(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=uL.parse(e.version||"","webscene");return BT.validate(t),e.version=`${t.major}.${t.minor}`,t.major===1&&t.minor<=2&&(e.spatialReference=It.WebMercator.toJSON()),e}_updateTypeKeywords(e){this.initialViewProperties.viewingMode==="local"?e.typeKeywords?e.typeKeywords.indexOf(OI)===-1&&e.typeKeywords.push(OI):e.typeKeywords=[OI]:this.initialViewProperties.viewingMode==="global"&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(t=>t!==OI)),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((t,i,r)=>r.indexOf(t)===i))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||It.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem&&this.portalItem.itemUrl?Gn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=r=>!!this.allLayers.find(s=>s.id===r);e&&e.layers&&(e.layers=e.layers.filter(r=>t(r.id)));const i=this.presentation&&this.presentation.slides;i&&i.forEach(r=>{r.visibleLayers&&(r.visibleLayers=r.visibleLayers.filter(s=>t(s.id)))})}static fromJSON(e){if(!e)throw new Se("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};var pT;Mr.VERSION=BT,_([S({type:ibt,json:{write:!0}})],Mr.prototype,"applicationProperties",void 0),_([S({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Mr.prototype,"basemap",void 0),_([S({type:ki,json:{read:{source:"clippingArea.geometry",reader:Lp},write:{target:"clippingArea.geometry"}}})],Mr.prototype,"clippingArea",void 0),_([Et("clippingArea")],Mr.prototype,"writeClippingArea",null),_([S({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Mr.prototype,"clippingEnabled",void 0),_([wt("clippingEnabled",["clippingArea"])],Mr.prototype,"readClippingEnabled",null),_([Et("clippingEnabled")],Mr.prototype,"writeClippingEnabled",null),_([S({type:N_t,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Mr.prototype,"floorInfo",void 0),_([S({type:jv,json:{write:!0}})],Mr.prototype,"heightModelInfo",void 0),_([S({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Mr.prototype,"layers",void 0),_([Et("layers")],Mr.prototype,"writeLayers",null),_([S({readOnly:!0,type:uL,json:{type:cbt(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Mr.prototype,"sourceVersion",void 0),_([wt("sourceVersion",["version"])],Mr.prototype,"readSourceVersion",null),_([Et("sourceVersion")],Mr.prototype,"writeSourceVersion",null),_([S({json:{read:!1,write:!1}})],Mr.prototype,"tables",void 0),_([S()],Mr.prototype,"thumbnailUrl",null),_([S({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Mr.prototype,"authoringApp",null),_([Et("authoringApp")],Mr.prototype,"writeAuthoringApp",null),_([S({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Mr.prototype,"authoringAppVersion",null),_([Et("authoringAppVersion")],Mr.prototype,"writeAuthoringAppVersion",null),_([S({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Mr.prototype,"ground",void 0),_([Et("ground")],Mr.prototype,"writeGround",null),_([S({type:kt.ofType(lbt),json:{write:!0}})],Mr.prototype,"transportationNetworks",void 0),_([S({type:cSe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,i,r)=>{if(e.slides&&e.slides.length>0){const s=qe(ie({},r),{isPresentation:!0});t.presentation=e.write({},s)}}}}})],Mr.prototype,"presentation",void 0),_([S({type:hL,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new hL({viewingMode:"global",spatialReference:It.WebMercator})}})],Mr.prototype,"initialViewProperties",void 0),_([wt("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],Mr.prototype,"readInitialViewProperties",null),_([S({type:It,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Mr.prototype,"spatialReference",null),_([S({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Mr.prototype,"viewingMode",null),_([S({type:SS})],Mr.prototype,"portalItem",void 0),_([S()],Mr.prototype,"resourceInfo",void 0),Mr=_([re("esri.WebScene")],Mr),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(pT||(pT={}));const fEt=Mr;var hSe={exports:{}};(function(e){(function(){function t(l,p){var y=l.x-p.x,b=l.y-p.y;return y*y+b*b}function i(l,p,y){var b=p.x,x=p.y,A=y.x-b,M=y.y-x;if(A!==0||M!==0){var P=((l.x-b)*A+(l.y-x)*M)/(A*A+M*M);P>1?(b=y.x,x=y.y):P>0&&(b+=A*P,x+=M*P)}return A=l.x-b,M=l.y-x,A*A+M*M}function r(l,p){for(var y=l[0],b=[y],x,A=1,M=l.length;A<M;A++)x=l[A],t(x,y)>p&&(b.push(x),y=x);return y!==x&&b.push(x),b}function s(l,p,y,b,x){for(var A=b,M,P=p+1;P<y;P++){var $=i(l[P],l[p],l[y]);$>A&&(M=P,A=$)}A>b&&(M-p>1&&s(l,p,M,b,x),x.push(l[M]),y-M>1&&s(l,M,y,b,x))}function n(l,p){var y=l.length-1,b=[l[0]];return s(l,0,y,p,b),b.push(l[y]),b}function a(l,p,y){if(l.length<=2)return l;var b=p!==void 0?p*p:1;return l=y?l:r(l,b),l=n(l,b),l}e.exports=a,e.exports.default=a})()})(hSe);var mEt=hSe.exports;function hbt(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in e)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(e,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(e)}var aK={exports:{}};(function(e,t){function i(){function s(f){if(typeof f=="number")return ae.Uc.$g(f);if(f==null)return null;if(Xp[f]!=null)return ae.Uc.$g(Xp[f]);throw Error("Unrecognised Unit Type")}function n(f){if(typeof f=="number")return ae.Uc.$g(f);if(f==null)return null;if(Qv[f]!=null)return ae.Uc.$g(Qv[f]);throw Error("Unrecognised Unit Type")}function a(f){if(f)switch(f){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function l(f,N,T,d){if(T==null||T.B())return null;switch(T.K()){case ae.sn.Point:return f.exportPoint(N,T,d);case ae.sn.Polygon:return f.exportPolygon(N,T,d);case ae.sn.Polyline:return f.exportPolyline(N,T,d);case ae.sn.MultiPoint:return f.exportMultipoint(N,T,d);case ae.sn.Envelope:return f.exportExtent(N,T,d)}return null}function p(f,N,T,d){if(T.K()!==ae.sn.Point)throw Error("Geometry not Point");return f.exportPoint(N,T,d)}function y(f,N,T){return f.convertToGEGeometry(N,T)}function b(f){var N=f.wkid;f=f.wkt;var T=e1.get(N||f);return T==null&&(N!==-1&&N!=null?(T=ae.Gg.create(N),e1.set(N,T)):f&&(T=ae.Gg.iP(f),e1.set(f,T))),T}function x(f){var N;if(f==null)return null;var T=b(f);return f=T.Id(),T=T.Ln(),(N={}).tolerance=T,N.unitType=f==null?-1:f.od,N.unitID=f==null?-1:f.Fc(),N.unitBaseFactor=f==null?0:f.bi,N.unitSquareDerivative=f==null?0:ae.Uc.TF(f).Fc(),N}function A(f,N,T,d){return T==null?null:(T=ae.bc.clip(y(f,ft,T),y(f,ft,d),b(N)),l(f,ft,T,N))}function M(f,N,T,d){T=ae.bc.el(y(f,ft,T),y(f,ft,d),b(N)),d=[];for(var h=0;h<T.length;h++)d.push(l(f,ft,T[h],N));return d}function P(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.contains(y(f,ft,T),y(f,ft,d),b(N))}function $(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.tP(y(f,ft,T),y(f,ft,d),b(N))}function k(f,N,T,d,h){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.ub(y(f,ft,T),y(f,ft,d),b(N),s(h))}function z(f,N,T,d){return!(T==null&&d!=null||d==null&&T!=null)&&ae.bc.Nb(y(f,ft,T),y(f,ft,d),b(N))}function G(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.JS(y(f,ft,T),y(f,ft,d),b(N))}function B(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.touches(y(f,ft,T),y(f,ft,d),b(N))}function W(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.eY(y(f,ft,T),y(f,ft,d),b(N))}function q(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.LP(y(f,ft,T),y(f,ft,d),b(N))}function X(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.tU(y(f,ft,T),y(f,ft,d),b(N))}function oe(f,N,T,d,h){if(T==null||d==null)throw Error("Illegal Argument Exception");return ae.bc.sB(y(f,ft,T),y(f,ft,d),b(N),h)}function de(f,N,T){if(T==null)throw Error("Illegal Argument Exception");return ae.bc.US(y(f,ft,T),b(N))}function he(f,N,T){if(T==null)throw Error("Illegal Argument Exception");return T=ae.bc.YB(y(f,ft,T),b(N)),l(f,ft,T,N)}function fe(f,N,T,d){if(d===void 0&&(d=!1),T==null)throw Error("Illegal Argument Exception");if(Array.isArray(T)){var h=d,o=[];for(d=0;d<T.length;d++)o.push(y(f,ft,T[d]));for(T=ae.bc.bP(o,h),h=Array(T.length),d=0;d<T.length;d++)h[d]=l(f,ft,T[d],N);return h}return d=ae.bc.aP(y(f,ft,T),b(N)),l(f,ft,d,N)}function me(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(T)){for(var h=[],o=0;o<T.length;o++)h.push(y(f,ft,T[o]));for(T=ae.bc.IP(h,y(f,ft,d),b(N)),d=Array(T.length),o=0;o<T.length;o++)d[o]=l(f,ft,T[o],N);return d}return o=ae.bc.km(y(f,ft,T),y(f,ft,d),b(N)),l(f,ft,o,N)}function ge(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(T)){for(var h=[],o=0;o<T.length;o++)h.push(y(f,ft,T[o]));for(T=ae.bc.JX(h,y(f,ft,d),b(N)),d=Array(T.length),o=0;o<T.length;o++)d[o]=l(f,ft,T[o],N);return d}return o=ae.bc.fp(y(f,ft,T),y(f,ft,d),b(N)),l(f,ft,o,N)}function Ce(f,N,T,d){if(T==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(T)){for(var h=[],o=0;o<T.length;o++)h.push(y(f,ft,T[o]));for(T=ae.bc.HS(h,y(f,ft,d),b(N)),d=Array(T.length),o=0;o<T.length;o++)d[o]=l(f,ft,T[o],N);return d}return o=ae.bc.Fa(y(f,ft,T),y(f,ft,d),b(N)),l(f,ft,o,N)}function Ae(f,N,T,d){if(T==null)return null;var h=[];if(Array.isArray(T)){if(T.length===0)return null;for(d=0;d<T.length;d++)h.push(y(f,ft,T[d]))}else h.push(y(f,ft,T)),d!=null&&h.push(y(f,ft,d));return l(f,ft,ae.bc.YX(h,b(N)),N)}function Pe(f,N,T,d,h,o,c,u){var m=0;if(o!=null)switch(o){case"round":m=0;break;case"bevel":m=1;break;case"miter":m=2;break;case"square":m=3}if(Array.isArray(T)){if(T==null)f=null;else if(T.length===0)f=[];else{var g=[];for(o=0;o<T.length;o++)g.push(y(f,ft,T[o]));for(T=ae.bc.rU(g,b(N),d,m,c,u,s(h)),d=Array(T.length),o=0;o<T.length;o++)d[o]=l(f,ft,T[o],N);f=d}return f}return T=ae.bc.offset(y(f,ft,T),b(N),d,m,c,u,s(h)),l(f,ft,T,N)}function De(f,N,T,d,h,o){if(o===void 0&&(o=!1),Array.isArray(T)){if(!Array.isArray(d)){for(var c=[],u=0;u<T.length;u++)c.push(d);d=c}if(d.length!=T.length){if(d.length==0)throw Error("Illegal Argument Exception");c=[];var m=0;for(u=0;u<T.length;u++)d[u]===void 0?c.push(m):(c.push(d[u]),m=d[u]);d=c}return pe(f,N,T,d,h,!1,o,"geodesic",NaN)}return T=ae.bc.buffer(y(f,ft,T),b(N),d,s(h),!1,0,NaN),l(f,ft,T,N)}function ne(f,N,T,d,h,o,c,u){if(Array.isArray(T)){if(!Array.isArray(d)){for(var m=[],g=0;g<T.length;g++)m.push(d);d=m}if(d.length!==T.length){if(d.length===0)throw Error("Illegal Argument Exception");m=[];var v=0;for(g=0;g<T.length;g++)d[g]===void 0?m.push(v):(m.push(d[g]),v=d[g]);d=m}return pe(f,N,T,d,h,!0,o,c,u)}return c===void 0&&(c=NaN),T=ae.bc.buffer(y(f,ft,T),b(N),d,s(h),!0,a(o),c),l(f,ft,T,N)}function pe(f,N,T,d,h,o,c,u,m){if(m===void 0&&(m=NaN),T==null)return null;if(T.length===0)return[];for(var g=[],v=0;v<T.length;v++)g.push(y(f,ft,T[v]));for(T=ae.bc.EN(g,b(N),d,s(h),o,c,a(u),m),d=Array(T.length),v=0;v<T.length;v++)d[v]=l(f,ft,T[v],N);return d}function ye(f,N,T,d,h){var o;return h===void 0&&(h=!0),T=ae.bc.iz(y(f,ft,T),y(f,ft,d),h),(o={}).coordinate=p(f,ft,T.az(),N),o.distance=T.cz(),o.isRightSide=T.Nz(),o.vertexIndex=T.Va(),o.isEmpty=T.B(),o}function we(f,N,T,d){var h;return T=ae.bc.jz(y(f,ft,T),y(f,ft,d)),(h={}).coordinate=p(f,ft,T.az(),N),h.distance=T.cz(),h.isRightSide=T.Nz(),h.vertexIndex=T.Va(),h.isEmpty=T.B(),h}function Ee(f,N,T,d,h,o){var c;for(T=ae.bc.kz(y(f,ft,T),y(f,ft,d),h,o),d=[],h=0;h<T.length;h++)T[h].B()===!1&&d.push(((c={}).coordinate=p(f,ft,T[h].az(),N),c.distance=T[h].cz(),c.isRightSide=T[h].Nz(),c.vertexIndex=T[h].Va(),c.isEmpty=T[h].B(),c));return d}function Ie(f,N,T,d,h,o){return T=ae.bc.IQ(y(f,ft,T),b(N),d,h,s(o)),l(f,ft,T,N)}function xe(f,N,T,d,h){return T=ae.bc.Rr(y(f,ft,T),b(N),d,s(h)),l(f,ft,T,N)}function $e(f,N,T,d,h,o){return o===void 0&&(o=0),T=ae.bc.Ry(y(f,ft,T),b(N),d,s(h),o),l(f,ft,T,N)}function et(f,N,T,d){if(T==null)throw Error("Illegal Argument Exception");return ae.bc.zU(y(f,ft,T),b(N),n(d))}function ct(f,N,T,d){if(T==null)throw Error("Illegal Argument Exception");return ae.bc.AU(y(f,ft,T),b(N),s(d))}function Mt(f,N,T,d,h){if(T==null)throw Error("Illegal Argument Exception");return ae.bc.OQ(y(f,ft,T),b(N),n(d),a(h))}function at(f,N,T,d,h){if(T==null)throw Error("Illegal Argument Exception");return ae.bc.RQ(y(f,ft,T),b(N),s(d),a(h))}function nt(f){ae.FL.bind(f)}function dt(f,N,T,d,h){var o=null,c=null;if(d){if(!h)throw ae.i.O("AOI missing Spatial Reference");o=y(f,ft,d),c=b(h).gh()}return(f=ae.hu.OR(b(N).gh(),b(T).gh(),o,c))!==null?f:null}function xt(f,N,T,d,h){var o=null,c=null;if(d){if(!h)throw ae.i.O("AOI missing Spatial Reference");o=y(f,ft,d),c=b(h).gh()}return ae.hu.PR(b(N).gh(),b(T).gh(),o,c)}function wr(f,N,T,d,h){if(h===void 0&&(h=null),this.zY===!1)throw Error("Projection Engine must be enabled using enableProjection");if(N.length===0)return[];if(h){var o=h.getCachedGeTransformation(T,d);if(!o)e:{if(o=h,h=null,o){var c=o.getGTListEntry();if(c!==null){h=new ae.pC(null);for(var u=0,m=c.steps;u<m.length;u++){c=m[u];var g=new ae.Bx(c.geogtran);c.isInverse&&g.Lz(),h.add(g)}h=ae.xr.Or(b(T).gh(),b(d).gh(),h),o.assignCachedGe(T,d,h),o=h;break e}}if(h===null&&o&&o.steps&&0<o.steps.length){for(h=new ae.pC(null),u=0,m=o.steps;u<m.length;u++)(c=m[u]).wkid!=-1&&c.wkid!=null?h.add(ae.Bx.create(c.wkid,c.isInverse)):h.add(ae.Bx.mP(c.wkt,c.isInverse));h=ae.xr.Or(b(T).gh(),b(d).gh(),h),o.assignCachedGe(T,d,h),o=h}else o=ae.xr.Or(b(T).gh(),b(d).gh(),h)}for(T=[],c=0;c<N.length;c++)h=N[c],T.push(vs(f,h,d,o))}else for(o=ae.xr.Or(b(T).gh(),b(d).gh(),null),T=[],c=0;c<N.length;c++)h=N[c],T.push(vs(f,h,d,o));return T}function vs(f,N,T,d){return N=ae.bc.Ah(y(f,ft,N),d),l(f,ft,N,T)}var ji,ae,sr,Bs,Hi=this&&this.__extends||function(){function f(N,T){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var o in h)h.hasOwnProperty(o)&&(d[o]=h[o])})(N,T)}return function(N,T){function d(){this.constructor=N}f(N,T),N.prototype=T===null?Object.create(T):(d.prototype=T.prototype,new d)}}();(function(f){var N;(N=f.sn||(f.sn={}))[N.Unknown=0]="Unknown",N[N.Point=33]="Point",N[N.Line=322]="Line",N[N.Envelope=197]="Envelope",N[N.MultiPoint=550]="MultiPoint",N[N.Polyline=1607]="Polyline",N[N.Polygon=1736]="Polygon",function(d){d[d.enumMild=0]="enumMild",d[d.enumMedium=1]="enumMedium",d[d.enumHot=2]="enumHot"}(f.QK||(f.QK={}));var T=function(){function d(){this.description=null,this.PA=0}return d.prototype.K=function(){return 0},d.prototype.Eb=function(){return-1},d.prototype.kg=function(h){this.wc(),h!=this.description&&this.un(h)},d.prototype.un=function(){},d.prototype.Ll=function(h){this.wc(),h!=this.description&&(h=f.ee.uR(this.description,h))!=this.description&&this.un(h)},d.prototype.hasAttribute=function(h){return this.description.hasAttribute(h)},d.prototype.se=function(h){this.wc(),this.description.hasAttribute(h)||(h=f.ee.tR(this.description,h),this.un(h))},d.prototype.Ug=function(){return null},d.prototype.dn=function(){},d.prototype.A=function(){},d.prototype.Ro=function(){},d.prototype.yc=function(h){this.A(h)},d.prototype.B=function(){return!0},d.prototype.Pa=function(){},d.prototype.Pc=function(){},d.prototype.Ja=function(){return null},d.prototype.copyTo=function(){},d.prototype.He=function(){return 0},d.prototype.Rb=function(){return 0},d.prototype.aG=function(){return this.hasAttribute(1)},d.uf=function(h){return 1+((192&h)>>6)>>1},d.Sn=function(h){return(32&h)!=0},d.KS=function(h){return(128&h)!=0},d.zd=function(h){return(256&h)!=0},d.yj=function(h){return(512&h)!=0},d.Ic=function(h){return(1024&h)!=0},d.prototype.Pf=function(){var h=this.Ja();return this.copyTo(h),h},d.prototype.mg=function(){return null},d.ig=function(h){var o=h.Ja();return h.copyTo(o),o},d.prototype.wc=function(){0<=this.PA&&(this.PA+=2147483649)},d.yx=function(h){var o=h.K();if(d.yj(o))return h.I();if(h.B())return 0;if(o==197)return 4;if(o==33)return 1;if(d.zd(o))return 2;throw f.i.ga("missing type")},d}();f.ba=T})(ae||(ae={})),sr=ae||(ae={}),Bs=function(){function f(){this.y=this.x=0}return f.construct=function(N,T){var d=new f;return d.x=N,d.y=T,d},f.bl=function(N){var T=new f;return T.x=N.x,T.y=N.y,T},f.prototype.na=function(N,T){this.x=N,this.y=T},f.prototype.N=function(N){this.x=N.x,this.y=N.y},f.prototype.hq=function(N,T){return this.x===N&&this.y===T},f.prototype.Mz=function(N){return 2220446049250313e-31>=Math.abs(this.x-N.x)&&2220446049250313e-31>=Math.abs(this.y-N.y)},f.prototype.rb=function(N){return this.x===N.x&&this.y===N.y},f.prototype.Nb=function(N){return N==this||N instanceof f&&this.x==N.x&&this.y==N.y},f.prototype.sub=function(N){this.x-=N.x,this.y-=N.y},f.prototype.vc=function(N,T){this.x=N.x-T.x,this.y=N.y-T.y},f.prototype.add=function(N,T){T!==void 0?(this.x=N.x+T.x,this.y=N.y+T.y):(this.x+=N.x,this.y+=N.y)},f.prototype.Uq=function(){this.x=-this.x,this.y=-this.y},f.prototype.mt=function(N){this.x=-N.x,this.y=-N.y},f.prototype.ES=function(N,T,d){this.x=N.x*(1-d)+T.x*d,this.y=N.y*(1-d)+T.y*d},f.prototype.Ct=function(N,T){this.x=this.x*N+T.x,this.y=this.y*N+T.y},f.prototype.wW=function(N,T,d){this.x=T.x*N+d.x,this.y=T.y*N+d.y},f.prototype.scale=function(N){this.x*=N,this.y*=N},f.prototype.compare=function(N){return this.y<N.y?-1:this.y>N.y?1:this.x<N.x?-1:this.x>N.x?1:0},f.prototype.normalize=function(){var N=this.length();N==0&&(this.x=1,this.y=0),this.x/=N,this.y/=N},f.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},f.prototype.Sk=function(){return this.x*this.x+this.y*this.y},f.ub=function(N,T){return Math.sqrt(this.zc(N,T))},f.Jy=function(N,T,d,h){return N-=d,T-=h,Math.sqrt(N*N+T*T)},f.prototype.Rh=function(N){return this.x*N.x+this.y*N.y},f.prototype.YC=function(N){return Math.abs(this.x*N.x)+Math.abs(this.y*N.y)},f.prototype.xi=function(N){return this.x*N.y-this.y*N.x},f.prototype.Bt=function(N,T){var d=-this.x*T+this.y*N;this.x=this.x*N+this.y*T,this.y=d},f.prototype.Iv=function(){var N=this.x;this.x=-this.y,this.y=N},f.prototype.EG=function(N){this.x=-N.y,this.y=N.x},f.prototype.cr=function(){var N=this.x;this.x=this.y,this.y=-N},f.prototype.ru=function(){return 0<this.x?0<=this.y?1:4:0<this.y?2:this.x==0?4:3},f.ou=function(N,T){var d=N.ru(),h=T.ru();return h==d?0>(N=N.xi(T))?1:0<N?-1:0:d<h?-1:1},f.zc=function(N,T){var d=N.x-T.x;return d*d+(N=N.y-T.y)*N},f.prototype.toString=function(){return"("+this.x+" , "+this.y+")"},f.prototype.Sc=function(){this.y=this.x=NaN},f.prototype.isNaN=function(){return isNaN(this.x)||isNaN(this.y)},f.prototype.offset=function(N,T){var d=f.ub(N,T),h=f.construct(this.x,this.y);if(d==0)return f.ub(h,N);var o=new f;return o.N(T),o.sub(N),h.sub(N),h.xi(o)/d},f.Wq=function(N,T,d){var h=new sr.Xb;h.set(T.x),h.sub(N.x);var o=new sr.Xb;o.set(d.y),o.sub(N.y);var c=new sr.Xb;c.set(T.y),c.sub(N.y);var u=new sr.Xb;return u.set(d.x),u.sub(N.x),h.Ag(o),c.Ag(u),h.sub(c),h.qs()?(h=new sr.ip(T.x),o=new sr.ip(N.x),c=new sr.ip(N.y),h=h.jt(o),N=(N=new sr.ip(d.y)).jt(c),T=(T=new sr.ip(T.y)).jt(c),d=(d=new sr.ip(d.x)).jt(o),h=h.nr(N),T=T.nr(d),(h=h.nr(T)).dT()?-1:h.XR()?1:0):0>(d=h.value())?-1:0<d?1:0},f.prototype.dc=function(){return sr.P.vj(sr.P.vj())},f}(),sr.h=Bs,function(f){var N=function(){function T(d){this.zy=this.Nt=0,this.CX=d}return T.prototype.reset=function(){this.zy=this.Nt=0},T.prototype.add=function(d){d-=this.zy;var h=this.Nt+d;this.zy=h-this.Nt-d,this.Nt=h},T.prototype.sub=function(d){this.add(-d)},T.prototype.tm=function(){return this.CX+this.Nt},T}();f.Dx=N,f.mc=function(){function T(){}return T.Dn=function(d,h){return 0<=h?Math.abs(d):-Math.abs(d)},T.sign=function(d){return 0>d?-1:0<d?1:0},T.JK=function(d){return d-360*Math.floor(d/360)},T.round=function(d){return Math.floor(d+.5)},T.nx=function(d){return d*d},T.jq=function(d,h,o){return .5>=o?d+(h-d)*o:h-(h-d)*(1-o)},T.GG=function(d,h,o,c){.5>=o?(c.x=d.x+(h.x-d.x)*o,c.y=d.y+(h.y-d.y)*o):(c.x=h.x-(h.x-d.x)*(1-o),c.y=h.y-(h.y-d.y)*(1-o))},T.bT=function(d,h,o,c,u,m){.5>=u?(m.x=d+(o-d)*u,m.y=h+(c-h)*u):(m.x=o-(o-d)*(1-u),m.y=c-(c-h)*(1-u))},T}()}(ae||(ae={})),function(f){var N=function(T){function d(){var h=T.call(this)||this;return h.sa=0,h.oa=0,h.qa=0,h.ma=0,h.la=null,h}return Hi(d,T),d.prototype.ac=function(){return f.h.construct(this.sa,this.oa)},d.prototype.$p=function(h){h.x=this.sa,h.y=this.oa},d.prototype.Ec=function(h){this.gm(0,h)},d.prototype.SB=function(h,o){this.gm(0,f.h.construct(h,o))},d.prototype.Uo=function(h){this.$C(0,h)},d.prototype.setStart=function(h){this.mD(0,h)},d.prototype.xv=function(h,o){return this.Pd(0,h,o)},d.prototype.RB=function(h,o,c){this.vn(0,h,o,c)},d.prototype.xc=function(){return f.h.construct(this.qa,this.ma)},d.prototype.Ur=function(h){h.x=this.qa,h.y=this.ma},d.prototype.Rc=function(h){this.gm(1,h)},d.prototype.Sl=function(h,o){this.gm(1,f.h.construct(h,o))},d.prototype.Qo=function(h){this.$C(1,h)},d.prototype.setEnd=function(h){this.mD(1,h)},d.prototype.hv=function(h,o){return this.Pd(1,h,o)},d.prototype.IB=function(h,o,c){this.vn(1,h,o,c)},d.prototype.Eb=function(){return 1},d.prototype.B=function(){return this.Bc()},d.prototype.Pa=function(){},d.prototype.He=function(){return 0},d.prototype.Fa=function(h,o,c,u,m){return this.CM(h,o,c,u,m)},d.prototype.isIntersecting=function(h,o){return this.Br(h,o,!1)!=0},d.prototype.rs=function(h,o){return this.su(h,o,!1)},d.prototype.su=function(){return null},d.prototype.Bc=function(){return!1},d.prototype.Zx=function(h){if(this.wc(),this.la==null&&0<h)this.la=f.P.lg(2*h);else if(this.la!=null&&this.la.length<2*h){for(var o=this.la.slice(0),c=this.la.length;c<2*h;c++)o[c]=0;this.la=o}},d.ZL=function(h,o,c){if(0<c)var u=0;for(var m=0;m<c;m++)o[0+u]=h[0],u++},d.prototype.gm=function(h,o){h!=0?(this.qa=o.x,this.ma=o.y):(this.sa=o.x,this.oa=o.y)},d.prototype.un=function(h){if(this.la!=null){for(var o=f.ee.Jw(h,this.description),c=[],u=d.Ig(this.description,0),m=d.Ig(this.description,1),g=d.Ig(h,0),v=d.Ig(h,1),w=0,E=1,C=h.Ba;E<C;E++){var R=h.qd(E),I=f.ua.Wa(R);if(o[E]==-1){var F=f.ua.te(R);for(R=0;R<I;R++)c[g+w]=F,c[v+w]=F,w++}else for(F=this.description.$j(o[E])-2,R=0;R<I;R++)c[g+w]=this.la[u+F],c[v+w]=this.la[m+F],w++,F++}this.la=c}this.description=h},d.prototype.$C=function(h,o){if(this.Bc())throw f.i.ga("empty geometry");o.kg(this.description),o.Bc()&&o.up();for(var c=0;c<this.description.Ba;c++)for(var u=this.description.Fd(c),m=0,g=f.ua.Wa(u);m<g;m++){var v=this.Pd(h,u,m);o.setAttribute(u,m,v)}},d.prototype.mD=function(h,o){if(this.wc(),o.Bc())throw f.i.ga("empty geometry");for(var c=o.description,u=0,m=c.Ba;u<m;u++)for(var g=c.Fd(u),v=f.ua.Wa(g),w=0;w<v;w++){var E=o.Vc(g,w);this.vn(h,g,w,E)}},d.prototype.Pd=function(h,o,c){if(this.Bc())throw f.i.ga("This operation was performed on an Empty Geometry.");if(o==0)return h!=0?c!=0?this.ma:this.qa:c!=0?this.oa:this.sa;if(c>=f.ua.Wa(o))throw f.i.re();var u=this.description.Qf(o);return 0<=u?(this.la!=null&&this.Zx(this.description.Be.length-2),this.la[d.Ig(this.description,h)+this.description.$j(u)-2+c]):f.ua.te(o)},d.prototype.vn=function(h,o,c,u){if(this.wc(),c>=f.ua.Wa(o))throw f.i.re();var m=this.description.Qf(o);0>m&&(this.se(o),m=this.description.Qf(o)),o==0?h!=0?c!=0?this.ma=u:this.qa=u:c!=0?this.oa=u:this.sa=u:(this.la==null&&this.Zx(this.description.Be.length-2),this.la[d.Ig(this.description,h)+this.description.$j(m)-2+c]=u)},d.prototype.copyTo=function(h){if(h.K()!=this.K())throw f.i.O();h.description=this.description,h.Zx(this.description.Be.length-2),d.ZL(this.la,h.la,2*(this.description.Be.length-2)),h.sa=this.sa,h.oa=this.oa,h.qa=this.qa,h.ma=this.ma,h.wc(),this.pp(h)},d.prototype.Ug=function(h,o){var c=new f.Oc;return this.Bc()?(c.Pa(),c):(c.pa=this.Pd(0,h,o),c.wa=c.pa,c.Lk(this.Pd(1,h,o)),c)},d.prototype.RI=function(h){this.Bc()?h.Pa():(h.pa=this.Pd(0,0,0),h.wa=h.pa,h.Lk(this.Pd(1,0,0)))},d.prototype.Uw=function(h,o){o.kg(this.description),o.Db(this.ic(h));for(var c=1,u=this.description.Ba;c<u;c++)for(var m=this.description.Fd(c),g=f.ua.Wa(m),v=0;v<g;v++){var w=this.Vc(h,m,v);o.setAttribute(m,v,w)}},d.prototype.xM=function(h){if(this.description!=h.description||this.sa!=h.sa||this.qa!=h.qa||this.oa!=h.oa||this.ma!=h.ma)return!1;for(var o=0;o<2*(this.description.Be.length-2);o++)if(this.la[o]!=h.la[o])return!1;return!0},d.prototype.tG=function(){return this.sa==this.qa&&this.oa==this.ma},d.prototype.reverse=function(){var h=this.sa;this.sa=this.qa,this.qa=h,h=this.oa,this.oa=this.ma,this.ma=h,h=1;for(var o=this.description.Ba;h<o;h++)for(var c=this.description.qd(h),u=0,m=f.ua.Wa(c);u<m;u++){var g=this.Pd(0,c,u),v=this.Pd(1,c,u);this.vn(0,c,u,v),this.vn(1,c,u,g)}},d.prototype.Br=function(h,o,c){var u=h.K();if(this.K()===322){if(u==322)return f.zb.GM(this,h,o,c);throw f.i.Ra()}throw f.i.Ra()},d.prototype.CM=function(h,o,c,u,m){var g=h.K();if(this.K()===322){if(g==322)return f.zb.Xx(this,h,o,c,u,m);throw f.i.Ra()}throw f.i.Ra()},d.prototype.Rx=function(){return null},d.Ig=function(h,o){return o*(h.Be.length-2)},d.prototype.ic=function(h,o){if(o===void 0)return o=new f.h,this.ic(h,o),o;f.mc.bT(this.sa,this.oa,this.qa,this.ma,h,o)},d.prototype.fe=function(){return null},d.prototype.XF=function(){return null},d.prototype.fq=function(){return null},d.prototype.Ci=function(){return null},d.prototype.Qn=function(){return null},d.prototype.jg=function(){return null},d.prototype.Sx=function(h,o){return o!==void 0?this.tx(o)-this.tx(h):this.tx(h)},d.prototype.pp=function(){},d.prototype.el=function(){return null},d.prototype.bh=function(){},d.prototype.Vc=function(){return null},d.prototype.Me=function(){return null},d.prototype.tx=function(){return null},d.prototype.FG=function(){return null},d.prototype.ub=function(h,o){if(!o&&this.Br(h,0,!1)!=0)return 0;o=17976931348623157e292;var c=this.ac(),u=h.fe(c,!1);return c.sub(h.ic(u)),(c=c.length())<o&&(o=c),c=this.xc(),u=h.fe(c,!1),c.sub(h.ic(u)),(c=c.length())<o&&(o=c),c=h.ac(),u=this.fe(c,!1),c.sub(this.ic(u)),(c=c.length())<o&&(o=c),c=h.xc(),u=this.fe(c,!1),c.sub(this.ic(u)),(c=c.length())<o&&(o=c),o},d.prototype.mg=function(){return f.ri.im(this,null)},d}(f.ba);f.KC=N}(ae||(ae={})),new ae.h,function(f){var N;(N=f.SK||(f.SK={}))[N.Unknown=-1]="Unknown",N[N.Not=0]="Not",N[N.Weak=1]="Weak",N[N.Strong=2]="Strong",function(d){d[d.DirtyIsKnownSimple=1]="DirtyIsKnownSimple",d[d.IsWeakSimple=2]="IsWeakSimple",d[d.IsStrongSimple=4]="IsStrongSimple",d[d.DirtyOGCFlags=8]="DirtyOGCFlags",d[d.DirtyVerifiedStreams=32]="DirtyVerifiedStreams",d[d.DirtyExactIntervals=64]="DirtyExactIntervals",d[d.DirtyLooseIntervals=128]="DirtyLooseIntervals",d[d.DirtyIntervals=192]="DirtyIntervals",d[d.DirtyIsEnvelope=256]="DirtyIsEnvelope",d[d.DirtyLength2D=512]="DirtyLength2D",d[d.DirtyRingAreas2D=1024]="DirtyRingAreas2D",d[d.DirtyCoordinates=1993]="DirtyCoordinates",d[d.DirtyAllInternal=65535]="DirtyAllInternal",d[d.DirtyAll=16777215]="DirtyAll"}(f.EK||(f.EK={}));var T=function(d){function h(){var o=d.call(this)||this;return o.Jm=65535,o.xa=0,o.Qg=-1,o.Cb=null,o}return Hi(h,d),h.prototype.pp=function(){},h.prototype.Yx=function(){},h.prototype.dy=function(){},h.prototype.I=function(){return this.xa},h.prototype.B=function(){return this.Bc()},h.prototype.Bc=function(){return this.xa==0},h.prototype.ak=function(o){return(this.Jm&o)!=0},h.prototype.Nf=function(o,c){this.Jm=c?this.Jm|o:this.Jm&~o},h.prototype.rc=function(){this.ak(32)&&this.UM()},h.prototype.ux=function(){if(this.Bc())throw f.i.ga("This operation was performed on an Empty Geometry.")},h.prototype.we=function(o,c){if(0>o||o>=this.xa)throw f.i.ga("index out of bounds");this.rc(),c.kg(this.description),c.B()&&c.up();for(var u=0;u<this.description.Ba;u++)for(var m=this.description.Fd(u),g=0,v=f.ua.Wa(m);g<v;g++){var w=this.Aa[u].Bg(v*o+g);c.setAttribute(m,g,w)}},h.prototype.Ht=function(o,c){this.rc();for(var u=c.description,m=0;m<u.Ba;m++)for(var g=u.Fd(m),v=f.ua.Wa(g),w=0;w<v;w++){var E=c.Vc(g,w);this.setAttribute(g,o,w,E)}},h.prototype.D=function(o,c){if(0>o||o>=this.I())throw f.i.re();this.rc(),this.Aa[0].uc(2*o,c)},h.prototype.Oa=function(o){var c=new f.h;return this.D(o,c),c},h.prototype.Hc=function(o,c){this.Aa[0].uc(2*o,c)},h.prototype.Db=function(o,c,u){if(0>o||o>=this.xa)throw f.i.re();this.rc();var m=this.Aa[0];u!==void 0?(m.write(2*o,c),m.write(2*o+1,u)):m.Ut(2*o,c),this.Qc(1993)},h.prototype.xz=function(){if(void 0>=this.I())throw f.i.re();this.rc();var o=this.Aa[0],c=new f.Od;return c.x=o.read(NaN),c.y=o.read(NaN),c.z=this.hasAttribute(1)?this.Aa[1].Bg(void 0):f.ua.te(1),c},h.prototype.XB=function(o){if(0>o||o>=this.I())throw f.i.re();this.se(1),this.rc(),this.Qc(1993);var c=this.Aa[0];c.write(2*o,(void 0).x),c.write(2*o+1,(void 0).y),this.Aa[1].rr(o,(void 0).z)},h.prototype.Vc=function(o,c,u){if(0>c||c>=this.xa)throw f.i.re();var m=f.ua.Wa(o);if(u>=m)throw f.i.re();this.rc();var g=this.description.Qf(o);return 0<=g?this.Aa[g].Bg(c*m+u):f.ua.te(o)},h.prototype.qF=function(o,c){return this.Vc(o,c,void 0)},h.prototype.setAttribute=function(o,c,u,m){if(0>c||c>=this.xa)throw f.i.re();var g=f.ua.Wa(o);if(u>=g)throw f.i.re();this.se(o),this.rc(),o=this.description.Qf(o),this.Qc(1993),this.Aa[o].rr(c*g+u,m)},h.prototype.vb=function(o){return this.ux(),this.se(o),this.rc(),this.Aa[this.description.Qf(o)]},h.prototype.kn=function(o,c){if(c!=null&&f.ua.Vp(o)!=c.Vp())throw f.i.O();this.se(o),o=this.description.Qf(o),this.Aa==null&&(this.Aa=f.Zc.iI(this.description.Ba)),this.Aa[o]=c,this.Qc(16777215)},h.prototype.un=function(o){var c=null;if(this.Aa!=null){var u=f.ee.Jw(o,this.description);c=[];for(var m=0,g=o.Ba;m<g;m++)u[m]!=-1&&(c[m]=this.Aa[u[m]])}this.description=o,this.Aa=c,this.Qg=-1,this.Qc(16777215)},h.prototype.sD=function(o){this.xu(!0),o instanceof f.l?this.aa.A(o):this.aa.Ro(o)},h.prototype.TM=function(o){this.xu(!1),o instanceof f.l?this.aa.A(o):this.aa.Ro(o)},h.prototype.dn=function(o){this.xu(!0),this.aa.copyTo(o)},h.prototype.A=function(o){this.sD(o)},h.prototype.Ro=function(o){this.sD(o)},h.prototype.yc=function(o){this.TM(o)},h.prototype.Ug=function(o,c){var u=new f.Oc;return this.Bc()?(u.Pa(),u):(this.xu(!0),this.aa.Ug(o,c))},h.prototype.dc=function(){var o=this.description.dc();if(!this.Bc())for(var c=this.I(),u=0,m=this.description.Ba;u<m;u++)o=this.Aa[u].Bn(o,0,c*f.ua.Wa(this.description.Fd(u)));return o},h.prototype.Nb=function(o){if(o==this)return!0;if(!(o instanceof h&&this.description.Nb(o.description))||this.Bc()!=o.Bc())return!1;if(this.Bc())return!0;var c=this.I();if(c!=o.I())return!1;for(var u=0;u<this.description.Ba;u++){var m=this.description.qd(u),g=this.vb(m),v=o.vb(m);if(!g.Nb(v,0,c*f.ua.Wa(m)))return!1}return!0},h.prototype.copyTo=function(o){if(o.K()!=this.K())throw f.i.O();this.WC(o)},h.prototype.WC=function(o){this.rc(),o.description=this.description,o.Aa=null;var c=this.description.Ba,u=null;if(this.Aa!=null){u=[];for(var m=0;m<c;m++)this.Aa[m]!=null&&(u[m]=this.Aa[m].AB(this.I()*f.ua.Wa(this.description.Fd(m))))}this.aa!=null?(o.aa=this.aa.Ja(),this.aa.copyTo(o.aa)):o.aa=null,o.xa=this.xa,o.Jm=this.Jm,o.Aa=u;try{this.pp(o)}catch{throw o.Pa(),f.i.gu()}},h.prototype.oD=function(){this.xa=0,this.Qg=-1,this.Aa=null,this.Qc(16777215)},h.prototype.Qc=function(o){o==16777215&&(this.Qg=-1,this.Yx()),this.Jm|=o,this.dM(),this.wc()},h.prototype.xu=function(o){if(this.rc(),this.ak(192))if(this.aa==null?this.aa=new f.Gh(this.description):this.aa.kg(this.description),this.B())this.aa.Pa();else{this.cy(o);for(var c=1;c<this.description.Ba;c++)for(var u=this.description.Fd(c),m=f.ua.Wa(u),g=this.Aa[c],v=0;v<m;v++){var w=new f.Oc;w.Pa();for(var E=0;E<this.xa;E++){var C=g.Bg(E*m+v);w.$b(C)}this.aa.setInterval(u,v,w)}o&&this.Nf(192,!1)}},h.prototype.cy=function(){this.aa.Pa();for(var o=this.Aa[0],c=new f.h,u=0;u<this.xa;u++)o.uc(2*u,c),this.aa.$b(c)},h.prototype.Ap=function(o){o.Pa();for(var c=this.Aa[0],u=new f.h,m=0;m<this.xa;m++)c.uc(2*m,u),o.$b(u)},h.prototype.UM=function(){if(this.Qg<this.xa){this.Aa==null&&(this.Aa=f.Zc.iI(this.description.Ba)),this.Qg=2147483647;for(var o=0;o<this.description.Ba;o++){var c=this.description.Fd(o);if(this.Aa[o]!=null){var u=f.ua.Wa(c),m=f.P.truncate(this.Aa[o].size/u);m<this.xa&&(m=f.P.truncate(this.Qg>this.xa+5?(5*this.xa+3)/4:this.xa),this.Aa[o].resize(m*u,f.ua.te(c))),m<this.Qg&&(this.Qg=m)}else this.Aa[o]=f.Zc.QE(c,this.xa),this.Qg=this.xa}}this.dy(),this.Nf(32,!1)},h.prototype.fm=function(o){if(0>o)throw f.i.O();o!=this.xa&&(this.xa=o,this.Qc(65535))},h.prototype.qm=function(o){if(!this.ak(1)){if(!this.ak(2))return 0;if(this.GT>=o)return this.ak(8)?1:2}return-1},h.prototype.Dh=function(o,c){if(this.GT=c,o==-1)this.Nf(1,!0),this.Nf(8,!0);else if(this.Nf(1,!1),this.Nf(8,!0),o==0)this.Nf(2,!1),this.Nf(4,!1);else if(o==1)this.Nf(2,!0),this.Nf(4,!1);else{if(o!=2)throw f.i.ga("internal error.");this.Nf(2,!0),this.Nf(4,!0)}},h.prototype.dM=function(){this.Cb!=null&&(this.Cb=null)},h.prototype.cD=function(o,c,u,m){if(0>o||o>=this.xa||0>c||c>=this.xa)throw f.i.ga("index out of bounds");this.rc(),m.kg(this.description),m.B()&&m.up();for(var g=0;g<this.description.Ba;g++)for(var v=this.description.Fd(g),w=0,E=f.ua.Wa(v);w<E;w++){var C=this.Aa[g].Bg(E*o+w),R=this.Aa[g].Bg(E*c+w);m.setAttribute(v,w,f.mc.jq(C,R,u))}},h.prototype.Ar=function(o,c){var u=this.Aa[0].o,m=u[2*o]-u[2*c];return o=u[2*o+1]-u[2*c+1],Math.sqrt(m*m+o*o)},h.prototype.Eh=function(o,c){if(0>o||o>=this.xa)throw f.i.re();if(c.B())throw f.i.O();this.rc();for(var u=c.description,m=0;m<u.Ba;m++)for(var g=u.qd(m),v=f.ua.Wa(g),w=0;w<v;w++){var E=c.Vc(g,w);this.setAttribute(g,o,w,E)}},h.prototype.mu=function(){return null},h.prototype.gj=function(){return null},h}(f.ba);f.Ex=T}(ae||(ae={})),function(f){var N=function(){function T(){this.ob=this.$n=null,this.Vm=124234251,this.Sv=!0,this.Ne=-1,this.ob=new f.ad(7),this.$n=null}return T.prototype.Wo=function(d){this.$n=d},T.prototype.JP=function(){this.Sv=!1},T.prototype.Ee=function(d){this.ob.Ee(d)},T.prototype.Qr=function(d){var h=this.ob.De();return this.fX(h),this.iX(d,h),h},T.prototype.EP=function(d){this.ob.kd(d)},T.prototype.addElement=function(d,h){return h==-1&&(this.Ne==-1&&(this.Ne=this.Qr(-1)),h=this.Ne),this.xD(d,0,h)},T.prototype.BD=function(d){return this.Ne==-1&&(this.Ne=this.Qr(-1)),this.xD(d,1,this.Ne)},T.prototype.yn=function(d){this.Ne==-1&&(this.Ne=this.Qr(-1));var h=this.Ne,o=this.ob.o;if(h==-1||o[7*h]==-1)return d=this.ob.Nl([-1,-1,-1,d,this.il(),-1,-1]),(o=this.ob.o)[7*h]=d,this.xp(-1,d,h,o),d;var c=h==-1?-1:o[7*h+2];return d=this.ob.Nl([-1,-1,c,d,this.il(),-1,-1]),(o=this.ob.o)[7*c+1]=d,this.jy(d,o),o[7*d+2]===-1&&(o[7*h]=d),this.xp(-1,d,h,o),d},T.prototype.Au=function(d,h,o,c){var u=-1;u==-1&&(this.Ne==-1&&(this.Ne=this.Qr(-1)),u=this.Ne);var m=this.ob.o;if(u==-1||m[7*u]==-1)return o=this.ob.Nl([-1,-1,-1,o,this.il(),-1,-1]),(m=this.ob.o)[7*u]=o,this.xp(-1,o,u,m),o;if(c){c=h!=-1?this.$n.compare(this,o,h):-1;var g=d!=-1?this.$n.compare(this,o,d):1}else c=-1,g=1;if(c==0||g==0)return m[7*u+3]=c==0?h:d,-1;for((h!=-1&&d!=-1?this.Vm>f.P.WA(this.Vm)>>1:h!=-1)?d=h:c=g,h=!0;;){if(0>c){if((g=m[7*d])==-1){c=d,o=this.ob.Nl([-1,-1,d,o,this.il(),-1,-1]),(m=this.ob.o)[7*d]=o;break}d=g}else{if((g=m[7*d+1])==-1){c=m[7*d+6],o=this.ob.Nl([-1,-1,d,o,this.il(),-1,-1]),(m=this.ob.o)[7*d+1]=o;break}d=g}h&&(c*=-1,h=!1)}return this.jy(o,m),m[7*o+2]===-1&&(m[7*u]=o),this.xp(c,o,u,m),o},T.prototype.xF=function(){return this.aR(this.Ne)},T.prototype.wd=function(d,h){h=h==-1?this.Ne:h,this.Sv?this.DP(d,h):this.XX(d,h)},T.prototype.search=function(d,h){for(h=this.tv(h);h!=-1;){var o=this.$n.compare(this,d,h);if(o==0)return h;h=0>o?this.nl(h):this.Zp(h)}return-1},T.prototype.xW=function(d){for(var h=this.tv(-1),o=-1;h!=-1;){var c=d.compare(this,h);if(c==0)return h;0>c?h=this.nl(h):(o=h,h=this.Zp(h))}return o},T.prototype.mJ=function(d){for(var h=this.tv(-1),o=-1;h!=-1;){var c=d.compare(this,h);if(c==0)return h;0>c?(o=h,h=this.nl(h)):h=this.Zp(h)}return o},T.prototype.ka=function(d){return this.ob.U(d,3)},T.prototype.nl=function(d){return this.ob.U(d,0)},T.prototype.Zp=function(d){return this.ob.U(d,1)},T.prototype.getParent=function(d){return this.ob.U(d,2)},T.prototype.lb=function(d){return this.ob.U(d,6)},T.prototype.xe=function(d){return this.ob.U(d,5)},T.prototype.sc=function(d){return d==-1?this.ml(this.Ne):this.ml(d)},T.prototype.Gc=function(d){return d==-1?this.$r(this.Ne):this.$r(d)},T.prototype.QR=function(d){return d==-1?this.UF(this.Ne):this.UF(d)},T.prototype.Tj=function(d,h){this.HB(d,h)},T.prototype.tv=function(d){return d==-1?this.QF(this.Ne):this.QF(d)},T.prototype.clear=function(){this.ob.nj(!1),this.Ne=-1},T.prototype.size=function(d){return d==-1?this.SF(this.Ne):this.SF(d)},T.prototype.CN=function(d,h){for(var o=h[7*d],c=h[7*d+1],u=h[7*d+4];o!=-1||c!=-1;){var m=o!=-1?h[7*o+4]:2147483647;if(c=c!=-1?h[7*c+4]:2147483647,u<=Math.min(m,c))break;m<=c?this.kJ(o,h):this.jJ(d,h),o=h[7*d],c=h[7*d+1]}},T.prototype.jy=function(d,h){if(this.Sv)for(var o=h[7*d+4],c=h[7*d+2];c!=-1&&h[7*c+4]>o;)h[7*c]==d?this.kJ(d,h):this.jJ(c,h),c=h[7*d+2]},T.prototype.jJ=function(d,h){var o=h[7*d+1];h[7*o+2]=h[7*d+2],h[7*d+2]=o;var c=h[7*o];h[7*d+1]=c,c!=-1&&(h[7*c+2]=d),h[7*o]=d,(c=h[7*o+2])!=-1&&(h[7*c]==d?h[7*c]=o:h[7*c+1]=o)},T.prototype.kJ=function(d,h){var o=h[7*d+2];h[7*d+2]=h[7*o+2],h[7*o+2]=d;var c=h[7*d+1];h[7*o]=c,c!=-1&&(h[7*c+2]=o),h[7*d+1]=o,(c=h[7*d+2])!=-1&&(h[7*c]===o?h[7*c]=d:h[7*c+1]=d)},T.prototype.Pk=function(d,h){this.ob.T(d,2,h)},T.prototype.MB=function(d,h){this.ob.T(d,0,h)},T.prototype.QB=function(d,h){this.ob.T(d,1,h)},T.prototype.PB=function(d,h){this.ob.T(d,5,h)},T.prototype.ex=function(d,h){this.ob.T(d,6,h)},T.prototype.PJ=function(d,h){this.ob.T(h,0,d)},T.prototype.fX=function(d){this.ob.T(d,4,0)},T.prototype.iX=function(d,h){this.ob.T(h,5,d)},T.prototype.QF=function(d){return d==-1?-1:this.ob.U(d,0)},T.prototype.ml=function(d){return d==-1?-1:this.ob.U(d,1)},T.prototype.$r=function(d){return d==-1?-1:this.ob.U(d,2)},T.prototype.aR=function(d){return d==-1?-1:this.ob.U(d,3)},T.prototype.SF=function(d){return d==-1?0:this.ob.U(d,4)},T.prototype.UF=function(d){return this.ob.U(d,5)},T.prototype.Qw=function(){return this.ob.Nl([-1,-1,-1,void 0,this.il(),-1,-1])},T.prototype.hl=function(d){d!=-1&&this.ob.kd(d)},T.prototype.il=function(){return this.Vm=f.P.WA(this.Vm),1073741823&this.Vm},T.prototype.xD=function(d,h,o){var c=this.ob.o;if(o==-1||c[7*o]==-1)return d=this.ob.Nl([-1,-1,-1,d,this.il(),-1,-1]),(c=this.ob.o)[7*o]=d,this.xp(-1,d,o,c),d;for(var u=o==-1?-1:c[7*o];;){var m=h==-1?1:this.$n.compare(this,d,u);if(0>m){if((m=this.nl(u))==-1){h=u,d=this.ob.Nl([-1,-1,u,d,this.il(),-1,-1]),(c=this.ob.o)[7*u]=d;break}u=m}else{if(h==1&&m==0)return c[7*o+3]=u,-1;if((m=c[7*u+1])==-1){h=c[7*u+6],d=this.ob.Nl([-1,-1,u,d,this.il(),-1,-1]),(c=this.ob.o)[7*u+1]=d;break}u=m}}return this.jy(d,c),c[7*d+2]===-1&&(c[7*o]=d),this.xp(h,d,o,c),d},T.prototype.xp=function(d,h,o,c){if(d!=-1){var u=c[7*d+5];c[7*d+5]=h}else u=o==-1?-1:c[7*o+2];c[7*h+5]=u,u!=-1&&(c[7*u+6]=h),c[7*h+6]=d,d==(o==-1?-1:c[7*o+1])&&(c[7*o+1]=h),d==-1&&(c[7*o+2]=h),c[7*o+4]=(o==-1?0:c[7*o+4])+1},T.prototype.uB=function(d,h){var o=this.ob.o,c=o[7*d+5];d=o[7*d+6],c!=-1?o[7*c+6]=d:o[7*h+1]=d,d!=-1?o[7*d+5]=c:o[7*h+2]=c,o[7*h+4]=h===-1?-1:o[7*h+4]-1},T.prototype.XX=function(d,h){this.uB(d,h);var o=this.nl(d),c=this.Zp(d),u=this.getParent(d),m=d;if(o!=-1&&c!=-1){this.Vm=f.P.WA(this.Vm);var g=1073741823<this.Vm?this.lb(d):this.xe(d),v=this.getParent(g)==d;this.ob.$B(d,g,0),this.ob.$B(d,g,1),this.ob.$B(d,g,2),u!=-1?this.nl(u)==d?this.MB(u,g):this.QB(u,g):this.PJ(g,h),v?(o==g?(this.MB(g,d),this.Pk(c,g)):c==g&&(this.QB(g,d),this.Pk(o,g)),this.Pk(d,g),u=g):(this.Pk(o,g),this.Pk(c,g),u=this.getParent(d),m=g),o=this.nl(d),c=this.Zp(d),o!=-1&&this.Pk(o,d),c!=-1&&this.Pk(c,d)}o=o!=-1?o:c,u==-1?this.PJ(o,h):this.nl(u)==m?this.MB(u,o):this.QB(u,o),o!=-1&&this.Pk(o,u),this.hl(d)},T.prototype.DP=function(d,h){var o=this.ob.o;o[7*d+4]=2147483647;var c=-1,u=-1,m=h===-1?-1:o[7*h],g=m==d;if(g&&(c=o[7*m],u=o[7*m+1],c==-1&&u==-1))return this.uB(m,h),this.hl(m),void(o[7*h]=-1);this.CN(d,o),(m=o[7*d+2])!=-1&&(o[7*m]==d?o[7*m]=-1:o[7*m+1]=-1),this.uB(d,h),this.hl(d),g&&(o[7*h]=c==-1||o[7*c+2]!=-1?u:c)},T.prototype.HB=function(d,h){this.ob.T(d,3,h)},T}();f.Yj=N}(ae||(ae={})),function(f){var N=function(){function T(d,h){d!==void 0&&this.L(d,h)}return T.prototype.L=function(d,h){this.pa=d,this.wa=h,this.normalize()},T.prototype.isIntersecting=function(d){return this.pa<=d.pa?this.wa>=d.pa:d.wa>=this.pa},T.prototype.move=function(d){this.B()||(this.pa+=d,this.wa+=d)},T.prototype.normalize=function(){if(!isNaN(this.pa)){if(this.pa>this.wa){var d=this.pa;this.pa=this.wa,this.wa=d}isNaN(this.wa)&&this.Pa()}},T.prototype.Pa=function(){this.wa=this.pa=NaN},T.prototype.B=function(){return isNaN(this.pa)},T.prototype.$b=function(d){typeof d=="number"?this.B()?this.wa=this.pa=d:this.Lk(d):d.B()||(this.B()?(this.pa=d.pa,this.wa=d.wa):(this.pa>d.pa&&(this.pa=d.pa),this.wa<d.wa&&(this.wa=d.wa),this.pa>this.wa&&this.Pa()))},T.prototype.Lk=function(d){d<this.pa?this.pa=d:d>this.wa&&(this.wa=d)},T.prototype.contains=function(d){return typeof d=="number"?d>=this.pa&&d<=this.wa:d.pa>=this.pa&&d.wa<=this.wa},T.prototype.Fa=function(d){this.B()||d.B()?this.Pa():(this.pa<d.pa&&(this.pa=d.pa),this.wa>d.wa&&(this.wa=d.wa),this.pa>this.wa&&this.Pa())},T.prototype.X=function(d){this.B()||(this.pa-=d,this.wa+=d,this.wa<this.pa&&this.Pa())},T.prototype.zr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.pa)+Math.abs(this.wa)+1)},T.prototype.EB=function(d,h){d>h?(this.pa=h,this.wa=d):(this.pa=d,this.wa=h)},T.prototype.Jt=function(d){return f.P.Rk(d,this.pa,this.wa)},T.prototype.S=function(){return this.wa-this.pa},T.prototype.tf=function(){return .5*(this.pa+this.wa)},T.prototype.Nb=function(d){return d==this||d instanceof T&&(!(!this.B()||!d.B())||this.pa==d.pa&&this.wa==d.wa)},T.prototype.dc=function(){return f.P.vj(f.P.vj())},T}();f.Oc=N}(ae||(ae={})),function(f){var N=new f.Oc,T=new f.Oc,d=function(){this.ne=null,this.pb=-1,this.tb=new f.zb,this.kA=55555555,this.Uv=this.Wv=!1,this.Vf=new f.Oc,this.Vf.EB(0,0)};f.xY=d;var h=function(){function o(c,u,m){this.g=c,this.Hk=NaN,this.FH=this.Mq=0,this.GH=NaN,this.ra=u,this.Pq=10*u,this.HH=this.IH=NaN,this.rg=!1,this.Fm=this.gt=this.Mo=this.Ys=this.Xs=-1,this.bA=m,this.NA=new d,this.QH=new d,f.P.truncate(3*c.gd/2)}return o.prototype.eG=function(c,u,m,g){c.ne=g===null?null:g[m[5*u]],c.Uv=c.ne!=null,c.Uv||((g=m[5*u+2])!==-1&&this.g.cW(m[5*u],m[5*g],c.tb),c.ne=c.tb,c.Vf.EB(c.tb.sa,c.tb.qa),c.Vf.wa+=this.ra,c.tb.jI(),c.Wv=c.tb.ma==c.tb.oa,c.Wv||(c.kA=(c.tb.qa-c.tb.sa)/(c.tb.ma-c.tb.oa)))},o.prototype.GO=function(c,u){var m=c.Br(u,this.ra,!0);return m!=0?m==2?this.Ly():this.yi():(c.$p(li),c.Ur(vl),u.$p(Jn),u.Ur(_l),Os.na(this.Mq,this.Hk),li.rb(Jn)&&this.Hk==li.y?0>vl.compare(_l)?Os.N(vl):Os.N(_l):li.rb(_l)&&this.Hk==li.y?0>vl.compare(Jn)?Os.N(vl):Os.N(Jn):Jn.rb(vl)&&this.Hk==Jn.y?0>li.compare(_l)?Os.N(li):Os.N(_l):vl.rb(_l)&&this.Hk==vl.y&&(0>li.compare(Jn)?Os.N(li):Os.N(Jn)),c.Me(Os.y,Os.x)<u.Me(Os.y,Os.x)?-1:1)},o.prototype.EO=function(c,u){if(c.tb.oa==u.tb.oa&&c.tb.sa==u.tb.sa)return c.tb.ma==u.tb.ma&&c.tb.qa==u.tb.qa?this.bA?this.Ly():0:this.HE(c,u);if(c.tb.ma==u.tb.ma&&c.tb.qa==u.tb.qa)return this.GE(c,u);var m=this.GE(c,u);return c=this.HE(c,u),0>m&&0>c?-1:0<m&&0<c?1:this.yi()},o.prototype.AO=function(c,u){if(c.qa>u.qa){if(u.qa>u.sa&&u.ma-u.oa<2*this.ra&&c.wi(u.qa,u.ma,this.ra))return this.yi()}else if((u.ma-u.oa)/(u.qa-u.sa)*(c.qa-c.sa)<this.Pq&&u.wi(c.qa,c.ma,this.ra))return this.yi();return 1},o.prototype.BO=function(c,u){if(c.sa<u.sa){if(u.qa>u.sa&&u.ma-u.oa<2*this.ra&&c.wi(u.qa,u.ma,this.ra))return this.yi()}else if((u.ma-u.oa)/(u.qa-u.sa)*(c.sa-c.qa)<this.Pq&&u.wi(c.sa,c.oa,this.ra))return this.yi();return-1},o.prototype.CO=function(c,u){var m=new f.h;m.vc(u.xc(),u.ac()),m.cr(),m.normalize();var g=new f.h;g.vc(c.ac(),u.ac());var v=new f.h;v.vc(c.xc(),u.ac()),g=g.Rh(m),m=v.Rh(m),v=Math.abs(g);var w=Math.abs(m);if(v<w){if(v<this.Pq&&u.wi(c.sa,c.oa,this.ra))return this.yi()}else if(w<this.Pq&&u.wi(c.qa,c.ma,this.ra))return this.yi();return 0>g&&0>m?-1:0<g&&0<m?1:this.yi()},o.prototype.FE=function(c,u){return c.oa==u.oa&&c.sa==u.sa?this.AO(c,u):c.ma==u.ma&&c.qa==u.qa?this.BO(c,u):this.CO(c,u)},o.prototype.DO=function(c,u){return c.ma==u.ma&&c.qa==u.qa&&c.oa==u.oa&&c.sa==u.sa?this.bA?this.Ly():0:this.yi()},o.prototype.GE=function(c,u){var m=1;if(c.tb.oa<u.tb.oa){m=-1;var g=c;c=u,u=g}c=c.tb,g=u.tb;var v=c.sa-g.sa;u=u.kA*(c.oa-g.oa);var w=this.Pq;return v<u-w?-m:v>u+w?m:g.wi(c.sa,c.oa,this.ra)?this.yi():v<u?-m:m},o.prototype.HE=function(c,u){var m=1;if(u.tb.ma<c.tb.ma){m=-1;var g=c;c=u,u=g}c=c.tb,g=u.tb;var v=c.qa-g.sa;u=u.kA*(c.ma-g.oa);var w=this.Pq;return v<u-w?-m:v>u+w?m:g.wi(c.qa,c.ma,this.ra)?this.yi():v<u?-m:m},o.prototype.Ly=function(){return this.rg=!0,this.Oi=new f.Nd(5,this.Mo,this.gt),-1},o.prototype.yi=function(){return this.rg=!0,this.bA?this.Oi=new f.Nd(4,this.Mo,this.gt):this.gt=this.Mo=this.Ys=this.Xs=-1,-1},o.prototype.FO=function(c,u,m,g){if(this.rg)return-1;var v=this.GH==this.Hk&&this.FH==this.Mq;if(v&&c==this.Xs)var w=this.HH;else w=NaN,this.Xs=-1;return v&&u==this.Ys?v=this.IH:(v=NaN,this.Ys=-1),m.ne.RI(N),g.ne.RI(T),N.wa<T.pa?-1:T.wa<N.pa?1:(this.GH=this.Hk,this.FH=this.Mq,isNaN(w)&&(this.Xs=c,this.HH=w=c=m.ne.Me(this.Hk,this.Mq)),isNaN(v)&&(this.Ys=u,this.IH=v=c=g.ne.Me(this.Hk,this.Mq)),Math.abs(w-v)<=this.ra?this.GO(m.ne,g.ne):w<v?-1:w>v?1:0)},o.prototype.Lr=function(){this.rg=!1},o.prototype.tm=function(){return this.Oi},o.prototype.SJ=function(c,u){this.Hk=c,this.Mq=u,this.gt=this.Mo=this.Ys=this.Xs=-1},o.prototype.compare=function(c,u,m){return this.rg?-1:(c=c.ka(m),this.Fm=m,this.JE(u,u,c,c))},o.prototype.JE=function(c,u,m,g){if(this.Mo==u)var v=this.NA;else this.Mo=u,v=this.NA,this.NA.pb=c,this.eG(v,u,this.g.ud.o,this.g.Te);if(w==null){this.gt=g;var w=this.QH;this.QH.pb=m,this.eG(w,g,this.g.ud.o,this.g.Te)}return v.Uv||w.Uv?this.FO(u,g,v,w):v.Vf.wa<w.Vf.pa?-1:w.Vf.wa<v.Vf.pa?1:(c=v.Wv?1:0,(c|=w.Wv?2:0)==0?this.EO(v,w):c==1?this.FE(v.tb,w.tb):c==2?-1*this.FE(w.tb,v.tb):this.DO(v.tb,w.tb))},o}();f.MC=h}(ae||(ae={})),function(f){var N=function(){function T(d,h){this.g=d,this.ra=h,this.rg=!1,this.Mo=-1,this.Vf=new f.Oc,this.Iq=new f.h,this.Iq.Sc(),this.ie=new f.zb,this.Fm=-1,this.vA=17976931348623157e292}return T.prototype.Lr=function(){this.rg=!1,this.vA=17976931348623157e292},T.prototype.Eh=function(d){this.Iq.N(d)},T.prototype.compare=function(d,h){return this.KE(h,d.ka(h))},T.prototype.KE=function(d,h){var o=this.g.cc(h)!=null;if(o||(this.g.fd(h,this.ie),this.Vf.EB(this.ie.sa,this.ie.qa)),o)throw f.i.ga("not implemented");if(this.Iq.x+this.ra<this.Vf.pa)return-1;if(this.Iq.x-this.ra>this.Vf.wa)return 1;if(this.ie.oa==this.ie.ma)return this.Fm=d,this.rg=!0,0;this.ie.jI(),o=this.ie.ac(),(h=new f.h).vc(this.ie.xc(),o),h.cr();var c=new f.h;return c.vc(this.Iq,o),o=h.Rh(c),(o/=h.length())<10*-this.ra?-1:o>10*this.ra?1:this.ie.rs(this.Iq,this.ra)&&((h=Math.abs(o))<this.vA&&(this.Fm=d,this.vA=h),this.rg=!0,h<.25*this.ra)?0:0>o?-1:1},T}();f.TL=N}(ae||(ae={})),function(f){function N(d,h,o,c){o=new Float64Array(d.subarray(o,c)),d.set(o,h)}var T=function(){function d(h){this.Pb=this.pk=!1,this.o=null;var o=h;2>o&&(o=2),this.o=new Float64Array(o),this.size=h}return d.prototype.rotate=function(h,o,c){if(this.Pb)throw f.i.ga("invalid_call");if(o<h||o>c||h>c)throw f.i.O();h!=o&&c!=o&&(this.oi(h,o-h,1),this.oi(o,c-o,1),this.oi(h,c-h,1))},d.rf=function(h,o){var c=new d(h),u=c.o;if(2>h&&(h=2),o!==0)for(var m=0;m<h;m++)u[m]=o;return c},d.Cn=function(h){var o=new d(0);return o.o=new Float64Array(h.o),o.size=h.size,o},d.Mr=function(h,o){var c=new d(0);return c.size=h.size,c.size>o&&(c.size=o),2>(o=c.size)&&(o=2),c.o=new Float64Array(o),c.o.set(h.o.length<=o?h.o:h.o.subarray(0,o),0),c},d.prototype.Jb=function(h){0>=h||(this.o==null?this.o=new Float64Array(h):h<=this.o.length||(0<this.o.length?((h=new Float64Array(h)).set(this.o),this.o=h):this.o=new Float64Array(h)))},d.prototype.read=function(h){return this.o[h]},d.prototype.uc=function(h,o){o.x=this.o[h],o.y=this.o[h+1]},d.prototype.get=function(h){return this.o[h]},d.prototype.write=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.set=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.Ut=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.add=function(h){this.resize(this.size+1),this.o[this.size-1]=h},d.prototype.AB=function(h){return d.Mr(this,h)},d.prototype.Bg=function(h){return this.read(h)},d.prototype.resize=function(h,o){if(o===void 0&&(o=0),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(h<=this.size){if(30<this.o.length&&5*h/4<this.o.length){var c=new Float64Array(this.o,0,h);this.o=c}}else{h>this.o.length&&(c=f.P.truncate(64>h?Math.max(2*h,4):5*h/4),(c=new Float64Array(c)).set(this.o),this.o=c),c=this.o;for(var u=this.size;u<h;u++)c[u]=o}this.size=h},d.prototype.Ch=function(h){if((this.o==null||h>this.o.length)&&this.resize(h),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=h},d.prototype.rr=function(h,o){this.write(h,o)},d.prototype.Bn=function(h,o,c){for(var u=this.size;o<u&&o<c;o++)h=f.P.vj(this.read(o));return h},d.prototype.Nb=function(h,o,c){if(h==null||!(h instanceof d))return!1;var u=this.size,m=h.size;if(c>u||c>m&&u!=m)return!1;for(c>u&&(c=u);o<c;o++)if(this.read(o)!=h.read(o))return!1;return!0},d.prototype.addRange=function(h,o,c,u,m){if(this.Pb)throw f.i.Hb();if(!u&&(1>m||c%m!=0))throw f.i.O();var g=this.size;if(this.resize(g+c),u)this.o.set(h.o.subarray(o,o+c),g);else{u=c;for(var v=0;v<c;v+=m){u-=m;for(var w=0;w<m;w++)this.o[g+v+w]=h.o[o+u+w]}}},d.prototype.Nn=function(h,o,c,u,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||u%g!=0))throw f.i.O();var w=this.size-v;if(w<u&&this.resize(this.size+u-w),N(this.o,h+u,h,h+(v-h)),this.o==o.o&&h<c&&(c+=u),m)this.o.set(o.o.subarray(c,c+u),h);else for(m=u,v=0;v<u;v+=g)for(m-=g,w=0;w<g;w++)this.o[h+v+w]=o.o[c+m+w]},d.prototype.Dz=function(h,o,c,u,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*u>this.o.length?this.resize(this.size+2*u):this.size+=2*u,N(this.o,h+2*u,h,h+(g-h)),m)for(m=0;m<u;m++)g=o[c++],this.o[h++]=g.x,this.o[h++]=g.y;else{m=0;for(var v=u-1;m<u;++m)g=o[c+v],this.o[h++]=g.x,this.o[h++]=g.y,v--}},d.prototype.Mn=function(h,o,c,u){if(this.Pb)throw f.i.Hb();for(u-=h,N(this.o,h+u,h,h+u),u=0;u<c;u++)this.o[h+u]=o},d.prototype.wj=function(h,o,c){if(this.Pb)throw f.i.Hb();N(this.o,h+2,h,h+(c-h)),this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.Vt=function(h,o,c,u,m,g){if(0>h||0>o||0>u||!m&&(0>=g||o%g!=0)||c.size<u+o)throw f.i.O();if(o!=0)if(this.size<o+h&&this.resize(o+h),c==this)this.Cr(h,o,u,m,g);else if(m)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u++;else if(u=u+o-g,g==1)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u--;else for(m=0,o=f.P.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[h+v]=c.o[u+v];h+=g,u-=g}},d.prototype.Fn=function(h,o,c){if(this.Pb||h+o>this.size)throw f.i.Hb();0<c-(h+o)&&N(this.o,h,h+o,h+(c-(h+o))+o),this.size-=o},d.prototype.oi=function(h,o,c){if(this.Pb||1>c||o%c!=0)throw f.i.Hb();for(var u=o>>1,m=0;m<u;m+=c){o-=c;for(var g=0;g<c;g++){var v=this.o[h+m+g];this.o[h+m+g]=this.o[h+o+g],this.o[h+o+g]=v}}},d.prototype.Xj=function(h,o,c){if(0>o||0>c||0>o||c+o>this.size)throw f.i.O();for(var u=o;u<o+c;u++)this.o[u]=h},d.prototype.Cr=function(h,o,c,u,m){if(!(u&&h==c||(this.o.set(this.o.subarray(c,c+o),h),u)))for(c=h,h=h+o-m,u=0,o=f.P.truncate(o/2);u<o;u++){for(var g=0;g<m;g++){var v=this.o[c+g];this.o[c+g]=this.o[h+g],this.o[h+g]=v}c+=m,h-=m}},d.prototype.oC=function(h,o,c,u,m){if(0>h||0>o||0>u)throw f.i.O();if(o!=0)for(this.size<(o<<1)+h&&this.resize((o<<1)+h),m||(h+=o-1<<1),m=m?2:-2,o+=u;u<o;u++)this.o[h]=c[u].x,this.o[h+1]=c[u].y,h+=m},d.prototype.nC=function(h,o,c){if(0>h||0>o)throw f.i.O();if(o!=0){this.size<(o<<1)+h&&this.resize((o<<1)+h),o+=0;for(var u=0;u<o;u++)this.o[h]=c[u][0],this.o[h+1]=c[u][1],h+=2}},d.prototype.Ww=function(h,o,c,u,m){if(0>h||0>o||0>u||this.size<o+h)throw f.i.O();if(m)for(m=0;m<o;m++)c[u+m]=this.o[h+m];else for(u=u+o-1;h<o;h++)c[u]=this.o[h],u--},d.prototype.oB=function(h,o,c){if(0>h||0>o||this.size<(o>>1)+h)throw f.i.O();if(o!=0){o=0+o;for(var u=0;u<o;u++)c[u][0]=this.o[h],c[u][1]=this.o[h+1],h+=2}},d.prototype.clear=function(h){h?this.resize(0):this.Ch(0)},d.prototype.hx=function(){this.pk=this.Pb=!0},d.prototype.Wd=function(h,o,c){Array.prototype.sort.call(this.o.subarray(h,o),c)},d.prototype.Vp=function(){return 1},d}();f.ce=T}(ae||(ae={})),function(f){function N(d,h,o,c){o=new Int32Array(d.subarray(o,c)),d.set(o,h)}f.fY=function(){this.random=1973};var T=function(){function d(h){this.Pb=this.pk=!1,this.o=null;var o=h;2>o&&(o=2),this.o=new Int32Array(o),this.size=h}return d.prototype.rotate=function(h,o,c){if(this.Pb)throw f.i.ga("invalid_call");if(o<h||o>c||h>c)throw f.i.O();h!=o&&c!=o&&(this.oi(h,o-h,1),this.oi(o,c-o,1),this.oi(h,c-h,1))},d.rf=function(h,o){var c=new d(h),u=c.o;if(2>h&&(h=2),o!==0)for(var m=0;m<h;m++)u[m]=o;return c},d.Cn=function(h){var o=new d(0);return o.o=new Int32Array(h.o),o.size=h.size,o},d.Mr=function(h,o){var c=new d(0);return c.size=h.size,c.size>o&&(c.size=o),2>(o=c.size)&&(o=2),c.o=new Int32Array(o),c.o.set(h.o.length<=o?h.o:h.o.subarray(0,o),0),c},d.prototype.Jb=function(h){0>=h||(this.o==null?this.o=new Int32Array(h):h<=this.o.length||(0<this.o.length?((h=new Int32Array(h)).set(this.o),this.o=h):this.o=new Int32Array(h)))},d.prototype.read=function(h){return this.o[h]},d.prototype.uc=function(h,o){o.x=this.o[h],o.y=this.o[h+1]},d.prototype.get=function(h){return this.o[h]},d.prototype.write=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.set=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.Ut=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.add=function(h){this.resize(this.size+1),this.o[this.size-1]=h},d.prototype.AB=function(h){return d.Mr(this,h)},d.prototype.Bg=function(h){return this.read(h)},d.prototype.resize=function(h,o){if(o===void 0&&(o=0),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(h<=this.size){if(30<this.o.length&&5*h/4<this.o.length){var c=new Int32Array(this.o,0,h);this.o=c}}else{h>this.o.length&&(c=f.P.truncate(64>h?Math.max(2*h,4):5*h/4),(c=new Int32Array(c)).set(this.o),this.o=c),c=this.o;for(var u=this.size;u<h;u++)c[u]=o}this.size=h},d.prototype.Ch=function(h){if((this.o==null||h>this.o.length)&&this.resize(h),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=h},d.prototype.rr=function(h,o){this.write(h,o)},d.prototype.Bn=function(h,o,c){for(var u=this.size;o<u&&o<c;o++)h=f.P.Uh(this.read(o),h);return h},d.prototype.Nb=function(h,o,c){if(h==null||!(h instanceof d))return!1;var u=this.size,m=h.size;if(c>u||c>m&&u!=m)return!1;for(c>u&&(c=u);o<c;o++)if(this.read(o)!=h.read(o))return!1;return!0},d.prototype.addRange=function(h,o,c,u,m){if(this.Pb)throw f.i.Hb();if(!u&&(1>m||c%m!=0))throw f.i.O();var g=this.size;if(this.resize(g+c),u)this.o.set(h.o.subarray(o,o+c),g);else{u=c;for(var v=0;v<c;v+=m){u-=m;for(var w=0;w<m;w++)this.o[g+v+w]=h.o[o+u+w]}}},d.prototype.Nn=function(h,o,c,u,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||u%g!=0))throw f.i.O();if(N(this.o,h+u,h,h+(v-h)),this.o==o.o&&h<c&&(c+=u),m)this.o.set(o.o.subarray(c,c+u),h);else for(m=u,v=0;v<u;v+=g){m-=g;for(var w=0;w<g;w++)this.o[h+v+w]=o.o[c+m+w]}},d.prototype.Dz=function(h,o,c,u,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*u>this.o.length?this.resize(this.size+2*u):this.size+=2*u,N(this.o,h+2*u,h,h+(g-h)),m)for(m=0;m<u;m++)g=o[c++],this.o[h++]=g.x,this.o[h++]=g.y;else{m=0;for(var v=u-1;m<u;++m)g=o[c+v],this.o[h++]=g.x,this.o[h++]=g.y,v--}},d.prototype.Mn=function(h,o,c,u){if(this.Pb)throw f.i.Hb();for(u-=h,N(this.o,h+u,h,h+u),u=0;u<c;u++)this.o[h+u]=o},d.prototype.wj=function(h,o,c){if(this.Pb)throw f.i.Hb();N(this.o,h+2,h,h+(c-h)),this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.Vt=function(h,o,c,u,m,g){if(0>h||0>o||0>u||!m&&(0>=g||o%g!=0)||c.size<u+o)throw f.i.O();if(o!=0)if(this.size<o+h&&this.resize(o+h),c==this)this.Cr(h,o,u,m,g);else if(m)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u++;else if(u=u+o-g,g==1)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u--;else for(m=0,o=f.P.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[h+v]=c.o[u+v];h+=g,u-=g}},d.prototype.Fn=function(h,o,c){if(this.Pb||h+o>this.size)throw f.i.Hb();0<c-(h+o)&&N(this.o,h,h+o,h+(c-(h+o))+o),this.size-=o},d.prototype.oi=function(h,o,c){if(this.Pb||1>c||o%c!=0)throw f.i.Hb();for(var u=o>>1,m=0;m<u;m+=c){o-=c;for(var g=0;g<c;g++){var v=this.o[h+m+g];this.o[h+m+g]=this.o[h+o+g],this.o[h+o+g]=v}}},d.prototype.Xj=function(h,o,c){if(0>o||0>c||0>o||c+o>this.size)throw f.i.O();for(var u=o;u<o+c;u++)this.o[u]=h},d.prototype.Cr=function(h,o,c,u,m){if(!(u&&h==c||(this.o.set(this.o.subarray(c,c+o),h),u)))for(c=h,h=h+o-m,u=0,o=f.P.truncate(o/2);u<o;u++){for(var g=0;g<m;g++){var v=this.o[c+g];this.o[c+g]=this.o[h+g],this.o[h+g]=v}c+=m,h-=m}},d.prototype.oC=function(h,o,c,u,m){if(0>h||0>o||0>u)throw f.i.O();if(o!=0)for(this.size<(o<<1)+h&&this.resize((o<<1)+h),m||(h+=o-1<<1),m=m?2:-2,o+=u;u<o;u++)this.o[h]=c[u].x,this.o[h+1]=c[u].y,h+=m},d.prototype.Ww=function(h,o,c,u,m){if(0>h||0>o||0>u||this.size<o+h)throw f.i.O();if(m)for(m=0;m<o;m++)c[u+m]=this.o[h+m];else for(u=u+o-1;h<o;h++)c[u]=this.o[h],u--},d.prototype.clear=function(h){h?this.resize(0):this.Ch(0)},d.prototype.hx=function(){this.pk=this.Pb=!0},d.prototype.Wd=function(h,o,c){10>o-h?d.jG(this.o,h,o,c):d.kB(this.o,h,o-1,c)},d.prototype.Vp=function(){return 2},d.prototype.Gc=function(){return this.o[this.size-1]},d.prototype.Jf=function(){this.resize(this.size-1)},d.prototype.PW=function(h){this.o[this.size-1]=h},d.prototype.IV=function(h){h<this.size-1&&(this.o[h]=this.o[this.size-1]),this.resize(this.size-1)},d.prototype.dF=function(h){for(var o=0,c=this.size;o<c;o++)if(this.o[o]==h)return o;return-1},d.prototype.$F=function(h){return 0<=this.dF(h)},d.jG=function(h,o,c,u){for(var m=o;m<c;m++){for(var g=h[m],v=m-1;v>=o&&0<u(h[v],g);)h[v+1]=h[v],v--;h[v+1]=g}},d.rx=function(h,o,c){var u=h[c];h[c]=h[o],h[o]=u},d.kB=function(h,o,c,u){if(!(o>=c))for(;;){if(9>c-o){d.jG(h,o,c+1,u);break}var m=h[o];d.rx(h,o,c);for(var g=o,v=o;v<c;v++)0>=u(h[v],m)&&(d.rx(h,g,v),g+=1);d.rx(h,g,c),g-o<c-g?(d.kB(h,o,g-1,u),o=g+1):(d.kB(h,g+1,c,u),c=g-1)}},d}();f.ja=T}(ae||(ae={})),function(f){function N(d,h,o,c){o=new Int8Array(d.subarray(o,c)),d.set(o,h)}var T=function(){function d(h){this.o=null;var o=h;2>o&&(o=2),this.o=new Int8Array(o),this.size=h}return d.prototype.rotate=function(h,o,c){if(this.Pb)throw f.i.ga("invalid_call");if(o<h||o>c||h>c)throw f.i.O();h!=o&&c!=o&&(this.oi(h,o-h,1),this.oi(o,c-o,1),this.oi(h,c-h,1))},d.rf=function(h,o){var c=new d(h),u=c.o;if(2>h&&(h=2),o!==0)for(var m=0;m<h;m++)u[m]=o;return c},d.Cn=function(h){var o=new d(0);return o.o=new Int8Array(h.o),o.size=h.size,o},d.Mr=function(h,o){var c=new d(0);return c.size=h.size,c.size>o&&(c.size=o),2>(o=c.size)&&(o=2),c.o=new Int8Array(o),c.o.set(h.o.length<=o?h.o:h.o.subarray(0,o),0),c},d.prototype.Jb=function(h){0>=h||(this.o==null?this.o=new Int8Array(h):h<=this.o.length||(0<this.o.length?((h=new Int8Array(h)).set(this.o),this.o=h):this.o=new Int8Array(h)))},d.prototype.read=function(h){return this.o[h]},d.prototype.uc=function(h,o){o.x=this.o[h],o.y=this.o[h+1]},d.prototype.get=function(h){return this.o[h]},d.prototype.write=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.set=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o},d.prototype.Ut=function(h,o){if(this.Pb)throw f.i.Hb();this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.add=function(h){this.resize(this.size+1),this.o[this.size-1]=h},d.prototype.AB=function(h){return d.Mr(this,h)},d.prototype.Bg=function(h){return this.read(h)},d.prototype.resize=function(h,o){if(o===void 0&&(o=0),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(h<=this.size){if(30<this.o.length&&5*h/4<this.o.length){var c=new Int8Array(this.o,0,h);this.o=c}}else{h>this.o.length&&(c=f.P.truncate(64>h?Math.max(2*h,4):5*h/4),(c=new Int8Array(c)).set(this.o),this.o=c),c=this.o;for(var u=this.size;u<h;u++)c[u]=o}this.size=h},d.prototype.Ch=function(h){if((this.o==null||h>this.o.length)&&this.resize(h),this.pk)throw f.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=h},d.prototype.rr=function(h,o){this.write(h,o)},d.prototype.Bn=function(h,o,c){for(var u=this.size;o<u&&o<c;o++)h=f.P.Uh(this.read(o),h);return h},d.prototype.Nb=function(h,o,c){if(h==null||!(h instanceof d))return!1;var u=this.size,m=h.size;if(c>u||c>m&&u!=m)return!1;for(c>u&&(c=u);o<c;o++)if(this.read(o)!=h.read(o))return!1;return!0},d.prototype.addRange=function(h,o,c,u,m){if(this.Pb)throw f.i.Hb();if(!u&&(1>m||c%m!=0))throw f.i.O();var g=this.size;if(this.resize(g+c),u)this.o.set(h.o.subarray(o,o+c),g);else{u=c;for(var v=0;v<c;v+=m){u-=m;for(var w=0;w<m;w++)this.o[g+v+w]=h.o[o+u+w]}}},d.prototype.Nn=function(h,o,c,u,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||u%g!=0))throw f.i.O();if(N(this.o,h+u,h,h+(v-h)),this.o==o.o&&h<c&&(c+=u),m)this.o.set(o.o.subarray(c,c+u),h);else for(m=u,v=0;v<u;v+=g){m-=g;for(var w=0;w<g;w++)this.o[h+v+w]=o.o[c+m+w]}},d.prototype.Mn=function(h,o,c,u){if(this.Pb)throw f.i.Hb();for(u-=h,N(this.o,h+u,h,h+u),u=0;u<c;u++)this.o[h+u]=o},d.prototype.Dz=function(h,o,c,u,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*u>this.o.length?this.resize(this.size+2*u):this.size+=2*u,N(this.o,h+2*u,h,h+(g-h)),m)for(m=0;m<u;m++)g=o[c++],this.o[h++]=g.x,this.o[h++]=g.y;else{m=0;for(var v=u-1;m<u;++m)g=o[c+v],this.o[h++]=g.x,this.o[h++]=g.y,v--}},d.prototype.wj=function(h,o,c){if(this.Pb)throw f.i.Hb();N(this.o,h+2,h,h+(c-h)),this.o[h]=o.x,this.o[h+1]=o.y},d.prototype.Vt=function(h,o,c,u,m,g){if(0>h||0>o||0>u||!m&&(0>=g||o%g!=0)||c.size<u+o)throw f.i.O();if(o!=0)if(this.size<o+h&&this.resize(o+h),c==this)this.Cr(h,o,u,m,g);else if(m)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u++;else if(u=u+o-g,g==1)for(m=0;m<o;m++)this.o[h]=c.o[u],h++,u--;else for(m=0,o=f.P.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[h+v]=c.o[u+v];h+=g,u-=g}},d.prototype.Fn=function(h,o,c){if(this.Pb||h+o>this.size)throw f.i.Hb();0<c-(h+o)&&N(this.o,h,h+o,h+(c-(h+o))+o),this.size-=o},d.prototype.oi=function(h,o,c){if(this.Pb||1>c||o%c!=0)throw f.i.Hb();for(var u=o>>1,m=0;m<u;m+=c){o-=c;for(var g=0;g<c;g++){var v=this.o[h+m+g];this.o[h+m+g]=this.o[h+o+g],this.o[h+o+g]=v}}},d.prototype.Xj=function(h,o,c){if(0>o||0>c||0>o||c+o>this.size)throw f.i.O();for(var u=o;u<o+c;u++)this.o[u]=h},d.prototype.Cr=function(h,o,c,u,m){if(!(u&&h==c||(this.o.set(this.o.subarray(c,c+o),h),u)))for(c=h,h=h+o-m,u=0,o=f.P.truncate(o/2);u<o;u++){for(var g=0;g<m;g++){var v=this.o[c+g];this.o[c+g]=this.o[h+g],this.o[h+g]=v}c+=m,h-=m}},d.prototype.oC=function(h,o,c,u,m){if(0>h||0>o||0>u)throw f.i.O();if(o!=0)for(this.size<(o<<1)+h&&this.resize((o<<1)+h),m||(h+=o-1<<1),m=m?2:-2,o+=u;u<o;u++)this.o[h]=c[u].x,this.o[h+1]=c[u].y,h+=m},d.prototype.Ww=function(h,o,c,u,m){if(0>h||0>o||0>u||this.size<o+h)throw f.i.O();if(m)for(m=0;m<o;m++)c[u+m]=this.o[h+m];else for(u=u+o-1;h<o;h++)c[u]=this.o[h],u--},d.prototype.clear=function(h){h?this.resize(0):this.Ch(0)},d.prototype.hx=function(){this.pk=this.Pb=!0},d.prototype.Wd=function(h,o,c){o=this.o.subarray(h,o),Array.prototype.sort.call(o,c),this.o.set(o,h)},d.prototype.rJ=function(h,o){if(this.Pb)throw f.i.ga("invalid call. Attribute Stream is read only.");this.o[h]|=o},d.prototype.CE=function(h,o){if(this.Pb)throw f.i.ga("invalid call. Attribute Stream is read only.");this.o[h]&=~o},d.prototype.Vp=function(){return 1},d}();f.rn=T}(ae||(ae={})),function(f){f.Zc=function(){function N(){}return N.Nr=function(T,d){return f.rn.rf(T,d)},N.En=function(T,d){return f.ce.rf(T,d)},N.hP=function(T,d,h){switch(T){case 1:T=f.ce.rf(d,h);break;case 2:T=f.ja.rf(d,h);break;case 4:T=f.rn.rf(d,h);break;default:throw f.i.Ra()}return T},N.QE=function(T,d){return N.hP(f.ua.Vp(T),d*f.ua.Wa(T),f.ua.te(T))},N.Ph=function(T,d){return f.ja.rf(T,d)},N.iI=function(T){var d,h=[];for(d=0;d<T;d++)h.push(null);return h},N}()}(ae||(ae={})),function(f){f.ha=function(N){N===void 0&&(N=0),this.u=N}}(ae||(ae={})),function(f){f.FL=function(){function N(){}return N.bind=function(T){f.Tc=T.PeDefs,f.qf=T.PeFactory,f.FC=T.PeVertcs,f.fj=T.PeCSTransformations,f.EC=T.PeGTTransformations,f.DL=T.PeGeogtran,f.CL=T.PeFactoryCodechange,f.DC=T.PeGCSExtent,f.Eg=T.PePCSInfo,f.EL=T.PeHorizon,f.BL=T.PeCoordsys,f.mp=T.PeGTlistExtended,f.mp.PE_GTLIST_OPTS_USE_DEFAULT=128,f.qf.initialize(null),f.Kx=T.PeGTlistExtendedEntry,f.qf.fromString(f.Tc.PE_TYPE_UNIT,'UNIT["Meter",1.0]')},N}(),f.qf=null,f.FC=null,f.BL=null,f.EL=null,f.Eg=null,f.mp=null,f.Kx=null,f.DC=null,f.CL=null,f.DL=null,f.Tc=null,f.EC=null,f.fj=null}(ae||(ae={})),function(f){var N=function(){function T(){}return T.Mb=function(d,h){return 0<=h?T.R(d):-T.R(d)},T.R=function(d){return 0>d?-d:d},T.ui=function(d){return 3552713678800501e-30>d},T.CC=function(d,h,o){return T.R(d-h)<=o*(1+(T.R(d)+T.R(h))/2)},T.$=function(d,h){return T.CC(d,h,3552713678800501e-30)},T.xL=function(d){return 3552713678800501e-30>=T.R(d)},T.Dd=function(d){return T.xL(d)},T}();f.s=N,f.F=function(){function T(){}return T.hp=function(d,h){var o=0;return(d=N.R(d))+(h=N.R(h))!=0&&(d>h?(o=h/d,o=d*Math.sqrt(1+o*o)):(o=d/h,o=h*Math.sqrt(1+o*o))),o},T.Yq=function(d,h,o,c,u){for(var m=[0,0,0],g=[0,0,0],v=0;2>=v;v++)h[v]-=d[v],o[v]-=h[v];o=m[1]*g[2]-m[2]*g[1],h=m[2]*g[0]-m[0]*g[2],m=m[0]*g[1]-m[1]*g[0],d=-1*(o*d[0]+h*d[1]+m*d[2]),c[0]=o,c[1]=h,c[2]=m,c[3]=d,g=T.qn(c),c[0]/=g,c[1]/=g,c[2]/=g,c[3]/=g,u!=0&&(g=N.Dd(m)?N.Dd(d)?N.Mb(1,h):-N.Mb(1,d):N.Mb(1,m),g*=N.Mb(1,u),c[0]*=g,c[1]*=g,c[2]*=g,c[3]*=g)},T.xx=function(d,h,o){o[0]=d[1]*h[2]-h[1]*d[2],o[1]=d[2]*h[0]-h[2]*d[0],o[2]=d[0]*h[1]-h[0]*d[1]},T.Tt=function(d,h){return d[0]*h[0]+d[1]*h[1]+d[2]*h[2]},T.qn=function(d){return T.hp(T.hp(d[0],d[1]),d[2])},T.dl=function(d,h,o,c,u,m,g,v){d=T.n(d,h,o);var w=Math.cos(o);m.u=(d+u)*w*Math.cos(c),g.u=(d+u)*w*Math.sin(c),v.u=(d*(1-h)+u)*Math.sin(o)},T.bO=function(d,h,o,c,u,m,g){var v=T.hp(h,o),w=1*Math.sqrt(1-d),E=w/1;if(N.$(v,0))m.u=0,u.u=N.Mb(1.570796326794897,c),g.u=N.R(c)-w;else{m.u=Math.atan2(o,h),o=Math.atan2(1*c,w*v),m=Math.cos(o);var C=Math.sin(o);h=w*d/(1-d),d*=1,o=Math.atan2(c+h*C*C*C,v-d*m*m*m),3.141592653589793<N.R(o)&&(o=N.Mb(3.141592653589793,o)-o),o=Math.atan(E*Math.tan(o)),C=Math.sin(o),m=Math.cos(o),u.u=Math.atan2(c+h*C*C*C,v-d*m*m*m),1.570796326794897<N.R(u.u)&&(u.u=N.Mb(3.141592653589793,u.u)-u.u),o=Math.atan(E*Math.tan(u.u)),C=Math.sin(o),m=Math.cos(o),g.u=(c-w*C)*Math.sin(u.u)+(v-1*m)*Math.cos(u.u)}},T.n=function(d,h,o){return o=Math.sin(o),d/Math.sqrt(1-h*o*o)},T.ot=function(d,h){return Math.atan2(Math.sin(h)*(1-d),Math.cos(h))},T.Rj=function(d,h){return Math.atan2(Math.sin(h),Math.cos(h)*(1-d))},T.Tq=function(d,h){if(N.ui(d)||h==0||N.$(N.R(h),1.570796326794897))return h;if(.006884661117170036>d){var o=Math.sqrt(1-d),c=(1-o)/(1+o),u=c*c,m=c*u,g=c*m,v=c*g,w=c*v,E=c*w,C=1.572916666666667*m-3.2578125*v+4.295068359375*E;d=2.142578125*g-6.071484375*w,o=3.129296875*v-11.249837239583334*E;var R=4.775276692708333*w,I=7.958636765252976*E,F=Math.cos(2*h);return h+Math.sin(2*h)*(1.5*c-.84375*m+.525390625*v-.2688395182291667*E-C+o-I+F*(2*(1.3125*u-1.71875*g+1.650146484375*w)-4*d+6*R+F*(4*C-12*o+24*I+F*(8*d-32*R+F*(16*o-80*I+F*(32*R+64*F*I))))))}for(o=1-d,c=d/2,m=(u=N.R(h))*T.$u(d)/(1.570796326794897*o),g=9999,w=u,u=0;1e-16<g&&50>u;u++)E=T.w(d,w),v=w-(C=(v=(T.cG(w,d)-c*Math.sin(2*w)/E)/o-m)/(E=1/(E*E*E))),g=N.R(C),w=v;return 0<=h?w:-w},T.gW=function(d,h){return N.ui(h)?d:d*T.$u(h)/1.570796326794897},T.ca=function(d){return 0>(d=T.hF(d,6.283185307179586))?d+6.283185307179586:3.141592653589793>N.R(d)||N.$(N.R(d),3.141592653589793)?d:d-6.283185307179586},T.hF=function(d,h){return d-Math.floor(d/h)*h},T.Bh=function(d,h){if(.006884661117170036>h){var o=(h=(1-(h=Math.sqrt(1-h)))/(1+h))*h,c=o*o;return d/(1+h)*(1+.25*o+.015625*c+.00390625*o*c)*1.570796326794897}return d*T.$u(h)},T.Xq=function(d,h){var o=N.Mb(1,Math.sin(h));return h=1.570796326794897>=(h=N.R(T.hF(h,3.141592653589793)))?h:3.141592653589793-h,(N.$(h,1.570796326794897)?h:Math.atan(Math.sqrt(1-d)*Math.tan(h)))*o},T.q=function(d,h,o){if(.006884661117170036>h){var c=(h=(1-(h=Math.sqrt(1-h)))/(1+h))*h,u=h*c,m=h*u,g=h*m,v=h*g,w=h*v,E=-.7291666666666666*u+.2278645833333333*g+.03987630208333334*w,C=.615234375*m-.21533203125*v,R=-.54140625*g+.20302734375*w,I=.48876953125*v,F=-.4488699776785715*w,U=Math.cos(2*o);return d/(1+h)*((1+.25*c+.015625*m+.00390625*v)*o+Math.sin(2*o)*(-1.5*h+.1875*u+.0234375*g+.00732421875*w-E+R-F+U*(2*(.9375*c-.234375*m-.03662109375*v)-4*C+6*I+U*(4*E-12*R+24*F+U*(8*C-32*I+U*(16*R-80*F+U*(32*I+64*U*F)))))))}return d*(T.cG(o,h)-.5*h*Math.sin(2*o)/T.w(h,o))},T.w=function(d,h){return h=Math.sin(h),Math.sqrt(1-d*h*h)},T.$u=function(d){return N.CC(d,1,2220446049250313e-31)?1:1>d?T.Yw(0,1-d)-d/3*T.Vw(0,1-d):NaN},T.cG=function(d,h){var o=N.Mb(1,d);d=N.R(d);var c=Math.floor(d/1.570796326794897);if(1<h)h=d==0?0:NaN;else if(N.Dd(c))h=(d=T.sin(d))*T.Yw(1-d*d,1-h*d*d)-h/3*d*d*d*T.Vw(1-d*d,1-h*d*d);else{var u=f.P.truncate(c%2),m=T.$u(h);0<u?h=m*(c+1)-(h=(d=Math.sin(1.570796326794897*(c+1)-d))*T.Yw(1-d*d,1-h*d*d)-h/3*d*d*d*T.Vw(1-d*d,1-h*d*d)):h=m*c+(h=(d=Math.sin(d-1.570796326794897*c))*T.Yw(1-d*d,1-h*d*d)-h/3*d*d*d*T.Vw(1-d*d,1-h*d*d))}return h*o},T.sin=function(d){d=T.ca(d);var h=N.Mb(1,d);return d=N.R(d),N.$(d,3.141592653589793)?0:N.$(d,1.570796326794897)?1*h:Math.sin(d)*h},T.Vw=function(d,h){var o,c,u,m,g=d,v=h,w=1;for(h=0,d=1;c=((o=.2*(g+v+3*w))-g)/o,u=(o-v)/o,m=(o-w)/o,!(1e-4>N.R(c)&&1e-4>N.R(u)&&1e-4>N.R(m));)m=Math.sqrt(v),h+=d/((o=Math.sqrt(w))*(w+(m=Math.sqrt(g)*(m+o)+m*o))),d*=.25,g=.25*(g+m),v=.25*(v+m),w=.25*(w+m);return v=(g=c*u)-(w=m*m),3*h+d*(1+(w=g-6*w)*(.10227272727272728*w-.2142857142857143-.1730769230769231*m*(c=w+v+v))+m*(.1666666666666667*c+m*(-.4090909090909091*v+.1153846153846154*m*g)))/(o*Math.sqrt(o))},T.Yw=function(d,h){for(var o,c,u,m,g=1;c=2-((o=(d+h+g)/3)+d)/o,u=2-(o+h)/o,m=2-(o+g)/o,!(1e-4>N.R(c)&&1e-4>N.R(u)&&1e-4>N.R(m));g=.25*(g+o))o=Math.sqrt(h),c=Math.sqrt(g),d=.25*(d+(o=Math.sqrt(d)*(o+c)+o*c)),h=.25*(h+o);return(1+(.04166666666666666*(d=c*u-m*m)-.1-.06818181818181818*(h=c*u*m))*d+.07142857142857142*h)/Math.sqrt(o)},T.Rw=function(d,h){if(N.ui(d)||h==0||N.$(N.R(h),1.570796326794897))return h;if(.006884661117170036>d){var o=d*d,c=d*o,u=d*c,m=d*u,g=d*m,v=d*g,w=-(.02708333333333333*c+.03430059523809524*u+.03149181547619048*m+.02634359154541446*g+.02156896735835538*v),E=.007669890873015873*u+.01299603174603175*m+.0148051353064374*g+.01454454953803912*v,C=-(.002275545634920635*m+.004830845032667949*g+.006558395368616723*v),R=.0006957236677288761*g+.001775193002406544*v,I=-.000217324089394402*v,F=Math.cos(2*h);return h+Math.sin(2*h)*(-(.5*d+.2083333333333333*o+.09375*c+.04878472222222222*u+.02916666666666667*m+.01938905423280423*g+.01388255931712963*v)-w+C-I+F*(2*(.1041666666666667*o+.0875*c+.06050347222222222*u+.04151785714285714*m+.02958958540013228*g+.02203667534722222*v)-4*E+6*R+F*(4*w-12*C+24*I+F*(8*E-32*R+F*(16*C-80*I+F*(32*R+64*F*I))))))}return h==0||N.$(N.R(h),1.570796326794897)?o=h:(u=(c=Math.sqrt(d))*Math.sin(h),o=Math.tan(.7853981633974483+h/2)*Math.pow((1-u)/(1+u),c/2),o=2*Math.atan(o)-1.570796326794897),o},T.qO=function(d,h){if(N.ui(d)||h==0||N.$(N.R(h),1.570796326794897))return h;if(.006884661117170036>d){var o=d*(R=d*(C=d*(F=d*d))),c=d*(I=d*o),u=.05833333333333333*C+.07232142857142858*R+.05634300595238095*o+.0355325796406526*I+.020235546186067*c,m=.02653149801587302*R+.04379960317460317*o+.0429211791776896*I+.03255384637546096*c,g=.01294022817460318*o+.02668104344536636*I+.03155651254609588*c,v=.00659454790965208*I+.0163075268674227*c,w=.003463473736911237*c,E=Math.cos(2*h);return h+Math.sin(2*h)*(.5*d+.2083333333333333*F+.08333333333333333*C+.03611111111111111*R+.01875*o+.01195601851851852*I+.008863673941798942*c-u+g-w+E*(2*(.1458333333333333*F+.1208333333333333*C+.07039930555555556*R+.03616071428571429*o+.01839451058201058*I+.01017113095238095*c)-4*m+6*v+E*(4*u-12*g+24*w+E*(8*m-32*v+E*(16*g-80*w+E*(32*v+64*E*w))))))}var C=Math.sqrt(d),R=C/2,I=Math.tan(.7853981633974483+h/2);d=0,u=1;for(var F=h;u!=0;F=c)o=C*Math.sin(F),c=I*Math.pow((1+o)/(1-o),R),c=2*Math.atan(c)-1.570796326794897,d++,(N.$(c,F)||3e4<d)&&(u=0);return F},T}()}(ae||(ae={})),function(f){var N=function(){function T(d){this.wl=this.Vs=null,this.Jv=!1,this.AA=this.BA=0,this.zH=new f.h,this.PH=new f.h,this.EA=!1,this.xq=new f.l,this.oH=this.tw=0,this.uw=null,this.Bl=!1,this.Fo=null,this.Xz=0,this.Re=d,this.Bs=f.Ab.yv(this.Re,0,!0),this.zH.Sc(),this.PH.Sc(),this.JH=NaN;var h=d.getCode();0<h?(this.Kk=h,f.qf.getCode(d)):this.Kk=f.qf.getCode(d),0>this.Kk&&(this.Kk=0);var o=this.Re.getType();if(this.bH=o==f.Tc.PE_TYPE_PROJCS?2:1,o==f.Tc.PE_TYPE_PROJCS&&!d.loadConstants())throw f.i.O("PeProjcs.loadConstants failed");h=o==f.Tc.PE_TYPE_GEOGCS?this.Re:this.Re.getGeogcs(),o!=f.Tc.PE_TYPE_GEOGCS&&f.qf.getCode(h),this.Fo=d.getUnit(),this.JH=h.getPrimem().getLongitude(),this.oH=d=h.getUnit().getUnitFactor(),d=Math.PI/(180*d),1e-10>Math.abs(d-1)&&(d=1),this.AA=d,(o&f.Tc.PE_TYPE_PROJCS)!=0?(h=this.Re,this.BA=1/h.getUnit().getUnitFactor(),this.tw=.001/this.Re.getUnit().getUnitFactor(),this.uw=f.Eg.generate(h,f.Eg.PE_PCSINFO_OPTION_NONE),this.Bl=this.uw.isPannableRectangle(),this.Xz=f.Ab.iN(this.uw.getCentralMeridian(),this.AA)):(this.EA=this.Bl=!0,this.BA=0,o=1/h.getUnit().getUnitFactor(),this.tw=.001/h.getDatum().getSpheroid().getAxis()*o,this.Xz=0),this.Bl&&(this.vx(),this.vK(),this.bY(),this.uK(),this.$X(),this.aY())}return T.prototype.bs=function(){return this.Kk},T.prototype.kk=function(){return this.uw},T.Ky=function(d,h){return d==h||d!=null&&h!=null&&d.Kk==0&&h.Kk==0&&d.Bs===h.Bs},T.prototype.Xc=function(){return this.Bl},T.prototype.hh=function(d){d.L(this.to)},T.prototype.qv=function(){return this.to.v},T.prototype.pv=function(){return this.to.C},T.prototype.yR=function(d){d.L(this.vw)},T.prototype.$X=function(){var d=this.Re.getType();if(d==f.Tc.PE_TYPE_PROJCS){d=this.Re;var h=this.kk().getCentralMeridian(),o=d.getGeogcs();if(o==null)throw f.i.ga("internal error");h=[[h+(o=1/o.getUnit().getUnitFactor()*Math.PI),0]],f.fj.geogToProj(d,1,h),h=h[0][0],o=d.getParameters()[f.Tc.PE_PARM_X0].getValue();var c=this.ol();d=new f.l,c.A(d),h=(c=Math.abs(h-o))+o,o=-1*c+o,c=d.H,d=d.G;var u=new f.l;u.L(o,d,h,c),this.to==null&&(this.to=u)}else{if(d!=f.Tc.PE_TYPE_GEOGCS)throw f.i.ga("internal error");o=1/this.Re.getUnit().getUnitFactor()*Math.PI,(d=new f.l).L(-o,-o/2,o,o/2),this.to==null&&(this.to=d)}},T.prototype.aY=function(){var d=this.Re.getType();if(d==f.Tc.PE_TYPE_PROJCS){var h=this.Re;if(d=this.kk().getCentralMeridian(),(h=h.getGeogcs())==null)throw f.i.ga("internal error");h=1/h.getUnit().getUnitFactor()*Math.PI;var o=this.Wr(),c=new f.l;o.A(c),(o=new f.l).L(d-h,c.G,d+h,c.H),this.vw==null&&(this.vw=o)}else{if(d!=f.Tc.PE_TYPE_GEOGCS)throw f.i.ga("internal error");h=1/this.Re.getUnit().getUnitFactor()*Math.PI,(d=new f.l).L(-h,-h/2,h,h/2),this.vw==null&&(this.vw=d)}},T.prototype.bf=function(){return this.AA},T.prototype.rm=function(){return this.BA},T.prototype.Wr=function(){if(this.Bl)return this.wl;var d=this.wl;return d!=null?d:(this.vx(),this.wl)},T.prototype.Xr=function(){return this.Bl?null:(this.wl!=null||this.vx(),this.PG)},T.prototype.vx=function(){if(this.Re.getType()==f.Tc.PE_TYPE_PROJCS){var d=this.Re,h=d.getGeogcs(),o=d.horizonGcsGenerate();if(o!=null){var c=o[0].getNump(),u=o[0].getKind();d=0<o[0].getInclusive();var m=this.bf(),g=90*m,v=360*m,w=370*m,E=180*m*f.Tc.PE_HORIZON_DELTA/Math.PI,C=new f.l,R=null;if(1<c){for(var I=1;I<c;I++)if(o[I].getKind()==f.Tc.PE_HORIZON_LINE){R==null&&(R=new f.Ua);var F=o[I].getCoord();R.qx(F[0][0],F[0][1]),R.zj(F[1][0],F[1][1])}}if(u==f.Tc.PE_HORIZON_RECT)o=o[0].getCoord(),C.L(o[0][0],o[0][1]),C.$b(o[1][0],o[1][1]),Math.abs(C.H-g)<1e-7*E&&(C.H=g),Math.abs(C.G+g)<1e-7*E&&(C.G=-g),C.S()>w&&(o=-400*m,C.L(o,C.G,o+5*v,C.H)),o=new f.Gh(C),this.wl==null&&(this.wl=o,this.Jv=d);else{if(w=new f.Ea,v=this.kk().isGcsHorizonMultiOverlap(),C=f.hu.UE(h,f.iu.Integer64),v){for(w=new f.ZK,E=f.Hh.local().W(w,C,null),I=0;I<c;I++)if(o[I].getKind()==f.Tc.PE_HORIZON_POLY){for(h=o[I].getSize(),m=o[I].getCoord(),u=[],g=0;g<h;g++)u[g]=f.h.construct(m[g][0],m[g][1]);o[I].getInclusive(),v&&((m=new f.Ea).Zk(u,h-1),w.NX(m),E.qe())}w=E.next()}else for(I=0;I<c;I++)if(o[I].getKind()==f.Tc.PE_HORIZON_POLY){for(h=o[I].getSize(),m=o[I].getCoord(),v=[],g=0;g<h;g++)v[g]=f.h.construct(m[g][0],m[g][1]);o[I].getInclusive(),w.Zk(v,h-1)}d?f.Wk.local().xn(w,C,1):f.lp.local().xn(w,C,1),f.ej.local().xn(w,C,1),this.wl==null&&(this.wl=w,this.Jv=d,this.PG=R)}}}},T.prototype.jv=function(){return this.Bl||this.wl==null&&this.vx(),this.Jv},T.prototype.vK=function(){if(this.bH==2){var d=this.Re.horizonPcsGenerate();if(d!=null){var h=d[0].getKind();d[0].getInclusive();var o=d[0].getNump(),c=!1;if(h==f.Tc.PE_HORIZON_RECT)d=d[0].getCoord(),(o=new f.l).L(d[0][0],d[0][1]),o.$b(d[1][0],d[1][1]),d=new f.Gh(o);else{for(h=-1,c=0;c<o;c++)d[c].getKind()==f.Tc.PE_HORIZON_POLY&&(h=c);for(c=d[h].getSize()-1,d=d[h].getCoord(),o=[],h=0;h<c;h++)o[h]=f.h.construct(d[h][0],d[h][1]);d=h=new f.Ea,h.Zk(o,c),c=!0}this.kk().isDensificationNeeded()&&(o=1e5*this.rm(),d=f.Zl.local().W(d,o,null)),c&&(c=new f.Gh,d.dn(c),d.He(),d.Rb(),d.hR(),f.Wk.local().xn(d,null,1)),this.Vs==null&&(this.Vs=d)}}},T.prototype.ol=function(){if(this.Bl)return this.Vs;var d=this.Vs;return d!=null?d:(this.vK(),this.Vs)},T.prototype.bY=function(){if(this.Re.getType()==f.Tc.PE_TYPE_PROJCS){var d=90*this.bf();d=[[0,d],[0,-d]],f.fj.geogToProj(this.Re,2,d);var h=this.kk(),o=h.getNorthPoleLocation()!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY;h=h.getSouthPoleLocation()!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY,this.EA||(o&&this.zH.na(d[0][0],d[0][1]),h&&this.PH.na(d[1][0],d[1][1]))}this.EA=!0},T.prototype.uK=function(){if(this.bH==1){var d=400*this.bf();this.xq.L(-d,-d,d,d)}else d=f.Eg.generate(this.Re,f.Eg.PE_PCSINFO_OPTION_DOMAIN),d=f.l.construct(d.getDomainMinx(),d.getDomainMiny(),d.getDomainMaxx(),d.getDomainMaxy()),this.xq.B()&&this.xq.L(d)},T.prototype.$Q=function(d){this.Bl&&d.L(this.xq),this.xq.B()&&this.uK(),d.L(this.xq)},T.prototype.Wp=function(){return this.JH},T.prototype.Ai=function(){return this.Xz},T.prototype.Id=function(){return this.Fo},T.prototype.Yr=function(){return this.oH},T}();f.GC=N}(ae||(ae={})),function(f){var N=function(){function T(d){this.AT=d,this.Bs=f.Ab.yv(d,0,!0);var h=d.getCode();this.ts=0<h?h:f.qf.getCode(d),0>this.ts&&(this.ts=0),this.Fo=h=this.AT.getUnit(),this.AH=1/h.getUnitFactor(),f.qf.getCode(d)}return T.Ky=function(d,h){return d==h||d!=null&&h!=null&&d.ts==0&&h.ts==0&&d.Bs===h.Bs},T.prototype.bs=function(){return this.ts},T}();f.HL=N}(ae||(ae={})),function(f){f.Zg=function(){function N(){}return N.ub=function(T,d,h,o,c,u,m,g){if(u!=null||m!=null||g!=null){o=f.F.ca(o),d=f.F.ca(d),h=f.F.ca(h),c=f.F.ca(c),1.570796326794897<f.s.R(h)&&(h=f.s.Mb(3.141592653589793,h)-h,d=f.F.ca(d+3.141592653589793)),1.570796326794897<f.s.R(c)&&(c=f.s.Mb(3.141592653589793,c)-c,o=f.F.ca(o+3.141592653589793));var v=f.F.ca(o-d);if(f.s.$(h,c)&&(f.s.$(d,o)||f.s.$(f.s.R(h),1.570796326794897)))u!=null&&(u.u=0),m!=null&&(m.u=0),g!=null&&(g.u=0);else{if(f.s.$(h,-c)){if(f.s.$(f.s.R(h),1.570796326794897))return u!=null&&(u.u=3.141592653589793*T),m!=null&&(m.u=0<h?f.F.ca(3.141592653589793-f.F.ca(o)):f.F.ca(o)),void(g!=null&&(g.u=0<h?f.F.ca(o):f.F.ca(3.141592653589793-f.F.ca(o))));if(f.s.$(f.s.R(v),3.141592653589793))return u!=null&&(u.u=3.141592653589793*T),m!=null&&(m.u=0),void(g!=null&&(g.u=0))}var w=f.s.R(h)==1.570796326794897?0:Math.cos(h),E=Math.sin(h),C=f.s.R(c)==1.570796326794897?0:Math.cos(c),R=Math.sin(c),I=f.s.R(v)==1.570796326794897?0:Math.cos(v),F=f.s.R(v)==3.141592653589793?0:Math.sin(v);if(u!=null){var U=Math.sin((c-h)/2);v=Math.sin(v/2),u.u=2*Math.asin(Math.sqrt(U*U+w*C*v*v))*T}m!=null&&(m.u=f.s.$(f.s.R(h),1.570796326794897)?0>h?o:f.F.ca(3.141592653589793-o):Math.atan2(C*F,w*R-E*C*I)),g!=null&&(f.s.$(f.s.R(c),1.570796326794897)?g.u=0>c?d:f.F.ca(3.141592653589793-d):(g.u=Math.atan2(w*F,R*w*I-C*E),g.u=f.F.ca(g.u+3.141592653589793)))}}},N.sf=function(T,d,h,o,c,u,m){if(u!=null||m!=null){d=f.F.ca(d),h=f.F.ca(h),1.570796326794897<f.s.R(h)&&(h=f.s.Mb(3.141592653589793,h)-h,d=f.F.ca(d+3.141592653589793)),f.s.$(f.s.R(h),1.570796326794897)&&(d=0),c=f.F.ca(c);var g=f.s.$(f.s.R(c),1.570796326794897)?0:Math.cos(c),v=f.s.$(f.s.R(c),3.141592653589793)?0:Math.sin(c),w=f.s.$(f.s.R(h),1.570796326794897)?0:Math.cos(h),E=Math.sin(h);T=o/T,o=f.s.$(f.s.R(T),1.570796326794897)?0:Math.cos(T);var C=f.s.$(f.s.R(T),3.141592653589793)?0:Math.sin(T),R=Math.asin(E*o+w*C*g);m!=null&&(m.u=R),u!=null&&(u.u=f.s.$(f.s.R(R),1.570796326794897)?f.s.$(h,-R)?0>R?c:f.F.ca(3.141592653589793-c):d:f.s.$(f.s.R(h),1.570796326794897)&&f.s.$(T,3.141592653589793)?0>h?c:f.F.ca(3.141592653589793-c):f.F.ca(d+Math.atan2(C*v,w*o-E*C*g)))}},N}()}(ae||(ae={})),function(f){f.Xk=function(){function N(){}return N.ub=function(T,d,h,o,c,u,m,g,v){var w=new f.ha(0),E=new f.ha(0),C=[0,0,0],R=[0,0,0],I=[0,0,0],F=new f.ha(0),U=new f.ha(0),j=new f.ha(0),ee=new f.ha(0),te=new f.ha(0);if(m!=null||g!=null||v!=null)if(f.s.ui(d))f.Zg.ub(T,h,o,c,u,m,g,v);else{c=f.F.ca(c),h=f.F.ca(h);var Z=f.F.ca(c-h);if(f.s.$(o,u)&&(f.s.$(h,c)||f.s.$(f.s.R(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.$(o,-u)){if(f.s.$(f.s.R(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0<o?f.F.ca(3.141592653589793-f.F.ca(c)):f.F.ca(c)),void(v!=null&&(v.u=0<o?f.F.ca(c):f.F.ca(3.141592653589793-f.F.ca(c))));f.s.$(f.s.R(Z),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else(f.s.$(f.s.R(o),1.570796326794897)||f.s.$(f.s.R(u),1.570796326794897))&&(f.s.$(f.s.R(o),1.570796326794897)?h=c:c=h);var le=0;if(0>Z){le=1;var ve=h;h=c,c=ve,ve=o,o=u,u=ve}Z=f.F.ot(d,o);var be=f.F.ot(d,u);g==null&&v==null||(f.Zg.ub(T,h,Z,c,be,null,w,E),w=Math.atan2(Math.sin(w.u)*Math.cos(o-Z),Math.cos(w.u)),E=Math.atan2(Math.sin(E.u)*Math.cos(u-be),Math.cos(E.u)),le!=0&&(ve=w,w=E,E=ve),g!=null&&(g.u=w),v!=null&&(v.u=E)),m!=null&&(f.F.dl(1,d,o,h,0,j,ee,te),C[0]=j.u,C[1]=ee.u,C[2]=te.u,f.F.dl(1,d,u,c,0,j,ee,te),R[0]=j.u,R[1]=ee.u,R[2]=te.u,I[0]=C[1]*R[2]-R[1]*C[2],I[1]=-(C[0]*R[2]-R[0]*C[2]),I[2]=C[0]*R[1]-R[0]*C[1],d=1-f.F.w(d,f.F.Xq(d,f.F.Rj(d,Math.acos(I[2]/Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]))))),d*=2-d,g=Math.atan2(-I[1],-I[0]),I=f.F.ca(g-1.570796326794897),g=f.F.ca(g+1.570796326794897),I=f.s.R(f.F.ca(h-I))<=f.s.R(f.F.ca(h-g))?I:g,f.Zg.ub(1,I,0,h,Z,F,null,null),f.Zg.ub(1,I,0,c,be,U,null,null),3.141592653589793<F.u+U.u&&(I=f.F.ca(I+3.141592653589793),f.Zg.ub(1,I,0,h,Z,F,null,null),f.Zg.ub(1,I,0,c,be,U,null,null)),F.u*=f.s.Mb(1,o),U.u*=f.s.Mb(1,u),F.u=f.F.Rj(d,F.u),U.u=f.F.Rj(d,U.u),h=f.F.q(T,d,F.u),T=f.F.q(T,d,U.u),m.u=f.s.R(T-h))}}},N.sf=function(T,d,h,o,c,u,m,g){var v=0,w=new f.ha(0),E=new f.ha(0),C=[0,0,0],R=[0,0,0],I=new f.ha(0),F=new f.ha(0),U=new f.ha(0);if(m!=null||g!=null)if(f.s.ui(d))f.Zg.sf(T,h,o,c,u,m,g);else if(f.s.Dd(c))m!=null&&(m.u=h),g!=null&&(g.u=o);else if(u=f.F.ca(u),0>c&&(c=f.s.R(c),u=f.F.ca(u+3.141592653589793)),h=f.F.ca(h),o=f.F.ca(o),1.570796326794897<f.s.R(o)&&(h=f.F.ca(h+3.141592653589793),o=f.s.Mb(3.141592653589793,o)-o),f.s.$(f.s.R(o),1.570796326794897)&&(h=0),f.s.Dd(o)){var j=f.s.R(1.570796326794897-f.s.R(u));j=f.F.Rj(d,j),j=1-f.F.w(d,f.F.Xq(d,j)),j*=2-j,T=c/f.F.Bh(T,j)*1.570796326794897,T=f.F.Tq(j,T),T=f.F.ot(j,T),f.Zg.sf(1,h,o,T,u,m,w),g!=null&&(v=w.u),g!=null&&(g.u=f.F.Rj(d,v))}else if(f.s.$(f.s.R(o),1.570796326794897))w=2*(v=f.F.Bh(T,d)),u=0<(T=f.s.Mb(1.570796326794897,o))?f.F.ca(3.141592653589793-u):u,o=v-c,f.s.R(o)<=v?m!=null&&(m.u=u):(o=Math.floor(c/w),f.P.truncate(o%2)==0?(m!=null&&(m.u=u),c-=o*w):(m!=null&&(m.u=f.F.ca(u+3.141592653589793)),c=(o+1)*w-c),o=v-c),g!=null&&(g.u=f.F.Tq(d,o/v*T));else{j=f.F.ot(d,o),u=Math.atan2(Math.sin(u),Math.cos(u)*Math.cos(o-j));var ee=f.P.truncate(f.s.Mb(1,j))*(1.570796326794897>=f.s.R(u)?1:-1);u=f.F.ca(h+Math.atan(Math.tan(u)*-Math.sin(j))),f.Zg.ub(T,u,0,h,j,null,E,null),j=f.s.R(1.570796326794897-f.s.R(E.u)),j=f.F.Rj(d,j),j=1-f.F.w(d,f.F.Xq(d,j)),j*=2-j,f.F.dl(1,d,0,u,0,I,F,U),C[0]=I.u,C[1]=F.u,C[2]=U.u,f.F.dl(1,d,o,h,0,I,F,U),R[0]=I.u,R[1]=F.u,R[2]=U.u,o=Math.acos((C[0]*R[0]+C[1]*R[1]+C[2]*R[2])/Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2])),o=f.F.Rj(j,o),c=0<(o=f.F.q(T,j,o)+c*ee)?E.u:f.F.ca(E.u+3.141592653589793),T=f.s.R(o)/f.F.Bh(T,j)*1.570796326794897,T=f.F.Tq(j,T),T=f.F.ot(j,T),f.Zg.sf(1,u,0,T,c,m,w),g!=null&&(v=w.u),g!=null&&(g.u=f.F.Rj(d,v))}},N}()}(ae||(ae={})),function(f){f.du=function(){function N(){}return N.ub=function(T,d,h,o,c,u,m,g,v){var w=0,E=0,C=0;if(m!=null||g!=null||v!=null)if(f.s.ui(d))f.Zg.ub(T,h,o,c,u,m,g,v);else{var R=f.F.ca(c-h);if(f.s.$(o,u)&&(f.s.Dd(R)||f.s.$(f.s.R(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.$(o,-u)){if(f.s.$(f.s.R(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0<o?f.F.ca(3.141592653589793-f.F.ca(c)):f.F.ca(c)),void(v!=null&&(v.u=0<o?f.F.ca(c):f.F.ca(3.141592653589793-f.F.ca(c))));f.s.$(f.s.R(R),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else if(f.s.$(f.s.R(o),1.570796326794897)||f.s.$(f.s.R(u),1.570796326794897)||f.s.Dd(R)||f.s.$(f.s.R(R),3.141592653589793))return void f.Xk.ub(T,d,h,o,c,u,m,g,v);var I=1-Math.sqrt(1-d),F=d/(1-d),U=T*(1-I);T=f.F.Xq(d,o);var j=f.F.Xq(d,u);d=f.s.R(T)==1.570796326794897?0:Math.cos(T);var ee=Math.sin(T),te=f.s.R(j)==1.570796326794897?0:Math.cos(j),Z=Math.sin(j),le=R,ve=Math.cos(le),be=Math.sin(le),ue=1,Le=0;do{var Be=le,it=Math.sqrt(Math.pow(te*be,2)+Math.pow(d*Z-ee*te*ve,2)),Ke=ee*Z+d*te*ve,Je=Math.atan2(it,Ke);if(it==0){ue=0;break}var pt=d*te*be/it;if(w=Math.cos(Math.asin(pt)),E=Ke-2*ee*Z/(w*=w),1<f.s.R(E)&&(E=f.s.Mb(1,E)),le=R+(1-(le=I/16*w*(4+I*(4-3*w))))*I*pt*(Je+le*it*(E+le*Ke*(2*(C=E*E)-1))),ve=Math.cos(le),be=Math.sin(le),Le++,3.141592653589793<f.s.R(le)&&30<Le){ue=0;break}}while(5e3>=Le&&!f.s.$(Be,le));if(ue!=0)I=(F*=w)*(256+F*(F*(74-47*F)-128))/1024,m!=null&&(m.u=U*(1+F*(4096+F*(F*(320-175*F)-768))/16384)*(Je-I*it*(E+I/4*(Ke*(2*C-1)-I/6*E*(4*it*it-3)*(4*C-3))))),g!=null&&(g.u=f.s.$(f.s.R(o),1.570796326794897)?0>o?c:f.F.ca(3.141592653589793-c):Math.atan2(te*be,d*Z-ee*te*ve)),v!=null&&(f.s.$(f.s.R(u),1.570796326794897)?v.u=0>u?h:f.F.ca(3.141592653589793-h):(v.u=Math.atan2(d*be,d*Z*ve-ee*te),v.u=f.F.ca(v.u+3.141592653589793)));else{le=f.s.Mb(3.141592653589793,R),Ke=ee*Z-d*te,Je=Math.acos(Ke),it=Math.sin(Je),w=1,Le=pt=0;do C=pt,ve=1-.25*(pt=I*(w*=w)*(1+I+I*I))+.1875*(E=I*I*(ve=w*w)*(1+2.25*I))-.1953125*(ue=I*I*I*ve*w),pt=.25*pt-.25*E+.29296875*ue,be=.03125*E-.05859375*ue,ue*=.00651041666666667,E=Ke-2*ee*Z/w,1<f.s.R(E)&&(E=f.s.Mb(1,E)),w=Math.acos(E),Ke=Math.cos(2*w),Be=Math.cos(3*w),be=(pt=f.s.$(o,-u)?f.F.ca(3.141592653589793-R)/(3.141592653589793*I*ve):f.F.ca(le-R)/(I*(ve*Je+pt*it*E+be*Math.sin(2*Je)*Ke+ue*Math.sin(3*Je)*Be)))*it/(d*te),le=1.570796326794897<f.s.R(R)?f.s.Mb(3.141592653589793,be)-Math.asin(be):Math.asin(be),ve=Math.cos(le),it=Math.sqrt(Math.pow(te*be,2)+Math.pow(d*Z-ee*te*ve,2)),Je=3.141592653589793-Math.asin(f.s.R(it)),Ke=Math.cos(Je),w=Math.cos(Math.asin(pt)),Le++;while(70>=Le&&!f.s.$(C,pt));m!=null&&(ve=1+(F*=w*=w)*(4096+F*(F*(320-175*F)-768))/16384,f.s.$(o,-u)?m.u=3.141592653589793*U*ve:(E=Ke-2*ee*Z/w,w=Math.acos(E),Ke=Math.cos(2*w),Be=Math.cos(3*w),m.u=U*(ve*Je+F*(F*(128+F*(35*F-60))-512)/2048*it*E+F*(5*F-4)/6144*F*F*Math.sin(2*Je)*Ke+ue*Math.sin(3*Je)*Be+-762939453125e-16*F*F*F*F*Math.sin(4*Je)*Math.cos(4*w)))),g!=null&&(f.s.Dd(o)&&f.s.Dd(u)?(w=Math.sqrt(1-pt*pt),g.u=Math.acos(w),0>R&&(g.u*=-1)):f.s.$(f.s.R(o),1.570796326794897)?g.u=0>o?c:f.F.ca(3.141592653589793-c):(m=pt/d,U=Math.sqrt(1-m*m),0>d*Z-ee*te*Math.cos(le)&&(U*=-1),g.u=Math.atan2(m,U),f.s.$(o,-u)&&f.s.R(f.F.ca(h-c))>3.141592653589793*(1-I*Math.cos(o))&&(0<o&&1.570796326794897>f.s.R(g.u)||0>o&&1.570796326794897<f.s.R(g.u))&&(g.u=f.s.Mb(3.141592653589793,g.u)-g.u))),v!=null&&(f.s.Dd(o)&&f.s.Dd(u)?(w=Math.sqrt(1-pt*pt),v.u=Math.acos(w),0<=R&&(v.u*=-1)):f.s.$(f.s.R(u),1.570796326794897)?v.u=0>u?h:f.F.ca(3.141592653589793-h):(R=pt/te,m=Math.sqrt(1-R*R),U=Math.sin(le/2),0>Math.sin(j-T)-2*d*Z*U*U&&(m*=-1),v.u=Math.atan2(R,m),v.u=f.F.ca(v.u+3.141592653589793),f.s.$(o,-u)&&!f.s.Dd(o)&&!f.s.$(f.s.R(o),1.570796326794897)&&f.s.R(f.F.ca(h-c))>3.141592653589793*(1-I*Math.cos(o))&&(g!=null?U=g.u:(m=pt/d,U=Math.sqrt(1-m*m),0>d*Z-ee*te*Math.cos(le)&&(U*=-1),U=Math.atan2(m,U),f.s.$(o,-u)&&f.s.R(f.F.ca(h-c))>3.141592653589793*(1-I*Math.cos(o))&&(0<o&&1.570796326794897>f.s.R(U)||0>o&&1.570796326794897<f.s.R(U))&&(U=f.s.Mb(3.141592653589793,U)-U)),1.570796326794897>=f.s.R(U)&&1.570796326794897<f.s.R(v.u)||1.570796326794897<=f.s.R(U)&&1.570796326794897>f.s.R(v.u))&&(v.u=-1*f.F.ca(v.u+3.141592653589793))))}}}},N.sf=function(T,d,h,o,c,u,m,g){if(m!=null||g!=null)if(f.s.ui(d))f.Zg.sf(T,h,o,c,u,m,g);else if(u=f.F.ca(u),f.s.$(f.s.R(o),1.570796326794897)||f.s.Dd(u)||f.s.$(f.s.R(u),3.141592653589793))f.Xk.sf(T,d,h,o,c,u,m,g);else{var v=f.s.R(u)==1.570796326794897?0:Math.cos(u),w=f.s.R(u)==3.141592653589793?0:Math.sin(u);f.s.$(f.s.R(o),1.570796326794897)&&(h=0),u=1-Math.sqrt(1-d);var E=f.F.Xq(d,o);o=f.s.R(E)==1.570796326794897?0:Math.cos(E);var C=Math.sin(E);E=Math.atan2(Math.tan(E),v);var R=o*w,I=R*R,F=1-I,U=d/(1-d)*F,j=(d=U*(256+U*(U*(74-47*U)-128))/1024)/4,ee=d/6,te=c/(T*(1-u)*(1+U*(4096+U*(U*(320-175*U)-768))/16384)),Z=te;do{var le=Z;c=f.s.R(Z)==1.570796326794897?0:Math.cos(Z);var ve=(U=f.s.R(Z)==3.141592653589793?0:Math.sin(Z))*U;Z=d*U*((T=Math.cos(2*E+Z))+j*(c*(2*(Z=T*T)-1)-ee*T*(4*ve-3)*(4*Z-3)))+te}while(!f.s.$(le,Z));c=f.s.R(Z)==1.570796326794897?0:Math.cos(Z),U=f.s.R(Z)==3.141592653589793?0:Math.sin(Z),m!=null&&(w=Math.atan2(U*w,o*c-C*U*v),F=u/16*F*(4+u*(4-3*F)),T=Math.cos(2*E+Z),m.u=f.F.ca(h+(w-(1-F)*u*R*(Z+F*U*(T+F*c*(2*T*T-1)))))),g!=null&&(F=C*U-o*c*v,F=(1-u)*Math.sqrt(I+F*F),g.u=Math.atan2(C*c+o*U*v,F))}},N}()}(ae||(ae={})),function(f){f.HC=function(){function N(){}return N.ub=function(T,d,h,o,c,u,m,g,v){var w=f.F.ca(c-h),E=f.s.$(f.s.R(o),1.570796326794897),C=f.s.$(f.s.R(u),1.570796326794897);if(f.s.$(o,u)&&(f.s.Dd(w)||E))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.ui(d)){var R=Math.sin(o),I=Math.sin(u);R=Math.sqrt((1+R)/(1-R)),I=Math.sqrt((1+I)/(1-I)),R=Math.log(I)-Math.log(R),R=Math.atan2(w,R),m!=null&&(m.u=f.s.$(o,u)?f.s.R(T*Math.cos(o)*w):f.s.R((T*u-T*o)/Math.cos(R)))}else I=f.F.Rw(d,u),R=Math.sin(f.F.Rw(d,o)),I=Math.sin(I),R=Math.sqrt((1+R)/(1-R)),I=Math.sqrt((1+I)/(1-I)),R=Math.log(I)-Math.log(R),R=Math.atan2(w,R),m!=null&&(f.s.$(o,u)?m.u=f.s.R(T*w*Math.cos(o)/f.F.w(d,o)):(w=f.F.q(T,d,o),T=f.F.q(T,d,u),m.u=f.s.R((T-w)/Math.cos(R))));g==null&&v==null||(m=f.F.ca(R+3.141592653589793),E&&C||!E&&!C||(E?R=0>o?c:f.F.ca(3.141592653589793-c):C&&(m=0>u?h:f.F.ca(3.141592653589793-h))),g!=null&&(g.u=R),v!=null&&(v.u=m))}},N.sf=function(T,d,h,o,c,u,m,g){u=f.F.ca(u),0>c&&(c=f.s.R(c),u=f.F.ca(u+3.141592653589793)),f.s.ui(d)?f.s.$(f.s.R(o),1.570796326794897)?(h=0>o?u:f.F.ca(3.141592653589793-u),3.141592653589793>=(u=c/T%6.283185307179586)?T=o-f.s.Mb(u,o):(h=f.F.ca(h+3.141592653589793),T=-o+f.s.Mb(u-3.141592653589793,o))):f.s.$(f.s.R(u),1.570796326794897)?(h=f.F.ca(h+f.s.Mb(c,u)/(T*Math.cos(o))),T=o):(T=o+c*Math.cos(u)/T,1.570796326794897<f.s.R(T)&&(T=1.570796326794897),f.s.$(f.s.R(T),1.570796326794897)&&(f.s.Dd(u)||f.s.$(f.s.R(u),3.141592653589793))||(1.570796316258184<f.s.R(T)&&(T=f.s.Mb(1.570796316258184,T)),d=Math.sin(o),o=Math.sin(T),d=Math.sqrt((1+d)/(1-d)),o=Math.sqrt((1+o)/(1-o)),d=Math.log(o)-Math.log(d),h=f.F.ca(h+Math.tan(u)*d))):f.s.$(f.s.R(o),1.570796326794897)?(h=0>o?u:f.F.ca(3.141592653589793-u),u=c/f.F.gW(T,d),3.141592653589793>=(u%=6.283185307179586)?T=o-f.s.Mb(u,o):(h=f.F.ca(h+3.141592653589793),T=-o+f.s.Mb(u-3.141592653589793,o)),T=f.F.Tq(d,T)):f.s.$(f.s.R(u),1.570796326794897)?(h=f.F.ca(h+f.s.Mb(c,u)*f.F.w(d,o)/(T*Math.cos(o))),T=o):(T=1.570796326794897*(c*Math.cos(u)+f.F.q(T,d,o))/f.F.Bh(T,d),1.570796326794897<f.s.R(T)&&(T=f.s.Mb(1.570796326794897,T)),T=f.F.Tq(d,T),f.s.$(f.s.R(T),1.570796326794897)&&(f.s.Dd(u)||f.s.$(f.s.R(u),3.141592653589793))||(c=f.F.Rw(d,o),o=f.F.Rw(d,T),1.570796316258184<f.s.R(o)&&(o=f.s.Mb(1.570796316258184,T),T=f.F.qO(d,o)),d=Math.sin(c),o=Math.sin(o),d=Math.sqrt((1+d)/(1-d)),o=Math.sqrt((1+o)/(1-o)),d=Math.log(o)-Math.log(d),h=f.F.ca(h+Math.tan(u)*d))),m!=null&&(m.u=h),g!=null&&(g.u=T)},N}()}(ae||(ae={})),function(f){f.kb=function(){function N(){}return N.Sy=function(T,d,h,o,c,u,m){f.du.ub(T,d,h,o,c,u,null,m,null)},N.zi=function(T,d,h,o,c,u,m,g){f.du.sf(T,d,h,o,c,u,m,g)},N.xd=function(T,d,h,o,c,u,m,g,v,w){switch(w){case 2:f.Xk.ub(T,d,h,o,c,u,m,g,v);break;case 3:f.IC.ub(T,d,h,o,c,u,m,g,v);break;case 1:f.HC.ub(T,d,h,o,c,u,m,g,v);break;default:f.du.ub(T,d,h,o,c,u,m,g,v)}},N.pj=function(T,d,h,o,c,u,m,g,v){switch(v){case 2:f.Xk.sf(T,d,h,o,c,u,m,g);break;case 3:f.IC.sf(T,d,h,o,c,u,m,g);break;case 1:f.HC.sf(T,d,h,o,c,u,m,g);break;default:f.du.sf(T,d,h,o,c,u,m,g)}},N}()}(ae||(ae={})),function(f){var N=function(){function d(){this.y=this.x=null}return d.construct=function(h){var o=new d;return o.x=new f.Xb,o.x.set(h.x),o.y=new f.Xb,o.y.set(h.y),o},d.NE=function(h,o){var c=new d;return c.x=new f.Xb,c.x.set(h),c.y=new f.Xb,c.y.set(o),c},d.prototype.qg=function(){return this.x.qg()&&this.y.qg()},d.prototype.value=function(){return f.h.construct(this.x.value(),this.y.value())},d}();f.jY=N;var T=function(){function d(){this.z=this.y=this.x=null}return d.construct=function(h){var o=new d;return o.x=new f.Xb,o.x.set(h.x),o.y=new f.Xb,o.y.set(h.y),o.z=new f.Xb,o.z.set(h.z),o},d.NE=function(h,o,c){var u=new d;return u.x=new f.Xb,u.x.set(h),u.y=new f.Xb,u.y.set(o),u.z=new f.Xb,u.z.set(c),u},d.prototype.qg=function(){return this.x.qg()&&this.y.qg()&&this.z.qg()},d.prototype.value=function(){return new f.Od(this.x.value(),this.y.value(),this.z.value())},d.prototype.Rh=function(h){var o=new f.Xb,c=new f.Xb,u=new f.Xb;return o.Ml(this.x,h.x),c.Ml(this.y,h.y),u.Ml(this.z,h.z),(h=new f.Xb).WM(o,c),h.add(u),h},d.prototype.VE=function(h){var o=new d;o.x.Ml(this.y,h.z),o.y.Ml(this.z,h.x),o.z.Ml(this.x,h.y);var c=new f.Xb,u=new f.Xb,m=new f.Xb;return c.Ml(this.z,h.y),u.Ml(this.x,h.z),m.Ml(this.y,h.x),o.x.sub(c),o.y.sub(u),o.z.sub(m),o},d}();f.kY=T,f.Mx=function(){function d(){}return d.wP=function(h,o,c){var u=o.x;o=o.y,d.dl(1,h,Math.cos(u),Math.sin(u),Math.cos(o),Math.sin(o),c)},d.vP=function(h,o){var c=new f.Od;return d.wP(h,o,c),c},d.dl=function(h,o,c,u,m,g,v){h/=Math.sqrt(1-o*g*g),v.L(h*m*c,h*m*u,h*(1-o)*g)},d.Zu=function(h,o){var c=new f.Xb,u=new f.Xb,m=new f.Xb,g=new f.Xb;c.cos(o.x),u.sin(o.x),m.cos(o.y),g.sin(o.y);var v=new f.Xb;return v.set(g),v.Ag(g),v.Oo(h),v.Oo(-1),v.cN(),v.sqrt(),(o=new f.Xb).set(1),o.lm(v),(v=new f.Xb).set(o),v.Ag(m),v.Ag(c),(c=new f.Xb).set(o),c.Ag(m),c.Ag(u),(u=new f.Xb).set(o),u.Oo(1-h),u.Ag(g),T.NE(v,c,u)},d.IS=function(h,o,c,u){if(Math.abs(o.x-c.x)>Math.PI||Math.abs(o.y)>.5*Math.PI||Math.abs(c.y)>.5*Math.PI||(Math.abs(o.y)==.5*Math.PI||Math.abs(c.y)==.5*Math.PI)&&o.x!=c.x)return NaN;if(u=d.XA(u,Math.min(o.x,c.x),Math.max(o.x,c.x)),!new f.Oc(o.x,c.x).contains(u))return NaN;var m=N.construct(o);if(c=N.construct(c),m=d.Zu(h,m),c=d.Zu(h,c),(c=m.VE(c)).z.qg())return o.y;var g=new f.Xb;g.set(c.x),g.lm(c.z),g.Oo(-1);var v=new f.Xb;v.set(c.y),v.lm(c.z),v.Oo(-1);var w=new f.Xb;return w.set(v),w.Ag(v),(m=new f.Xb).set(g),m.Ag(g),m.add(w),m.sqrt(),m.qg()||g.qg()&&v.qg()?o.y:(o=Math.atan2(v.value(),g.value()),o=Math.atan2(m.value()*Math.cos(o-u),1-h),u=d.vP(h,f.h.construct(u,o)),h=new f.Od(u.x,u.y,-u.z),u=c.value().Rh(u),h=c.value().Rh(h),Math.abs(h)<Math.abs(u)&&(o=-o),o)},d.Jz=function(h,o,c,u,m){if(m[0]=NaN,m[1]=NaN,Math.abs(o.x-c.x)>Math.PI||Math.abs(o.y)>.5*Math.PI||Math.abs(c.y)>.5*Math.PI||(Math.abs(o.y)==.5*Math.PI||Math.abs(c.y)==.5*Math.PI)&&o.x!=c.x||Math.abs(u)>=.5*Math.PI||0<o.y&&0<c.y&&o.y>u&&c.y>u||0>o.y&&0>c.y&&o.y<u&&c.y<u)return 0;var g=N.construct(o),v=N.construct(c);g=d.Zu(h,g),v=d.Zu(h,v);var w=g.VE(v);if(w.z.qg())return new f.Oc(o.y,c.y).contains(u)?(m[0]=o.x,1):0;(v=new f.Xb).set(w.x),v.lm(w.z),v.Oo(-1),(g=new f.Xb).set(w.y),g.lm(w.z),g.Oo(-1),(w=new f.Xb).set(g),w.Ag(g);var E=new f.Xb;return E.set(v),E.Ag(v),E.add(w),E.sqrt(),E.qg()||v.qg()&&g.qg()?u==0?(m[0]=o.x,m[1]=c.x,2):0:(h=(1-h)*Math.tan(u)/E.value(),1<Math.abs(h)?0:(h=Math.acos(h),w=Math.atan2(g.value(),v.value()),v=Math.min(o.x,c.x),g=Math.max(o.x,c.x),c=d.XA(w-h,v,g),h=u!=0?d.XA(w+h,v,g):c,u=0,v<=c&&c<=g&&(m[u]=c,u++),h!=c&&v<=h&&h<=g&&(m[u]=h,++u==2&&Math.abs(m[0]-o.x)>Math.abs(m[1]-o.x)&&(o=m[0],m[0]=m[1],m[1]=o)),u))},d.XA=function(h,o,c){return h>c?h-=2*(o=Math.ceil((h-c)/(2*Math.PI)))*Math.PI:h<o&&(h+=2*(o=Math.ceil((o-h)/(2*Math.PI)))*Math.PI),h},d}()}(ae||(ae={})),function(f){f.PK=function(){function N(){}return N.OX=function(T,d){var h=8,o=[0,0,0,0],c=new f.h;c.N(d),c.scale(f.cb.tc(T).Id().Fc()==9102?1:f.cb.tc(T).Id().bi/3.141592653589793*180),-180>c.x?(c.x-=c.x%360,-180>c.x&&(c.x+=360)):180<c.x&&(c.x-=c.x%360,180<c.x&&(c.x-=360)),90<c.y&&(c.y=90),-90>c.y&&(c.y=-90);for(var u=-180,m=180,g=(T=5*h)-1,v=(d=(T+31)/32)-1;0<=v;v--)for(var w=g-32*v,E=Math.min(32,T-32*v),C=1;C<E;C+=2){var R=.5*(m+u);c.x>=R?(o[v]|=1<<w,u=R):m=R,w-=2,g-=2}for(u=-90,m=90,g=T-2,v=d-1;0<=v;v--)for(w=g-32*v,E=Math.min(32,T-32*v),C=0;C<E;C+=2)R=.5*(m+u),c.y>=R?(o[v]|=1<<w,u=R):m=R,w-=2,g-=2;return N.SP(o,h,h)},N.SP=function(T,d,h){for(var o=[],c=0;c<d;c++)o[c]="";for(var u=c=0,m=0;m<d;m++){var g=T[c]>>u&31;if(31<(u+=5)){var v=37-u;g&=(1<<v)-1,u-=32,g|=(T[++c]&(1<<u)-1)<<v}o[d-1-m]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[g]}if(h>d)for(m=0;m<h-d;m++)o.push("0");else h<d&&(o.length=h);return o.join("")},N}()}(ae||(ae={})),function(f){var N={gcstol:[0,2e-9,1,2241706620489156e-24,2,2313672246530541e-24,3,898240164660333e-23,4,8982433838020134e-24,5,8982439417325895e-24,6,8982466029667677e-24,7,8982476760268133e-24,8,8982492642167149e-24,9,898251968292634e-23,10,898253685210448e-23,11,8982546725256576e-24,12,8982557456049832e-24,13,898257333682596e-23,14,8982575482995276e-24,15,8982578488197342e-24,16,8982579775336987e-24,17,89825840676828e-22,18,8982599090925448e-24,19,8982605529473397e-24,20,8982609220517402e-24,21,8982611968030573e-24,22,8982616260407152e-24,23,8982620552787834e-24,24,8982633429954492e-24,25,8982637722351582e-24,26,898264416095491e-23,27,8982646307158072e-24,28,8982654891980968e-24,29,8982667769246082e-24,30,8982674207892485e-24,31,8982680646548117e-24,32,8982682792768713e-24,33,8982685798042582e-24,34,8982689231436652e-24,35,898269137766135e-23,36,898269266624163e-23,37,8982705114087017e-24,38,8982706830791106e-24,39,8982711958374661e-24,40,8982712839964735e-24,41,8982717991496125e-24,42,8982721424914803e-24,43,8982723571154887e-24,44,8982727863638127e-24,45,8982730868942154e-24,46,8982734302370678e-24,47,8982745033612112e-24,48,8982751472369276e-24,49,8982755764879183e-24,50,8982762203651733e-24,51,8982764776628385e-24,52,8982766496171896e-24,53,898277722749025e-23,54,898278152002477e-23,55,898279933943848e-23,56,89829143024805e-22,57,8982922161948598e-24,58,898292327314211e-23,59,8982925667349601e-24,60,8982932222965576e-24,61,8982961298941316e-24,62,8982965524049989e-24,63,8982994818246099e-24,64,8982994895706967e-24,65,898299489597736e-23,66,8983000733443498e-24,67,8983055097289157e-24,68,8983064111047368e-24,69,8983111996941178e-24,70,8983120447446023e-24,71,898312748954554e-23,72,8983134531656096e-24,73,8983141573777694e-24,74,8983148615910332e-24,75,8983152841195215e-24,76,8983153545409748e-24,77,8983153827095593e-24,78,898315396793852e-23,79,8983154249624393e-24,80,8983155658054012e-24,81,8983960794340072e-24,82,8984061344391998e-24,83,8984072829255685e-24,84,8984194981201908e-24,85,8984275233099427e-24,86,8984326127007554e-24,87,8984330099816539e-24,88,898433275258421e-23,89,8984333047023206e-24,90,8984333885258723e-24,91,8984337959508212e-24,92,8984365176209457e-24,93,8984727360418079e-24,94,8984901041679577e-24,95,898542662091587e-23,96,898610024130669e-23,97,8992894229037531e-24,98,8993203677616635e-24,99,8993206178094346e-24,100,8993216059187305e-24,101,899322029394808e-23,102,8994627867045891e-24,103,9467559984315793e-24,104,946881168618118e-23,105,9980888154931644e-24,106,9981105353606775e-24,107,9983807356573187e-24,108,1687060485811522e-23,109,1688447560354875e-23,110,2176606011487185e-23,111,2225078816042032e-23,112,2348476432064694e-23,113,2348765250187846e-23,114,2378108974103778e-23,115,314559636297708e-22,116,3297788621680806e-23,117,3667892343788279e-23,118,4235973644320739e-23,119,4794625900676345e-23,120,7262742998235812e-23,121,7499447580246377e-23,122,7525056410964318e-23,123,7979913581209237e-23,124,9662020153976783e-23,125,9799175562353741e-23,126,9897353517547472e-23,127,102313891987647e-21,128,1081460541960784e-22,129,121905913857622e-21,130,2246893314238523e-22,131,2297344808062643e-22,132,242984645941825e-21,133,2754604784282804e-22,134,2884548130346993e-22,135,3370339971357784e-22,136,4307953346848296e-22,137,5208707228462029e-22,138,5509209568565608e-22,139,6452227422644406e-22,140,6740679942715567e-22,141,6861770001566745e-22,142,7252630318111686e-22,143,7441010326374328e-22,144,7742672907173287e-22,145,9629542775307953e-22,146,1061032953945969e-21,147,1143628333594458e-21,148,1162186197019925e-21,149,136418522650196e-20,150,1367441038498385e-21,151,1432394487827058e-21,152,1736235742820677e-21,153,1848250952034914e-21,154,1909859317102744e-21,155,1975716534933873e-21,156,2122065907891938e-21,157,272837045300392e-20,158,3183098861837907e-21,159,3580986219567645e-21,160,3819718634205488e-21,161,409255567950588e-20,162,4407367654852486e-21,163,4774648292756861e-21,164,5161781938115525e-21,165,520870722846203e-20,166,5729577951308232e-21,167,6031134685587613e-21,168,6987290184522236e-21,169,9241254760174569e-21,170,1145915590261646e-20],pcstol:[0,6666666666666667e-24,1,2e-8,2,4970973863636364e-20,3,4970978156565657e-20,4,4970980410559237e-20,5,.001,6,.001093615055555556,7,.001093615194444445,8,.001093619003239988,9,.001093623110088878,10,.003280833333333333,11,.003280839895013123,12,.003280843014596366,13,.003280845583333334,14,.003280869330266636,15,.00497101413676763],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3389,2577,3390,2694,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,6207,104256,6244,102769,6245,102790,6246,102770,6247,102771,6248,102793,6249,102796,6250,102772,6251,102788,6252,102775,6253,102795,6254,102781,6255,102767,6256,102774,6257,102768,6258,102797,6259,102789,6260,102780,6261,102783,6262,102787,6263,102791,6264,102777,6265,102798,6266,102779,6267,102784,6268,102792,6269,102782,6270,102785,6271,102794,6272,102773,6273,102778,6274,102786,6275,102776,6311,104141,6318,104145,6322,104287,6325,104286,6328,102046,6329,102047,6330,102048,6331,102049,6332,102050,6333,102051,6334,102052,6335,102053,6336,102054,6337,102055,6338,102056,6339,102057,6340,102058,6341,102059,6342,102382,6343,102383,6344,102384,6345,102385,6346,102386,6347,102387,6348,102388,6350,102965,6355,102975,6356,102976,6391,6141,6393,102966,6394,102977,6395,102978,6396,102979,6397,102980,6398,102981,6399,102982,6400,102983,6401,102984,6402,102985,6403,102986,6404,102988,6405,102991,6406,102987,6407,102990,6408,102989,6409,102992,6410,102993,6411,102995,6412,102994,6413,102996,6414,102962,6415,102997,6416,103003,6417,102998,6418,103004,6419,102999,6420,103005,6421,103e3,6422,103006,6423,103001,6424,103007,6425,103002,6426,103008,6427,103010,6428,103013,6429,103009,6430,103012,6431,103011,6432,103014,6433,103015,6434,103016,6435,103017,6436,103018,6437,103019,6438,103022,6439,102967,6440,103021,6441,103024,6442,103020,6443,103023,6444,103025,6445,103027,6446,103026,6447,103028,6448,103030,6449,103033,6450,103029,6451,103032,6452,103031,6453,103034,6454,103035,6455,103037,6456,103036,6457,103038,6458,103039,6459,103041,6460,103040,6461,103042,6462,103043,6463,103045,6464,103044,6465,103046,6466,103047,6467,103049,6468,103048,6469,103050,6470,103051,6471,103052,6472,103053,6473,103054,6474,103055,6475,103056,6476,103057,6477,103059,6478,103058,6479,103060,6480,103066,6481,103065,6482,103067,6483,103061,6484,103063,6485,103062,6486,103064,6487,103068,6488,103069,6489,103071,6490,103073,6491,103070,6492,103072,6493,103075,6494,103078,6495,103074,6496,103077,6497,102968,6498,103076,6499,103079,6500,103081,6501,103084,6502,103080,6503,103083,6504,103082,6505,103085,6506,103086,6507,103088,6508,102963,6509,103087,6510,103089,6511,103091,6512,103090,6513,103092,6514,103093,6515,103094,6516,103095,6518,103098,6519,103101,6520,103097,6521,103100,6522,103099,6523,103102,6524,103103,6525,103104,6526,103105,6527,103106,6528,103108,6529,103111,6530,103107,6531,103110,6532,103109,6533,103112,6534,103114,6535,103118,6536,103113,6537,103117,6538,103116,6539,103120,6540,103115,6541,103119,6542,103121,6543,103122,6544,103123,6545,103125,6546,103124,6547,103126,6548,103127,6549,103129,6550,103128,6551,103130,6552,103131,6553,103133,6554,103132,6555,103134,6556,102969,6557,102970,6558,103135,6559,103137,6560,103136,6561,103138,6562,103139,6563,103140,6564,103141,6565,103142,6566,103200,6567,103143,6568,103144,6569,103145,6570,103146,6571,103147,6572,103149,6573,103148,6574,103150,6575,103151,6576,103152,6577,103155,6578,103160,6579,102971,6580,102972,6581,103153,6582,103158,6583,103154,6584,103159,6585,103157,6586,103162,6587,103156,6588,103161,6589,103172,6590,103173,6592,103174,6593,103176,6594,103175,6595,103177,6596,103178,6597,103180,6598,103179,6599,103181,6600,103182,6601,103184,6602,103183,6603,103185,6605,103190,6606,103186,6607,103189,6608,103188,6609,103191,6610,102973,6611,103192,6612,103196,6613,103193,6614,103197,6615,103195,6616,103199,6617,103194,6618,103198,6619,103164,6620,103163,6621,103165,6625,103170,6626,103169,6627,103171,6628,102520,6629,102521,6630,102522,6631,102523,6632,102524,6633,102527,6634,102493,6635,102494,6636,102496,6637,102495,6668,104020,6669,102610,6670,102611,6671,102612,6672,102613,6673,102614,6674,102615,6675,102616,6676,102617,6677,102618,6678,102619,6679,102620,6680,102621,6681,102622,6682,102623,6683,102624,6684,102625,6685,102626,6686,102627,6687,102628,6688,102593,6689,102594,6690,102595,6691,102596,6692,102597,6783,104223,6784,102530,6785,102500,6788,102532,6789,102502,6792,102533,6793,102503,6796,102531,6797,102501,6800,102534,6801,102504,6804,102535,6805,102505,6808,102536,6809,102506,6812,102537,6813,102507,6816,102538,6817,102508,6820,102539,6821,102509,6824,102540,6825,102510,6828,102541,6829,102511,6832,102542,6833,102512,6836,102543,6837,102513,6840,102544,6841,102514,6844,102546,6845,102516,6848,102545,6849,102515,6852,102547,6853,102517,6856,102548,6857,102518,6860,102549,6861,102519,6867,102380,6868,102381,6879,103187,6880,103096,6884,102376,6885,102378,6886,102377,6887,102379,7136,6980,7139,6987,7142,102706,7692,102557,7693,102558,7694,102559,7695,102560,7696,102561,8090,103318,8091,103418,8092,103317,8093,103417,8095,103371,8096,103471,8097,103369,8098,103469,8099,103368,8100,103468,8101,103367,8102,103467,8103,103366,8104,103466,8105,103365,8106,103465,8107,103364,8108,103464,8109,103363,8110,103463,8111,103362,8112,103462,8113,103361,8114,103461,8115,103360,8116,103460,8117,103359,8118,103459,8119,103357,8120,103457,8121,103356,8122,103456,8123,103355,8124,103455,8125,103354,8126,103454,8127,103353,8128,103453,8129,103352,8130,103452,8131,103350,8132,103450,8133,103349,8134,103449,8135,103348,8136,103448,8139,103343,8140,103443,8141,103342,8142,103442,8143,103341,8144,103441,8145,103339,8146,103439,8147,103337,8148,103437,8149,103336,8150,103436,8151,103334,8152,103434,8153,103333,8154,103433,8155,103331,8156,103431,8161,103326,8162,103426,8163,103325,8164,103425,8165,103324,8166,103424,8171,103321,8172,103421,8173,103320,8177,103420,8179,103316,8180,103416,8181,103315,8182,103415,8184,103314,8185,103414,8191,103312,8193,103412,8196,103311,8197,103411,8198,103310,8200,103410,8201,103309,8202,103409,8203,103308,8204,103408,8207,103306,8208,103406,8209,103305,8210,103405,8212,103304,8213,103404,8214,103303,8216,103403,8218,103302,8220,103402,8222,103301,8224,103401,8431,104248,8441,102590,8693,102449,8826,102605,8857,54035,8858,54036,8859,54037,8860,8449,8988,104115,8989,104116,8990,104117,8991,104118,8992,104119,8993,104120,8994,104121,8995,104122,8996,104123,8997,104124,8998,104896,8999,104257,9e3,104019,9014,104010,9019,104021,9053,104011,9054,104012,9055,104013,9056,104014,9057,104015,9059,104258,9060,104179,9061,104180,9062,104181,9063,104182,9064,104183,9065,104184,9066,104185,9067,104186,21896,21891,21897,21892,21898,21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077,102550,2181,102551,2182,102552,2183,102553,2184,102554,2185,102555,2186,102556,2187],pcsid:[2066,15,2136,12,2155,10,2157,5,2158,5,2159,12,2160,12,2219,5,2220,5,2244,10,2245,10,2256,11,2265,11,2266,11,2269,11,2270,11,2273,11,2290,5,2291,5,2294,5,2295,5,2313,5,2314,14,2899,10,2900,10,2901,11,2909,11,2910,11,2911,10,2912,10,2913,11,2914,11,2964,10,2967,10,2968,10,2991,5,2992,11,2993,5,2994,11,3073,5,3076,5,3079,5,3091,10,3106,5,3108,5,3109,5,3141,5,3142,5,3167,4,3337,5,3347,5,3348,5,3359,10,3360,5,3361,11,3362,5,3363,10,3364,5,3365,10,3366,14,3402,5,3403,5,3405,5,3406,5,3439,5,3440,5,3447,5,3449,5,3450,5,3453,10,3454,10,3460,5,3479,11,3480,5,3481,11,3482,5,3483,11,3484,5,3485,10,3486,5,3487,10,3488,5,3489,5,3490,10,3491,5,3492,10,3493,5,3494,10,3495,5,3496,10,3497,5,3498,10,3499,5,3500,10,3501,5,3502,10,3503,5,3504,10,3505,5,3506,10,3507,5,3508,10,3509,5,3510,10,3511,5,3512,10,3513,5,3514,5,3515,10,3516,5,3517,10,3518,5,3519,10,3520,5,3521,10,3522,5,3523,10,3524,5,3525,10,3526,5,3527,10,3528,5,3529,10,3530,5,3531,10,3532,5,3533,10,3534,5,3535,10,3536,5,3537,10,3538,5,3539,10,3540,5,3541,10,3542,5,3543,10,3544,5,3545,10,3546,5,3547,10,3548,5,3549,10,3550,5,3551,10,3552,5,3553,10,3582,10,3583,5,3584,10,3585,5,3586,10,3587,5,3588,11,3589,5,3590,11,3591,5,3592,5,3593,11,3598,10,3599,5,3600,10,3605,11,3606,5,3607,5,3608,10,3609,5,3610,10,3611,5,3612,10,3613,5,3614,10,3615,5,3616,10,3617,5,3618,10,3619,5,3620,10,3621,5,3622,10,3623,5,3624,10,3625,5,3626,10,3627,5,3628,10,3629,5,3630,10,3631,5,3632,10,3633,5,3634,11,3635,5,3636,11,3640,10,3641,5,3642,10,3643,5,3644,11,3645,5,3646,11,3647,5,3648,11,3649,5,3650,10,3651,5,3652,10,3653,5,3654,10,3655,5,3656,11,3657,5,3658,10,3659,5,3660,10,3661,5,3662,10,3663,5,3664,10,3668,10,3669,5,3670,10,3671,5,3672,10,3673,5,3674,10,3675,5,3676,11,3677,10,3678,5,3679,11,3680,10,3681,5,3682,11,3683,10,3684,5,3685,5,3686,10,3687,5,3688,10,3689,5,3690,10,3691,5,3692,10,3696,10,3697,5,3698,10,3699,5,3700,10,3740,5,3749,5,3783,5,3784,5,3793,5,3794,5,3802,5,3816,5,3829,5,3854,5,3911,5,3912,5,3920,5,3978,5,3979,5,3991,10,3992,10,4026,5,4037,5,4038,5,4087,5,4088,5,4217,10,4438,10,4439,10,4467,5,4471,5,4474,5,4559,5,4822,5,4839,5,5018,5,5048,5,5167,5,5168,5,5223,5,5234,5,5235,5,5243,5,5266,5,5316,5,5320,5,5321,5,5330,5,5331,5,5337,5,5361,5,5362,5,5382,5,5383,5,5396,5,5456,5,5457,5,5469,5,5472,9,5490,5,5518,5,5523,5,5559,5,5588,11,5589,14,5596,5,5627,5,5629,5,5641,5,5643,5,5644,5,5654,10,5655,10,5659,5,5700,5,5825,5,5836,5,5837,5,5842,5,5844,5,5880,5,5887,5,5890,5,6128,11,6129,11,6141,11,6204,5,6210,5,6211,5,6307,5,6312,5,6316,5,6362,5,6591,5,6646,5,6703,5,6786,5,6787,11,6790,5,6791,11,6794,5,6795,11,6798,5,6799,11,6802,5,6803,11,6806,5,6807,11,6810,5,6811,11,6814,5,6815,11,6818,5,6819,11,6822,5,6823,11,6826,5,6827,11,6830,5,6831,11,6834,5,6835,11,6838,5,6839,11,6842,5,6843,11,6846,5,6847,11,6850,5,6851,11,6854,5,6855,11,6858,5,6859,11,6862,5,6863,11,6870,5,6875,5,6876,5,6915,5,6922,5,6923,10,6924,5,6925,10,6962,5,6984,5,6991,5,7128,10,7131,5,7132,10,7257,5,7258,10,7259,5,7260,10,7261,5,7262,10,7263,5,7264,10,7265,5,7266,10,7267,5,7268,10,7269,5,7270,10,7271,5,7272,10,7273,5,7274,10,7275,5,7276,10,7277,5,7278,10,7279,5,7280,10,7281,5,7282,10,7283,5,7284,10,7285,5,7286,10,7287,5,7288,10,7289,5,7290,10,7291,5,7292,10,7293,5,7294,10,7295,5,7296,10,7297,5,7298,10,7299,5,7300,10,7301,5,7302,10,7303,5,7304,10,7305,5,7306,10,7307,5,7308,10,7309,5,7310,10,7311,5,7312,10,7313,5,7314,10,7315,5,7316,10,7317,5,7318,10,7319,5,7320,10,7321,5,7322,10,7323,5,7324,10,7325,5,7326,10,7327,5,7328,10,7329,5,7330,10,7331,5,7332,10,7333,5,7334,10,7335,5,7336,10,7337,5,7338,10,7339,5,7340,10,7341,5,7342,10,7343,5,7344,10,7345,5,7346,10,7347,5,7348,10,7349,5,7350,10,7351,5,7352,10,7353,5,7354,10,7355,5,7356,10,7357,5,7358,10,7359,5,7360,10,7361,5,7362,10,7363,5,7364,10,7365,5,7366,10,7367,5,7368,10,7369,5,7370,10,7877,5,7878,5,7882,5,7883,5,7887,5,7899,5,7991,5,7992,5,8035,10,8036,10,8058,5,8059,5,8082,5,8083,5,8088,5,8137,5,8138,10,8157,5,8158,10,8159,5,8160,10,8167,5,8168,10,8169,5,8170,10,8187,5,8189,10,8205,5,8206,10,8225,5,8226,10,8311,5,8312,11,8313,5,8314,11,8315,5,8316,11,8317,5,8318,11,8319,5,8320,11,8321,5,8322,11,8323,5,8324,11,8325,5,8326,11,8327,5,8328,11,8329,5,8330,11,8331,5,8332,11,8333,5,8334,11,8335,5,8336,11,8337,5,8338,11,8339,5,8340,11,8341,5,8342,11,8343,5,8344,11,8345,5,8346,11,8347,5,8348,11,8352,5,8353,5,8379,5,8380,10,8381,5,8382,10,8383,5,8384,10,8385,5,8387,10,8391,5,8395,5,8433,5,8455,5,8456,5,8531,10,8682,5,8687,5,8692,5,8903,5,8950,5,8951,5,9039,5,9040,5,9141,5,9149,5,9150,5,9191,5,9221,5,9222,5,20499,5,20538,5,20539,5,20790,5,20791,5,21291,5,21292,5,21500,5,21817,5,21818,5,22032,5,22033,5,22091,5,22092,5,22332,5,22391,5,22392,5,22700,5,22770,5,22780,5,22832,5,23090,5,23095,5,23239,5,23240,5,23433,5,23700,5,24047,5,24048,5,24100,14,24200,5,24305,5,24306,5,24382,6,24383,5,24500,5,24547,5,24548,5,24571,2,24600,5,25e3,5,25231,5,25884,5,25932,5,26237,5,26331,5,26332,5,26591,5,26592,5,26632,5,26692,5,26855,10,26856,10,27120,5,27200,5,27291,7,27292,7,27429,5,27492,5,27500,5,27700,5,28232,5,28600,5,28991,5,28992,5,29100,5,29220,5,29221,5,29333,5,29635,5,29636,5,29701,5,29738,5,29739,5,29849,5,29850,5,29871,3,29872,13,29873,5,29900,5,29901,5,29903,5,30200,15,30339,5,30340,5,30791,5,30792,5,31028,5,31121,5,31154,5,31170,5,31171,5,31370,5,31528,5,31529,5,31600,5,31700,5,31838,5,31839,5,31901,5,32061,5,32062,5,32098,5,32099,10,32100,5,32104,5,32161,5,32766,5,53048,5,53049,5,54090,5,54091,5,65061,10,65062,10,65161,5,65163,5,102041,10,102064,8,102068,1,102069,0,102118,10,102119,11,102120,10,102121,10,102217,10,102218,5,102219,10,102220,10,102378,11,102379,11,102380,5,102381,11,102498,5,102499,5,102589,10,102590,5,102599,10,102600,10,102604,10,102605,5,102606,5,102647,5,102704,10,102705,10,102706,5,102733,10,102761,10,102762,5,102763,10,102764,5,102765,5,102766,10,102962,5,102963,5,102970,11,102974,10,102993,5,102994,5,102995,10,102996,10,103015,5,103016,10,103017,5,103018,10,103025,5,103026,5,103027,10,103028,10,103035,5,103036,5,103037,10,103038,10,103039,5,103040,5,103041,10,103042,10,103043,5,103044,5,103045,10,103046,10,103047,5,103048,5,103049,10,103050,10,103051,5,103052,10,103053,5,103054,10,103055,5,103056,10,103057,5,103058,5,103059,10,103060,10,103061,5,103062,5,103063,10,103064,10,103069,10,103070,5,103071,5,103072,10,103073,10,103086,5,103087,5,103088,10,103089,10,103094,11,103095,5,103096,10,103103,5,103104,10,103105,5,103106,10,103121,5,103122,10,103123,5,103124,5,103125,11,103126,11,103127,5,103128,5,103129,10,103130,10,103131,5,103132,5,103133,10,103134,10,103135,5,103136,5,103137,11,103138,11,103139,5,103140,10,103141,5,103142,10,103143,5,103144,10,103145,5,103146,11,103147,5,103148,5,103149,10,103150,10,103151,5,103152,10,103172,5,103173,10,103174,5,103175,5,103176,10,103177,10,103178,5,103179,5,103180,10,103181,10,103182,5,103183,5,103184,10,103185,10,103228,5,103229,5,103230,10,103231,10,103250,5,103251,10,103252,5,103253,10,103260,5,103261,5,103262,10,103263,10,103270,5,103271,5,103272,10,103273,10,103274,5,103275,5,103276,10,103277,10,103278,5,103279,5,103280,10,103281,10,103282,5,103283,5,103284,10,103285,10,103286,5,103287,10,103288,5,103289,10,103290,5,103291,10,103292,5,103293,5,103294,10,103295,10,103296,5,103297,5,103298,10,103299,10,103376,10,103377,5,103378,5,103379,10,103380,10,103393,5,103394,5,103395,10,103396,10,103472,5,103473,11,103474,5,103475,10,103482,5,103483,10,103484,5,103485,10,103500,5,103501,10,103502,5,103503,5,103504,11,103505,11,103506,5,103507,5,103508,10,103509,10,103510,5,103511,5,103512,10,103513,10,103514,5,103515,10,103516,5,103517,10,103518,5,103519,10,103520,5,103521,11,103522,5,103523,5,103524,10,103525,10,103526,5,103527,10,103561,10,103562,10,103563,5,103564,5,103565,10,103566,10,103567,5,103568,5,103569,10,103570,10,103585,10,103586,5,103587,10,103588,11,103589,5,103590,10,103591,11,103592,5,103593,10,103594,11,103695,10,103846,5,103946,10],pcsidc:[[2e3,2045,5],[2056,2065,5],[2067,2135,5],[2137,2153,5],[2161,2170,5],[2172,2193,5],[2196,2198,5],[2200,2203,5],[2206,2217,5],[2222,2224,11],[2251,2253,11],[2280,2282,11],[2308,2311,5],[2315,2325,5],[2327,2394,5],[2400,2491,5],[2494,2758,5],[2867,2869,11],[2870,2888,10],[2891,2895,10],[2896,2898,11],[2902,2908,10],[2915,2920,10],[2921,2923,11],[2924,2930,10],[2931,2941,5],[2969,2973,5],[2975,2982,5],[2984,2988,5],[2995,3002,5],[3006,3051,5],[3054,3059,5],[3061,3066,5],[3068,3071,5],[3084,3087,5],[3112,3118,5],[3120,3138,5],[3146,3151,5],[3153,3157,5],[3161,3166,5],[3168,3172,5],[3174,3203,5],[3294,3313,5],[3315,3335,5],[3339,3345,5],[3350,3358,5],[3367,3369,5],[3374,3388,5],[3391,3399,5],[3408,3416,5],[3425,3432,10],[3441,3446,10],[3456,3459,10],[3465,3478,5],[3554,3559,5],[3561,3565,10],[3568,3570,10],[3571,3581,5],[3594,3597,5],[3601,3604,5],[3637,3639,5],[3665,3667,5],[3693,3695,5],[3701,3727,5],[3728,3733,10],[3744,3747,5],[3753,3758,10],[3761,3763,5],[3765,3769,5],[3779,3781,5],[3788,3791,5],[3797,3799,5],[3832,3841,5],[3844,3852,5],[3873,3885,5],[3890,3893,5],[3942,3950,5],[3968,3970,5],[3973,3976,5],[3986,3989,5],[3994,3997,5],[4390,4398,5],[4399,4413,10],[4418,4433,10],[4491,4554,5],[4568,4589,5],[4652,4656,5],[4766,4800,5],[5069,5072,5],[5105,5130,5],[5180,5184,5],[5253,5259,5],[5269,5275,5],[5292,5311,5],[5343,5349,5],[5355,5357,5],[5387,5389,5],[5459,5463,5],[5479,5482,5],[5530,5539,5],[5550,5552,5],[5562,5583,5],[5623,5625,10],[5631,5639,5],[5649,5653,5],[5663,5680,5],[5682,5685,5],[5875,5877,5],[5896,5899,5],[5921,5940,5],[6050,6125,5],[6351,6354,5],[6366,6372,5],[6381,6387,5],[6622,6624,5],[6707,6709,5],[6720,6723,5],[6732,6738,5],[6931,6933,5],[7005,7007,5],[7057,7070,10],[7074,7082,5],[7109,7118,5],[7119,7127,11],[7374,7376,5],[7528,7586,5],[7587,7645,10],[7755,7787,5],[7791,7795,5],[7799,7801,5],[7803,7805,5],[7825,7831,5],[7845,7859,5],[8013,8032,5],[8065,8068,11],[8518,8529,10],[8533,8536,10],[8538,8540,10],[8677,8679,5],[8836,8840,5],[8908,8910,5],[9154,9159,5],[9205,9218,5],[20002,20032,5],[20062,20092,5],[20135,20138,5],[20248,20258,5],[20348,20358,5],[20436,20440,5],[20822,20824,5],[20934,20936,5],[21035,21037,5],[21095,21097,5],[21148,21150,5],[21413,21423,5],[21473,21483,5],[21780,21782,5],[21891,21894,5],[22171,22177,5],[22181,22187,5],[22191,22197,5],[22234,22236,5],[22521,22525,5],[22991,22994,5],[23028,23038,5],[23830,23853,5],[23866,23872,5],[23877,23884,5],[23886,23894,5],[23946,23948,5],[24311,24313,5],[24342,24347,5],[24370,24374,6],[24375,24381,5],[24718,24721,5],[24817,24821,5],[24877,24882,5],[24891,24893,5],[25391,25395,5],[25828,25838,5],[26191,26195,5],[26391,26393,5],[26703,26722,5],[26729,26760,10],[26766,26798,10],[26860,26870,10],[26891,26899,5],[26903,26923,5],[26929,26946,5],[26948,26998,5],[27037,27040,5],[27205,27232,5],[27258,27260,5],[27391,27398,5],[27561,27564,5],[27571,27574,5],[27581,27584,5],[27591,27594,5],[28191,28193,5],[28348,28358,5],[28402,28432,5],[28462,28492,5],[29118,29122,5],[29177,29185,5],[30161,30179,5],[30491,30494,5],[30729,30732,5],[31251,31259,5],[31265,31268,5],[31275,31278,5],[31288,31297,5],[31461,31465,5],[31491,31495,5],[31917,31922,5],[31965,31985,5],[31992,32e3,5],[32001,32003,10],[32005,32031,10],[32033,32060,10],[32074,32077,10],[32081,32086,5],[32107,32130,5],[32133,32158,5],[32164,32167,10],[32180,32199,5],[32201,32260,5],[32301,32360,5],[32601,32662,5],[32664,32667,10],[32701,32761,5],[53001,53004,5],[53008,53019,5],[53021,53032,5],[53034,53037,5],[53042,53046,5],[53074,53080,5],[54001,54004,5],[54008,54019,5],[54021,54032,5],[54034,54037,5],[54042,54046,5],[54048,54053,5],[54074,54080,5],[54098,54101,5],[102001,102040,5],[102042,102063,5],[102065,102067,5],[102070,102112,5],[102114,102117,5],[102122,102208,5],[102210,102216,5],[102221,102300,5],[102304,102377,5],[102382,102388,5],[102389,102398,10],[102399,102444,5],[102445,102447,10],[102448,102458,5],[102459,102468,10],[102469,102496,5],[102500,102519,11],[102520,102524,5],[102525,102529,10],[102530,102549,5],[102557,102588,5],[102593,102598,5],[102601,102603,5],[102608,102628,5],[102629,102646,10],[102648,102672,10],[102675,102700,10],[102701,102703,5],[102707,102730,10],[102735,102758,10],[102767,102900,5],[102965,102969,5],[102971,102973,5],[102975,102989,5],[102990,102992,11],[102997,103002,5],[103003,103008,10],[103009,103011,5],[103012,103014,10],[103019,103021,5],[103022,103024,10],[103029,103031,5],[103032,103034,10],[103065,103068,5],[103074,103076,5],[103077,103079,11],[103080,103082,5],[103083,103085,10],[103090,103093,5],[103097,103099,5],[103100,103102,10],[103107,103109,5],[103110,103112,10],[103113,103116,5],[103117,103120,10],[103153,103157,5],[103158,103162,10],[103163,103165,5],[103166,103168,11],[103169,103171,10],[103186,103188,5],[103189,103191,10],[103192,103195,5],[103196,103199,10],[103200,103224,5],[103225,103227,11],[103232,103237,5],[103238,103243,10],[103244,103246,5],[103247,103249,10],[103254,103256,5],[103257,103259,10],[103264,103266,5],[103267,103269,10],[103300,103375,5],[103381,103383,5],[103384,103386,11],[103387,103389,5],[103390,103392,10],[103397,103399,5],[103400,103471,10],[103476,103478,5],[103479,103481,10],[103486,103488,5],[103489,103491,10],[103492,103495,5],[103496,103499,10],[103539,103543,5],[103544,103548,10],[103549,103551,5],[103552,103554,11],[103555,103557,10],[103558,103560,5],[103571,103573,5],[103574,103576,10],[103577,103580,5],[103581,103583,10],[103595,103597,5],[103600,103694,5],[103696,103698,5],[103700,103793,10],[103794,103799,5]],gcsid:[4001,81,4002,85,4003,70,4004,84,4005,82,4006,83,4007,60,4008,67,4009,39,4010,57,4011,63,4012,64,4013,64,4014,63,4015,92,4016,90,4018,86,4019,75,4020,68,4021,70,4022,55,4023,75,4024,66,4025,73,4027,95,4028,59,4029,58,4031,75,4032,78,4033,77,4034,65,4035,100,4036,70,4042,88,4044,87,4045,89,4046,75,4047,99,4052,101,4053,97,4054,61,4075,75,4081,75,4120,84,4121,75,4122,80,4123,55,4124,84,4126,75,4130,75,4131,92,4132,64,4133,75,4134,64,4140,75,4141,75,4142,64,4143,64,4144,92,4145,87,4146,89,4147,66,4148,75,4149,84,4150,84,4151,75,4152,75,4153,55,4154,55,4155,63,4156,84,4157,60,4162,84,4163,75,4164,66,4165,55,4166,75,4168,58,4170,75,4172,75,4173,75,4174,58,4175,64,4176,75,4178,66,4179,66,4180,75,4188,81,4190,75,4191,66,4192,55,4193,63,4198,64,4199,55,4200,66,4201,64,4202,70,4203,70,4204,55,4205,66,4206,63,4207,55,4208,55,4209,64,4210,64,4211,84,4212,64,4213,63,4214,66,4215,55,4216,67,4218,55,4219,84,4220,64,4221,55,4222,64,4224,55,4225,55,4229,68,4230,55,4231,55,4232,64,4234,64,4235,55,4236,55,4237,70,4238,70,4239,92,4240,92,4241,65,4242,67,4243,88,4244,92,4245,86,4246,64,4250,64,4251,64,4252,63,4253,67,4254,55,4255,55,4256,64,4257,84,4258,75,4259,55,4260,64,4261,106,4262,84,4263,64,4265,55,4266,63,4267,67,4269,75,4270,64,4271,55,4272,55,4273,82,4274,55,4275,63,4276,73,4280,84,4281,57,4282,63,4283,75,4284,66,4285,55,4286,68,4288,55,4289,84,4291,70,4292,55,4293,83,4294,84,4295,84,4296,63,4297,55,4298,90,4299,85,4300,85,4301,84,4302,60,4303,68,4306,84,4307,64,4308,84,4309,55,4310,63,4311,55,4312,84,4313,55,4314,84,4315,63,4316,55,4317,66,4318,75,4319,75,4322,80,4324,80,4326,75,4466,75,4469,75,4475,55,4483,75,4490,75,4555,66,4558,75,4608,67,4609,67,4610,74,4614,55,4619,75,4624,75,4625,55,4627,75,4636,55,4637,55,4638,67,4639,55,4657,93,4659,75,4660,55,4661,75,4666,84,4667,75,4670,75,4671,63,4674,75,4679,64,4680,64,4682,92,4683,67,4686,75,4687,75,4693,75,4694,75,4695,67,4696,64,4697,64,4702,75,4703,64,4704,55,4705,55,4706,68,4718,55,4720,80,4721,55,4723,67,4726,67,4737,75,4738,60,4740,79,4741,55,4742,75,4743,64,4744,64,4745,84,4746,84,4747,75,4748,56,4749,75,4750,75,4751,91,4752,56,4753,55,4754,55,4759,75,4761,75,4801,84,4802,55,4803,55,4804,84,4805,84,4806,55,4807,106,4808,84,4809,55,4810,105,4811,106,4816,106,4817,82,4818,84,4820,84,4821,106,4823,55,4824,55,4901,107,4902,107,4903,59,4904,84,5228,84,5229,84,5233,92,5252,75,5264,75,5340,75,5354,75,5360,75,5371,75,5373,75,5381,75,5393,75,5464,60,5467,67,5489,75,5524,55,5527,70,5546,75,5561,66,5593,75,5681,84,5886,75,6135,75,6365,75,6706,75,6881,64,6882,64,6883,55,6892,64,6894,64,6980,75,6983,75,6987,75,6990,75,7035,75,7037,75,7039,75,7041,75,7073,75,7084,75,7086,75,7133,75,7373,75,7683,76,7798,75,7844,75,7881,75,7886,75,8042,96,8043,96,8086,75,8232,75,8237,75,8240,75,8246,75,8249,75,8252,75,8255,75,8351,84,8427,75,8428,55,8449,75,8545,75,8685,75,8694,64,8699,75,8818,75,8888,75,8900,75,8902,75,8907,75,8949,75,9003,75,9006,75,9009,75,9012,75,9017,75,9068,75,9069,75,9140,75,9148,75,9153,75,37001,73,37002,69,37003,72,37004,71,37005,62,37006,91,37007,94,37008,101,37201,55,37202,92,37203,87,37204,55,37205,55,37206,64,37207,71,37208,64,37211,64,37220,67,37221,55,37222,55,37223,63,37224,55,37225,106,37226,55,37227,55,37228,64,37229,62,37230,55,37231,70,37232,55,37233,55,37235,55,37237,55,37238,55,37239,67,37240,64,37241,55,37242,55,37243,67,37252,67,37253,55,37254,64,37255,84,37257,66,37259,55,37260,67,104017,79,104018,79,104024,75,104027,75,104047,98,104050,75,104100,75,104101,84,104102,84,104103,64,104104,55,104105,84,104106,55,104107,75,104108,75,104109,67,104110,75,104111,75,104112,67,104113,67,104128,102,104129,75,104130,55,104131,84,104132,67,104133,75,104134,75,104135,66,104136,70,104137,75,104138,55,104139,106,104140,106,104223,75,104248,55,104256,92,104261,63,104286,75,104287,75,104304,63,104700,49,104701,9,104702,24,104703,15,104704,28,104705,32,104706,53,104707,46,104708,37,104709,54,104710,11,104711,14,104712,30,104713,52,104714,4,104715,4,104716,23,104717,14,104718,48,104719,29,104720,22,104721,21,104722,35,104723,21,104724,46,104725,22,104726,49,104727,45,104728,52,104729,10,104730,10,104731,21,104732,31,104733,26,104734,40,104735,19,104736,30,104737,34,104738,27,104739,46,104740,5,104741,12,104742,50,104743,9,104744,43,104745,21,104746,26,104747,25,104748,21,104749,7,104750,53,104751,6,104752,33,104753,29,104754,19,104755,41,104756,31,104757,3,104758,41,104759,25,104760,49,104761,41,104762,44,104763,50,104764,46,104765,6,104766,40,104767,16,104768,8,104769,17,104770,48,104771,42,104772,50,104773,25,104774,29,104775,25,104776,32,104777,13,104778,36,104779,47,104780,14,104781,29,104782,23,104783,38,104784,42,104785,18,104786,20,104808,51,104896,75,104900,112,104901,104,104902,103,104903,116,104904,109,104905,108,104906,169,104907,164,104908,0,104909,168,104910,141,104911,166,104912,114,104913,160,104914,151,104915,117,104916,110,104917,140,104918,115,104919,170,104920,163,104921,154,104922,158,104923,161,104924,148,104925,0,104926,159,104927,167,104928,127,104929,131,104930,145,104931,159,104932,136,104933,123,104934,139,104935,134,104936,166,104937,150,104938,137,104939,147,104940,121,104941,165,104942,128,104943,111,104944,1,104945,126,104946,152,104947,157,104948,162,104949,153,104950,156,104951,149,104952,132,104953,122,104954,160,104955,146,104956,143,104957,156,104958,120,104959,125,104960,2,104961,144,104962,142,104963,138,104964,155,104965,135,104966,133,104967,151,104968,118,104969,119,104970,124,104971,108,104972,129,104973,130,104974,113,104975,0,104990,84,104991,75,104992,84],gcsidc:[[4127,4129,67],[4135,4139,67],[4158,4161,55],[4181,4185,55],[4194,4196,55],[4226,4228,63],[4247,4249,55],[4277,4279,81],[4600,4607,64],[4621,4623,55],[4628,4633,55],[4641,4646,55],[4662,4665,55],[4676,4678,66],[4688,4692,55],[4699,4701,64],[4755,4757,75],[4763,4765,75],[4813,4815,84],[8972,8987,75],[37212,37219,55],[37245,37247,55],[37249,37251,55],[104009,104015,75],[104019,104022,75],[104114,104124,75],[104125,104127,55],[104141,104145,75],[104179,104186,75],[104257,104260,75]]},T={c:[[2e3,2035,9001],[2039,2045,9001],[2056,2062,9001],[2067,2090,9001],[2093,2135,9001],[2161,2165,9001],[2172,2180,9001],[2188,2193,9001],[2195,2198,9001],[2200,2203,9001],[2205,2213,9001],[2215,2217,9001],[2222,2224,9002],[2225,2243,9003],[2246,2250,9003],[2251,2253,9002],[2257,2264,9003],[2274,2279,9003],[2280,2282,9002],[2283,2289,9003],[2308,2313,9001],[2315,2491,9001],[2494,2576,9001],[2578,2599,9001],[2601,2693,9001],[2695,2866,9001],[2867,2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],[2931,2933,9001],[2935,2962,9001],[2964,2968,9003],[2969,2973,9001],[2975,2978,9001],[2984,2988,9001],[2995,3051,9001],[3054,3072,9001],[3077,3079,9001],[3081,3088,9001],[3092,3101,9001],[3106,3138,9001],[3146,3151,9001],[3153,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3348,9001],[3350,3358,9001],[3367,3403,9001],[3408,3416,9001],[3417,3438,9003],[3441,3446,9003],[3447,3450,9001],[3451,3453,9003],[3455,3459,9003],[3460,3478,9001],[3554,3559,9001],[3560,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3739,9003],[3740,3751,9001],[3753,3760,9003],[3761,3773,9001],[3775,3777,9001],[3779,3781,9001],[3788,3791,9001],[3797,3802,9001],[3814,3816,9001],[3825,3829,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3942,3950,9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,4036,9102],[4044,4047,9102],[4048,4051,9001],[4052,4054,9102],[4056,4063,9001],[4093,4096,9001],[4120,4124,9102],[4127,4139,9102],[4141,4176,9102],[4178,4185,9102],[4188,4216,9102],[4218,4232,9102],[4235,4260,9102],[4265,4267,9102],[4269,4286,9102],[4292,4304,9102],[4306,4319,9102],[4390,4398,9001],[4399,4413,9003],[4418,4433,9003],[4455,4457,9003],[4484,4489,9001],[4491,4554,9001],[4568,4589,9001],[4600,4630,9102],[4636,4639,9102],[4641,4646,9102],[4652,4656,9001],[4657,4680,9102],[4682,4684,9102],[4686,4765,9102],[4766,4800,9001],[4801,4806,9102],[4813,4815,9102],[5014,5016,9001],[5069,5072,9001],[5105,5130,9001],[5173,5188,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5329,5331,9001],[5343,5349,9001],[5355,5357,9001],[5459,5463,9001],[5479,5482,9001],[5518,5520,9001],[5533,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],[5896,5899,9001],[5921,5940,9001],[6050,6125,9001],[6244,6275,9001],[6328,6348,9001],[6350,6356,9001],[6366,6372,9001],[6381,6387,9001],[6393,6404,9001],[6480,6483,9001],[6511,6514,9001],[6579,6581,9001],[6619,6624,9001],[6625,6627,9003],[6628,6632,9001],[6634,6637,9001],[6669,6692,9001],[6707,6709,9001],[6720,6723,9001],[6732,6738,9001],[6881,6883,9102],[6931,6933,9001],[7005,7007,9001],[7057,7070,9003],[7074,7082,9001],[7109,7118,9001],[7119,7127,9002],[7374,7376,9001],[7528,7586,9001],[7587,7645,9003],[7692,7696,9001],[7755,7787,9001],[7791,7795,9001],[7799,7801,9001],[7803,7805,9001],[7825,7831,9001],[7845,7859,9001],[8013,8032,9001],[8065,8068,9002],[8518,8529,9003],[8533,8536,9003],[8538,8540,9003],[8677,8679,9001],[8836,8840,9001],[8857,8859,9001],[8908,8910,9001],[8972,9e3,9102],[9053,9057,9102],[9059,9069,9102],[9154,9159,9001],[9205,9218,9001],[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21896,21899,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26701,26722,9001],[26729,26746,9003],[26748,26760,9003],[26766,26799,9003],[26847,26870,9003],[26891,26899,9001],[26901,26923,9001],[26929,26946,9001],[26948,26978,9001],[26980,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29168,29172,9001],[29187,29195,9001],[29901,29903,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31277,9001],[31281,31290,9001],[31466,31469,9001],[31491,31495,9001],[31965,32e3,9001],[32001,32003,9003],[32005,32017,9003],[32019,32028,9003],[32033,32035,9003],[32037,32060,9003],[32064,32067,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,9001],[37002,37008,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53034,53037,9001],[53042,53046,9001],[53074,53080,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[54074,54080,9001],[54098,54101,9001],[102001,102005,9001],[102007,102039,9001],[102042,102045,9001],[102060,102063,9001],[102070,102079,9001],[102096,102099,9001],[102101,102109,9001],[102114,102117,9001],[102132,102138,9001],[102141,102144,9001],[102156,102166,9001],[102173,102179,9001],[102191,102198,9001],[102221,102228,9001],[102231,102233,9001],[102237,102240,9001],[102364,102375,9001],[102389,102398,9003],[102399,102419,9001],[102421,102438,9001],[102445,102447,9003],[102450,102458,9001],[102459,102462,9003],[102470,102489,9001],[102550,102556,9001],[102562,102588,9001],[102629,102640,9003],[102648,102650,9003],[102688,102690,9003],[102696,102700,9003],[102701,102703,9001],[102799,102900,9001],[103166,103168,9002],[103220,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103327,103330,9001],[103344,103347,9001],[103372,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],[103390,103392,9003],[103397,103399,9001],[103427,103430,9003],[103444,103447,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103595,103597,9001],[103600,103694,9001],[103696,103698,9001],[103700,103793,9003],[104101,104103,9102],[104126,104131,9102],[104259,104261,9102],[104700,104786,9102],[104900,104975,9102]],nc:[2065,9001,2066,9039,2136,9094,2137,9001,2138,9001,2154,9001,2157,9001,2158,9001,2159,9094,2160,9094,2169,9001,2170,9001,2204,9003,2219,9001,2220,9001,2254,9003,2255,9003,2256,9002,2265,9002,2266,9002,2267,9003,2268,9003,2269,9002,2270,9002,2271,9003,2272,9003,2273,9002,2290,9001,2294,9001,2295,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2980,9001,2981,9001,2991,9001,2992,9002,2993,9001,2994,9002,3074,9001,3075,9001,3080,9002,3089,9003,3090,9001,3091,9003,3102,9003,3141,9001,3142,9001,3167,9301,3360,9001,3361,9002,3362,9001,3363,9003,3364,9001,3365,9003,3404,9003,3405,9001,3406,9001,3407,9005,3439,9001,3440,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3783,9001,3784,9001,3793,9001,3794,9001,3812,9001,3819,9102,3821,9102,3824,9102,3854,9001,3857,9001,3889,9102,3906,9102,3911,9001,3912,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4071,9001,4075,9102,4081,9102,4082,9001,4083,9001,4087,9001,4088,9001,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4322,9102,4324,9102,4326,9102,4414,9001,4415,9001,4417,9001,4434,9001,4437,9001,4438,9003,4439,9003,4462,9001,4463,9102,4467,9001,4470,9102,4471,9001,4475,9102,4483,9102,4490,9102,4555,9102,4558,9102,4559,9001,4632,9102,4633,9102,4647,9001,4807,9105,4808,9102,4809,9102,4810,9105,4811,9105,4816,9105,4817,9102,4818,9102,4820,9102,4821,9105,4822,9001,4823,9102,4824,9102,4826,9001,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5013,9102,5018,9001,5048,9001,5167,9001,5168,9001,5221,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5246,9102,5247,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,9001,5321,9001,5324,9102,5325,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5365,9102,5367,9001,5371,9102,5373,9102,5381,9102,5382,9001,5383,9001,5387,9001,5389,9001,5393,9102,5396,9001,5451,9102,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5513,9001,5514,9001,5523,9001,5524,9102,5527,9102,5530,9001,5531,9001,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5646,9003,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5839,9001,5842,9001,5844,9001,5858,9001,5879,9001,5880,9001,5886,9102,5887,9001,5890,9001,6128,9002,6129,9002,6135,9102,6204,9001,6207,9102,6210,9001,6211,9001,6307,9001,6311,9102,6312,9001,6316,9001,6318,9102,6322,9102,6325,9102,6362,9001,6365,9102,6391,9002,6405,9002,6406,9001,6407,9002,6408,9001,6409,9002,6410,9001,6411,9003,6412,9001,6413,9003,6414,9001,6415,9001,6416,9003,6417,9001,6418,9003,6419,9001,6420,9003,6421,9001,6422,9003,6423,9001,6424,9003,6425,9001,6426,9003,6427,9001,6428,9003,6429,9001,6430,9003,6431,9001,6432,9003,6433,9001,6434,9003,6435,9001,6436,9003,6437,9001,6438,9003,6439,9001,6440,9001,6441,9003,6442,9001,6443,9003,6444,9001,6445,9003,6446,9001,6447,9003,6448,9001,6449,9003,6450,9001,6451,9003,6452,9001,6453,9003,6454,9001,6455,9003,6456,9001,6457,9003,6458,9001,6459,9003,6460,9001,6461,9003,6462,9001,6463,9003,6464,9001,6465,9003,6466,9001,6467,9003,6468,9001,6469,9003,6470,9001,6471,9003,6472,9001,6473,9003,6474,9001,6475,9003,6476,9001,6477,9003,6478,9001,6479,9003,6484,9003,6485,9001,6486,9003,6487,9001,6488,9003,6489,9001,6490,9003,6491,9001,6492,9003,6493,9001,6494,9002,6495,9001,6496,9002,6497,9001,6498,9001,6499,9002,6500,9001,6501,9003,6502,9001,6503,9003,6504,9001,6505,9003,6506,9001,6507,9003,6508,9001,6509,9001,6510,9003,6515,9002,6516,9001,6518,9001,6519,9003,6520,9001,6521,9003,6522,9001,6523,9003,6524,9001,6525,9003,6526,9001,6527,9003,6528,9001,6529,9003,6530,9001,6531,9003,6532,9001,6533,9003,6534,9001,6535,9003,6536,9001,6537,9003,6538,9001,6539,9003,6540,9001,6541,9003,6542,9001,6543,9003,6544,9001,6545,9002,6546,9001,6547,9002,6548,9001,6549,9003,6550,9001,6551,9003,6552,9001,6553,9003,6554,9001,6555,9003,6556,9001,6557,9002,6558,9001,6559,9002,6560,9001,6561,9002,6562,9001,6563,9003,6564,9001,6565,9003,6566,9001,6567,9001,6568,9003,6569,9001,6570,9002,6571,9001,6572,9003,6573,9001,6574,9003,6575,9001,6576,9003,6577,9001,6578,9003,6582,9003,6583,9001,6584,9003,6585,9001,6586,9003,6587,9001,6588,9003,6589,9001,6590,9003,6591,9001,6592,9001,6593,9003,6594,9001,6595,9003,6596,9001,6597,9003,6598,9001,6599,9003,6600,9001,6601,9003,6602,9001,6603,9003,6605,9003,6606,9001,6607,9003,6608,9001,6609,9003,6610,9001,6611,9001,6612,9003,6613,9001,6614,9003,6615,9001,6616,9003,6617,9001,6618,9003,6633,9003,6646,9001,6668,9102,6703,9001,6706,9102,6783,9102,6784,9001,6785,9002,6786,9001,6787,9002,6788,9001,6789,9002,6790,9001,6791,9002,6792,9001,6793,9002,6794,9001,6795,9002,6796,9001,6797,9002,6798,9001,6799,9002,6800,9001,6801,9002,6802,9001,6803,9002,6804,9001,6805,9002,6806,9001,6807,9002,6808,9001,6809,9002,6810,9001,6811,9002,6812,9001,6813,9002,6814,9001,6815,9002,6816,9001,6817,9002,6818,9001,6819,9002,6820,9001,6821,9002,6822,9001,6823,9002,6824,9001,6825,9002,6826,9001,6827,9002,6828,9001,6829,9002,6830,9001,6831,9002,6832,9001,6833,9002,6834,9001,6835,9002,6836,9001,6837,9002,6838,9001,6839,9002,6840,9001,6841,9002,6842,9001,6843,9002,6844,9001,6845,9002,6846,9001,6847,9002,6848,9001,6849,9002,6850,9001,6851,9002,6852,9001,6853,9002,6854,9001,6855,9002,6856,9001,6857,9002,6858,9001,6859,9002,6860,9001,6861,9002,6862,9001,6863,9002,6867,9001,6868,9002,6870,9001,6875,9001,6876,9001,6879,9001,6880,9003,6884,9001,6885,9002,6886,9001,6887,9002,6892,9102,6894,9102,6915,9001,6922,9001,6923,9003,6924,9001,6925,9003,6962,9001,6983,9102,6984,9001,6990,9102,6991,9001,7035,9102,7037,9102,7039,9102,7041,9102,7073,9102,7084,9102,7086,9102,7128,9003,7131,9001,7132,9003,7133,9102,7136,9102,7139,9102,7142,9001,7257,9001,7258,9003,7259,9001,7260,9003,7261,9001,7262,9003,7263,9001,7264,9003,7265,9001,7266,9003,7267,9001,7268,9003,7269,9001,7270,9003,7271,9001,7272,9003,7273,9001,7274,9003,7275,9001,7276,9003,7277,9001,7278,9003,7279,9001,7280,9003,7281,9001,7282,9003,7283,9001,7284,9003,7285,9001,7286,9003,7287,9001,7288,9003,7289,9001,7290,9003,7291,9001,7292,9003,7293,9001,7294,9003,7295,9001,7296,9003,7297,9001,7298,9003,7299,9001,7300,9003,7301,9001,7302,9003,7303,9001,7304,9003,7305,9001,7306,9003,7307,9001,7308,9003,7309,9001,7310,9003,7311,9001,7312,9003,7313,9001,7314,9003,7315,9001,7316,9003,7317,9001,7318,9003,7319,9001,7320,9003,7321,9001,7322,9003,7323,9001,7324,9003,7325,9001,7326,9003,7327,9001,7328,9003,7329,9001,7330,9003,7331,9001,7332,9003,7333,9001,7334,9003,7335,9001,7336,9003,7337,9001,7338,9003,7339,9001,7340,9003,7341,9001,7342,9003,7343,9001,7344,9003,7345,9001,7346,9003,7347,9001,7348,9003,7349,9001,7350,9003,7351,9001,7352,9003,7353,9001,7354,9003,7355,9001,7356,9003,7357,9001,7358,9003,7359,9001,7360,9003,7361,9001,7362,9003,7363,9001,7364,9003,7365,9001,7366,9003,7367,9001,7368,9003,7369,9001,7370,9003,7373,9102,7683,9102,7798,9102,7844,9102,7877,9001,7878,9001,7881,9102,7882,9001,7883,9001,7886,9102,7887,9001,7899,9001,7991,9001,7992,9001,8035,9003,8036,9003,8042,9102,8043,9102,8058,9001,8059,9001,8082,9001,8083,9001,8086,9102,8088,9001,8090,9001,8091,9003,8092,9001,8093,9003,8095,9001,8096,9003,8097,9001,8098,9003,8099,9001,8100,9003,8101,9001,8102,9003,8103,9001,8104,9003,8105,9001,8106,9003,8107,9001,8108,9003,8109,9001,8110,9003,8111,9001,8112,9003,8113,9001,8114,9003,8115,9001,8116,9003,8117,9001,8118,9003,8119,9001,8120,9003,8121,9001,8122,9003,8123,9001,8124,9003,8125,9001,8126,9003,8127,9001,8128,9003,8129,9001,8130,9003,8131,9001,8132,9003,8133,9001,8134,9003,8135,9001,8136,9003,8137,9001,8138,9003,8139,9001,8140,9003,8141,9001,8142,9003,8143,9001,8144,9003,8145,9001,8146,9003,8147,9001,8148,9003,8149,9001,8150,9003,8151,9001,8152,9003,8153,9001,8154,9003,8155,9001,8156,9003,8157,9001,8158,9003,8159,9001,8160,9003,8161,9001,8162,9003,8163,9001,8164,9003,8165,9001,8166,9003,8167,9001,8168,9003,8169,9001,8170,9003,8171,9001,8172,9003,8173,9001,8177,9003,8179,9001,8180,9003,8181,9001,8182,9003,8184,9001,8185,9003,8187,9001,8189,9003,8191,9001,8193,9003,8196,9001,8197,9003,8198,9001,8200,9003,8201,9001,8202,9003,8203,9001,8204,9003,8205,9001,8206,9003,8207,9001,8208,9003,8209,9001,8210,9003,8212,9001,8213,9003,8214,9001,8216,9003,8218,9001,8220,9003,8222,9001,8224,9003,8225,9001,8226,9003,8232,9102,8237,9102,8240,9102,8246,9102,8249,9102,8252,9102,8255,9102,8311,9001,8312,9002,8313,9001,8314,9002,8315,9001,8316,9002,8317,9001,8318,9002,8319,9001,8320,9002,8321,9001,8322,9002,8323,9001,8324,9002,8325,9001,8326,9002,8327,9001,8328,9002,8329,9001,8330,9002,8331,9001,8332,9002,8333,9001,8334,9002,8335,9001,8336,9002,8337,9001,8338,9002,8339,9001,8340,9002,8341,9001,8342,9002,8343,9001,8344,9002,8345,9001,8346,9002,8347,9001,8348,9002,8351,9102,8352,9001,8353,9001,8379,9001,8380,9003,8381,9001,8382,9003,8383,9001,8384,9003,8385,9001,8387,9003,8391,9001,8395,9001,8427,9102,8428,9102,8431,9102,8433,9001,8441,9001,8455,9001,8456,9001,8531,9003,8545,9102,8682,9001,8685,9102,8687,9001,8692,9001,8693,9001,8694,9102,8699,9102,8818,9102,8826,9001,8860,9102,8888,9102,8900,9102,8902,9102,8903,9001,8907,9102,8949,9102,8950,9001,8951,9001,9003,9102,9006,9102,9009,9102,9012,9102,9014,9102,9017,9102,9019,9102,9039,9001,9040,9001,9140,9102,9141,9001,9148,9102,9149,9001,9150,9001,9153,9102,9191,9001,9221,9001,9222,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25e3,9001,25231,9001,25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,27120,9001,27200,9001,27291,9040,27292,9040,27429,9001,27493,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29101,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,30200,9039,30339,9001,30340,9001,30791,9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31279,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,9001,31901,9001,32030,9003,32031,9003,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37202,9102,37203,9102,37206,9102,37207,9102,37218,9102,37221,9102,37225,9105,37240,9102,37241,9102,37243,9102,37245,9102,37249,9102,37257,9102,37260,9102,53048,9001,53049,9001,54034,9001,54090,9001,54091,9001,65061,9003,65062,9003,65161,9001,102041,9003,102064,9085,102068,109030,102069,109031,102093,9001,102094,9001,102118,9003,102120,9003,102121,9003,102122,9001,102150,9001,102168,9001,102204,9001,102212,9001,102213,9001,102215,9001,102216,9001,102217,9003,102218,9001,102219,9003,102220,9003,102247,9001,102299,9001,102306,9001,102319,9001,102328,9001,102329,9001,102359,9001,102360,9001,102440,9001,102448,9001,102464,9003,102465,9003,102491,9001,102492,9001,102498,9001,102499,9001,102525,9003,102526,9003,102528,9003,102529,9003,102589,9003,102598,9001,102599,9003,102600,9003,102604,9003,102661,9003,102662,9003,102664,9003,102665,9003,102705,9003,102720,9003,102721,9003,102726,9003,102727,9003,102733,9003,102761,9003,102766,9003,102974,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,103297,9001,103298,9003,103299,9003,103300,9001,103307,9001,103313,9001,103319,9001,103322,9001,103323,9001,103332,9001,103335,9001,103338,9001,103340,9001,103351,9001,103358,9001,103370,9001,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,103400,9003,103407,9003,103413,9003,103419,9003,103422,9003,103423,9003,103432,9003,103435,9003,103438,9003,103440,9003,103451,9003,103458,9003,103470,9003,103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103586,9001,103587,9003,103588,9002,103589,9001,103590,9003,103591,9002,103592,9001,103593,9003,103594,9002,103695,9003,103846,9001,103946,9003,104009,9102,104017,9102,104018,9102,104022,9102,104024,9102,104027,9102,104047,9102,104050,9102,104105,9102,104106,9102,104109,9102,104112,9102,104113,9102,104134,9102,104135,9102,104138,9102,104139,9105,104140,9105,104808,9102]};f.yr=function(){function d(){}return d.Ny=function(h){d.zp===!1&&d.yt();var o=d.xQ(h);if(o==-1){var c=d.zx(h);c!=h&&(o=d.Ny(c))}return o==-1&&(c=d.xK(h))!=h&&(o=d.Ny(c)),o},d.xQ=function(h){return d.Gw[h]!==void 0?d.Gw[h]:-1},d.uQ=function(h){d.zp===!1&&d.yt();var o=d.fF(h);if(o==1e38){var c=d.zx(h);if(c!=h&&(o=d.fF(c)),o==1e38)return 1e-10}return o},d.PS=function(h){if(d.Js[h]!==void 0)return!0;var o=d.zx(h);return o!=h&&d.Js[o]!==void 0},d.RS=function(h){if(d.yo[h]!==void 0)return!0;var o=d.zx(h);return o!=h&&d.yo[o]!==void 0},d.fF=function(h){return d.zp===!1&&d.yt(),d.Js[h]!==void 0?d.Js[h]:d.yo[h]!==void 0?d.yo[h]:1e38},d.xK=function(h){return d.zp===!1&&d.yt(),d.QA[h]!==void 0?d.QA[h]:h},d.zx=function(h){return d.zp===!1&&d.yt(),d.RA[h]!==void 0?d.RA[h]:h},d.yt=function(){for(var h,o=N,c=0;c<o.pcsid.length;c+=2)d.yo[o.pcsid[c]]=o.pcstol[2*o.pcsid[c+1]+1];for(c=0;c<o.pcsidc.length;c+=1)for(var u=(h=o.pcsidc[c])[0];u<=h[1];u++)d.yo[u]=o.pcstol[2*h[2]+1];for(c=0;c<o.gcsid.length;c+=2)d.Js[o.gcsid[c]]=o.gcstol[2*o.gcsid[c+1]+1];for(c=0;c<o.gcsidc.length;c+=1)for(u=(h=o.gcsidc[c])[0];u<=h[1];u++)d.yo[u]=o.gcstol[2*h[2]+1];for(c=0;c<T.c.length;c+=1)for(u=(h=T.c[c])[0];u<=h[1];u++)d.Gw[u]=h[2];for(c=0;c<T.nc.length;c+=2)d.Gw[T.nc[c]]=T.nc[c+1];for(T=null,c=0;c<o.newtoold.length;c+=2)d.QA[o.newtoold[c+1]]=o.newtoold[c],d.RA[o.newtoold[c]]=o.newtoold[c+1];N=null,d.zp=!0},d.zp=!1,d.Js=[],d.yo=[],d.QA=[],d.RA=[],d.Gw=[],d}()}(ae||(ae={})),function(f){function N(d){return d.length===0?'""':d[0]=='"'||d[0]=="."||"0"<=d[0]&&"9">=d[0]?d:'"'+d.trim()+'"'}var T=[];f.PC=function(){function d(){}return d.wQ=function(h){try{for(var o=0;o<T.length;o++)if(T[o].wkttext===h)return T[o].unit;for(var c,u=o="",m=!1,g=0;g<h.length;g++){var v=h[g];m===!0?v=='"'?h[g+1]=='"'?o+=v:m=m=!1:o+=v:/[\s]/.test(v)||(v==","?(u=o!==""?u+(N(o)+","):u+",",o=""):v==")"||v=="]"?(u=o!==""?u+(N(o)+"]}"):u+"]}",o=""):v=="("||v=="["?(u+='{ "entity": "'+o.toUpperCase().trim()+'", "values":[',o=""):v=='"'?(m=!0,o=""):o+=v)}c=JSON.parse(u);var w=d.eF(c);if(w===null)return null;for(c=null,v=0;v<w.values.length;v++)if(typeof w.values[v]=="object"&&w.values[v].entity==="UNIT"){c=w.values[v];break}if(c===null)return null;var E=f.Uc.RO(w.entity==="GEOGCS"?1:0,c.values[1],c.values[2]);return T.push({wkttext:h,unit:E}),10<T.length&&T.shift(),E}catch{return null}},d.eF=function(h){if(h===null)return null;if(h.entity==="GEOGCS"||h.entity==="PROJCS")return h;for(var o=[],c=0;c<h.values.length;c++)if(typeof h.values[c]=="object"&&h.values[c].entity!==void 0){if(h.values[c].entity==="GEOGCS"||h.values[c].entity=="PROJCS")return h.values[c];o.push(h.values[c])}for(h=0;h<o.length;h++)if((c=d.eF(o[h]))!==null)return c;return null},d.vQ=function(h){var o=-1;if(h!=null&&0<h.length){var c=h.indexOf("PROJCS");if(0<=c){var u=0;if(0<=(c=h.lastIndexOf("UNIT"))&&0<(c=h.indexOf(",",c+4))){c++;var m=h.indexOf("]",c+1);if(0<m)try{u=parseFloat(h.substring(c,m))}catch{u=0}}0<u&&(o=.001/u)}else if(0<=(c=h.indexOf("GEOGCS"))){var g=0;if(u=0,0<(c=h.indexOf("SPHEROID",c+6))&&0<(c=h.indexOf(",",c+8))){if(c++,0<(m=h.indexOf(",",c+1)))try{g=parseFloat(h.substring(c,m))}catch{g=0}if(0<g&&0<=(c=h.indexOf("UNIT",m+1))&&0<(c=h.indexOf(",",c+4))&&(c++,0<(m=h.indexOf("]",c+1))))try{u=parseFloat(h.substring(c,m))}catch{u=0}}0<g&&0<u&&(o=.001/(g*u))}}return o},d}()}(ae||(ae={})),function(f){var N;(N=f.XK||(f.XK={}))[N.NONE=0]="NONE",N[N.LINEAR=1]="LINEAR",N[N.ANGULAR=2]="ANGULAR",function(d){d[d.enumFloat=0]="enumFloat",d[d.enumDouble=1]="enumDouble",d[d.enumInt32=2]="enumInt32",d[d.enumInt64=3]="enumInt64",d[d.enumInt8=4]="enumInt8",d[d.enumInt16=5]="enumInt16"}(f.IL||(f.IL={})),function(d){d[d.POSITION=0]="POSITION",d[d.Z=1]="Z",d[d.M=2]="M",d[d.ID=3]="ID",d[d.NORMAL=4]="NORMAL",d[d.TEXTURE1D=5]="TEXTURE1D",d[d.TEXTURE2D=6]="TEXTURE2D",d[d.TEXTURE3D=7]="TEXTURE3D",d[d.ID2=8]="ID2",d[d.MAXSEMANTICS=10]="MAXSEMANTICS"}(f.Jh||(f.Jh={}));var T=function(){function d(h,o){if(this.Ws=this.Be=null,this.Qq=this.Ba=0,this.vh=this.cg=null,this.yl=0,o!==void 0){for(this.Ba=o.Ba,this.Qq=o.Qq,this.cg=o.cg.slice(0),this.vh=o.vh.slice(0),this.yl=o.yl,this.Ws=[],h=o=0;h<this.Ba;h++)this.Ws[h]=o,o+=d.Wa(this.cg[h]);for(this.Qq=o,this.Be=[],h=0;h<this.Ba;h++){o=d.Wa(this.qd(h));for(var c=d.te(this.qd(h)),u=0;u<o;u++)this.Be[this.Ws[h]+u]=c}}else this.Qq=this.Ba=0}return d.prototype.qd=function(h){if(0>h||h>this.Ba)throw f.i.O();return this.cg[h]},d.prototype.Qf=function(h){return this.vh[h]},d.gz=function(h){return d.BM[h]},d.Vp=function(h){return d.KM[h]},d.Wa=function(h){return d.jM[h]},d.prototype.hasAttribute=function(h){return 0<=this.vh[h]},d.prototype.aG=function(){return this.hasAttribute(1)},d.te=function(h){return d.XC[h]},d.prototype.CR=function(h){return this.Ws[h]},d.vG=function(h,o){return d.XC[h]===o},d.prototype.Nb=function(h){return this===h},d.prototype.Bn=function(){for(var h=f.P.Uh(this.cg[0]),o=1;o<this.Ba;o++)h=f.P.Uh(this.cg[o],h);return h},d.prototype.$j=function(h){return this.Ws[h]},d.prototype.dc=function(){return this.yl},d.prototype.Fd=function(h){return this.cg[h]},d.XC=[0,0,NaN,0,0,0,0,0,0],d.BM=[1,1,1,0,2,1,1,1,0],d.KM=[1,1,1,2,0,0,0,0,2],d.jM=[2,1,1,1,3,1,2,3,2],d}();f.ua=T}(ae||(ae={})),function(f){function N(m,g,v){var w=g-(m=new u(m)).e,E=m.c;for(E.length>++g&&T(m,w,u.fu),E[0]?v?w=g:(E=m.c,w=m.e+w+1):++w;E.length<w;E.push(0));return w=m.e,v===1||v&&(g<=w||w<=h)?(0>m.Cd&&E[0]?"-":"")+(1<E.length?E[0]+"."+E.join("").slice(1):E[0])+(0>w?"e":"e+")+w:m.toString()}function T(m,g,v,w){var E=m.c,C=m.e+g+1;if(v===1?w=5<=E[C]:v===2?w=5<E[C]||E[C]==5&&(w||0>C||E[C+1]!==void 0||1&E[C-1]):v===3?w=w||E[C]!==void 0||0>C:(w=!1,v!==0&&d("!Big.RM!")),1>C||!E[0])w?(m.e=-g,m.c=[1]):m.c=[m.e=0];else{if(E.length=C--,w)for(;9<++E[C];)E[C]=0,C--||(++m.e,E.unshift(1));for(C=E.length;!E[--C];E.pop());}return m}function d(m){throw(m=Error(m)).name="BigError",m}var h=-7,o=21,c=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,u=function(){function m(g){if(g instanceof m)this.Cd=g.Cd,this.e=g.e,this.c=g.c.slice();else{var v,w,E;for(g===0&&0>1/g?g="-0":c.test(g+="")||d(NaN),this.Cd=g.charAt(0)=="-"?(g=g.slice(1),-1):1,-1<(v=g.indexOf("."))&&(g=g.replace(".","")),0<(w=g.search(/e/i))?(0>v&&(v=w),v+=+g.slice(w+1),g=g.substring(0,w)):0>v&&(v=g.length),w=0;g.charAt(w)=="0";w++);if(w==(E=g.length))this.c=[this.e=0];else{for(;g.charAt(--E)=="0";);for(this.e=v-w-1,this.c=[],v=0;w<=E;this.c[v++]=+g.charAt(w++));}}}return m.prototype.abs=function(){var g=new m(this);return g.Cd=1,g},m.prototype.cmp=function(g){var v=this.c,w=(g=new m(g)).c,E=this.Cd,C=g.Cd,R=this.e,I=g.e;if(!v[0]||!w[0])return v[0]?E:w[0]?-C:0;if(E!=C)return E;if(g=0>E,R!=I)return R>(I^g)?1:-1;for(E=-1,C=(R=v.length)<(I=w.length)?R:I;++E<C;)if(v[E]!=w[E])return v[E]>(w[E]^g)?1:-1;return R==I?0:R>(I^g)?1:-1},m.prototype.lm=function(g){var v=this.c,w=(g=new m(g)).c,E=this.Cd==g.Cd?1:-1,C=m.tr;if((C!==~~C||0>C||1e6<C)&&d("!Big.DP!"),!v[0]||!w[0])return v[0]==w[0]&&d(NaN),w[0]||d(E/0),new m(0*E);var R,I,F=w.slice(),U=R=w.length,j=v.length,ee=v.slice(0,R),te=ee.length,Z=g,le=Z.c=[],ve=0,be=C+(Z.e=this.e-g.e)+1;for(Z.Cd=E,E=0>be?0:be,F.unshift(0);te++<R;ee.push(0));do{for(I=0;10>I;I++){if(R!=(te=ee.length))var ue=R>te?1:-1;else{var Le=-1;for(ue=0;++Le<R;)if(w[Le]!=ee[Le]){ue=w[Le]>ee[Le]?1:-1;break}}if(!(0>ue))break;for(g=te==R?w:F;te;){if(ee[--te]<g[te]){for(Le=te;Le&&!ee[--Le];ee[Le]=9);--ee[Le],ee[te]+=10}ee[te]-=g[te]}for(;!ee[0];ee.shift());}le[ve++]=ue?I:++I,ee[0]&&ue?ee[te]=v[U]||0:ee=[v[U]]}while((U++<j||ee[0]!==void 0)&&E--);return le[0]||ve==1||(le.shift(),Z.e--),ve>be&&T(Z,C,m.fu,ee[0]!==void 0),Z},m.prototype.XR=function(){return 0<this.cmp(0)},m.prototype.dT=function(){return 0>this.cmp(0)},m.prototype.jt=function(g){var v,w=this.Cd,E=(g=new m(g)).Cd;if(w!=E)return g.Cd=-E,this.lI(g);var C=this.c.slice(),R=this.e,I=g.c,F=g.e;if(!C[0]||!I[0])return I[0]?(g.Cd=-E,g):new m(C[0]?this:0);if(w=R-F){for((v=0>w)?(w=-w,R=C):(F=R,R=I),R.reverse(),E=w;E--;R.push(0));R.reverse()}else for(R=((v=C.length<I.length)?C:I).length,w=E=0;E<R;E++)if(C[E]!=I[E]){v=C[E]<I[E];break}if(v&&(R=C,C=I,I=R,g.Cd=-g.Cd),0<(E=(R=I.length)-(v=C.length)))for(;E--;C[v++]=0);for(E=v;R>w;){if(C[--R]<I[R]){for(v=R;v&&!C[--v];C[v]=9);--C[v],C[R]+=10}C[R]-=I[R]}for(;C[--E]==0;C.pop());for(;C[0]==0;)C.shift(),--F;return C[0]||(g.Cd=1,C=[F=0]),g.c=C,g.e=F,g},m.prototype.lI=function(g){var v=this.Cd,w=(g=new m(g)).Cd;if(v!=w)return g.Cd=-w,this.jt(g);w=this.e;var E=this.c,C=g.e,R=g.c;if(!E[0]||!R[0])return R[0]?g:new m(E[0]?this:0*v);if(E=E.slice(),v=w-C){for(0<v?(C=w,w=R):(v=-v,w=E),w.reverse();v--;w.push(0));w.reverse()}for(0>E.length-R.length&&(w=R,R=E,E=w),v=R.length,w=0;v;)w=(E[--v]=E[v]+R[v]+w)/10|0,E[v]%=10;for(w&&(E.unshift(w),++C),v=E.length;E[--v]==0;E.pop());return g.c=E,g.e=C,g},m.prototype.pow=function(g){var v=this,w=new m(1),E=w,C=0>g;for((g!==~~g||-1e6>g||1e6<g)&&d("!pow!"),g=C?-g:g;1&g&&(E=E.nr(v)),g>>=1;)v=v.nr(v);return C?w.lm(E):E},m.prototype.round=function(g,v){var w=this;return g==null?g=0:(g!==~~g||0>g||1e6<g)&&d("!round!"),T(w=new m(w),g,v==null?m.fu:v),w},m.prototype.sqrt=function(){var g=this.c,v=this.Cd,w=this.e,E=new m("0.5");if(!g[0])return new m(this);0>v&&d(NaN),(v=Math.sqrt(this.toString()))==0||v==1/0?((v=g.join("")).length+w&1||(v+="0"),(g=new m(Math.sqrt(v).toString())).e=((w+1)/2|0)-(0>w||1&w)):g=new m(v.toString()),v=g.e+(m.tr+=4);do w=g,g=E.nr(w.lI(this.lm(w)));while(w.c.slice(0,v).join("")!==g.c.slice(0,v).join(""));return T(g,m.tr-=4,m.fu),g},m.prototype.nr=function(g){var v=this.c,w=(g=new m(g)).c,E=v.length,C=w.length,R=this.e,I=g.e;if(g.Cd=this.Cd==g.Cd?1:-1,!v[0]||!w[0])return new m(0*g.Cd);if(g.e=R+I,E<C){var F=v;v=w,w=F,I=E,E=C,C=I}for(F=Array(I=E+C);I--;F[I]=0);for(R=C;R--;){for(C=0,I=E+R;I>R;)C=F[I]+w[R]*v[I-R-1]+C,F[I--]=C%10,C=C/10|0;F[I]=(F[I]+C)%10}for(C&&++g.e,F[0]||F.shift(),R=F.length;!F[--R];F.pop());return g.c=F,g},m.prototype.toString=function(){var g=this.e,v=this.c.join(""),w=v.length;if(g<=h||g>=o)v=v.charAt(0)+(1<w?"."+v.slice(1):"")+(0>g?"e":"e+")+g;else if(0>g){for(;++g;v="0"+v);v="0."+v}else if(0<g)if(++g>w)for(g-=w;g--;v+="0");else g<w&&(v=v.slice(0,g)+"."+v.slice(g));else 1<w&&(v=v.charAt(0)+"."+v.slice(1));return 0>this.Cd&&this.c[0]?"-"+v:v},m.prototype.toExponential=function(g){return g==null?g=this.c.length-1:(g!==~~g||0>g||1e6<g)&&d("!toExp!"),N(this,g,1)},m.prototype.toFixed=function(g){var v=h,w=o;if(h=-(o=1/0),g==null)var E=this.toString();else g===~~g&&0<=g&&1e6>=g&&(E=N(this,this.e+g),0>this.Cd&&this.c[0]&&0>E.indexOf("-")&&(E="-"+E));return h=v,o=w,E||d("!toFix!"),E},m.prototype.toPrecision=function(g){return g==null?this.toString():((g!==~~g||1>g||1e6<g)&&d("!toPre!"),N(this,g-1,2))},m.tr=20,m.fu=1,m}();f.ip=u}(ae||(ae={})),function(f){var N=function(){function T(d){this.lf=d}return T.prototype.qr=function(d,h,o){var c=new f.h,u=new f.h,m=this.lf;o.Wd(d,h,function(g,v){return m.uc(2*g,c),m.uc(2*v,u),c.compare(u)})},T.prototype.bq=function(d){return this.lf.read(2*d+1)},T}();f.ri=function(){function T(){}return T.cq=function(d){if(d.B())return!1;var h=d.K();return h==1736?d.He()!=0:h==1607?(h=[!1],T.kE(d,!0,h),h[0]):!(h!=197&&(!f.ba.zd(h)||d.tG()))},T.im=function(d){var h=d.K();if(h==1736)return h=new f.Ua(d.description),d.B()||d.WC(h),h;if(h==1607)return T.kE(d,!1,null);if(h==197)return h=new f.Ua(d.description),d.B()||h.bd(d,!1),h;if(f.ba.zd(h)){if(h=new f.de(d.description),!d.B()&&!d.tG()){var o=new f.Ta;d.Uo(o),h.add(o),d.Qo(o),h.add(o)}return h}if(f.ba.Sn(h))return null;throw f.i.O()},T.kE=function(d,h,o){o!=null&&(o[0]=!1);var c=null;if(h||(c=new f.de(d.description)),!d.B()){var u=new f.ja(0);u.Jb(2*d.ea());for(var m=0,g=d.ea();m<g;m++)if(0<d.Ka(m)&&!d.On(m)){var v=d.Ca(m);u.add(v),v=d.Wc(m)-1,u.add(v)}if(0<u.size){g=new f.Yt,m=d.vb(0),g.sort(u,0,u.size,new N(m)),g=new f.h,m.uc(2*u.get(0),g),v=0;for(var w=1,E=new f.Ta,C=new f.h,R=1,I=u.size;R<I;R++)if(m.uc(2*u.get(R),C),C.rb(g))u.get(v)>u.get(R)?(u.set(v,2147483647),v=R):u.set(R,2147483647),w++;else{if((1&w)==0)u.set(v,2147483647);else if(h)return o!=null&&(o[0]=!0),null;g.N(C),v=R,w=1}if((1&w)==0)u.set(v,2147483647);else if(h)return o!=null&&(o[0]=!0),null;if(!h)for(u.Wd(0,u.size,function(F,U){return F-U}),R=0,I=u.size;R<I&&u.get(R)!=2147483647;R++)d.we(u.get(R),E),c.add(E)}}return h?null:c},T}()}(ae||(ae={})),function(f){var N=function(){function T(){this.zf=new f.ja(0),this.zs=new f.ja(0),this.wH=1,this.Fs=NaN}return T.prototype.sort=function(d,h,o,c){if(32>o-h)c.qr(h,o,d);else{var u=!0;try{for(var m=1/0,g=-1/0,v=h;v<o;v++){var w=c.bq(d.get(v));w<m&&(m=w),w>g&&(g=w)}if(this.reset(o-h,m,g,o-h)){for(v=h;v<o;v++){var E=d.get(v);w=c.bq(E);var C=this.rF(w);this.zf.set(C,this.zf.get(C)+1),this.zs.write(v-h,E)}var R=this.zf.get(0);this.zf.set(0,0),v=1;for(var I=this.zf.size;v<I;v++){var F=this.zf.get(v);this.zf.set(v,R),R+=F}for(v=h;v<o;v++){E=this.zs.read(v-h),w=c.bq(E),C=this.rF(w);var U=this.zf.get(C);d.set(U+h,E),this.zf.set(C,U+1)}u=!1}}catch{this.zf.resize(0),this.zs.resize(0)}if(u)c.qr(h,o,d);else{for(v=o=0,I=this.zf.size;v<I;v++)u=o,(o=this.zf.get(v))>u&&c.qr(h+u,h+o,d);100<this.zf.size&&(this.zf.resize(0),this.zs.resize(0))}}},T.prototype.reset=function(d,h,o,c){return!(2>d||o==h)&&(d=Math.min(T.$K,d),this.zf.Jb(d),this.zf.resize(d),this.zf.Xj(0,0,this.zf.size),this.wH=h,this.zs.resize(c),this.Fs=(o-h)/(d-1),!0)},T.prototype.rF=function(d){return f.P.truncate((d-this.wH)/this.Fs)},T.$K=65536,T}();f.Yt=N}(ae||(ae={})),function(f){var N,T;(T=N||(N={}))[T.enum_line=1]="enum_line",T[T.enum_arc=2]="enum_arc",T[T.enum_dummy=4]="enum_dummy",T[T.enum_concave_dip=8]="enum_concave_dip",T[T.enum_connection=3]="enum_connection";var d=function(){function m(){}return m.Su=function(g,v,w,E,C,R){var I=new m;return I.Km=new f.h,I.Xm=new f.h,I.bw=new f.h,I.Km.N(g),I.Xm.N(v),I.bw.N(w),I.Do=E,I.rh=C,I.th=R,I},m.construct=function(g,v,w,E){var C=new m;return C.Km=new f.h,C.Xm=new f.h,C.bw=new f.h,C.Km.N(g),C.Xm.N(v),C.bw.Sc(),C.Do=4,C.rh=w,C.th=E,C},m}(),h=function(){function m(g,v,w,E,C,R){this.Zv=null,this.za=0,this.yA=g,this.UH=this.SH=0,this.La=v,this.Nj=w,this.vk=E,this.Fq=C,this.Vb=R}return m.prototype.next=function(){for(var g=new f.Ta;;){if(this.za==this.yA.I())return null;if(this.yA.we(this.za,g),this.za++,!g.B())break}var v=!1;if(this.Zv==null&&(this.SH=g.Mg(),this.UH=g.jh(),this.Zv=u.buffer(g,this.La,this.Nj,this.vk,this.Fq,this.Vb),v=!0),this.za<this.yA.I()){var w=new f.Ea;this.Zv.copyTo(w)}else w=this.Zv;if(!v){v=new f.Ed;var E=g.Mg()-this.SH;g=g.jh()-this.UH,v.gg(E,g),w.Pc(v)}return w},m.prototype.Ma=function(){return 0},m.prototype.qe=function(){},m}(),o=function(){function m(g,v){this.Xa=g,this.za=0,this.qq=v}return m.prototype.next=function(){var g=this.Xa.Y;if(this.za<g.ea()){var v=this.za;if(this.za++,!g.On(v))for(var w=g.Oa(g.Wc(v)-1);this.za<g.ea();){var E=g.Oa(g.Ca(this.za));if(g.On(this.za)||E!=w)break;w=g.Oa(g.Wc(this.za)-1),this.za++}if(this.za-v==1)return this.Xa.cE(this.Xa.Y,v,this.qq);for((w=new f.Ua(this.Xa.Y.description)).addPath(this.Xa.Y,v,!0),v+=1;v<this.za;v++)w.Fr(this.Xa.Y,v,0,g.sv(v),!1);return this.Xa.cE(w,0,this.qq)}return null},m.prototype.Ma=function(){return 0},m.prototype.qe=function(){},m}(),c=function(){function m(g){this.Xa=g,this.za=0}return m.prototype.next=function(){var g=this.Xa.Y;if(this.za<g.ea()){var v=this.za;for(g.Kr(this.za),this.za++;this.za<g.ea()&&!(0<g.Kr(this.za));)this.za++;return v==0&&this.za==g.ea()?this.Xa.ky(g,0,g.ea()):this.Xa.ky(g,v,this.za)}return null},m.prototype.Ma=function(){return 0},m.prototype.qe=function(){},m}(),u=function(){function m(g){this.Ls=this.mw=this.Ms=this.Jd=null,this.$d=[],this.Vb=g,this.sb=this.Lv=this.zT=this.La=this.nA=this.ct=this.ra=0,this.iA=this.vk=-1,this.qq=!0}return m.buffer=function(g,v,w,E,C,R){if(g==null||0>E)throw f.i.O();if(g.B())return new f.Ea(g.description);var I=new f.l;return g.yc(I),0<v&&I.X(v,v),(R=new m(R)).Nj=w,R.Y=g,R.ra=f.ta.Xd(w,I,!0),R.ct=f.ta.Xd(null,I,!0),R.La=v,R.zT=g.K(),0>=C&&(C=96),R.sb=Math.abs(R.La),R.Lv=R.sb!=0?1/R.sb:0,isNaN(E)||E==0?E=1e-5*R.sb:E>.5*R.sb&&(E=.5*R.sb),12>C&&(C=12),(g=Math.abs(v)*(1-Math.cos(Math.PI/C)))>E?E=g:(g=Math.PI/Math.acos(1-E/Math.abs(v)))<C-1&&12>(C=f.P.truncate(g))&&(C=12,E=Math.abs(v)*(1-Math.cos(Math.PI/C))),R.vk=E,R.Fq=C,R.nA=Math.min(R.ct,.25*E),R.dE()},m.prototype.dv=function(){if(this.Jd==null)this.Jd=[];else if(this.Jd.length!==0)return;var g=this.iE();g=f.P.truncate((g+3)/4);var v=.5*Math.PI/g;this.iA=v;for(var w=0;w<4*g;w++)this.Jd.push(null);var E=Math.cos(v);v=Math.sin(v);var C=f.h.construct(0,1);for(w=0;w<g;w++)this.Jd[w+0*g]=f.h.construct(C.y,-C.x),this.Jd[w+1*g]=f.h.construct(-C.x,-C.y),this.Jd[w+2*g]=f.h.construct(-C.y,C.x),this.Jd[w+3*g]=C,(C=f.h.construct(C.x,C.y)).Bt(E,v)},m.prototype.dE=function(){var g=this.Y.K();if(f.ba.zd(g))return(g=new f.Ua(this.Y.description)).oc(this.Y,!0),this.Y=g,this.dE();if(this.La<=this.ra){if(!f.ba.KS(g))return new f.Ea(this.Y.description);if(0>=this.La&&(g=new f.l,this.Y.A(g),g.S()<=2*-this.La||g.da()<=2*this.La))return new f.Ea(this.Y.description)}switch(this.Y.K()){case 33:return this.HN();case 550:return this.GN();case 1607:return this.JN();case 1736:return this.IN();case 197:return this.DN();default:throw f.i.Ra()}},m.prototype.JN=function(){if(this.wG(this.Y)){var g=new f.Ta;this.Y.we(0,g);var v=new f.l;return this.Y.A(v),g.Db(v.tf()),this.Hu(g)}return this.Y=this.MV(this.Y),g=new o(this,this.qq),f.Hh.local().W(g,this.Nj,this.Vb).next()},m.prototype.IN=function(){if(this.La==0)return this.Y;var g=f.$l.local();if(this.dv(),this.Y=g.W(this.Y,null,!1,this.Vb),0>this.La){var v=this.Y;return v=this.ky(v,0,v.ea()),g.W(v,this.Nj,!1,this.Vb)}return this.wG(this.Y)?(g=new f.Ta,this.Y.we(0,g),v=new f.l,this.Y.A(v),g.Db(v.tf()),this.Hu(g)):(g=new c(this),f.Hh.local().W(g,this.Nj,this.Vb).next())},m.prototype.ky=function(g,v,w){for(var E=new f.Ea(g.description);v<w;v++)if(!(1>g.Ka(v))){var C=g.Kr(v),R=new f.l;if(g.Sj(v,R),0<this.La){if(0<C)if(this.xG(g,v))C=new f.Ta,g.we(g.Ca(v),C),C.Db(R.tf()),this.zu(E,C);else{var I=C=new f.Ua(g.description);I=f.$t.BG(this.Y,v)||this.An(this.Y,v,I,!0,1)==2?this.bE(g,v):this.zn(C),E.add(I,!1)}else if(!(R.S()+this.ra<=2*this.sb||R.da()+this.ra<=2*this.sb||(I=C=new f.Ua(g.description),this.An(this.Y,v,I,!0,1),C.B()))){var F=new f.l;for(F.L(R),F.X(this.sb,this.sb),I.vp(F),R=1,C=(I=this.zn(C)).ea();R<C;R++)E.addPath(I,R,!0)}}else if(0<C){if(!(R.S()+this.ra<=2*this.sb||R.da()+this.ra<=2*this.sb||(I=C=new f.Ua(g.description),this.An(this.Y,v,I,!0,-1),C.B())))for(F=new f.l,I.yc(F),F.X(this.sb,this.sb),I.vp(F),R=1,C=(I=this.zn(C)).ea();R<C;R++)E.addPath(I,R,!0)}else for(I=C=new f.Ua(g.description),this.An(this.Y,v,I,!0,-1),R=0,C=(I=this.zn(C)).ea();R<C;R++)E.addPath(I,R,!0)}if(0<this.La)return 1<E.ea()?E=this.zn(E):m.jx(E);if(g=new f.l,E.yc(g),E.B())return m.jx(E);for(g.X(this.sb,this.sb),E.vp(g),E=this.zn(E),g=new f.Ea(E.description),R=1,C=E.ea();R<C;R++)g.addPath(E,R,!1);return m.jx(g)},m.prototype.HN=function(){return this.Hu(this.Y)},m.prototype.Hu=function(g){var v=new f.Ea(this.Y.description);return this.zu(v,g),this.gX(v)},m.prototype.GN=function(){var g=new h(this.Y,this.La,this.Nj,this.vk,this.Fq,this.Vb);return f.Hh.local().W(g,this.Nj,this.Vb).next()},m.prototype.DN=function(){var g=new f.Ea(this.Y.description);if(0>=this.La){if(this.La==0)g.bd(this.Y,!1);else{var v=new f.Gh;this.Y.dn(v),v.X(this.La,this.La),g.bd(v,!1)}return g}return g.bd(this.Y,!1),this.Y=g,this.bE(g,0)},m.prototype.bE=function(g,v){this.dv();var w=new f.Ea(g.description),E=new f.h,C=new f.h,R=new f.h,I=new f.h,F=new f.h,U=new f.h,j=new f.h,ee=new f.h,te=g.Ka(v),Z=g.Ca(v),le=0;for(v=g.Ka(v);le<v;le++){if(g.D(Z+le,C),g.D(Z+(le+1)%te,I),g.D(Z+(le+2)%te,U),j.vc(I,C),j.length()==0||(j.Iv(),j.normalize(),j.scale(this.sb),E.add(j,C),R.add(j,I),le==0?w.Mt(E):w.Di(E),w.Di(R),ee.vc(U,I),ee.length()==0))throw f.i.Ra();ee.Iv(),ee.normalize(),ee.scale(this.sb),F.add(ee,I),this.yD(w,I,R,F,!1)}return m.jx(w)},m.prototype.cE=function(g,v,w){if(this.dv(),1>g.Ka(v))return null;if(this.xG(g,v)&&0<this.La){w=new f.Ta,g.we(g.Ca(v),w);var E=new f.l;return g.Sj(v,E),w.Db(E.tf()),this.Hu(w)}if(E=new f.Ua(g.description),g.On(v))this.An(g,v,E,w,1),this.An(g,v,E,w,-1);else{var C=new f.Ua(g.description);C.addPath(g,v,!1),C.Fr(g,v,0,g.sv(v),!1),this.An(C,0,E,w,1)}return this.zn(E)},m.prototype.Zq=function(){if(this.Zs++,this.Zs%1024==0&&this.Vb!=null&&!this.Vb.progress(-1,-1))throw f.i.gu("user_canceled")},m.prototype.zn=function(g){return f.Hg.Mk(g,this.ct,!0,!0,this.Vb)},m.prototype.iE=function(){if(this.vk==0)return this.Fq;var g=1-this.vk*Math.abs(this.Lv);return 4>(g=-1>g?4:2*Math.PI/Math.acos(g)+.5)?g=4:g>this.Fq&&(g=this.Fq),f.P.truncate(g)},m.prototype.yD=function(g,v,w,E,C){this.dv();var R=new f.h;R.vc(w,v),R.scale(this.Lv);var I=new f.h;I.vc(E,v),I.scale(this.Lv),0>(R=Math.atan2(R.y,R.x)/this.iA)&&(R=this.Jd.length+R),R=this.Jd.length-R,0>(I=Math.atan2(I.y,I.x)/this.iA)&&(I=this.Jd.length+I),(I=this.Jd.length-I)<R&&(I+=this.Jd.length);var F=f.P.truncate(I);I=f.P.truncate(Math.ceil(R)),(R=new f.h).N(this.Jd[I%this.Jd.length]),R.Ct(this.sb,v);var U=10*this.ra;for(R.sub(w),R.length()<U&&(I+=1),R.N(this.Jd[F%this.Jd.length]),R.Ct(this.sb,v),R.sub(E),R.length()<U&&--F,w=F-I,w++,F=0,I%=this.Jd.length;F<w;F++,I=(I+1)%this.Jd.length)R.N(this.Jd[I]),R.Ct(this.sb,v),g.Di(R),this.Zq();C&&g.Di(E)},m.prototype.An=function(g,v,w,E,C){var R=new f.hd,I=R.eN(g,v);if(R.Ip(this.nA,!1,!1),2>R.I(I))return 0>C||(C=g,R=new f.Ta,C.we(C.Ca(v),R),this.zu(w,R)),1;var F=R.Oa(R.Ya(R.Ob(I))),U=new f.Ed;if(U.gg(-F.x,-F.y),R.Pc(U),E&&(this.lQ(R,I,C),2>R.I(I)))return 0>C||(C=g,R=new f.Ta,C.we(C.Ca(v),R),this.zu(w,R)),1;this.$d.length=0;var j=R.Ob(I);v=R.Ya(j);var ee=C==1?R.Na(v):R.V(v);g=C==1?R.V(v):R.Na(v);var te=!0;E=new f.h,I=new f.h;var Z=new f.h,le=new f.h,ve=new f.h,be=new f.h,ue=new f.h,Le=new f.h,Be=new f.h,it=new f.h,Ke=this.sb;j=R.Ka(j);for(var Je=0;Je<j;Je++)R.D(g,I),te&&(R.D(v,E),R.D(ee,Z),Le.vc(E,Z),Le.normalize(),it.EG(Le),it.scale(Ke),le.add(it,E)),ue.vc(I,E),ue.normalize(),Be.EG(ue),Be.scale(Ke),ve.add(E,Be),ee=Le.xi(ue),te=Le.Rh(ue),0>ee||0>te&&ee==0?this.$d.push(d.Su(le,ve,E,2,this.$d.length+1,this.$d.length-1)):le.rb(ve)||(this.$d.push(d.construct(le,E,this.$d.length+1,this.$d.length-1,"dummy")),this.$d.push(d.construct(E,ve,this.$d.length+1,this.$d.length-1,"dummy"))),be.add(I,Be),this.$d.push(d.Su(ve,be,E,1,this.$d.length+1,this.$d.length-1)),le.N(be),it.N(Be),Z.N(E),E.N(I),Le.N(ue),ee=v,v=g,te=!1,g=C==1?R.V(v):R.Na(v);return this.$d[this.$d.length-1].rh=0,this.$d[0].th=this.$d.length-1,this.OV(w),U.gg(F.x,F.y),w.QD(U,w.ea()-1),1},m.prototype.OV=function(g){for(var v=this.rO(),w=!0,E=v+1,C=v;E!=v;C=E){var R=this.$d[C];E=R.rh!=-1?R.rh:(C+1)%this.$d.length,R.Do!=0&&(w&&g.Mt(R.Km),R.Do==2?this.yD(g,R.bw,R.Km,R.Xm,!0):g.Di(R.Xm),w=!1)}},m.prototype.rO=function(){this.Ls==null&&(this.Ls=[null,null,null,null,null,null,null,null,null]);for(var g=0,v=0,w=this.$d.length;v<w;){var E=this.$d[v];if((3&E.Do)!=0){g=v;break}v=E.rh}for(w=g+1,v=g;w!=g;v=w){w=(E=this.$d[v]).rh;for(var C=1,R=null;w!=v&&(3&(R=this.$d[w]).Do)==0;)w=R.rh,C++;C!=1&&(E.Do&R.Do)==1&&(this.Ms==null&&(this.Ms=new f.zb,this.mw=new f.zb),this.Ms.Ec(E.Km),this.Ms.Rc(E.Xm),this.mw.Ec(R.Km),this.mw.Rc(R.Xm),this.Ms.Fa(this.mw,this.Ls,null,null,this.ct)==1&&(E.Xm.N(this.Ls[0]),R.Km.N(this.Ls[0]),E.rh=w,R.th=v))}return g},m.prototype.Gv=function(g,v,w){var E=new f.h;if(E.vc(w,g),w=E.length(),0<(w=this.sb*this.sb-w*w*.25)){w=Math.sqrt(w),E.normalize(),E.cr();var C=new f.h;if(C.vc(v,g),C.Rh(E)+w>=this.sb)return!0}return!1},m.prototype.lQ=function(g,v,w){for(var E=0;1>E;E++){var C=!1,R=g.Ob(v),I=g.Ka(R);if(I==0)break;var F=I;if(3>I)break;!g.ec(R)&&(F=I-1),R=g.Ya(R),I=0<w?g.Na(R):g.V(R);for(var U=0<w?g.V(R):g.Na(R),j=I,ee=!0,te=new f.h,Z=new f.h,le=new f.h,ve=new f.h,be=new f.h,ue=f.h.construct(0,0),Le=new f.h,Be=new f.h,it=new f.h,Ke=new f.h,Je=this.sb,pt=0,qt=0;qt<F&&(g.D(U,Z),ee&&(g.D(R,te),g.D(I,le),j=I),Be.vc(te,le),Be.normalize(),Le.vc(Z,te),Le.normalize(),j!=U);){var ri=Be.xi(Le),Ji=Be.Rh(Le),Zi=!0;if(0>ri||0>Ji&&ri==0||!this.Gv(le,te,Z)||(ue.N(Z),Zi=!1,++pt,C=!0),Zi){if(0<pt)for(;(ri=0<w?g.Na(j):g.V(j))!=R;){if(g.D(ri,ve),!this.Gv(ve,le,ue)){ri!=U&&this.Gv(ve,le,Z)&&this.Gv(ve,te,Z)&&(le.N(ve),j=ri,Zi=!1,++pt);break}le.N(ve),j=ri,Zi=!1,++pt}if(!Zi)continue;if(0<pt){for(j=0<w?g.Na(I):g.V(I),ee=1;ee<pt;ee++)Zi=0<w?g.Na(j):g.V(j),g.pd(j,!0),j=Zi;it.vc(te,le),pt=Je*Je-(pt=it.length())*pt*.25,Je-(pt=Math.sqrt(pt))>.5*this.vk?(be.add(le,te),be.scale(.5),it.normalize(),it.cr(),Ke.N(it),Ke.scale(Je-pt),be.add(Ke),g.mf(I,be)):g.pd(I,!0),pt=0}le.N(te),j=R}te.N(Z),I=R,R=U,U=0<w?g.V(R):g.Na(R),qt++,ee=!1}if(0<pt){for(j=0<w?g.Na(I):g.V(I),ee=1;ee<pt;ee++)Zi=0<w?g.Na(j):g.V(j),g.pd(j,!0),j=Zi;be.add(le,te),be.scale(.5),it.vc(te,le),pt=Je*Je-(pt=it.length())*pt*.25,pt=Math.sqrt(pt),it.normalize(),it.cr(),Ke.N(it),Ke.scale(Je-pt),be.add(Ke),g.mf(I,be)}if(g.Ip(this.nA,!1,!1),!C)break}},m.prototype.xG=function(g,v){if(g.Ka(v)==1)return!0;var w=new f.l;return g.Sj(v,w),Math.max(w.S(),w.da())<.5*this.vk},m.prototype.wG=function(g){var v=new f.l;return g.A(v),Math.max(v.S(),v.da())<.5*this.vk},m.prototype.MV=function(g){for(var v=0,w=0,E=(g=f.wC.local().W(g,.25*this.vk,!1,this.Vb)).ea();w<E;w++)v=Math.max(g.Ka(w),v);return 32>v?(this.qq=!1,g):(this.qq=!0,f.Hg.Mk(g,this.ct,!1,!0,this.Vb))},m.prototype.zu=function(g,v){if(v=v.D(),this.Jd!=null&&this.Jd.length!==0){var w=new f.h;w.N(this.Jd[0]),w.Ct(this.sb,v),g.Mt(w);for(var E=1,C=this.Jd.length;E<C;E++)w.N(this.Jd[E]),w.Ct(this.sb,v),g.Di(w)}else{E=this.iE(),w=f.P.truncate((E+3)/4),E=.5*Math.PI/w,C=Math.cos(E);for(var R=Math.sin(E),I=new f.h,F=3;0<=F;F--){switch(I.na(0,this.sb),F){case 0:for(E=0;E<w;E++)g.zj(I.x+v.x,I.y+v.y),I.Bt(C,R);break;case 1:for(E=0;E<w;E++)g.zj(-I.y+v.x,I.x+v.y),I.Bt(C,R);break;case 2:for(E=0;E<w;E++)g.zj(-I.x+v.x,-I.y+v.y),I.Bt(C,R);break;default:for(g.qx(I.y+v.x,-I.x+v.y),E=1;E<w;E++)I.Bt(C,R),g.zj(I.y+v.x,-I.x+v.y)}this.Zq()}}},m.jx=function(g){return g.Dh(1,0),g},m.prototype.gX=function(g){return g.Dh(2,this.ra),g.hm(),g},m}();f.zK=u}(ae||(ae={})),function(f){var N=function(){function T(d){this.Da=d,this.g=new f.hd,this.ed=new f.ja(0)}return T.prototype.Mh=function(d,h,o){switch(h){case 0:if(d.v<o&&d.C<=o)break;return d.v>=o?1:-1;case 1:if(d.G<o&&d.H<=o)break;return d.G>=o?1:-1;case 2:if(d.v>=o&&d.C>o)break;return d.C<=o?1:-1;case 3:if(!(d.G>=o&&d.H>o))return d.H<=o?1:-1}return 0},T.prototype.uy=function(d,h){return d.K()==1736?this.wy(d,h):this.xy(d)},T.prototype.wy=function(d,h){if(this.Da.S()==0||this.Da.da()==0)return d.Ja();var o=new f.l;d.yc(o),this.Y=this.g.Ib(d);var c=new f.l,u=new f.l,m=new f.h,g=new f.h,v=[0,0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0,0];new f.hg;var E=new f.zb,C=new f.ja(0);C.Jb(Math.min(100,d.I()));for(var R=!1,I=0;!R&&4>I;I++){var F=!1,U=(1&I)!=0,j=0;switch(I){case 0:j=this.Da.v,F=o.v<=j&&o.C>=j;break;case 1:j=this.Da.G,F=o.G<=j&&o.H>=j;break;case 2:j=this.Da.C,F=o.v<=j&&o.C>=j;break;case 3:j=this.Da.H,F=o.G<=j&&o.H>=j}if(F)for(R=!0,F=this.g.Ob(this.Y);F!=-1;){var ee=-1,te=-1,Z=this.g.Ya(F),le=Z;do{var ve=this.g.cc(le);ve==null&&(ve=E,this.g.D(le,m),ve.Ec(m),this.g.D(this.g.V(le),g),ve.Rc(g)),ve.A(c);var be=this.Mh(c,I,j),ue=0,Le=-1;if(be==-1){ue=0<(ve=ve.fq(U,j,v,w))?this.g.Wl(le,w,ve):0,ue+=1;var Be=le,it=this.g.V(Be);for(ve=0;ve<ue;ve++){if(this.g.D(Be,m),this.g.D(it,g),(Le=this.g.cc(Be))==null&&((Le=E).Ec(m),Le.Rc(g)),Le.A(u),(Le=this.Mh(u,I,j))==-1){if(U)(Le=Math.abs(m.y-j))<(Ke=Math.abs(g.y-j))?(m.y=j,this.g.mf(Be,m)):(g.y=j,this.g.mf(it,g));else{Le=Math.abs(m.x-j);var Ke=Math.abs(g.x-j);Le<Ke?(m.x=j,this.g.mf(Be,m)):(g.x=j,this.g.mf(it,g))}(Le=this.g.cc(Be))==null&&((Le=E).Ec(m),Le.Rc(g)),Le.A(u),Le=this.Mh(u,I,j)}Ke=ee,ee=Le,te==-1&&(te=ee),Ke==0&&ee==1||Ke==1&&ee==0||Ke!=0||ee!=0||C.add(Be),ee==1&&(R=!1),Le=Be=it,it=this.g.V(it)}}ue==0&&(Ke=ee,ee=be,te==-1&&(te=ee),Ke==0&&ee==1||Ke==1&&ee==0||Ke!=0||ee!=0||C.add(le),ee==1&&(R=!1),Le=this.g.V(le)),le=Le}while(le!=Z);for(te==0&&ee==0&&C.add(Z),ve=0,ee=C.size;ve<ee;ve++)te=C.get(ve),this.g.pd(te,!1);C.clear(!1),F=3>this.g.Ka(F)?this.g.ar(F):this.g.Sb(F)}}return R?d.Ja():(this.zB(),0<h&&this.Hy(h),this.g.Ke(this.Y))},T.prototype.xy=function(d){var h=new f.l,o=new f.l,c=[0,0,0,0,0,0,0,0,0],u=[0,0,0,0,0,0,0,0,0],m=new f.hg,g=d,v=new f.l;d.yc(v);for(var w=0;4>w;w++){var E=!1,C=(1&w)!=0,R=0;switch(w){case 0:R=this.Da.v,E=v.v<=R&&v.C>=R;break;case 1:R=this.Da.G,E=v.G<=R&&v.H>=R;break;case 2:R=this.Da.C,E=v.v<=R&&v.C>=R;break;case 3:R=this.Da.H,E=v.G<=R&&v.H>=R}if(E){E=g,g=d.Ja(),(E=E.Ha()).$i();for(var I,F=new f.h;E.ab();)for(var U,j=!0;E.Ia();){var ee=E.ia();ee.A(h);var te=this.Mh(h,w,R);if(te==-1){if(0<(te=ee.fq(C,R,c,u))){var Z=0;I=ee.ac();for(var le=0;le<=te;le++)if(Z!=(U=le<te?u[le]:1)){ee.bh(Z,U,m);var ve=m.get();ve.Ec(I),le<te&&(C?(F.x=c[le],F.y=R):(F.x=R,F.y=c[le]),ve.Rc(F)),ve.A(o);var be=this.Mh(o,w,R);if(be==-1){if(I=ve.ac(),Z=ve.xc(),C)(be=Math.abs(I.y-R))<(ue=Math.abs(Z.y-R))?(I.y=R,ve.Ec(I)):(Z.y=R,ve.Rc(Z));else{be=Math.abs(I.x-R);var ue=Math.abs(Z.x-R);be<ue?(I.x=R,ve.Ec(I)):(Z.x=R,ve.Rc(Z))}ve.A(o),be=this.Mh(o,w,R)}I=ve.xc(),Z=U,(U=be)==1?(g.oc(ve,j),j=!1):j=!0}}}else(U=te)==1?(g.oc(ee,j),j=!1):j=!0}}}return g},T.prototype.zB=function(){this.ki=-1,this.Xl(!1,this.Da.v),this.Xl(!1,this.Da.C),this.Xl(!0,this.Da.G),this.Xl(!0,this.Da.H),this.ed.resize(0),this.ed.Jb(100),this.ki=this.g.Hd();for(var d=new f.h,h=this.g.Ob(this.Y);h!=-1;h=this.g.Sb(h))for(var o=this.g.Ya(h),c=0,u=this.g.Ka(h);c<u;c++,o=this.g.V(o))this.g.D(o,d),(this.Da.v==d.x||this.Da.C==d.x||this.Da.G==d.y||this.Da.H==d.y)&&(this.g.Sa(o,this.ki,this.ed.size),this.ed.add(o));this.Pl(!1,this.Da.v),this.Pl(!1,this.Da.C),this.Pl(!0,this.Da.G),this.Pl(!0,this.Da.H),this.Oy()},T.prototype.Hy=function(d){for(var h=new f.h,o=new f.h,c=f.P.lg(2048,0),u=this.g.Ob(this.Y);u!=-1;u=this.g.Sb(u)){var m=this.g.Ya(u),g=m;do{var v=this.g.V(g);this.g.D(g,h);var w=-1;if(h.x==this.Da.v?(this.g.D(v,o),o.x==this.Da.v&&(w=1)):h.x==this.Da.C&&(this.g.D(v,o),o.x==this.Da.C&&(w=1)),h.y==this.Da.G?(this.g.D(v,o),o.y==this.Da.G&&(w=0)):h.y==this.Da.H&&(this.g.D(v,o),o.y==this.Da.H&&(w=0)),w!=-1&&(w=f.h.ub(h,o),!(1>=(w=f.P.truncate(Math.min(Math.ceil(w/d),2048)))))){for(var E=1;E<w;E++)c[E-1]=1*E/w;this.g.Wl(g,c,w-1)}g=v}while(g!=m)}},T.prototype.Xl=function(d,h){var o=this.g.Hd(),c=new f.h,u=new f.ja(0);u.Jb(100);for(var m=this.g.Ob(this.Y);m!=-1;m=this.g.Sb(m))for(var g=this.g.Ya(m),v=0,w=this.g.Ka(m);v<w;v++){var E=this.g.V(g);this.g.D(g,c),(d?c.y==h:c.x==h)&&(this.g.D(E,c),(d?c.y==h:c.x==h)&&(this.g.Qa(g,o)!=1&&(u.add(g),this.g.Sa(g,o,1)),this.g.Qa(E,o)!=1&&(u.add(E),this.g.Sa(E,o,1)))),g=E}if(this.g.Ud(o),!(3>u.size)){var C=this;u.Wd(0,u.size,function(be,ue){return C.Nh(be,ue)}),o=new f.h,m=new f.h,g=new f.h,m.Sc();var R=-1;v=new f.ja(0),w=new f.ja(0),E=this.g.Hd();for(var I=this.g.Hd(),F=0,U=u.size;F<U;F++){var j=u.get(F);if(this.g.D(j,c),!c.rb(m)){if(R!=-1){for(var ee=R;ee<F;ee++){R=u.get(ee);var te=this.g.V(R);j=this.g.Na(R);var Z=!1;0>this.Nh(R,te)&&(this.g.D(te,o),d?o.y==h:o.x==h)&&(v.add(R),Z=!0,this.g.Sa(R,I,1)),0>this.Nh(R,j)&&(this.g.D(j,o),d?o.y==h:o.x==h)&&(Z||v.add(R),this.g.Sa(R,E,1))}for(ee=0,Z=v.size;ee<Z;ee++){if(R=v.get(ee),j=this.g.Qa(R,E),te=this.g.Qa(R,I),j==1){j=this.g.Na(R),this.g.D(j,g);var le=[0];if(le[0]=0,!g.rb(c)){var ve=f.h.ub(m,g);le[0]=f.h.ub(g,c)/ve,le[0]==0?le[0]=2220446049250313e-31:le[0]==1&&(le[0]=.9999999999999998),this.g.Wl(j,le,1),j=this.g.Na(R),this.g.mf(j,c),w.add(j),this.g.Sa(j,E,1),this.g.Sa(j,I,-1)}}te==1&&(te=this.g.V(R),this.g.D(te,g),(le=[0])[0]=0,g.rb(c)||(ve=f.h.ub(m,g),le[0]=f.h.ub(m,c)/ve,le[0]==0?le[0]=2220446049250313e-31:le[0]==1&&(le[0]=.9999999999999998),this.g.Wl(R,le,1),j=this.g.V(R),this.g.mf(j,c),w.add(j),this.g.Sa(j,E,-1),this.g.Sa(j,I,1)))}R=v,v=w,(w=R).clear(!1)}R=F,m.N(c)}}this.g.Ud(E),this.g.Ud(I)}},T.prototype.Pl=function(d,h){var o=new f.h,c=new f.ja(0);c.Jb(100);for(var u=this.g.Hd(),m=0,g=this.ed.size;m<g;m++){var v=this.ed.get(m);if(v!=-1){var w=this.g.V(v);this.g.D(v,o),(d?o.y==h:o.x==h)&&(this.g.D(w,o),(d?o.y==h:o.x==h)&&(this.g.Qa(v,u)!=-2&&(c.add(v),this.g.Sa(v,u,-2)),this.g.Qa(w,u)!=-2&&(c.add(w),this.g.Sa(w,u,-2))))}}if(c.size!=0){var E=this;for(c.Wd(0,c.size,function(ue,Le){return E.Nh(ue,Le)}),m=0,g=c.size;m<g;m++){var C=c.get(m);this.g.Sa(C,u,m)}v=new f.h,(w=new f.h).Sc();var R=-1;for(m=0,g=c.size;m<g;m++)if((C=c.get(m))!=-1&&(this.g.D(C,o),!o.rb(w))){if(R!=-1)for(;;){C=!1;for(var I=1<m-R?m-1:m,F=R;F<I;F++){var U=c.get(F);if(U!=-1){var j=-1,ee=this.g.V(U);0>this.Nh(U,ee)&&(this.g.D(ee,v),d?v.y==h:v.x==h)&&(j=ee),ee=-1;var te=this.g.Na(U);if(0>this.Nh(U,te)&&(this.g.D(te,v),d?v.y==h:v.x==h)&&(ee=te),j!=-1&&ee!=-1)this.Lh(U,c,u),this.g.pd(U,!1),this.Lh(j,c,u),this.g.pd(j,!1),C=!0;else if(j!=-1||ee!=-1){for(te=F+1;te<m;te++){var Z=c.get(te);if(Z!=-1){var le=this.g.V(Z),ve=-1;0>this.Nh(Z,le)&&(this.g.D(le,v),d?v.y==h:v.x==h)&&(ve=le),le=this.g.Na(Z);var be=-1;if(0>this.Nh(Z,le)&&(this.g.D(le,v),d?v.y==h:v.x==h)&&(be=le),ve!=-1&&be!=-1){this.Lh(Z,c,u),this.g.pd(Z,!1),this.Lh(ve,c,u),this.g.pd(ve,!1),C=!0;break}if(j!=-1&&be!=-1){this.zt(c,U,j,Z,be,u),C=!0;break}if(ee!=-1&&ve!=-1){this.zt(c,Z,ve,U,ee,u),C=!0;break}}}if(C)break}}}if(!C)break}R=m,w.N(o)}}this.g.Ud(u)},T.prototype.Lh=function(d,h,o){o=this.g.Qa(d,o),h.set(o,-1),o=this.g.Qa(d,this.ki),this.ed.set(o,-1),(h=this.g.cd(d))!=-1&&this.g.Ya(h)==d&&(this.g.Kf(h,-1),this.g.Xg(h,-1))},T.prototype.zt=function(d,h,o,c,u,m){this.g.Cc(h,c),this.g.Dc(c,h),this.g.Dc(o,u),this.g.Cc(u,o),this.Lh(c,d,m),this.g.ni(c,!1),this.Lh(u,d,m),this.g.ni(u,!0)},T.prototype.Oy=function(){for(var d=0,h=this.ed.size;d<h;d++){var o=this.ed.get(d);o!=-1&&this.g.bj(o,-1)}for(var c=0,u=0,m=this.g.Ob(this.Y);m!=-1;){var g=this.g.Ya(m);if(g==-1||m!=this.g.cd(g)){var v=m;m=this.g.Sb(m),this.g.Kf(v,-1),this.g.br(v)}else{o=g,v=0;do this.g.bj(o,m),v++,o=this.g.V(o);while(o!=g);2>=v?(o=this.g.Qa(g,this.ki),this.ed.set(o,-1),g=this.g.pd(g,!1),v==2&&(o=this.g.Qa(g,this.ki),this.ed.set(o,-1),this.g.pd(g,!1)),v=m,m=this.g.Sb(m),this.g.Kf(v,-1),this.g.br(v)):(this.g.ep(m,!1),this.g.Xg(m,this.g.Na(g)),this.g.Wj(m,v),u+=v,c++,m=this.g.Sb(m))}}for(d=0,h=this.ed.size;d<h;d++)if((o=this.ed.get(d))!=-1&&(m=this.g.cd(o))==-1){m=this.g.wf(this.Y,-1),v=0,g=o;do this.g.bj(o,m),v++,o=this.g.V(o);while(o!=g);2>=v?(o=this.g.Qa(g,this.ki),this.ed.set(o,-1),g=this.g.pd(g,!1),v==2&&(0<=(o=this.g.Qa(g,this.ki))&&this.ed.set(o,-1),this.g.pd(g,!1)),v=m,this.g.Kf(v,-1),this.g.br(v)):(this.g.mn(m,!0),this.g.Wj(m,v),this.g.Kf(m,g),this.g.Xg(m,this.g.Na(g)),this.g.ep(m,!1),u+=v,c++)}for(this.g.Tl(this.Y,c),this.g.Uj(this.Y,u),d=0,h=this.g.ld;h!=-1;h=this.g.ve(h))d+=this.g.I(h);this.g.VB(d)},T.vy=function(d,h,o){return new T(h).uy(d,o)},T.clip=function(d,h,o,c){if(d.B())return d;if(h.B())return d.Ja();if((o=d.K())==33)return c=d.D(),h.contains(c)?d:d.Ja();if(o==197)return c=new f.l,d.A(c),c.Fa(h)?(h=new f.Gh,d.copyTo(h),h.Yo(c),h):d.Ja();var u=new f.l;if(d.yc(u),h.contains(u))return d;if(!h.isIntersecting(u))return d.Ja();if((u=d.Cb)!=null&&(u=u.Fk)!=null){if((u=u.So(h))==1){if(o!=1736)throw f.i.Ra();return(d=new f.Ea(d.description)).vp(h),d}if(u==0)return d.Ja()}switch(o){case 550:o=null,u=d.I();for(var m=d.vb(0),g=0,v=0;v<u;v++)c=new f.h,m.uc(2*v,c),h.contains(c)||(g==0&&(o=d.Ja()),g<v&&o.Gd(d,g,v),g=v+1);return 0<g&&o.Gd(d,g,u),g==0?d:o;case 1736:case 1607:return T.vy(d,h,c);default:throw f.i.Ra()}},T.prototype.Nh=function(d,h){var o=new f.h;return this.g.D(d,o),d=new f.h,this.g.D(h,d),o.compare(d)},T}();f.Vd=N}(ae||(ae={})),function(f){var N=function(){function T(d,h){this.Da=d,this.g=new f.hd,this.ed=new f.ja(0),this.nd=h}return T.prototype.Mh=function(d,h,o){switch(h){case 0:if(d.v<o&&d.C<=o)break;return d.v>=o?1:-1;case 1:if(d.G<o&&d.H<=o)break;return d.G>=o?1:-1;case 2:if(d.v>=o&&d.C>o)break;return d.C<=o?1:-1;case 3:if(!(d.G>=o&&d.H>o))return d.H<=o?1:-1}return 0},T.prototype.uy=function(d,h){return d.K()==1736?this.wy(d,h):this.xy(d)},T.prototype.wy=function(d,h){if(this.Da.S()==0||this.Da.da()==0)return d.Ja();var o=new f.l;d.yc(o),this.Y=this.g.Ib(d);var c=new f.l,u=new f.l,m=new f.h,g=new f.h,v=[0,0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0,0],E=new f.zb,C=new f.ja(0);C.Jb(256);for(var R=!1,I=0;!R&&4>I;I++){var F=!1,U=(1&I)!=0,j=0;switch(I){case 0:j=this.Da.v,F=o.v<=j&&o.C>=j;break;case 1:j=this.Da.G,F=o.G<=j&&o.H>=j;break;case 2:j=this.Da.C,F=o.v<=j&&o.C>=j;break;case 3:j=this.Da.H,F=o.G<=j&&o.H>=j}if(F)for(R=!0,F=this.g.Ob(this.Y);F!=-1;){var ee=!0,te=-1,Z=-1,le=this.g.Ya(F),ve=le;do{var be=this.g.cc(ve);be==null&&(be=E,this.g.D(ve,m),be.Ec(m),this.g.D(this.g.V(ve),g),be.Rc(g)),be.A(c);var ue=this.Mh(c,I,j),Le=0,Be=-1;if(ue==-1){Le=0<(be=be.fq(U,j,v,w))?this.g.zX(ve,w,be):0,Le+=1;var it=ve,Ke=this.g.V(it);for(be=0;be<Le;be++){if(this.g.D(it,m),this.g.D(Ke,g),(Be=this.g.cc(it))==null&&((Be=E).Ec(m),Be.Rc(g)),Be.A(u),(Be=this.Mh(u,I,j))==-1){if(U)(Be=Math.abs(m.y-j))<(Je=Math.abs(g.y-j))?(m.y=j,this.g.mf(it,m)):(g.y=j,this.g.mf(Ke,g));else{Be=Math.abs(m.x-j);var Je=Math.abs(g.x-j);Be<Je?(m.x=j,this.g.mf(it,m)):(g.x=j,this.g.mf(Ke,g))}(Be=this.g.cc(it))==null&&((Be=E).Ec(m),Be.Rc(g)),Be.A(u),Be=this.Mh(u,I,j)}Je=te,te=Be,Z==-1&&(Z=te),Je==0&&te==1||Je==1&&te==0||Je!=0||te!=0||C.add(it),te==1&&(ee=R=!1),Be=it=Ke,Ke=this.g.V(Ke)}}if(Le==0&&(Je=te,te=ue,Z==-1&&(Z=te),Je==0&&te==1||Je==1&&te==0||Je!=0||te!=0||C.add(ve),te==1&&(ee=R=!1),Be=this.g.V(ve)),ve=Be,256<=C.size){for(be=1,ue=C.size-1;be<ue;be++)Le=C.get(be),this.g.pd(Le,!1);C.set(1,C.Gc()),C.Ch(2)}}while(ve!=le);if(!ee)for(Z==0&&te==0&&C.add(le),be=0,ue=C.size;be<ue;be++)Le=C.get(be),this.g.pd(Le,!1);C.clear(!1),F=ee||this.g.Ka(F)==0?this.g.ar(F):this.g.Sb(F)}}return R?d.Ja():(this.zB(),0<h&&this.Hy(h),this.g.Ke(this.Y))},T.prototype.xy=function(d){var h=new f.l,o=new f.l,c=[0,0,0,0,0,0,0,0,0],u=[0,0,0,0,0,0,0,0,0],m=new f.hg,g=d,v=new f.l;d.yc(v);for(var w=new f.h,E=new f.h,C=null,R=null,I=0;4>I;I++){var F=!1,U=(1&I)!=0,j=0;switch(I){case 0:j=this.Da.v,F=v.v<=j&&v.C>=j;break;case 1:j=this.Da.G,F=v.G<=j&&v.H>=j;break;case 2:j=this.Da.C,F=v.v<=j&&v.C>=j;break;case 3:j=this.Da.H,F=v.G<=j&&v.H>=j}if(F)for(F=g,g=d.Ja(),(F=F.Ha()).$i();F.ab();)for(var ee,te=!0;F.Ia();){var Z=F.ia();Z.A(h);var le=this.Mh(h,I,j);if(le==-1){if(0<(le=Z.fq(U,j,c,u))){var ve=0;Z.$p(w);for(var be=0;be<=le;be++)if(ve!=(ee=be<le?u[be]:1)){Z.bh(ve,ee,m);var ue=m.get();ue.Ec(w),be<le&&(U?(E.x=c[be],E.y=j):(E.x=j,E.y=c[be]),ue.Rc(E)),ue.A(o);var Le=this.Mh(o,I,j);Le==-1&&(C==null&&(C=new f.h),R==null&&(R=new f.h),ue.$p(C),ue.Ur(R),U?(ve=Math.abs(C.y-j))<(Le=Math.abs(R.y-j))?(C.y=j,ue.Ec(C)):(R.y=j,ue.Rc(R)):(ve=Math.abs(C.x-j))<(Le=Math.abs(R.x-j))?(C.x=j,ue.Ec(C)):(R.x=j,ue.Rc(R)),ue.A(o),Le=this.Mh(o,I,j)),ue.Ur(w),ve=ee,(ee=Le)==1?(g.oc(ue,te),te=!1):te=!0}}}else(ee=le)==1?(g.oc(Z,te),te=!1):te=!0}}return g},T.prototype.zB=function(){this.ki=-1,this.Xl(!1,this.Da.v),this.Xl(!1,this.Da.C),this.Xl(!0,this.Da.G),this.Xl(!0,this.Da.H),this.ed.resize(0),this.ed.Jb(100),this.ki=this.g.Hd();for(var d=new f.h,h=this.g.Ob(this.Y);h!=-1;h=this.g.Sb(h))for(var o=this.g.Ya(h),c=0,u=this.g.Ka(h);c<u;c++,o=this.g.V(o))this.g.D(o,d),(this.Da.v==d.x||this.Da.C==d.x||this.Da.G==d.y||this.Da.H==d.y)&&(this.g.Sa(o,this.ki,this.ed.size),this.ed.add(o));this.Pl(!1,this.Da.v),this.Pl(!1,this.Da.C),this.Pl(!0,this.Da.G),this.Pl(!0,this.Da.H),this.Oy()},T.prototype.Hy=function(d){for(var h=new f.h,o=new f.h,c=null,u=null,m=f.P.lg(2048,0),g=this.g.Ob(this.Y);g!=-1;g=this.g.Sb(g)){var v=this.g.Ya(g),w=v;do{var E=this.g.V(w);this.g.D(w,h);var C=-1;if(h.x==this.Da.v?(this.g.D(E,o),o.x==this.Da.v&&(C=1)):h.x==this.Da.C&&(this.g.D(E,o),o.x==this.Da.C&&(C=1)),h.y==this.Da.G?(this.g.D(E,o),o.y==this.Da.G&&(C=0)):h.y==this.Da.H&&(this.g.D(E,o),o.y==this.Da.H&&(C=0)),C!=-1){if(c==null&&(c=new f.h),u==null&&(u=new f.h),c.N(h),u.na(0,0),C==0){var R=h.x-this.Da.v;u.x=f.mc.sign(o.x-h.x),c.x=d*f.mc.Dn(Math.floor(Math.abs(R/d)),R)+this.Da.v,0>c.x&&(c.x+=d)}else R=h.y-this.Da.G,u.y=f.mc.sign(o.y-h.y),c.y=d*f.mc.Dn(Math.floor(Math.abs(R/d)),R)+this.Da.G,0>c.y&&(c.y+=d);R=C!=0?o.y-h.y:o.x-h.x;var I=Math.abs(R);if(65536<I/d)throw f.i.ga("internal error");if(0<I){I=f.P.truncate(I/d)+2,m.length<I&&(m=f.P.lg(I));for(var F=I=0;;F++){var U=new f.h;if(U.x=c.x+u.x*F*d,U.y=c.y+u.y*F*d,1<=(U=(C!=0?U.y-h.y:U.x-h.x)/R))break;0>=U||(m[I]=U,I++)}I!=0&&this.g.Wl(w,m,I)}}w=E}while(w!=v)}},T.prototype.Xl=function(d,h){for(var o=-1,c=new f.h,u=null,m=this.g.Ob(this.Y);m!=-1;m=this.g.Sb(m))for(var g=this.g.Ya(m),v=0,w=this.g.Ka(m);v<w;v++){var E=this.g.V(g);this.g.D(g,c),(d?c.y==h:c.x==h)&&(this.g.D(E,c),(d?c.y==h:c.x==h)&&(o==-1&&(o=this.g.Hd()),u==null&&(u=new f.ja(0)).Jb(100),this.g.Qa(g,o)!=1&&(u.add(g),this.g.Sa(g,o,1)),this.g.Qa(E,o)!=1&&(u.add(E),this.g.Sa(E,o,1)))),g=E}if(o!=-1&&this.g.Ud(o),!(u==null||3>u.size)){var C=this;u.Wd(0,u.size,function(be,ue){return C.Nh(be,ue)}),o=new f.h,m=new f.h,g=new f.h,m.Sc();var R=-1;v=new f.ja(0),w=new f.ja(0),E=null;for(var I=this.g.Hd(),F=this.g.Hd(),U=0,j=u.size;U<j;U++){var ee=u.get(U);if(this.g.D(ee,c),!c.rb(m)){if(R!=-1){for(var te=R;te<U;te++){R=u.get(te);var Z=this.g.V(R);ee=this.g.Na(R);var le=!1;this.g.D(Z,o),0>m.compare(o)&&(d?o.y==h:o.x==h)&&(v.add(R),le=!0,this.g.Sa(R,F,1)),this.g.D(ee,o),0>m.compare(o)&&(d?o.y==h:o.x==h)&&(le||v.add(R),this.g.Sa(R,I,1))}for(te=0,le=v.size;te<le;te++){if(R=v.get(te),ee=this.g.Qa(R,I),Z=this.g.Qa(R,F),ee==1&&(ee=this.g.Na(R),this.g.D(ee,g),!g.rb(c))){E==null&&(E=[]);var ve=f.h.ub(m,g);E[0]=f.h.ub(g,c)/ve,E[0]==0?E[0]=2220446049250313e-31:E[0]==1&&(E[0]=.9999999999999998),this.g.Wl(ee,E,1),ee=this.g.Na(R),this.g.mf(ee,c),w.add(ee),this.g.Sa(ee,I,1),this.g.Sa(ee,F,-1)}Z==1&&(Z=this.g.V(R),this.g.D(Z,g),g.rb(c)||(E==null&&(E=[]),ve=f.h.ub(m,g),E[0]=f.h.ub(m,c)/ve,E[0]==0?E[0]=2220446049250313e-31:E[0]==1&&(E[0]=.9999999999999998),this.g.Wl(R,E,1),ee=this.g.V(R),this.g.mf(ee,c),w.add(ee),this.g.Sa(ee,I,-1),this.g.Sa(ee,F,1)))}R=v,v=w,(w=R).clear(!1)}R=U,m.N(c)}}this.g.Ud(I),this.g.Ud(F)}},T.prototype.Pl=function(d,h){for(var o=new f.h,c=null,u=-1,m=0,g=this.ed.size;m<g;m++){var v=this.ed.get(m);if(v!=-1){var w=this.g.V(v);this.g.D(v,o),(d?o.y==h:o.x==h)&&(this.g.D(w,o),(d?o.y==h:o.x==h)&&(u==-1&&(u=this.g.Hd()),c==null&&(c=new f.ja(0)).Jb(100),this.g.Qa(v,u)!=-2&&(c.add(v),this.g.Sa(v,u,-2)),this.g.Qa(w,u)!=-2&&(c.add(w),this.g.Sa(w,u,-2))))}}if(c==null)u!=-1&&this.g.Ud(u);else{var E=this;for(c.Wd(0,c.size,function(ue,Le){return E.Nh(ue,Le)}),m=0,g=c.size;m<g;m++){var C=c.get(m);this.g.Sa(C,u,m)}v=new f.h,(w=new f.h).Sc();var R=-1;for(m=0,g=c.size;m<g;m++)if((C=c.get(m))!=-1&&(this.g.D(C,o),!o.rb(w))){if(R!=-1)for(;;){C=!1;for(var I=1<m-R?m-1:m,F=R;F<I;F++){var U=c.get(F);if(U!=-1){var j=-1,ee=this.g.V(U);this.g.D(ee,v),0>w.compare(v)&&(d?v.y==h:v.x==h)&&(j=ee),ee=-1;var te=this.g.Na(U);if(this.g.D(te,v),0>w.compare(v)&&(d?v.y==h:v.x==h)&&(ee=te),j!=-1&&ee!=-1)this.Lh(U,c,u),this.g.pd(U,!1),this.Lh(j,c,u),this.g.pd(j,!1),C=!0;else if(j!=-1||ee!=-1){for(te=F+1;te<m;te++){var Z=c.get(te);if(Z!=-1){var le=this.g.V(Z),ve=-1;this.g.D(le,v),0>w.compare(v)&&(d?v.y==h:v.x==h)&&(ve=le),le=this.g.Na(Z);var be=-1;if(this.g.D(le,v),0>w.compare(v)&&(d?v.y==h:v.x==h)&&(be=le),ve!=-1&&be!=-1){this.Lh(Z,c,u),this.g.pd(Z,!1),this.Lh(ve,c,u),this.g.pd(ve,!1),C=!0;break}if(j!=-1&&be!=-1){this.zt(c,U,j,Z,be,u),C=!0;break}if(ee!=-1&&ve!=-1){this.zt(c,Z,ve,U,ee,u),C=!0;break}}}if(C)break}}}if(!C)break}R=m,w.N(o)}this.g.Ud(u)}},T.prototype.Lh=function(d,h,o){o=this.g.Qa(d,o),h.set(o,-1),o=this.g.Qa(d,this.ki),this.ed.set(o,-1),(h=this.g.cd(d))!=-1&&this.g.Ya(h)==d&&(this.g.Kf(h,-1),this.g.Xg(h,-1))},T.prototype.zt=function(d,h,o,c,u,m){this.g.Cc(h,c),this.g.Dc(c,h),this.g.Dc(o,u),this.g.Cc(u,o),this.Lh(c,d,m),this.g.ni(c,!1),this.Lh(u,d,m),this.g.ni(u,!0)},T.prototype.Oy=function(){for(var d=0,h=this.ed.size;d<h;d++){var o=this.ed.get(d);o!=-1&&this.g.bj(o,-1)}for(var c=0,u=0,m=this.g.Ob(this.Y);m!=-1;){var g=this.g.Ya(m);if(g==-1||m!=this.g.cd(g)){var v=m;m=this.g.Sb(m),this.g.Kf(v,-1),this.g.br(v)}else{o=g,v=0;do this.g.bj(o,m),v++,o=this.g.V(o);while(o!=g);this.g.ep(m,!1),this.g.Xg(m,this.g.Na(g)),this.g.Wj(m,v),u+=v,c++,m=this.g.Sb(m)}}for(d=0,h=this.ed.size;d<h;d++)if((o=this.ed.get(d))!=-1&&(m=this.g.cd(o))==-1){m=this.g.wf(this.Y,-1),v=0,g=o;do this.g.bj(o,m),v++,o=this.g.V(o);while(o!=g);2>=v?(o=this.g.Qa(g,this.ki),this.ed.set(o,-1),g=this.g.pd(g,!1),v==2&&(0<=(o=this.g.Qa(g,this.ki))&&this.ed.set(o,-1),this.g.pd(g,!1)),v=m,this.g.Kf(v,-1),this.g.br(v)):(this.g.mn(m,!0),this.g.Wj(m,v),this.g.Kf(m,g),this.g.Xg(m,this.g.Na(g)),this.g.ep(m,!1),u+=v,c++)}for(this.g.Tl(this.Y,c),this.g.Uj(this.Y,u),d=0,h=this.g.ld;h!=-1;h=this.g.ve(h))d+=this.g.I(h);this.g.VB(d)},T.vy=function(d,h,o,c){return new T(h,c).uy(d,o)},T.clip=function(d,h,o,c,u){return T.Pu(d,h,null,o,c,u)},T.Pu=function(d,h,o,c,u,m){var g=d.K();if(g==33)return u=d.D(),h.contains(u)?d:d.Ja();if(g==197)return u=new f.l,d.A(u),u.Fa(h)?(h=new f.Gh,d.copyTo(h),h.Yo(u),h):d.Ja();if(d.B())return d;if(h.B())return d.Ja();var v=new f.l;if(d.yc(v),h.contains(v))return d;if(!h.isIntersecting(v))return d.Ja();if((o!=null||isNaN(c))&&f.ta.ny(o,h,!1),!f.ba.yj(g))throw f.i.O();if((o=d.Cb)!=null&&(o=o.Fk)!=null){if((o=o.So(h))==1){if(g!=1736)throw f.i.ga("internal error");return(d=new f.Ea(d.description)).vp(h),d}if(o==0)return d.Ja()}switch(g){case 550:for(m=null,g=d.I(),o=d.vb(0),c=0,u=new f.h,v=0;v<g;v++)o.uc(2*v,u),h.contains(u)||(c==0&&(m=d.Ja()),c<v&&m.Gd(d,c,v),c=v+1);return 0<c&&m.Gd(d,c,g),c==0?d:m;case 1736:case 1607:return T.vy(d,h,u,m);default:throw f.i.ga("internal error")}},T.prototype.Nh=function(d,h){var o=new f.h;return this.g.D(d,o),d=new f.h,this.g.D(h,d),o.compare(d)},T}();f.si=N}(ae||(ae={})),function(f){var N=new f.h,T=function(){function h(o,c,u,m,g){this.Rm=new f.h,this.Dk=new f.h,this.Qi=new f.h,this.g=o,this.Bw=u,this.oo=m,this.Rm=c,this.Al=g,this.Dk.Sc(),this.Qi.Sc()}return h.prototype.pE=function(o){this.g.D(o,this.Dk),o=f.P.truncate((this.Dk.x-this.Rm.x)*this.oo+.5);var c=f.P.truncate((this.Dk.y-this.Rm.y)*this.oo+.5);return d.bG(o,c)},h.prototype.ez=function(o){return this.g.Qa(o,this.Al)},h.prototype.Ky=function(o,c){return this.g.D(o,this.Dk),this.g.D(c,this.Qi),d.Dv(this.Dk.x,this.Dk.y,this.Qi.x,this.Qi.y,this.Bw)},h}();f.gY=function(){};var d=function(){function h(){this.Rm=new f.h,this.rq=[0,0,0,0],this.ys=[0,0,0,0],this.ro=this.Al=-1}return h.aQ=function(o,c){var u=new h;return u.g=o,u.ra=c,u.Bw=c*c,u.aw=2*c,u.oo=1/u.aw,u.tO()},h.Dv=function(o,c,u,m,g){return(o-=u)*o+(c-=m)*c<=g},h.bG=function(o,c){return f.P.Uh(c,f.P.Uh(o))},h.prototype.vO=function(o,c){this.g.Hc(o,N);for(var u=(N.y-this.Rm.y)*this.oo,m=f.P.truncate((N.x-this.Rm.x)*this.oo),g=f.P.truncate(u),v=u=0;1>=v;v+=1)for(var w=0;1>=w;w+=1){var E=h.bG(m+v,g+w),C=this.zl.iR(E);C!=-1&&(this.rq[u]=C,this.ys[u]=E,u++)}for(m=u-1;1<=m;m--)for(C=this.rq[m],g=m-1;0<=g;g--)if(C==this.rq[g]){this.ys[g]=-1,m!=--u&&(this.ys[m]=this.ys[u],this.rq[m]=this.rq[u]);break}for(g=0;g<u;g++)this.wO(o,this.ys[g],N,this.rq[g],c)},h.prototype.wO=function(o,c,u,m,g){for(var v=new f.h;m!=-1;m=this.zl.wR(m)){var w=this.zl.ka(m);o==w||c!=-1&&this.g.Qa(w,this.Al)!=c||(this.g.Hc(w,v),h.Dv(u.x,u.y,v.x,v.y,this.Bw)&&g.add(m))}},h.prototype.Zm=function(o,c,u){var m=this.g.Qa(o,this.ro),g=this.g.Qa(c,this.ro);return m==-1&&(m=this.Ad.Qh(),this.Ad.addElement(m,o),this.g.Sa(o,this.ro,m)),g==-1?this.Ad.addElement(m,c):this.Ad.By(m,g),this.g.Sa(c,this.ro,-2),c=this.OT(o,c),u&&(u=this.lw.pE(o),this.g.Sa(o,this.Al,u)),c},h.MT=function(o,c,u){o.Nb(c),u=o;var m=new f.h;h.NT(o.D(),c.D(),m),u.Db(m)},h.NT=function(o,c,u){var m=o.x;o.x!=c.x&&(m=(1*o.x+1*c.x)/2);var g=o.y;o.y!=c.y&&(g=(1*o.y+1*c.y)/2),u.na(m,g)},h.prototype.OT=function(o,c){var u=new f.h;this.g.D(o,u);var m=new f.h;this.g.D(c,m);var g=this.g.VF(o),v=g+(c=this.g.VF(c)),w=0,E=u.x;u.x!=m.x&&(E=(u.x*g+m.x*c)/v,w++);var C=u.y;return u.y!=m.y&&(C=(u.y*g+m.y*c)/v,w++),0<w&&this.g.Db(o,E,C),this.g.jX(o,v),w!=0},h.prototype.tO=function(){var o=this.g.gd,c=this.g.AF();for(this.Rm=c.hz(),c=Math.max(c.da(),c.S())/2147483646,this.aw<c&&(this.aw=c,this.oo=1/this.aw),this.Ad=new f.bu,this.Ad.At(f.P.truncate(this.g.gd/3+1)),this.Ad.hn(f.P.truncate(this.g.gd/3+1)),this.Al=this.g.Hd(),this.ro=this.g.Hd(),this.lw=new T(this.g,this.Rm,this.Bw,this.oo,this.Al),this.zl=new f.WK(f.P.truncate(4*o/3),this.lw),this.zl.qW(this.g.gd),o=!1,c=this.g.ld;c!=-1;c=this.g.ve(c))for(var u=this.g.Ob(c);u!=-1;u=this.g.Sb(u))for(var m=this.g.Ya(u),g=0,v=this.g.Ka(u);g<v;g++){var w=this.lw.pE(m);this.g.Sa(m,this.Al,w),this.zl.addElement(m,w),m=this.g.V(m)}var E=new f.ja(0);for(E.Jb(10),c=this.g.ld;c!=-1;c=this.g.ve(c))for(u=this.g.Ob(c);u!=-1;u=this.g.Sb(u))for(m=this.g.Ya(u),g=0,v=this.g.Ka(u);g<v;g++){if(this.g.Qa(m,this.ro)!=-2)for(w=this.g.Qa(m,this.Al),this.zl.kd(m,w);this.vO(m,E),E.size!=0;){w=!1;for(var C=0,R=E.size;C<R;C++){var I=E.get(C),F=this.zl.ka(I);this.zl.wd(I),w=this.Zm(m,F,C+1==R)||w}if(o=o||w,E.clear(!1),!w)break}m=this.g.V(m)}return o&&this.nN(),this.lw=this.zl=null,this.g.Ud(this.Al),this.g.Ud(this.ro),o},h.prototype.nN=function(){for(var o=new f.h,c=this.Ad.je;c!=-1;c=this.Ad.lz(c)){var u=this.Ad.sc(c);for(this.g.D(this.Ad.ka(u),o),u=this.Ad.lb(u);u!=-1;u=this.Ad.lb(u))this.g.mf(this.Ad.ka(u),o)}},h}();f.Zt=d}(ae||(ae={})),function(f){var N=function(){function T(d){d===void 0&&(d=null),this.yg=null,this.Pb=!1,this.yg=d===null?[]:d}return T.prototype.copyTo=function(d){if(d.Pb)throw f.i.ga("CompositeGeographicTransformation is read-only");for(var h=0;h<this.yg.length;h++)d.yg.push(this.yg[h].Pf())},T.prototype.count=function(){return this.yg.length},T.prototype.add=function(d){if(this.Pb)throw f.i.ga("CompositeGeographicTransformation is read-only");this.yg.push(d.Pf())},T.prototype.clear=function(){if(this.Pb)throw f.i.ga("CompositeGeographicTransformation is read-only");this.yg.length=0},T.prototype.remove=function(d){if(this.Pb)throw f.i.ga("CompositeGeographicTransformation is read-only");this.yg.splice(d,1)},T.prototype.ig=function(){var d=new T;return this.copyTo(d),d},T.prototype.Pf=function(){return this.ig()},T.prototype.transform=function(d,h,o,c){if(d.length<h)throw f.i.ga("invalid Argument");var u=o;for(o=0;o<this.yg.length;o++){var m=this.yg[o];if(m.sm()!=null){var g=m.Vn,v=g?1:0,w=g?m.sm().getGeogcs2():m.sm().getGeogcs1();if(w=u/(w=w.getUnit().getUnitFactor()),3552713678800501e-30<Math.abs(w-1))for(u=0;u<h;u++)d[u][0]*=w,d[u][1]*=w;f.EC.geogToGeog(m.sm(),h,d,null,v),u=(g?m.sm().getGeogcs1():m.sm().getGeogcs2()).getUnit().getUnitFactor()}}if(w=u/c,3552713678800501e-30<Math.abs(w-1))for(u=0;u<h;u++)d[u][0]*=w,d[u][1]*=w;return h},T.prototype.Nb=function(d){if(d==this)return!0;if(!(d instanceof T)||this.yg.length!=d.yg.length)return!1;for(var h=0;h<this.yg.length;h++)if(!this.yg[h].Nb(d.yg[h]))return!1;return!0},T.prototype.hx=function(){this.Pb=!0},T.prototype.toString=function(){for(var d="CGT ("+this.count()+") ",h=0,o=this.count();h<o;++h)d+=this.yg[h].toString()+", ";return 200<d.length?d.substring(0,197)+"... ("+d.length.toString()+" characters)":d},T.create=function(){return new T},T}();f.pC=N}(ae||(ae={})),function(f){var N,T=Math.PI,d=2*Math.PI,h=Math.PI/2,o=function(){function m(){}return m.LO=function(g,v){var w=new m;return w.x=g,w.y=v,w.type=0,w.Vh=0,w},m.bl=function(g){var v=new m;return v.x=g.x,v.y=g.y,v.type=0,v.Vh=0,v},m.KO=function(g){var v=new m;return v.x=g.x,v.y=g.y,v.type=g.type,v.Vh=g.Vh,v},m.Qd=function(g,v,w){var E=new m;return E.x=g.x+v*Math.cos(w),E.y=g.y+v*Math.sin(w),E.type=g.type,E.Vh=g.Vh,E},m.Ru=function(g,v){var w=new m;return w.x=.5*(g.x+v.x),w.y=.5*(g.y+v.y),w.type=g.type,w.Vh=g.Vh,w},m.LE=function(g,v){var w=new m;return w.x=g.x+.001*(v.x-g.x),w.y=g.y+.001*(v.y-g.y),w.type=g.type,w.Vh=g.Vh,w},m}(),c=function(){};(N=f.YK||(f.YK={}))[N.Round=0]="Round",N[N.Bevel=1]="Bevel",N[N.Miter=2]="Miter",N[N.Square=3]="Square";var u=function(){function m(g){this.HA=this.Zb=this.wg=null,this.nd=g}return m.W=function(g,v,w,E,C,R){if(g==null||1>g.Eb())throw f.i.O();return v==0||g.B()?g:((R=new m(R)).lo=g,R.La=v,R.ra=C,R.Li=w,R.wA=E,R.Px())},m.prototype.XL=function(){var g=this.lo,v=g.ac(),w=g.xc(),E=new f.h;return E.vc(w,v),E.normalize(),E.Iv(),E.scale(this.La),v.add(E),w.add(E),E=g.Ja(),g.Ec(v),g.Rc(w),E},m.prototype.WL=function(){var g=this.lo;if(0<this.La&&this.Li!=2){var v=new f.Ea;return v.bd(g,!1),this.lo=v,this.Px()}return(g=new f.Gh(g.aa)).X(this.La,this.La),g},m.prototype.lJ=function(g,v,w,E){return(v.x-g.x)*(E.x-w.x)+(v.y-g.y)*(E.y-w.y)},m.prototype.hc=function(g,v){if(v===void 0)this.Zb.push(g),this.gf++;else if(this.gf==0)this.hc(g);else{var w=this.Cw,E=this.wg[v==0?w-1:v-1],C=this.wg[v],R=this.lJ(E,C,this.Zb[this.gf-1],g);0<R?this.hc(g):0>R&&(0<this.lJ(E,C,C,this.Zb[this.gf-1])?(C=this.wg[v==0?w-2:v==1?w-1:v-2],w=o.Qd(E,this.La,Math.atan2(E.y-C.y,E.x-C.x)-h),this.Zb[this.gf-1]=w,this.Li==1||this.Li==2?(w=o.Ru(w,E),this.hc(w),w=o.Qd(E,this.La,this.Kv+h),(E=o.Ru(w,E)).type|=256,this.hc(E)):(w=o.Qd(E,this.La,this.Kv+h)).type|=256,this.hc(w),this.hc(g,v)):(w=o.Qd(C,this.La,this.Kv+h),this.hc(w),this.Li==1||this.Li==2?(w=o.Ru(w,C),this.hc(w),w=o.Qd(C,this.La,this.Wz-h),(E=o.Ru(w,C)).type|=256,this.hc(E)):(w=o.Qd(C,this.La,this.Wz-h)).type|=256,this.hc(w)))}},m.prototype.eE=function(){var g,v=this.Cw;this.gf=0;var w=.5*this.ra,E=0,C=0;for(g=0;g<v;g++){var R=this.wg[g],I=g==0?this.wg[v-1]:this.wg[g-1],F=g==v-1?this.wg[0]:this.wg[g+1],U=I.x-R.x,j=I.y-R.y,ee=F.x-R.x,te=F.y-R.y,Z=Math.atan2(j,U),le=Math.atan2(te,ee);if(this.Kv=Z,this.Wz=le,g==0&&(E=Z,C=le),U=U*te-ee*j,j=le,le<Z&&(le+=d),0<U*this.La)this.Li==1||this.Li==2?(Z=o.Qd(R,this.La,Z+h),this.hc(Z),Z=o.LE(R,Z),this.hc(Z),Z=o.Qd(R,this.La,le-h),(R=o.LE(R,Z)).type|=256,this.hc(R),this.hc(Z)):(U=.5*(le-Z),U=this.La/Math.abs(Math.sin(U)),Z=o.Qd(R,U,.5*(Z+le)),this.hc(Z,g));else if((512&R.type)!=0){for(U=1-w/Math.abs(this.La),I=1,F=0>this.La?-T:T,-1<U&&1>U&&(.017453292519943295>(j=2*Math.acos(U))&&(j=.017453292519943295),1<(I=f.P.truncate(T/j+1.5))&&(F/=I)),j=Z+h,Z=o.Qd(R,this.La,j),g==0&&(Z.type|=1024),this.hc(Z,g),U=this.La/Math.cos(F/2),j+=F/2,(Z=o.Qd(R,U,j)).type|=1024,this.hc(Z);0<--I;)j+=F,(Z=o.Qd(R,U,j)).type|=1024,this.hc(Z);(Z=o.Qd(R,this.La,le-h)).type|=1024,this.hc(Z)}else if(this.Li==1)Z=o.Qd(R,this.La,Z+h),this.hc(Z,g),Z=o.Qd(R,this.La,le-h),this.hc(Z);else if(this.Li==0)for(U=1-w/Math.abs(this.La),I=1,F=le-h-(Z+h),-1<U&&1>U&&(.017453292519943295>(j=2*Math.acos(U))&&(j=.017453292519943295),1<(I=f.P.truncate(Math.abs(F)/j+1.5))&&(F/=I)),U=this.La/Math.cos(.5*F),j=Z+h+.5*F,Z=o.Qd(R,U,j),this.hc(Z,g);0<--I;)j+=F,Z=o.Qd(R,U,j),this.hc(Z);else this.Li==2?(U=I.x-R.x,j=I.y-R.y,.99999999<(I=(U*(ee=F.x-R.x)+j*(te=F.y-R.y))/Math.sqrt(U*U+j*j)/Math.sqrt(ee*ee+te*te))?(Z=o.Qd(R,1.4142135623730951*this.La,le-.25*T),this.hc(Z,g),Z=o.Qd(R,1.4142135623730951*this.La,le+.25*T),this.hc(Z)):(I=Math.abs(this.La/Math.sin(.5*Math.acos(I))))>(F=Math.abs(this.wA*this.La))?(U=.5*(le-Z),U=this.La/Math.abs(Math.sin(U)),Z=o.Qd(R,U,.5*(Z+le)),le=f.h.construct(Z.x,Z.y),Z=f.h.construct(R.x,R.y),(R=new f.h).vc(le,Z),(le=new f.h).wW(F/R.length(),R,Z),Z=(I-F)*Math.abs(this.La)/Math.sqrt(I*I-this.La*this.La),0<this.La?R.Iv():R.cr(),R.scale(Z/R.length()),(Z=new f.h).add(le,R),(I=new f.h).vc(le,R),Z=o.bl(Z),this.hc(Z,g),Z=o.bl(I),this.hc(Z)):(U=.5*(le-Z),U=this.La/Math.abs(Math.sin(U)),Z=o.Qd(R,U,.5*(Z+le)),this.hc(Z,g))):(le=j,0<this.La?(le>Z&&(le-=d),I=Z-le<h):(le<Z&&(le+=d),I=le-Z<h),I?(j=0>(U=1.4142135623730951*this.La)?Z+.25*T:Z+.75*T,Z=o.Qd(R,U,j),this.hc(Z,g),j=0>U?le-.25*T:le-.75*T,Z=o.Qd(R,U,j),this.hc(Z)):(U=.5*(le-Z),U=this.La/Math.abs(Math.sin(U)),le<Z&&(le+=d),Z=o.Qd(R,U,(Z+le)/2),this.hc(Z,g)))}return this.Kv=E,this.Wz=C,this.hc(this.Zb[0],0),R=o.KO(this.Zb[this.gf-1]),this.Zb[0]=R,this.mW()},m.prototype.Bu=function(g,v){if(!(2>v))for(var w=0;w<v;w++){var E=this.Zb[g+w];w!=0?this.HA.Di(f.h.construct(E.x,E.y)):this.HA.Mt(f.h.construct(E.x,E.y))}},m.prototype.YL=function(g,v,w){var E=g.Ca(v),C=g.Wc(v);if(this.Zb=[],this.HA=w,g.ec(v)){for(v=g.Oa(E);g.Oa(C-1).rb(v);)C--;if(2<=C-E){for(this.Cw=C-E,this.wg=[],v=E;v<C;v++)this.wg.push(o.bl(g.Oa(v)));this.eE()&&this.Bu(0,this.gf-1)}}else{for(v=g.Oa(E);E<C&&g.Oa(E+1).rb(v);)E++;for(v=g.Oa(C-1);E<C&&g.Oa(C-2).rb(v);)C--;if(2<=C-E){for(this.Cw=2*(C-E)-2,this.wg=[],(w=o.bl(g.Oa(E))).type|=1536,this.wg.push(w),v=E+1;v<C-1;v++)w=o.bl(g.Oa(v)),this.wg.push(w);for((w=o.bl(g.Oa(C-1))).type|=512,this.wg.push(w),v=C-2;v>=E+1;v--)(w=o.bl(g.Oa(v))).type|=1024,this.wg.push(w);if(this.eE())if(2<=this.Zb.length){for(g=-1,(C=(1024&this.Zb[this.gf-1].type)!=0)||(g=0),v=1;v<this.gf;v++)(E=(1024&this.Zb[v].type)!=0)?C||1<(C=v-1)-g+1&&this.Bu(g,C-g+1):C&&(g=v-1),C=E;C||1<(C=this.gf-1)-g+1&&this.Bu(g,C-g+1)}else g=0,C=this.gf-1,0<=g&&1<=C-g&&this.Bu(g,C-g+1)}}this.wg=null,this.Cw=0,this.Zb=null,this.gf=0},m.prototype.mW=function(){for(var g=!1,v=0;v<this.gf;v++){var w=this.Zb[v];w.rh=v+1,w.th=v-1,this.Zb[v]=w}for((w=this.Zb[0]).th=this.gf-2,this.Zb[0]=w,(w=this.Zb[this.gf-2]).rh=0,this.Zb[this.gf-2]=w,v=w=0;v<this.gf;v++)if((256&this.Zb[w].type)!=0){var E=this.yP(w);if(E==-1){g=!0;break}w=E}else w=this.Zb[w].rh;return!g&&(this.IO(w),!0)},m.prototype.yP=function(g){for(var v,w,E=this.gf-1,C=g,R=1;R<=E-2;R++){v=C=this.Zb[C].rh,w=g;for(var I=1;I<=R;I++){if(w=this.Zb[w].th,(256&this.Zb[w].type)==0&&(256&this.Zb[v].type)==0){var F=this.YR(w,v);if(F!=-1)return F}v=this.Zb[v].th}}return-1},m.prototype.YR=function(g,v){var w=this.Zb[this.Zb[g].th],E=this.Zb[g],C=this.Zb[this.Zb[v].th],R=this.Zb[v];if(!this.yW(w,E,C,R))return-1;var I=new c;return this.pQ(w,E,C,R,I)&&!I.UD&&f.P.UJ((E.x-w.x)*(R.y-C.y)-(E.y-w.y)*(R.x-C.x))!=f.P.UJ(this.La)?(w=this.Zb[g].th,I.cn.type=E.type,I.cn.rh=v,I.cn.th=w,this.Zb[g]=I.cn,I.cn=this.Zb[v],I.cn.th=g,this.Zb[v]=I.cn,v):-1},m.prototype.yW=function(g,v,w,E){return Math.max(g.x,v.x)>=Math.min(w.x,E.x)&&Math.max(w.x,E.x)>=Math.min(g.x,v.x)&&Math.max(g.y,v.y)>=Math.min(w.y,E.y)&&Math.max(w.y,E.y)>=Math.min(g.y,v.y)},m.prototype.pQ=function(g,v,w,E,C){C.UD=!1;var R=(v.y-g.y)*(E.x-w.x)-(v.x-g.x)*(E.y-w.y),I=(w.y-g.y)*(v.x-g.x)-(w.x-g.x)*(v.y-g.y);if(0<=(R=R==0?2:I/R)&&1>=R){var F=R;if(R=(E.y-w.y)*(v.x-g.x)-(E.x-w.x)*(v.y-g.y),I=(g.y-w.y)*(E.x-w.x)-(g.x-w.x)*(E.y-w.y),0<=(R=R==0?2:I/R)&&1>=R)return C.cn=o.LO(g.x+R*(v.x-g.x),g.y+R*(v.y-g.y)),C.cn.Vh=w.Vh+F*(E.Vh-w.Vh),F!=0&&F!=1||R!=0&&R!=1||(C.UD=!0),C.KY=R,C.LY=F,!((F==0||F==1)&&0<R&&1>R||(R==0||R==1)&&0<F&&1>F)}return!1},m.prototype.IO=function(g){for(;this.Zb[g].th<g;)g=this.Zb[g].th;var v=0,w=g;do w=this.Zb[w],this.Zb[v]=w,w=w.rh,v++;while(w!=g);this.Zb[v]=this.Zb[0],this.gf=v+1},m.prototype.SC=function(g){var v=this.lo,w=v.Ha();if(w!=null){w.$i();for(var E=-1;w.ab();)E++,this.YL(v,E,g)}},m.prototype.Px=function(){var g=this.lo.K();return g==322?this.XL():g==197?this.WL():f.ba.zd(g)?((g=new f.Ua).oc(this.lo,!0),this.lo=g,this.Px()):g==1607?(g=new f.Ua,this.SC(g),g):g==1736?(g=new f.Ea,this.SC(g),g):null},m}();f.AK=u}(ae||(ae={})),function(f){var N=function(){function o(c){this.qk=c}return o.prototype.D=function(c,u){this.qk.g.D(c,u)},o.prototype.wd=function(c){var u=this.qk.Ga.ka(c);this.qk.Ga.wd(c,-1),this.qk.g.pd(u,!1)},o}(),T=function(){function o(c){this.qk=c}return o.prototype.D=function(c,u){this.qk.yT.D(c,u)},o.prototype.wd=function(c){this.qk.Ga.wd(c,-1)},o}(),d=function(){function o(c){this.qk=c}return o.prototype.D=function(c,u){u.N(this.qk.BT[c])},o.prototype.wd=function(c){this.qk.Ga.wd(c,-1)},o}(),h=function(){function o(c){c===void 0?(this.Ga=new f.Yj,this.Ga.Ee(20),this.g=new f.hd,this.mT=this.g.Kg(550),this.Ts=this.g.wf(this.mT,-1),this.Yh=new N(this)):c instanceof Array?(this.Ga=new f.Yj,this.Ga.Ee(20),this.BT=c,this.Yh=new d(this)):(this.Ga=new f.Yj,this.Ga.Ee(20),this.yT=c,this.Yh=new T(this))}return o.prototype.Ib=function(c){var u=c.K();if(f.Ex.yj(u))this.bN(c);else if(f.Vk.zd(u))this.gN(c);else if(u==197)this.ZM(c);else{if(u!=33)throw f.i.O("invalid shape type");this.fN(c)}},o.prototype.VQ=function(){var c=new f.Ta,u=this.Ga.sc(-1),m=new f.Ea(this.g.ht);for(this.g.Wi(this.Ga.ka(u),c),m.nf(c),u=this.Ga.lb(u);u!=-1;u=this.Ga.lb(u))this.g.Wi(this.Ga.ka(u),c),m.lineTo(c);return m},o.JO=function(c){var u=new o(c),m=c.I(),g=1,v=new f.h,w=new f.h,E=new f.h;for(c.D(0,v);c.D(g,w),w.Mz(v)&&g<m-1;)g++;for(u.Ga.addElement(0,-1),u.Ga.yn(g),m=g+1;m<c.I();m++)c.D(m,E),(g=u.iC(E))!=-1&&u.Ga.Tj(g,m);for(E=new f.Ta,g=u.Ga.sc(-1),m=new f.Ea(c.description),c.we(u.Ga.ka(g),E),m.nf(E),g=u.Ga.lb(g);g!=-1;g=u.Ga.lb(g))c.we(u.Ga.ka(g),E),m.lineTo(E);return m},o.construct=function(c,u,m){for(var g=new o(c),v=1,w=c[0];c[v].Mz(w)&&v<u-1;)v++;for(g.Ga.addElement(0,-1),g.Ga.yn(v),v+=1;v<u;v++)(w=g.iC(c[v]))!=-1&&g.Ga.Tj(w,v);for(c=0,u=g.Ga.sc(-1);u!=-1;u=g.Ga.lb(u))m[c++]=g.Ga.ka(u);return c},o.BG=function(c,u){var m=c.Ca(u),g=c.Wc(u);if(u=!c.ec(u)&&c.On(u),c=c.vb(0),g*=2,u&&(g-=2),6>g-(m*=2))return!0;u=new f.h;var v=new f.h,w=new f.h;c.uc(m,u),c.uc(m+2,v),c.uc(m+4,w);var E=o.Xu(v,w,u);if(E.qs()||!o.wm(E.value()))return!1;var C=f.h.construct(v.x,v.y),R=new f.h;for(m+=6;m<g;m+=2)if(R.N(v),v.N(w),c.uc(m,w),(E=o.Xu(v,w,u)).qs()||!o.wm(E.value())||(E=o.Xu(C,w,u)).qs()||!o.wm(E.value())||(E=o.Xu(v,w,R)).qs()||!o.wm(E.value()))return!1;return!0},o.prototype.bN=function(c){for(var u=new f.Ta,m=new f.h,g=0;g<c.I();g++){c.D(g,m);var v=this.Er(m);if(v!=-1){c.we(g,u);var w=this.g.hc(this.Ts,u);this.Ga.Tj(v,w)}}},o.prototype.ZM=function(c){for(var u=new f.Ta,m=new f.h,g=0;4>g;g++){c.gB(g,m);var v=this.Er(m);if(v!=-1){c.If(g,u);var w=this.g.hc(this.Ts,u);this.Ga.Tj(v,w)}}},o.prototype.gN=function(c){var u=new f.Ta,m=c.ac();if((m=this.Er(m))!=-1){c.Uo(u);var g=this.g.hc(this.Ts,u);this.Ga.Tj(m,g)}m=c.xc(),(m=this.Er(m))!=-1&&(c.Qo(u),c=this.g.hc(this.Ts,u),this.Ga.Tj(m,c))},o.prototype.fN=function(c){var u=c.D();(u=this.Er(u))!=-1&&(c=this.g.hc(this.Ts,c),this.Ga.Tj(u,c))},o.prototype.Er=function(c){var u=-1;if(this.Ga.size(-1)==0)return this.Ga.addElement(-4,-1);if(this.Ga.size(-1)==1){var m=this.g.Oa(this.Ga.ka(this.Ga.sc(-1)));return c.Mz(m)||(u=this.Ga.yn(-5)),u}return this.iC(c)},o.prototype.iC=function(c){var u=-1;do{var m=this.Ga.sc(-1),g=this.Ga.Gc(-1),v=this.Ga.ka(m),w=this.Ga.ka(g),E=new f.h,C=new f.h;if(this.Yh.D(v,E),this.Yh.D(w,C),v=f.h.Wq(C,c,E),o.wm(v))u=this.Ga.yn(-1),(E=this.gC(c,g,m))!=m&&this.hC(c,m,this.Ga.xe(E));else if(o.uG(v)){C=this.Ga.tv(-1);var R=this.Ga.sc(-1),I=this.Ga.Gc(-1);for(v=new f.h,w=new f.h;R!=this.Ga.xe(I);){var F=this.Ga.ka(C);this.Yh.D(F,v),F=f.h.Wq(v,c,E),o.uG(F)?(I=C,C=this.Ga.nl(C)):(R=C,C=this.Ga.Zp(C))}if(C=I,E=R,F=this.Ga.ka(C),R=this.Ga.ka(E),this.Yh.D(F,v),this.Yh.D(R,w),E!=m&&(v=f.h.Wq(w,c,v),!o.wm(v)))continue;u=this.Ga.Au(E,C,-2,!1),this.hC(c,C,g),this.gC(c,E,m)}else this.tb==null&&(this.tb=new f.zb),this.tb.Ec(C),this.tb.Rc(E),0>(E=this.tb.fe(c,!0))?(E=this.Ga.xe(g),this.Ga.wd(g,-1),u=this.Ga.yn(-3),this.gC(c,E,m)):1<E&&(E=this.Ga.lb(m),this.Ga.wd(m,-1),u=this.Ga.Au(-1,E,-3,!1),this.hC(c,E,g))}while(0);return u},o.prototype.hC=function(c,u,m){if(u!=m){var g=this.Ga.ka(u),v=this.Ga.lb(u),w=new f.h,E=new f.h;for(this.Yh.D(g,w);u!=m&&2<this.Ga.size(-1)&&(this.Yh.D(this.Ga.ka(v),E),g=f.h.Wq(E,c,w),!o.wm(g));)g=u,u=v,w.N(E),v=this.Ga.lb(u),this.Yh.wd(g)}},o.prototype.gC=function(c,u,m){if(u==m)return m;var g=this.Ga.ka(u),v=this.Ga.xe(u),w=new f.h,E=new f.h;for(this.Yh.D(g,w);u!=m&&2<this.Ga.size(-1)&&(this.Yh.D(this.Ga.ka(v),E),g=f.h.Wq(w,c,E),!o.wm(g));)g=u,u=v,w.N(E),v=this.Ga.xe(u),this.Yh.wd(g);return u},o.Xu=function(c,u,m){var g=new f.Xb;g.set(u.x),g.sub(c.x);var v=new f.Xb;v.set(m.y),v.sub(c.y);var w=new f.Xb;return w.set(u.y),w.sub(c.y),(u=new f.Xb).set(m.x),u.sub(c.x),g.Ag(v),w.Ag(u),g.sub(w),g},o.wm=function(c){return 0>c},o.uG=function(c){return 0<c},o}();f.$t=h}(ae||(ae={})),function(f){var N=function(){function T(d){this.g=null,this.lH=!0,this.nd=d}return T.pU=function(d,h,o){return d=f.ta.Gr(d),f.Zt.Dv(h.Mg(),h.jh(),o.Mg(),o.jh(),f.mc.nx(d))},T.uO=function(d,h){var o=new f.Ta;return f.Zt.MT(d,h,o),o},T.W=function(d,h,o,c){return(o=new T(o)).g=d,o.ra=h,o.lH=c,o.wM()},T.prototype.fM=function(d){return f.Zt.aQ(this.g,d)},T.prototype.kM=function(d){return f.au.W(this.g,d,this.nd)},T.prototype.wM=function(){var d=this.ra,h=f.ta.Gr(d),o=1.00001*(d=f.ta.jN(d));d*=1.000001;for(var c=!1,u=30<this.g.gd+10?1e3:(this.g.gd+10)*(this.g.gd+10),m=0,g=this.g.aS();;m++){if(m>u)throw f.i.ga("Internal Error: max number of iterations exceeded");var v=this.fM(h);if(c=c||v,this.lH&&(v=this.g.Ip(h,!0,!1)!=0,c=c||v),v=!1,(m==0||g||f.au.cI(!0,this.g,d,null,this.nd))&&(v=this.kM(o),c=c||v),!v)break;f.np.Bp(this.nd)}return c},T}();f.Tk=N}(ae||(ae={})),function(f){var N=function(){function d(h){this.ae=this.Nc=null,this.Zs=0,this.Vb=h,this.Yz=!0}return d.prototype.vv=function(h,o){var c=this.g.cc(h);if(c==null){if(!this.g.fd(h,o))return null;c=o}return c},d.prototype.Zq=function(){var h;h===void 0&&(h=!1),this.Zs++,(h||(4095&this.Zs)==0)&&(this.Zs=0,f.np.Bp(this.Vb))},d.prototype.fP=function(){var h=this.g.$q(!1),o=!1,c=new f.zb,u=new f.zb,m=new f.l;m.Pa();var g=new f.l;g.Pa();for(var v=new f.Ta,w=new f.LC,E=h.next();E!=-1;E=h.next()){f.np.Bp(this.Vb);var C=null,R=!1;if(!f.ba.Sn(this.g.jc(h.ck))){if((C=this.vv(E,c))==null)continue;if(C.A(m),m.X(this.ra,this.ra),C.Ci(this.ra)){if(!C.Ci(0))continue;R=!0,C=null}}var I=this.g.$q(h),F=I.next();for(F!=-1&&(F=I.next());F!=-1;F=I.next()){var U=null,j=!1;if(!f.ba.Sn(this.g.jc(I.ck))){if((U=this.vv(F,u))==null)continue;if(U.A(g),U.Ci(this.ra)){if(!U.Ci(0))continue;j=!0,U=null}}var ee=0,te=0;if(C!=null&&U!=null)m.zG(g)&&(w.Po(C),w.Po(U),w.Fa(this.ra,!1),0<(ee=w.ql(0))+(te=w.ql(1))&&(this.g.lr(E,w,0,!0),this.g.lr(F,w,1,!0)),w.clear());else if(C!=null){var Z=new f.h;if(this.g.D(F,Z),m.contains(Z)){if(w.Po(C),this.g.Wi(F,v),w.Fz(this.ra,v,!1),0<(ee=w.ql(0)))if(this.g.lr(E,w,0,!0),j){for(j=-1,Z=this.g.V(F);Z!=-1&&Z!=F&&(j=Z,(U=this.vv(Z,u))!=null&&U.Ci(0));Z=this.g.V(Z));for(Z=F;Z!=-1&&(this.g.Eh(Z,w.Cf),Z!=j);Z=this.g.V(Z));}else this.g.Eh(F,w.Cf);w.clear()}}else{if(U==null)continue;if(Z=new f.h,this.g.D(E,Z),g.X(this.ra,this.ra),g.contains(Z)){if(w.Po(U),this.g.Wi(E,v),w.Fz(this.ra,v,!1),0<(te=w.ql(0)))if(this.g.lr(F,w,0,!0),R){for(j=-1,Z=this.g.V(E);Z!=-1&&Z!=E&&(j=Z,(U=this.vv(Z,u))!=null&&U.Ci(0));Z=this.g.V(Z));for(Z=E;Z!=-1&&(this.g.Eh(Z,w.Cf),Z!=j);Z=this.g.V(Z));}else this.g.Eh(E,w.Cf);w.clear()}}if(ee+te!=0){if(ee!=0){if((C=this.g.cc(E))==null){if(!this.g.fd(E,c))continue;C=c,c.A(m)}else C.A(m);if(C.Ci(this.ra))break}o=!0}}}return o},d.prototype.gP=function(){return this.GU()},d.prototype.GU=function(){return new f.JC().DX(this.g,this.ra)},d.prototype.dI=function(){var h=!1;this.Nc==null&&(this.Nc=new f.Yj);var o=new f.ja(0);o.Jb(this.g.gd+1);for(var c=this.g.$q(),u=c.next();u!=-1;u=c.next())o.add(u);this.g.mx(o,o.size),o.add(-1),c=this.g.Hd(),u=this.g.Hd(),this.ae=new f.MC(this.g,this.ra,!this.Yz),this.Nc.Wo(this.ae);var m=new f.ja(0),g=new f.ja(0),v=0;new f.h;var w=this.g.ud;this.g.wb.rc();for(var E,C,R=this.g.wb.Aa[0].o,I=o.get(v++);I!=-1;){var F=E=R[2*(C=w.U(I,0))],U=C=R[2*C+1];do{var j=w.U(I,2),ee=w.U(I,1);if(j!=-1){var te=w.U(j,0),Z=R[2*te];0>(U<(te=R[2*te+1])?-1:U>te?1:F<Z?-1:F>Z?1:0)&&(g.add(I),g.add(j))}ee!=-1&&(Z=R[2*(te=w.U(ee,0))],0>(U<(te=R[2*te+1])?-1:U>te?1:F<Z?-1:F>Z?1:0)&&(g.add(ee),g.add(ee))),(Z=this.g.Qa(I,c))!=-1&&(m.add(Z),this.g.Sa(I,c,-1)),(Z=this.g.Qa(I,u))!=-1&&(m.add(Z),this.g.Sa(I,u,-1)),(I=o.get(v++))!==-1&&(F=R[2*(U=w.U(I,0))],U=R[2*U+1])}while(I!=-1&&F===E&&U===C);for(F=m.size==1&&g.size==2,Z=U=-1,j=0,ee=m.size;j<ee;j++){te=m.get(j);var le=this.Nc.xe(te);if(le==-1||m.$F(le)||(U=le),(te=this.Nc.lb(te))==-1||m.$F(te)||(Z=te),U!=-1&&Z!=-1)break}for(this.ae.SJ(C,E),j=0,ee=m.size;j<ee;j++)te=m.get(j),this.Nc.wd(te,-1);if(m.clear(!1),!F&&U!=-1&&Z!=-1&&this.iO(U,Z)){h=!0,this.Oi=this.ae.tm();break}for(j=0,ee=g.size;j<ee;j+=2){if(C=g.get(j),E=g.get(j+1),F?(C=this.Nc.Au(U,Z,C,!0),F=!1):C=this.Nc.addElement(C,-1),this.ae.rg){this.Oi=this.ae.tm(),h=!0;break}this.g.Qa(E,c)==-1?this.g.Sa(E,c,C):this.g.Sa(E,u,C)}if(h)break;g.Ch(0)}return this.g.Ud(c),this.g.Ud(u),h},d.prototype.iO=function(h,o){return this.ae.compare(this.Nc,this.Nc.ka(h),o),h=this.ae.rg,this.ae.Lr(),h},d.qE=function(h){for(var o=h.ld;o!=-1;o=h.ve(o))if(f.ba.Ic(h.jc(o)))return!0;return!1},d.YP=function(h,o,c,u){return!!d.qE(h)&&((o=new d(u)).g=h,o.ra=c,15>h.gd?h=o.fP():o.gP())},d.W=function(h,o,c){return d.YP(h,h.AF(),o,c)},d.cI=function(h,o,c,u,m){if(!d.qE(o))return!1;var g=new d(m);if(g.g=o,g.ra=c,g.Yz=h,g.dI())return u!=null&&u.Xt(g.Oi),!0;var v=new f.Ed;return v.TB(),o.Pc(v),(g=new d(m)).g=o,g.ra=c,g.Yz=h,h=g.dI(),v.TB(),o.Pc(v),!!h&&(u!=null&&u.Xt(g.Oi),!0)},d.Ol=function(h,o){return!(16>(h=h.I()))&&2*h+Math.log(h)*Math.LOG10E/Math.log(2)*o<1*h*o},d.dP=function(h,o,c,u){if(f.ba.Ic(o.K()))return new d(u).eP(h,o,c);throw f.i.ga("crack_A_with_B")},d.prototype.eP=function(h,o,c){var u=new f.l;h.yc(u);var m=new f.l;if(o.yc(m),m.X(c,c),!m.isIntersecting(u))return h;var g=h.Cb,v=null;g!=null&&(v=g.Gb),d.Ol(h,h.I())&&(v=f.ta.kj(h,m));var w=v!=null?v.getIterator():null,E=o.Ha();o=h.Ha();var C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(m=[];E.ab();)for(;E.Ia();){var R=E.ia();if(v!=null){for(w.Vo(R,c),g=w.next();g!=-1;g=w.next())if(this.Zq(),o.Wb(v.ka(g),-1),o.Ia()){var I=(g=o.ia()).Fa(R,null,C,null,c);for(g=0;g<I;++g){var F=C[g];if(F!=0&&F!=1){var U=o.xb(),j=new T;j.t=F,j.index=U,m.push(j)}}}}else{var ee=new f.l;if(R.yc(ee),ee.X(c,c),u.isIntersecting(ee)){for(o.$i();o.ab();)for(;o.Ia();)if(this.Zq(),g=o.ia(),F=new f.l,g.yc(F),F.isIntersecting(ee))for(I=g.Fa(R,null,C,null,c),g=0;g<I;++g)(F=C[g])!=0&&F!=1&&(U=o.xb(),(j=new T).t=F,j.index=U,m.push(j))}}}if(m.length==0)return h;for(m=m.sort(T.yy),h=h.Ja(),o.$i();o.ab()&&!o.Ia(););for(c=o.ia(),u=new f.hg,v=-1,g=0,w=m.length;g<w;){for(C=m[g].index,E=g+1;E<w&&m[E].index==C;)++E;for(;o.xb()<C;){if(this.Zq(),R=o.Ia(),F=o.gb,(ee=R||!o.Pn()||o.Qn())&&h.oc(c,v!=F),v=F,!R)for(;o.ab()&&!o.Ia(););c=o.ia()}for(C=0;g<E;g++)(F=m[g].t)!=C&&(c.bh(C,F,u),C=F,F=o.gb,h.oc(u.get(),v!=F),v=F);if((ee=(R=o.Ia())||!o.Pn()||o.Qn())&&(c.bh(C,1,u),h.oc(u.get(),!1)),R)c=o.ia();else{for(;o.ab()&&!o.Ia(););c=o.Ia()?o.ia():null}g=E}for(c!=null&&(F=o.gb,(ee=(R=o.Ia())||!o.Pn()||o.Qn())&&h.oc(c,v!=F),v=F),R=o.Ia();;){if(!R){for(;o.ab()&&!(R=o.Ia()););if(!R)break}c=o.ia(),F=o.gb,(ee=(R=o.Ia())||!o.Pn()||o.Qn())&&h.oc(c,v!=F),v=F}return h},d}();f.au=N;var T=function(){function d(){}return d.yy=function(h,o){return h.index==o.index?h.t>o.t?1:h.t<o.t?-1:0:h.index>o.index?1:-1},d}()}(ae||(ae={})),function(f){var N;(N=f.CK||(f.CK={}))[N.Left=0]="Left",N[N.Right=1]="Right",N[N.Coincident=2]="Coincident",N[N.Undefined=3]="Undefined",N[N.Uncut=4]="Uncut";var T=function(o,c,u,m,g,v,w,E,C,R,I){this.Y=o,this.bt=c,this.Os=u,this.tg=m,this.Nm=R,this.Cl=I};f.iY=T;var d=function(){function o(c,u){this.BH=c,this.Ii=u}return o.prototype.iM=function(c,u){var m=new f.h;this.Ii.D(c,m);var g=new f.h;return this.Ii.D(u,g),(m=m.compare(g))!=0?m:(c=this.Ii.Qa(c,this.BH))<(u=this.Ii.Qa(u,this.BH))?-1:c==u?0:1},o}(),h=function(o,c,u,m,g,v,w,E,C){this.tg=o,this.Os=c,this.IA=u,this.MH=m,this.Fi=g,this.Cl=v,this.Nm=w,this.NH=E,this.ET=C};f.hY=h,f.DK=function(){function o(){}return o.BK=function(c,u,m,g,v,w){if(u.B())c=new T(u,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),v.push(c);else if(m.B())c=new T(u,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),v.push(c);else{var E=new f.hd;if(E.Ib(u),E.Ib(m),f.Tk.W(E,g,w,!0),E.gd==0)c=new T(u.Ja(),4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),v.push(c);else{for(u=0,m=E.Hd(),g=E.ld;g!=-1;g=E.ve(g))for(w=E.Ob(g);w!=-1;w=E.Sb(w))for(var C=E.Ya(w),R=0,I=E.Ka(w);R<I;C=E.V(C),R++)E.Sa(C,m,u++);u=o.zM(m,E),o.VL(c,u,E,v)}}},o.zM=function(c,u){for(var m=u.gd,g=new f.ja(0),v=u.ld;v!=-1;v=u.ve(v))for(var w=u.Ob(v);w!=-1;w=u.Sb(w))for(var E=u.Ya(w),C=0,R=u.Ka(w);C<R;E=u.V(E),C++)g.add(E);var I=new d(c,u);g.Wd(0,m,function(it,Ke){return I.iM(it,Ke)}),c=[];var F=[],U=u.Hd(),j=u.Hd();v=u.ld,w=u.ve(v),R=new f.h;var ee=new f.h,te=g.get(0),Z=u.cd(te),le=u.Rf(Z);u.D(te,R);var ve=1;for(E=0;ve<m-1;){var be=!1;for(C=ve;C<m;C++)if(C!=E){var ue=g.get(C),Le=u.cd(ue),Be=u.Rf(Le);if(u.D(ue,ee),!R.rb(ee))break;le==v&&Be==w&&(be=o.mM(U,j,u,c,F,Z,te,Le,ue))}if(be||E==ve-1){if(be&&E==ve-1&&ve--,++E==m)break;te=g.get(E),Z=u.cd(te),le=u.Rf(Z),u.D(te,R)}be||(ve=E+1)}for(m=[],v=u.ld;v!=-1;v=u.ve(v))for(w=u.Ob(v);w!=-1;w=u.Sb(w))for(g=u.Ya(w),C=0,R=u.Ka(w);C<R;g=u.V(g),C++){if(0<=(E=u.Qa(g,j)))for(;E<F.length&&F[E].tg==g;)m.push(F[E++]);if(0<=(E=u.Qa(g,U)))for(;E<c.length&&c[E].tg==g;)m.push(c[E++])}return u.Ud(U),u.Ud(j),m},o.mM=function(c,u,m,g,v,w,E,C,R){var I=m.sj(w),F=m.sj(C),U=m.Ya(w),j=m.Ya(C),ee=m.Na(E),te=m.Na(R),Z=!1,le=!1,ve=!1,be=!1;return E!=U&&(R!=j&&(Z=o.nM(c,m,g,w,ee,C,te)),R!=F&&(le=o.oM(c,m,g,w,ee,C,R))),E!=I&&(R!=j&&(ve=o.pM(u,m,v,w,E,C,te,U)),R!=F&&(be=o.qM(u,m,v,w,E,C,R,U))),Z&&le&&ve?(c=g.length-1,v[be?v.length-2:v.length-1].Fi==2&&(g[c-1]=g[c],--g.length)):Z&&le&&be&&v[v.length-1].Fi==2&&(v=g[g.length-1],--g.length,m.Qa(v.tg,c)==g.length&&m.Sa(v.tg,c,-1)),Z||le||ve||be},o.nM=function(c,u,m,g,v,w,E){var C=new f.zb,R=new f.zb,I=[0,0],F=[0,0],U=u.cc(v);return U==null&&(u.fd(v,C),U=C),(C=u.cc(E))==null&&(u.fd(E,R),C=R),2>(U=U.Fa(C,null,I,F,0))&&(g=new h(v,g,I[0],NaN,U,E,w,F[0],NaN),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1)),!0},o.oM=function(c,u,m,g,v,w,E){var C=new f.zb,R=new f.zb,I=[0,0],F=[0,0],U=u.cc(v);return U==null&&(u.fd(v,C),U=C),(C=u.cc(E))==null&&(u.fd(E,R),C=R),2>(U=U.Fa(C,null,I,F,0))&&(g=new h(v,g,I[0],NaN,U,E,w,F[0],NaN),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1),!0)},o.pM=function(c,u,m,g,v,w,E,C){var R=new f.zb,I=new f.zb,F=[0,0],U=[0,0],j=u.cc(v);return j==null&&(u.fd(v,R),j=R),(R=u.cc(E))==null&&(u.fd(E,I),R=I),(j=j.Fa(R,null,F,U,0))==2?(g=new h(v,g,F[0],F[1],j,E,w,U[0],U[1]),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1),!0):(I=!1,v==C&&(g=new h(v,g,F[0],NaN,j,E,w,U[0],NaN),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1),I=!0),I)},o.qM=function(c,u,m,g,v,w,E,C){var R=new f.zb,I=new f.zb,F=[0,0],U=[0,0],j=u.cc(v);return j==null&&(u.fd(v,R),j=R),(R=u.cc(E))==null&&(u.fd(E,I),R=I),(j=j.Fa(R,null,F,U,0))==2?(g=new h(v,g,F[0],F[1],j,E,w,U[0],U[1]),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1),!0):(I=!1,v==C&&(g=new h(v,g,F[0],NaN,j,E,w,U[0],NaN),m.push(g),0>(g=u.Qa(v,c))&&u.Sa(v,c,m.length-1),I=!0),I)},o.VL=function(c,u,m,g){var v=[];v[0]=new f.h,v[1]=new f.h,v[2]=new f.h,v[3]=new f.h;var w=new f.h,E=new f.h,C=new f.h,R=new f.h,I=null;g!=null&&(I=new f.hg).Pr();var F=0,U=null,j=new f.zb;new f.zb;for(var ee=m.Ob(m.ld);ee!=-1;ee=m.Sb(ee)){for(var te=4,Z=-1,le=-1,ve=-1,be=-1,ue=NaN,Le=!0,Be=!1,it=!0,Ke=!0,Je=!0,pt=0,qt=ee,ri=0,Ji=m.Ya(ee),Zi=m.Ka(ee),an=0;an<Zi;Ji=m.V(Ji),an++){var Br=m.cc(Ji);if(Br==null){if(!m.fd(Ji,j))continue;Br=j}le==-1&&(le=Ji);for(var Rt=0;F<u.length&&Ji==u[F].tg;){Z=u[F].Os;var gr=u[F].tg,Ri=u[F].IA,Ps=u[F].Nm,rs=u[F].Cl,Js=u[F].NH;if(u[F].Fi==2){if(Be||(qt=Z,le=gr,ri=Ri,ve=Ps,be=rs,ue=Js,te=2,g!=null?U=new f.Ua:pt=0,Je=!1,Ke=!0),Ri=u[F].MH,Js=u[F].ET,g!=null?(Br.bh(Rt,u[F].MH,I),U.oc(I.get(),Ke)):pt++,Rt=Ri,Be=!0,Ke=Le=!1,F+1==u.length||u[F+1].Fi!=2||u[F+1].tg==gr&&u[F+1].IA!=Rt){if(g!=null){var Xi=new T(U,2,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue);g.push(Xi)}else null.add(pt);qt=Z,le=gr,ri=Ri,ve=Ps,be=rs,ue=Js,te=2,Be=Le=!1,Ke=Je=!0}}else{var Zn=m.V(gr);if(F<u.length-1&&u[F+1].tg==Zn&&u[F+1].Cl==rs&&u[F+1].Fi==2)Ri!=Rt&&(Je&&(g!=null?U=new f.Ua:pt=0),Le=0<F&&u[F-1].Os==Z?te==1?0:te==0?1:3:3,g!=null?(Br.bh(Rt,Ri,I),U.oc(I.get(),Ke),Xi=new T(U,Le,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):(pt++,null.add(pt)),Rt=Ri,qt=Z,le=gr,ri=Ri,ve=Ps,be=rs,ue=Js,te=Le,Le=it=!1,Ke=Je=!0);else if(!o.uM(c,m,u,F,w,E)){o.rM(m,u,F,ee,Ji,C,R);var bi=!1;if(Zn=!1,Xi=!0,!(w.rb(C)||E.rb(C)||w.rb(R)||E.rb(R))){v[0].N(w),v[1].N(E),v[2].N(C),v[3].N(R),v.sort(f.h.ou);var t1=v[0],F0=v[1],i1=v[2],e_=v[3];t1.rb(w)?F0.rb(E)?c?(Zn=bi=!0,Xi=!1):bi=!1:e_.rb(E)?c?Xi=Zn=bi=!0:bi=!1:(bi=!0,Xi=F0.rb(C)):F0.rb(w)?i1.rb(E)?c?(Zn=bi=!0,Xi=!1):bi=!1:t1.rb(E)?c?Xi=Zn=bi=!0:bi=!1:(bi=!0,Xi=i1.rb(C)):i1.rb(w)?e_.rb(E)?c?(Zn=bi=!0,Xi=!1):bi=!1:F0.rb(E)?c?Xi=Zn=bi=!0:bi=!1:(bi=!0,Xi=e_.rb(C)):t1.rb(E)?c?(Zn=bi=!0,Xi=!1):bi=!1:i1.rb(E)?c?Xi=Zn=bi=!0:bi=!1:(bi=!0,Xi=t1.rb(C))}bi&&(bi=Ji==gr,(Ri!=Rt||bi&&Rt==0)&&(Je&&(g!=null?U=new f.Ua:pt=0),g!=null?(Br.bh(Rt,Ri,I),U.oc(I.get(),Ke)):pt++),Xi?te!=1?((Ri!=Rt||bi&&Rt==0)&&(g!=null?(Xi=new T(U,1,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt)),Zn?(F>=u.length-2||u[F+2].Os!=Z)&&(te=0):te=1):((Ri!=Rt||bi&&Rt==0)&&(g!=null?(Xi=new T(U,3,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt)),te=1):te!=0?((Ri!=Rt||bi&&Rt==0)&&(g!=null?(Xi=new T(U,0,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt)),Zn?(F>=u.length-2||u[F+2].Os!=Z)&&(te=1):te=0):((Ri!=Rt||bi&&Rt==0)&&(g!=null?(Xi=new T(U,3,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt)),te=0),(Ri!=Rt||bi&&Rt==0)&&(Rt=Ri,qt=Z,le=gr,ri=Ri,ve=Ps,be=rs,ue=Js,Le=it=!1,Ke=Je=!0))}}F++}Rt!=1&&(Je&&(g!=null?U=new f.Ua:pt=0),g!=null?(Br.bh(Rt,1,I),U.oc(I.get(),Ke)):pt++,Ke=Je=!1,it=!0)}it&&(Ri=1,gr=m.sj(ee),gr=m.Na(gr),rs=Ps=-1,Js=NaN,Le?g!=null?(Xi=new T(U,4,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt):(Le=te==1?0:te==0?1:3,g!=null?(Xi=new T(U,Le,Z,gr,Ri,te,qt,le,ri,Ps,rs,Js,ve,be,ue),g.push(Xi)):null.add(pt)))}},o.uM=function(c,u,m,g,v,w){var E=m[g].NH;if(E==1)return o.sM(c,u,m,g,v,w);if(E==0)return o.tM(c,u,m,g,v,w);throw f.i.Ra()},o.sM=function(c,u,m,g,v,w){var E=new f.zb,C=m[g].tg,R=m[g].Nm,I=m[g].Cl,F=-1,U=-1,j=-1,ee=-1;if(!c&&0<g){var te=m[g-1];F=te.tg,U=te.Nm,j=te.Cl,ee=te.Fi}var Z=-1,le=-1,ve=-1,be=-1;g<m.length-1&&(Z=(te=m[g+1]).tg,le=te.Nm,ve=te.Cl,be=te.Fi);var ue=u.V(C);return te=u.V(I),c?g==m.length-1||Z!=C||le!=R||ve!=te||be==2?((c=u.cc(I))==null&&(u.fd(I,E),c=E),w.N(c.jg()),v.mt(w),w.normalize(),v.normalize(),!1):((c=u.cc(I))==null&&(u.fd(I,E),c=E),v.N(c.jg()),(c=u.cc(te))==null&&(u.fd(te,E),c=E),w.N(c.jg()),v.Uq(),w.normalize(),v.normalize(),!1):0<g&&F==C&&U==R&&j==te&&ee==2||g<m.length-1&&Z==ue&&le==R&&ve==te&&be==2?((c=u.cc(I))==null&&(u.fd(I,E),c=E),w.N(c.jg()),v.mt(w),w.normalize(),v.normalize(),!1):!(g<m.length-1&&Z==C&&le==R&&ve==te)||((c=u.cc(I))==null&&(u.fd(I,E),c=E),v.N(c.jg()),(c=u.cc(te))==null&&(u.fd(te,E),c=E),w.N(c.jg()),v.Uq(),w.normalize(),v.normalize(),!1)},o.tM=function(c,u,m,g,v,w){var E=new f.zb,C=m[g].tg,R=m[g].Nm,I=m[g].Cl,F=-1,U=-1,j=-1,ee=-1;if(!c&&g<m.length-1){var te=m[g+1];F=te.tg,U=te.Nm,j=te.Cl,ee=te.Fi}var Z=-1,le=-1,ve=-1;te=-1,0<g&&(Z=(te=m[g-1]).tg,le=te.Nm,ve=te.Cl,te=te.Fi);var be=u.V(C),ue=u.Na(I);return c?g!=0&&Z==C&&le==R&&ve==ue&&te!=2||((c=u.cc(I))==null&&(u.fd(I,E),c=E),w.N(c.jg()),v.mt(w),w.normalize(),v.normalize(),!1):!(0<g&&Z==C&&le==R&&ve==ue&&te==2||g<m.length-1&&F==be&&U==R&&j==ue&&ee==2)||((c=u.cc(I))==null&&(u.fd(I,E),c=E),w.N(c.jg()),v.mt(w),w.normalize(),v.normalize(),!1)},o.rM=function(c,u,m,g,v,w,E){var C=new f.zb,R=c.cc(v);if(R==null&&(c.fd(v,C),R=C),u=(m=u[m]).tg,m=m.IA,v=c.V(u),m==1)w.N(R.jg()),v!=-1&&v!=c.sj(g)?((R=c.cc(v))==null&&(c.fd(v,C),R=C),E.N(R.jg()),(R=c.cc(u))==null&&c.fd(u,C)):E.N(w),w.Uq(),E.normalize(),w.normalize();else{if(m!=0)throw f.i.Ra();E.N(R.jg()),w.mt(E),E.normalize(),w.normalize()}},o}()}(ae||(ae={})),function(f){var N;(N=f.UL||(f.UL={}))[N.Linear=0]="Linear",N[N.Angular=1]="Angular",N[N.Area=2]="Area";var T=function(){function g(v,w,E){this.od=w,this.bi=E,this.pA=v}return g.prototype.Nb=function(v){return v instanceof g&&this.bi===v.bi},g.TF=function(v){return v.od!==0?null:v.pA===-1?new g(-1,2,v.bi*v.bi):g.$g(u[v.pA])},g.$g=function(v){return(v=c[v])===void 0?null:v},g.RO=function(v,w,E){var C=null;if(E!=null)try{E.values[0]==="EPSG"&&(C=g.$g(parseInt(E.values[1])))}catch{}return C===null&&(C=new g(-1,v,w)),C},g.prototype.Fc=function(){return this.pA},g.prototype.uF=function(v){if(v.od!=this.od)throw f.i.Hb();return this.bi/v.bi},g.Oh=function(v,w,E){return w.uF(E)*v},g.PE=function(v,w,E,C,R){for(E=E.uF(C),C=0;C<w;C++)R[C]=v[C]*E},g}();f.Uc=T;for(var d=[109401,1e4,109402,4046.8564224,109403,4046.87260987425,109404,1,109405,.09290304,109406,.09290341161327487,109407,.09290137299531805,109408,3.34450944,109409,3429904,109410,1.000027193184865,109411,404.6872609874253,109412,.04046872609874253,109413,2.5899984703195216e6,109414,1e6,109415,.8361123569578626,109416,404.67838076760535,109417,.04046783807676053,109418,.8361244606523066,109419,.09290271785025629,109420,404.68423895571647,109421,.04046842389557164,109422,.83612589696064,109423,.0929028774400711,109424,404.6849341289498,109425,.04046849341289498,109426,.836125904805842,109427,.09290287831176021,109428,404.68493792602754,109429,.04046849379260275,109430,.09290354800069446,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109435,.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,109439,2589988110336e-6,109440,.09290286332673177,109441,.09290349665192114,109442,.83612736,109443,.8361307045194736,109444,404.68564224000005,109445,.04046856422400001,109446,.8361237024040001,109447,.0929026336004445,109448,404.683871963536,109449,.0404683871963536,109450,.01,109451,1e-4,109452,1e-6,109453,64516e-8,109454,.0006451625806477421,109455,25.292852640000003,109456,25.29295381171408,109457,3.4345281495040003e6,109458,3434290937856e-6,109459,2.89612324,109460,25e8,109461,225e8,109462,.7168473118308245,109463,100,109464,1244521604938272e-22,109465,1e-12,109466,1e-18],h=[1031,484813681109536e-23,9101,1,9102,.0174532925199433,9103,.0002908882086657216,9104,484813681109536e-20,9105,.01570796326794897,9106,.01570796326794897,9109,1e-6,9112,.0001570796326794897,9113,1570796326794897e-21,9114,.0009817477042468104],o=[1025,.001,109452,1033,.01,109451,9001,1,109404,9002,.3048,109405,9003,.3048006096012192,109406,9005,.3047972654,109407,9014,1.8288,109408,9030,1852,109409,9031,1.0000135965,109410,9033,20.11684023368047,109411,9034,.2011684023368047,109412,9035,1609.3472186944375,109413,9036,1e3,109414,9037,.9143917962000001,109415,9038,20.1166195164,109416,9039,.201166195164,109417,9040,.9143984146160287,109418,9041,.304799471538676,109419,9042,20.116765121552632,109420,9043,.2011676512155263,109421,9050,.9143992,109422,9051,.3047997333333333,109423,9052,20.1167824,109424,9053,.201167824,109425,9060,.9143992042898124,109426,9061,.3047997347632708,109427,9062,20.116782494375872,109428,9063,.2011678249437587,109429,9070,.3048008333333334,109430,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9093,1609.344,109439,9094,.3047997101815088,109440,9095,.3048007491,109441,9096,.9144,109442,9097,20.1168,109444,9098,.201168,109445,9099,.914398,109446,9300,.3047993333333334,109447,9301,20.116756,109448,9302,.20116756,109449,109001,.9144,109442,109002,.9144018288036576,109443,109003,20.1168,109444,109004,.201168,109445,109005,.1,109450,109006,.01,109451,109007,.001,109452,109008,.0254,109453,109009,.0254000508001016,109454,109010,5.0292,109455,109011,5.029210058420118,109456,109012,1853.248,109457,109013,1853.184,109458,109014,1.7018,109459,109015,.8466683600033867,109462,109016,.0003527777777777778,109464,109017,1e-6,109465,109018,1e-9,109466,109030,5e4,109460,109031,15e4,109461],c=[],u=[],m=0;m<d.length;m+=2)c[d[m]]=new T(d[m],2,d[m+1]);for(d=null,m=0;m<h.length;m+=2)c[h[m]]=new T(h[m],1,h[m+1]);for(h=null,m=0;m<o.length;m+=3)c[o[m]]=new T(o[m],0,o[m+1]),u[o[m]]=o[m+2];o=null}(ae||(ae={})),function(f){var N=function(){function T(){this.yb=this.pb=0}return T.prototype.set=function(d,h){h!==void 0?(this.pb=d,this.yb=h):typeof d=="number"?(this.pb=d,this.yb=0):(this.pb=d.pb,this.yb=d.yb)},T.prototype.value=function(){return this.pb},T.prototype.add=function(d){var h=this.pb+d.pb;d=this.yb+d.yb+2220446049250313e-31*Math.abs(h),this.pb=h,this.yb=d},T.prototype.cN=function(){var d=this.pb+1,h=this.yb+2220446049250313e-31*Math.abs(d);this.pb=d,this.yb=h},T.prototype.WM=function(d,h){this.pb=d.pb+h.pb,this.yb=d.yb+h.yb+2220446049250313e-31*Math.abs(this.pb)},T.prototype.sub=function(d){if(typeof d=="number"){var h=this.pb-d;d=this.yb+2220446049250313e-31*Math.abs(h)}else h=this.pb-d.pb,d=this.yb+d.yb+2220446049250313e-31*Math.abs(h);this.pb=h,this.yb=d},T.prototype.Ag=function(d){var h=this.pb*d.pb;this.yb=this.yb*Math.abs(d.pb)+d.yb*Math.abs(this.pb)+this.yb*d.yb+2220446049250313e-31*Math.abs(h),this.pb=h},T.prototype.Oo=function(d){var h=this.pb*d;this.yb=this.yb*Math.abs(d)+2220446049250313e-31*Math.abs(h),this.pb=h},T.prototype.Ml=function(d,h){var o=Math.abs(d.pb)*Math.abs(h.pb);this.yb=d.yb*Math.abs(h.pb)+h.yb*Math.abs(d.pb)+d.yb*h.yb+2220446049250313e-31*Math.abs(o),this.pb=o},T.prototype.lm=function(d){var h=Math.abs(d.pb),o=this.pb/d.pb,c=(this.yb+Math.abs(o)*d.yb)/h;d.yb>.01*h&&(c*=1+(1+(d=d.yb/h))*d),this.pb=o,this.yb=c+2220446049250313e-31*Math.abs(o)},T.prototype.sqrt=function(){if(0<=this.pb){var d=Math.sqrt(this.pb),h=this.pb>10*this.yb?.5*this.yb/d:this.pb>this.yb?d-Math.sqrt(this.pb-this.yb):Math.max(d,Math.sqrt(this.pb+this.yb)-d);h+=2220446049250313e-31*Math.abs(d)}else this.pb<-1*this.yb?h=d=NaN:(d=0,h=Math.sqrt(this.yb));this.pb=d,this.yb=h},T.prototype.sin=function(d){var h=Math.sin(d.pb),o=Math.cos(d.pb);this.pb=h,h=Math.abs(h),this.yb=(Math.abs(o)+.5*h*d.yb)*d.yb+2220446049250313e-31*h},T.prototype.cos=function(d){var h=Math.sin(d.pb),o=Math.cos(d.pb);this.pb=o,o=Math.abs(o),this.yb=(Math.abs(h)+.5*o*d.yb)*d.yb+2220446049250313e-31*o},T.prototype.qg=function(){return Math.abs(this.pb)<=this.yb},T.prototype.qs=function(){return this.qg()&&this.yb!=0},T}();f.Xb=N}(ae||(ae={}));var Os=new ae.h,li=new ae.h,vl=new ae.h,Jn=new ae.h,_l=new ae.h;(function(f){var N,T;(T=N||(N={}))[T.closedPath=1]="closedPath",T[T.exteriorPath=2]="exteriorPath",T[T.ringAreaValid=4]="ringAreaValid";var d=function(){function h(o,c,u,m,g,v,w){c!==void 0?(this.ib=o,this.ck=c,this.cl=u,this.ji=m,this.za=v,this.cA=w,this.fw=g):(this.ib=o.ib,this.ck=o.ck,this.cl=o.cl,this.ji=o.ji,this.za=o.za,this.cA=o.cA,this.fw=o.fw),this.UG=!0}return h.prototype.next=function(){return this.UG?(this.UG=!1,this.ji):this.ji!=-1?(this.ji=this.ib.V(this.ji),this.za++,this.ji!=-1&&this.ji!=this.fw?this.ji:this.QT()):-1},h.prototype.QT=function(){for(this.cl=this.ib.Sb(this.cl),this.za=0;this.ck!=-1;){for(;this.cl!=-1;this.cl=this.ib.Sb(this.cl))if(this.fw=this.ji=this.ib.Ya(this.cl),this.ji!=-1)return this.ji;if(this.ck=this.ib.ve(this.ck),this.ck==-1)break;this.cA&&!f.ba.Ic(this.ib.jc(this.ck))||(this.cl=this.ib.Ob(this.ck))}return-1},h.sP=function(o,c,u,m,g,v,w){return new h(o,c,u,m,g,v,w)},h}();f.nY=d,N=function(){function h(){this.ko=this.Cm=this.wk=this.dd=this.Ck=this.wo=this.Pi=this.md=this.ci=this.Tg=this.Te=this.Kl=null,this.rw=this.ld=-1,this.gd=0,this.aA=!1,this.ht=this.it=this.wb=null}return h.prototype.Th=function(o){return this.Te!=null?this.Te[o]:null},h.prototype.Yg=function(o,c){if(this.Te==null){if(c==null)return;this.Te=[];for(var u=0,m=this.wb.I();u<m;u++)this.Te.push(null)}this.Te[o]=c},h.prototype.cp=function(o,c){this.md.T(o,1,c)},h.prototype.bp=function(o,c){this.md.T(o,2,c)},h.prototype.OB=function(o,c){this.md.T(o,6,c)},h.prototype.Up=function(o){return this.md.U(o,6)},h.prototype.fx=function(o,c){this.md.T(o,7,c)},h.prototype.rv=function(o){return this.md.U(o,0)},h.prototype.GJ=function(o,c){this.dd.T(o,1,c)},h.prototype.KJ=function(o,c){this.dd.T(o,0,c)},h.prototype.BF=function(o){return this.dd.U(o,7)},h.prototype.$o=function(o,c){this.dd.T(o,3,c)},h.prototype.ap=function(o,c){this.dd.T(o,4,c)},h.prototype.kU=function(o){this.dd==null&&(this.dd=new f.ad(8));var c=this.dd.De();return this.dd.T(c,2,o),this.dd.T(c,5,0),this.dd.T(c,6,0),this.dd.T(c,7,c),c},h.prototype.GQ=function(o){this.dd.kd(o)},h.prototype.mU=function(o){this.md==null&&(this.md=new f.ad(8),this.ud=new f.ad(5),this.Pi=new f.ce(0),this.wo=new f.ce(0));var c=this.md.De();return this.md.T(c,0,c),this.md.T(c,3,0),this.md.T(c,6,0),this.fx(c,o),c>=this.Pi.size&&(o=16>c?16:f.P.truncate(3*c/2),this.Pi.resize(o),this.wo.resize(o)),this.Pi.set(c,0),this.wo.set(c,0),c},h.prototype.kF=function(o){this.md.kd(o)},h.prototype.Qy=function(o){this.ud.kd(o),this.gd--},h.prototype.gI=function(o){this.md==null&&(this.md=new f.ad(8),this.ud=new f.ad(5),this.Pi=new f.ce(0),this.wo=new f.ce(0));var c=this.ud.De(),u=0<=o?o:c;if(this.ud.T(c,0,u),0>o){if(u>=this.wb.I()){if(o=16>u?16:f.P.truncate(3*u/2),this.wb.resize(o),this.Te!=null)for(var m=0;m<o;m++)this.Te.push(null);this.Tg!=null&&this.Tg.resize(o),this.it=this.wb.vb(0)}this.wb.Db(u,-1e38,-1e38),this.Te!=null&&(this.Te[u]=null),this.Tg!=null&&this.Tg.write(u,1)}return this.ud.T(c,4,2*u),this.gd++,c},h.prototype.xj=function(o,c,u){var m=c!=-1?this.Na(c):this.sj(o),g=m!=-1?this.V(m):-1,v=this.gI(u==null?this.gd:-1),w=this.Va(v);return u!=null&&this.wb.Ht(w,u),this.bj(v,o),this.Cc(v,g),this.Dc(v,m),g!=-1&&this.Dc(g,v),m!=-1&&this.Cc(m,v),u=this.ec(o),m=this.Ya(o),c==-1&&this.Xg(o,v),c==m&&this.Kf(o,v),u&&g==-1&&(this.Cc(v,v),this.Dc(v,v)),this.Wj(o,this.Ka(o)+1),o=this.Rf(o),this.Uj(o,this.I(o)+1),v},h.prototype.pm=function(){return this.ko==null&&(this.ko=new f.Ta(this.wb.description)),this.ko},h.prototype.Zo=function(o,c){this.dd.T(o,2,-134217729&this.dd.U(o,2)||(c==1?134217728:0))},h.prototype.Jn=function(o){return(134217728&this.dd.U(o,2))!=0?1:0},h.prototype.$M=function(o){var c=this.Kg(o.K(),o.description);return o.K()==1736&&this.Zo(c,o.Jn()),this.MD(c,o),c},h.prototype.aN=function(o){var c=this.Kg(o.K(),o.description);return this.ND(c,o),c},h.prototype.NV=function(o,c){this.md==null&&(this.md=new f.ad(8),this.ud=new f.ad(5),this.Pi=new f.ce(0),this.wo=new f.ce(0)),this.md.Ee(this.md.Jg+o),this.ud.Ee(this.ud.Jg+c),this.Pi.Jb(this.Pi.size+o),this.wo.Jb(this.wo.size+o)},h.prototype.MD=function(o,c){this.NV(c.ea(),c.I()),this.Kl.Gd(c,0,c.I()),this.it=this.wb.vb(0);for(var u=this.Te!=null&&c.Se!=null,m=0,g=c.ea();m<g;m++)if(!(2>c.Ka(m))){var v=this.wf(o,-1);this.mn(v,c.ec(m));for(var w=c.Ca(m),E=c.Wc(m);w<E;w++){var C=this.xj(v,-1,null);if(u)if(C=this.Va(C),(1&c.RF(w))!=0)this.Yg(C,null);else{var R=new f.hg;c.cc(w,R,!0),this.Yg(C,R.get())}}}},h.prototype.ND=function(o,c){this.Kl.Gd(c,0,c.I()),this.it=this.wb.vb(0),o=this.wf(o,-1);var u=0;for(c=c.I();u<c;u++)this.xj(o,-1,null)},h.prototype.BX=function(o,c,u){var m=this.V(o);if(m==-1)throw f.i.Ra();for(var g=this.pm(),v=this.cd(o),w=0,E=c.ql(u);w<E;w++){var C=this.Va(o),R=this.V(o),I=c.Xp(u,w);w==0&&(I.Uo(g),this.Eh(o,g)),I.K()==322?this.Yg(C,null):this.Yg(C,f.ba.ig(I)),I.Qo(g),w<E-1?o=this.xj(v,R,g):this.Eh(m,g)}},h.prototype.AX=function(o,c,u){var m=this.V(o);if(m==-1)throw f.i.Ra();for(var g=this.pm(),v=this.cd(o),w=0,E=c.ql(u);w<E;w++){var C=this.Va(o),R=this.V(o),I=c.Xp(u,E-w-1);w==0&&(I.Qo(g),this.Eh(o,g)),I.K()==322?this.Yg(C,null):this.Yg(C,f.ba.ig(I)),I.Uo(g),w<E-1?o=this.xj(v,R,g):this.Eh(m,g)}},h.prototype.AF=function(){var o=new f.l;o.Pa();for(var c=this.$q(),u=new f.h,m=!0,g=c.next();g!=-1;g=c.next())this.D(g,u),m?o.$b(u.x,u.y):o.Lk(u.x,u.y),m=!1;return o},h.prototype.Ib=function(o){var c=o.K();if(f.ba.Ic(c))return this.$M(o);if(c==550)return this.aN(o);throw f.i.Ra()},h.prototype.mN=function(o,c){var u=c.K();if(f.ba.Ic(u))this.MD(o,c);else{if(u!=550)throw f.i.Ra();this.ND(o,c)}},h.prototype.eN=function(o,c){var u=this.Kg(1736,o.description);if(2>o.Ka(c))return u;this.Kl.Gd(o,o.Ca(c),o.Wc(c)),this.it=this.wb.vb(0);var m=this.wf(u,-1);this.mn(m,o.ec(c)||!0);var g=this.Te!=null&&o.Se!=null,v=o.Ca(c);for(c=o.Wc(c);v<c;v++){var w=this.xj(m,-1,null);if(g)if(w=this.Va(w),(1&o.RF(v))!=0)this.Yg(w,null);else{var E=new f.hg;o.cc(v,E,!0),this.Yg(w,E.get())}}return u},h.prototype.Ke=function(o){var c=this.jc(o),u=f.RK.Kg(c,this.Kl.description),m=this.I(o);if(m==0)return u;if(f.ba.Ic(c)){c=this.ea(o);for(var g=f.Zc.Ph(c+1),v=f.Zc.Nr(c+1,0),w=u.description,E=0,C=w.Ba;E<C;E++){for(var R=w.qd(E),I=f.ua.Wa(R),F=f.Zc.QE(R,m),U=this.wb.vb(R),j=0,ee=0,te=0,Z=this.Ob(o);Z!=-1;Z=this.Sb(Z)){var le=0;this.ec(Z)&&(le|=1),this.OS(Z)&&(le|=4),le!=0&&v.rJ(ee,le);var ve=this.Ka(Z);if(g.write(ee++,te),te+=ve,R==0){ve=U;var be=F,ue=new f.h;for(le=this.Ya(Z);j<te;le=this.V(le),j++){var Le=this.Va(le);ve.uc(2*Le,ue),be.Ut(2*j,ue)}}else for(le=this.Ya(Z);j<te;le=this.V(le),j++)for(Le=this.Va(le),be=0;be<I;be++)ue=U.Bg(Le*I+be),F.rr(j*I+be,ue)}u.kn(R,F),g.write(c,m)}u.HJ(v),u.IJ(g),u.Qc(16777215)}else if(c==550){for(w=u.description,u.resize(m),E=0,C=w.Ba;E<C;E++){for(R=w.qd(E),I=f.ua.Wa(R),F=u.vb(R),U=this.wb.vb(R),j=0,Z=this.Ob(o),ve=this.Ka(Z),le=this.Ya(Z);j<ve;le=this.V(le),j++)for(Le=this.Va(le),be=0;be<I;be++)ue=U.Bg(Le*I+be),F.rr(j*I+be,ue);u.kn(R,F)}u.Qc(16777215)}return u},h.prototype.vB=function(o){for(var c=this.Ob(o);c!=-1;c=this.ar(c));c=this.GR(o);var u=this.ve(o);c!=-1?this.GJ(c,u):this.ld=u,u!=-1?this.KJ(u,c):this.rw=c,this.GQ(o)},h.prototype.Kg=function(o,c){return c===void 0?this.SE(o,f.ee.og()):this.SE(o,c)},h.prototype.SE=function(o,c){return o=this.kU(o),this.wb==null?this.wb=this.Kl=new f.de(c):this.Kl.Ll(c),this.ht=this.Kl.description,this.aA=1<this.ht.Ba,this.ld==-1?this.ld=o:(this.KJ(o,this.rw),this.GJ(this.rw,o)),this.rw=o},h.prototype.ve=function(o){return this.dd.U(o,1)},h.prototype.GR=function(o){return this.dd.U(o,0)},h.prototype.jc=function(o){return 2147483647&this.dd.U(o,2)},h.prototype.zJ=function(o,c,u){c=this.wk[c],(o=this.BF(o))>=c.size&&c.resize(Math.max(f.P.truncate(1.25*o),16),-1),c.write(o,u)},h.prototype.CF=function(o,c){return(o=this.BF(o))<(c=this.wk[c]).size?c.read(o):-1},h.prototype.TE=function(){this.wk==null&&(this.wk=[]);for(var o=0;o<this.wk.length;o++)if(this.wk[o]==null)return this.wk[o]=f.Zc.Ph(0),o;return this.wk.push(f.Zc.Ph(0)),this.wk.length-1},h.prototype.nW=function(o){this.wk[o]=null},h.prototype.Ob=function(o){return this.dd.U(o,3)},h.prototype.lv=function(o){return this.dd.U(o,4)},h.prototype.I=function(o){return this.dd.U(o,5)},h.prototype.ea=function(o){return this.dd.U(o,6)},h.prototype.Ip=function(o,c,u){for(var m=0,g=this.ld;g!=-1;g=this.ve(g)){var v=this.jc(g);if(f.ba.Ic(v)&&(!u||v==1736)){v=this.jc(g)==1736;for(var w=this.Ob(g);w!=-1;){for(var E=0,C=this.Ya(w);E<f.P.truncate(this.Ka(w)/2);){var R=this.V(C);if(R==-1)break;var I=this.Va(C),F=this.Th(I);F!=null?I=F.Rb():(F=this.Va(R),I=this.wb.Ar(I,F)),I<=o?(I==0?m==0&&(m=-1):m=1,R!=this.sj(w)&&(this.eC(R,C),this.pd(R,!0))):C=this.V(C),E++}for(E=this.Ya(w),C=this.ec(w)?E:this.sj(w);0<this.Ka(w);){if((R=this.Na(C))==-1){this.pd(C,!0),m==0&&(m=-1);break}var U=this.Va(R);if((F=this.Th(U))!=null?I=F.Rb():(I=this.Va(C),I=this.wb.Ar(I,U)),I<=o)I==0?m==0&&(m=-1):m=1,this.eC(R,C),this.pd(R,!1),E==R&&(E=this.Ya(w));else if((C=this.Na(C))==E)break}C=this.Ka(w),c&&(v?3>C:2>C)?(w=this.ar(w),m=0<C?1:m==0?-1:m):w=this.Sb(w)}}}return m},h.prototype.eC=function(o,c){var u=this.Va(o),m=this.Va(c);if(this.Tg!=null&&(u=this.Tg.read(u),this.Tg.write(m,u)),this.ci!=null){for(m=0,u=this.ci.length;m<u;m++)if(this.ci[m]!=null){var g=this.Qa(o,m);g!=-1&&this.Sa(c,m,g)}}},h.prototype.Wl=function(o,c,u){var m=0,g=this.V(o);if(g==-1)throw f.i.Ra();for(var v=this.Va(o),w=this.Va(g),E=this.Th(v),C=E==null?this.wb.Ar(v,w):E.Rb(),R=0;R<u;R++){var I=c[R];if(0<I&&1>I){var F=I;E!=null&&(F=0<C?E.Sx(I)/C:0),this.wb.cD(v,w,F,this.pm());var U=this.xj(this.cd(o),g,this.pm());if(m++,E!=null){var j=E.el(0,I);F=this.Va(this.Na(U)),this.Yg(F,j),this.mf(U,j.xc()),R!=u-1&&c[R+1]!=1||(I=E.el(I,1),this.Yg(F,I))}}}return m},h.prototype.zX=function(o,c,u){var m=0,g=this.V(o);if(g==-1)throw f.i.ga("internal error");var v=this.Va(o),w=this.Va(g),E=this.Th(v),C=E==null?this.wb.Ar(v,w):E.Rb(),R=0;o=this.cd(o);for(var I=0;I<u;I++){var F=c[I];if(R<F&&1>F){var U=F;if(E!=null&&(U=0<C?E.Sx(F)/C:0),this.wb.cD(v,w,U,this.pm()),U=this.pS(o,g,this.pm()),m++,E!=null){R=E.el(R,F);var j=this.Va(this.Na(U));this.Yg(j,R),this.Db(U,R.qa,R.ma),I!=u-1&&c[I+1]!=1||(R=E.el(F,1),U=this.Va(U),this.Yg(U,R))}}R=F}return m},h.prototype.pS=function(o,c,u){var m=c!=-1?this.Na(c):this.sj(o),g=m!=-1?this.V(m):-1,v=this.gI(u==null?this.gd:-1),w=this.Va(v);return u!=null&&this.wb.Ht(w,u),this.bj(v,o),this.Cc(v,g),this.Dc(v,m),g!=-1&&this.Dc(g,v),m!=-1&&this.Cc(m,v),u=this.ec(o),m=this.Ya(o),c==-1&&this.Xg(o,v),c==m&&(u&&m!=-1||this.Kf(o,v)),u&&g==-1&&(this.Cc(v,v),this.Dc(v,v)),this.Wj(o,this.Ka(o)+1),o=this.Rf(o),this.Uj(o,this.I(o)+1),v},h.prototype.mE=function(o,c,u){var m=this.Va(c),g=this.Va(u);if(0>m||g>this.gd-1)throw f.i.O("invalid call");if(m>g&&!this.ec(o))throw f.i.O("cannot iterate across an open path");for(o=0;c!=u;c=this.V(c))m=this.Va(c),(g=this.Th(m))!=null?o+=g.Rb():(g=this.Va(this.V(c)),o+=this.wb.Ar(m,g));return o},h.prototype.Eh=function(o,c){var u=this.Va(o);this.wb.Ht(u,c),(u=this.Th(u))!=null&&u.setStart(c),(o=this.Na(o))!=-1&&(o=this.Va(o),this.Th(o)!=null&&u.setEnd(c))},h.prototype.Wi=function(o,c){o=this.Va(o),this.wb.we(o,c)},h.prototype.mf=function(o,c){this.Db(o,c.x,c.y)},h.prototype.Db=function(o,c,u){var m=this.Va(o);this.wb.Db(m,c,u),(m=this.Th(m))!=null&&m.SB(c,u),(o=this.Na(o))!=-1&&(o=this.Va(o),this.Th(o)!=null&&m.Sl(c,u))},h.prototype.D=function(o,c){this.wb.D(this.ud.U(o,0),c)},h.prototype.Hc=function(o,c){this.wb.Aa[0].uc(2*this.ud.U(o,0),c)},h.prototype.Oa=function(o){var c=new f.h;return this.wb.D(this.ud.U(o,0),c),c},h.prototype.WF=function(o,c){this.it.uc(2*o,c)},h.prototype.Vc=function(o,c,u){return this.wb.Vc(o,this.Va(c),u)},h.prototype.setAttribute=function(o,c,u,m){this.wb.setAttribute(o,this.Va(c),u,m)},h.prototype.Va=function(o){return this.ud.U(o,0)},h.prototype.jh=function(){var o=new f.h;return this.D(void 0,o),o.y},h.prototype.hq=function(o,c){o=this.Va(o),c=this.Va(c);var u=this.wb.Aa[0].o;return u[2*o]===u[2*c]&&u[2*o+1]===u[2*c+1]},h.prototype.Ev=function(o,c){o=this.Va(o);var u=this.wb.Aa[0].o;return u[2*o]===c.x&&u[2*o+1]===c.y},h.prototype.jX=function(o,c){if(1>c&&(c=1),this.Tg==null){if(c==1)return;this.Tg=f.Zc.En(this.wb.I(),1)}(o=this.Va(o))>=this.Tg.size&&this.Tg.resize(o+1,1),this.Tg.write(o,c)},h.prototype.VF=function(o){return o=this.Va(o),this.Tg==null||o>=this.Tg.size?1:this.Tg.read(o)},h.prototype.Sa=function(o,c,u){c=this.ci[c],o=this.Va(o),c.size<this.wb.I()&&c.resize(this.wb.I(),-1),c.write(o,u)},h.prototype.Qa=function(o,c){return(o=this.Va(o))<(c=this.ci[c]).size?c.read(o):-1},h.prototype.Hd=function(){this.ci==null&&(this.ci=[]);for(var o=0;o<this.ci.length;o++)if(this.ci[o]==null)return this.ci[o]=f.Zc.Ph(0,-1),o;return this.ci.push(f.Zc.Ph(0,-1)),this.ci.length-1},h.prototype.Ud=function(o){this.ci[o]=null},h.prototype.cc=function(o){return this.Te!=null?(o=this.Va(o),this.Te[o]):null},h.prototype.fd=function(o,c){var u=this.ud.U(o,2);if(u==-1)return!1;if(this.aA){var m=new f.Ta;this.Wi(o,m),c.setStart(m),this.Wi(u,m),c.setEnd(m)}else this.wb.Hc(this.ud.U(o,0),Os),c.gm(0,Os),this.wb.Hc(this.ud.U(u,0),Os),c.gm(1,Os);return!0},h.prototype.cW=function(o,c,u){if(this.aA){var m=new f.Ta;this.Wi(o,m),u.setStart(m),this.Wi(c,m),u.setEnd(m)}else this.wb.Hc(o,Os),u.gm(0,Os),this.wb.Hc(c,Os),u.gm(1,Os)},h.prototype.wf=function(o,c){if(c!=-1){if(o!=this.Rf(c))throw f.i.Ra();var u=this.ds(c)}else u=this.lv(o);var m=this.mU(o);return c!=-1&&this.cp(c,m),this.bp(m,c),this.cp(m,u),u!=-1?this.bp(u,m):this.$o(o,m),c==-1&&this.ap(o,m),this.Tl(o,this.ea(o)+1),m},h.prototype.fG=function(o,c,u,m){o=this.wf(o,-1);for(var g=0,v=c,w=!1;v==u&&(w=!0),this.bj(v,o),g++,(v=this.V(v))!=c;);return this.mn(o,!0),this.Wj(o,g),w&&(c=u),this.Kf(o,c),this.Xg(o,this.Na(c)),this.ep(o,!1),m!=null&&(m[0]=w),o},h.prototype.ar=function(o){var c=this.ds(o),u=this.Sb(o),m=this.Rf(o);return c!=-1?this.bp(c,u):this.$o(m,u),u!=-1?this.cp(u,c):this.ap(m,c),this.sO(o),this.Tl(m,this.ea(m)-1),this.kF(o),u},h.prototype.sO=function(o){var c=this.Ya(o);if(c!=-1){for(var u=0,m=this.Ka(o);u<m;u++){var g=c;c=this.V(c),this.Qy(g)}c=this.Rf(o),this.Uj(c,this.I(c)-this.Ka(o))}this.Wj(o,0)},h.prototype.Sb=function(o){return this.md.U(o,2)},h.prototype.ds=function(o){return this.md.U(o,1)},h.prototype.Ka=function(o){return this.md.U(o,3)},h.prototype.ec=function(o){return(1&this.Up(o))!=0},h.prototype.mn=function(o,c){if(this.ec(o)!=c){if(0<this.Ka(o)){var u=this.Ya(o),m=this.sj(o);c?(this.Cc(m,u),this.Dc(u,m),u=this.Va(m)):(this.Cc(m,-1),this.Dc(u,-1),u=this.Va(m)),this.Yg(u,null)}this.OB(o,(1|this.Up(o))-1|(c?1:0))}},h.prototype.Rf=function(o){return this.md.U(o,7)},h.prototype.OS=function(o){return(2&this.Up(o))!=0},h.prototype.JB=function(o,c){this.OB(o,(2|this.Up(o))-2|(c?2:0))},h.prototype.qz=function(o){if(this.TS(o))return this.Pi.get(this.rv(o));var c=new f.zb,u=this.Ya(o);if(u==-1)return 0;var m=new f.h;this.D(u,m);for(var g=0,v=0,w=this.Ka(o);v<w;v++,u=this.V(u)){var E=this.cc(u);if(E==null){if(!this.fd(u,c))continue;E=c}g+=E.Rx(m.x,m.y)}return this.ep(o,!0),this.Pi.set(this.rv(o),g),g},h.prototype.ir=function(o,c,u){c=this.Ck[c],o=this.rv(o),c.size<this.Pi.size&&c.resize(this.Pi.size,-1),c.write(o,u)},h.prototype.tj=function(o,c){return(o=this.rv(o))<(c=this.Ck[c]).size?c.read(o):-1},h.prototype.Ey=function(){this.Ck==null&&(this.Ck=[]);for(var o=0;o<this.Ck.length;o++)if(this.Ck[o]==null)return this.Ck[o]=f.Zc.Ph(0),o;return this.Ck.push(f.Zc.Ph(0)),this.Ck.length-1},h.prototype.wB=function(o){this.Ck[o]=null},h.prototype.PT=function(o,c,u){if(u==-1)throw f.i.O();if(c!=u){var m=this.Sb(u),g=this.ds(u),v=this.Rf(u);g==-1?this.$o(v,m):this.bp(g,m),m==-1?this.ap(v,g):this.cp(m,g),this.Uj(v,this.I(v)-this.Ka(u)),this.Tl(v,this.ea(v)-1),g=c==-1?this.lv(o):this.ds(c),this.cp(u,g),this.bp(u,c),c==-1?this.ap(o,u):this.cp(c,u),g==-1?this.$o(o,u):this.bp(g,u),this.Uj(o,this.I(o)+this.Ka(u)),this.Tl(o,this.ea(o)+1),this.fx(u,o)}},h.prototype.jj=function(o,c){this.wb.we(this.Va(c),this.pm()),this.xj(o,-1,this.pm())},h.prototype.pd=function(o,c){var u=this.cd(o),m=this.Na(o),g=this.V(o);m!=-1&&this.Cc(m,g);var v=this.Ka(u);if(o==this.Ya(u)&&this.Kf(u,1<v?g:-1),g!=-1&&this.Dc(g,m),o==this.sj(u)&&this.Xg(u,1<v?m:-1),m!=-1&&g!=-1){m=this.Va(m);var w=this.Va(g);c?(c=this.Th(m))!=null&&(m=new f.h,this.wb.D(w,m),c.Rc(m)):(w=this.Va(o),c=this.Th(w),this.Yg(m,c),c!=null&&(m=this.wb.Oa(m),c.Ec(m)))}return this.Wj(u,v-1),u=this.Rf(u),this.Uj(u,this.I(u)-1),this.Qy(o),g},h.prototype.Ya=function(o){return this.md.U(o,4)},h.prototype.sj=function(o){return this.md.U(o,5)},h.prototype.V=function(o){return this.ud.U(o,2)},h.prototype.Na=function(o){return this.ud.U(o,1)},h.prototype.cd=function(o){return this.ud.U(o,3)},h.prototype.hc=function(o,c){return this.xj(o,-1,c)},h.prototype.$q=function(o){if(o===void 0)return this.$q(!1);if(o instanceof d)return new d(o);var c,u=-1,m=-1,g=-1,v=0,w=!1;for(c=this.ld;c!=-1;c=this.ve(c))if(!o||f.ba.Ic(this.jc(c))){for(u=this.Ob(c);u!=-1;u=this.Sb(u))if(g=m=this.Ya(u),v=0,m!=-1){w=!0;break}if(w)break}return d.sP(this,c,u,m,g,v,o)},h.prototype.Pc=function(o){if(this.Kl.Pc(o),this.Te!=null)for(var c=0,u=this.Te.length;c<u;c++)this.Te[c]!=null&&this.Te[c].Pc(o)},h.prototype.lr=function(o,c,u,m){m?this.BX(o,c,u):this.AX(o,c,u)},h.prototype.Dc=function(o,c){this.ud.T(o,1,c)},h.prototype.Cc=function(o,c){this.ud.T(o,2,c)},h.prototype.bj=function(o,c){this.ud.T(o,3,c)},h.prototype.Wj=function(o,c){this.md.T(o,3,c)},h.prototype.Kf=function(o,c){this.md.T(o,4,c)},h.prototype.Xg=function(o,c){this.md.T(o,5,c)},h.prototype.Tl=function(o,c){this.dd.T(o,6,c)},h.prototype.Uj=function(o,c){this.dd.T(o,5,c)},h.prototype.hJ=function(o){var c=o;do{var u=this.V(c);this.Cc(c,this.Na(c)),this.Dc(c,u),c=u}while(c!=o)},h.prototype.VB=function(o){this.gd=o},h.prototype.br=function(o){var c=this.ds(o),u=this.Sb(o),m=this.Rf(o);c!=-1?this.bp(c,u):this.$o(m,u),u!=-1?this.cp(u,c):this.ap(m,c),this.Kf(o,-1),this.Xg(o,-1),this.kF(o)},h.prototype.ni=function(o,c){var u=this.Na(o),m=this.V(o);if(u!=-1&&this.Cc(u,m),m!=-1&&this.Dc(m,u),u!=-1&&m!=-1)if(u=this.Va(u),m=this.Va(m),c){if((c=this.Th(u))!=null){var g=new f.h;this.wb.D(m,g),c.Rc(g)}}else c=this.Va(o),c=this.Th(c),this.Yg(u,c),c!=null&&(g=new f.h,this.wb.D(u,g),c.Ec(g));this.Qy(o)},h.prototype.TS=function(o){return(4&this.Up(o))!=0},h.prototype.ep=function(o,c){this.OB(o,(4|this.Up(o))-4|(c?4:0))},h.prototype.mx=function(o,c){var u=this.ud.o;this.wb.rc();var m=this.wb.Aa[0].o;o.Wd(0,c,function(g,v){var w=u[5*g];g=u[5*v],v=m[2*w],w=m[2*w+1];var E=m[2*g];return w<(g=m[2*g+1])?-1:w>g?1:v<E?-1:v>E?1:0})},h.prototype.aS=function(){for(var o=this.ld;o!=-1;o=this.ve(o))if(!f.ba.Ic(this.jc(o)))return!0;return!1},h.prototype.aC=function(o,c){for(var u=this.Ob(o),m=this.Ob(c),g=this.lv(o),v=this.lv(c),w=this.Ob(o);w!=-1;w=this.Sb(w))this.fx(w,c);for(w=this.Ob(c);w!=-1;w=this.Sb(w))this.fx(w,o);this.$o(o,m),this.$o(c,u),this.ap(o,v),this.ap(c,g),u=this.I(o),m=this.ea(o),g=this.ea(c),this.Uj(o,this.I(c)),this.Uj(c,u),this.Tl(o,g),this.Tl(c,m),u=this.dd.U(o,2),this.dd.T(o,2,this.dd.U(c,2)),this.dd.T(c,2,u)},h}(),f.hd=N})(ae||(ae={})),function(f){var N=function(T){function d(h,o,c,u){var m=T.call(this)||this;return m.aa=new f.l,h===void 0?m.ME():typeof h=="number"?m.NO(h,o,c,u):h instanceof f.Ta?o!==void 0?m.Su(h,o,c):m.OO(h):h instanceof f.ua?o!==void 0?m.QO(h,o):m.PO(h):h instanceof f.l?m.MO(h):m.ME(),m}return Hi(d,T),d.prototype.Su=function(h,o,c){this.description=f.ee.og(),this.aa.Pa(),h.B()||this.uu(h,o,c)},d.prototype.MO=function(h){this.description=f.ee.og(),this.aa.L(h),this.aa.normalize()},d.prototype.PO=function(h){if(h==null)throw f.i.O();this.description=h,this.aa.Pa()},d.prototype.QO=function(h,o){if(h==null)throw f.i.O();this.description=h,this.aa.L(o),this.aa.normalize()},d.prototype.ME=function(){this.description=f.ee.og(),this.aa.Pa()},d.prototype.OO=function(h){this.description=f.ee.og(),this.aa.Pa(),h.B()||this.uu(h)},d.prototype.NO=function(h,o,c,u){this.description=f.ee.og(),this.L(h,o,c,u)},d.prototype.L=function(h,o,c,u){if(this.wc(),typeof h=="number")this.aa.L(h,o,c,u);else for(this.Pa(),o=0,c=h.length;o<c;o++)this.$b(h[o])},d.prototype.Yo=function(h){if(this.wc(),!h.WS())throw f.i.O();this.aa.L(h)},d.prototype.Pa=function(){this.wc(),this.aa.Pa()},d.prototype.B=function(){return this.aa.B()},d.prototype.S=function(){return this.aa.S()},d.prototype.da=function(){return this.aa.da()},d.prototype.gk=function(){return this.aa.gk()},d.prototype.Lp=function(){return this.aa.Lp()},d.prototype.Kp=function(){return this.aa.tf()},d.prototype.$b=function(h){if(h instanceof f.h)this.wc(),this.aa.$b(h);else if(h instanceof f.l)this.wc(),this.aa.$b(h);else if(h instanceof f.Ta){if(this.wc(),!h.Bc()){var o=h.description;if(this.description!=o&&this.Ll(o),this.B())this.uu(h);else{this.aa.$b(h.D());for(var c=1,u=o.Ba;c<u;c++)for(var m=o.Fd(c),g=f.ua.Wa(m),v=0;v<g;v++){var w=h.Vc(m,v),E=this.Ug(m,v);E.$b(w),this.setInterval(m,v,E)}}}}else if(h instanceof d&&!h.B())for((o=h.description)!=this.description&&this.Ll(o),this.aa.$b(h.aa),c=1,u=o.Ba;c<u;c++)for(m=o.qd(c),g=f.ua.Wa(m),v=0;v<g;v++)w=h.Ug(m,v),(E=this.Ug(m,v)).$b(w),this.setInterval(m,v,E)},d.prototype.uu=function(h,o,c){if(o!==void 0){this.aa.L(h.D(),o,c),c=1;for(var u=(o=h.description).Ba;c<u;c++)for(var m=o.Fd(c),g=f.ua.Wa(m),v=0;v<g;v++){var w=h.Vc(m,v);this.setInterval(m,v,w,w)}}else for(this.aa.L(h.la[0],h.la[1]),c=1,u=(o=h.description).Ba;c<u;c++)for(m=o.Fd(c),g=f.ua.Wa(m),v=0;v<g;v++)w=h.Vc(m,v),this.setInterval(m,v,w,w)},d.prototype.setInterval=function(h,o,c,u){if(c=typeof c=="number"?new f.Oc(c,u):c,this.wc(),h==0)if(o==0)this.aa.v=c.pa,this.aa.C=c.wa;else{if(o!=1)throw f.i.re();this.aa.G=c.pa,this.aa.H=c.wa}else this.nD(0,h,o,c.pa),this.nD(1,h,o,c.wa)},d.prototype.X=function(h,o){this.wc(),this.aa.X(h,o)},d.prototype.Pc=function(h){if(h instanceof f.Ed)this.wc(),h.fC(this.aa);else if(this.wc(),!this.aa.B()){var o=new f.GK;this.Ro(o),o.NS()?o.Pa():h.fC(o)}},d.prototype.copyTo=function(h){if(h.K()!=this.K())throw f.i.O();if(h.wc(),h.description=this.description,h.aa.L(this.aa),h.la=null,this.la!=null){h.pu();for(var o=0;o<2*(this.description.Be.length-2);o++)h.la[o]=this.la[o]}},d.prototype.Ja=function(){return new d(this.description)},d.prototype.He=function(){return this.aa.oF()},d.prototype.Rb=function(){return this.aa.qR()},d.prototype.K=function(){return 197},d.prototype.Eb=function(){return 2},d.prototype.dn=function(h){this.copyTo(h)},d.prototype.A=function(h){h.v=this.aa.v,h.G=this.aa.G,h.C=this.aa.C,h.H=this.aa.H},d.prototype.Ro=function(h){h.v=this.aa.v,h.G=this.aa.G,h.C=this.aa.C,h.H=this.aa.H,h.L(this.aa.v,this.aa.G,this.Pd(0,1,0),this.aa.C,this.aa.H,this.Pd(1,1,0))},d.prototype.Ug=function(h,o){var c=new f.Oc;return c.L(this.Pd(0,h,o),this.Pd(1,h,o)),c},d.prototype.If=function(h,o){o.kg(this.description);var c=this.description.Ba-1;switch(h){case 0:for(h=0;h<c;h++)for(var u=this.description.qd(h),m=f.ua.Wa(u),g=0;g<m;g++)o.setAttribute(u,g,this.Pd(0,u,g));o.Db(this.aa.v,this.aa.G);break;case 1:for(h=0;h<c;h++)for(u=this.description.qd(h),m=f.ua.Wa(u),g=0;g<m;g++)o.setAttribute(u,g,this.Pd(1,u,g));o.Db(this.aa.v,this.aa.H);break;case 2:for(h=0;h<c;h++)for(u=this.description.qd(h),m=f.ua.Wa(u),g=0;g<m;g++)o.setAttribute(u,g,this.Pd(0,u,g));o.Db(this.aa.C,this.aa.H);break;case 3:for(h=0;h<c;h++)for(u=this.description.qd(h),m=f.ua.Wa(u),g=0;g<m;g++)o.setAttribute(u,g,this.Pd(1,u,g));o.Db(this.aa.C,this.aa.G);break;default:throw f.i.re()}},d.prototype.gB=function(h,o){h=this.aa.gB(h),o.na(h.x,h.y)},d.prototype.cR=function(h,o){return o*(h.Qq-2)},d.prototype.pF=function(h,o,c){if(this.aa.B())throw f.i.ga("empty geometry");if(o==0)return h!=0?c!=0?this.aa.H:this.aa.C:c!=0?this.aa.G:this.aa.v;if(c>=f.ua.Wa(o))throw f.i.O();var u=this.description.Qf(o);return this.pu(),0<=u?this.la[this.cR(this.description,h)+this.description.CR(u)-2+c]:f.ua.te(o)},d.prototype.pu=function(){if(this.wc(),this.la==null&&2<this.description.Be.length){this.la=[];for(var h=d.Ig(this.description,0),o=d.Ig(this.description,1),c=0,u=1,m=this.description.Ba;u<m;u++){var g=this.description.qd(u),v=f.ua.Wa(g);g=f.ua.te(g);for(var w=0;w<v;w++)this.la[h+c]=g,this.la[o+c]=g,c++}}},d.prototype.un=function(h){if(this.la!=null)if(2<h.Be.length){for(var o=f.ee.Jw(h,this.description),c=[],u=d.Ig(this.description,0),m=d.Ig(this.description,1),g=d.Ig(h,0),v=d.Ig(h,1),w=0,E=1,C=h.Ba;E<C;E++){var R=h.qd(E),I=f.ua.Wa(R);if(o[E]==-1){var F=f.ua.te(R);for(R=0;R<I;R++)c[g+w]=F,c[v+w]=F,w++}else for(F=this.description.$j(o[E])-2,R=0;R<I;R++)c[g+w]=this.la[u+F],c[v+w]=this.la[m+F],w++,F++}this.la=c}else this.la=null;this.description=h},d.prototype.Pd=function(h,o,c){if(this.aa.B())throw f.i.ga("This operation was performed on an Empty Geometry.");if(o==0)return h!=0?c!=0?this.aa.H:this.aa.C:c!=0?this.aa.G:this.aa.v;if(c>=f.ua.Wa(o))throw f.i.re();var u=this.description.Qf(o);return 0<=u?(this.pu(),this.la[d.Ig(this.description,h)+this.description.$j(u)-2+c]):f.ua.te(o)},d.prototype.nD=function(h,o,c,u){if(this.wc(),o==0)h!=0?c!=0?this.aa.H=u:this.aa.C=u:c!=0?this.aa.G=u:this.aa.v=u;else{if(c>=f.ua.Wa(o))throw f.i.re();if(!this.hasAttribute(o)){if(f.ua.vG(o,u))return;this.se(o)}o=this.description.Qf(o),this.pu(),this.la[d.Ig(this.description,h)+this.description.$j(o)-2+c]=u}},d.Ig=function(h,o){return o*(h.Be.length-2)},d.prototype.Fa=function(h){this.wc();var o=new f.l;return h.A(o),this.aa.Fa(o)},d.prototype.isIntersecting=function(h){return h instanceof f.l?this.aa.isIntersecting(h):this.aa.isIntersecting(h.aa)},d.prototype.Ku=function(h,o){this.wc(),h.B()?this.Pa():o!==void 0?this.uu(h,o,void 0):this.aa.Ku(h.Mg(),h.jh())},d.prototype.offset=function(h,o){this.wc(),this.aa.offset(h,o)},d.prototype.normalize=function(){this.wc(),this.aa.normalize()},d.prototype.tf=function(h){if(h===void 0){if(h=new f.Ta(this.description),this.B())return h;for(o=this.description.Ba,c=1;c<o;c++)for(u=this.description.Fd(c),m=f.ua.Wa(u),g=0;g<m;g++)v=.5*(this.Pd(0,u,g)+this.Pd(1,u,g)),h.setAttribute(u,g,v);return h.Db(this.aa.gk(),this.aa.Lp()),h}if(h.kg(this.description),this.B())h.Pa();else{for(var o=this.description.Ba,c=1;c<o;c++)for(var u=this.description.qd(c),m=f.ua.Wa(u),g=0;g<m;g++){var v=.5*(this.pF(0,u,g)+this.pF(1,u,g));h.setAttribute(u,g,v)}h.Db(this.aa.tf())}},d.prototype.hz=function(){return new f.Ta(this.aa.hz())},d.prototype.contains=function(h){return h instanceof f.Ta?!h.B()&&this.aa.contains(h.Mg(),h.jh()):this.aa.contains(h.aa)},d.prototype.WO=function(h){return this.aa.contains(h)},d.prototype.Nb=function(h){if(h==this)return!0;if(!(h instanceof d)||this.description!=h.description)return!1;if(this.B())return!!h.B();if(!this.aa.Nb(h.aa))return!1;for(var o=0,c=2*(this.description.Be.length-2);o<c;o++)if(this.la[o]!=h.la[o])return!1;return!0},d.prototype.dc=function(){var h=this.description.dc();if(h=f.P.Uh(h,this.aa.dc()),!this.B()&&this.la!=null)for(var o=0,c=2*(this.description.Be.length-2);o<c;o++)h=f.P.Uh(h,this.la[o]);return h},d.prototype.fs=function(){return this.aa.v},d.prototype.hs=function(){return this.aa.G},d.prototype.es=function(){return this.aa.C},d.prototype.gs=function(){return this.aa.H},d.prototype.mg=function(){return f.ri.im(this,null)},d.prototype.toString=function(){return this.B()?"Envelope: []":"Envelope: ["+this.aa.v+", "+this.aa.G+", "+this.aa.C+", "+this.aa.H+"]"},d}(f.ba);f.Gh=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c){d===void 0?this.Pa():(this.v=d,this.G=h,this.C=o,this.H=c)}return T.construct=function(d,h,o,c){var u=new T;return u.v=d,u.G=h,u.C=o,u.H=c,u},T.prototype.L=function(d,h,o,c){typeof d=="number"?o!==void 0?(this.v=d,this.G=h,this.C=o,this.H=c,this.normalize()):(this.v=d,this.G=h,this.C=d,this.H=h):d instanceof f.h?h!==void 0?(this.v=d.x-.5*h,this.C=this.v+h,this.G=d.y-.5*o,this.H=this.G+o,this.normalize()):(this.v=d.x,this.G=d.y,this.C=d.x,this.H=d.y):d instanceof T?this.L(d.v,d.G,d.C,d.H):d instanceof f.Oc&&(d.B()||h.B()?this.Pa():(this.v=d.pa,this.C=d.wa,this.G=h.pa,this.H=h.wa))},T.prototype.ax=function(d,h){if(h!==void 0)if(h==0)this.Pa();else{this.v=d[0].x,this.G=d[0].y,this.C=this.v,this.H=this.G;for(var o=1;o<h;o++){var c=d[o];c.x<this.v?this.v=c.x:c.x>this.C&&(this.C=c.x),c.y<this.G?this.G=c.y:c.y>this.H&&(this.H=c.y)}}else if(d==null||d.length==0)this.Pa();else for(c=d[0],this.L(c.x,c.y),o=1;o<d.length;o++)h=d[o],this.Lk(h.x,h.y)},T.prototype.Pa=function(){this.H=this.C=this.G=this.v=NaN},T.prototype.B=function(){return isNaN(this.v)},T.prototype.$b=function(d,h){typeof d=="number"?this.B()?(this.v=d,this.G=h,this.C=d,this.H=h):(this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>h?this.G=h:this.H<h&&(this.H=h)):d instanceof f.h||d instanceof f.Od?this.$b(d.x,d.y):d instanceof T&&!d.B()&&(this.$b(d.v,d.G),this.$b(d.C,d.H))},T.prototype.Lk=function(d,h){this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>h?this.G=h:this.H<h&&(this.H=h)},T.prototype.X=function(d,h){this.B()||(this.v-=d,this.C+=d,this.G-=h,this.H+=h,(this.v>this.C||this.G>this.H)&&this.Pa())},T.prototype.scale=function(d){0>d&&this.Pa(),this.B()||(this.v*=d,this.C*=d,this.G*=d,this.H*=d)},T.prototype.zoom=function(d,h){this.B()||this.L(this.tf(),d*this.S(),h*this.da())},T.prototype.isIntersecting=function(d){return!this.B()&&!d.B()&&(this.v<=d.v?this.C>=d.v:d.C>=this.v)&&(this.G<=d.G?this.H>=d.G:d.H>=this.G)},T.prototype.zG=function(d){return(this.v<=d.v?this.C>=d.v:d.C>=this.v)&&(this.G<=d.G?this.H>=d.G:d.H>=this.G)},T.prototype.Fa=function(d){return!this.B()&&!d.B()&&(d.v>this.v&&(this.v=d.v),d.C<this.C&&(this.C=d.C),d.G>this.G&&(this.G=d.G),d.H<this.H&&(this.H=d.H),(d=this.v<=this.C&&this.G<=this.H)||this.Pa(),d)},T.prototype.gB=function(d){switch(d){case 0:return f.h.construct(this.v,this.G);case 1:return f.h.construct(this.v,this.H);case 2:return f.h.construct(this.C,this.H);case 3:return f.h.construct(this.C,this.G);default:throw f.i.re()}},T.prototype.hB=function(d){if(d==null||4>d.length)throw f.i.O();d[0]!=null?d[0].na(this.v,this.G):d[0]=f.h.construct(this.v,this.G),d[1]!=null?d[1].na(this.v,this.H):d[1]=f.h.construct(this.v,this.H),d[2]!=null?d[2].na(this.C,this.H):d[2]=f.h.construct(this.C,this.H),d[3]!=null?d[3].na(this.C,this.G):d[3]=f.h.construct(this.C,this.G)},T.prototype.oF=function(){return this.B()?0:this.S()*this.da()},T.prototype.qR=function(){return this.B()?0:2*(this.S()+this.da())},T.prototype.gk=function(){return(this.C+this.v)/2},T.prototype.Lp=function(){return(this.H+this.G)/2},T.prototype.S=function(){return this.C-this.v},T.prototype.da=function(){return this.H-this.G},T.prototype.move=function(d,h){this.B()||(this.v+=d,this.G+=h,this.C+=d,this.H+=h)},T.prototype.Ku=function(d,h){if(h!==void 0)this.move(d-this.gk(),h-this.Lp());else if(d instanceof f.h)this.Ku(d.x,d.y);else{if(!(d instanceof f.Ta))throw f.i.O();h=(this.C-this.v)/2;var o=(this.H-this.G)/2;this.v=d.Mg()-h,this.C=d.Mg()+h,this.G=d.jh()-o,this.H=d.jh()+o}},T.prototype.offset=function(d,h){this.v+=d,this.C+=d,this.G+=h,this.H+=h},T.prototype.normalize=function(){if(!this.B()){var d=Math.min(this.v,this.C),h=Math.max(this.v,this.C);this.v=d,this.C=h,d=Math.min(this.G,this.H),h=Math.max(this.G,this.H),this.G=d,this.H=h}},T.prototype.fn=function(d){d.na(this.v,this.G)},T.prototype.SI=function(d){d.na(this.C,this.G)},T.prototype.VI=function(d){d.na(this.v,this.H)},T.prototype.gn=function(d){d.na(this.C,this.H)},T.prototype.WS=function(){return this.B()||this.v<=this.C&&this.G<=this.H},T.prototype.tf=function(){return f.h.construct((this.C+this.v)/2,(this.H+this.G)/2)},T.prototype.hz=function(){return f.h.construct(this.v,this.G)},T.prototype.contains=function(d,h){if(h!==void 0)return d>=this.v&&d<=this.C&&h>=this.G&&h<=this.H;if(d instanceof f.Ta)return this.contains(d.Mg(),d.jh());if(d instanceof f.h)return this.contains(d.x,d.y);if(d instanceof T)return d.v>=this.v&&d.C<=this.C&&d.G>=this.G&&d.H<=this.H;throw f.i.O()},T.prototype.jm=function(d,h){if(h!==void 0)return d>this.v&&d<this.C&&h>this.G&&h<this.H;if(d instanceof f.h)return this.jm(d.x,d.y);if(d instanceof T)return d.v>this.v&&d.C<this.C&&d.G>this.G&&d.H<this.H;throw f.i.O()},T.prototype.Nb=function(d){return d==this||d instanceof T&&(!(!this.B()||!d.B())||this.v==d.v&&this.G==d.G&&this.C==d.C&&this.H==d.H)},T.prototype.dc=function(){var d=this.v;d=f.P.truncate(d^d>>>32);var h=f.P.Uh(d);return d=this.C,d=f.P.truncate(d^d>>>32),h=f.P.Uh(d,h),d=this.G,d=f.P.truncate(d^d>>>32),h=f.P.Uh(d,h),d=this.H,d=f.P.truncate(d^d>>>32),f.P.Uh(d,h)},T.prototype.zr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.v)+Math.abs(this.C)+Math.abs(this.G)+Math.abs(this.H)+1)},T.prototype.ty=function(d,h){var o=this.Zj(d),c=this.Zj(h);if((o&c)!=0)return 0;if((o|c)==0)return 4;var u=(o!=0?1:0)|(c!=0?2:0);do{var m=h.x-d.x,g=h.y-d.y;if(m>g?(o&T.QC)!=0?((o&T.ku)!=0?(d.y+=g*(this.v-d.x)/m,d.x=this.v):(d.y+=g*(this.C-d.x)/m,d.x=this.C),o=this.Zj(d)):(c&T.QC)!=0?((c&T.ku)!=0?(h.y+=g*(this.v-h.x)/m,h.x=this.v):(h.y+=g*(this.C-h.x)/m,h.x=this.C),c=this.Zj(h)):o!=0?((o&T.lu)!=0?(d.x+=m*(this.G-d.y)/g,d.y=this.G):(d.x+=m*(this.H-d.y)/g,d.y=this.H),o=this.Zj(d)):((c&T.lu)!=0?(h.x+=m*(this.G-h.y)/g,h.y=this.G):(h.x+=m*(this.H-h.y)/g,h.y=this.H),c=this.Zj(h)):(o&T.RC)!=0?((o&T.lu)!=0?(d.x+=m*(this.G-d.y)/g,d.y=this.G):(d.x+=m*(this.H-d.y)/g,d.y=this.H),o=this.Zj(d)):(c&T.RC)!=0?((c&T.lu)!=0?(h.x+=m*(this.G-h.y)/g,h.y=this.G):(h.x+=m*(this.H-h.y)/g,h.y=this.H),c=this.Zj(h)):o!=0?((o&T.ku)!=0?(d.y+=g*(this.v-d.x)/m,d.x=this.v):(d.y+=g*(this.C-d.x)/m,d.x=this.C),o=this.Zj(d)):((c&T.ku)!=0?(h.y+=g*(this.v-h.x)/m,h.x=this.v):(h.y+=g*(this.C-h.x)/m,h.x=this.C),c=this.Zj(h)),(o&c)!=0)return 0}while((o|c)!=0);return u},T.prototype.Zj=function(d){return(d.x<this.v?1:0)|(d.x>this.C?1:0)<<1|(d.y<this.G?1:0)<<2|(d.y>this.H?1:0)<<3},T.prototype.Ci=function(d){return!this.B()&&(this.S()<=d||this.da()<=d)},T.prototype.ub=function(d){return d instanceof f.h?Math.sqrt(this.aK(d)):Math.sqrt(this.ox(d))},T.prototype.ox=function(d){var h=0,o=0,c=this.v-d.C;return c>h&&(h=c),(c=this.G-d.H)>o&&(o=c),(c=d.v-this.C)>h&&(h=c),(c=d.G-this.H)>o&&(o=c),h*h+o*o},T.prototype.aK=function(d){var h=0,o=0,c=this.v-d.x;return c>h&&(h=c),(c=this.G-d.y)>o&&(o=c),(c=d.x-this.C)>h&&(h=c),(c=d.y-this.H)>o&&(o=c),h*h+o*o},T.prototype.en=function(d){this.B()?d.Pa():d.L(this.v,this.C)},T.ku=1,T.lu=4,T.QC=3,T.RC=12,T}();f.l=N}(ae||(ae={})),function(f){var N,T;(T=N||(N={}))[T.initialize=0]="initialize",T[T.initializeRed=1]="initializeRed",T[T.initializeBlue=2]="initializeBlue",T[T.initializeRedBlue=3]="initializeRedBlue",T[T.sweep=4]="sweep",T[T.sweepBruteForce=5]="sweepBruteForce",T[T.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce",T[T.sweepRedBlue=7]="sweepRedBlue",T[T.sweepRed=8]="sweepRed",T[T.sweepBlue=9]="sweepBlue",T[T.iterate=10]="iterate",T[T.iterateRed=11]="iterateRed",T[T.iterateBlue=12]="iterateBlue",T[T.iterateBruteForce=13]="iterateBruteForce",T[T.iterateRedBlueBruteForce=14]="iterateRedBlueBruteForce",T[T.resetRed=15]="resetRed",T[T.resetBlue=16]="resetBlue";var d=function(){function h(o,c){this.di=o,this.WG=c}return h.prototype.qr=function(o,c,u){this.di.xX(u,o,c,this.WG)},h.prototype.bq=function(o){return this.di.Sr(o,this.WG)},h}();N=function(){function h(){this.pw=this.po=this.ff=this.sd=null,this.yq=new f.l,this.Cm=this.Ij=this.Jj=this.Bd=this.Ff=this.Md=this.dw=this.ho=this.rd=this.Fb=null,this.Yb=-1,this.ra=0,this.Nk()}return h.prototype.mr=function(){this.Nk(),this.Qv=!0,this.Fb==null?(this.ho=new f.ja(0),this.Fb=[]):(this.ho.Ch(0),this.Fb.length=0)},h.prototype.bd=function(o,c){if(!this.Qv)throw f.i.Hb();var u=new f.l;u.L(c),this.ho.add(o),this.Fb.push(u)},h.prototype.Hp=function(){if(!this.Qv)throw f.i.Hb();this.Qv=!1,this.Fb!=null&&0<this.Fb.length&&(this.Yb=0,this.Jc=!1)},h.prototype.hK=function(){this.Nk(),this.Pv=!0,this.Fb==null?(this.ho=new f.ja(0),this.Fb=[]):(this.ho.Ch(0),this.Fb.length=0)},h.prototype.AD=function(o,c){if(!this.Pv)throw f.i.Hb();var u=new f.l;u.L(c),this.ho.add(o),this.Fb.push(u)},h.prototype.aF=function(){if(!this.Pv)throw f.i.Hb();this.Pv=!1,this.Fb!=null&&0<this.Fb.length&&this.rd!=null&&0<this.rd.length&&(this.Yb==-1||this.Yb==2?this.Yb=3:this.Yb!=3&&(this.Yb=1),this.Jc=!1)},h.prototype.gK=function(){this.Nk(),this.Ov=!0,this.rd==null?(this.dw=new f.ja(0),this.rd=[]):(this.dw.Ch(0),this.rd.length=0)},h.prototype.wD=function(o,c){if(!this.Ov)throw f.i.Hb();var u=new f.l;u.L(c),this.dw.add(o),this.rd.push(u)},h.prototype.$E=function(){if(!this.Ov)throw f.i.Hb();this.Ov=!1,this.Fb!=null&&0<this.Fb.length&&this.rd!=null&&0<this.rd.length&&(this.Yb==-1||this.Yb==1?this.Yb=3:this.Yb!=3&&(this.Yb=2),this.Jc=!1)},h.prototype.next=function(){if(this.Jc)return!1;for(var o=!0;o;)switch(this.Yb){case 0:o=this.Bz();break;case 1:o=this.iS();break;case 2:o=this.fS();break;case 3:o=this.hS();break;case 4:o=this.IX();break;case 5:o=this.EX();break;case 6:o=this.FX();break;case 7:o=this.GX();break;case 8:o=this.sx();break;case 9:o=this.bC();break;case 10:o=this.Pz();break;case 11:o=this.$S();break;case 12:o=this.XS();break;case 13:o=this.YS();break;case 14:o=this.ZS();break;case 15:o=this.cJ();break;case 16:o=this.bJ();break;default:throw f.i.Ra()}return!this.Jc},h.prototype.UB=function(o){this.ra=o},h.prototype.oz=function(o){return this.Fb[o]},h.prototype.Wy=function(o){return this.rd[o]},h.prototype.pl=function(o){return this.ho.read(o)},h.prototype.jl=function(o){return this.dw.read(o)},h.Oz=function(o){return(1&o)==1},h.gq=function(o){return(1&o)==0},h.prototype.Nk=function(){this.Qv=this.Ov=this.Pv=!1,this.Df=this.Ef=this.Sg=this.pe=-1,this.Jc=!0},h.prototype.Bz=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length)return this.pe=this.Fb.length,this.Yb=5,!0;this.sd==null&&(this.sd=new f.ur(!0),this.po=this.sd.getIterator(),this.Md=new f.ja(0)),this.sd.mr();for(var o=0;o<this.Fb.length;o++){var c=this.Fb[o];this.sd.Dr(c.v,c.C)}for(this.sd.Hp(),this.Md.Jb(2*this.Fb.length),this.Md.resize(0),o=0;o<2*this.Fb.length;o++)this.Md.add(o);return this.Lt(this.Md,2*this.Fb.length,!0),this.pe=2*this.Fb.length,this.Yb=4,!0},h.prototype.iS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;this.sd==null&&(this.sd=new f.ur(!0),this.po=this.sd.getIterator(),this.Md=new f.ja(0)),this.sd.mr();for(var o=0;o<this.Fb.length;o++){var c=this.Fb[o];this.sd.Dr(c.v,c.C)}for(this.sd.Hp(),this.Md.Jb(2*this.Fb.length),this.Md.resize(0),o=0;o<2*this.Fb.length;o++)this.Md.add(o);return this.Lt(this.Md,this.Md.size,!0),this.pe=this.Md.size,this.Ef!=-1&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),this.Yb=7,this.bJ()},h.prototype.fS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;this.ff==null&&(this.ff=new f.ur(!0),this.pw=this.ff.getIterator(),this.Ff=new f.ja(0)),this.ff.mr();for(var o=0;o<this.rd.length;o++){var c=this.rd[o];this.ff.Dr(c.v,c.C)}for(this.ff.Hp(),this.Ff.Jb(2*this.rd.length),this.Ff.resize(0),o=0;o<2*this.rd.length;o++)this.Ff.add(o);return this.Lt(this.Ff,this.Ff.size,!1),this.Sg=this.Ff.size,this.Df!=-1&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Yb=7,this.cJ()},h.prototype.hS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;this.sd==null&&(this.sd=new f.ur(!0),this.po=this.sd.getIterator(),this.Md=new f.ja(0)),this.ff==null&&(this.ff=new f.ur(!0),this.pw=this.ff.getIterator(),this.Ff=new f.ja(0)),this.sd.mr();for(var o=0;o<this.Fb.length;o++){var c=this.Fb[o];this.sd.Dr(c.v,c.C)}for(this.sd.Hp(),this.ff.mr(),o=0;o<this.rd.length;o++)c=this.rd[o],this.ff.Dr(c.v,c.C);for(this.ff.Hp(),this.Md.Jb(2*this.Fb.length),this.Ff.Jb(2*this.rd.length),this.Md.resize(0),this.Ff.resize(0),o=0;o<2*this.Fb.length;o++)this.Md.add(o);for(o=0;o<2*this.rd.length;o++)this.Ff.add(o);return this.Lt(this.Md,this.Md.size,!0),this.Lt(this.Ff,this.Ff.size,!1),this.pe=this.Md.size,this.Sg=this.Ff.size,this.Ef!=-1&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),this.Df!=-1&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Yb=7,!0},h.prototype.IX=function(){var o=this.Md.get(--this.pe),c=o>>1;return h.gq(o)?(this.sd.remove(c),this.pe!=0||(this.Bf=this.Wf=-1,this.Jc=!0,!1)):(this.po.yB(this.Fb[c].v,this.Fb[c].C,this.ra),this.Wf=c,this.Yb=10,!0)},h.prototype.EX=function(){return--this.pe==-1?(this.Bf=this.Wf=-1,this.Jc=!0,!1):(this.Sg=this.Wf=this.pe,this.Yb=13,!0)},h.prototype.FX=function(){return--this.pe==-1?(this.Bf=this.Wf=-1,this.Jc=!0,!1):(this.Wf=this.pe,this.Sg=this.rd.length,this.Yb=14,!0)},h.prototype.GX=function(){var o=this.Md.get(this.pe-1),c=this.Ff.get(this.Sg-1),u=this.Sr(o,!0),m=this.Sr(c,!1);return u>m?this.sx():u<m?this.bC():h.Oz(o)?this.sx():h.Oz(c)?this.bC():this.sx()},h.prototype.sx=function(){var o=this.Md.get(--this.pe),c=o>>1;if(h.gq(o))return this.Ef!=-1&&this.Jj.get(c)!=-1?(this.Bd.kd(this.Ef,this.Jj.get(c)),this.Jj.set(c,-1)):this.sd.remove(c),this.pe!=0||(this.Bf=this.Wf=-1,this.Jc=!0,!1);if(this.Df!=-1&&0<this.Bd.cs(this.Df))for(o=this.Bd.sc(this.Df);o!=-1;){var u=this.Bd.getData(o);this.ff.wj(u),this.Ij.set(u,-1),u=this.Bd.lb(o),this.Bd.kd(this.Df,o),o=u}return 0<this.ff.size()?(this.pw.yB(this.Fb[c].v,this.Fb[c].C,this.ra),this.Wf=c,this.Yb=12):(this.Ef==-1&&(this.Bd==null&&(this.Bd=new f.kp),this.Jj=new f.ja(0),this.Jj.resize(this.Fb.length,-1),this.Jj.Xj(-1,0,this.Fb.length),this.Ef=this.Bd.Qh(1)),this.Jj.set(c,this.Bd.addElement(this.Ef,c)),this.Yb=7),!0},h.prototype.bC=function(){var o=this.Ff.get(--this.Sg),c=o>>1;if(h.gq(o))return this.Df!=-1&&this.Ij.get(c)!=-1?(this.Bd.kd(this.Df,this.Ij.get(c)),this.Ij.set(c,-1)):this.ff.remove(c),this.Sg!=0||(this.Bf=this.Wf=-1,this.Jc=!0,!1);if(this.Ef!=-1&&0<this.Bd.cs(this.Ef))for(o=this.Bd.sc(this.Ef);o!=-1;){var u=this.Bd.getData(o);this.sd.wj(u),this.Jj.set(u,-1),u=this.Bd.lb(o),this.Bd.kd(this.Ef,o),o=u}return 0<this.sd.size()?(this.po.yB(this.rd[c].v,this.rd[c].C,this.ra),this.Bf=c,this.Yb=11):(this.Df==-1&&(this.Bd==null&&(this.Bd=new f.kp),this.Ij=new f.ja(0),this.Ij.resize(this.rd.length,-1),this.Ij.Xj(-1,0,this.rd.length),this.Df=this.Bd.Qh(0)),this.Ij.set(c,this.Bd.addElement(this.Df,c)),this.Yb=7),!0},h.prototype.Pz=function(){if(this.Bf=this.po.next(),this.Bf!=-1)return!1;var o=this.Md.get(this.pe)>>1;return this.sd.wj(o),this.Yb=4,!0},h.prototype.$S=function(){if(this.Wf=this.po.next(),this.Wf!=-1)return!1;this.Bf=this.Wf=-1;var o=this.Ff.get(this.Sg)>>1;return this.ff.wj(o),this.Yb=7,!0},h.prototype.XS=function(){if(this.Bf=this.pw.next(),this.Bf!=-1)return!1;var o=this.Md.get(this.pe)>>1;return this.sd.wj(o),this.Yb=7,!0},h.prototype.YS=function(){if(--this.Sg==-1)return this.Yb=5,!0;this.yq.L(this.Fb[this.pe]);var o=this.Fb[this.Sg];return this.yq.X(this.ra,this.ra),!this.yq.isIntersecting(o)||(this.Bf=this.Sg,!1)},h.prototype.ZS=function(){if(--this.Sg==-1)return this.Yb=6,!0;this.yq.L(this.Fb[this.pe]);var o=this.rd[this.Sg];return this.yq.X(this.ra,this.ra),!this.yq.isIntersecting(o)||(this.Bf=this.Sg,!1)},h.prototype.cJ=function(){return this.sd==null?(this.Jc=!0,!1):(this.pe=this.Md.size,0<this.sd.size()&&this.sd.reset(),this.Ef!=-1&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),this.Jc=!1,!0)},h.prototype.bJ=function(){return this.ff==null?(this.Jc=!0,!1):(this.Sg=this.Ff.size,0<this.ff.size()&&this.ff.reset(),this.Df!=-1&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Jc=!1,!0)},h.prototype.Lt=function(o,c,u){this.Cm==null&&(this.Cm=new f.Yt),u=new d(this,u),this.Cm.sort(o,0,c,u)},h.prototype.xX=function(o,c,u,m){var g=this;o.Wd(c,u,function(v,w){var E=g.Sr(v,m),C=g.Sr(w,m);return E<C||E==C&&h.gq(v)&&h.Oz(w)?-1:1})},h.prototype.Sr=function(o,c){var u=.5*this.ra;return c?(c=this.Fb[o>>1],h.gq(o)?c.G-u:c.H+u):(c=this.rd[o>>1],h.gq(o)?c.G-u:c.H+u)},h}(),f.qC=N}(ae||(ae={})),function(f){var N=function(){function T(){}return T.construct=function(d,h,o,c,u,m){var g=new T;return g.v=d,g.G=h,g.Xe=o,g.C=c,g.H=u,g.Dg=m,g},T.prototype.Pa=function(){this.Xe=this.v=NaN},T.prototype.B=function(){return isNaN(this.v)},T.prototype.NS=function(){return isNaN(this.Xe)},T.prototype.L=function(d,h,o,c,u,m){c!==void 0?typeof d=="number"?(this.v=d,this.G=h,this.Xe=o,this.C=c,this.H=u,this.Dg=m):(this.v=d.x-.5*h,this.C=this.v+h,this.G=d.y-.5*o,this.H=this.G+o,this.Xe=d.z-.5*c,this.Dg=this.Xe+c):(this.v=d,this.G=h,this.Xe=o,this.C=d,this.H=h,this.Dg=o)},T.prototype.move=function(d){this.v+=d.x,this.G+=d.y,this.Xe+=d.z,this.C+=d.x,this.H+=d.y,this.Dg+=d.z},T.prototype.copyTo=function(d){d.v=this.v,d.G=this.G,d.C=this.C,d.H=this.H},T.prototype.Lk=function(d,h,o){this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>h?this.G=h:this.H<h&&(this.H=h),isNaN(this.Xe)==0?this.Xe>o?this.Xe=o:this.Dg<o&&(this.Dg=o):this.Dg=this.Xe=o},T.prototype.$b=function(d,h,o){if(typeof d=="number")this.B()?(this.v=d,this.G=h,this.Xe=o,this.C=d,this.H=h,this.Dg=o):this.Lk(d,h,o);else if(d instanceof f.Od)this.$b(d.x,d.y,d.z);else{if(!(d instanceof T))throw f.i.O();d.B()||(this.$b(d.v,d.G,d.Xe),this.$b(d.C,d.H,d.Dg))}},T.prototype.construct=function(d,h,o){d.B()||h.B()?this.Pa():(this.v=d.pa,this.C=d.wa,this.G=h.pa,this.H=h.wa,this.Xe=o.pa,this.Dg=o.wa)},T.prototype.hB=function(d){if(d==null||8>d.length)throw f.i.O();d[0]=new f.Od(this.v,this.G,this.Xe),d[1]=new f.Od(this.v,this.H,this.Xe),d[2]=new f.Od(this.C,this.H,this.Xe),d[3]=new f.Od(this.C,this.G,this.Xe),d[4]=new f.Od(this.v,this.G,this.Dg),d[5]=new f.Od(this.v,this.H,this.Dg),d[6]=new f.Od(this.C,this.H,this.Dg),d[7]=new f.Od(this.C,this.G,this.Dg)},T.prototype.ax=function(d){if(d==null||d.length==0)this.Pa();else{var h=d[0];for(this.L(h.x,h.y,h.z),h=1;h<d.length;h++){var o=d[h];this.Lk(o.x,o.y,o.z)}}},T}();f.GK=N}(ae||(ae={})),function(f){(function(N){N.Ra=function(){var T=Error();return T.message="Internal Error",T},N.Fe=function(){var T=Error();return T.message="Not Implemented",T},N.Yk=function(){var T=Error();return T.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular",T},N.Hb=function(){var T=Error();return T.message="Invalid Call",T},N.O=function(T){var d=Error();return d.message="Illegal Argument Exception",T!==void 0&&(d.message+=": "+T),d},N.gu=function(T){var d=Error();return d.message=T!==void 0?"Runtime Exception: "+T:"Runtime Exception.",d},N.ga=function(T){var d=Error();return d.message="Geometry Exception: "+T,d},N.yK=function(){var T=Error();return T.message="Assert Failed Exception",T},N.re=function(){var T=Error();return T.message="IndexOutOfBoundsException",T},N.OC=function(){var T=Error();return T.message="UserCancelException",T}})(f.i||(f.i={}))}(ae||(ae={})),function(f){(f=f.dm||(f.dm={}))[f.forward=0]="forward",f[f.reverse=1]="reverse"}(ae||(ae={})),function(f){var N=function(){function h(o,c){this.Xa=o,this.xH=c,this.DH=-1,this.ul=!1}return h.prototype.qe=function(){},h.prototype.next=function(){if(++this.DH==this.xH.I())return null;var o=this.xH.Oa(this.DH);o.scale(this.Xa.fc);var c=new f.Ea;return this.Xa.my(o,this.ul,c),c},h.prototype.Ma=function(){return 0},h}(),T=function(){function h(o,c,u){this.Xa=o,this.sw=c,this.Yn=!1,this.eo=u,this.cw=[0],this.sk=[0],this.Oj=[0],this.Hs=[0],this.ul=!1,this.sq=new f.Ea,this.uk=[]}return h.prototype.qe=function(){},h.prototype.next=function(){if(this.Yn){this.Yn=!1,this.td.ia();var o=f.ba.ig(this.sq);return f.Hg.Mk(o,this.Xa.Cq,!0,!0,this.Xa.Vb)}if(this.td==null&&(this.td=this.sw.Ha(),this.td.ab(),this.eo!=null&&this.eo.Zk(null,0)),!this.td.Ia()){if(!this.td.ab())return null;this.eo!=null&&this.eo.Zk(null,0)}o=null,this.sk[0]=0,this.zA=this.cw[0]=0,this.ei=NaN,this.Yn=!1;for(var c=this.uk.length=0,u=new f.h,m=new f.h,g=[0];this.td.Ia()&&8>this.zA;){var v=this.td.ia();if(u.N(v.ac()),m.N(v.xc()),u.scale(this.Xa.fc),m.scale(this.Xa.fc),f.dj.Ou(u,m)?u.x=m.x:f.dj.Mu(u,m)&&(m.x=u.x),this.uk.length=0,f.dj.lF(this.Xa.Ub,this.Xa.lc,this.Xa.Ae,u,m,this.Xa.KA,this.Xa.$s,g,this.Oj,this.Hs,this.uk,this.cw),this.eo!=null&&(v=this.uk.slice(0),this.eo.iG(this.eo.ea()-1,v,v.length-1)),f.dj.Nu(u,m)?(this.sq.Pa(),this.Xa.my(u,this.ul,this.sq),this.Yn=!0):(this.sq.Pa(),this.Yn=this.ry(g[0],this.sq)),this.Yn){if(this.td.mi(),this.td.zz()){this.td.mi(),this.td.ia();break}this.td.sW();break}o==null&&(o=new f.Ea).Zk(null,0),this.FD(o),c++}if(this.cw[0]=0,0<c){for(g=this.td.xb();0<c;)this.td.mi(),u.N(this.sw.Oa(this.td.xb())),m.N(this.sw.Oa(this.td.ik())),u.scale(this.Xa.fc),m.scale(this.Xa.fc),this.ul&&(f.dj.Ou(u,m)?u.x=m.x:f.dj.Mu(u,m)&&(m.x=u.x)),this.uk.length=0,f.dj.lF(this.Xa.Ub,this.Xa.lc,this.Xa.Ae,m,u,this.Xa.KA,this.Xa.$s,null,this.Oj,this.Hs,this.uk,this.cw),this.FD(o),c--;return u.N(this.sw.Oa(this.td.xb())),u.scale(this.Xa.fc),d.Jr(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,u,this.ei+1.570796326794897,this.ei+4.71238898038469,this.Xa.bo,this.ul,this.sk,o,NaN,NaN),this.td.Wb(g),this.td.ia(),c=f.ta.lj(null,o,!0),f.Hg.Mk(o,c,!0,!0,this.Xa.Vb)}return this.Yn=!1,this.td.ia(),o=f.ba.ig(this.sq),f.Hg.Mk(o,this.Xa.Cq,!0,!0,this.Xa.Vb)},h.prototype.FD=function(o){var c=this.uk[0],u=this.Oj[0]-1.570796326794897,m=this.Hs[0]+1.570796326794897;if(!isNaN(this.ei)){if(this.ei>=this.Oj[0]){var g=this.ei+1.570796326794897;u=g+3.141592653589793-(this.ei-this.Oj[0])}else u=(g=this.ei+1.570796326794897)+3.141592653589793-(6.283185307179586-(this.Oj[0]-this.ei));var v=!(this.ei>=this.Oj[0]&&3.141592653589793>=this.ei-this.Oj[0])&&!(this.ei<this.Oj[0]&&3.141592653589793<=this.Oj[0]-this.ei),w=!1;if(Math.abs(u-g)<=.5*this.Xa.bo)if(v){var E=o.Oa(o.I()-2);E.scale(this.Xa.fc);var C=new f.ha(0);for(f.kb.Sy(this.Xa.Ub,this.Xa.lc,c.x,c.y,E.x,E.y,C),E=C.u;E<=g;)E+=6.283185307179586;for(;E>g;)E-=6.283185307179586;E<u&&(w=!0)}else w=!0;w?(o.xB(0,o.I()-1),this.ul||((c=new f.h).N(o.Oa(o.I()-1)),c.scale(this.Xa.fc),-3.141592653589793>c.x-this.sk[0]?this.sk[0]-=6.283185307179586:3.141592653589793<c.x-this.sk[0]&&(this.sk[0]+=6.283185307179586)),v||(u=.5*(u+g))):(v?((g=new f.h).N(c),g.scale(1/this.Xa.fc),o.xf(0,-1,g)):d.Jr(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,this.uk[0],g,u,this.Xa.bo,this.ul,this.sk,o,NaN,NaN),this.zA+=1)}d.ly(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,this.Xa.Ae,this.uk,u,m,this.ul,this.sk,o),this.ei=this.Hs[0]},h.prototype.ry=function(o,c){return this.Xa.ry(this.uk,o,this.Oj[0],this.Hs[0],this.ul,c)},h.prototype.Ma=function(){return 0},h}(),d=function(){function h(){}return h.buffer=function(o,c,u,m,g,v){if(o==null)throw f.i.O("Geometry::Geodesic_bufferer::buffer");if(o.B())return new f.Ea(o.description);var w=new h;w.Rg=c,w.Kc=f.cb.tc(c);var E=f.cb.wv(w.Kc);if(w.Vb=v,w.Ub=f.cb.fv(w.Kc),w.lc=E*(2-E),w.fc=w.Kc.Id().bi,w.ra=w.Rg.Ln(),w.Cq=w.Kc.Ln(),w.$s=w.Cq*w.fc,w.Bq=1.570796326794897/w.fc,w.DY=3.141592653589793/w.fc,w.Ks=6.283185307179586/w.fc,w.EY=w.Ks/6,w.FA=0,w.CY=1.5707963267948966*w.Ub/w.FA,u==4?(w.Ae=2,w.Xv=!0):(w.Ae=u,w.Xv=!1),w.La=m,w.sb=Math.abs(m),isNaN(g)||.001>g?w.lX():w.ao=g,u=o.K(),f.ba.zd(u)?((u=new f.Ua(o.description)).oc(o,!0),o=u,u=1607):u==197&&(u=new f.l,o.A(u),u.S()<=w.ra||u.da()<=w.ra?((u=new f.Ua(o.description)).bd(o,!1),o=u,u=1607):((u=new f.Ea(o.description)).bd(o,!1),o=u,u=1736)),w.mX(),f.ba.Sn(u)||w.nX(),w.sb<=.5*w.ao)return u!=1736?new f.Ea(o.description):w.Xv?o:f.dj.Rr(o,w.Rg,w.Ae,w.KA,-1,v);if(0>w.La&&u!=1736)return new f.Ea(o.description);if(w.Xv&&f.ba.Ic(u)?(c=f.dj.Rr(o,c,4,NaN,w.ao,v),o=f.cb.Ah(c,w.Rg,w.Kc)):o=f.cb.Ah(o,w.Rg,w.Kc),(o=f.Ih.mj(o,w.Kc)).B())return new f.Ea(o.description);switch(!w.Xv&&f.ba.Ic(u)&&(o=f.dj.hI(w.fc,o)),o=h.yX(o,w.Kc),u){case 1736:c=w.MN(o);break;case 1607:c=w.NN(o);break;case 550:c=w.KN(o);break;case 33:c=w.LN(o);break;default:throw f.i.ga("corrupted_geometry")}return(w=f.cb.Ah(c,w.Kc,w.Rg)).Ll(o.description),w},h.prototype.MN=function(o){var c=new f.Ea;o=new T(this,o,c),o=f.Hh.local().W(o,this.Kc,this.Vb).next(),o=f.jp.oj(o,this.Kc,2);var u=new f.Ed;return u.scale(1/this.fc,1/this.fc),c.Pc(u),c=f.jp.oj(c,this.Kc,2),0<=this.La?f.Hh.local().W(c,o,this.Kc,this.Vb):f.lp.local().W(c,o,this.Kc,this.Vb)},h.prototype.NN=function(o){return o=new T(this,o,null),o=f.Hh.local().W(o,this.Kc,this.Vb).next(),f.jp.oj(o,this.Kc,2)},h.prototype.KN=function(o){return o=new N(this,o),o=f.Hh.local().W(o,this.Kc,this.Vb).next(),f.jp.oj(o,this.Kc,2)},h.prototype.LN=function(o){(o=o.D()).scale(this.fc);var c=new f.Ea;return this.my(o,!1,c),f.jp.oj(c,this.Kc,2)},h.prototype.ry=function(o,c,u,m,g,v){var w=o[0],E=o[o.length-1],C=w.y>E.y?w.y:E.y,R=f.F.q(this.Ub,this.lc,w.y<E.y?w.y:E.y);if(C=f.F.q(this.Ub,this.lc,C),.001<this.FA-(R+c+this.sb)&&.001<this.FA+(C-c-this.sb))return!1;R=(c=u-1.570796326794897)-3.141592653589793,C=c+3.141592653589793;var I=(u=m+1.570796326794897)+3.141592653589793,F=[NaN],U=[NaN],j=[NaN],ee=[NaN];if(m=!1,h.WI(this.Ub,this.lc,this.sb,w,c,R,E,u,F,U),h.WI(this.Ub,this.lc,this.sb,E,I,u,w,R,j,ee),(u<F[0]&&F[0]<I||u<U[0]&&U[0]<I)&&(m=!0),m||(R<j[0]&&j[0]<c||R<ee[0]&&ee[0]<c)&&(m=!0),!m&&g)return!1;for(var te=[],Z=o.length-1;0<=Z;Z--)te.push(o[Z]);return v.Pa(),v.Zk(null,0),Z=[0],h.ly(this.Ub,this.lc,this.fc,this.sb,this.Ae,o,c,u,g,Z,v),h.Jr(this.Ub,this.lc,this.fc,this.sb,E,u,I,this.bo,g,Z,v,F[0],U[0]),h.ly(this.Ub,this.lc,this.fc,this.sb,this.Ae,te,I,C,g,Z,v),h.Jr(this.Ub,this.lc,this.fc,this.sb,w,R,c,this.bo,g,Z,v,j[0],ee[0]),o=!1,g||(o=this.AE(this.fc,v)),m||o},h.prototype.my=function(o,c,u){u.Pa(),u.Zk(null,0),h.Jr(this.Ub,this.lc,this.fc,this.sb,o,-this.bo,6.283185307179586,this.bo,c,[0],u,NaN,NaN),c||this.AE(this.fc,u)},h.prototype.AE=function(o,c){var u=this.nO(o,c);return o=this.oO(o,c),u||o},h.prototype.nO=function(o,c){var u=c.I(),m=!1,g=new f.l;if(c.A(g),!f.s.$(g.H*o,1.570796326794897)&&!f.s.$(g.G*o,-1.570796326794897))return!1;var v=new f.h;for(--u;0<=u;u--)c.D(u,v),(v.y==g.H&&f.s.$(v.y*o,1.570796326794897)||v.y==g.G&&f.s.$(v.y*o,-1.570796326794897))&&(m=!0,this.GI(v,u,c));return m},h.prototype.oO=function(o,c){var u=c.Oa(0),m=c.Oa(c.I()-1);return 3.141592653589793<Math.abs(u.x-m.x)*o?(this.LV(c),!0):this.mO(c)},h.prototype.mO=function(o){return 0>o.He()&&(this.KV(o),!0)},h.prototype.GI=function(o,c,u){var m=u.I(),g=0<c?c-1:m-1;if(m=u.Oa(c<m-1?c+1:0),g=u.Oa(g),!f.s.$(m.y,o.y)&&!f.s.$(m.x,o.x)){var v=new f.h;v.na(m.x,o.y),u.Db(c,v)}f.s.$(g.y,o.y)||f.s.$(g.x,o.x)||((m=new f.h).na(g.x,o.y),u.xf(0,c,m))},h.prototype.LV=function(o){var c=new f.Ea,u=new f.Ea,m=new f.Ed,g=o.Oa(0),v=o.Oa(o.I()-1),w=new f.h;g.x>v.x?(v=this.Bq,m.gg(-this.Ks,0)):(v=-this.Bq,m.gg(this.Ks,0)),c.add(o,!1),o.Pa(),u.add(c,!1),u.Pc(m),g=new f.l,u.A(g),g.X((this.Ks-g.S())/2,0),g.G=-this.Bq,g.H=this.Bq;for(var E=0;E<u.I();E++)u.D(E,w),c.xf(0,-1,w);for(u.Pc(m),E=0;E<u.I();E++)u.D(E,w),c.xf(0,-1,w);u=c.Oa(0),m=c.Oa(c.I()-1),w.na(m.x,v),c.xf(0,-1,w),w.na(.5*(m.x+u.x),v),c.xf(0,-1,w),w.na(u.x,v),c.xf(0,-1,w),c=f.Ih.ls(c,this.Kc,2,!0,g.v),c=f.Ih.ls(c,this.Kc,2,!0,g.C),c=f.Vd.clip(c,g,this.Cq,NaN),o.add(c,!1)},h.prototype.KV=function(o){var c=new f.l;o.A(c),c.X((this.Ks-c.S())/2,0),c.G=-this.Bq,c.H=this.Bq,o.Zk(null,0);var u=new f.h;u.na(c.v,c.G),o.xf(1,-1,u),u.na(c.v,c.H),o.xf(1,-1,u),u.na(.5*(c.v+c.C),c.H),o.xf(1,-1,u),u.na(c.C,c.H),o.xf(1,-1,u),u.na(c.C,c.G),o.xf(1,-1,u),u.na(.5*(c.v+c.C),c.G),o.xf(1,-1,u)},h.ly=function(o,c,u,m,g,v,w,E,C,R,I){var F=null;C||((F=new f.h).Sc(),0<I.I()&&(F.N(I.Oa(I.I()-1)),F.scale(u)));var U=new f.ha(0),j=new f.ha(0),ee=new f.ha(0),te=new f.h,Z=new f.h,le=v[v.length-1];u=1/u;for(var ve=0;ve<v.length;ve++){var be=v[ve];if(ve==0)var ue=w;else ve==v.length-1?ue=E:(f.kb.xd(o,c,le.x,le.y,be.x,be.y,null,null,U,g),ue=U.u-1.570796326794897);f.kb.zi(o,c,be.x,be.y,m,ue,j,ee),C?Z.na(j.u,ee.u):(te.na(j.u,ee.u),h.ZI(be.x,te.x,F.x,R),Z.na(R[0]+te.x,te.y),F.N(Z)),Z.scale(u),I.xf(0,-1,Z)}},h.Jr=function(o,c,u,m,g,v,w,E,C,R,I,F,U){if(!(w-v<E)){var j=new f.ha(0),ee=new f.ha(0),te=new f.h,Z=new f.h,le=null;C||((le=new f.h).Sc(),0<I.I()&&(le.N(I.Oa(I.I()-1)),le.scale(u)));var ve=f.P.truncate(Math.ceil(v/E)),be=ve++*E;for(be==v&&(be=ve++*E),u=1/u;be<w+E&&(v<F&&F<be?(be=F,ve--):v<U&&U<be&&(be=U,ve--),!(be>=w));)f.kb.zi(o,c,g.x,g.y,m,be,j,ee),C?Z.na(j.u,ee.u):(te.na(j.u,ee.u),h.ZI(g.x,te.x,le.x,R),Z.na(R[0]+te.x,te.y),le.N(Z)),Z.scale(u),I.xf(0,-1,Z),v=be,be=ve++*E}},h.WI=function(o,c,u,m,g,v,w,E,C,R){var I=new f.h,F=new f.h,U=new f.ha(0),j=new f.ha(0);for(f.kb.zi(o,c,m.x,m.y,u,g,U,j),I.na(U.u,j.u),f.kb.zi(o,c,m.x,m.y,u,v,U,j),F.na(U.u,j.u),u=new f.ha(0),f.kb.Sy(o,c,w.x,w.y,I.x,I.y,u),C[0]=u.u,f.kb.Sy(o,c,w.x,w.y,F.x,F.y,u),R[0]=u.u;C[0]<=R[0];)C[0]+=6.283185307179586;for(;C[0]>R[0];)C[0]-=6.283185307179586;for(;C[0]>=E;)C[0]-=6.283185307179586,R[0]-=6.283185307179586;for(;C[0]<E;)C[0]+=6.283185307179586,R[0]+=6.283185307179586},h.ZI=function(o,c,u,m){if(isNaN(u)){for(;3.141592653589793<m[0]+c-o;)m[0]-=6.283185307179586;for(;3.141592653589793<o-(m[0]+c);)m[0]+=6.283185307179586}else 3.141592653589793<m[0]+c-u?m[0]-=6.283185307179586:3.141592653589793<u-(m[0]+c)&&(m[0]+=6.283185307179586)},h.yX=function(o,c){var u=o.K(),m=f.ba.Ic(u)?o.ea():u==550?o.I():1;if(m==1)return o;var g=new f.ja(0);g.resize(m);for(var v=[],w=new f.l,E=0;E<m;E++){if(g.write(E,E),f.ba.Ic(u)){o.Sj(E,w);var C=w.tf()}else C=o.Oa(E);C=f.PK.OX(c,C),v[E]=C}for(g.Wd(0,g.size,function(R,I){return v[R]<v[I]?-1:v[R]>v[I]?1:0}),c=o.Ja(),E=0;E<m;E++)w=g.read(E),f.ba.Ic(u)?c.addPath(o,w,!0):c.Gd(o,w,w+1);return c},h.prototype.mX=function(){var o=Math.min(3.141592653589793*this.Ub-this.sb,this.sb);o=Math.min(o,.39269908169872414*this.Ub);var c=new f.h;c.na(0,10*this.fc);var u=45*this.fc,m=new f.ha(0),g=new f.ha(0),v=new f.ha(0),w=new f.ha(0),E=new f.ha(0),C=new f.ha(0),R=new f.ha(0),I=new f.ha(0),F=new f.h,U=new f.h,j=new f.h,ee=new f.h;f.kb.zi(this.Ub,this.lc,c.x,c.y,o,0,m,g),F.na(m.u,g.u),f.kb.zi(this.Ub,this.lc,c.x,c.y,o,u,v,w),U.na(v.u,w.u),m=new f.ha(0),g=new f.ha(0);for(var te=new f.ha(0);f.kb.zi(this.Ub,this.lc,c.x,c.y,o,.5*(0+u),E,C),j.na(E.u,C.u),f.kb.xd(this.Ub,this.lc,F.x,F.y,U.x,U.y,m,g,null,2),f.kb.pj(this.Ub,this.lc,F.x,F.y,.5*m.u,g.u,R,I,2),ee.na(R.u,I.u),f.kb.xd(this.Ub,this.lc,j.x,j.y,ee.x,ee.y,te,null,null,2),!(te.u<=this.ao);)u*=.9,f.kb.zi(this.Ub,this.lc,c.x,c.y,o,u,v,w),U.na(v.u,w.u);this.bo=6.283185307179586/Math.ceil(6.283185307179586/(u-0))},h.prototype.nX=function(){var o=Math.min(3.141592653589793*this.Ub-this.sb,this.sb);o=Math.min(o,.39269908169872414*this.Ub);var c=new f.h,u=new f.h;c.na(0,10*this.fc),u.na(10*this.fc,10*this.fc);var m=new f.ha(0),g=new f.ha(0),v=new f.ha(0);f.kb.xd(this.Ub,this.lc,c.x,c.y,u.x,u.y,v,m,g,this.Ae);var w=new f.ha(0),E=new f.ha(0),C=new f.ha(0),R=new f.ha(0),I=new f.h,F=new f.ha(0),U=new f.ha(0),j=new f.ha(0),ee=new f.ha(0),te=new f.ha(0),Z=new f.ha(0),le=new f.ha(0),ve=new f.ha(0),be=new f.ha(0),ue=new f.h,Le=new f.h,Be=new f.h,it=new f.h,Ke=1;m=m.u,g=g.u+1.570796326794897,v=v.u,f.kb.zi(this.Ub,this.lc,c.x,c.y,o,m-1.570796326794897,U,j),ue.na(U.u,j.u),f.kb.zi(this.Ub,this.lc,u.x,u.y,o,g,ee,te),Le.na(ee.u,te.u),U=new f.ha(0),j=new f.ha(0),g=new f.ha(0);for(var Je=new f.ha(0);f.kb.pj(this.Ub,this.lc,c.x,c.y,.5*(0+Ke)*v,m,w,E,this.Ae),I.na(w.u,E.u),f.kb.xd(this.Ub,this.lc,c.x,c.y,I.x,I.y,null,null,F,this.Ae),f.kb.zi(this.Ub,this.lc,I.x,I.y,o,F.u+1.570796326794897,Z,le),Be.na(Z.u,le.u),f.kb.xd(this.Ub,this.lc,ue.x,ue.y,Le.x,Le.y,U,j,null,2),f.kb.pj(this.Ub,this.lc,ue.x,ue.y,.5*U.u,j.u,ve,be,2),it.na(ve.u,be.u),f.kb.xd(this.Ub,this.lc,Be.x,Be.y,it.x,it.y,g,null,null,2),!(g.u<=this.ao);)Ke*=.9,f.kb.pj(this.Ub,this.lc,c.x,c.y,Ke*v,m,C,R,this.Ae),u.na(C.u,R.u),f.kb.xd(this.Ub,this.lc,c.x,c.y,u.x,u.y,null,null,Je,this.Ae),f.kb.zi(this.Ub,this.lc,u.x,u.y,o,Je.u+1.570796326794897,ee,te),Le.na(ee.u,te.u);1e5<(o=Ke*v)&&(o=1e5),this.KA=o},h.prototype.lX=function(){var o=5e4<this.sb?100:1e4<this.sb?10:1;500>this.sb/o&&(o=this.sb/500),.01>o&&(o=.01),this.ao=o},h}();f.NK=d}(ae||(ae={})),function(f){var N=function(){function T(){}return T.Of=function(d,h){var o=new f.h;o.N(h),d.push(o)},T.wp=function(d,h){d.add(h.x),d.add(h.y)},T.bB=function(d){d.Ch(d.size-2)},T.iB=function(d,h){h.na(d.get(d.size-2),d.get(d.size-1))},T.Rr=function(d,h,o,c,u,m){if(d==null)throw f.i.O();var g=d.K();if(d.B()||f.ba.Sn(g))return d;var v=new T;v.Rg=h,v.Kc=f.cb.tc(h);var w=f.cb.wv(v.Kc);if(v.Vb=m,v.Ub=f.cb.fv(v.Kc),v.lc=w*(2-w),v.fc=v.Kc.Id().bi,v.Cq=v.Kc.Ln(),v.$s=v.Cq*v.fc,v.uA=c,v.tA=u,v.Ae=o,g==197?(o=new f.Ea(d.description)).bd(d,!1):f.ba.zd(g)?(o=new f.Ua(d.description)).oc(d,!0):o=d,v.Ae!=4){if((h=v.Rg.Nb(v.Kc)==0?f.cb.Ah(o,v.Rg,v.Kc):f.Ih.mj(o,v.Kc)).B())return h;h=T.hI(v.fc,h),h=v.Uy(h),h=f.jp.oj(h,v.Kc,v.Ae),v=f.cb.Ah(h,v.Kc,v.Rg)}else{if(f.Gg.Tb(h)==2?(d=f.cb.ol(),(h=f.Wk.local().W(o,d,h,m))==d&&(h=new f.Ea,d.copyTo(h))):h=f.Ih.mj(o,v.Kc),h.B())return h;v=v.qX(h)}return v},T.hI=function(d,h){var o=new f.l;if(h.yc(o),3.141592653589793>o.S()*d)return h;var c=!1;o=h.Ha();for(var u=new f.h,m=new f.h;o.ab();)for(;o.Ia();){var g=o.ia();if(u.N(g.ac()),m.N(g.xc()),u.scale(d),m.scale(d),3.141592653589793<Math.abs(u.x-m.x)){var v=T.Nu(u,m);if(!v){c=!0;break}if(6.283185307179586<Math.abs(u.x-m.x)){c=!0;break}}}if(!c)return h;c=h.Ja();var w=1<h.description.Ba,E=new f.h,C=new f.h,R=new f.h,I=new f.h,F=new f.Ta;for(o.$i();o.ab();)for(var U=NaN,j=[0];o.Ia();){if(g=o.ia(),u.N(g.ac()),m.N(g.xc()),u.scale(d),m.scale(d),isNaN(U)?(T.Xi(u.x,NaN,j),C.N(u)):C.N(R),U=C.x,v=T.Nu(u,m)){if(6.283185307179586<m.x-u.x)for(;6.283185307179586<m.x-u.x;)m.x-=6.283185307179586;if(-6.283185307179586>m.x-u.x)for(;-6.283185307179586>m.x-u.x;)m.x+=6.283185307179586;T.Xi(m.x,NaN,j),R.N(m)}else E.N(m),T.qU(E),T.Xi(E.x,U,j),R.na(j[0]+E.x,E.y);.5>Math.abs(R.x-m.x)&&R.N(m),w?(g.Uw(0,F),I.N(C),I.scale(1/d),F.Db(I),(v=o.xm())?c.nf(F):c.lineTo(F),o.Rn()&&!h.ec(o.gb)&&(g.Uw(1,F),I.N(R),I.scale(1/d),F.Db(I),c.lineTo(F))):((v=o.xm())&&c.Cz(null,0),g=c.ea()-1,I.N(C),I.scale(1/d),c.xf(g,-1,I),o.Rn()&&!h.ec(o.gb)&&(I.N(R),I.scale(1/d),c.xf(g,-1,I)))}return c},T.lF=function(d,h,o,c,u,m,g,v,w,E,C,R){var I=new f.h,F=new f.h,U=0<c.compare(u);T.YI(U,c,u,I,F),T.mF(d,h,o,I,F,m,NaN,g,v,w,E,null,C,R),U&&T.ZB(w,E,null,C)},T.prototype.Uy=function(d){var h=d.Ja(),o=d.Ha(),c=[],u=null,m=null,g=1<d.description.Ba;g&&(u=new f.ce(0),m=new f.hg);for(var v=[0],w=new f.h,E=new f.h,C=new f.h,R=new f.h;o.ab();)for(v[0]=0;o.Ia();){var I=o.ia();w.N(I.ac()),E.N(I.xc()),w.scale(this.fc),E.scale(this.fc);var F=0<w.compare(E);T.YI(F,w,E,C,R),c.length=0,u!=null&&u.Ch(0),0<this.uA?T.mF(this.Ub,this.lc,this.Ae,C,R,this.uA,this.tA,this.$s,null,null,null,g?u:null,c,v):T.TQ(this.Ub,this.lc,this.Ae,C,R,this.tA,this.$s,g?u:null,c,v),F&&T.ZB(null,null,g?u:null,c),c[0].N(I.ac()),c[c.length-1].N(I.xc());for(var U=1;U<c.length-1;U++)c[U].scale(1/this.fc);g?(F=T.XI(F,I,m),T.LD(o.xm(),o.Rn()&&!d.ec(o.gb),I,F,u,c,h)):T.KD(o.xm(),o.Rn()&&!d.ec(o.gb),c,h)}return h},T.prototype.qX=function(d){var h=d.Ja(),o=d.Ha(),c=[],u=null,m=new f.hg,g=1<d.description.Ba;for(g&&(u=new f.ce(0));o.ab();)for(;o.Ia();){var v=o.ia(),w=v.ac(),E=v.xc();w=0<w.compare(E),E=T.XI(w,v,m),c.length=0,u!=null&&u.Ch(0),T.pX(this.Ub,this.lc,this.fc,E,this.Rg,this.uA,this.tA,g?u:null,c),w&&T.ZB(null,null,g?u:null,c),g?T.LD(o.xm(),o.Rn()&&!d.ec(o.gb),v,E,u,c,h):T.KD(o.xm(),o.Rn()&&!d.ec(o.gb),c,h)}return h},T.KD=function(d,h,o,c){d&&c.Cz(null,0),d=c.ea()-1;var u=o.slice(0);c.iG(d,u,u.length-1),h&&c.xf(d,-1,o[o.length-1])},T.LD=function(d,h,o,c,u,m,g){var v=new f.Ta;if(o.Uo(v),d?g.nf(v):g.lineTo(v),2<m.length){d=c.Rb();for(var w=1;w<m.length-1;w++){var E=c.FG(u.get(w)*d);c.Uw(E,v),v.Db(m[w]),g.lineTo(v)}}h&&(o.Qo(v),g.lineTo(v))},T.mF=function(d,h,o,c,u,m,g,v,w,E,C,R,I,F){var U=new f.ha(0),j=new f.ha(0),ee=new f.ha(0);f.kb.xd(d,h,c.x,c.y,u.x,u.y,ee,U,j,o),ee=ee.u;var te=U=U.u;0>te&&(te+=6.283185307179586),0>(j=j.u)&&(j+=6.283185307179586),w!=null&&(w[0]=ee),E!=null&&(E[0]=te),C!=null&&(C[0]=j),E=w=NaN,R!=null&&(w=((E=f.F.Bh(d,h))-(C=f.F.q(d,h,c.y)))/ee,E=(E+C)/ee),C=T.Ou(c,u),j=T.Mu(c,u),te=C||j;var Z=T.xE(c,u,v),le=new f.ha(0),ve=new f.ha(0),be=new f.h,ue=new f.h,Le=new f.h;T.Xi(c.x,NaN,F);var Be=[F[0]];if(ee<=m)T.Of(I,c),T.Xi(u.x,NaN,F),R!=null&&R.add(0),te?(C&&T.eB(c,u,R,I),j&&T.cB(c,u,R,I)):Z?T.dB(c,u,U,w,E,R,I):0<g&&(ue.na(c.x-Be[0],c.y),be.na(u.x-F[0],u.y),T.Ty(d,h,o,c,ee,U,ue,be,0,1,g,R,I,Be)),T.Of(I,u);else{var it=ee/((m=1+f.P.truncate(Math.ceil(ee/m)))-1),Ke=new f.h,Je=0;T.Of(I,c),Ke.N(c),ue.na(c.x-F[0],c.y),R!=null&&R.add(0);for(var pt=1;pt<m;pt++){if(pt<m-1){f.kb.pj(d,h,c.x,c.y,pt*it,U,le,ve,o),be.na(le.u,ve.u),T.Xi(be.x,Ke.x,F),Le.na(F[0]+be.x,be.y);var qt=pt/(m-1)}else T.Xi(u.x,NaN,F),be.na(u.x-F[0],u.y),Le.N(u),qt=1;te?(pt==1&&C&&T.eB(c,Le,R,I),pt==m-1&&j&&T.cB(Ke,u,R,I)):Z?T.wE(Ke,Le,v)&&(c.x<u.x?Ke.x>Le.x&&(F[0]+=6.283185307179586,Le.na(F[0]+be.x,be.y)):Ke.x<Le.x&&(F[0]-=6.283185307179586,Le.na(F[0]+be.x,be.y)),T.dB(Ke,Le,U,w,E,R,I)):0<g&&T.Ty(d,h,o,c,ee,U,ue,be,Je,qt,g,R,I,Be),T.Of(I,Le),R!=null&&R.add(qt),Ke.N(Le),ue.N(be),Be[0]=F[0],Je=qt}}},T.TQ=function(d,h,o,c,u,m,g,v,w,E){var C=new f.ha(0),R=new f.ha(0),I=new f.ha(0);f.kb.xd(d,h,c.x,c.y,u.x,u.y,I,C,R,o),R=I.u,C=C.u;var F=I=NaN;if(v!=null){F=f.F.Bh(d,h);var U=f.F.q(d,h,c.y);I=(F-U)/R,F=(F+U)/R}U=T.Ou(c,u);var j=T.Mu(c,u),ee=U||j;g=T.xE(c,u,g);var te=T.Nu(c,u);te=ee||g||te,T.Xi(c.x,NaN,E);var Z=new f.h;T.Of(w,c),Z.N(c),v!=null&&v.add(0),te?(ee?(U&&T.eB(c,u,v,w),j&&T.cB(c,u,v,w)):g&&T.dB(c,u,C,I,F,v,w),T.Xi(u.x,NaN,E),T.Of(w,u)):R<=m?(T.Xi(u.x,NaN,E),T.Of(w,u)):(I=new f.h,g=new f.h,I.N(c),g.N(u),I.x-=E[0],g.x-=E[0],-3.141592653589793>g.x?g.x+=6.283185307179586:3.141592653589793<g.x&&(g.x-=6.283185307179586),T.Ty(d,h,o,c,R,C,I,g,0,1,m,v,w,E),T.Of(w,u),T.Xi(u.x,NaN,E)),v!=null&&v.add(1)},T.Ty=function(d,h,o,c,u,m,g,v,w,E,C,R,I,F){var U=new f.h,j=new f.h;U.na(g.x+F[0],g.y),new f.ha(0),new f.ha(0),new f.ha(0),new f.ha(0);var ee=new f.ha(0),te=new f.ha(0),Z=new f.ha(0),le=new f.h,ve=new f.h,be=new f.h,ue=new f.h;le.N(g),ve.N(v),g=new f.ce(0),v=new f.ce(0),T.wp(g,ve),v.add(E);var Le=new f.h,Be=new f.zb,it=[];for(T.QJ(4,it);0<g.size;){for(var Ke,Je=!1,pt=NaN,qt=0;3>qt;qt++)if(Ke=it[qt]*E+(1-it[qt])*w,f.kb.pj(d,h,c.x,c.y,Ke*u,m,ee,te,o),be.na(ee.u,te.u),qt==0&&(pt=Ke,ue.N(be)),T.JW(le,be,ve,Be),Be.ic(Be.fe(be,!0),Le),f.kb.xd(d,h,be.x,be.y,Le.x,Le.y,Z,null,null,2),Z.u>C){Je=!0;break}Je?(ve.N(ue),E=pt,T.wp(g,ve),v.add(E)):(T.bB(g),v.Fn(v.size-1,1,v.size-1),0<g.size&&(T.Xi(ve.x,U.x,F),j.na(F[0]+ve.x,ve.y),T.Of(I,j),U.N(j),R!=null&&R.add(E),le.N(ve),w=E,T.iB(g,ve),E=v.get(v.size-1)))}},T.pX=function(d,h,o,c,u,m,g,v,w){var E=new f.h,C=new f.h,R=new f.h,I=new f.h,F=new f.h,U=new f.h,j=new f.h,ee=new f.h,te=new f.h,Z=new f.h,le=new f.ha(0),ve=new f.ha(0),be=new f.h,ue=[[],[]],Le=f.Gg.Tb(u)==1;u=u.Yd(0);var Be=c.ac(),it=c.xc();Le?(U.na(Be.x*o,Be.y*o),j.na(it.x*o,it.y*o)):(ue[0][0]=Be.x,ue[0][1]=Be.y,ue[1][0]=it.x,ue[1][1]=it.y,f.cb.vt(),U.x=ue[0][0]*o,U.y=ue[0][1]*o,j.x=ue[1][0]*o,j.y=ue[1][1]*o);var Ke=0,Je=0,pt=1,qt=c.Qn();E.N(Be),C.N(it),it=new f.ce(0);var ri=new f.ce(0),Ji=new f.ce(0);T.wp(it,C),T.wp(ri,j),Ji.add(pt),T.Of(w,E),v!=null&&v.add(Je);var Zi=[],an=0<g?qt?5:3:qt?5:1;T.QJ(an,Zi);for(var Br=new f.ha(0),Rt=new f.ha(0),gr=new f.ha(0),Ri=new f.ha(0),Ps=new f.ha(0),rs=new f.ha(0),Js=new f.ha(0);0<ri.size;){var Xi=!1,Zn=NaN;for(f.kb.xd(d,h,U.x,U.y,j.x,j.y,Br,Rt,null,2),Be=0;Be<an&&!(Be==0&&(!qt&&0>=g&&Br.u<=m&&3.141592653589793>Math.abs(U.x-j.x)||c.Sx(Je,pt)<=u));Be++){var bi=Zi[Be]*pt+(1-Zi[Be])*Je;if(c.ic(bi,R),Le?ee.na(R.x*o,R.y*o):(ue[0][0]=R.x,ue[0][1]=R.y,f.cb.vt(),ee.x=ue[0][0]*o,ee.y=ue[0][1]*o),Be==0&&(Zn=bi,F.N(R),Z.N(ee),0<m&&(Br.u>m||3.141592653589793<=Math.abs(U.x-j.x)))){Xi=!0;break}if(qt&&0<m){if(f.kb.xd(d,h,U.x,U.y,ee.x,ee.y,gr,null,null,2),gr.u>m||3.141592653589793<=Math.abs(U.x-ee.x)){Xi=!0;break}}else if(0<g){if(qt?(I.ES(E,C,Zi[Be]),Le?te.na(I.x*o,I.y*o):(ue[0][0]=I.x,ue[0][1]=I.y,f.cb.vt(),te.x=ue[0][0]*o,te.y=ue[0][1]*o)):(I.N(R),te.N(ee)),f.kb.xd(d,h,U.x,U.y,te.x,te.y,Ri,null,null,2),!(Ri.u<=Br.u)){Xi=!0;break}if(f.kb.pj(d,h,U.x,U.y,Ri.u,Rt.u,le,ve,2),be.na(le.u,ve.u),f.kb.xd(d,h,be.x,be.y,ee.x,ee.y,Ps,null,null,2),Ps.u>g){Xi=!0;break}if(qt){if(f.kb.xd(d,h,be.x,be.y,te.x,te.y,rs,null,null,2),rs.u>g){Xi=!0;break}if(f.kb.xd(d,h,te.x,te.y,ee.x,ee.y,Js,null,null,2),Js.u>g){Xi=!0;break}}}}Xi?(C.N(F),j.N(Z),pt=Zn,T.wp(it,C),T.wp(ri,j),Ji.add(pt)):(T.bB(it),T.bB(ri),Ji.Fn(Ji.size-1,1,Ji.size-1),T.Of(w,C),Ke+=Br.u,v!=null&&v.add(Ke),0<ri.size&&(E.N(C),U.N(j),Je=pt,T.iB(it,C),T.iB(ri,j),pt=Ji.get(Ji.size-1)))}if(v!=null)for(d=1/Ke,Be=0;Be<v.size;Be++)v.write(Be,v.read(Be)*d)},T.ZB=function(d,h,o,c){c.reverse(),o!=null&&o.oi(0,o.size,1),o=d!=null?d[0]:NaN,c=h!=null?h[0]:NaN,d!=null&&(d[0]=c),h!=null&&(h[0]=o)},T.YI=function(d,h,o,c,u){d?(c.N(o),u.N(h)):(c.N(h),u.N(o))},T.XI=function(d,h,o){return d?(o.create(h.K()),h.copyTo(o.get()),o.get().reverse(),o.get()):h},T.Xi=function(d,h,o){if(isNaN(h)){for(;3.141592653589793<o[0]-d;)o[0]-=6.283185307179586;for(;3.141592653589793<d-o[0];)o[0]+=6.283185307179586}else 3.141592653589793<o[0]+d-h?o[0]-=6.283185307179586:3.141592653589793<h-(o[0]+d)&&(o[0]+=6.283185307179586)},T.JW=function(d,h,o,c){3.141592653589793>Math.abs(h.x-d.x)?(c.Ec(d),3.141592653589793<=o.x-d.x?c.Sl(o.x-6.283185307179586,o.y):3.141592653589793<=d.x-o.x?c.Sl(o.x+6.283185307179586,o.y):c.Sl(o.x,o.y)):(c.Ec(o),3.141592653589793<=d.x-o.x?c.Sl(d.x-6.283185307179586,d.y):3.141592653589793<=o.x-d.x?c.Sl(d.x+6.283185307179586,d.y):c.Sl(d.x,d.y))},T.QJ=function(d,h){for(var o=0;o<d;o++){var c=Math.ceil(o/2)/(d+1);o%2!=0&&(c=-c),h[o]=.5+c}},T.Ou=function(d,h){return!!(f.s.$(d.y,1.570796326794897)&&!f.s.$(h.y,1.570796326794897)||f.s.$(d.y,-1.570796326794897)&&!f.s.$(h.y,-1.570796326794897))},T.Mu=function(d,h){return!!(f.s.$(h.y,1.570796326794897)&&!f.s.$(d.y,1.570796326794897)||f.s.$(h.y,-1.570796326794897)&&!f.s.$(d.y,-1.570796326794897))},T.xE=function(d,h,o){return!(!T.wE(d,h,o)||f.s.$(d.y,1.570796326794897)||f.s.$(d.y,-1.570796326794897)||f.s.$(h.y,1.570796326794897)||f.s.$(h.y,-1.570796326794897))},T.wE=function(d,h,o){return Math.abs(Math.abs(d.x-h.x)-3.141592653589793)<=o},T.Nu=function(d,h){return!!(f.s.$(d.y,1.570796326794897)&&f.s.$(h.y,1.570796326794897)||f.s.$(d.y,-1.570796326794897)&&f.s.$(h.y,-1.570796326794897))},T.eB=function(d,h,o,c){if(0<d.y){var u=new f.h;u.na(h.x,1.570796326794897)}else(u=new f.h).na(h.x,-1.570796326794897);f.s.$(d.x,u.x)||f.s.$(h.y,u.y)||(T.Of(c,u),o!=null&&o.add(0))},T.cB=function(d,h,o,c){if(0<h.y){var u=new f.h;u.na(d.x,1.570796326794897)}else(u=new f.h).na(d.x,-1.570796326794897);f.s.$(h.x,u.x)||f.s.$(d.y,u.y)||(T.Of(c,u),o!=null&&o.add(1))},T.dB=function(d,h,o,c,u,m,g){f.s.Dd(o)?(0<1.570796326794897-d.y&&((o=new f.h).na(d.x,1.570796326794897),T.Of(g,o),m!=null&&m.add(c)),0<1.570796326794897-h.y&&((o=new f.h).na(h.x,1.570796326794897),T.Of(g,o),m!=null&&m.add(c))):(0<1.570796326794897+d.y&&((o=new f.h).na(d.x,-1.570796326794897),T.Of(g,o),m!=null&&m.add(u)),0<1.570796326794897+h.y&&((o=new f.h).na(h.x,-1.570796326794897),T.Of(g,o),m!=null&&m.add(u)))},T.qU=function(d){if(-3.141592653589793>d.x)for(;-3.141592653589793>d.x;)d.x+=6.283185307179586;if(3.141592653589793<d.x)for(;3.141592653589793<d.x;)d.x-=6.283185307179586},T}();f.dj=N}(ae||(ae={})),function(f){f.jp=function(){function N(){}return N.oj=function(T,d,h){if(T==null||d==null||!f.cb.Xc(d))throw f.i.O();if(T.B())return T;var o=T,c=o.K();if(f.ba.Ic(c)){o=f.Ih.mj(T,d),T=new f.l,o.A(T),c=f.ta.Xd(d,T,!1);for(var u=f.cb.hh(d),m=Math.floor((T.v-u.v)/u.S())*u.S()+u.v;m<T.C;)m>T.v+c&&m<T.C-c&&(o=f.Ih.ls(o,d,h,!0,m)),m+=u.S()}else{if(c==197)return(T=new f.Ea(o.description)).bd(o,!1),N.oj(T,d,h);if(f.ba.zd(c))return(T=new f.Ua(o.description)).oc(o,!0),N.oj(T,d,h)}return N.Py(o,d)},N.Py=function(T,d){if(T==null||d==null||!f.cb.Xc(d))throw f.i.O();if(T.B())return T;var h=T.K();return h==197?(h=new f.Ea(T.description)).bd(T,!1):f.ba.zd(h)?(h=new f.Ua(T.description)).oc(T,!0):h=T,(h=f.Ih.mj(h,d)).B()?h:f.Gg.Tb(d)==1?f.Ih.Gn(h,d,0,h!=T,0):N.FQ(h,d,h!=T)},N.FQ=function(T,d,h){if(!f.cb.Xc(d))throw f.i.O();if(T.B())return T;var o=f.cb.bf(d),c=-180*o;return o*=360,f.Gg.Tb(d)==2&&(o=(c=f.cb.hh(d)).C,o-=c=c.v),f.Ih.Jp(T,c,o,d,h,0,!0)},N}()}(ae||(ae={})),function(f){f.qY=function(){function N(){}return N.R=function(T){return 0>T?-T:T},N.Mb=function(T,d){return 0<=d?N.R(T):-N.R(T)},N.$=function(T,d){return T==d||N.R(T-d)<=N.BC*(1+(N.R(T)+N.R(d))/2)},N.Dd=function(T){return T==0||N.R(T)<=N.BC},N.Bh=function(T,d){var h=(d=(1-(d=Math.sqrt(1-d)))/(1+d))*d;return T/(1+d)*(1+h*(.25+h*(.015625+1/256*h)))*N.wL},N.wL=1.5707963267948966,N.BC=3552713678800501e-30,N}()}(ae||(ae={})),function(f){var N=function(d){this.Xf=d,this.Kk=this.Xf.getCode(),0>this.Kk&&(this.Kk=0)};f.sY=N;var T=function(){function d(h){h===void 0&&(h=null),this.Dj=null,this.Vn=!1,h!==null&&(this.Dj=new N(h))}return d.prototype.Fc=function(){return this.Dj!=null?this.Dj.Kk:0},d.prototype.Pf=function(){var h=new d;return this.copyTo(h),h},d.prototype.copyTo=function(h){h.Dj=this.Dj,h.Vn=this.Vn},d.prototype.Lz=function(){this.Vn=!this.Vn},d.prototype.sm=function(){return this.Dj!=null?this.Dj.Xf:null},d.prototype.DJ=function(h){if(0>=h)throw f.i.O();if(h!=this.Fc()){if((h=f.qf.geogtran(h))==null)throw f.i.O("Geogtran not found.");this.Dj=new N(h)}},d.prototype.wz=function(){return this.Dj==null?null:this.Dj.Xf.toString()},d.prototype.hX=function(h){if(h==null)throw f.i.O();var o=null;try{o=f.qf.fromString(f.Tc.PE_TYPE_GEOGTRAN,h)}catch{throw f.i.O()}this.Dj=new N(o)},d.prototype.Nb=function(h){return h==this||!(!(h instanceof d)||(0>=this.Fc()||this.Fc()!=h.Fc())&&!this.sm().isEqual(h.sm()))&&this.Vn==h.Vn},d.prototype.toString=function(){var h="GeographicTransformation: "+this.wz();return 200<h.length?h.substring(0,197)+"... ("+h.length.toString()+" characters)":h},d.create=function(h,o){var c=new d;return c.DJ(h),o&&c.Lz(),c},d.mP=function(h,o){var c=new d;return c.hX(h),o&&c.Lz(),c},d}();f.Bx=T}(ae||(ae={})),function(f){var N=function(){function d(){}return d.construct=function(h,o,c,u){var m=new d;return m.iw=h,m.jw=o,m.FY=c,m.GY=u,m},d.yy=function(h,o){return h.iw==o.iw?h.jw==o.jw?0:h.jw<o.jw?-1:1:h.iw<o.iw?-1:1},d}(),T=function(){function d(){this.nT=[],this.oT=[],this.rp()}return d.fz=function(){return d.bK==null&&(d.bK=new d),d.bK},d.prototype.rp=function(){this.aD(this.nT),this.aD(this.oT)},d.prototype.aD=function(h){try{var o=[];o=o.sort(N.yy);for(var c=0;c<o.length;c++)h.push(o[c])}catch{}},d}();f.rY=T}(ae||(ae={})),function(f){var N=function(){function T(){}return T.prototype.qD=function(d){this.Fk=d},T.prototype.OM=function(d){this.Gb=d},T.prototype.pD=function(d){this.Ao=d},T.uE=function(d){return!(d.B()||d.K()!=1607&&d.K()!=1736)},T.sE=function(d){return!(d.B()||d.K()!=1607&&d.K()!=1736||20>d.I())},T.tE=function(d){return!(d.B()||d.K()!=1607&&d.K()!=1736||20>d.I())},T}();f.Uk=N}(ae||(ae={})),function(f){f.bc=function(){function N(){}return N.JT=function(T){var d=new f.Ea;return d.qx(T.fs(),T.hs()),d.zj(T.fs(),T.gs()),d.zj(T.es(),T.gs()),d.zj(T.es(),T.hs()),d},N.Ah=function(T,d){return T===null?null:f.Fx.local().W(T,d,null)},N.YX=function(T,d){var h=f.Hh.local();return T=new f.$c(T),h.W(T,d,null).next()},N.km=function(T,d,h){return f.lp.local().W(T,d,h,null)},N.fp=function(T,d,h){return f.Ix.local().W(T,d,h,null)},N.JX=function(T,d,h){var o=f.Ix.local();for(T=new f.$c(T),d=new f.$c(d),h=o.W(T,d,h,null),o=[];(d=h.next())!=null;)o.push(d);return o},N.Nb=function(T,d,h){return f.ej.local().W(3,T,d,h,null)},N.LP=function(T,d,h){return f.ej.local().W(4,T,d,h,null)},N.HS=function(T,d,h){var o=f.Wk.local();for(T=new f.$c(T),d=new f.$c(d),h=o.W(T,d,h,null),o=[];(d=h.next())!=null;)o.push(d);return o},N.IP=function(T,d,h){var o=f.lp.local();for(T=new f.$c(T),d=new f.$c(d),h=o.W(T,d,h,null),o=[];(d=h.next())!=null;)o.push(d);return o},N.Fa=function(T,d,h){return f.Wk.local().W(T,d,h,null)},N.eY=function(T,d,h){return f.ej.local().W(2,T,d,h,null)},N.contains=function(T,d,h){return f.ej.local().W(1,T,d,h,null)},N.tP=function(T,d,h){return f.ej.local().W(16,T,d,h,null)},N.touches=function(T,d,h){return f.ej.local().W(8,T,d,h,null)},N.tU=function(T,d,h){return f.ej.local().W(32,T,d,h,null)},N.JS=function(T,d,h){return f.ej.local().W(1073741824,T,d,h,null)},N.sB=function(T,d,h,o){return f.rL.local().W(T,d,h,o,null)},N.ub=function(T,d,h,o){var c=null;if(h!=null){if(c=h.Id(),o!=null&&c.Fc()!=o.Fc()&&c.od!=o.od)throw f.i.Yk()}else if(o!=null)throw f.i.O();return T=f.iL.local().W(T,d,null),c!==null&&o!==null&&(T=f.Uc.Oh(T,c,o)),T},N.clip=function(T,d,h){return f.cL.local().W(T,f.l.construct(d.fs(),d.hs(),d.es(),d.gs()),h,null)},N.el=function(T,d,h){if(T==null||d==null)return null;for(T=f.eL.local().W(!0,T,d,h,null),d=[];(h=T.next())!=null;)h.B()||d.push(h);return d.slice(0)},N.EN=function(T,d,h,o,c,u,m,g){if(c===!0)return N.FN(T,d,h,o,u,m,g);if(c=h,d!=null){if(m=d.Id(),o!=null&&m.Fc()!=o.Fc()){if(m.od!=o.od)throw f.i.Yk();c=[],f.Uc.PE(h,h.length,o,m,c)}}else if(o!=null)throw f.i.O();if(h=f.sC.local(),u){for(T=new f.$c(T),d=h.W(T,d,c,u,null),T=[];(u=d.next())!=null;)T.push(u);u=T.slice(0)}else for(u=[],o=0;o<T.length;o++)u[o]=h.W(T[o],d,c[o],null);return u},N.FN=function(T,d,h,o,c,u,m){if(d===null||(o==null&&(o=d.Fc()!==4326?d.Id():f.Uc.$g(9001)),o.od!==0))throw f.i.O();if(f.Uc.PE(h,h.length,o,f.Uc.$g(9001),h),o=f.xC.local(),c){for(T=new f.$c(T),d=o.W(T,d,u,h,m,!1,c,null),h=[];(u=d.next())!=null;)h.push(u);c=h.slice(0)}else{c=[];for(var g=0;g<T.length;g++)c[g]=o.W(T[g],d,u,h[g],m,!1,null)}return c},N.buffer=function(T,d,h,o,c,u,m){var g=h;if(c===!1){if(d!=null){if(c=d.Id(),o!=null&&c.Fc()!=o.Fc()){if(c.od!=o.od)throw f.i.Yk();g=f.Uc.Oh(h,o,c)}}else if(o!=null)throw f.i.O();T=f.sC.local().W(T,d,g,null)}else{if(d===null||(o==null&&(o=d.Fc()!==4326?d.Id():f.Uc.$g(9001)),o.od!==0))throw f.i.O();g=f.Uc.Oh(h,o,f.Uc.$g(9001)),T=f.xC.local().W(T,d,u,g,m,!1,null)}return T},N.rU=function(T,d,h,o,c,u,m){if(d!=null){var g=d.Id();if(m!=null&&g.Fc()!=m.Fc()){if(g.od!=m.od)throw f.i.Yk();h=f.Uc.Oh(h,m,g)}}else if(m!=null)throw f.i.O();for(T=new f.$c(T),d=f.AC.local().W(T,d,h,o,c,u,null),h=[];(o=d.next())!=null;)h.push(o);return h.slice(0)},N.offset=function(T,d,h,o,c,u,m){if(d!=null){var g=d.Id();if(m!=null&&g.Fc()!=m.Fc()){if(g.od!=m.od)throw f.i.Yk();h=f.Uc.Oh(h,m,g)}}else if(m!=null)throw f.i.O();return f.AC.local().W(T,d,h,o,c,u,null)},N.aP=function(T){return f.uC.local().W(T,null)},N.bP=function(T,d){var h=f.uC.local();for(T=new f.$c(T),d=h.W(T,d,null),h=[];(T=d.next())!=null;)h.push(T);return h},N.iz=function(T,d,h){return f.Gx.local().iz(T,d,h)},N.jz=function(T,d){return f.Gx.local().jz(T,d)},N.kz=function(T,d,h,o){return f.Gx.local().kz(T,d,h,o)},N.YB=function(T,d){return f.$l.local().W(T,d,!1,null)},N.US=function(T,d){return f.$l.local().ss(T,d,null)},N.IQ=function(T,d,h,o,c){var u=f.wC.local();if(d!=null){if(d=d.Id(),c!=null&&d.Fc()!=c.Fc()){if(d.od!=c.od)throw f.i.Yk();h=f.Uc.Oh(h,c,d)}}else if(c!=null)throw f.i.O();return u.W(T,h,o,null)},N.Rr=function(T,d,h,o){var c=f.Zl.local();if(d!=null){if(d=d.Id(),o!=null&&d.Fc()!=o.Fc()){if(d.od!=o.od)throw f.i.Yk();h=f.Uc.Oh(h,o,d)}}else if(o!=null)throw f.i.O();return c.W(T,h,null)},N.Ry=function(T,d,h,o,c){c===void 0&&(c=0);var u=f.kL.local();if(c==4||c!==0)throw f.i.Fe();if(o!==null){if(o.od!==0)throw f.i.O("Unit must be a linear unit type");h=f.Uc.Oh(h,o,f.Uc.$g(9001))}return u.W(T,h,d,c,null)},N.OQ=function(T,d,h,o){if(T===null)return 0;if(o==4||o!==0)throw f.i.Fe();if(T.K()==197)T=N.JT(T);else if(T.K()!=1736)return 0;if(o=f.cb.tc(d),T=f.cb.Ah(T,d,o),T=f.MK.PQ([T])[0],h!==null){if(h.od!==2)throw f.i.O("Unit must be a area unit type");T=f.Uc.Oh(T,f.Uc.$g(109404),h)}return T},N.RQ=function(T,d,h,o){if(T=f.mL.local().W(T,d,o,null),h!==null){if(h.od!==0)throw f.i.O("Unit must be a linear unit type");T=f.Uc.Oh(T,f.Uc.$g(9001),h)}return T},N.zU=function(T,d,h){if(T===null)return 0;var o=null;if(d!=null){if((o=d.Id()).od==0&&(o=f.Uc.TF(o))==null&&h!==null)throw f.i.O();if(h!=null&&o.Fc()!=h.Fc()&&o.od!=h.od)throw f.i.Yk()}else if(h!=null)throw f.i.O();return T.K()==1736||T.K()==197?(T=T.He(),h!==null?f.Uc.Oh(T,o,h):T):0},N.AU=function(T,d,h){if(T===null||T.B()||1>T.Eb())return 0;var o=null;if(d!=null){if(o=d.Id(),h!=null&&o.Fc()!=h.Fc()&&o.od!=h.od)throw f.i.Yk()}else if(h!=null)throw f.i.O();T.K()==1736||T.K()==197?d=T.mg():f.ba.zd(T.K())?(d=new f.Ua(T.description)).oc(T,!0):d=T,T=0,d=d.Ha();for(var c=new f.h,u=new f.h;d.ab();)for(;d.Ia();){var m=d.ia();m.$p(c),m.Ur(u),T+=f.h.ub(c,u)}return o!==null&&h!==null&&(T=f.Uc.Oh(T,o,h)),T},N.YO=function(T){return T.points!==void 0?N.dS(T,T.hasZ!==void 0&&T.hasZ,T.hasM!==void 0&&T.hasM):T.rings!==void 0?N.dG(T.rings,T.hasZ!==void 0&&T.hasZ,T.hasM!==void 0&&T.hasM,"P"):T.paths!==void 0?N.dG(T.paths,T.hasZ!==void 0&&T.hasZ,T.hasM!==void 0&&T.hasM,"L"):T.x!==void 0?N.eS(T):T.xmin!==void 0?N.cS(T):null},N.eS=function(T){if(T.x==null||T.x=="NaN")return new f.Ta;var d=new f.Ta(T.x,T.y);return T.z!==void 0&&T.z!==null&&d.kX(T.z),T.m!==void 0&&T.m!==null&&d.VW(T.m),d},N.cS=function(T){if(T.xmin==null||T.xmin=="NaN")return new f.Gh;var d=new f.Gh(T.xmin,T.ymin,T.xmax,T.ymax);return T.zmin!==void 0&&T.zmin!==null&&d.setInterval(1,0,T.zmin,T.zmax),T.mmin!==void 0&&T.mmin!==null&&d.setInterval(2,0,T.mmin,T.mmax),d},N.dS=function(T,d,h){var o=0,c=new f.de,u=3*T.points.length;u%2!=0&&u++,2>u&&(u=2);var m=f.P.truncate(3*T.points.length/2);4>m?m=4:16>m&&(m=16),u=f.Zc.En(u,0);var g=f.Zc.En(m);m=f.Zc.En(m);for(var v=0;v<T.points.length;v++)u.write(2*v,T.points[v][0]),u.write(2*v+1,T.points[v][1]),g.write(v,d||h?T.points[v][2]:NaN),m.write(v,h&&d?T.points[v][3]:NaN),o++;return o!=0&&(c.resize(o),c.kn(0,u)),d&&(c.se(1),c.kn(1,g)),h&&(c.se(2),c.kn(2,d==0?g:m)),c.Qc(16777215),c},N.dG=function(T,d,h,o){var c=0,u=2;if(o=="P"){var m=new f.Ea;c=1,u=3}else m=new f.Ua;for(var g=f.Zc.Ph(0),v=f.Zc.Nr(0),w=0,E=0,C=[],R=[],I=0;I<T.length;I++){var F=T[I].length;if(C[I]=!1,o==="P"&&T[I][0][0]===T[I][T[I].length-1][0]&&T[I][0][1]===T[I][T[I].length-1][1]){var U=h==0||T[I][0][3]===T[I][T[I].length-1][3]||T[I][0][3]===void 0&&T[I][T[I].length-1][3]===void 0;(d==0||T[I][0][2]===T[I][T[I].length-1][2]||T[I][0][2]===void 0&&T[I][T[I].length-1][2]===void 0)&&U&&(C[I]=!0,--F)}F>=u?(R[I]=!1,E+=1,g.add(w),v.add(c),w+=F):R[I]=!0}for((o=3*w)%2!=0&&o++,2>o&&(o=2),4>(I=f.P.truncate(3*w/2))?I=4:16>I&&(I=16),o=f.Zc.En(o,0),c=f.Zc.En(I),u=f.Zc.En(I),I=F=0;I<T.length;I++)if(R[I]===!1)for(U=0;U<T[I].length;U++){var j=!1;U===T[I].length-1&&C[I]===!0&&(j=!0),j||(o.write(2*F,T[I][U][0]),o.write(2*F+1,T[I][U][1]),c.write(F,d||h?T[I][U][2]:NaN),u.write(F,h&&d?T[I][U][3]:NaN),F++)}return w!=0&&(T=m,g.resize(E),v.resize(E),0<w&&(g.add(w),v.add(0)),T.kn(0,o),T.HJ(v),T.IJ(g)),d&&(m.se(1),m.kn(1,c)),h&&(m.se(2),m.kn(2,d==0?c:u)),m.Qc(16777215),m},N}()}(ae||(ae={})),function(f){f.Cx=function(){function N(){}return N.dr=function(T){var d,h=0,o=T.length,c=T[0];for(d=0;d<o-1;d++){var u=T[d+1];h+=(u[0]-c[0])*(u[1]+c[1]),c=u}return 0<=h},N.rotate=function(T,d,h){d=d*Math.PI/180;var o=Math.cos(d),c=Math.sin(d);if(T.paths!==void 0){d={paths:[]};for(var u=0;u<T.paths.length;u++){for(var m=T.paths[u],g=[],v=0;v<m.length;v++){var w=m[v].slice(0);g.push(w);var E=o*(m[v][0]-h.x)-c*(m[v][1]-h.y)+h.x,C=c*(m[v][0]-h.x)+o*(m[v][1]-h.y)+h.y;w[0]=E,w[1]=C}d.paths.push(g)}return d}if(T.rings!==void 0){for(d={rings:[]},u=0;u<T.rings.length;u++){m=T.rings[u],g=[];var R=N.dr(m);for(v=0;v<m.length;v++)w=m[v].slice(0),g.push(w),E=o*(m[v][0]-h.x)-c*(m[v][1]-h.y)+h.x,C=c*(m[v][0]-h.x)+o*(m[v][1]-h.y)+h.y,w[0]=E,w[1]=C;N.dr(g)!==R&&g.reverse(),d.rings.push(g)}return d}if(T.x!==void 0)return d={x:o*(T.x-h.x)-c*(T.y-h.y)+h.x,y:c*(T.x-h.x)+o*(T.y-h.y)+h.y},T.z!==void 0&&(d.z=T.z),T.m!==void 0&&(d.m=T.m),d;if(T.points!==void 0){for(d={points:[]},T=T.points,v=0;v<T.length;v++)(u=T[v].slice(0))[0]=o*(T[v][0]-h.x)-c*(T[v][1]-h.y)+h.x,u[1]=c*(T[v][0]-h.x)+o*(T[v][1]-h.y)+h.y,d.points.push(u);return d}return null},N.BQ=function(T,d){if(T.paths!==void 0){for(var h={paths:[]},o=0;o<T.paths.length;o++){for(var c=T.paths[o],u=[],m=0;m<c.length;m++){var g=c[m].slice(0);u.push(g);var v=d.x-c[m][0];g[0]=c[m][0]+2*v}h.paths.push(u)}return h}if(T.rings!==void 0){for(h={rings:[]},o=0;o<T.rings.length;o++){c=T.rings[o];var w=N.dr(c);for(u=[],m=0;m<c.length;m++)g=c[m].slice(0),u.push(g),v=d.x-c[m][0],g[0]=c[m][0]+2*v;N.dr(u)!==w&&u.reverse(),h.rings.push(u)}return h}if(T.x!==void 0)return v=d.x-T.x,h={x:T.x+2*v,y:T.y},T.z!==void 0&&(h.z=T.z),T.m!==void 0&&(h.m=T.m),h;if(T.points!==void 0){for(h={points:[]},T=T.points,m=0;m<T.length;m++)o=T[m].slice(0),v=d.x-o[0],o[0]+=2*v,h.points.push(o);return h}return T.xmin!==void 0?(h={v:T.xmin,G:T.ymin,C:T.xmax,H:T.ymax},T.zmin!==void 0&&(h.zmin=T.zmin,h.zmax=T.zmax),T.mmin!==void 0&&(h.mmin=T.mmin,h.mmax=T.mmax),v=d.x-T.xmin,h.xmax=T.xmin+2*v,v=d.x-T.xmax,h.xmin=T.xmax+2*v,h):null},N.CQ=function(T,d){if(T.paths!==void 0){for(var h={paths:[]},o=0;o<T.paths.length;o++){for(var c=T.paths[o],u=[],m=0;m<c.length;m++){var g=c[m].slice(0);u.push(g);var v=d.y-c[m][1];g[1]=c[m][1]+2*v}h.paths.push(u)}return h}if(T.rings!==void 0){for(h={rings:[]},o=0;o<T.rings.length;o++){c=T.rings[o];var w=N.dr(c);for(u=[],m=0;m<c.length;m++)g=c[m].slice(0),u.push(g),v=d.y-c[m][1],g[1]=c[m][1]+2*v;N.dr(u)!==w&&u.reverse(),h.rings.push(u)}return h}if(T.x!==void 0)return v=d.y-T.y,h={y:T.y+2*v,x:T.x},T.z!==void 0&&(h.z=T.z),T.m!==void 0&&(h.m=T.m),h;if(T.points!==void 0){for(h={points:[]},T=T.points,m=0;m<T.length;m++)o=T[m].slice(0),v=d.y-o[1],o[1]+=2*v,h.points.push(o);return h}return T.xmin!==void 0?(h={v:T.xmin,G:T.ymin,C:T.xmax,H:T.ymax},T.zmin!==void 0&&(h.zmin=T.zmin,h.zmax=T.zmax),T.mmin!==void 0&&(h.mmin=T.mmin,h.mmax=T.mmax),v=d.y-T.ymin,h.ymax=T.ymin+2*v,v=d.y-T.ymax,h.ymin=T.ymax+2*v,h):null},N}()}(ae||(ae={})),function(f){f.RK=function(){function N(){}return N.Kg=function(T,d){switch(d==null&&(d=f.ee.og()),T){case 33:return new f.Ta(d);case 322:return new f.zb(d);case 197:return new f.Gh(d);case 550:return new f.de(d);case 1607:return new f.Ua(d);case 1736:return new f.Ea(d);default:throw f.i.ga("invalid argument.")}},N}()}(ae||(ae={})),function(f){var N=function(){function T(d,h){this.Qe=f.ja.rf(d,-1),this.va=new f.bu,this.yl=h}return T.prototype.qW=function(d){this.va.At(Math.min(this.Qe.size,d)),this.va.hn(d)},T.prototype.addElement=function(d,h){if(h===void 0)return this.XM(d);h=f.P.truncate(h%this.Qe.size);var o=this.Qe.get(h);return o==-1&&(o=this.va.Qh(),this.Qe.set(h,o)),this.va.addElement(o,d)},T.prototype.XM=function(d){var h=this.yl.ez(d);h=f.P.truncate(h%this.Qe.size);var o=this.Qe.get(h);return o==-1&&(o=this.va.Qh(),this.Qe.set(h,o)),this.va.addElement(o,d)},T.prototype.kd=function(d,h){if(h===void 0)this.CP(d);else{h=f.P.truncate(h%this.Qe.size);var o=this.Qe.get(h);if(o==-1)throw f.i.O();for(var c=this.va.sc(o),u=-1;c!=-1;){var m=this.va.lb(c);this.va.ka(c)==d?(this.va.kd(o,u,c),this.va.sc(o)==-1&&(this.va.dh(o),this.Qe.set(h,-1))):u=c,c=m}}},T.prototype.CP=function(d){var h=this.yl.ez(d);h=f.P.truncate(h%this.Qe.size);var o=this.Qe.get(h);if(o==-1)throw f.i.O();for(var c=this.va.sc(o),u=-1;c!=-1;){var m=this.va.lb(c);this.va.ka(c)==d?(this.va.kd(o,u,c),this.va.sc(o)==-1&&(this.va.dh(o),this.Qe.set(h,-1))):u=c,c=m}},T.prototype.iR=function(d){return d=f.P.truncate(d%this.Qe.size),(d=this.Qe.get(d))==-1?-1:this.va.sc(d)},T.prototype.wR=function(d){return this.va.lb(d)},T.prototype.wd=function(d){var h=this.yl.ez(this.ka(d));h=f.P.truncate(h%this.Qe.size);var o=this.Qe.get(h);if(o==-1)throw f.i.O();for(var c=this.va.sc(o),u=-1;c!=-1;){if(c==d)return this.va.kd(o,u,c),void(this.va.sc(o)==-1&&(this.va.dh(o),this.Qe.set(h,-1)));u=c,c=this.va.lb(c)}throw f.i.O()},T.prototype.ka=function(d){return this.va.ka(d)},T.prototype.clear=function(){this.Qe=f.ja.rf(this.Qe.size,-1),this.va.clear()},T.prototype.size=function(){return this.va.LF()},T}();f.WK=N}(ae||(ae={})),function(f){var N=function(){function T(){this.Mi=new f.ad(3),this.va=new f.ad(6),this.hT=!1,this.je=-1}return T.prototype.hl=function(d){this.Mi.kd(d)},T.prototype.Qw=function(){return this.Mi.De()},T.prototype.cv=function(d){this.va.kd(d)},T.prototype.UA=function(){return this.va.De()},T.prototype.PB=function(d,h){this.Mi.T(d,1,h)},T.prototype.ex=function(d,h){this.Mi.T(d,2,h)},T.prototype.UW=function(d,h){this.Mi.T(d,3,h)},T.prototype.NB=function(d,h){this.va.T(d,4,h)},T.prototype.XW=function(d,h){this.va.T(d,3,h)},T.prototype.LJ=function(d,h){this.va.T(d,2,h)},T.prototype.Qh=function(d){var h=this.UA();return this.va.T(h,3,this.je),this.va.T(h,4,0),this.va.T(h,5,d),this.je!=-1&&this.LJ(this.je,h),this.je=h},T.prototype.dh=function(d){this.DE(d);var h=this.va.U(d,2),o=this.va.U(d,3);return h!=-1?this.XW(h,o):this.je=o,o!=-1&&this.LJ(o,h),this.cv(d),o},T.prototype.At=function(d){this.va.Ee(d)},T.prototype.HF=function(d){return this.va.U(d,5)},T.prototype.TW=function(d,h){this.va.T(d,5,h)},T.prototype.addElement=function(d,h){return this.kS(d,h)},T.prototype.kS=function(d,h){var o=this.Qw();this.ex(o,-1),this.va.U(d,0)==-1&&this.va.T(d,0,o);var c=this.va.U(d,1);return this.PB(o,c),c!=-1&&this.ex(c,o),this.va.T(d,1,o),this.setData(o,h),this.NB(d,this.cs(d)+1),this.hT&&this.UW(o,d),o},T.prototype.kd=function(d,h){var o=this.xe(h),c=this.lb(h);return o!=-1?this.ex(o,c):this.va.T(d,0,c),c!=-1?this.PB(c,o):this.va.T(d,1,o),this.hl(h),this.NB(d,this.cs(d)-1),c},T.prototype.hn=function(d){this.Mi.Ee(d)},T.prototype.getData=function(d){return this.Mi.U(d,0)},T.prototype.setData=function(d,h){this.Mi.T(d,0,h)},T.prototype.lb=function(d){return this.Mi.U(d,2)},T.prototype.xe=function(d){return this.Mi.U(d,1)},T.prototype.sc=function(d){return this.va.U(d,0)},T.prototype.Gc=function(d){return this.va.U(d,1)},T.prototype.clear=function(){for(var d=this.je;d!=-1;)d=this.dh(d)},T.prototype.DE=function(d){for(var h=this.Gc(d);h!=-1;){var o=h;h=this.xe(o),this.hl(o)}this.va.T(d,0,-1),this.va.T(d,1,-1),this.NB(d,0)},T.prototype.B=function(){return this.Mi.size==0},T.prototype.LF=function(){return this.Mi.size},T.prototype.cs=function(d){return this.va.U(d,4)},T.prototype.lz=function(d){return this.va.U(d,3)},T}();f.kp=N}(ae||(ae={})),function(f){var N=function(){function T(d){d===void 0?(this.ug=new f.ad(2),this.va=new f.ad(4),this.je=-1,this.Rv=!0):(this.ug=new f.ad(2),this.va=new f.ad(d?4:2),this.je=-1,this.Rv=d)}return T.prototype.hl=function(d){this.ug.kd(d)},T.prototype.Qw=function(){return this.ug.De()},T.prototype.cv=function(d){this.va.kd(d)},T.prototype.UA=function(){return this.va.De()},T.prototype.Qh=function(){var d=this.UA();return this.Rv&&(this.va.T(d,3,this.je),this.je!=-1&&this.va.T(this.je,2,d),this.je=d),d},T.prototype.dh=function(d){for(var h=this.sc(d);h!=-1;){var o=h;h=this.lb(h),this.hl(o)}this.Rv&&(h=this.va.U(d,2),o=this.va.U(d,3),h!=-1?this.va.T(h,3,o):this.je=o,o!=-1&&this.va.T(o,2,h)),this.cv(d)},T.prototype.At=function(d){this.va.Ee(d)},T.prototype.addElement=function(d,h){var o=this.va.U(d,1),c=this.Qw();return o!=-1?this.ug.T(o,1,c):this.va.T(d,0,c),this.va.T(d,1,c),this.ug.T(c,0,h),c},T.prototype.hn=function(d){this.ug.Ee(d)},T.prototype.kd=function(d,h,o){h!=-1?(this.ug.T(h,1,this.ug.U(o,1)),this.va.U(d,1)==o&&this.va.T(d,1,h)):(this.va.T(d,0,this.ug.U(o,1)),this.va.U(d,1)==o&&this.va.T(d,1,-1)),this.hl(o)},T.prototype.By=function(d,h){var o=this.va.U(d,1),c=this.va.U(h,0);c!=-1&&(o!=-1?this.ug.T(o,1,c):this.va.T(d,0,c),this.va.T(d,1,this.va.U(h,1))),this.Rv&&(d=this.va.U(h,2),o=this.va.U(h,3),d!=-1?this.va.T(d,3,o):this.je=o,o!=-1&&this.va.T(o,2,d)),this.cv(h)},T.prototype.ka=function(d){return this.ug.U(d,0)},T.prototype.Tj=function(d,h){this.ug.T(d,0,h)},T.prototype.lb=function(d){return this.ug.U(d,1)},T.prototype.sc=function(d){return this.va.U(d,0)},T.prototype.Kn=function(d){return this.ka(this.sc(d))},T.prototype.clear=function(){this.ug.nj(!0),this.va.nj(!0),this.je=-1},T.prototype.B=function(){return this.ug.size==0},T.prototype.LF=function(){return this.ug.size},T.prototype.lz=function(d){return this.va.U(d,3)},T}();f.bu=N}(ae||(ae={})),function(f){f.ta=function(){function N(){}return N.Xd=function(T,d,h){return d=d.zr(),T=T!=null&&T.Yd!==void 0?T.Yd(0):0,h&&(d*=4,T*=1.1),Math.max(T,d)},N.Gr=function(T){return 2*Math.sqrt(2)*T},N.jN=function(T){return Math.sqrt(2)*T},N.lj=function(T,d,h){var o=new f.l;return d.A(o),N.Xd(T,o,h)},N.oE=function(T,d,h){return d=d.Ug(1,0).zr(),T=T!=null?T.Yd(1):0,h&&(d*=4,T*=1.1),Math.max(T,d)},N.nv=function(T,d){var h=new f.l;return T.yc(h),T=new f.l,d.yc(T),h.$b(T),h},N.QN=function(T){var d=new f.l;if(T.yc(d),d.B())return null;var h=new f.eu(d,8),o=-1,c=new f.l,u=!1;do for(var m=0,g=T.ea();m<g;m++){if(T.Sj(m,c),(o=h.Ez(m,c,o))==-1){if(u)throw f.i.ga("internal error");T.Ap(d,!1),u=!0,h.reset(d,8);break}u=!1}while(u);return h},N.fE=function(T){var d=new f.l;T.yc(d);for(var h=new f.eu(d,8),o=-1,c=T.Ha(),u=new f.l,m=!1;c.ab();)for(;c.Ia();){var g=c.ia(),v=c.xb();if(g.A(u),(o=h.Ez(v,u,o))==-1){if(m)throw f.i.Ra();T.Ap(d,!1),m=!0,h.reset(d,8),c.$i();break}}return h},N.kj=function(T,d){var h=new f.l;T.yc(h);for(var o=new f.eu(h,8),c=-1,u=new f.l,m=T.Ha(),g=!1;m.ab();)for(;m.Ia();){var v=m.ia(),w=m.xb();if(v.A(u),u.isIntersecting(d)&&(c=o.Ez(w,u,c))==-1){if(g)throw f.i.ga("internal error.");T.Ap(h,!1),g=!0,o.reset(h,8),m.$i();break}}return o},N.gE=function(T,d){for(var h=new f.eu(d,8),o=new f.h,c=!1,u=new f.l,m=0;m<T.I();m++)if(T.D(m,o),d.contains(o)&&(u.L(o),h.wj(m,u)==-1)){if(c)throw f.i.Ra();c=!0,m=new f.l,T.Ap(m,!1),h.reset(m,8),m=-1}return h},N.dR=function(T,d,h){var o=new f.l,c=new f.l;T.yc(o),d.yc(c),o.X(h,h),c.X(h,h);var u=new f.l;u.L(o),u.Fa(c),T=T.Ha(),d=d.Ha();var m=new f.qC;m.UB(h);var g=!1;for(m.hK();T.ab();)for(;T.Ia();)T.ia().A(o),o.isIntersecting(u)&&(g=!0,(h=new f.l).L(o),m.AD(T.xb(),h));if(m.aF(),!g)return null;for(o=!1,m.gK();d.ab();)for(;d.Ia();)d.ia().A(c),c.isIntersecting(u)&&(o=!0,(h=new f.l).L(c),m.wD(d.xb(),h));return m.$E(),o?m:null},N.eR=function(T,d,h,o,c){var u=T.K(),m=d.K(),g=new f.l,v=new f.l;T.yc(g),d.yc(v),g.X(h,h),v.X(h,h);var w=new f.l;w.L(g),w.Fa(v);var E=new f.qC;E.UB(h);var C=!1;E.hK();var R=0;for(h=T.ea();R<h;R++)o&&u==1736&&!T.Fv(R)||(T.Sj(R,g),g.isIntersecting(w)&&(C=!0,E.AD(R,g)));if(E.aF(),!C)return null;for(T=!1,E.gK(),o=0,h=d.ea();o<h;o++)c&&m==1736&&!d.Fv(o)||(d.Sj(o,v),v.isIntersecting(w)&&(T=!0,E.wD(o,v)));return E.$E(),T?E:null},N.Tu=function(T,d,h){if(T!=d)for(var o=0;o<h;o++)T[o]==null?T[o]=f.h.bl(d[o]):T[o].N(d[o])},N.Dy=function(T,d,h,o){var c=0;for(o+=0;c<o;h++,c++)T[c]==null&&(T[c]=[0,0]),T[c][0]=d[h].x,T[c][1]=d[h].y},N.Cy=function(T,d,h,o){var c=d,u=0;for(d=o+d;c<d;u++,c++)T[c]==null?T[c]=f.h.construct(h[u][0],h[u][1]):T[c].na(h[u][0],h[u][1])},N.cP=function(T,d,h){if(T!=d)for(var o=0;o<h;o++)T[o]==null?T[o]=new f.Ta(d[o]):d[o].copyTo(T[o])},N.nE=function(T,d,h,o){var c=0;return T!=null&&(c=T.Yd(0),o&&!h||T==null||(c+=1.01*T.pz(0))),h&&(d*=4,c*=1.01),Math.max(c,d)},N.ny=function(T,d,h){return N.nE(T,d.zr(),h,!1)},N.ZN=function(T,d){var h=new f.l;return d.A(h),N.ny(T,h,!0)},N.oy=function(T,d){return N.nE(T,d.zr(),!1,!0)},N.Iu=function(T,d){var h=new f.l;return d.A(h),N.oy(T,h)},N.sG=function(T,d,h,o){o*=o;var c=new f.h;if(c.vc(T,d),(T=new f.h).vc(h,d),d=c.Sk(),h=T.Sk(),d<=o&&h<=o)return!0;var u=f.mc.nx(c.xi(T));return(u<=o*d||u<=o*h)&&0<=c.Rh(T)},N.WJ=function(T,d,h,o){for(var c=0;c<d;c++){var u=T[c].y,m=f.P.Rk(u,h,o);m!=u&&(T[c].y=m)}},N}()}(ae||(ae={})),function(f){var N,T,d=function(){function u(m){this.Za=m}return u.prototype.compare=function(m,g,v){m=m.ka(v),v=this.Za.nk(g);var w=this.Za.nk(m);return v<w?-1:v==w?c.iq(g)&&c.Hv(m)?-1:c.iq(m)&&c.Hv(g)?1:0:1},u}(),h=function(){function u(m){this.Za=m}return u.prototype.qr=function(m,g,v){this.Za.uX(v,m,g)},u.prototype.bq=function(m){return this.Za.nk(m)},u}();(T=N||(N={}))[T.initialize=0]="initialize",T[T.pIn=1]="pIn",T[T.pL=2]="pL",T[T.pR=3]="pR",T[T.pT=4]="pT",T[T.right=5]="right",T[T.left=6]="left",T[T.all=7]="all";var o=function(){function u(){this.Za=null,this.Ri=new f.Oc,this.ii=new f.ja(0),this.sg=[0,0]}return u.prototype.Yi=function(m,g){this.Ri.pa=m.pa-g,this.Ri.wa=m.wa+g,this.ii.resize(0),this.he=0,this.sg[0]=0},u.prototype.yB=function(m,g,v){if(m>g)throw f.i.O();this.Ri.pa=m-v,this.Ri.wa=g+v,this.ii.resize(0),this.he=0,this.sg[0]=0},u.prototype.Vo=function(m,g){this.Ri.pa=m-g,this.Ri.wa=m+g,this.ii.resize(0),this.he=0,this.sg[0]=0},u.prototype.next=function(){if(!this.Za.nq)throw f.i.Hb();if(0>this.he)return-1;for(var m=!0;m;)switch(this.sg[this.he]){case 1:m=this.vU();break;case 2:m=this.wU();break;case 3:m=this.xU();break;case 4:m=this.yU();break;case 5:m=this.vW();break;case 6:m=this.aT();break;case 7:m=this.lN();break;case 0:m=this.Bz();break;default:throw f.i.Ra()}return this.Pg!=-1?this.Op()>>1:-1},u.construct=function(m){var g=new u;return g.Za=m,g.ii.Jb(20),g.he=-1,g},u.prototype.Bz=function(){return this.Pg=this.nH=this.Ni=this.Mc=-1,this.Za.me!=null&&0<this.Za.me.size?(this.sg[0]=1,this.Ni=this.Za.kf,!0):(this.he=-1,!1)},u.prototype.vU=function(){if(this.Mc=this.Ni,this.Mc==-1)return this.Pg=this.he=-1,!1;var m=this.Za.Pp(this.Mc);return this.Ri.wa<m?(m=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=6),!0):m<this.Ri.pa?(m=this.Za.mk(this.Mc),this.Ni=this.Za.lk(this.Mc),m!=-1&&(this.fi=this.Za.$r(m),this.sg[++this.he]=5),!0):(this.sg[this.he]=2,this.nH=this.Mc,m=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=7),!0)},u.prototype.wU=function(){if(this.Mc=this.Ni,this.Mc==-1)return this.sg[this.he]=3,this.Ni=this.Za.lk(this.nH),!0;if(this.Za.Pp(this.Mc)<this.Ri.pa){var m=this.Za.mk(this.Mc);return this.Ni=this.Za.lk(this.Mc),m!=-1&&(this.fi=this.Za.$r(m),this.sg[++this.he]=5),!0}return m=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=7),(m=this.Za.lk(this.Mc))!=-1&&this.ii.add(m),!0},u.prototype.xU=function(){if(this.Mc=this.Ni,this.Mc==-1)return this.sg[this.he]=4,!0;if(this.Ri.wa<this.Za.Pp(this.Mc)){var m=this.Za.mk(this.Mc);return this.Ni=this.Za.rj(this.Mc),m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=6),!0}return m=this.Za.mk(this.Mc),this.Ni=this.Za.lk(this.Mc),m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=7),(m=this.Za.rj(this.Mc))!=-1&&this.ii.add(m),!0},u.prototype.yU=function(){if(this.ii.size==0)return this.Pg=this.he=-1,!1;this.Mc=this.ii.get(this.ii.size-1),this.ii.resize(this.ii.size-1);var m=this.Za.mk(this.Mc);return m!=-1&&(this.fi=this.Za.ml(m),this.sg[++this.he]=7),this.Za.rj(this.Mc)!=-1&&this.ii.add(this.Za.rj(this.Mc)),this.Za.lk(this.Mc)!=-1&&this.ii.add(this.Za.lk(this.Mc)),!0},u.prototype.aT=function(){return this.Pg=this.fi,this.Pg!=-1&&c.iq(this.Op())&&this.Za.nk(this.Op())<=this.Ri.wa?(this.fi=this.KF(),!1):(this.he--,!0)},u.prototype.vW=function(){return this.Pg=this.fi,this.Pg!=-1&&c.Hv(this.Op())&&this.Za.nk(this.Op())>=this.Ri.pa?(this.fi=this.HR(),!1):(this.he--,!0)},u.prototype.lN=function(){return this.Pg=this.fi,this.Pg!=-1&&c.iq(this.Op())?(this.fi=this.KF(),!1):(this.he--,!0)},u.prototype.KF=function(){return this.Za.Tf?this.Za.ag.lb(this.Pg):this.Za.Ui.lb(this.Pg)},u.prototype.HR=function(){return this.Za.Tf?this.Za.ag.xe(this.Pg):this.Za.Ui.xe(this.Pg)},u.prototype.Op=function(){return this.Za.Tf?this.Za.ag.ka(this.Pg):this.Za.Ui.getData(this.Pg)},u}();f.tY=o;var c=function(){function u(m){this.Cm=this.ai=this.ag=this.Ui=this.Mm=this.Fj=this.me=this.Gj=null,this.Tf=m,this.nq=this.Tv=!1}return u.prototype.mr=function(){this.Nk(!0)},u.prototype.Dr=function(m,g){if(!this.Tv)throw f.i.Hb();this.Gj.push(new f.Oc(m,g))},u.prototype.Hp=function(){if(!this.Tv)throw f.i.ga("invalid call");this.Tv=!1,this.nq=!0,this.Tf||(this.mS(),this.$v=this.Gj.length)},u.prototype.wj=function(m){if(!this.Tf||!this.nq)throw f.i.O("invalid call");if(this.kf==-1){var g=this.Gj.length;if(this.dA){var v=new f.ja(0);v.Jb(2*g),this.UI(v),this.ai.Jb(2*g),this.ai.resize(0),this.TI(v),this.Mm.resize(g,-1),this.Mm.Xj(-1,0,g),this.dA=!1}else this.Mm.Xj(-1,0,g);this.kf=this.Vu()}g=this.hG(m<<1,this.kf),v=this.ag.addElement(1+(m<<1),this.rz(g)),this.NJ(g,v),this.Mm.set(m,g),this.$v++},u.prototype.remove=function(m){if(!this.Tf||!this.nq)throw f.i.ga("invalid call");var g=this.Mm.get(m);if(g==-1)throw f.i.O("the interval does not exist in the interval tree");this.Mm.set(m,-1),this.$v--;var v=this.rz(g),w=this.ag.QR(v);this.ag.wd(this.nR(g),v),this.ag.wd(this.KR(g),v),(m=this.ag.size(v))==0&&(this.ag.EP(v),this.RJ(w,-1)),this.Fj.kd(g),v=this.MF(w);var E=this.rj(w),C=this.lk(w);for(g=0;!(0<m||w==this.kf||E!=-1&&C!=-1);)w==this.rj(v)?E!=-1?(this.Ok(v,E),this.Vj(E,v),this.Ok(w,-1)):C!=-1?(this.Ok(v,C),this.Vj(C,v),this.Qk(w,-1)):this.Ok(v,-1):E!=-1?(this.Qk(v,E),this.Vj(E,v),this.Ok(w,-1)):C!=-1?(this.Qk(v,C),this.Vj(C,v),this.Qk(w,-1)):this.Qk(v,-1),this.Vj(w,-1),g++,w=v,m=(v=this.mk(w))!=-1?this.ag.size(v):0,E=this.rj(w),C=this.lk(w),v=this.MF(w)},u.prototype.reset=function(){if(!this.Tf||!this.nq)throw f.i.O("invalid call");this.Nk(!1)},u.prototype.size=function(){return this.$v},u.prototype.getIterator=function(){return o.construct(this)},u.prototype.UI=function(m){for(var g=this.Gj.length,v=0;v<2*g;v++)m.add(v);this.vX(m,2*g)},u.prototype.TI=function(m){for(var g=NaN,v=0;v<m.size;v++){var w=m.get(v),E=this.nk(w);E!=g&&(this.ai.add(w),g=E)}},u.prototype.mS=function(){var m=this.Gj.length,g=new f.ja(0);g.Jb(2*m),this.UI(g),this.ai.Jb(2*m),this.ai.resize(0),this.TI(g),this.Fj.Ee(m),this.Ui.hn(2*m);var v=f.Zc.Ph(m);for(v.Xj(-1,0,m),this.kf=this.Vu(),m=0;m<g.size;m++){var w=g.get(m),E=v.get(w>>1);E!=-1?this.NJ(E,this.Ui.addElement(this.rz(E),w)):(E=this.hG(w,this.kf),v.set(w>>1,E))}},u.prototype.hG=function(m,g){var v=g,w=g,E=-1,C=0,R=this.ai.size-1,I=0,F=m>>1,U=NaN,j=NaN,ee=!0,te=this.vR(F);for(F=this.sR(F);ee;){C<R?(I=C+f.P.truncate((R-C)/2),this.bz(v)==-1&&this.xJ(v,this.ai.get(I),this.ai.get(I+1))):this.bz(v)==-1&&this.xJ(v,this.ai.get(C),this.ai.get(C));var Z=this.Pp(v);if(F<Z)g!=-1&&(g==v?(w=v,U=Z,j=(g=this.rj(v))!=-1?this.Pp(g):NaN):j>Z&&(Z<U?this.Ok(w,v):this.Qk(w,v),this.Qk(v,g),this.Tf&&(this.Vj(v,w),this.Vj(g,v)),w=v,U=Z,g=-1,j=NaN)),(R=this.oR(v))==-1&&(R=this.Vu(),this.RW(v,R)),v=R,R=I;else if(te>Z)g!=-1&&(g==v?(w=v,U=Z,j=(g=this.lk(v))!=-1?this.Pp(g):NaN):j<Z&&(Z<U?this.Ok(w,v):this.Qk(w,v),this.Ok(v,g),this.Tf&&(this.Vj(v,w),this.Vj(g,v)),w=v,U=Z,g=-1,j=NaN)),(C=this.LR(v))==-1&&(C=this.Vu(),this.bX(v,C)),v=C,C=I+1;else{(ee=this.mk(v))==-1&&(ee=this.rP(v),this.RJ(v,ee));var le=this.YM(ee,m);E=this.pP(),this.eX(E,ee),this.QW(E,le),v!=g&&(Z<U?this.Ok(w,v):this.Qk(w,v),this.Tf&&this.Vj(v,w),g!=-1&&(j<Z?this.Ok(v,g):this.Qk(v,g),this.Tf&&this.Vj(g,v))),ee=!1}}return E},u.prototype.Vu=function(){return this.me.De()},u.prototype.rP=function(m){return this.Tf?this.ag.Qr(m):this.Ui.Qh(m)},u.prototype.pP=function(){return this.Fj.De()},u.prototype.Nk=function(m){m?(this.Tv=this.dA=!0,this.nq=!1,this.ai==null?this.ai=f.Zc.Ph(0):this.ai.resize(0),this.Gj==null?this.Gj=[]:this.Gj.length=0):this.dA=!1,this.Tf?this.Mm==null?(this.Mm=f.Zc.Ph(0),this.ag=new f.Yj,this.ag.Wo(new d(this))):this.ag.clear():this.Ui==null?this.Ui=new f.kp:this.Ui.clear(),this.me==null?(this.Fj=new f.ad(3),this.me=new f.ad(this.Tf?8:7)):(this.Fj.nj(!1),this.me.nj(!1)),this.kf=-1,this.$v=0},u.prototype.xJ=function(m,g,v){this.KW(m,g),this.LW(m,v)},u.prototype.Pp=function(m){var g=this.bz(m);return g==-1?NaN:(g=this.nk(g))==(m=this.nk(this.ZQ(m)))?g:.5*(g+m)},u.prototype.KW=function(m,g){this.me.T(m,0,g)},u.prototype.LW=function(m,g){this.me.T(m,1,g)},u.prototype.RW=function(m,g){this.me.T(m,3,g)},u.prototype.bX=function(m,g){this.me.T(m,4,g)},u.prototype.RJ=function(m,g){this.me.T(m,2,g)},u.prototype.Ok=function(m,g){this.me.T(m,5,g)},u.prototype.Qk=function(m,g){this.me.T(m,6,g)},u.prototype.Vj=function(m,g){this.me.T(m,7,g)},u.prototype.eX=function(m,g){this.Fj.T(m,0,g)},u.prototype.YM=function(m,g){return this.Tf?this.ag.addElement(g,m):this.Ui.addElement(m,g)},u.prototype.QW=function(m,g){this.Fj.T(m,1,g)},u.prototype.NJ=function(m,g){this.Fj.T(m,2,g)},u.prototype.ml=function(m){return this.Tf?this.ag.sc(m):this.Ui.sc(m)},u.prototype.$r=function(m){return this.Tf?this.ag.Gc(m):this.Ui.Gc(m)},u.iq=function(m){return(1&m)==0},u.Hv=function(m){return(1&m)==1},u.prototype.bz=function(m){return this.me.U(m,0)},u.prototype.ZQ=function(m){return this.me.U(m,1)},u.prototype.mk=function(m){return this.me.U(m,2)},u.prototype.oR=function(m){return this.me.U(m,3)},u.prototype.LR=function(m){return this.me.U(m,4)},u.prototype.rj=function(m){return this.me.U(m,5)},u.prototype.lk=function(m){return this.me.U(m,6)},u.prototype.MF=function(m){return this.me.U(m,7)},u.prototype.rz=function(m){return this.Fj.U(m,0)},u.prototype.nR=function(m){return this.Fj.U(m,1)},u.prototype.KR=function(m){return this.Fj.U(m,2)},u.prototype.vR=function(m){return this.Gj[m].pa},u.prototype.sR=function(m){return this.Gj[m].wa},u.prototype.vX=function(m,g){this.Cm==null&&(this.Cm=new f.Yt);var v=new h(this);this.Cm.sort(m,0,g,v)},u.prototype.uX=function(m,g,v){var w=this;m.Wd(g,v,function(E,C){var R=w.nk(E),I=w.nk(C);return R<I||R==I&&u.iq(E)&&u.Hv(C)?-1:1})},u.prototype.nk=function(m){var g=this.Gj[m>>1];return u.iq(m)?g.pa:g.wa},u}();f.ur=c}(ae||(ae={})),function(f){var N=function(){function T(d){if(d==null)throw f.i.ga("Invalid arguement");this.hf=d;var h=d.fR();h.ZR()?d.ef.AG()?this.mo=f.ti.PannableFold:this.mo=f.ti.Clip:this.mo=f.ti.DontClip,h.$R()?d.Zf.AG()?this.Sm=f.ti.PannableFold:this.Sm=f.ti.Clip:this.Sm=f.ti.DontClip,this.Dm=h.Lu,this.eH=h.Gy,d=this.hf.kH,this.TG=d.js(2147483648),this.Vv=d.js(1073741824)}return T.Ah=function(d,h,o){return h.xw.Ah(d,o)},T.St=function(d,h,o,c){return d.xw.St(h,o,c)},T.Rt=function(d,h,o,c){if(o=0>o?h.length:o,(d=d.xw.St(h,o,c))==o)return d;for(var u=h=0;u<o;u++){var m=c[u];m.isNaN()||(h<u&&c[h].N(m),h++)}for(;h<o;h++)c[h].Sc();return d},T.transform=function(d,h,o,c,u){if(d.isIdentity())return f.ta.cP(c,h,o),o;for(var m=[],g=0,v=0;v<o;){for(var w=Math.min(m.length,o-v),E=v,C=0;E<w;E++,C++)m[C]==null?m[C]=h[E].D():h[E].D(m[C]);var R=u?T.Rt(d,m,w,m):T.St(d,m,w,m);for(C=E=0;E<R;E++,C++)c[v]==null&&(c[v]=new f.Ta(h[v])),c[v].Db(m[C]);v+=w,g+=R}return g},T.prototype.St=function(d,h,o){if(this.hf.isIdentity())return d!=o&&f.ta.Tu(o,d,h),h;var c=this.hf.ef,u=this.hf.Zf,m=c.Tb(),g=u.Tb();if(m==0&&m===g){var v=c.Sp();return u=v/(u=u.Sp()),(v=new f.Ed).It(u,u),v.TX(d,h,o),h}if(v=f.P.Gu(Math.min(h,64)),m==3){var w=c.Ki;m=(c=w.fk()).Tb(),o!=d&&f.ta.Tu(o,d,h),f.Ab.al(w,o,h,!0),w.Rt(f.dm.forward,o,h),f.Ab.$k(w,o,h,!0)}if(m==3||g===3)throw f.i.ga("image: transform_in_place_");if(m==2)this.mo==f.ti.Clip?(o!=d&&f.ta.Tu(o,d,h),d=c.ol(),f.Ab.FS(d,c,o,h)):(o!=d&&f.ta.Tu(o,d,h),c.Xc()&&(m=c.Yd(0),w=c.Le(),f.Ab.sX(o,h,w,m),f.Ab.iF(o,h,c,0))),f.Ab.AL(c,o,h,v);else for(m=c.Yd(0),w=c.Le(),c=0;c<h;c++)f.Ab.tX(d[c],w,m,o[c]);for(f.Ab.yL(this.hf,o,h,v),d=0,(g=g==2)?d=u.Ai():isNaN(this.Dm)||(d=this.Dm),g&&this.Sm!=f.ti.Clip||f.Ab.iF(o,h,u.tc(),d),g&&(f.Ab.qG(o,h,u,this.Sm),f.Ab.zL(u,o,h,v)),d=h,c=0;c<h;++c)o[c].isNaN()&&d--;return d},T.prototype.Ah=function(d,h){if(this.hf.isIdentity()||d.B())return d;if(d.K()==33)return this.OI(d);var o=this.hf.ef,c=this.hf.Zf,u=o.Tb(),m=c.Tb();if(u==0&&u==m)return h=o.Sp(),h/=c=c.Sp(),(c=new f.Ed).It(h,h),(d=f.ba.ig(d)).Pc(c),d;switch(d.K()){case 1607:case 1736:d=this.MI(d,h);break;case 550:d=this.WV(d,h);break;case 197:d=this.VV(d,h);break;default:throw f.i.ga("")}return d},T.prototype.OI=function(d){var h=d.D(),o=[];return o[0]=h,this.St(o,1,o),(d=new f.Ta(d)).Db(o[0]),d},T.prototype.MI=function(d,h){if(d.vm())throw f.i.ga("curves not supported");var o=d.K();if(o==1736)return this.XV(d,h);if(o==1607)return this.YV(d,h);throw f.i.ga("projectMultiPath")},T.prototype.XV=function(d,h){var o=this.hf.ef,c=this.hf.Zf,u=o.Tb(),m=c.Tb(),g=f.P.Gu(Math.min(d.I(),64)),v=f.Ea.ig(d);u==3&&(u=(o=(d=o.Ki).fk()).Tb(),v=d.al(v,!0),this.yp(d,f.dm.forward,v),v=d.$k(v,!0)),d=null,m==3&&(m=(c=(d=c.Ki).fk()).Tb());var w=u==2,E=m==2,C=E?c.tc():c,R=!E&&!this.Vv;m=!1;var I=v;if(w){if((I=f.Ab.LI(I,o,this.mo,h)).B())return I}else{if(v=new f.l,I.yc(v),u=o.Le(),v.G<u.G||v.H>u.H){var F=f.l.construct(v.v-1,u.G,v.C+1,u.H);if((I=f.si.Pu(I,F,o,NaN,0,h)).B())return I}v.S()>2*u.S()&&(I=f.Ab.Jp(I,-2*u.S(),2*u.S(),o,!0,0,!0,h))}v=this.eH,(u=!isNaN(v))&&(I=f.Zl.local().W(I,v,h)),F=E?c.kk():null;var U=NaN;w&&(U=o.Ai());var j=c.Xr()!=null;if(this.TG)w&&(f.Ab.wr(o,U,I,g),u&&(w=o.ih(),v*=(U=o.tc().ih())/w)),f.Ab.vr(this.hf,I,R,g),u&&(w=o.tc().ih(),v*=(U=c.tc().ih())/w),o=I;else{var ee=new f.Ua(I.description);ee.vD(I),w&&(f.Ab.wr(o,U,ee,g),u&&(w=o.ih(),v*=(U=o.tc().ih())/w)),f.Ab.vr(this.hf,ee,R,g),u&&(w=o.tc().rm(),v*=(U=c.tc().rm())/w),R=NaN,E?(F=c.kk(),R=c.Ai()):isNaN(this.Dm)||(R=this.Dm),w=T.uv(o)|T.uv(c),U=10*C.Yd(0),this.Vv&&(w=3,U=0),o=f.Ab.MQ(I,o,ee,C,R,h,w,U)}return j&&(o=f.Ab.PD(o,c,h)),E&&(m||(E=C.Le().S(),o.Ug(0,0).S()>=E-C.Yd(0)&&(C=F.getNorthPoleLocation(),E=F.getSouthPoleLocation(),I=F.getNorthPoleGeometry(),F=F.getSouthPoleGeometry(),R=0,I==f.Eg.PE_POLE_POINT&&C!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(R=1),F==f.Eg.PE_POLE_POINT&&E!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(R|=2),R!==0&&(m=!0))),o=f.Ab.Hz(o,c,this.Sm,h),u&&(o=f.Zl.local().W(o,v,h)),f.Ab.Jx(c,o,g)),o.B()||(m&&(o=f.$l.local().W(o,c,!1,h)),d!=null&&(o=d.$k(o,!1),this.yp(d,f.dm.reverse,o),o=d.al(o,!1))),o},T.uv=function(d){if(d.Tb()!=2)return 0;var h=0,o=d.kk();d=o.getNorthPoleLocation();var c=o.getSouthPoleLocation(),u=o.getNorthPoleGeometry();return o=o.getSouthPoleGeometry(),u==f.Eg.PE_POLE_POINT&&d!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(h=1),o==f.Eg.PE_POLE_POINT&&c!=f.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(h|=2),h},T.prototype.YV=function(d,h){var o=this.hf.ef,c=this.hf.Zf,u=o.Tb(),m=c.Tb(),g=f.P.Gu(Math.min(d.I(),64)),v=f.Ua.ig(d);u==3&&(u=(o=(d=o.Ki).fk()).Tb(),v=d.al(v,!0),this.yp(d,f.dm.forward,v),v=d.$k(v,!0)),d=null,m==3&&(m=(c=(d=c.Ki).fk()).Tb());var w=u==2;u=(m=m==2)?c.tc():c;var E=!m&&!this.Vv;if(w){if((v=f.Ab.LI(v,o,this.mo,h)).B())return v}else{var C=new f.l;v.yc(C);var R=o.Le();if((C.G<R.G||C.H>R.H)&&(C=f.l.construct(C.v-1,R.G,C.C+1,R.H),(v=f.si.Pu(v,C,o,NaN,0,h)).B()))return v}var I=NaN;w&&(I=o.Ai()),C=c.Xr()!=null,R=this.eH;var F=!isNaN(R);if(F&&(v=f.Zl.local().W(v,R,h)),this.TG)w&&f.Ab.wr(o,I,v,g),F&&(w=o.ih(),R*=(I=o.tc().ih())/w),f.Ab.vr(this.hf,v,E,g),F&&(w=o.tc().ih(),R*=(I=c.tc().ih())/w),o=v;else{var U=new f.Ua(v.description);U.vD(v),w&&(f.Ab.wr(o,I,U,g),F&&(w=o.ih(),R*=(I=o.tc().ih())/w)),f.Ab.vr(this.hf,U,E,g),F&&(w=o.tc().ih(),R*=(I=c.tc().ih())/w),E=NaN,m?E=c.Ai():isNaN(this.Dm)||(E=this.Dm),w=T.uv(o)|T.uv(c),I=10*u.Yd(0),this.Vv&&(w=3,I=0),o=f.Ab.NQ(v,o,U,u,E,h,w,I)}return C&&(o=f.Ab.PD(o,c,h)),m&&(o=f.Ab.Hz(o,c,this.Sm,h),F&&(o=f.Zl.local().W(o,R,h)),f.Ab.Jx(c,o,g)),o.B()||d!=null&&(o=d.$k(o,!1),this.yp(d,f.dm.reverse,o),o=d.al(o,!1)),o},T.prototype.VV=function(d,h){var o=(d.da()+d.S())/400;return o!=0?(o=f.Zl.local().W(d,o,h),o=this.MI(o,h),h=d.Ja(),o.dn(h)):(h=new f.Ta(d.Kp()),o=this.OI(h),h=d.Ja(),o.B()?h.Pa():(d.copyTo(h),d=o.D(),h.L(d.x,d.y,d.x,d.y))),h},T.prototype.WV=function(d,h){d=f.ba.ig(d);var o=this.hf.ef,c=this.hf.Zf,u=o.Tb(),m=c.Tb(),g=f.P.Gu(Math.min(d.I(),64));if(u==3){var v=o.Ki;u=(o=v.fk()).Tb(),d=v.$k(d,!0),this.yp(v,f.dm.forward,d),d=v.al(d,!0)}if(u==2){if(this.mo==f.ti.Clip?d=f.Wk.local().W(d,o.ol(),o,h):o.Xc()&&(u=new f.l,d.yc(u),o.Le().contains(u)||(this.mo==f.ti.PannableFold&&(d=f.Ab.mj(d,o)),f.Ab.Kt(d,o.Le(),o.Yd(0),!0),d=f.Ab.Gn(d,o,0,!0,0,h))),d.B())return d;f.Ab.wr(o,0,d,g)}else f.Ab.Kt(d,o.Le(),o.Yd(0),!0);return f.Ab.vr(this.hf,d,!1,g),o=0,u=!1,v=null,m==3&&(u=!0,m=(c=(v=c.Ki).fk()).Tb()),(m=m==2)?o=c.Ai():isNaN(this.Dm)||(o=this.Dm),m&&this.Sm!=f.ti.Clip||(d=f.Ab.Gn(d,c.tc(),o,!1,0,h)),m&&(d=f.Ab.Hz(d,c,this.Sm,h),f.Ab.Jx(c,d,g),d.B())||u&&(d=v.$k(d,!0),this.yp(v,f.dm.reverse,d),d=v.al(d,!0)),d},T.prototype.yp=function(d,h,o){var c=o.I();if(c!=0){for(var u=o.vb(0),m=f.P.lg(200,0),g=[],v=0;v<c;){var w=Math.min(100,c-v);u.Ww(2*v,2*w,m,2,!0);for(var E=0;E<w;++E)g[E]=f.h.construct(m[2*v],m[2*v+1]);d.Rt(h,g,w),v+=w}o.Qc(1993)}},T.Py=function(d,h,o){if(d==null||h==null||!h.Xc())throw f.i.ga("Invalid Arguement");if(d.B())return d;var c=d.K();return c==197?(c=new f.Ea(d.description)).bd(d,!1):f.ba.zd(c)?(c=new f.Ua(d.description)).oc(d,!0):c=d,(c=f.Ab.mj(c,h)).B()?c:f.Ab.Gn(c,h,0,c!=d,0,o)},T.oj=function(d,h,o,c){if(d==null||h==null||!h.Xc())throw f.i.ga("Invalid Arguement");if(d.B())return d;var u=d.K();if(f.ba.Ic(u)){d=f.Ab.mj(d,h),u=new f.l,d.A(u);for(var m=f.ta.ny(h,u,!1),g=h.hh(),v=Math.floor((u.v-g.v)/g.S())*g.S()+g.v;v<u.C;)v>u.v+m&&v<u.C-m&&(d=f.Ab.lS(d,h,o,v)),v+=g.S()}else{if(u==197)return(u=new f.Ea(d.description)).bd(d,!1),T.oj(u,h,o,c);if(f.ba.zd(u))return(u=new f.Ua(d.description)).oc(d,!0),T.oj(u,h,o,c)}return T.Py(d,h,c)},T}();f.cu=N}(ae||(ae={})),function(f){var N=function(T){function d(h,o,c,u){var m=T.call(this)||this;return h===void 0?m.description=f.ee.og():c===void 0?m.description=h:(m.description=f.ee.og(),m.SB(h,o),m.Sl(c,u)),m}return Hi(d,T),d.prototype.K=function(){return 322},d.prototype.Rb=function(){var h=this.sa-this.qa,o=this.oa-this.ma;return Math.sqrt(h*h+o*o)},d.prototype.Ci=function(h){var o=this.sa-this.qa,c=this.oa-this.ma;return Math.sqrt(o*o+c*c)<=h},d.prototype.Qn=function(){return!1},d.prototype.jg=function(){var h=new f.h;return h.vc(this.xc(),this.ac()),h},d.VO=function(h,o){return new d(h.x,h.y,o.x,o.y)},d.prototype.dn=function(h){h.Pa(),h.kg(this.description);var o=new f.l;this.A(o),h.Yo(o),o=1;for(var c=this.description.Ba;o<c;o++)for(var u=this.description.qd(o),m=f.ua.Wa(u);o<m;o++){var g=this.Ug(u,0);h.setInterval(u,0,g)}},d.prototype.A=function(h){h.L(this.sa,this.oa,this.qa,this.ma),h.normalize()},d.prototype.Ro=function(h){h.Pa(),h.$b(this.sa,this.oa,this.Pd(0,1,0)),h.$b(this.qa,this.ma,this.Pd(1,1,0))},d.prototype.Pc=function(h){if(h instanceof f.Ed){this.wc();var o=new f.h;o.x=this.sa,o.y=this.oa,h.Fh(o,o),this.sa=o.x,this.oa=o.y,o.x=this.qa,o.y=this.ma,h.Fh(o,o),this.qa=o.x,this.ma=o.y}else this.wc(),(o=new f.Od).x=this.sa,o.y=this.oa,o.z=this.Pd(0,1,0),o=h.gp(o),this.sa=o.x,this.oa=o.y,this.vn(0,1,0,o.z),o.x=this.qa,o.y=this.ma,o.z=this.Pd(1,1,0),o=h.gp(o),this.qa=o.x,this.ma=o.y,this.vn(1,1,0,o.z)},d.prototype.Ja=function(){return new d(this.description)},d.prototype.Rx=function(h,o){return(this.qa-h-(this.sa-h))*(this.ma-o+(this.oa-o))*.5},d.prototype.tx=function(h){return h*this.Rb()},d.prototype.FG=function(h){return h/this.Rb()},d.prototype.vF=function(h){return f.mc.jq(this.sa,this.qa,h)},d.prototype.YQ=function(h){return f.mc.jq(this.oa,this.ma,h)},d.prototype.el=function(h,o){var c=new f.hg;return this.bh(h,o,c),c.get()},d.prototype.bh=function(h,o,c){if(c==null)throw f.i.O();c.Pr(),(c=c.get()).kg(this.description);var u=new f.h;this.ic(h,u),c.SB(u.x,u.y),this.ic(o,u),c.Sl(u.x,u.y),u=1;for(var m=this.description.Ba;u<m;u++)for(var g=this.description.Fd(u),v=f.ua.Wa(g),w=0;w<v;w++){var E=this.Vc(h,g,w);c.RB(g,w,E),E=this.Vc(o,g,w),c.IB(g,w,E)}},d.prototype.Vc=function(h,o,c){if(o==0)return c==0?this.ic(h).x:this.ic(h).y;switch(f.ua.gz(o)){case 0:return .5>h?this.xv(o,c):this.hv(o,c);case 1:var u=this.xv(o,c);return o=this.hv(o,c),f.mc.jq(u,o,h);case 2:throw f.i.ga("not implemented")}throw f.i.Ra()},d.prototype.fe=function(h,o){var c=this.qa-this.sa,u=this.ma-this.oa,m=c*c+u*u;return m==0?.5:(h=((h.x-this.sa)*c+(h.y-this.oa)*u)/m,o||(0>h?h=0:1<h&&(h=1)),h)},d.prototype.fq=function(h,o,c,u){if(h){if((h=this.ma-this.oa)==0)return o==this.ma?-1:0;if(0>(o=(o-this.oa)/h)||1<o)return 0;c!=null&&(c[0]=this.vF(o))}else{if((h=this.qa-this.sa)==0)return o==this.qa?-1:0;if(0>(o=(o-this.sa)/h)||1<o)return 0;c!=null&&(c[0]=this.YQ(o))}return u!=null&&(u[0]=o),1},d.prototype.Me=function(h,o){var c=this.ma-this.oa;return c==0?h==this.ma?o:NaN:(h=(h-this.oa)/c,o=this.vF(h),h==1&&(o=this.qa),o)},d.prototype.su=function(h,o,c){return 0<=this.sp(h.x,h.y,o,c)},d.prototype.wi=function(h,o,c){return 0<=this.sp(h,o,c,!0)},d.prototype.rs=function(h,o){return this.su(h,o,!1)},d.prototype.jI=function(){if(this.ma<this.oa||this.ma==this.oa&&this.qa<this.sa){var h=this.sa;this.sa=this.qa,this.qa=h,h=this.oa,this.oa=this.ma,this.ma=h,h=0;for(var o=this.description.Qq-2;h<o;h++){var c=this.la[h];this.la[h]=this.la[h+o],this.la[h+o]=c}}},d.prototype.vu=function(h,o){(o=f.h.construct(h,o)).sub(this.ac());var c=new f.h;return c.vc(this.xc(),this.ac()),(h=c.xi(o))>(o=8881784197001252e-31*(Math.abs(c.x*o.y)+Math.abs(c.y*o.x)))?-1:h<-o?1:0},d.prototype.sp=function(h,o,c,u){var m=this.sa,g=this.oa,v=h-m,w=o-g;if((v=Math.sqrt(v*v+w*w))<=Math.max(c,6661338147750939e-31*v))return u&&v==0?NaN:0;if(v=h-this.qa,w=o-this.ma,(v=Math.sqrt(v*v+w*w))<=Math.max(c,6661338147750939e-31*v))return u&&v==0?NaN:1;if(v=this.qa-this.sa,w=this.ma-this.oa,0<(u=Math.sqrt(v*v+w*w))){var E=1/u,C=h-m,R=o-g,I=C*(v*=E)+R*(w*=E),F=17763568394002505e-31*(Math.abs(C*v)+Math.abs(R*w)),U=v;if(v=-w,w=U,I<-(F=Math.max(c,F))||I>u+F)return NaN;if(Math.abs(C*v+R*w)<=Math.max(c,17763568394002505e-31*(Math.abs(C*v)+Math.abs(R*w)))&&(.5>=(v=f.P.Rk(I*E,0,1))?(w=this.sa+(this.qa-this.sa)*v,u=this.oa+(this.ma-this.oa)*v):(w=this.qa-(this.qa-this.sa)*(1-v),u=this.ma-(this.ma-this.oa)*(1-v)),f.h.Jy(w,u,h,o)<=c)){if(.5>v){if(f.h.Jy(w,u,m,g)<=c)return 0}else if(f.h.Jy(w,u,this.qa,this.ma)<=c)return 1;return v}}return NaN},d.prototype.Nb=function(h){return h!=null&&(h==this||h.constructor===this.constructor&&this.xM(h))},d.prototype.jD=function(h,o,c){var u=c?this.sa:this.qa;c=c?this.oa:this.ma;var m=new f.h;return m.x=h.qa-u,m.y=h.ma-c,!(o.Rh(m)>6661338147750939e-31*o.YC(m))||(m.x=h.sa-u,m.y=h.oa-c,o.Rh(m)<=6661338147750939e-31*o.YC(m))},d.prototype.iD=function(h){var o=new f.h;return o.x=this.qa-this.sa,o.y=this.ma-this.oa,!!this.jD(h,o,!1)&&(o.Uq(),!!this.jD(h,o,!0))},d.FM=function(h,o){var c=h.vu(o.sa,o.oa),u=h.vu(o.qa,o.ma);return!(0>c&&0>u||0<c&&0<u)&&(c=o.vu(h.sa,h.oa),u=o.vu(h.qa,h.ma),!(0>c&&0>u||0<c&&0<u)&&((c=h.Rb())>(u=o.Rb())?h.iD(o):o.iD(h)))},d.DM=function(h,o,c){var u=f.h.construct(NaN,NaN),m=h.qa-h.sa,g=h.ma-h.oa,v=o.qa-o.sa,w=o.ma-o.oa,E=v*g-m*w;if(E==0)return u;var C=8881784197001252e-31*(Math.abs(v*g)+Math.abs(m*w)),R=o.sa-h.sa,I=o.oa-h.oa,F=v*I-R*w,U=F/E,j=Math.abs(E);return U<-(v=(8881784197001252e-31*(Math.abs(v*I)+Math.abs(R*w))*j+C*Math.abs(F))/(E*E)+2220446049250313e-31*Math.abs(U))||U>1+v||(v=(w=m*I-R*g)/E)<-(m=(8881784197001252e-31*(Math.abs(m*I)+Math.abs(R*g))*j+C*Math.abs(w))/(E*E)+2220446049250313e-31*Math.abs(v))||v>1+m||(U=f.P.Rk(U,0,1),m=f.P.Rk(v,0,1),g=h.ic(U),E=o.ic(m),(C=new f.h).vc(g,E),C.length()>c&&(C.add(g,E),C.scale(.5),U=h.fe(C,!1),m=o.fe(C,!1),h=h.ic(U),o=o.ic(m),h.sub(o),h.length()>c)||u.na(U,m)),u},d.GM=function(h,o,c,u){var m=0;if((h.sa==o.sa&&h.oa==o.oa||h.sa==o.qa&&h.oa==o.ma)&&(m++,!u))return 1;if(h.qa==o.sa&&h.ma==o.oa||h.qa==o.qa&&h.ma==o.ma){if(++m==2)return 2;if(!u)return 1}return o.wi(h.sa,h.oa,c)||o.wi(h.qa,h.ma,c)||h.wi(o.sa,o.oa,c)||h.wi(o.qa,o.ma,c)?1:u&&m!=0||d.FM(h,o)==0?0:1},d.Xx=function(h,o,c,u,m,g){var v=0,w=h.sp(o.sa,o.oa,g,!1),E=h.sp(o.qa,o.ma,g,!1),C=o.sp(h.sa,h.oa,g,!1),R=o.sp(h.qa,h.ma,g,!1);return isNaN(w)||(u!=null&&(u[v]=w),m!=null&&(m[v]=0),c!=null&&(c[v]=f.h.construct(o.sa,o.oa)),v++),isNaN(E)||(u!=null&&(u[v]=E),m!=null&&(m[v]=1),c!=null&&(c[v]=f.h.construct(o.qa,o.ma)),v++),v==2||isNaN(C)||w==0&&C==0||E==0&&C==1||(u!=null&&(u[v]=0),m!=null&&(m[v]=C),c!=null&&(c[v]=f.h.construct(h.sa,h.oa)),v++),v==2||isNaN(R)||w==1&&R==0||E==1&&R==1||(u!=null&&(u[v]=1),m!=null&&(m[v]=R),c!=null&&(c[v]=f.h.construct(o.qa,o.ma)),v++),0<v?(v==2&&u!=null&&u[0]>u[1]&&(h=u[0],u[0]=u[1],u[1]=h,m!=null&&(u=m[0],m[0]=m[1],m[1]=u),c!=null&&(m=f.h.construct(c[0].x,c[0].y),c[0]=c[1],c[1]=m)),v):(v=d.DM(h,o,g),isNaN(v.x)?0:(c!=null&&(c[0]=h.ic(v.x)),u!=null&&(u[0]=v.x),m!=null&&(m[0]=v.y),1))},d.prototype.XF=function(){return 0},d.prototype.pp=function(){},d.prototype.toString=function(){return"Line: ["+this.sa.toString()+", "+this.oa.toString()+", "+this.qa.toString()+", "+this.ma.toString()+"]"},d}(f.KC);f.zb=N}(ae||(ae={})),function(f){var N=function(){function T(){this.Lm=[],this.za=-1}return T.prototype.Ma=function(){return this.za},T.prototype.next=function(){if(this.Lm!=null&&this.Lm.length!=0){this.za++;var d=this.Lm[0];return this.Lm=1>=this.Lm.length?[]:this.Lm.slice(1),d}return this.Lm=null},T.prototype.NX=function(d){this.Lm.push(d)},T.prototype.qe=function(){},T}();f.ZK=N}(ae||(ae={})),function(f){var N;(N=f.KL||(f.KL={}))[N.enumFillRuleOddEven=0]="enumFillRuleOddEven",N[N.enumFillRuleWinding=1]="enumFillRuleWinding";var T=function(d){function h(o,c){var u=d.call(this)||this;if(u.yf=!1,u.Gq=null,u.uq=0,u.tq=0,u.Bj=null,u.Ng=!1,u.nb=null,u.mb=null,u.Se=null,u.Mj=null,u.Td=null,u.vq=0,u.gb=0,u.zq=0,c===void 0)u.yf=o,u.Ng=!1,u.vq=0,u.uq=0,u.tq=0,u.xa=0,u.description=f.ee.og();else{if(c==null)throw f.i.O();u.yf=o,u.Ng=!1,u.vq=0,u.uq=0,u.tq=0,u.xa=0,u.description=c}return u.Bj=null,u.gb=0,u}return Hi(h,d),h.prototype.vm=function(){return 0<this.vq},h.prototype.Wx=function(){this.wc(),this.Gq==null?this.Gq=new f.Ta(this.description):this.Gq.kg(this.description)},h.prototype.qx=function(o,c){var u=new f.h;u.x=o,u.y=c,this.Mt(u)},h.prototype.Mt=function(o){this.Wx(),this.Gq.Db(o),this.Ng=!0},h.prototype.nf=function(o){if(o.B())throw f.i.O();this.Ll(o.description),this.Wx(),o.copyTo(this.Gq),this.Ng=!0},h.prototype.Qx=function(){var o=1;this.Ng&&(this.Wx(),this.nb==null?(this.nb=f.Zc.Ph(2),this.nb.write(0,0),this.mb=f.Zc.Nr(2,0)):(this.nb.resize(this.nb.size+1,0),this.mb.resize(this.mb.size+1,0)),this.yf&&this.mb.write(this.mb.size-2,1),o++);var c=this.xa;this.nb.write(this.nb.size-1,this.xa+o),this.fm(c+o),this.mb.write(this.nb.size-1,0),this.Ng&&(this.Ht(c,this.Gq),this.Ng=!1)},h.prototype.zj=function(o,c){this.Qx(),this.Db(this.xa-1,o,c)},h.prototype.Di=function(o){this.Qx(),this.Db(this.xa-1,o)},h.prototype.lineTo=function(o){this.Qx(),this.Ht(this.xa-1,o)},h.prototype.sU=function(o){if(this.wc(),this.yf)throw f.i.Ra();var c=this.ea();if(o>c)throw f.i.Ra();if(this.ec(o)){if(this.mb==null)throw f.i.Ra();var u=this.xa,m=this.Ca(o),g=this.Wc(o);this.fm(this.xa+1),this.rc();for(var v=0,w=this.description.Ba;v<w;v++)if(this.Aa[v]!=null){var E=f.ua.Wa(this.description.Fd(v));this.Aa[v].Nn(E*g,this.Aa[v],E*m,E,!0,1,E*u)}for(;c>o;c--)u=this.nb.read(c),this.nb.write(c,u+1);this.mb.CE(o,1)}},h.prototype.Cp=function(){if(this.ux(),o===void 0){this.Ng=!1;var o=this.ea()-1}var c=this.mb.read(o);this.mb.write(o,1|c),this.Se!=null&&(o=this.Wc(o)-1,this.Se.write(o,1),this.Mj.write(o,-1))},h.prototype.ec=function(o){return(1&this.mb.read(o))!=0},h.prototype.On=function(o){if(this.ec(o))return!0;var c=this.Ca(o);return!(c>(o=this.Wc(o)-1))&&(c=this.Oa(c),o=this.Oa(o),c.rb(o))},h.prototype.zv=function(o){return(2&this.mb.read(o))!=0},h.prototype.oc=function(o,c){if(this.Ll(o.description),o.K()!=322)throw f.i.Ra();var u=new f.Ta;(c||this.B())&&(o.Uo(u),this.nf(u)),o.Qo(u),this.lineTo(u)},h.prototype.vp=function(o){var c=this.xa==0;this.qx(o.v,o.G),this.zj(o.v,o.H),this.zj(o.C,o.H),this.zj(o.C,o.G),this.Cp(),this.Ng=!1,c&&this.Nf(256,!1)},h.prototype.bd=function(o,c){if(!o.B()){for(var u=this.xa==0,m=new f.Ta(this.description),g=0;4>g;g++)o.If(c?4-g-1:g,m),g==0?this.nf(m):this.lineTo(m);this.Cp(),this.Ng=!1,u&&!c&&this.Nf(256,!1)}},h.prototype.add=function(o,c){for(var u=0;u<o.ea();u++)this.addPath(o,u,!c)},h.prototype.addPath=function(o,c,u){this.wf(-1,o,c,u)},h.prototype.Zk=function(o,c){this.Cz(o,c)},h.prototype.Fr=function(o,c,u,m,g){if(g||this.ea()!=0||(g=!0),0>c&&(c=o.ea()-1),c>=o.ea()||0>u||0>m||m>o.sv(c))throw f.i.ga("index out of bounds");if(m!=0){var v=o.ec(c)&&u+m==o.sv(c);if(!v||m!=1){if(this.Ng=!1,this.Ll(o.description),u=o.Ca(c)+u+1,g&&(m++,u--),v&&m--,v=this.xa,this.fm(this.xa+m),this.rc(),g){if(m==0)return;this.nb.add(this.xa),g=o.mb.read(c),g&=-5,this.yf&&(g|=1),this.mb.write(this.mb.size-1,g),this.mb.add(0)}else this.nb.write(this.mb.size-1,this.xa);g=0;for(var w=this.description.Ba;g<w;g++){var E=this.description.qd(g),C=f.ua.Wa(E),R=o.description.Qf(E);0>R||o.Aa[R]==null?this.Aa[g].Mn(C*v,f.ua.te(E),m*C,C*v):this.Aa[g].Nn(C*v,o.Aa[R],C*u,m*C,!0,C,C*v)}if(this.vm()||o.zv(c))throw f.i.Ra();this.Qc(1993)}}},h.prototype.gJ=function(){for(var o=0,c=this.ea();o<c;o++)this.uW(o)},h.prototype.uW=function(o){if(this.rc(),o>=this.ea())throw f.i.O();var c=this.Ca(o),u=this.Ka(o);o=this.ec(o)?1:0;for(var m=0,g=this.description.Ba;m<g;m++)if(this.Aa[m]!=null){var v=f.ua.Wa(this.description.Fd(m));this.Aa[m].oi(v*(c+o),v*(u-o),v)}this.Qc(1993)},h.prototype.ar=function(o){this.rc();var c=this.ea();if(0>o&&(o=c-1),o>=c)throw f.i.O();for(var u=this.Ca(o),m=this.Ka(o),g=0,v=this.description.Ba;g<v;g++)if(this.Aa[g]!=null){var w=f.ua.Wa(this.description.Fd(g));this.Aa[g].Fn(w*u,w*m,w*this.xa)}for(u=o+1;u<=c;u++)g=this.nb.read(u),this.nb.write(u-1,g-m);if(this.mb==null)for(u=o+1;u<=c;u++)o=this.mb.read(u),this.mb.write(u-1,o);this.nb.resize(c),this.mb.resize(c),this.xa-=m,this.Qg-=m,this.Qc(1993)},h.prototype.wf=function(o,c,u,m){if(c==this||u>=c.ea())throw f.i.O();var g=this.ea();if(o>g)throw f.i.O();0>o&&(o=g),0>u&&(u=c.ea()-1),this.Ng=!1,this.Ll(c.description),c.rc();var v=c.Ca(u),w=c.Ka(u),E=this.xa,C=c.ec(u)&&!m?1:0;this.fm(this.xa+w),this.rc();for(var R=o<g?this.Ca(o):E,I=0,F=this.description.Ba;I<F;I++){var U=this.description.Fd(I),j=c.description.Qf(U),ee=f.ua.Wa(U);0<=j&&c.Aa[j]!=null?(C!=0&&this.Aa[I].Nn(R*ee,c.Aa[j],ee*v,ee,!0,ee,ee*E),this.Aa[I].Nn((R+C)*ee,c.Aa[j],ee*(v+C),ee*(w-C),m,ee,ee*(E+C))):this.Aa[I].Mn(R*ee,f.ua.te(U),ee*w,ee*E)}for(this.nb.add(E+w),m=g;m>=o+1;m--)v=this.nb.read(m-1),this.nb.write(m,v+w);for(c.zv(u),this.mb.add(0),m=g-1;m>=o+1;m--)g=this.mb.read(m),g&=-5,this.mb.write(m+1,g);g=c.BR().read(u),g&=-5,this.yf&&(g|=1),this.mb.write(o,g)},h.prototype.Cz=function(o,c){var u=-1,m=this.ea();if(u>m)throw f.i.O();0>u&&(u=m),this.Ng=!1;var g=this.xa;this.fm(this.xa+c),this.rc();var v=u<m?this.Ca(u):g;if(o!=null)this.Aa[0].Dz(2*v,o,0,c,!0,2*g);else{var w=f.ua.te(0);this.Aa[0].Mn(2*v,w,2*c,2*g)}o=1;for(var E=this.description.Ba;o<E;o++){w=this.description.qd(o);var C=f.ua.Wa(w);w=f.ua.te(w),this.Aa[o].Mn(v*C,w,C*c,C*g)}for(this.nb.add(this.xa),g=m;g>=u+1;g--)v=this.nb.read(g-1),this.nb.write(g,v+c);for(this.mb.add(0),g=m-1;g>=u+1;g--)c=this.mb.read(g),c&=-5,this.mb.write(g+1,c);this.yf&&this.mb.write(u,1)},h.prototype.iG=function(o,c,u){var m=-1;if(0>o&&(o=this.ea()),o>this.ea()||m>this.Ka(o)||u>c.length)throw f.i.ga("index out of bounds");if(u!=0){o==this.ea()&&(this.nb.add(this.xa),this.yf?this.mb.add(1):this.mb.add(0)),0>m&&(m=this.Ka(o)),this.rc();var g=this.xa;this.fm(this.xa+u),this.rc();for(var v=0,w=this.description.Ba;v<w;v++){var E=this.description.Fd(v),C=f.ua.Wa(E);this.Aa[v].Vt(C*(this.Ca(o)+m+u),(g-this.Ca(o)-m)*C,this.Aa[v],C*(this.Ca(o)+m),!0,C),v==0?this.Aa[v].oC(C*(this.Ca(o)+m),u,c,0,!0):this.Aa[v].Xj(f.ua.te(E),(this.Ca(o)+m)*C,u*C)}for(this.vm()&&(this.Se.Vt(this.Ca(o)+m+u,g-this.Ca(o)-m,this.Se,this.Ca(o)+m,!0,1),this.Mj.Vt(this.Ca(o)+m+u,g-this.Ca(o)-m,this.Mj,this.Ca(o)+m,!0,1),this.Se.Xj(1,this.Ca(o)+m,u),this.Mj.Xj(-1,this.Ca(o)+m,u)),o+=1,c=this.ea();o<=c;o++)this.nb.write(o,this.nb.read(o)+u)}},h.prototype.xf=function(o,c,u){var m=this.ea();if(0>o&&(o=this.ea()),o>=m||c>this.Ka(o))throw f.i.ga("index out of bounds");o==this.ea()&&(this.nb.add(this.xa),this.yf?this.mb.add(1):this.mb.add(0)),0>c&&(c=this.Ka(o));var g=this.xa;this.fm(this.xa+1),this.rc();var v=this.Ca(o);this.Aa[0].wj(2*(v+c),u,2*g),u=1;for(var w=this.description.Ba;u<w;u++){var E=this.description.Fd(u),C=f.ua.Wa(E);this.Aa[u].Mn(C*(v+c),f.ua.te(E),C,C*g)}for(o+=1;o<=m;o++)this.nb.write(o,this.nb.read(o)+1)},h.prototype.xB=function(o,c){var u=this.ea();if(0>o&&(o=u-1),o>=u||c>=this.Ka(o))throw f.i.ga("index out of bounds");this.rc();var m=this.Ca(o);0>c&&(c=this.Ka(o)-1),c=m+c,m=0;for(var g=this.description.Ba;m<g;m++)if(this.Aa[m]!=null){var v=f.ua.Wa(this.description.Fd(m));this.Aa[m].Fn(v*c,v,v*this.xa)}for(;u>=o+1;u--)c=this.nb.read(u),this.nb.write(u,c-1);this.xa--,this.Qg--,this.Qc(1993)},h.prototype.mE=function(o,c,u,m){if(o=this.Ca(o)+c,(u=this.Ca(u)+m)<o||0>o||u>this.I()-1)throw f.i.O();c=0,(m=this.Ha()).Wb(o);do{for(;m.Ia()&&(o=m.ia(),m.xb()!=u);)c+=o=o.Rb();if(m.xb()==u)break}while(m.ab());return c},h.prototype.YN=function(o,c,u){if(c=this.Ca(o)+c,u=this.Ca(o)+u,0>c||u>this.I()-1)throw f.i.O();var m=this.Ha();if(c>u){if(!this.ec(o))throw f.i.O("cannot iterate across an open path");m.DB()}var g=o=0;m.Wb(c);do g+=o,o=m.ia().Rb();while(m.xb()!=u);return g},h.prototype.mg=function(){return f.ri.im(this,null)},h.prototype.BS=function(o,c,u){for(var m=o;m<u-1;m++)if(this.ec(m))throw f.i.O("cannot interpolate across closed paths");if((m=this.description.Ba)!=1){var g=this.mE(o,c,u,void 0);if(g!=0)for(var v=1;v<m;v++){var w=this.description.qd(v);if(f.ua.gz(w)!=2)for(var E=f.ua.Wa(w),C=0;C<E;C++)this.DS(w,o,c,u,g,C)}}},h.prototype.AS=function(o,c,u){var m=this.description.Ba;if(m!=1){var g=this.YN(o,c,u);if(g!=0)for(var v=1;v<m;v++){var w=this.description.qd(v);if(f.ua.gz(w)!=2)for(var E=f.ua.Wa(w),C=0;C<E;C++)this.CS(w,o,c,u,g,C)}}},h.prototype.DS=function(o,c,u,m,g,v){var w=this.Ha(),E=this.Ca(c)+u;m=this.Ca(m)+void 0,c=this.Vc(o,E,v),u=this.Vc(o,m,v);var C=c,R=0;w.Wb(E);do if(w.Ia()){if(w.ia(),w.xb()==m)break;this.setAttribute(o,w.xb(),v,C),w.mi();do{if(E=w.ia(),w.ik()==m)return;R+=E=E.Rb(),C=f.mc.jq(c,u,R/g),w.Pn()||this.setAttribute(o,w.ik(),v,C)}while(w.Ia())}while(w.ab())},h.prototype.CS=function(o,c,u,m,g,v){var w=this.Ha(),E=this.Ca(c)+u;if((c=this.Ca(c)+m)!=E){m=this.Vc(o,E,v),u=this.Vc(o,c,v);var C=0;w.Wb(E),w.DB(),E=m;do{var R=w.ia();this.setAttribute(o,w.xb(),v,E),C+=E=R.Rb(),E=f.mc.jq(m,u,C/g)}while(w.ik()!=c)}},h.prototype.Pa=function(){this.vq=0,this.Ng=!1,this.Td=this.Se=this.Mj=this.mb=this.nb=null,this.oD()},h.prototype.Pc=function(o){o instanceof f.Ed?this.QD(o,-1):this.oN(o)},h.prototype.QD=function(o,c){if(!this.B()&&!o.isIdentity()){this.rc();var u=this.Aa[0],m=new f.h,g=new f.h;if(0>c){var v=this.vm(),w=0;c=this.xa}else v=this.zv(c),w=this.Ca(c),c=this.Wc(c);for(;w<c;w++){if(m.x=u.read(2*w),m.y=u.read(2*w+1),v){var E=this.Mj.read(w);if(0<=E)switch(7&this.Se.read(w)){case 2:g.x=this.Td.read(E),g.y=this.Td.read(E+1),o.Fh(g,g),this.Td.write(E,g.x),this.Td.write(E+1,g.y),g.x=this.Td.read(E+3),g.y=this.Td.read(E+4),o.Fh(g,g),this.Td.write(E+3,g.x),this.Td.write(E+4,g.y);break;case 4:throw f.i.Ra()}}o.Fh(m,m),u.write(2*w,m.x),u.write(2*w+1,m.y)}this.Qc(1993)}},h.prototype.oN=function(o){if(!this.B()){this.se(1),this.rc();for(var c=this.Aa[0],u=this.Aa[1],m=new f.Od,g=new f.Od,v=this.vm(),w=0;w<this.xa;w++){if(m.x=c.read(2*w),m.y=c.read(2*w+1),m.z=u.read(w),v){var E=this.Mj.read(w);if(0<=E)switch(7&this.Se.read(w)){case 2:g.x=this.Td.read(E),g.y=this.Td.read(E+1),g.z=this.Td.read(E+2),g=o.gp(g),this.Td.write(E,g.x),this.Td.write(E+1,g.y),this.Td.write(E+1,g.z),g.x=this.Td.read(E+3),g.y=this.Td.read(E+4),g.z=this.Td.read(E+5),g=o.gp(g),this.Td.write(E+3,g.x),this.Td.write(E+4,g.y),this.Td.write(E+5,g.z);break;case 4:throw f.i.Ra()}}m=o.gp(m),c.write(2*w,m.x),c.write(2*w+1,m.y),u.write(w,m.z)}this.Qc(1993)}},h.prototype.dy=function(){this.nb==null&&(this.nb=f.Zc.Ph(1,0),this.mb=f.Zc.Nr(1,0)),this.Se!=null&&(this.Se.resize(this.Qg,1),this.Mj.resize(this.Qg,-1))},h.prototype.pp=function(o){o.Ng=!1,o.vq=this.vq,o.zq=this.zq,o.nb=this.nb!=null?f.ja.Cn(this.nb):null,o.mb=this.mb!=null?f.rn.Cn(this.mb):null,o.Mj=this.Mj!=null?f.ja.Cn(this.Mj):null,o.Se=this.Se!=null?f.rn.Cn(this.Se):null,o.Td=this.Td!=null?f.ce.Cn(this.Td):null,o.uq=this.uq,o.tq=this.tq,o.Bj=this.ak(1024)?null:this.Bj},h.prototype.Rb=function(){if(!this.ak(512))return this.uq;for(var o=this.Ha(),c=new f.Dx(0);o.ab();)for(;o.Ia();)c.add(o.ia().Rb());return this.uq=c.tm(),this.Nf(512,!1),c.tm()},h.prototype.Nb=function(o){if(o==this)return!0;if(!(o instanceof h&&d.prototype.Nb.call(this,o)))return!1;var c=this.ea();return!(c!=o.ea()||this.nb!=null&&!this.nb.Nb(o.nb,0,c+1)||this.zq!=o.zq||this.mb!=null&&!this.mb.Nb(o.mb,0,c))&&d.prototype.Nb.call(this,o)},h.prototype.Ha=function(){return new f.QL(this)},h.prototype.cy=function(o){if(d.prototype.cy.call(this,o),this.vm())for(o=this.Ha();o.ab();)o.Ia()},h.prototype.Ap=function(o,c){if(d.prototype.Ap.call(this,o,c),this.vm())for(o=this.Ha();o.ab();)o.Ia()},h.prototype.Yx=function(){this.xa=this.nb==null||this.nb.size==0?0:this.nb.read(this.nb.size-1)},h.prototype.He=function(){return this.yf?(this.yu(),this.tq):0},h.prototype.Fv=function(o){return!!this.yf&&(this.ak(8)?(this.yu(),0<this.Bj.read(o)):(4&this.mb.read(o))!=0)},h.prototype.Kr=function(o){return this.yf?(this.yu(),this.Bj.read(o)):0},h.prototype.yu=function(){if(this.ak(1024)){var o=this.ea();this.Bj==null?this.Bj=new f.ce(o):this.Bj.size!=o&&this.Bj.resize(o),o=new f.Dx(0);for(var c=new f.Dx(0),u=new f.h,m=0,g=this.Ha();g.ab();){for(c.reset(),this.D(this.Ca(g.gb),u);g.Ia();)c.add(g.ia().Rx(u.x,u.y));o.add(c.tm());var v=m++;this.Bj.write(v,c.tm())}this.tq=o.tm(),this.Nf(1024,!1)}},h.prototype.xR=function(){if(this.yf){this.hm();for(var o=this.ea(),c=0;c<o;c++)4&this.mb.read(c)}},h.prototype.hm=function(){if(this.ak(8)){this.yu();var o=this.ea();(this.mb==null||this.mb.size<o)&&(this.mb=f.Zc.Nr(o+1));for(var c=1,u=0;u<o;u++){var m=this.Bj.read(u);u==0&&(c=0<m?1:-1),0<m*c?this.mb.rJ(u,4):this.mb.CE(u,4)}this.Nf(8,!1)}},h.prototype.nz=function(o){var c=this.gb,u=this.ea();if(0<=c&&c<u){if(o<this.Wc(c)){if(o>=this.Ca(c))return c;c--}else c++;if(0<=c&&c<u&&o>=this.Ca(c)&&o<this.Wc(c))return this.gb=c}if(5>u){for(c=0;c<u;c++)if(o<this.Wc(c))return this.gb=c;throw f.i.ga("corrupted geometry")}for(c=0,--u;u>c;){var m=c+(u-c>>1);if(o<this.Ca(m))u=m-1;else{if(!(o>=(c=this.Wc(m))))return this.gb=m;c=m+1}}return this.gb=c},h.prototype.sz=function(){var o=this.I();if(!this.yf){o-=this.ea();for(var c=0,u=this.ea();c<u;c++)this.ec(c)&&o++}return o},h.prototype.sv=function(o){var c=this.Ka(o);return this.ec(o)||c--,c},h.prototype.Ja=function(){return new h(this.yf,this.description)},h.prototype.Eb=function(){return this.yf?2:1},h.prototype.K=function(){return this.yf?1736:1607},h.prototype.IJ=function(o){this.nb=o,this.Qc(16777215)},h.prototype.MR=function(){return this.ux(),this.Se},h.prototype.BR=function(){return this.ux(),this.mb},h.prototype.HJ=function(o){this.mb=o,this.Qc(16777215)},h.prototype.ea=function(){return this.nb!=null?this.nb.size-1:0},h.prototype.Wc=function(o){return this.nb.read(o+1)},h.prototype.Ka=function(o){return this.nb.read(o+1)-this.nb.read(o)},h.prototype.Ca=function(o){return this.nb.read(o)},h.prototype.mu=function(o,c){this.Cb==null&&(this.Cb=new f.Uk),c=f.Lx.fW(c);var u=this.Cb.Fk;if(u!=null){if(!(u.Ik<o||c>u.IR()))return!0;this.Cb.qD(null)}return u=f.Lx.create(this,o,c),this.Cb.qD(u),!0},h.prototype.dc=function(){var o=d.prototype.dc.call(this);if(!this.Bc()){var c=this.ea();this.nb!=null&&this.nb.Bn(o,0,c+1),this.mb!=null&&this.mb.Bn(o,0,c)}return o},h.prototype.RF=function(o){return this.Se!=null?this.Se.read(o):1},h.prototype.cc=function(o,c,u){var m=this.nz(o);if(o==this.Wc(m)-1&&!this.ec(m))throw f.i.ga("index out of bounds");this.rc();var g=this.Se,v=1;if(g!=null&&(v=7&g.read(o)),v!==1)throw f.i.Ra();if(c.Pr(),c=c.get(),u?c.kg(f.ee.og()):c.kg(this.description),m=o==this.Wc(m)-1&&this.ec(m)?this.Ca(m):o+1,g=new f.h,this.D(o,g),c.Ec(g),this.D(m,g),c.Rc(g),!u)for(u=1,g=this.description.Ba;u<g;u++){v=this.description.Fd(u);for(var w=f.ua.Wa(v),E=0;E<w;E++){var C=this.Vc(v,o,E);c.RB(v,E,C),C=this.Vc(v,m,E),c.IB(v,E,C)}}},h.prototype.Sj=function(o,c){if(o>=this.ea())throw f.i.O();if(this.B())c.Pa();else{if(this.zv(o))throw f.i.ga("not implemented");var u=this.vb(0),m=new f.h,g=new f.l;g.Pa();var v=this.Ca(o);for(o=this.Wc(o);v<o;v++)u.uc(2*v,m),g.$b(m);c.L(g)}},h.prototype.gj=function(o){return this.Cb==null&&(this.Cb=new f.Uk),!(o==0||16>this.I())&&(o=f.ta.fE(this),this.Cb.OM(o),!0)},h.prototype.$L=function(){if(this.Cb==null&&(this.Cb=new f.Uk),this.Cb.Ao==null){this.Cb.pD(null);var o=f.ta.QN(this);this.Cb.pD(o)}},h.prototype.Zo=function(o){this.zq=o},h.prototype.Jn=function(){return this.zq},h.prototype.vD=function(o){if(this==o)throw f.i.ga("MultiPathImpl.add");for(var c=this.ea(),u=0;u<o.ea();u++)this.addPath(o,u,!0),this.sU(c),c++},h.prototype.cO=function(o){var c=this.nz(o),u=this.Ca(c);if(u!=o){if(o>=(c=this.Wc(c))||o<u)throw f.i.ga("change_ring_start_point");for(var m=0,g=this.description.Ba;m<g;m++){var v=this.description.qd(m);v=f.ua.Wa(v),this.Aa[m].rotate(u*v,o*v,c*v)}}},h}(f.Ex);f.Vk=T}(ae||(ae={})),function(f){var N=function(T){function d(h){var o=T.call(this)||this;if(h!==void 0){if(h==null)throw f.i.O();o.description=h}else o.description=f.ee.og();return o.xa=0,o}return Hi(d,T),d.prototype.Ja=function(){return new d(this.description)},d.prototype.add=function(h){this.resize(this.xa+1),this.Eh(this.xa-1,h)},d.prototype.Cu=function(h,o){this.resize(this.xa+1);var c=new f.h;c.na(h,o),this.Db(this.xa-1,c)},d.prototype.Gd=function(h,o,c){if(c=0>c?h.I():c,0>o||o>h.I()||c<o)throw f.i.O();if(o!=c){this.Ll(h.description),c-=o;var u=this.xa;this.resize(this.xa+c),this.rc();for(var m=0,g=h.description.Ba;m<g;m++){var v=h.description.Fd(m),w=f.ua.Wa(v),E=this.vb(v);v=h.vb(v),E.Nn(u*w,v,o*w,c*w,!0,1,u*w)}}},d.prototype.zD=function(h,o){var c=h.length;if(o=0>o?c:o,0>c||0>o)throw f.i.O();if(o!=0){c=o-0,o=this.xa,this.resize(this.xa+c);for(var u=0;u<c;u++)this.Db(o+u,h[0+u])}},d.prototype.xB=function(h){if(0>h||h>=this.I())throw f.i.ga("index out of bounds");this.rc();for(var o=0,c=this.description.Ba;o<c;o++)if(this.Aa[o]!=null){var u=f.ua.Wa(this.description.Fd(o));this.Aa[o].Fn(u*h,u,u*this.xa)}this.xa--,this.Qg--,this.Qc(1993)},d.prototype.resize=function(h){this.fm(h)},d.prototype.pp=function(){},d.prototype.Pa=function(){T.prototype.oD.call(this)},d.prototype.Pc=function(h){if(h instanceof f.Ed){if(this.B())return;this.rc();for(var o=this.Aa[0],c=new f.h,u=0;u<this.xa;u++)c.x=o.read(2*u),c.y=o.read(2*u+1),h.Fh(c,c),o.write(2*u,c.x),o.write(2*u+1,c.y)}else{if(this.B())return;this.rc(),this.se(1),this.rc(),o=this.Aa[0],c=this.Aa[1];var m=new f.Od;for(u=0;u<this.xa;u++){m.x=o.read(2*u),m.y=o.read(2*u+1),m.z=c.read(u);var g=h.gp(m);o.write(2*u,g.x),o.write(2*u+1,g.y),c.write(u,g.z)}}this.Qc(1993)},d.prototype.Eb=function(){return 0},d.prototype.K=function(){return 550},d.prototype.He=function(){return 0},d.prototype.Rb=function(){return 0},d.prototype.Nb=function(h){return h==this||h instanceof d&&T.prototype.Nb.call(this,h)},d.prototype.bW=function(h,o){var c=this.xa;if(c=Math.min(c,o+1e3),0>o||o>=this.xa||c<o||h.length!=1e3)throw f.i.O();var u=c-o,m=[];for(this.vb(0).Ww(2*o,2*u,m,0,!0),o=0;o<u;o++)h[o]=f.h.construct(m[2*o],m[2*o+1]);return c},d.prototype.Yx=function(){},d.prototype.dy=function(){},d.prototype.mu=function(){return!1},d.prototype.gj=function(){return!1},d.prototype.mg=function(){return null},d}(f.Ex);f.de=N}(ae||(ae={})),function(f){var N;(N=f.aL||(f.aL={}))[N.NotDetermined=0]="NotDetermined",N[N.Structure=1]="Structure",N[N.DegenerateSegments=2]="DegenerateSegments",N[N.Clustering=3]="Clustering",N[N.Cracking=4]="Cracking",N[N.CrossOver=5]="CrossOver",N[N.RingOrientation=6]="RingOrientation",N[N.RingOrder=7]="RingOrder",N[N.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency",N[N.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency",N[N.OGCDisconnectedInterior=10]="OGCDisconnectedInterior";var T=function(){function d(h,o,c){h===void 0?(this.Kj=0,this.Lo=this.Ko=-1):(this.Kj=h,this.Ko=o,this.Lo=c)}return d.prototype.Xt=function(h){this.Kj=h.Kj,this.Ko=h.Ko,this.Lo=h.Lo},d}();f.Nd=T}(ae||(ae={})),function(f){f.P=function(){function N(){}return N.assert=function(T){if(T===!1)throw f.i.yK()},N.UJ=function(T){return isNaN(T)?NaN:T===0?T:0<T?1:-1},N.Gu=function(T){var d;d===void 0&&(d=0);for(var h=[],o=0;o<T;o++)h[o]=N.lg(2,d);return h},N.lg=function(T,d){d===void 0&&(d=0);for(var h=[],o=0;o<T;o++)h[o]=d;return h},N.av=function(T,d){var h,o;for(h===void 0&&(h=0),o===void 0&&(o=T.length-1);h<=o;h++)T[h]=d},N.Rk=function(T,d,h){return T<d?d:T>h?h:T},N.Uh=function(T,d){var h=5381;return((h=((h=((h=d!==void 0?(d<<5)+d+(255&T):(h<<5)+h+(255&T))<<5)+h+(T>>8&255))<<5)+h+(T>>16&255))<<5)+h+(T>>24&255)&2147483647},N.vj=function(){throw Error("Not Implemented")},N.WA=function(T){return N.RT(T)+12345&2147483647},N.OG=function(T){var d=32,h=T%N.Ox|0,o=T/N.Ox|0;return(d&=63)==0?T:(32>d?(T=h>>>d|o<<32-d,d=o>>d):(T=o>>d-32,d=0<=o?0:-1),d*N.Ox+(T>>>0))},N.RT=function(T){var d=1103515245,h=65535&d;return((d-h)*(T|=0)|0)+(h*T|0)|0},N.truncate=function(T){return 0>T?-1*Math.floor(Math.abs(T)):Math.floor(T)},N.MAX_SAFE_INTEGER=Math.pow(2,53)-1,N.MIN_SAFE_INTEGER=-N.MAX_SAFE_INTEGER,N.NC=65536,N.Ox=N.NC*N.NC,N}()}(ae||(ae={})),function(f){var N;(N=f.uL||(f.uL={}))[N.Project=0]="Project",N[N.Union=1]="Union",N[N.Difference=2]="Difference",N[N.Proximity2D=3]="Proximity2D",N[N.Relate=4]="Relate",N[N.Equals=5]="Equals",N[N.Disjoint=6]="Disjoint",N[N.Intersects=7]="Intersects",N[N.Within=8]="Within",N[N.Contains=9]="Contains",N[N.Crosses=10]="Crosses",N[N.Touches=11]="Touches",N[N.Overlaps=12]="Overlaps",N[N.Buffer=13]="Buffer",N[N.Distance=14]="Distance",N[N.Intersection=15]="Intersection",N[N.Clip=16]="Clip",N[N.Cut=17]="Cut",N[N.DensifyByLength=18]="DensifyByLength",N[N.DensifyByAngle=19]="DensifyByAngle",N[N.LabelPoint=20]="LabelPoint",N[N.GeodesicBuffer=21]="GeodesicBuffer",N[N.GeodeticDensifyByLength=22]="GeodeticDensifyByLength",N[N.ShapePreservingDensify=23]="ShapePreservingDensify",N[N.GeodeticLength=24]="GeodeticLength",N[N.GeodeticArea=25]="GeodeticArea",N[N.Simplify=26]="Simplify",N[N.SimplifyOGC=27]="SimplifyOGC",N[N.Offset=28]="Offset",N[N.Generalize=29]="Generalize",N[N.SymmetricDifference=30]="SymmetricDifference",N[N.ConvexHull=31]="ConvexHull",N[N.Boundary=32]="Boundary",N[N.SimpleRelation=33]="SimpleRelation";var T=function(){function d(){}return d.prototype.K=function(){return null},d.prototype.xn=function(){},d.prototype.Ju=function(){return!1},d}();f.Ge=T}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 13},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u,m){return h instanceof f.ba?(m=new f.$c(h),this.W(m,o,[c],!1,u).next()):u===!0?(c=new f.tC(h,o,c,!1,m),f.Hh.local().W(c,o,m)):new f.tC(h,o,c,!1,m)},d.instance=null,d}(f.Ge);f.sC=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u){this.za=-1,this.Sd=d,this.Vz=h,this.Ds=o,this.iT=new f.l,this.iT.Pa(),this.fo=-1,this.Vb=u}return T.prototype.next=function(){for(var d;(d=this.Sd.next())!=null;)return this.za=this.Sd.Ma(),this.fo+1<this.Ds.length&&this.fo++,this.buffer(d,this.Ds[this.fo]);return null},T.prototype.Ma=function(){return this.za},T.prototype.buffer=function(d,h){return f.zK.buffer(d,h,this.Vz,NaN,96,this.Vb)},T.prototype.qe=function(){},T}();f.tC=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 16},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u){return h instanceof f.ba?(h=new f.$c(h),this.W(h,o,c,u).next()):new f.dL(h,o,c,u)},d.instance=null,d}(f.Ge);f.cL=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o){if(this.za=-1,d==null)throw f.i.O();this.aa=h,this.yk=d,this.ra=f.ta.Xd(o,h,!1)}return T.prototype.next=function(){var d;return(d=this.yk.next())!=null?(this.za=this.yk.Ma(),f.Vd.clip(d,this.aa,this.ra,0)):null},T.prototype.Ma=function(){return this.za},T.prototype.qe=function(){},T}();f.dL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 31},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c){return h instanceof f.ba?f.vC.jE(h):new f.vC(o,h,c)},d.instance=null,d}(f.Ge);f.uC=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o){if(this.oA=new f.$t,this.za=-1,h==null)throw f.i.O();this.VG=d,this.Jc=!1,this.yk=h,this.Vb=o}return T.prototype.next=function(){if(this.VG){if(!this.Jc){var d=this.WN(this.yk);return this.Jc=!0,d}return null}if(!this.Jc){if((d=this.yk.next())!=null)return this.za=this.yk.Ma(),T.jE(d);this.Jc=!0}return null},T.prototype.Ma=function(){return this.za},T.prototype.WN=function(d){for(var h;(h=d.next())!=null;)this.oA.Ib(h);return this.oA.VQ()},T.prototype.qe=function(){if(!this.Jc){if(!this.VG)throw f.i.ga("Invalid call for non merging convex hull.");var d=this.yk.next();if(d==null)throw f.i.ga("Expects a non-null geometry.");this.oA.Ib(d)}},T.jE=function(d){if(T.LS(d))return d;var h=d.K();if(f.Vk.zd(h))return(h=new f.Ua(d.description)).oc(d,!0),h;if(h==550&&d.I()==2){var o=new f.Ta;return h=new f.Ua(d.description),d.we(0,o),h.nf(o),d.we(1,o),h.lineTo(o),h}return f.$t.JO(d)},T.LS=function(d){if(d.B())return!0;var h=d.K();return h==33||h==197||!f.Vk.zd(h)&&(h==550?d.I()==1:h==1607?d.ea()==1&&2>=d.I():d.ea()==1&&(2>=d.I()||f.$t.BG(d,0)))},T}();f.vC=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 17},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u,m){return new f.fL(h,o,c,u,m)},d.instance=null,d}(f.Ge);f.eL=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u){if(this.Uf=null,h==null||o==null)throw f.i.ga("invalid argument");this.fT=d,this.hA=h,this.dH=o,d=f.ta.nv(h,o),this.ra=f.ta.Xd(c,d,!0),this.cH=-1,this.nd=u}return T.prototype.Ma=function(){return 0},T.prototype.next=function(){return this.JQ(),++this.cH<this.Uf.length?this.Uf[this.cH]:null},T.prototype.JQ=function(){if(this.Uf==null)switch(this.Uf=[],this.hA.K()){case 1607:this.LQ();break;case 1736:this.KQ()}},T.prototype.LQ=function(){var d=new f.Ua,h=new f.Ua,o=new f.Ua;this.Uf.push(d),this.Uf.push(h);var c=[];f.DK.BK(this.fT,this.hA,this.dH,this.ra,c,this.nd);for(var u=0;u<c.length;u++){var m=c[u];if(m.bt==0)d.add(m.Y,!1);else if(m.bt==1||m.bt==2)h.add(m.Y,!1);else if(m.bt==3)this.Uf.push(m.Y);else{if(m.bt!=4)throw f.i.ga("internal");o.add(m.Y,!1)}}o.B()||d.B()&&h.B()&&!(3<=this.Uf.length)||this.Uf.push(o),d.B()&&h.B()&&3>this.Uf.length&&(this.Uf.length=0)},T.prototype.KQ=function(){var d=new f.ja(0),h=new f.hd,o=h.TE(),c=h.Ib(this.hA),u=h.Ib(this.dH),m=new f.Hg;try{m.Ft(h,this.ra,this.nd),m.el(o,c,u,d);var g=h.Ke(c),v=new f.Ea,w=new f.Ea;for(this.Uf.length=0,this.Uf.push(v),this.Uf.push(w),c=0;c<d.size;c++){var E=new f.hd,C=E.Ib(g),R=E.Ib(h.Ke(d.get(c)));m.fr(E,this.nd);var I=m.Bv(C,R),F=E.Ke(I);if(!F.B()){var U=h.CF(d.get(c),o);U==2?v.add(F,!1):U==1?w.add(F,!1):this.Uf.push(F);var j=new f.hd;C=j.Ib(g),R=j.Ib(h.Ke(d.get(c))),m.fr(j,this.nd),g=j.Ke(m.km(C,R))}}!g.B()&&0<d.size&&this.Uf.push(g),v.B()&&w.B()&&(this.Uf.length=0)}finally{m.Vg()}},T.prototype.qe=function(){},T}();f.fL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 18},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c){if(h instanceof f.ba)return h=new f.$c(h),this.W(h,o,c).next();if(0>=o)throw f.i.O();return new f.gL(h,o,c)},d.instance=null,d}(f.Ge);f.Zl=N}(ae||(ae={})),function(f){var N=function(){function T(d,h){this.za=-1,this.Sd=d,this.Qs=h}return T.prototype.Ma=function(){return this.za},T.prototype.next=function(){var d;return(d=this.Sd.next())!=null?(this.za=this.Sd.Ma(),this.FP(d)):null},T.prototype.FP=function(d){if(d.B()||1>d.Eb())return d;var h=d.K();if(h==1736||h==1607)return this.Iy(d);if(f.ba.zd(h))return this.HP(d);if(h==197)return this.GP(d);throw f.i.Ra()},T.prototype.HP=function(d){if(d.Rb()<=this.Qs)return d;var h=new f.Ua(d.description);return h.oc(d,!0),this.Iy(h)},T.prototype.GP=function(d){var h=new f.Ea(d.description);h.bd(d,!1);var o=new f.l;return d.A(o),d=o.da(),o.S()<=this.Qs&&d<=this.Qs?h:this.Iy(h)},T.prototype.Iy=function(d){for(var h=d.Ja(),o=d.Ha();o.ab();)for(var c=!0;o.Ia();){var u=o.ia();if(u.K()!=322)throw f.i.ga("not implemented");var m=o.Pn(),g=u.Rb();if(g>this.Qs){var v=Math.ceil(g/this.Qs);g=new f.Ta(d.description),c&&(u.Uo(g),h.nf(g));var w=c=1/v,E=0;for(--v;E<v;E++)u.Uw(w,g),h.lineTo(g),w+=c;m?h.Cp():(u.Qo(g),h.lineTo(g))}else m?h.Cp():h.oc(u,c);c=!1}return h},T.prototype.qe=function(){},T}();f.gL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.K=function(){return 2},d.prototype.W=function(h,o,c,u){return h instanceof f.ba?(h=new f.$c(h),o=new f.$c(o),this.W(h,o,c,u).next()):new f.hL(h,o,c,u)},d.km=function(h,o,c,u){if(h.B()||o.B())return h;var m=h.Eb(),g=o.Eb();if(m>g)return h;var v=h.K(),w=o.K(),E=new f.l,C=new f.l,R=new f.l;h.A(E),o.A(C),R.L(E),R.$b(C);var I=(R=f.ta.Xd(c,R,!0))*Math.sqrt(2)*1.00001,F=new f.l;if(F.L(E),F.X(I,I),!F.isIntersecting(C))return h;if(m==1&&g==2)return d.AV(h,o,w,c,u);if(v==33)switch(f.Vk.zd(w)?(c=new f.Ua(o.description),c.oc(o,!0)):c=o,w){case 1736:return d.NU(h,c,R);case 1607:return d.OU(h,c,R);case 550:return d.LU(h,c,R);case 197:return d.KU(h,c,R);case 33:return d.MU(h,c,R);default:throw f.i.O()}else if(v==550)switch(w){case 1736:return d.dU(h,o,R);case 197:return d.bU(h,o,R);case 33:return d.cU(h,o,R)}return f.Hg.km(h,o,c,u)},d.NU=function(h,o,c){return f.jd.CG(o,h,c)==0?h:h.Ja()},d.OU=function(h,o,c){var u=h.D();o=o.Ha();for(var m=c*Math.sqrt(2)*1.00001,g=m*m,v=new f.l;o.ab();)for(;o.Ia();){var w=o.ia();if(w.A(v),v.X(m,m),v.contains(u)){if(w.rs(u,c))return h.Ja();var E=w.ac();if(f.h.zc(u,E)<=g||(E=w.xc(),f.h.zc(u,E)<=g))return h.Ja()}}return h},d.LU=function(h,o,c){var u=o.vb(0);o=o.I();var m=h.D(),g=new f.h;c=c*Math.sqrt(2)*1.00001,c*=c;for(var v=0;v<o;v++)if(u.uc(2*v,g),f.h.zc(g,m)<=c)return h.Ja();return h},d.KU=function(h,o,c){var u=new f.l;return o.A(u),u.X(c,c),o=h.D(),u.contains(o)?h.Ja():h},d.MU=function(h,o,c){c=c*Math.sqrt(2)*1.00001,c*=c;var u=h.D();return o=o.D(),f.h.zc(u,o)<=c?h.Ja():h},d.dU=function(h,o,c){var u=new f.l;o.A(u),u.X(c,c);for(var m=h.I(),g=!1,v=[],w=0;w<m;w++)v[w]=!1;var E=new f.h;for(w=0;w<m;w++)h.D(w,E),u.contains(E)&&f.jd.Zd(o,E,c)!=0&&(g=!0,v[w]=!0);if(!g)return h;for(o=h.Ja(),w=0;w<m;w++)v[w]||o.Gd(h,w,w+1);return o},d.bU=function(h,o,c){var u=new f.l;o.A(u),u.X(c,c),o=h.I();var m=!1;c=[];for(var g=0;g<o;g++)c[g]=!1;var v=new f.h;for(g=0;g<o;g++)h.D(g,v),u.contains(v)&&(m=!0,c[g]=!0);if(!m)return h;for(u=h.Ja(),g=0;g<o;g++)c[g]||u.Gd(h,g,g+1);return u},d.cU=function(h,o,c){var u=h.vb(0),m=h.I(),g=o.D(),v=new f.h,w=!1;o=[];for(var E=0;E<m;E++)o[E]=!1;for(c=(E=c*Math.sqrt(2)*1.00001)*E,E=0;E<m;E++)u.uc(2*E,v),f.h.zc(v,g)<=c&&(w=!0,o[E]=!0);if(!w)return h;for(u=h.Ja(),E=0;E<m;E++)o[E]||u.Gd(h,E,E+1);return u},d.AV=function(h,o,c,u,m){var g=new f.Gh;h.dn(g);var v=new f.l;return o.A(v),g.$b(v),g.X(.1*g.S(),.1*g.da()),(v=new f.Ea).bd(g,!1),c==1736?v.add(o,!0):v.bd(o,!0),f.Wk.local().W(h,v,u,m)},d.instance=null,d}(f.Ge);f.lp=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c){this.us=h==null,this.za=-1,this.Sd=d,this.Vz=o,this.lT=h.next(),this.Vb=c}return T.prototype.next=function(){return this.us?null:(d=this.Sd.next())!=null?(this.za=this.Sd.Ma(),f.lp.km(d,this.lT,this.Vz,this.Vb)):null;var d},T.prototype.Ma=function(){return this.za},T.prototype.qe=function(){},T}();f.hL=N}(ae||(ae={})),function(f){var N=function(){function d(h){this.nd=h,this.Cj=new f.l,this.Cj.Pa(),this.ph=new f.l,this.ph.Pa()}return d.prototype.Ot=function(){var h=this.Cj.v;this.Cj.v=this.ph.v,this.ph.v=h,h=this.Cj.C,this.Cj.C=this.ph.C,this.ph.C=h,h=this.Cj.G,this.Cj.G=this.ph.G,this.ph.G=h,h=this.Cj.H,this.Cj.H=this.ph.H,this.ph.H=h},d.prototype.XP=function(h,o){if(this.nd!=null&&!this.nd.progress(-1,-1))throw f.i.gu("user_canceled");var c=!this.Cj.isIntersecting(this.ph);return f.ba.Ic(h.K())&&f.ba.Ic(o.K())?h.I()>o.I()?this.ZD(h,o,c):(this.Ot(),h=this.ZD(o,h,c),this.Ot(),h):h.K()==550&&f.ba.Ic(o.K())?(h=this.$D(o,h,c),this.Ot(),h):o.K()==550&&f.ba.Ic(h.K())?this.$D(h,o,c):h.K()==550&&o.K()==550?h.I()>o.I()?this.aE(h,o):(this.Ot(),h=this.aE(o,h),this.Ot(),h):0},d.prototype.ZD=function(h,o,c){var u=h.Ha(),m=o.Ha(),g=new f.l,v=new f.l,w=17976931348623157e292;if(!c&&this.dY(h,o,u,m))return 0;for(;u.ab();)for(;u.Ia();)if((h=u.ia()).A(g),!(g.ox(this.ph)>w)){for(;m.ab();)for(;m.Ia();)if((o=m.ia()).A(v),g.ox(v)<w&&(o=h.ub(o,c),(o*=o)<w)){if(o==0)return 0;w=o}m.$i()}return Math.sqrt(w)},d.prototype.$D=function(h,o,c){var u=h.Ha(),m=new f.l,g=17976931348623157e292,v=new f.h,w=o.I();for(c=!c&&h.K()==1736;u.ab();)for(;u.Ia();){var E=u.ia();if(E.A(m),!(1<w&&m.ox(this.ph)>g)){for(var C=0;C<w;C++){if(o.D(C,v),c&&f.jd.Zd(h,v,0)!=0)return 0;var R=E.fe(v,!1);if(v.sub(E.ic(R)),(R=v.Sk())<g){if(R==0)return 0;g=R}}c=!1}}return Math.sqrt(g)},d.prototype.aE=function(h,o){for(var c,u=17976931348623157e292,m=new f.h,g=new f.h,v=h.I(),w=o.I(),E=0;E<v;E++)if(h.D(E,m),!(1<w&&this.ph.aK(m)>u)){for(var C=0;C<w;C++)if(o.D(C,g),(c=f.h.zc(m,g))<u){if(c==0)return 0;u=c}}return Math.sqrt(u)},d.prototype.dY=function(h,o,c,u){if(h.K()==1736){for(;u.ab();)if(u.Ia()){var m=u.ia();if(f.jd.Zd(h,m.xc(),0)!=0)return!0}u.$i()}if(o.K()==1736){for(;c.ab();)if(c.Ia()&&(h=c.ia(),f.jd.Zd(o,h.xc(),0)!=0))return!0;c.$i()}return!1},d.prototype.im=function(h,o){return h.B()||o.B()?NaN:(h.A(this.Cj),o.A(this.ph),this.XP(h,o))},d}(),T=function(d){function h(){return d!==null&&d.apply(this,arguments)||this}return Hi(h,d),h.prototype.W=function(o,c,u){if(o==null||c==null)throw f.i.O();if(o.B()||c.B())return NaN;var m=o.K(),g=c.K();if(m==33){if(g==33)return f.h.ub(o.D(),c.D());if(g==197)return u=new f.l,c.A(u),u.ub(o.D());(m=new f.de).add(o),o=m}else if(m==197){if(g==197)return g=new f.l,o.A(g),u=new f.l,c.A(u),u.ub(g);(m=new f.Ea).bd(o,!1),o=m}return g==33?((g=new f.de).add(c),c=g):g==197&&((g=new f.Ea).bd(c,!1),c=g),new N(u).im(o,c)},h.local=function(){return h.instance===null&&(h.instance=new h),h.instance},h.prototype.K=function(){return 14},h.instance=null,h}(f.Ge);f.iL=T}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c){this.rH=d,this.vH=h,this.nd=c,this.SG=o}return T.prototype.next=function(){var d=this.rH.next();return d==null?null:this.rC(d)},T.prototype.Ma=function(){return this.rH.Ma()},T.prototype.rC=function(d){var h=d.K();if(f.ba.Sn(h))return d;if(h==197)return(h=new f.Ea(d.description)).bd(d,!1),this.rC(h);if(d.B())return d;if(d==null)throw f.i.Ra();h=d.Ja();for(var o=new f.zb,c=0,u=d.ea();c<u;c++)this.LK(d,c,h,o);return h},T.prototype.LK=function(d,h,o,c){if(!(2>d.Ka(h))){var u=d.Ca(h),m=d.Wc(h)-1,g=d.vb(0),v=d.ec(h),w=new f.ja(0);w.Jb(d.Ka(h)+1);var E=new f.ja(0);for(E.Jb(d.Ka(h)+1),w.add(v?u:m),w.add(u),u=new f.h;1<w.size;){var C=w.Gc();w.Jf();var R=w.Gc();d.D(C,u),c.Ec(u),d.D(R,u),c.Rc(u),0<=(R=this.KK(c,u,g,C,R,m))?(w.add(R),w.add(C)):E.add(C)}if(v||E.add(w.get(0)),E.size==w.size)o.addPath(d,h,!0);else if(2<=E.size&&(!this.SG||E.size!=2||!(v||f.h.ub(d.Oa(E.get(0)),d.Oa(E.get(1)))<=this.vH))){for(h=new f.Ta,c=0,m=E.size;c<m;c++)d.we(E.get(c),h),c==0?o.nf(h):o.lineTo(h);v&&(this.SG||E.size!=2||o.lineTo(h),o.Cp())}}},T.prototype.KK=function(d,h,o,c,u,m){var g=u-1;for(u<=c&&(g=m),m=u=-1,c+=1;c<=g;c++){o.uc(2*c,h);var v=h.x,w=h.y;d.ic(d.fe(h,!1),h),h.x-=v,h.y-=w,(v=h.length())>this.vH&&v>m&&(u=c,m=v)}return u},T.prototype.qe=function(){},T}();f.jL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 29},d.prototype.W=function(h,o,c,u){return h instanceof f.ba?(h=new f.$c(h),this.W(h,o,c,u).next()):new f.jL(h,o,c,u)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Ge);f.wC=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 21},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u,m,g,v,w){return h instanceof f.ba?(w=new f.$c(h),this.W(w,o,c,[u],m,g,!1,v).next()):v===!0?(c=new f.yC(h,o,c,u,m,!1,!1,w),f.Hh.local().W(c,o,w)):new f.yC(h,o,c,u,m,!1,!1,w)},d.instance=null,d}(f.Ge);f.xC=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u,m,g,v){if(m)throw f.i.Fe();if(h==null)throw f.i.O();this.za=-1,this.Ns=d,this.vg=h,this.Ae=o,this.Ds=c,this.ao=u,this.fo=-1,this.Vb=v,this.jT=new f.l,this.jT.Pa()}return T.prototype.next=function(){for(var d;(d=this.Ns.next())!=null;)return this.za=this.Ns.Ma(),this.fo+1<this.Ds.length&&this.fo++,this.SQ(d,this.Ds[this.fo]);return null},T.prototype.Ma=function(){return this.za},T.prototype.SQ=function(d,h){return f.NK.buffer(d,this.vg,this.Ae,h,this.ao,this.Vb)},T.prototype.qe=function(){},T}();f.yC=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 24},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c){if(o==null)throw f.i.O();if(h.B()||1>h.Eb())return 0;if(c==4)throw f.i.Fe();var u=f.cb.tc(o),m=f.cb.wv(u),g=f.cb.fv(u);m*=2-m;var v=u.Id().bi,w=h.K();if(w==1736||w==197)var E=h.mg();else f.ba.zd(w)?(E=new f.Ua(h.description)).oc(h,!0):E=h;if(u.Nb(o)==0){if(f.cb.Xc(o)){E=f.Ih.mj(E,o),w==1607&&E==h&&(E=f.ba.ig(h)),h=new f.Oc,f.cb.hh(o).en(h),w=0;for(var C=E.I();w<C;w++){var R=E.Oa(w);R.x=f.Ih.an(R.x,h),E.Db(w,R)}}h=E.Ja(),E=f.Ih.NI(o,u,E,h)?h:f.cb.Ah(E,o,u)}return this.$P(E,c,g,m,v)},d.prototype.$P=function(h,o,c,u,m){var g=new f.ha(0),v=0;for(h=h.Ha();h.ab();)for(;h.Ia();){var w=h.ia(),E=w.ac();w=w.xc(),E.scale(m),w.scale(m),f.kb.xd(c,u,E.x,E.y,w.x,w.y,g,null,null,o),v+=g.u}return v},d.instance=null,d}(f.Ge);f.mL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 18},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u,m){return h instanceof f.ba?(h=new f.$c(h),this.W(h,o,c,u,m).next()):new f.lL(h,c,u,o,-1,-1,m)},d.instance=null,d}(f.Ge);f.kL=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u,m){if(0<m||o!=4&&0<u)throw f.i.Fe();if(h==null)throw f.i.O();this.za=-1,this.Ns=d,this.vg=h,this.Ae=o,this.tT=c,this.sT=u}return T.prototype.next=function(){for(var d;(d=this.Ns.next())!=null;)return this.za=this.Ns.Ma(),this.Uy(d);return null},T.prototype.Ma=function(){return this.za},T.prototype.Uy=function(d){return f.dj.Rr(d,this.vg,this.Ae,this.tT,this.sT,this.Vb)},T.prototype.qe=function(){},T}();f.lL=N}(ae||(ae={})),function(f){(function(N){N[N.Unknown=0]="Unknown",N[N.Contains=1]="Contains",N[N.Within=2]="Within",N[N.Equals=3]="Equals",N[N.Disjoint=4]="Disjoint",N[N.Touches=8]="Touches",N[N.Crosses=16]="Crosses",N[N.Overlaps=32]="Overlaps",N[N.NoThisRelation=64]="NoThisRelation",N[N.Intersects=1073741824]="Intersects",N[N.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint"})(f.VK||(f.VK={})),f.nL=function(){function N(){}return N.dW=function(T,d){var h=T.K(),o=d.K();if(f.ba.yj(h)){var c=T.Cb;if(c!=null&&(c=c.Fk)!=null){if(o==33){var u=d.D();c=c.To(u.x,u.y)}else u=new f.l,d.A(u),c=c.So(u);if(c==1)return 1;if(c==0)return 4}}if(f.ba.yj(o)&&(c=d.Cb)!=null&&(c=c.Fk)!=null){if(h==33?(T=T.D(),c=c.To(T.x,T.y)):(d=new f.l,T.A(d),c=c.So(d)),c==1)return 2;if(c==0)return 4}return 0},N}()}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.K=function(){return 15},d.prototype.W=function(h,o,c,u,m){return h instanceof f.ba?(h=new f.$c(h),o=new f.$c(o),this.W(h,o,c,u,m).next()):m===void 0?new f.zC(h,o,c,u,-1):new f.zC(h,o,c,u,m)},d.prototype.xn=function(h,o,c){this.Ju(h)&&(o=f.ta.lj(o,h,!1),h.gj(c)||h.mu(o,c))},d.prototype.Ju=function(h){return f.Lx.rE(h)},d.instance=null,d}(f.Ge);f.Wk=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u){if(this.us=h==null,this.za=-1,this.Sd=d,this.vg=o,this.Pe=h.next(),this.Ej=this.Pe.K(),this.Vb=c,this.Gi=u,this.Gi!=-1&&(0>=this.Gi||7<this.Gi))throw f.i.O("bad dimension mask")}return T.prototype.next=function(){if(this.us)return null;if(this.Aw!=null){var d=this.Aw.next();if(d!=null)return d;this.Aw=null}for(;(d=this.Sd.next())!=null;)return this.za=this.Sd.Ma(),this.Gi==-1?d=this.Fa(d):(this.Aw=this.GS(d),d=this.Aw.next()),d;return null},T.prototype.Ma=function(){return this.za},T.prototype.Fa=function(d){var h=this.rK(d);if(h!=null)return h;h=f.ta.nv(this.Pe,d);var o=f.ta.Xd(this.vg,h,!0);h=new f.l,this.Pe.A(h);var c=new f.l;return d.A(c),h.X(2*o,2*o),h.Fa(c),h.X(100*o,100*o),o=f.Vd.clip(this.Pe,h,0,0),d=f.Vd.clip(d,h,0,0),f.Hg.Bv(d,o,this.vg,this.Vb)},T.prototype.HI=function(d,h,o){var c=0;if((1&h)!=0)o[0]==null&&(o[0]=new f.de(d)),c++;else for(var u=0;u<o.length-1;u++)o[u]=o[u+1];if((2&h)!=0)o[c]==null&&(o[c]=new f.Ua(d)),c++;else for(u=c;u<o.length-1;u++)o[u]=o[u+1];if((4&h)!=0)o[c]==null&&(o[c]=new f.Ea(d)),c++;else for(u=c;u<o.length-1;u++)o[u]=o[u+1];if(c!=3){for(d=[],u=0;u<c;u++)d[u]=o[u];return new f.$c(d)}return new f.$c(o)},T.prototype.GS=function(d){var h=this.rK(d);if(h!=null){var o=[null,null,null];return o[h.Eb()]=h,this.HI(d.description,this.Gi,o)}h=f.ta.nv(this.Pe,d),o=f.ta.Xd(this.vg,h,!0),h=new f.l,this.Pe.A(h),h.X(2*o,2*o);var c=new f.l;return d.A(c),h.Fa(c),h.X(100*o,100*o),o=f.Vd.clip(this.Pe,h,0,0),h=f.Vd.clip(d,h,0,0),o=f.Hg.Kz(h,o,this.vg,this.Vb),this.HI(d.description,this.Gi,o)},T.prototype.rK=function(d){var h=f.ta.nv(d,this.Pe),o=f.ta.Xd(this.vg,h,!0);h=d.K();var c=d.B(),u=this.Pe.B();if(!(u=c||u)){u=new f.l,d.A(u);var m=new f.l;this.Pe.A(m),m.X(2*o,2*o),u=!u.isIntersecting(m)}if(!u)if((m=f.nL.dW(this.Pe,d))==4)u=!0;else{if((2&m)!=0)return this.Pe;if((1&m)!=0)return d}if(u)return(o=f.ba.uf(h))<(u=f.ba.uf(this.Ej))?T.BB(d,c):o>u||o==0&&h==550&&this.Ej==33?this.fJ():T.BB(d,c);if((this.Gi==-1||this.Gi==4)&&h==197&&this.Ej==197)return o=this.Pe,h=new f.l,d.A(h),c=new f.l,o.A(c),h.Fa(c),o=new f.Gh,d.copyTo(o),o.Yo(h),o;if(h==197&&f.ba.uf(this.Ej)==0||this.Ej==197&&f.ba.uf(h)==0)return c=h==197?d:this.Pe,d=h==197?this.Pe:d,h=new f.l,c.A(h),f.Vd.clip(d,h,o,0);if(f.ba.uf(h)==0&&0<f.ba.uf(this.Ej)||0<f.ba.uf(h)&&f.ba.uf(this.Ej)==0){if(o=f.ta.lj(this.vg,d,!1),h==550||h==33)return f.Hg.rG(d,this.Pe,o);if(this.Ej==550||this.Ej==33)return f.Hg.rG(this.Pe,d,o);throw f.i.Ra()}return this.Gi!=-1&&this.Gi!=2||h!=1607||this.Ej!=1736?this.Gi!=-1&&this.Gi!=2||h!=1736||this.Ej!=1607?null:this.oK(this.Pe,d):this.oK(d,this.Pe)},T.prototype.oK=function(d,h){var o=d,c=h,u=f.ta.lj(this.vg,h,!1),m=new f.l;c.A(m);var g=new f.l;o.A(g),g.X(2*u,2*u),m.Fa(g),m.X(10*u,10*u),o=d=f.Vd.clip(d,m,0,0),g=new f.ja(0);var v=-1,w=c.Cb;if(w!=null){var E=w.Fk;if(E!=null){v=0,g.Jb(o.I()+o.ea());for(var C=new f.l,R=o.Ha();R.ab();)for(;R.Ia();){R.ia().A(C);var I=E.So(C);I==1?g.add(1):I==0?g.add(0):(g.add(-1),v++)}}}if(5<h.I()&&(w=(c=h=f.Vd.clip(h,m,0,0)).Cb),0>v&&(v=o.sz()),m=o.I()+c.I(),v*c.I()>Math.log(m)*m*4)return null;m=null,v=c.Ha(),w!=null&&w.Gb!=null&&(m=w.Gb),m==null&&20<c.I()&&(m=f.ta.fE(c)),d=d.Ja(),c=null,w=o.Ha(),E=[0,0,0,0,0,0,0,0,0],C=new f.ce(0),R=new f.hg,I=-1;for(var F=0,U=0,j=0<g.size,ee=-1;w.ab();){ee=w.gb;var te=0;for(I=-1,F=0;w.Ia();){var Z=j?f.P.truncate(g.get(U)):-1;U++;var le=w.ia();if(0>Z){if(m!=null)for(c==null?c=m.mR(le,u):c.Vo(le,u),Z=c.next();Z!=-1;Z=c.next()){v.Wb(m.ka(Z)),Z=v.ia();var ve=le.Fa(Z,null,E,null,u);for(Z=0;Z<ve;Z++)C.add(E[Z])}else for(v.$i();v.ab();)for(;v.Ia();)for(Z=v.ia(),ve=le.Fa(Z,null,E,null,u),Z=0;Z<ve;Z++)C.add(E[Z]);if(0<C.size){C.Wd(0,C.size,function(it,Ke){return it-Ke});var be=0;C.add(1),ve=-1,Z=0;for(var ue=C.size;Z<ue;Z++){var Le=C.get(Z);if(Le!=be){var Be=!1;if(be!=0||Le!=1?(le.bh(be,Le,R),be=R.get()):(be=le,Be=!0),2<=te){if(d.Fr(o,ee,I,F,te==3),this.HD(h,be.ac(),u)!=1&&this.JD(h,be,u)!=1)return null;d.oc(be,!1),te=1,F=0}else switch(ve=this.JD(h,be,u),ve){case 1:Be?2>te?(I=w.xb()-o.Ca(ee),F=1,te=te==0?3:2):F++:(d.oc(be,te==0),te=1);break;case 0:te=0,I=-1,F=0;break;default:return null}be=Le}}}else{if(0>(Z=this.HD(h,le.ac(),u)))return null;Z==1?(2>te&&(I=w.xb()-o.Ca(ee),te=te==0?3:2),F++):(I=-1,F=0)}C.clear(!1)}else Z!=0&&Z==1&&(te==0?(te=3,I=w.xb()-o.Ca(ee)):te==1?(te=2,I=w.xb()-o.Ca(ee)):F++)}2<=te&&(d.Fr(o,ee,I,F,te==3),I=-1)}return d},T.prototype.HD=function(d,h,o){return f.Fg.ym(d,h,o)},T.prototype.JD=function(d,h,o){var c=h.ac();h=h.xc();var u=f.Fg.ym(d,c,o),m=f.Fg.ym(d,h,o);return u==1&&m==0||u==0&&m==1?-1:u==0||m==0?0:u==1||m==1?1:((u=new f.h).add(c,h),u.scale(.5),(d=f.Fg.ym(d,u,o))==0?0:d==1?1:-1)},T.BB=function(d,h){return h?d:d.Ja()},T.prototype.fJ=function(){return this.qH==null&&(this.qH=this.Pe.Ja()),this.qH},T.prototype.qe=function(){},T}();f.zC=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 28},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u,m,g,v){return h instanceof f.ba?(h=new f.$c(h),this.W(h,o,c,u,m,g,v).next()):new f.oL(h,o,c,u,m,g,v)},d.instance=null,d}(f.Ge);f.AC=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c,u,m,g){this.za=-1,this.Sd=d,this.Nj=h,this.La=o,this.Li=c,this.wA=u,this.mH=m,this.nd=g}return T.prototype.next=function(){var d=this.Sd.next();return d!=null?(this.za=this.Sd.Ma(),this.bL(d)):null},T.prototype.Ma=function(){return this.za},T.prototype.bL=function(d){var h=0>=this.mH?f.ta.lj(this.Nj,d,!1):this.mH;return f.AK.W(d,this.La,this.Li,this.wA,h,this.nd)},T.prototype.qe=function(){},T}();f.oL=N}(ae||(ae={})),function(f){var N;(N=f.FK||(f.FK={}))[N.clipToDomainOnly=1]="clipToDomainOnly",N[N.clipWithHorizon=2]="clipWithHorizon",N[N.foldAndClipWithHorizon=3]="foldAndClipWithHorizon";var T=function(d){function h(){return d!==null&&d.apply(this,arguments)||this}return Hi(h,d),h.prototype.K=function(){return 0},h.local=function(){return h.instance===null&&(h.instance=new h),h.instance},h.prototype.W=function(o,c,u){return o instanceof f.ba?(o=new f.$c(o),this.W(o,c,u).next()):new f.qL(o,c,u)},h.prototype.transform=function(o,c,u,m){return f.cu.transform(o,c,u,m,!0)},h.prototype.Rt=function(o,c,u,m){return f.cu.Rt(o,c,u,m)},h.instance=null,h}(f.Ge);f.Fx=T}(ae||(ae={})),function(f){var N=function(){function T(d,h,o){this.za=-1,this.Sd=d,this.CT=h,this.nd=o}return T.prototype.next=function(){var d=this.Sd.next();return d!=null?(this.za=this.Sd.Ma(),f.cu.Ah(d,this.CT,this.nd)):null},T.prototype.Ma=function(){return this.za},T.prototype.qe=function(){},T}();f.qL=N}(ae||(ae={})),function(f){var N=function(){function d(){}return d.prototype.reset=function(){this.qh=this.xk=-1,this.vs=this.mq=!1},d.prototype.sQ=function(h,o,c){for(h.Wb(o,c);h.Ia();){var u=h.ia();if((u=u.Rb())!=0)return h.xb()}for(h.Wb(o,c);h.zz();)if((u=(u=h.mi()).Rb())!=0)return h.xb();return-1},d.prototype.tQ=function(h,o){for(h.Wb(o,-1);h.zz();)if(h.mi().Rb()!=0)return h.xb();return-1},d.prototype.rQ=function(h,o){for(h.Wb(o,-1),h.ia();h.Ia();)if(h.ia().Rb()!=0)return h.xb();return-1},d.prototype.qQ=function(h,o,c,u){if(this.xk=this.sQ(o,c,u),this.xk!=-1){o.Wb(this.xk,-1);var m=o.ia(),g=m.ic(m.fe(h,!1));if(c=f.h.zc(g,h),(u=new f.h).N(g),u.sub(m.ac()),(g=new f.h).N(h),g.sub(m.ac()),this.mq=0>u.xi(g),this.qh=this.rQ(o,this.xk),this.qh!=-1){o.Wb(this.qh,-1);var v=(m=o.ia()).fe(h,!1);v=m.ic(v);var w=f.h.zc(v,h);w>c?this.qh=-1:(u.N(v),u.sub(m.ac()),g.N(h),g.sub(m.ac()),this.vs=0>u.xi(g))}this.qh==-1&&(this.qh=this.tQ(o,this.xk),this.qh!=-1&&(o.Wb(this.qh,-1),v=(m=o.ia()).fe(h,!1),v=m.ic(v),(w=f.h.zc(v,h))>c?this.qh=-1:(u.N(v),u.sub(m.ac()),g.N(h),g.sub(m.ac()),this.vs=0>u.xi(g),h=this.xk,this.xk=this.qh,this.qh=h,h=this.mq,this.mq=this.vs,this.vs=h)))}},d.prototype.VN=function(h,o,c,u,m){return c=c.Ha(),this.qQ(h,c,u,m),this.xk!=-1&&this.qh==-1?this.mq:this.xk!=-1&&this.qh!=-1?this.mq==this.vs?this.mq:(c.Wb(this.xk,-1),h=c.ia().jg(),c.Wb(this.qh,-1),o=c.ia().jg(),0<=h.xi(o)):o},d}(),T=function(d){function h(){return d!==null&&d.apply(this,arguments)||this}return Hi(h,d),h.local=function(){return h.instance===null&&(h.instance=new h),h.instance},h.prototype.K=function(){return 3},h.prototype.iz=function(o,c,u){var m;if(m===void 0&&(m=!1),o.B())return new f.bm;c=c.D();var g=o,v=o.K();switch(v==197&&((g=new f.Ea).bd(o,!1),v=1736),v){case 33:return this.pI(g,c);case 550:return this.bI(g,c);case 1607:case 1736:return this.ST(g,c,u,m);default:throw f.i.ga("not implemented")}},h.prototype.jz=function(o,c){if(o.B())return new f.bm;c=c.D();var u=o,m=o.K();switch(m==197&&((u=new f.Ea).bd(o,!1),m=1736),m){case 33:return this.pI(u,c);case 550:case 1607:case 1736:return this.bI(u,c);default:throw f.i.ga("not implemented")}},h.prototype.kz=function(o,c,u,m){if(0>m)throw f.i.O();if(o.B())return[];c=c.D();var g=o,v=o.K();switch(v==197&&((g=new f.Ea).bd(o,!1),v=1736),v){case 33:return this.JU(g,c,u,m);case 550:case 1607:case 1736:return this.jU(g,c,u,m);default:throw f.i.ga("not implemented")}},h.prototype.ST=function(o,c,u,m){if(o.K()==1736&&u&&(u=new f.l,o.A(u),u=f.ta.Xd(null,u,!1),(m?f.jd.Zd(o,c,0):f.jd.Zd(o,c,u))!=0)){var g=new f.bm(c,0,0);return m&&g.OJ(!0),g}var v=o.Ha();g=new f.h;for(var w=u=-1,E=17976931348623157e292,C=0;v.ab();)for(;v.Ia();){var R=v.ia();R=R.ic(R.fe(c,!1));var I=f.h.zc(R,c);I<E?(C=1,g=R,u=v.xb(),w=v.gb,E=I):I==E&&C++}return g=new f.bm(g,u,Math.sqrt(E)),m&&(v.Wb(u,w),R=v.ia(),m=0>f.h.Wq(c,R.ac(),R.xc()),1<C&&((C=new N).reset(),m=C.VN(c,m,o,u,w)),g.OJ(m)),g},h.prototype.pI=function(o,c){return o=o.D(),c=f.h.ub(o,c),new f.bm(o,0,c)},h.prototype.bI=function(o,c){for(var u=o.vb(0),m=o.I(),g=o=0,v=0,w=17976931348623157e292,E=0;E<m;E++){var C=new f.h;u.uc(2*E,C);var R=f.h.zc(C,c);R<w&&(g=C.x,v=C.y,o=E,w=R)}return(c=new f.bm).ay(g,v,o,Math.sqrt(w)),c},h.prototype.JU=function(o,c,u,m){return m==0?[]:(u*=u,o=o.D(),(c=f.h.zc(o,c))<=u?(u=[],(m=new f.bm).ay(o.x,o.y,0,Math.sqrt(c)),u[0]=m):u=[],u)},h.prototype.jU=function(o,c,u,m){if(m==0)return[];var g=o.vb(0),v=o.I();o=[],u*=u;for(var w=0;w<v;w++){var E=g.read(2*w),C=g.read(2*w+1),R=c.x-E,I=c.y-C;(R=R*R+I*I)<=u&&((I=new f.bm).ay(E,C,w,Math.sqrt(R)),o.push(I))}return c=o.length,o.sort(function(F,U){return F.La<U.La?-1:F.La==U.La?0:1}),m>=c||(o.length=m),o.slice(0)},h.instance=null,h}(f.Ge);f.Gx=T}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 4},d.prototype.W=function(h,o,c,u,m){return f.cm.sB(h,o,c,u,m)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.Ju=function(h){return f.Wt.qy(h)},d.prototype.xn=function(h,o,c){f.Wt.uD(h,o,c)},d.instance=null,d}(f.Ge);f.rL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 33},d.prototype.W=function(h,o,c,u,m){return h===1073741824?!f.vd.tB(o,c,u,4,m):f.vd.tB(o,c,u,h,m)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.Ju=function(h){return f.Wt.qy(h)},d.prototype.xn=function(h,o,c){f.Wt.uD(h,o,c)},d.instance=null,d}(f.Ge);f.ej=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c){if(this.nd=c,this.gT=o,this.za=-1,d==null)throw f.i.O();this.yk=d,this.Nj=h}return T.prototype.next=function(){var d;if((d=this.yk.next())!=null){if(this.za=this.yk.Ma(),this.nd!=null&&!this.nd.progress(-1,-1))throw f.i.gu("user_canceled");return this.YB(d)}return null},T.prototype.Ma=function(){return this.za},T.prototype.YB=function(d){if(d==null)throw f.i.O();return f.Hx.VJ(d,this.Nj,this.gT,this.nd)},T.prototype.qe=function(){},T}();f.sL=N}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 26},d.prototype.W=function(h,o,c,u){return h instanceof f.ba?(h=new f.$c(h),this.W(h,o,c,u).next()):new f.sL(h,o,c,u)},d.prototype.ss=function(h,o,c,u,m){return 0<(u!==void 0?f.Hx.ss(h,o,c,u,m):f.Hx.ss(h,o,!1,null,c))},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Ge);f.$l=N}(ae||(ae={})),function(f){var N=function(){function m(){this.Aq=0}return m.prototype.aX=function(g){this.Aq&=-2,this.Aq|=g?1:0},m.prototype.Yp=function(){return(1&this.Aq)!=0},m.prototype.PF=function(){return this.Yp()?0:1},m}();f.lY=N;var T=function(){},d=function(m,g,v,w){this.x=m,this.y=g,this.Bi=v,this.zm=w},h=function(){function m(g){this.Ce=g}return m.prototype.compare=function(g,v,w){return g=g.ka(w),v=this.Ce.lf.read(2*v),0>(v-=g=this.Ce.lf.read(2*g))?-1:0<v?1:0},m}(),o=function(){function m(g){this.Ce=g}return m.prototype.compare=function(g,v,w){v=this.Ce.hb[v],g=this.Ce.hb[g.ka(w)];var E=v.Yp(),C=g.Yp();w=v.ne.Me(this.Ce.No,0);var R=g.ne.Me(this.Ce.No,0);return w==R&&((E=.5*((w=Math.min(E?v.ne.oa:v.ne.ma,C?g.ne.oa:g.ne.ma))-this.Ce.No)+this.Ce.No)==this.Ce.No&&(E=w),w=v.ne.Me(E,0),R=g.ne.Me(E,0)),w<R?-1:w>R?1:0},m}(),c=function(){function m(g,v){this.QI=new f.h,this.parent=g,this.VR=v}return m.prototype.qr=function(g,v,w){var E=this.parent,C=this.VR;w.Wd(g,v,function(R,I){return E.Nh(R,I,C)})},m.prototype.bq=function(g){return g=this.parent.hi.get(g),this.parent.lf.uc(2*(g>>1),this.QI),this.QI.y+((1&g)!=0?this.parent.Pj:-this.parent.Pj)},m}(),u=function(){function m(g,v,w,E,C){this.fH=g.description,this.Y=g,this.Rg=v,this.Pj=f.ta.lj(this.Rg,g,!1),this.Co=f.ta.lj(this.Rg,g,!0),this.rA=w,this.eT=this.fH.Ba,this.hb=[],this.qo=[],this.nh=new f.kp,this.fb=new f.Yj,this.ke=new f.Nd,this.QG=this.sl=C}return m.prototype.VS=function(){return this.QG=!0,(!f.ba.Ic(this.Y.K())||this.yE()&&this.vE(!1))&&this.eO()?f.ba.Ic(this.Y.K())?this.hO()?this.Y.K()==1607?this.jO()?2:0:this.kO()?this.lO():0:0:2:0},m.prototype.dC=function(g,v){var w=this.lf.read(2*g);g=this.lf.read(2*g+1);var E=this.lf.read(2*v);v=this.lf.read(2*v+1);var C=!f.Zt.Dv(w,g,E,v,this.Pj*this.Pj);return C||this.Y.Eb()!=0&&w==E&&g==v},m.prototype.yE=function(){for(var g=this.Y,v=g.yf?3:2,w=0,E=g.ea();w<E;w++)if(g.Ka(w)<v)return this.ke=new f.Nd(1,w,0),!1;return!0},m.prototype.vE=function(g){var v=this.Y,w=v.Ha(),E=v.hasAttribute(1);for(v=E?f.ta.oE(this.Rg,v,!1):0;w.ab();)for(;w.Ia();){var C=w.ia();if(!(C.Rb()>this.Pj)){if(g&&E){var R=C.xv(1,0);if(C=C.xv(1,0),Math.abs(C-R)>v)continue}return this.ke=new f.Nd(2,w.xb(),-1),!1}}return!0},m.prototype.eO=function(){var g=this.Y,v=null;f.ba.Ic(this.Y.K())&&(v=this.Y);var w=(this.QG||this.sl)&&v!=null,E=g.I();this.lf=g.vb(0),this.hi=new f.ja(0),this.hi.Jb(2*E),this.gi=new f.ja(0),this.gi.Jb(2*E),w&&(this.Hl==null&&(this.Hl=new f.ja(0)),this.Hl.Jb(E));for(var C=g=0;C<E;C++)if(this.hi.add(2*C),this.hi.add(2*C+1),this.gi.add(2*C),this.gi.add(2*C+1),w){for(;C>=v.Wc(g);)g++;this.Hl.add(g)}for(new f.Yt().sort(this.gi,0,2*E,new c(this,w)),this.fb.clear(),this.fb.Wo(new h(this)),this.fb.Ee(E),v=0,E*=2;v<E;v++)if(w=this.gi.get(v),w=(g=this.hi.get(w))>>1,(1&g)==0){if(g=this.fb.addElement(w,-1),(C=this.fb.xe(g))!=-1&&!this.dC(this.fb.ka(C),w))return this.ke=new f.Nd(3,w,this.fb.ka(C)),!1;var R=this.fb.lb(g);if(R!=-1&&!this.dC(this.fb.ka(R),w))return this.ke=new f.Nd(3,w,this.fb.ka(R)),!1}else if(g=this.fb.search(w,-1),C=this.fb.xe(g),R=this.fb.lb(g),this.fb.wd(g,-1),C!=-1&&R!=-1&&!this.dC(this.fb.ka(C),this.fb.ka(R)))return this.ke=new f.Nd(3,this.fb.ka(C),this.fb.ka(R)),!1;return!0},m.prototype.hO=function(){return 10>this.Y.I()?this.fO():this.gO()},m.prototype.gO=function(){var g=new f.hd;g.Ib(this.Y);var v=new f.Nd;return!f.au.cI(!1,g,this.Pj,v,this.nd)||(v.Ko=g.Va(v.Ko),v.Lo=g.Va(v.Lo),this.ke.Xt(v),!1)},m.prototype.fO=function(){var g=this.Y,v=g.Ha();for(g=g.Ha();v.ab();)for(;v.Ia();){var w=v.ia();if(!v.Rn()||!v.QS()){g.rW(v);do for(;g.Ia();){var E=g.ia();if((E=w.Br(E,this.Pj,!0))!=0)return this.ke=new f.Nd(E==2?5:4,v.xb(),g.xb()),!1}while(g.ab())}}return!0},m.prototype.kO=function(){var g=this.Y;this.hb.length=0,this.qo.length=0,this.$f=g.Ha(),this.$f.DB();var v=new f.ja(0);v.Jb(10);var w=NaN,E=0,C=0;for(g=2*g.I();C<g;C++){var R=this.gi.get(C);if((1&(R=this.hi.get(R)))==0){R>>=1;var I=this.lf.read(2*R),F=this.lf.read(2*R+1);if(v.size!=0&&(I!=w||F!=E)){if(!this.II(v))return!1;v!=null&&v.clear(!1)}v.add(R),w=I,E=F}}return!!this.II(v)},m.prototype.jO=function(){for(var g=this.Y,v=Array(g.ea()),w=0,E=g.ea();w<E;w++)v[w]=g.On(w);E=new T;var C=new f.h;w=this.gi.get(0);var R=(w=this.hi.get(w))>>1;this.lf.uc(2*R,C);var I=v[w=this.Hl.get(R)],F=g.Ca(w),U=g.Wc(w)-1;E.fl=R==F||R==U,E.iy=this.sl?!I&&E.fl:E.fl,E.Bi=w,E.x=C.x,E.y=C.y,E.zm=R;for(var j=new T,ee=1,te=this.gi.size;ee<te;ee++)if(w=this.gi.get(ee),(1&(w=this.hi.get(w)))==0){R=w>>1,this.lf.uc(2*R,C),(w=this.Hl.get(R))!=E.Bi&&(I=v[w],F=g.Ca(w),U=g.Wc(w)-1);var Z=R==F||R==U,le=this.sl?!I&&E.fl:E.fl;if(j.x=C.x,j.y=C.y,j.Bi=w,j.zm=R,j.iy=le,j.fl=Z,j.x==E.x&&j.y==E.y){if(this.sl){if(!(j.iy&&E.iy||j.Bi==E.Bi&&(j.fl||E.fl)))return this.ke=new f.Nd(8,j.zm,E.zm),!1}else if(!j.fl||!E.fl)return this.ke=new f.Nd(5,j.zm,E.zm),!1}w=E,E=j,j=w}return!0},m.prototype.BE=function(){for(var g=this.Y,v=[],w=-1,E=!1,C=0,R=g.ea();C<R;C++)g.Fv(C)&&(E=!1,w++,C<R-1&&(g.Fv(C+1)||(E=!0))),v[C]=E?w:-1;E=new f.h,C=this.gi.get(0);var I=(C=this.hi.get(C))>>1;this.lf.uc(2*I,E),C=this.Hl.get(I),w=new d(E.x,E.y,C,I,v[C]),g=[];var F=1;for(R=this.gi.size;F<R;F++)if(C=this.gi.get(F),(1&(C=this.hi.get(C)))==0){if(I=C>>1,this.lf.uc(2*I,E),C=this.Hl.get(I),(C=new d(E.x,E.y,C,I,v[C])).x==w.x&&C.y==w.y){if(C.Bi==w.Bi)return this.ke=new f.Nd(9,C.zm,w.zm),!1;0<=v[C.Bi]&&v[C.Bi]==v[w.Bi]&&(g.length!=0&&g[g.length-1]==w||g.push(w),g.push(C))}w=C}if(g.length==0)return!0;for(C=new f.kp(!0),f.P.av(v,-1),E=-1,(F=new f.h).Sc(),w=0,R=g.length;w<R;w++){(I=g[w]).x==F.x&&I.y==F.y||(E=C.Qh(0),F.x=I.x,F.y=I.y);var U=v[I.Bi];U==-1&&(U=C.Qh(2),v[I.Bi]=U),C.addElement(U,E),C.addElement(E,U)}for((R=new f.ja(0)).Jb(10),w=C.je;w!=-1;w=C.lz(w))if((1&(g=C.HF(w)))==0&&(2&g)!=0){for(g=-1,R.add(w),R.add(-1);0<R.size;){if(E=R.Gc(),R.Jf(),F=R.Gc(),R.Jf(),(1&(I=C.HF(F)))!=0){g=(2&I)==0?E:F;break}for(C.TW(F,1|I),I=C.sc(F);I!=-1;I=C.lb(I))(U=C.getData(I))!=E&&(R.add(U),R.add(F))}if(g!=-1){for(C=-1,w=0,R=v.length;w<R;w++)if(v[w]==g){C=w;break}return this.ke=new f.Nd(10,C,-1),!1}}return!0},m.prototype.lO=function(){var g=this.Y;if(0>=g.He())return this.ke=new f.Nd(6,g.ea()==1?1:-1,-1),0;if(g.ea()==1)return this.sl&&!this.BE()?0:2;this.uo=f.ja.rf(g.ea(),0),this.DA=f.ja.rf(g.ea(),-1);for(var v=-1,w=0,E=0,C=g.ea();E<C;E++){var R=g.Kr(E);if(this.uo.write(E,0>R?0:256),0<R)v=E,w=R;else{if(R==0)return this.ke=new f.Nd(6,E,-1),0;if((0>v||w<Math.abs(R))&&(this.ke=new f.Nd(7,E,-1),this.sl))return 0;this.DA.write(E,v)}}for(this.dt=g.ea(),this.Qm=new f.ja(0),this.Qm.Jb(10),C=g.I(),this.No=NaN,(g=new f.ja(0)).Jb(10),this.Sq=f.ja.rf(C,-1),this.Iw=f.ja.rf(C,-1),this.Aj!=null?this.Aj.clear(!1):this.Aj=new f.ja(0),this.Aj.Jb(10),this.fb.clear(),this.fb.Wo(new o(this)),v=0,C*=2;0<this.dt&&v<C;v++)if(w=this.gi.get(v),(1&(w=this.hi.get(w)))==0){if(w>>=1,(E=this.lf.read(2*w+1))!=this.No&&g.size!=0){if(!this.ut(g))return 0;g!=null&&g.clear(!1)}g.add(w),this.No=E}return 0<this.dt&&!this.ut(g)?0:this.sl?this.ke.Kj==0&&this.BE()?2:0:this.ke.Kj==0?2:1},m.prototype.II=function(g){if(g.size==1)return!0;for(var v=0,w=g.size;v<w;v++){var E=g.get(v);this.$f.Wb(E);var C=this.$f.mi();this.hb.push(this.Uu(C,E,this.$f.gb,!0)),this.$f.ia(),C=this.$f.ia(),this.hb.push(this.Uu(C,E,this.$f.gb,!1))}var R=this;for(this.hb.sort(function(U,j){return R.PP(U,j)}),(E=this.nh.je)==-1&&(E=this.nh.Qh(0)),this.nh.hn(this.hb.length),v=0,w=this.hb.length;v<w;v++)this.nh.addElement(E,v);v=!0;for(var I=w=-1;v&&(v=!1,(C=this.nh.sc(E))!=-1);)for(var F=this.nh.lb(C);F!=-1;)if(w=this.nh.getData(C),I=this.nh.getData(F),(w=this.hb[w].Jo)!=(I=this.hb[I].Jo))C=F,F=this.nh.lb(C);else if(v=!0,this.nh.kd(E,C),C=this.nh.xe(F),(F=this.nh.kd(E,F))==-1||C==-1)break;if(v=this.nh.cs(E),this.nh.DE(E),0<v)return this.ke=new f.Nd(5,w,I),!1;for(v=0,w=g.size;v<w;v++)this.pB(this.hb[v]);return this.hb.length=0,!0},m.prototype.ut=function(g){for(var v=0,w=g.size;v<w;v++){var E=g.get(v),C=this.Sq.read(E);if(C!=-1){var R=this.fb.ka(C);this.Aj.add(R),this.fb.wd(C,-1),this.pB(this.hb[R]),this.hb[R]=null,this.Sq.write(E,-1)}(C=this.Iw.read(E))!=-1&&(R=this.fb.ka(C),this.Aj.add(R),this.fb.wd(C,-1),this.pB(this.hb[R]),this.hb[R]=null,this.Iw.write(E,-1))}for(v=0,w=g.size;v<w;v++){if(E=g.get(v),this.$f.Wb(E),(C=this.$f.mi()).oa>C.ma){var I=this.$f.xb(),F=this.Uu(C,E,this.$f.gb,!0);0<this.Aj.size?(R=this.Aj.Gc(),this.Aj.Jf(),this.hb[R]=F):(R=this.hb.length,this.hb.push(F)),C=this.fb.addElement(R,-1),this.Sq.read(I)==-1?this.Sq.write(I,C):this.Iw.write(I,C),(3&this.uo.read(this.$f.gb))==0&&this.Qm.add(C)}this.$f.ia(),(C=this.$f.ia()).oa<C.ma&&(I=this.$f.ik(),F=this.Uu(C,E,this.$f.gb,!1),0<this.Aj.size?(R=this.Aj.Gc(),this.Aj.Jf(),this.hb[R]=F):(R=this.hb.length,this.hb.push(F)),C=this.fb.addElement(R,-1),this.Sq.read(I)==-1?this.Sq.write(I,C):this.Iw.write(I,C),(3&this.uo.read(this.$f.gb))==0&&this.Qm.add(C))}for(v=0,w=this.Qm.size;v<w&&0<this.dt;v++)if(C=this.Qm.get(v),(3&this.uo.read(this.hb[this.fb.ka(C)].CA))==0){g=-1,E=this.fb.xe(C);var U=C;F=null,R=-1;for(var j=0;E!=-1&&(R=this.fb.ka(E),R=(F=this.hb[R]).CA,(3&(j=this.uo.read(R)))==0);)U=E,E=this.fb.xe(E);E==-1?(I=1,E=U):(g=(3&j)==1?R:this.DA.read(R),I=F.PF()!=0?0:1,E=this.fb.lb(E));do{if(R=this.fb.ka(E),R=(F=this.hb[R]).CA,(3&(U=this.uo.read(R)))==0){if(I!=F.PF())return this.ke=new f.Nd(6,R,-1),!1;if(U=252&U|(j=I==0||F.Yp()?2:1),this.uo.write(R,j),j==2&&this.ke.Kj==0&&this.DA.read(R)!=g&&(this.ke=new f.Nd(7,R,-1),this.sl))return!1;if(this.dt--,this.dt==0)return!0}(3&U)==1&&(g=R),U=E,E=this.fb.lb(E),I=I!=0?0:1}while(U!=C)}return this.Qm!=null?this.Qm.clear(!1):this.Qm=new f.ja(0),!0},m.prototype.Uu=function(g,v,w,E){if(g.K()!=322)throw f.i.Ra();return(g=this.kP(g)).Jo=v,g.CA=w,g.Aq=0,g.aX(E),g},m.prototype.kP=function(g){if(0<this.qo.length){var v=this.qo[this.qo.length-1];--this.qo.length,g.copyTo(v.ne)}else(v=new N).ne=f.KC.ig(g);return v},m.prototype.pB=function(g){g.ne.K()==322&&this.qo.push(g)},m.prototype.aU=function(){for(var g=this.Y.I(),v=new f.ja(0),w=0;w<g;w++)v.add(w);var E=this;for(v.Wd(0,g,function(C,R){return E.Qu(C,R)}),w=1;w<g;w++)if(this.Qu(v.get(w-1),v.get(w))==0)return this.ke=new f.Nd(3,v.get(w-1),v.get(w)),0;return 2},m.prototype.zV=function(){return this.yE()&&this.vE(!0)?2:0},m.prototype.eV=function(){return this.VS()},m.prototype.fU=function(){for(var g=this.Y.I(),v=new f.ja(0),w=0;w<g;w++)v.add(w);var E=this;v.Wd(0,g,function(U,j){return E.HO(U,j)});var C=Array(g);for(f.P.av(C,!1),C[v.get(0)]=!0,w=1;w<g;w++){var R=v.get(w-1),I=v.get(w);this.Qu(R,I)==0?C[I]=!1:C[I]=!0}v=this.Y.Ja(),R=this.Y,I=0;var F=1;for(w=0;w<g;w++)C[w]?F=w+1:(I<F&&v.Gd(R,I,F),I=w+1);return I<F&&v.Gd(R,I,F),v.Dh(2,this.Co),v},m.prototype.DV=function(){var g=this.Y,v=g.Ha(),w=g.Ha(),E=this.Y.Ja(),C=this.Y,R=g.hasAttribute(1),I=R?f.ta.oE(this.Rg,g,!0):0,F=new f.ja(0),U=new f.ja(0);for(F.Jb(f.P.truncate(g.I()/2+1)),U.Jb(f.P.truncate(g.I()/2+1));v.ab();)if(w.ab(),!(2>g.Ka(v.gb))){w.tW();for(var j,ee,te=!0;v.Ia();){var Z=v.ia(),le=w.mi();if(v.xb()>w.xb())break;te&&(F.add(v.xb()),U.add(w.ik()),te=!1),ee=F.Gc();var ve=v.ik();if(1<ve-ee){var be=new f.h;be.vc(g.Oa(ee),g.Oa(ve)),j=be.length()}else j=Z.Rb();ee=U.Gc(),1<(ve=w.xb())-ee?((be=new f.h).vc(g.Oa(ee),g.Oa(ve)),ee=be.length()):ee=le.Rb(),j>this.Co?F.add(v.ik()):R&&(j=g.Vc(1,F.Gc(),0),Z=Z.hv(1,0),Math.abs(Z-j)>I&&F.add(v.ik())),ee>this.Co?U.add(w.xb()):R&&(j=g.Vc(1,U.Gc(),0),Z=le.hv(1,0),Math.abs(Z-j)>I&&U.add(w.xb()))}if(F.Gc()<U.Gc()?F.size>U.size?F.Jf():U.Jf():(F.Gc()!=U.Gc()&&U.Jf(),U.Jf()),2<=U.size+F.size){for(te=new f.Ta,le=0,Z=F.size;le<Z;le++)C.we(F.get(le),te),le==0?E.nf(te):E.lineTo(te);for(le=U.size-1;0<le;le--)C.we(U.get(le),te),E.lineTo(te);C.ec(v.gb)?E.Cp():0<U.size&&(C.we(U.get(0),te),E.lineTo(te))}F!=null&&F.clear(!1),U!=null&&U.clear(!1)}return E.Dh(2,this.Co),E},m.prototype.hV=function(){return this.rX()},m.prototype.rX=function(){return this.Y.K()==1736&&this.Y.Jn()==1?f.Hg.Mk(this.Y,this.Co,!0,!1,this.nd):(this.Ii=new f.hd,this.Ii.Ib(this.Y),this.Ii.gd!=0&&(this.rA!=1&&f.Tk.W(this.Ii,this.Co,this.nd,!0),this.Y.K()==1736&&f.tn.W(this.Ii,this.Ii.ld,this.rA,!1,this.nd)),this.Y=this.Ii.Ke(this.Ii.ld),this.Y.K()==1736&&(this.Y.hm(),this.Y.Zo(0)),this.Y.Dh(2,this.Co),this.Y)},m.ss=function(g,v,w,E,C){if(E!=null&&(E.Kj=0,E.Ko=-1,E.Lo=-1),g.B())return 1;var R=g.K();if(R==33)return 1;var I=f.ta.lj(v,g,!1);if(R==197)return v=new f.l,g.A(v),v.Ci(I)?(E!=null&&(E.Kj=2,E.Ko=-1,E.Lo=-1),0):1;if(f.ba.zd(R))return(I=new f.Ua(g.description)).oc(g,!0),m.ss(I,v,w,E,C);var F=g.qm(I);if((w=w?-1:F)!=-1)return w;if(v=new m(g,v,w,C,!1),R==550)w=v.aU();else if(R==1607)w=v.zV();else{if(R!=1736)throw f.i.Ra();w=v.eV()}return g.Dh(w,I),E!=null&&w==0&&E.Xt(v.ke),w},m.VJ=function(g,v,w,E){if(g.B())return g;var C=g.K();if(C==33)return g;var R=f.ta.lj(v,g,!1);if(C==197)return v=new f.l,g.A(v),v.Ci(R)?g.Ja():g;if(f.ba.zd(C))return(C=new f.Ua(g.description)).oc(g,!0),m.VJ(C,v,w,E);if(R=g.qm(R),(w=w?-1:R)==2)return g;if(g=new m(g,v,w,E,!1),C==550)g=g.fU();else if(C==1607)g=g.DV();else{if(C!=1736)throw f.i.Ra();g=g.hV()}return g},m.prototype.Nh=function(g,v,w){if(g==v)return 0;g=this.hi.get(g);var E=this.hi.get(v);v=g>>1;var C=E>>1,R=new f.h,I=new f.h;return this.lf.uc(2*v,R),R.y+=(1&g)!=0?this.Pj:-this.Pj,this.lf.uc(2*C,I),I.y+=(1&E)!=0?this.Pj:-this.Pj,(g=R.compare(I))==0&&w?0>(w=this.Hl.get(v)-this.Hl.get(C))?-1:0<w?1:0:g},m.prototype.Qu=function(g,v){if(g==v)return 0;var w=this.Y,E=w.Oa(g),C=w.Oa(v);if(E.x<C.x)return-1;if(E.x>C.x)return 1;if(E.y<C.y)return-1;if(E.y>C.y)return 1;for(E=1;E<this.eT;E++){C=this.fH.qd(E);for(var R=f.ua.Wa(C),I=0;I<R;I++){var F=w.Vc(C,g,I),U=w.Vc(C,v,I);if(F<U)return-1;if(F>U)return 1}}return 0},m.prototype.HO=function(g,v){var w=this.Qu(g,v);return w==0?g<v?-1:1:w},m.prototype.PP=function(g,v){if(g===v)return 0;var w=g.ne.jg();g.Yp()&&w.Uq(),g=v.ne.jg(),v.Yp()&&g.Uq(),v=w.ru();var E=g.ru();return E==v?(v=w.xi(g),Math.abs(v)<=8881784197001252e-31*(Math.abs(g.x*w.y)+Math.abs(g.y*w.x))&&(v--,v++),0>v?1:0<v?-1:0):v<E?-1:1},m}();f.Hx=u}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 30},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.W=function(h,o,c,u){return h instanceof f.ba?(h=new f.$c(h),o=new f.$c(o),this.W(h,o,c,u).next()):new f.tL(h,o,c,u)},d.fp=function(h,o,c,u){var m=h.Eb(),g=o.Eb();if(h.B()&&o.B())return m>g?h:o;if(h.B())return o;if(o.B())return h;var v=new f.l,w=new f.l,E=new f.l;return h.A(v),o.A(w),E.L(v),E.$b(w),v=f.ta.Xd(c,E,!0),w=h.K(),E=o.K(),w==33&&E==33?d.RU(h,o,v):w!=E?0<m||0<g?m>g?h:o:w==550?d.aI(h,o,v):d.aI(o,h,v):f.Hg.fp(h,o,c,u)},d.RU=function(h,o,c){c=c*Math.sqrt(2)*1.00001,c*=c;var u=h.D(),m=o.D(),g=new f.de(h.description);return f.h.zc(u,m)>c&&(g.add(h),g.add(o)),g},d.aI=function(h,o,c){var u=h.vb(0),m=h.I(),g=o.D(),v=h.Ja();c=c*Math.sqrt(2)*1.00001;var w=new f.l;if(h.A(w),w.X(c,c),w.contains(g)){c*=c,w=!1;for(var E=[],C=0;C<m;C++)E[C]=!1;for(C=0;C<m;C++){var R=u.read(2*C),I=u.read(2*C+1);(R-=g.x)*R+(I-=g.y)*I<=c&&(w=!0,E[C]=!0)}if(w)for(C=0;C<m;C++)E[C]||v.Gd(h,C,C+1);else v.Gd(h,0,m),v.add(o)}else v.Gd(h,0,m),v.add(o);return v},d.instance=null,d}(f.Ge);f.Ix=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o,c){this.us=h==null,this.za=-1,this.Sd=d,this.vg=o,this.DT=h.next(),this.Vb=c}return T.prototype.next=function(){return this.us?null:(d=this.Sd.next())!=null?(this.za=this.Sd.Ma(),f.Ix.fp(d,this.DT,this.vg,this.Vb)):null;var d},T.prototype.Ma=function(){return this.za},T.prototype.qe=function(){},T}();f.tL=N}(ae||(ae={})),function(f){var N=function(){function h(){}return h.prototype.Az=function(){this.Vy=null,this.yx=-1,this.sK=!1},h}(),T=function(){function h(){this.Ir=0,this.qj=[]}return h.prototype.hN=function(o){this.Ir+=o.yx,this.qj.push(o)},h.prototype.JV=function(){this.Ir-=this.qj[this.qj.length-1].yx,--this.qj.length},h.prototype.hy=function(){return this.qj[this.qj.length-1]},h.prototype.Nb=function(o){return o===this},h}(),d=function(){function h(o,c,u){this.za=-1,this.Jc=!1,this.sH=[!1,!1,!1,!1],this.wq=[0,0,0,0],this.eA=!1,this.zk=-1,this.kq=0,this.co=-1,this.Eo=[],this.Sd=o,this.vg=c,this.Vb=u}return h.WD=function(o){var c=[],u=0;for(o=Object.keys(o);u<o.length;u++)c.push(Number(o[u]));return c.sort(function(m,g){return m-g}),c},h.prototype.YF=function(o){var c=this.Eo[o],u=h.WD(c)[0],m=c[u],g=m.hy().Vy;return m=m.hy().sK,delete c[u],m&&(g=f.$l.local().W(g,this.vg,!1,this.Vb),o==0&&g.K()==33&&(o=new f.de(g.description),g.B()||o.add(g),g=o)),g},h.prototype.next=function(){if(this.Jc&&this.co==this.zk)return null;for(;!this.iK(););if(this.zk==-1)return null;if(this.eA){for(this.co++;;){if(this.co>this.zk||0>this.co)throw f.i.Ra();if(this.sH[this.co])break}return this.za++,this.YF(this.co)}return this.za=0,this.co=this.zk,this.YF(this.zk)},h.prototype.Ma=function(){return this.za},h.prototype.iK=function(){if(this.Jc)return!0;var o=null;if(this.Sd!=null&&(o=this.Sd.next())==null&&(this.Jc=!0,this.Sd=null),f.np.Bp(this.Vb),o!=null){var c=o.Eb();this.sH[c]=!0,c>=this.zk&&!this.eA&&(this.ED(c,!1,o),c>this.zk&&!this.eA&&this.pW(c))}if(0<this.kq)for(c=0;c<=this.zk;c++)for(;1<this.wq[c]&&(o=this.xO(c)).length!=0;)o=f.Hg.NP(o,this.vg,this.Vb),this.ED(c,!0,o);return this.Jc},h.prototype.xO=function(o){for(var c=[],u=[],m=this.Eo[o],g=h.WD(m),v=0;v<g.length;v++){var w=g[v],E=m[w];if(this.Jc||1e4<E.Ir&&1<E.qj.length){for(this.wq[o]-=E.qj.length,this.kq-=E.qj.length;0<E.qj.length;)c.push(E.hy().Vy),E.JV();u.push(w)}}for(v=0;v<u.length;v++)delete m[u[v]];return c},h.prototype.pW=function(o){for(var c=0;c<o;c++)this.Eo[c]=[],this.kq-=this.wq[c],this.wq[c]=0},h.prototype.ED=function(o,c,u){var m=new N;if(m.Az(),m.Vy=u,u=h.WR(u),m.yx=u,u=h.UR(u),o+1>this.Eo.length)for(var g=0,v=Math.max(2,o+1);g<v;g++)this.Eo.push([]);(g=this.Eo[o][u])===void 0&&(g=new T,this.Eo[o][u]=g),m.sK=c,g.hN(m),this.wq[o]++,this.kq++,this.zk=Math.max(this.zk,o)},h.UR=function(o){return 0<o?f.P.truncate(Math.log(o)/Math.log(4)+.5):0},h.WR=function(o){var c=o.K();if(f.ba.yj(c))return o.I();if(c==33)return 1;if(c==197)return 4;if(f.ba.zd(c))return 2;throw f.i.Ra()},h.prototype.qe=function(){this.iK()},h}();f.vL=d}(ae||(ae={})),function(f){var N=function(T){function d(){return T!==null&&T.apply(this,arguments)||this}return Hi(d,T),d.prototype.K=function(){return 1},d.prototype.W=function(h,o,c,u){return u===void 0?new f.vL(h,o,c):this.ZP(h,o,c,u)},d.prototype.ZP=function(h,o,c,u){return h=new f.$c([h,o]),this.W(h,c,u).next()},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Ge);f.Hh=N}(ae||(ae={})),function(f){var N,T;(T=N||(N={}))[T.nextPath=0]="nextPath",T[T.nextSegment=1]="nextSegment",T[T.iterate=2]="iterate",N=function(){function d(h,o,c,u){this.Us=new f.l,this.wT=h,this.xT=o,this.oq=u,this.vo=-1,this.tl=!1;var m=h.Cb;m!=null&&(m=u?m.Ao:m.Gb)!=null&&(this.Jc=!1,this.ra=c,this.Gb=m,this.yw=this.Gb.getIterator(),this.pq=this.tl=!0,this.Yb=0,u?this.vo=o.ea():this.td=o.Ha()),this.tl||(m=o.Cb)!=null&&(m=u?m.Ao:m.Gb)!=null&&(this.Jc=!1,this.ra=c,this.Gb=m,this.yw=this.Gb.getIterator(),this.tl=!0,this.pq=!1,this.Yb=0,u?this.vo=h.ea():this.td=h.Ha()),this.tl||(this.di=u?f.ta.eR(h,o,c,1<=h.qm(0),1<=o.qm(0)):f.ta.dR(h,o,c))}return d.prototype.next=function(){if(this.tl){if(this.Jc)return!1;for(var h=!0;h;)switch(this.Yb){case 0:h=this.nU();break;case 1:h=this.oU();break;case 2:h=this.Pz();break;default:throw f.i.ga("internal error")}return!this.Jc}return this.di!=null&&this.di.next()},d.prototype.pl=function(){return this.tl?this.pq?this.Gb.ka(this.Gs):this.oq?this.vo:this.td.xb():this.di.pl(this.di.Wf)},d.prototype.jl=function(){return this.tl?this.pq?this.oq?this.vo:this.td.xb():this.Gb.ka(this.Gs):this.di.jl(this.di.Bf)},d.prototype.oz=function(){if(!this.oq)throw f.i.ga("internal error");return this.tl?this.pq?this.Gb.yF(this.Gs):this.Us:this.di.oz(this.di.Wf)},d.prototype.Wy=function(){if(!this.oq)throw f.i.ga("internal error");return this.tl?this.pq?this.Us:this.Gb.yF(this.Gs):this.di.Wy(this.di.Bf)},d.prototype.nU=function(){return this.oq?--this.vo==-1?(this.Jc=!0,!1):(this.pq?this.xT.Sj(this.vo,this.Us):this.wT.Sj(this.vo,this.Us),this.yw.Yi(this.Us,this.ra),this.Yb=2,!0):this.td.ab()?(this.Yb=1,!0):(this.Jc=!0,!1)},d.prototype.oU=function(){if(!this.td.Ia())return this.Yb=0,!0;var h=this.td.ia();return this.yw.Vo(h,this.ra),this.Yb=2,!0},d.prototype.Pz=function(){return this.Gs=this.yw.next(),this.Gs==-1&&(this.Yb=this.oq?0:1,!0)},d}(),f.am=N}(ae||(ae={})),function(f){(f=f.GL||(f.GL={}))[f.enumClosed=1]="enumClosed",f[f.enumHasNonlinearSegments=2]="enumHasNonlinearSegments",f[f.enumOGCStartPolygon=4]="enumOGCStartPolygon",f[f.enumCalcMask=4]="enumCalcMask"}(ae||(ae={})),function(f){f.IC=function(){function N(){}return N.ub=function(T,d,h,o,c,u,m,g,v){var w=[0,0,0],E=[0,0,0],C=[0,0,0],R=[0,0,0,0],I=new f.ha(0),F=new f.ha(0),U=new f.ha(0);if(m!=null||g!=null||v!=null)if(f.s.ui(d))f.Zg.ub(T,h,o,c,u,m,g,v);else{c=f.F.ca(c),h=f.F.ca(h);var j=f.F.ca(c-h);if(f.s.$(o,u)&&(f.s.$(h,c)||f.s.$(f.s.R(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.$(o,-u)){if(f.s.$(f.s.R(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0<o?f.F.ca(3.141592653589793-f.F.ca(c)):f.F.ca(c)),void(v!=null&&(v.u=0<o?f.F.ca(c):f.F.ca(3.141592653589793-f.F.ca(c))));f.s.$(f.s.R(j),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Bh(T,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else if(f.s.$(f.s.R(o),1.570796326794897)||f.s.$(f.s.R(u),1.570796326794897)||f.s.$(h,c)||f.s.$(f.s.R(j),3.141592653589793)||f.s.Dd(o))return void f.Xk.ub(T,d,h,o,c,u,m,g,v);var ee=Math.sqrt(1-d);c=f.F.ca(c-h),h=0,f.F.dl(1,d,o,h,0,I,F,U),w[0]=I.u,w[1]=F.u,w[2]=U.u,f.F.dl(1,d,u,c,0,I,F,U),E[0]=I.u,E[1]=F.u,E[2]=U.u,C[0]=0,C[1]=0,C[2]=-1*d*f.F.n(1,d,o)*Math.sin(o),0>c?f.F.Yq(C,E,w,R,0):f.F.Yq(C,w,E,R,0),F=[0,0,0],U=[0,0,0];var te=[0,0,0];w=[0,0,0],I=[0,0,0];var Z=Math.acos(R[2]/1),le=1-d,ve=Math.tan(Z),be=1+ve*ve/le,ue=2*C[2]*ve/le;for(le=(-ue+(ve=Math.sqrt(ue*ue-4*be*(C[2]*C[2]/le-1))))/(be*=2),ue=(-ue-ve)/be,ve=Math.tan(Z),Z=(le+ue)/2,C=((be=ve*le+C[2])+(ve*ue+C[2]))/2,ve=f.F.hp(le-Z,be-C),le=C/ee*1.570796326794897,ue=0;100>ue&&(be=(be=f.F.w(d,le))*be/Math.cos(le)*(Math.sin(le)-C*be/(1-d)),!f.s.Dd(be));ue++)le-=be;C=f.F.n(1,d,le)*Math.cos(le),ve=1-ve/(C=Math.sqrt((C-Z)*(C+Z))),ve*=2-ve,be=f.F.qn(F),Z=f.F.qn(U),le=f.F.qn(te);var Le=f.F.Tt(te,F);ue=f.F.Tt(te,U),f.F.xx(te,F,w),f.F.xx(te,U,I),F=Math.acos(Le/(le*be)),U=Math.acos(ue/(le*Z)),U*=f.s.Mb(1,f.F.Tt(w,I)),(1.570796326794897<=f.s.R(F)&&1.570796326794897<=f.s.R(U)||3.141592653589793<f.s.R(F-U))&&(F=(3.141592653589793-f.s.R(F))*f.s.Mb(1,F),U=(3.141592653589793-f.s.R(U))*f.s.Mb(1,U)),w=f.F.Rj(ve,U),I=f.F.q(C,ve,f.F.Rj(ve,F)),w=f.F.q(C,ve,w),w=f.s.R(w-I)*T,F=new f.ha(0),U=new f.ha(0),te=R[1]/1,te*=-f.s.Mb(1,j),I=Math.acos(te)*f.s.Mb(1,j),N.sf(T,d,h,o,w,I,F,U),f.s.$(c,F.u)&&f.s.$(u,U.u)||(ve=f.F.hp(f.F.ca(c-F.u),u-U.u),N.sf(T,d,h,o,w,f.F.ca(I+3.141592653589793),F,U),(be=f.F.hp(f.F.ca(c-F.u),u-U.u))<ve&&(I=f.F.ca(I+3.141592653589793))),F=[0,0,0,0],U=[0,0,0,0],ve=[0,0,0],T=[0,0,0],h=[0,0,0],o=[0,0,0],te=[0,0,0],(C=[0,0,0])[0]=0,C[1]=0,C[2]=ee,ve[0]=0,ve[1]=0,ve[2]=0,f.F.Yq(ve,C,E,F,0),f.s.Dd(u)?(T[0]=E[0],T[1]=E[1],T[2]=1,h[0]=1*Math.cos(c)-1*Math.sin(c),h[1]=1*Math.sin(c)+1*Math.cos(c)):(d=f.F.n(1,d,u)*Math.cos(u),T[0]=0,T[1]=0,E[2]+=Math.tan(1.570796326794897-f.s.R(u))*d*f.s.Mb(1,u),h[0]=d*Math.cos(c)-d*Math.sin(c),h[1]=d*Math.sin(c)+d*Math.cos(c)),h[2]=E[2],f.F.Yq(E,h,T,U,1),f.F.xx(U,F,o),f.F.xx(U,R,te),te=f.F.Tt(o,te)/(f.F.qn(o)*f.F.qn(te)),te*=f.s.Mb(1,j),c=Math.acos(te)*-f.s.Mb(1,j),(0<I&&0<c||0>I&&0>c)&&(c=f.F.ca(c+3.141592653589793)),m!=null&&(m.u=w),g!=null&&(g.u=I),v!=null&&(v.u=c)}}},N.sf=function(T,d,h,o,c,u,m,g){var v=[0,0,0],w=[0,0,0],E=[0,0,0],C=[0,0,0],R=[0,0,0],I=[0,0,0],F=[0,0,0],U=[0,0,0,0],j=new f.ha(0),ee=new f.ha(0),te=new f.ha(0),Z=new f.ha(0),le=new f.ha(0),ve=new f.ha(0);if(m!=null&&g!=null)if(f.s.ui(d))f.Zg.sf(T,h,o,c,u,m,g);else if(f.s.Dd(c))m!=null&&(m.u=h),g!=null&&(g.u=o);else if(u=f.F.ca(u),0>c&&(c=f.s.R(c),u=f.F.ca(u+3.141592653589793)),h=f.F.ca(h),o=f.F.ca(o),1.570796326794897<f.s.R(o)&&(h=f.F.ca(h+3.141592653589793),o=f.s.Mb(3.141592653589793,o)-o),f.s.$(f.s.R(o),1.570796326794897)||f.s.Dd(o)||f.s.Dd(u)||f.s.$(f.s.R(u),3.141592653589793))f.Xk.sf(T,d,h,o,c,u,m,g);else{var be=Math.sqrt(1-d);for(T=c/T,f.F.dl(1,d,o,0,0,Z,le,ve),v[0]=Z.u,v[1]=le.u,v[2]=le.u,F[0]=0,F[1]=0,F[2]=-1*d*f.F.n(1,d,o)*Math.sin(o),Z=f.F.n(1,d,o),le=f.F.ca(1.570796326794897-u),ve=Math.sin(le),c=Math.cos(o),o=Math.sin(o),R[0]=Z*c-o*ve,R[1]=Math.cos(le),R[2]=(1-d)*Z*o+c*ve,0>u?f.F.Yq(F,R,v,U,0):f.F.Yq(F,v,R,U,0),v=Math.acos(U[2]/1),U=Math.atan2(-U[1],-U[0]),o=1-d,le=1+(R=Math.tan(v))*R/o,o=(-(Z=2*F[2]*R/o)+(R=Math.sqrt(Z*Z-4*le*(F[2]*F[2]/o-1))))/(le*=2),Z=(-Z-R)/le,R=Math.tan(v),v=(o+Z)/2,F=((le=R*o+F[2])+(R*Z+F[2]))/2,R=f.F.hp(o-v,le-F),be=F/be*1.570796326794897,o=0;100>o&&(Z=(Z=f.F.w(d,be))*Z/Math.cos(be)*(Math.sin(be)-F*Z/(1-d)),!f.s.Dd(Z));o++)be-=Z;be=f.F.n(1,d,be)*Math.cos(be),F=1-R/(be=Math.sqrt((be-v)*(be+v))),F*=2-F,I=Math.acos(f.F.Tt(I,w)/(f.F.qn(I)*f.F.qn(w))),I*=f.s.Mb(1,w[0]),u=(f.F.q(be,F,f.F.Rj(F,I))+T*f.s.Mb(1,u))/f.F.Bh(be,F),u=f.F.ca(1.570796326794897*u),u=f.F.Tq(F,u),f.F.n(be,F,u),R=f.F.ca(U+h),h=Math.cos(R),u=Math.sin(R),E[0]=C[0]*h+C[1]*-u,E[1]=C[0]*u+C[1]*h,E[2]=C[2],f.F.bO(d,E[0],E[1],E[2],te,ee,j),m!=null&&(m.u=ee.u),g!=null&&(g.u=te.u)}},N}()}(ae||(ae={})),function(f){var N=function(){function c(u){this.Za=null,this.wt=new f.h,this.xt=new f.h,this.g=u}return c.prototype.compare=function(u,m,g){return this.g.Hc(m,this.wt),this.g.Hc(u.ka(g),this.xt),this.wt.compare(this.xt)},c}(),T=function(){function c(u){this.Cf=new f.h,this.Dk=new f.h,this.g=u}return c.prototype.Eh=function(u){this.Cf.N(u)},c.prototype.compare=function(u,m){return this.g.Hc(u.ka(m),this.Dk),this.Cf.compare(this.Dk)},c}(),d=function(c){function u(m){var g=c.call(this,m.g,m.ra,!1)||this;return g.ib=m,g}return Hi(u,c),u.prototype.compare=function(m,g,v){if(this.rg)return-1;var w=this.ib.Rd.Kn(this.ib.Sh(g));m=m.ka(v);var E=this.ib.Rd.Kn(this.ib.Sh(m));return this.Fm=v,this.JE(g,w,m,E)},u}(f.MC),h=function(c){function u(m){var g=c.call(this,m.g,m.ra)||this;return g.ib=m,g}return Hi(u,c),u.prototype.compare=function(m,g){return this.rg?-1:(m=this.ib.Rd.Kn(this.ib.Sh(m.ka(g))),this.Fm=g,this.KE(g,m))},u}(f.TL),o=function(){function c(){this.Nc=this.df=this.ko=this.Rd=this.mh=this.Ad=this.hb=this.g=null,this.Og=!1,this.wh=this.Pm=this.ie=this.Gk=this.oh=this.Ak=this.Gf=this.ae=null,this.yh=this.Lq=this.OA=this.ra=0,this.Yv=this.Xn=!1,this.zo=new f.h,this.Qi=new f.h,this.hb=new f.ad(8),this.Ad=new f.ad(5),this.mh=new f.bu,this.Rd=new f.bu,this.Og=!1,this.wh=new f.h,this.wh.na(0,0),this.ra=0,this.yh=-1,this.Xn=!1,this.g=null,this.df=new f.Yj,this.Nc=new f.Yj,this.oh=new f.ja(0),this.Gk=new f.LC,this.Gf=new f.ja(0),this.Ak=new f.ja(0),this.ko=new f.Ta}return c.prototype.DX=function(u,m){var g=new f.Ed;return g.TB(),u.Pc(g),this.gr(u),this.Xn=!1,this.ra=m,this.OA=m*m,m=this.cC(),u.Pc(g),m||(this.iQ(),m||this.cC()),this.yh!=-1&&(this.g.Ud(this.yh),this.yh=-1),this.g=null,this.Xn},c.prototype.HX=function(u,m){this.gr(u),this.Xn=!1,this.ra=m,this.OA=m*m,this.Og=!1,this.cC(),this.Og||(this.Og=u.Ip(m,!0,!1)==1),this.yh!=-1&&(this.g.Ud(this.yh),this.yh=-1),this.g=null},c.prototype.pg=function(u,m){return this.hb.U(u,0+m)},c.prototype.FB=function(u,m,g){this.hb.T(u,0+m,g)},c.prototype.Sh=function(u){return this.hb.U(u,2)},c.prototype.MW=function(u,m){this.hb.T(u,2,m)},c.prototype.JF=function(u,m){return this.hb.U(u,3+m)},c.prototype.Rp=function(u){return this.hb.U(u,7)},c.prototype.Rl=function(u,m){this.hb.T(u,7,m)},c.prototype.Tp=function(u,m){return this.hb.U(u,3+this.Qp(u,m))},c.prototype.hr=function(u,m,g){this.hb.T(u,3+this.Qp(u,m),g)},c.prototype.ER=function(u,m){return this.hb.U(u,5+this.Qp(u,m))},c.prototype.jr=function(u,m,g){this.hb.T(u,5+this.Qp(u,m),g)},c.prototype.Tr=function(u){return this.Ad.U(u,0)},c.prototype.IW=function(u,m){this.Ad.T(u,0,m)},c.prototype.$y=function(u){return this.Ad.U(u,4)},c.prototype.er=function(u,m){this.Ad.T(u,4,m)},c.prototype.kl=function(u){return this.Ad.U(u,1)},c.prototype.nn=function(u,m){this.Ad.T(u,1,m)},c.prototype.Zy=function(u){return this.Ad.U(u,3)},c.prototype.Et=function(u,m){this.Ad.T(u,3,m)},c.prototype.$m=function(u){var m=this.Ad.De(),g=this.mh.Qh();return this.IW(m,g),u!=-1?(this.mh.addElement(g,u),this.g.Sa(u,this.yh,m),this.er(m,this.g.Va(u))):this.er(m,-1),m},c.prototype.zP=function(u){this.Ad.kd(u)},c.prototype.CD=function(u,m){this.mh.addElement(this.Tr(u),m),this.g.Sa(m,this.yh,u)},c.prototype.nt=function(u){var m=this.hb.De(),g=this.Rd.Qh();return this.MW(m,g),u!=-1&&this.Rd.addElement(g,u),m},c.prototype.DD=function(u,m){this.Rd.addElement(this.Sh(u),m)},c.prototype.Wu=function(u){this.hb.kd(u),0<=(u=this.oh.dF(u))&&this.oh.IV(u)},c.prototype.ij=function(u,m){if(this.pg(u,0)==-1)this.FB(u,0,m);else{if(this.pg(u,1)!=-1)throw f.i.Ra();this.FB(u,1,m)}this.fy(u,m)},c.prototype.fy=function(u,m){var g=this.kl(m);if(g!=-1){var v=this.Tp(g,m);this.jr(v,m,u),this.hr(u,m,v),this.hr(g,m,u),this.jr(u,m,g)}else this.jr(u,m,u),this.hr(u,m,u),this.nn(m,u)},c.prototype.Qp=function(u,m){return this.pg(u,0)==m?0:1},c.prototype.Zm=function(u,m){var g,v=this.Zy(m);if(v!=-1&&(this.df.wd(v,-1),this.Et(m,-1)),(v=this.kl(m))!=-1){var w=g=v;do{var E=!1,C=this.Qp(g,m),R=this.JF(g,C);if(this.pg(g,C+1&1)==u){if(this.Yu(g),this.Rd.dh(this.Sh(g)),this.Wu(g),g==R){v=-1;break}v==g&&(v=this.kl(m),w=R,E=!0)}g=R}while(g!=w||E);if(v!=-1){do C=this.Qp(g,m),R=this.JF(g,C),this.FB(g,C,u),g=R;while(g!=w);(g=this.kl(u))!=-1?(w=this.Tp(g,u),E=this.Tp(v,u),w==g?(this.nn(u,v),this.fy(g,u),this.nn(u,g)):E==v&&this.fy(v,u),this.hr(v,u,w),this.jr(w,u,v),this.hr(g,u,E),this.jr(E,u,g)):this.nn(u,v)}}for(v=this.Tr(u),g=this.Tr(m),w=this.mh.sc(g);w!=-1;w=this.mh.lb(w))this.g.Sa(this.mh.ka(w),this.yh,u);this.mh.By(v,g),this.zP(m)},c.prototype.KT=function(u,m){var g=this.pg(u,0),v=this.pg(u,1),w=this.pg(m,0),E=this.pg(m,1);this.Rd.By(this.Sh(u),this.Sh(m)),m==this.kl(g)&&this.nn(g,u),m==this.kl(v)&&this.nn(v,u),this.Yu(m),this.Wu(m),g==w&&v==E||v==w&&g==E||(this.In(g,this.zo),this.In(w,this.Qi),this.zo.rb(this.Qi)?(g!=w&&this.Zm(g,w),v!=E&&this.Zm(v,E)):(v!=w&&this.Zm(v,w),g!=E&&this.Zm(g,E)))},c.prototype.Yu=function(u){var m=this.pg(u,1);this.WE(u,this.pg(u,0)),this.WE(u,m)},c.prototype.WE=function(u,m){var g=this.Tp(u,m),v=this.ER(u,m),w=this.kl(m);g!=u?(this.hr(v,m,g),this.jr(g,m,v),w==u&&this.nn(m,g)):this.nn(m,-1)},c.prototype.OD=function(u,m,g){var v=this.Rd.sc(u),w=this.Rd.ka(v);u=this.Ie(w);var E=this.Ie(this.g.V(w));for(this.g.lr(w,m,g,!0),v=this.Rd.lb(v);v!=-1;v=this.Rd.lb(v)){w=this.Rd.ka(v);var C=this.Ie(w)==u;this.g.lr(w,m,g,C)}v=m.Xp(g,0).ac(),m=m.Xp(g,m.ql(g)-1).xc(),this.tK(u,v),this.tK(E,m)},c.prototype.RE=function(u,m,g){var v=this.Sh(u),w=this.pg(u,0),E=this.pg(u,1),C=this.nt(-1);for(this.oh.add(C),this.Rl(C,-3),this.Gf.add(C),this.ij(C,w),u=1,m=m.ql(g);u<m;u++)g=this.$m(-1),this.Ak.add(g),this.Gf.add(g),this.ij(C,g),C=this.nt(-1),this.oh.add(C),this.Rl(C,-3),this.Gf.add(C),this.ij(C,g);for(this.ij(C,E),v=this.Rd.sc(v);v!=-1;v=this.Rd.lb(v))if(E=this.Rd.ka(v),this.Ie(E)==w){u=0;do 0<u&&(C=this.Gf.get(u-1),this.CD(C,E),this.$y(C)==-1&&this.er(C,this.g.Va(E))),C=this.Gf.get(u),u+=2,this.DD(C,E),E=this.g.V(E);while(u<this.Gf.size)}else{u=this.Gf.size-1;do u<this.Gf.size-2&&(C=this.Gf.get(u+1),this.CD(C,E),0>this.$y(C)&&this.er(C,this.g.Va(E))),C=this.Gf.get(u),u-=2,this.DD(C,E),E=this.g.V(E);while(0<=u)}this.Gf.clear(!1)},c.prototype.Ie=function(u){return this.g.Qa(u,this.yh)},c.prototype.KI=function(u,m,g){var v=this.pg(m,0),w=new f.h;this.In(v,w);var E=new f.h,C=this.pg(m,1);this.In(C,E);var R=g.ql(u),I=g.Xp(u,0),F=new f.h;if(I.$p(F),!w.rb(F)){if(!this.Og){var U=w.compare(this.wh);0>U*(F=F.compare(this.wh))&&(this.Og=!0)}this.nF(v,this.Gf),this.Ak.add(v)}for(!this.Og&&1<R&&(U=w.compare(E),I=I.xc(),(w.compare(I)!=U||I.compare(E)!=U||0>I.compare(this.wh))&&(this.Og=!0)),u=(I=g.Xp(u,R-1)).xc(),E.rb(u)||(this.Og||0>(U=E.compare(this.wh))*(F=u.compare(this.wh))&&(this.Og=!0),this.nF(C,this.Gf),this.Ak.add(C)),this.Gf.add(m),E=0,C=this.Gf.size;E<C;E++)u=this.Gf.get(E),g=this.Rp(u),f.ad.DG(g)&&(this.Nc.wd(g,-1),this.Rl(u,-1)),u!=m&&this.Rp(u)!=-3&&(this.oh.add(u),this.Rl(u,-3));this.Gf.clear(!1)},c.prototype.dO=function(u,m){this.ae.compare(this.Nc,this.Nc.ka(u),m),this.ae.rg&&(this.ae.Lr(),this.gF(u,m))},c.prototype.gF=function(u,m){this.Xn=!0,u=this.Nc.ka(u),m=this.Nc.ka(m);var g=this.Rd.Kn(this.Sh(u)),v=this.Rd.Kn(this.Sh(m)),w=this.g.cc(g);w==null&&(this.ie==null&&(this.ie=new f.zb),this.g.fd(g,this.ie),w=this.ie),(g=this.g.cc(v))==null&&(this.Pm==null&&(this.Pm=new f.zb),this.g.fd(v,this.Pm),g=this.Pm),this.Gk.Po(w),this.Gk.Po(g),this.Gk.Fa(this.ra,!0)&&(this.Og=!0),this.$J(u,m,-1,this.Gk),this.Gk.clear()},c.prototype.yQ=function(u,m){this.Xn=!0,m=this.Nc.ka(m);var g=this.Rd.Kn(this.Sh(m)),v=this.g.cc(g);v==null&&(this.ie==null&&(this.ie=new f.zb),this.g.fd(g,this.ie),v=this.ie),g=this.tF(u),this.Gk.Po(v),this.g.Wi(g,this.ko),this.Gk.Fz(this.ra,this.ko,!0),this.$J(m,-1,u,this.Gk),this.Gk.clear()},c.prototype.oS=function(){if(this.oh.size!=0)for(;this.oh.size!=0;){if(this.oh.size>Math.max(100,this.g.gd)){this.oh.clear(!1),this.Og=!0;break}var u=this.oh.Gc();this.oh.Jf(),this.Rl(u,-1),this.MS(u)!=-1&&this.nS(u),this.Wn=!1}},c.prototype.nS=function(u){if(this.Wn){var m=this.Nc.Au(this.EH,this.yH,u,!0);this.Wn=!1}else m=this.Nc.BD(u);m==-1?this.KT(this.Nc.ka(this.Nc.xF()),u):(this.Rl(u,m),this.ae.rg&&(this.ae.Lr(),this.gF(this.ae.Fm,m)))},c.prototype.MS=function(u){var m=this.pg(u,0);if(u=this.pg(u,1),this.In(m,this.zo),this.In(u,this.Qi),f.h.zc(this.zo,this.Qi)<=this.OA)return this.Og=!0,-1;var g=this.zo.compare(this.wh),v=this.Qi.compare(this.wh);return 0>=g&&0<v?u:0>=v&&0<g?m:-1},c.prototype.gQ=function(){var u=new f.ja(0);u.Jb(this.g.gd);for(var m=this.g.$q(),g=m.next();g!=-1;g=m.next())this.g.Qa(g,this.yh)!=-1&&u.add(g);this.g.mx(u,u.size),this.hQ(u)},c.prototype.hQ=function(u){this.df.clear(),this.df.Ee(u.size),this.df.Wo(new N(this.g));var m=new f.h;m.Sc();for(var g=-1,v=new f.h,w=0,E=u.size;w<E;w++){var C=u.get(w);this.g.Hc(C,v),v.rb(m)?(C=this.g.Qa(C,this.yh),this.Zm(g,C)):(g=this.Ie(C),this.g.Hc(C,m),C=this.df.yn(C),this.Et(g,C))}},c.prototype.iQ=function(){var u=new f.ja(0);u.Jb(this.g.gd);for(var m=this.df.sc(-1);m!=-1;m=this.df.lb(m))u.add(this.df.ka(m));this.df.clear(),this.g.mx(u,u.size),m=0;for(var g=u.size;m<g;m++){var v=u.get(m),w=this.Ie(v);v=this.df.yn(v),this.Et(w,v)}},c.prototype.nF=function(u,m){var g=this.kl(u);if(g!=-1){var v=g;do f.ad.DG(this.Rp(v))&&m.add(v),v=this.Tp(v,u);while(v!=g)}},c.prototype.tK=function(u,m){for(u=this.mh.sc(this.Tr(u));u!=-1;u=this.mh.lb(u))this.g.mf(this.mh.ka(u),m)},c.prototype.$J=function(u,m,g,v){this.Yu(u),m!=-1&&this.Yu(m),this.KI(0,u,v),m!=-1&&this.KI(1,m,v),g!=-1&&(v.Cf.D(this.zo),this.In(g,this.Qi),this.Qi.rb(this.zo)||this.Ak.add(g)),g=0;for(var w=this.Ak.size;g<w;g++){var E=this.Ak.get(g),C=this.Zy(E);C!=-1&&(this.df.wd(C,-1),this.Et(E,-1))}for(g=this.Sh(u),w=m!=-1?this.Sh(m):-1,this.OD(g,v,0),m!=-1&&this.OD(w,v,1),this.RE(u,v,0),m!=-1&&this.RE(m,v,1),this.Rd.dh(g),this.Wu(u),m!=-1&&(this.Rd.dh(w),this.Wu(m)),g=0,w=this.Ak.size;g<w;g++)(E=this.Ak.get(g))==this.Lq&&(this.Yv=!0),(C=this.Zy(E))==-1&&((C=this.df.BD(this.tF(E)))==-1?(u=this.Ie(this.df.ka(this.df.xF())),this.Zm(u,E)):this.Et(E,C));this.Ak.clear(!1)},c.prototype.In=function(u,m){this.g.WF(this.$y(u),m)},c.prototype.tF=function(u){return this.mh.Kn(this.Tr(u))},c.prototype.cC=function(){this.Yv=!1,this.Lq=-1,this.ae==null&&(this.Nc.Sv=!1,this.ae=new d(this),this.Nc.$n=this.ae);var u=new f.ja(0),m=null,g=null;this.yH=this.EH=-1,this.Wn=!1;for(var v=this.df.sc(-1);v!=-1;){this.Wn=!1;var w=this.df.ka(v);this.Lq=this.Ie(w),this.g.Hc(w,this.wh),this.ae.SJ(this.wh.y,this.wh.x);var E=this.kl(this.Lq),C=E==-1;if(!C){w=E;do{var R=this.Rp(w);R==-1?(this.oh.add(w),this.Rl(w,-3)):R!=-3&&u.add(R),w=this.Tp(w,this.Lq)}while(w!=E)}if(0<u.size){for(this.Wn=u.size==1&&this.oh.size==1,C=0,E=u.size;C<E;C++)w=this.Nc.ka(u.get(C)),this.Rl(w,-2);var I=-2,F=-2;for(C=0,E=u.size;C<E;C++){if(R=u.get(C),I==-2){var U=this.Nc.xe(R);U!=-1?(w=this.Nc.ka(U),(w=this.Rp(w))!=-2&&(I=U)):I=-1}if(F==-2&&((R=this.Nc.lb(R))!=-1?(w=this.Nc.ka(R),(w=this.Rp(w))!=-2&&(F=R)):F=-1),I!=-2&&F!=-2)break}for(C=0,E=u.size;C<E;C++)R=u.get(C),w=this.Nc.ka(R),this.Nc.wd(R,-1),this.Rl(w,-1);u.clear(!1),this.EH=I!=-1?I:-1,this.yH=F!=-1?F:-1,I!=-1&&F!=-1?this.Wn||this.dO(I,F):I==-1&&F==-1&&(this.Wn=!1)}else C&&(m==null&&(m=new h(this)),m.Eh(this.wh),this.Nc.mJ(m),m.rg&&(m.Lr(),this.yQ(this.Lq,m.Fm)));this.oS(),this.Yv?(this.Yv=!1,g==null&&(g=new T(this.g)),g.Eh(this.wh),v=this.df.mJ(g)):v=this.df.lb(v)}return this.Xn},c.prototype.gr=function(u){for(this.g=u,this.yh=this.g.Hd(),this.hb.Ee(u.gd+32),this.Ad.Ee(u.gd),this.mh.At(u.gd),this.mh.hn(u.gd),this.Rd.At(u.gd+32),this.Rd.hn(u.gd+32),u=this.g.ld;u!=-1;u=this.g.ve(u))if(f.ba.Ic(this.g.jc(u)))for(R=this.g.Ob(u);R!=-1;R=this.g.Sb(R)){var m=this.g.Ka(R),g=this.g.Ya(R),v=this.$m(g),w=this.nt(g);for(this.ij(w,v),I=this.g.V(g),g=0,m-=2;g<m;g++){var E=this.g.V(I),C=this.$m(I);this.ij(w,C),w=this.nt(I),this.ij(w,C),I=E}this.g.ec(R)?(C=this.$m(I),this.ij(w,C),w=this.nt(I),this.ij(w,C),this.ij(w,v)):(C=this.$m(I),this.ij(w,C))}else for(var R=this.g.Ob(u);R!=-1;R=this.g.Sb(R)){var I=this.g.Ya(R);for(v=0,m=this.g.Ka(R);v<m;v++)this.$m(I),I=this.g.V(I)}this.gQ()},c}();f.JC=o}(ae||(ae={})),function(f){var N=function(T){function d(h,o,c){var u=T.call(this)||this;if(h!==void 0)if(c!==void 0){u.description=f.ee.og();var m=new f.Od;m.L(h,o,c),u.XB(m)}else if(o!==void 0)u.description=f.ee.og(),u.Db(h,o);else if(h instanceof f.ua)u.description=h;else if(h instanceof f.h)u.description=f.ee.og(),u.Db(h);else{if(!(h instanceof d))throw f.i.O();u.description=h.description,u.Db(h.Mg(),h.jh()),h.la!==null&&(u.la=h.la.slice(0))}else u.description=f.ee.og();return u}return Hi(d,T),d.prototype.D=function(h){if(h===void 0){if(this.Bc())throw f.i.ga("This operation should not be performed on an empty geometry.");return(h=new f.h).na(this.la[0],this.la[1]),h}if(this.Bc())throw f.i.ga("This operation should not be performed on an empty geometry.");h.na(this.la[0],this.la[1])},d.prototype.Db=function(h,o){typeof h=="number"?(this.wc(),this.la==null&&this.up(),this.la[0]=h,this.la[1]=o):(this.wc(),this.Db(h.x,h.y))},d.prototype.xz=function(){if(this.Bc())throw f.i.ga("This operation should not be performed on an empty geometry.");var h=new f.Od;return h.x=this.la[0],h.y=this.la[1],h.z=this.description.aG()?this.la[2]:f.ua.te(1),h},d.prototype.XB=function(h){this.wc();var o=this.hasAttribute(1);o||f.ua.vG(1,h.z)||(this.se(1),o=!0),this.la==null&&this.up(),this.la[0]=h.x,this.la[1]=h.y,o&&(this.la[2]=h.z)},d.prototype.Mg=function(){if(this.Bc())throw f.i.ga("This operation should not be performed on an empty geometry.");return this.la[0]},d.prototype.WB=function(h){this.setAttribute(0,0,h)},d.prototype.jh=function(){if(this.Bc())throw f.i.ga("This operation should not be performed on an empty geometry.");return this.la[1]},d.prototype.TJ=function(h){this.setAttribute(0,1,h)},d.prototype.TR=function(){return this.Vc(1,0)},d.prototype.kX=function(h){this.setAttribute(1,0,h)},d.prototype.rR=function(){return this.Vc(2,0)},d.prototype.VW=function(h){this.setAttribute(2,0,h)},d.prototype.Fc=function(){return this.qF(3,0)},d.prototype.DJ=function(h){this.setAttribute(3,0,h)},d.prototype.Vc=function(h,o){var c=this.description.Qf(h);return 0<=c?this.la[this.description.$j(c)+o]:f.ua.te(h)},d.prototype.qF=function(h,o){var c=this.description.Qf(h);return 0<=c?this.la[this.description.$j(c)+o]:f.ua.te(h)},d.prototype.setAttribute=function(h,o,c){this.wc();var u=this.description.Qf(h);0>u&&(this.se(h),u=this.description.Qf(h)),this.la==null&&this.up(),this.la[this.description.$j(u)+o]=c},d.prototype.K=function(){return 33},d.prototype.Eb=function(){return 0},d.prototype.Pa=function(){this.wc(),this.la!=null&&(this.la[0]=NaN,this.la[1]=NaN)},d.prototype.un=function(h){if(this.la!=null){for(var o=f.ee.Jw(h,this.description),c=[],u=0,m=0,g=h.Ba;m<g;m++){var v=h.qd(m),w=f.ua.Wa(v);if(o[m]==-1){var E=f.ua.te(v);for(v=0;v<w;v++)c[u]=E,u++}else for(E=this.description.$j(o[m]),v=0;v<w;v++)c[u]=this.la[E],u++,E++}this.la=c}this.description=h},d.prototype.up=function(){this.dJ(this.description.Be.length),d.VD(this.description.Be,this.la,this.description.Be.length),this.la[0]=NaN,this.la[1]=NaN},d.prototype.Pc=function(h){if(h instanceof f.Ed){if(!this.Bc()){var o=this.D();h.Fh(o,o),this.Db(o)}}else this.Bc()||(this.se(1),o=this.xz(),this.XB(h.gp(o)))},d.prototype.copyTo=function(h){if(h.K()!=33)throw f.i.O();h.wc(),this.la==null?(h.Pa(),h.la=null,h.kg(this.description)):(h.kg(this.description),h.dJ(this.description.Be.length),d.VD(this.la,h.la,this.description.Be.length))},d.prototype.Ja=function(){return new d(this.description)},d.prototype.B=function(){return this.Bc()},d.prototype.Bc=function(){return this.la==null||isNaN(this.la[0])||isNaN(this.la[1])},d.prototype.dn=function(h){h.Pa(),this.description!=h.description&&h.kg(this.description),h.$b(this)},d.prototype.A=function(h){this.Bc()?h.Pa():(h.v=this.la[0],h.G=this.la[1],h.C=this.la[0],h.H=this.la[1])},d.prototype.Ro=function(h){if(this.Bc())h.Pa();else{var o=this.xz();h.v=o.x,h.G=o.y,h.Xe=o.z,h.C=o.x,h.H=o.y,h.Dg=o.z}},d.prototype.Ug=function(h,o){var c=new f.Oc;return this.Bc()?(c.Pa(),c):(h=this.Vc(h,o),c.pa=h,c.wa=h,c)},d.prototype.dJ=function(h){if(this.la==null)this.la=f.P.lg(h);else if(this.la.length<h){for(var o=this.la.slice(0),c=this.la.length;c<h;c++)o[c]=0;this.la=o}},d.VD=function(h,o,c){if(0<c)for(c=0;c<h.length;c++)o[c]=h[c]},d.prototype.Nb=function(h){if(h==this)return!0;if(!(h instanceof d)||this.description!=h.description)return!1;if(this.Bc())return!!h.Bc();for(var o=0,c=this.description.Be.length;o<c;o++)if(this.la[o]!=h.la[o])return!1;return!0},d.prototype.dc=function(){var h=this.description.dc();if(!this.Bc())for(var o=0,c=this.description.Be.length;o<c;o++){var u=this.la[o];u=f.P.truncate(u^u>>>32),h=f.P.Uh(u,h)}return h},d.prototype.mg=function(){return null},d}(f.ba);f.Ta=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o){d!==void 0&&(this.x=d,this.y=h,this.z=o)}return T.construct=function(d,h,o){var c=new T;return c.x=d,c.y=h,c.z=o,c},T.prototype.L=function(d,h,o){this.x=d,this.y=h,this.z=o},T.prototype.kx=function(){this.z=this.y=this.x=0},T.prototype.normalize=function(){var d=this.length();d==0&&(this.x/=d,this.y/=d,this.z/=d)},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},T.prototype.sub=function(d){return new T(this.x-d.x,this.y-d.y,this.z-d.z)},T.prototype.Ag=function(d){new T(this.x*d,this.y*d,this.z*d)},T.prototype.Rh=function(d){return this.x*d.x+this.y*d.y+this.z*d.z},T}();f.Od=N}(ae||(ae={})),function(f){var N=function(){function T(d,h,o){this.Hw=this.xA=null,this.Yf=h,this.vT=h.y-o,this.uT=h.y+o,this.Fw=0,this.Zz=d,this.ra=o,this.HT=o*o,this.$z=o!=0,this.Mv=!1}return T.prototype.result=function(){return this.Fw!=0?1:0},T.prototype.RM=function(d){return d=d.ic(d.fe(this.Yf,!1)),f.h.zc(d,this.Yf)<=this.HT},T.prototype.YE=function(d){if(!this.$z&&(this.Zz&&this.Yf.rb(d.ac())||this.Yf.rb(d.xc())))this.Mv=!0;else if(d.oa==this.Yf.y&&d.oa==d.ma){if(this.Zz&&!this.$z){var h=Math.max(d.sa,d.qa);this.Yf.x>Math.min(d.sa,d.qa)&&this.Yf.x<h&&(this.Mv=!0)}}else{var o=!1;if(h=Math.max(d.sa,d.qa),this.Yf.x>h?o=!0:this.Yf.x>=Math.min(d.sa,d.qa)&&(o=0<d.fq(!0,this.Yf.y,this.Hw,null)&&this.Hw[0]<=this.Yf.x),o){if(this.Yf.y==d.ac().y){if(this.Yf.y<d.xc().y)return}else if(this.Yf.y==d.xc().y&&this.Yf.y<d.ac().y)return;this.Fw=this.Zz?1^this.Fw:this.Fw+(d.ac().y>d.xc().y?1:-1)}}},T.prototype.JI=function(d){var h=d.Ug(0,1);if(h.pa>this.uT||h.wa<this.vT)return!1;if(this.$z&&this.RM(d))return!0;if(h.pa>this.Yf.y||h.wa<this.Yf.y)return!1;if(this.xA==null&&(this.xA=[null,null,null,null,null]),this.Hw==null&&(this.Hw=[0,0,0]),0<(h=d.XF()))for(d=0;d<h;d++){var o=this.xA[d].get();if(this.YE(o),this.Mv)return!0}else if(this.YE(d),this.Mv)return!0;return!1},T.HM=function(d,h,o){for(h=new T(d.Jn()==0,h,o),d=d.Ha();d.ab();)for(;d.Ia();)if(o=d.ia(),h.JI(o))return-1;return h.result()},T.IM=function(d,h,o,c){var u=new f.l;d.yc(u),u.X(c,c);var m=new T(d.Jn()==0,o,c);d=d.Ha();var g=new f.l;for(g.L(u),g.C=o.x+c,g.G=o.y-c,g.H=o.y+c,c=(o=h.EF(g,c)).next();c!=-1;c=o.next())if(d.Wb(h.ka(c)),d.Ia()&&(c=d.ia(),m.JI(c)))return-1;return m.result()},T.ym=function(d,h,o){if(d.B())return 0;var c=new f.l;if(d.yc(c),c.X(o,o),!c.contains(h))return 0;if((c=d.Cb)!=null){var u=c.Fk;if(u!=null){if((u=u.To(h.x,h.y))==1)return 1;if(u==0)return 0}if((c=c.Gb)!=null)return T.IM(d,c,h,o)}return T.HM(d,h,o)},T.SS=function(d,h,o){return h.B()?0:T.ym(d,h.D(),o)},T.Ol=function(d,h){return!(16>(d=d.I()))&&2*d+Math.log(d)/Math.log(2)*h<1*d*h},T}();f.Fg=N}(ae||(ae={})),function(f){var N=function(T){function d(h){return T.call(this,!0,h)||this}return Hi(d,T),d.prototype.Ja=function(){return new d(this.description)},d.prototype.Eb=function(){return 2},d.prototype.K=function(){return 1736},d.prototype.pG=function(h,o,c){this.AS(h,o,c)},d.prototype.hR=function(){this.xR()},d}(f.Vk);f.Ea=N}(ae||(ae={})),function(f){(function(N){N[N.PiPOutside=0]="PiPOutside",N[N.PiPInside=1]="PiPInside",N[N.PiPBoundary=2]="PiPBoundary"})(f.JL||(f.JL={})),f.jd=function(){function N(){}return N.CG=function(T,d,h){return(T=f.Fg.SS(T,d,h))==0?0:T==1?1:2},N.Zd=function(T,d,h){return(T=f.Fg.ym(T,d,h))==0?0:T==1?1:2},N.KX=function(T,d,h,o,c){if(d.length<h||c.length<h)throw f.i.O();for(var u=0;u<h;u++)c[u]=N.Zd(T,d[u],o)},N.kK=function(T,d,h,o,c){if(T.K()==1736)N.KX(T,d,h,o,c);else{if(T.K()!=197)throw f.i.ga("invalid_call");var u=new f.l;T.A(u),N.SM(u,d,h,o,c)}},N.SM=function(T,d,h,o,c){if(d.length<h||c.length<h)throw f.i.O();if(T.B())for(o=0;o<h;o++)c[o]=0;else for(T.X(.5*-o,.5*-o),T.X(.5*o,.5*o),o=0;o<h;o++)T.contains(d[o])?c[o]=1:T.contains(d[o])?c[o]=2:c[o]=0},N.MX=function(T,d,h,o,c){for(var u=0;u<h;u++)c[u]=T.rs(d[u],o)?2:0},N.LX=function(T,d,h,o,c){var u=T.Cb,m=null;u!=null&&(m=u.Fk),u=h;for(var g=0;g<h;g++)if(c[g]=1,m!=null){var v=d[g];m.To(v.x,v.y)==0&&(c[g]=0,u--)}if(u!=0)for(T=T.Ha();T.ab()&&u!=0;)for(;T.Ia()&&u!=0;)for(m=T.ia(),g=0;g<h&&u!=0;g++)c[g]==1&&m.rs(d[g],o)&&(c[g]=2,u--);for(g=0;g<h;g++)c[g]==1&&(c[g]=0)},N.lK=function(T,d,h,o,c){var u=T.K();if(u==1607)N.LX(T,d,h,o,c);else{if(!f.ba.zd(u))throw f.i.ga("Invalid call.");N.MX(T,d,h,o,c)}},N}()}(ae||(ae={})),function(f){var N=function(T){function d(h,o){if(arguments.length==2){var c=T.call(this,!1,h.description)||this;c.nf(h),c.lineTo(o)}else c=T.call(this,!1,h)||this;return c}return Hi(d,T),d.prototype.Ja=function(){return new d(this.description)},d.prototype.Eb=function(){return 1},d.prototype.K=function(){return 1607},d.prototype.pG=function(h,o,c){this.BS(h,o,c)},d}(f.Vk);f.Ua=N}(ae||(ae={})),function(f){var N=function(){function T(){}return T.prototype.progress=function(){return!0},T.Bp=function(d){if(d!=null&&!d.progress(-1,-1))throw f.i.OC()},T}();f.np=N}(ae||(ae={})),function(f){var N;(N=f.HK||(f.HK={}))[N.clipWithInputHorizon=1]="clipWithInputHorizon",N[N.clipWithOutputHorizon=2]="clipWithOutputHorizon";var T=function(){function o(){this.gl=3,this.Gy=this.Lu=NaN}return o.prototype.ZR=function(){return this.js(1)},o.prototype.$R=function(){return this.js(2)},o.prototype.js=function(c){return(this.gl&c)!=0},o.prototype.Pf=function(){var c=new o;return c.Lu=this.Lu,c.Gy=this.Gy,c.gl=this.gl,c},o}();f.oY=T,function(o){o[o.Dont_Geonomalize_Polygon=2147483648]="Dont_Geonomalize_Polygon",o[o.Dont_Adjust_At_Poles=1073741824]="Dont_Adjust_At_Poles"}(f.IK||(f.IK={}));var d=function(){function o(){this.gl=0}return o.prototype.js=function(c){return(this.gl&c)!=0},o.ig=function(c){var u=new o;return u.gl=c.gl,u},o.prototype.eM=function(c){this.gl=c.gl},o}();f.pY=d;var h=function(){function o(c,u,m){this.ef=c,this.Zf=u,this.Vf=new f.l,this.Vf.L(m),this.qT=c.dc()+u.dc()+this.Vf.dc().toString()}return o.prototype.dc=function(){return this.qT},o.prototype.Nb=function(c){return this==c||this.ef.Nb(c.ef)&&this.Zf.Nb(c.Zf)&&this.Vf.Nb(c.Vf)},o}();f.uY=h,h=function(){function o(){this.Zf=this.ef=null,this.jH=new T,this.kH=new d,this.xw=this.Xf=null,this.nw=this.Un=!0}return o.Or=function(c,u,m,g){var v;g===void 0&&(g=null),v===void 0&&(v=null);var w=new o;return w.rp(c,u,m,g,v),w},o.prototype.rp=function(c,u,m,g,v){if(c==null||u==null)throw f.i.ga("invalidArgument");if(this.ef=c,this.Zf=u,this.nw=this.Un=!1,g!=null&&(this.jH=g.Pf()),v!=null&&this.kH.eM(v),v=!1,u.Tb()==1&&g!=null&&(g=g.Lu,isNaN(g)||g==0||(v=!0)),c==u)this.Un=!v,this.nw=!0;else{g=c.Tb();var w=u.Tb();if(g==0||w==0){if(m!=null)throw f.i.O();c.Id()!=null&&u.Id()!=null&&(this.Un=c.Id().Nb(u.Id()))}else g==3||w==3?this.Un=c.Nb(u):this.ef.bS(this.Zf)?this.Un=!v:this.Un=!1,this.Xf=m,this.Xf!=null&&this.Xf.hx(),this.nw=(this.Xf==null||this.Xf.count()==0)&&this.ef.tc().Nb(this.Zf.tc())}this.cY()},o.prototype.isIdentity=function(){return this.Un},o.prototype.fR=function(){return this.jH.Pf()},o.prototype.Nb=function(c){return c==this||!!(c instanceof o&&this.ef.Nb(c.ef)&&this.Zf.Nb(c.Zf))&&(this.Xf==c.Xf||!(this.Xf==null||c.Xf==null||!this.Xf.Nb(c.Xf)))},o.prototype.cY=function(){this.xw=new f.cu(this)},o}(),f.xr=h}(ae||(ae={})),function(f){var N=function(){function T(){}return T.Ep=function(d){return d*T.eW},T.lx=function(d,h){return T.ZO(h-d)},T.$O=function(d){return-360<=d&&720>d?(0>d?d+=360:360<=d&&(d-=360),d):(0>(d=f.mc.JK(d))&&(d+=360),d)},T.ZO=function(d){return 180<(d=T.$O(d))&&(d-=360),d},T.eW=57.29577951308232,T}();f.sr=N,f.Ih=function(){function T(){}return T.mj=function(d,h){var o=new f.l;d.A(o);var c=f.cb.hh(h),u=new f.l;return u.L(c),u.v=o.v,u.C=o.C,u.X(.01*u.da(),0),h=f.ta.Xd(h,o,!1),u.contains(o)?d:f.Vd.clip(d,u,h,0)},T.ls=function(d,h,o,c,u){if(!f.cb.Xc(h))throw f.i.O();var m=f.ta.lj(h,d,!1),g=f.cb.hh(h),v=f.cb.tc(h),w=v.Id().bi,E=f.cb.wv(v);v=f.cb.fv(v),E*=2-E;var C=new f.Oc;g.en(C);var R=[[0,0],[0,0]];if(f.Gg.Tb(h)==2?c?(R[0][0]=T.an(u,C),R[0][1]=g.Lp(),f.cb.vt(),g=R[0][0]*w):(R[0][0]=g.gk(),R[0][1]=u,f.cb.vt(),g=R[0][1]*w):g=u*w,!c&&g!=0)throw f.i.O();var I=new f.ha,F=new f.hd;d=F.Ib(d);for(var U=[0],j=new f.h,ee=new f.h,te=new f.h,Z=new f.h,le=new f.h,ve=new f.h,be=F.Ob(d);be!=-1;be=F.Sb(be)){var ue=F.Ya(be);F.D(ue,te);for(var Le=!1,Be=ue=F.V(ue);Be!=-1;Be=F.V(Be)){if(Be==ue){if(Le)break;Le=!0}if(F.D(Be,Z),c&&m<u-te.x&&Z.x-u>m||m<u-Z.x&&te.x-u>m||!c&&m<-te.y&&Z.y>m||m<-Z.y&&te.y>m)do if(!(Math.abs(te.x-Z.x)>=.5*C.S())){if(f.Gg.Tb(h)==2?(R[0][0]=T.an(te.x,C),R[0][1]=te.y,R[1][0]=T.an(Z.x,C),R[1][1]=Z.y,f.cb.UV(),le.x=R[0][0]*w,le.y=R[0][1]*w,ve.x=R[1][0]*w,ve.y=R[1][1]*w):(le.x=te.x*w,le.y=te.y*w,ve.x=Z.x*w,ve.y=Z.y*w),ve.x=6.283185307179586*(Z.x-te.x)/C.S()+le.x,c){if(ee.x=g,ee.y=T.Iz(v,E,le,ve,g,o),isNaN(ee.y))break}else{if(ee.x=T.Gz(v,E,le,ve,o),isNaN(ee.x))break;ee.y=0}f.kb.xd(v,E,le.x,le.y,ve.x,ve.y,I,null,null,o);var it=I.u;f.kb.xd(v,E,le.x,le.y,ee.x,ee.y,I,null,null,o);var Ke=I.u;f.Gg.Tb(h)==2?(R[0][0]=ee.x/w,R[0][1]=ee.y/w,f.cb.UQ(),c?(j.y=R[0][1],j.x=u):(j.x=T.ps(R[0][0],te.x,Z.x,C),j.y=u)):c?(j.x=u,j.y=ee.y/w):(j.x=T.ps(ee.x/w,te.x,Z.x,C),j.y=u),U[0]=0<it?f.P.Rk(Ke/it,0,1):.5,U[0]!=0&&U[0]!=1&&(it=F.Na(Be),F.Wl(it,U,1),F.Db(F.V(it),j.x,j.y))}while(0);te.N(Z)}}return F.Ke(d)},T.Gn=function(d,h,o,c,u){if(d.B())return d;var m=f.cb.bf(h);return T.Jp(d,o-180*m,360*m,h,c,u,!0)},T.Iz=function(d,h,o,c,u,m){if(3.141592653589793<=Math.abs(o.x-c.x)||!T.Tn(o.x,c.x,u))return NaN;if(o.x>c.x)var g=c;else g=o,o=c;c=new f.ha(0);var v=new f.ha(0),w=new f.ha(0);f.kb.xd(d,h,g.x,g.y,o.x,o.y,v,c,null,m);var E=v.u,C=0,R=1,I=new f.h;for(I.N(g);E*(R-C)>1e-12*d;){var F=.5*(C+R);if(f.kb.pj(d,h,g.x,g.y,E*F,c.u,v,w,m),I.x=v.u,I.y=w.u,I.x==u)break;if(T.Tn(g.x,I.x,u))R=F;else{if(!T.Tn(o.x,I.x,u))return NaN;C=F}}return I.y},T.Tn=function(d,h,o){return d=N.Ep(d),h=N.lx(d,N.Ep(h)),(o=N.lx(d,N.Ep(o)))==0||0<h&&0<o&&o<=h||0>h&&0>o&&o>=h},T.an=function(d,h){var o=h.wa-h.pa;return h.Jt(d-Math.floor((d-h.pa)/o)*o)},T.ps=function(d,h,o,c){var u=new f.Oc;for(u.L(h,o),o=c.S(),d=Math.floor((d-h)/o)*o+d,u=u.tf();Math.abs(d-u)>Math.abs(d+o-u);)d+=o;return d},T.Gz=function(d,h,o,c,u){if(o.y>c.y)var m=c;else m=o,o=c;if((c=new f.Oc).L(m.y,o.y),!c.contains(0)||3.141592653589793<=Math.abs(m.x-o.x))return NaN;if(m.x==o.x)return m.x;var g=new f.ha(0),v=new f.ha(0),w=new f.ha(0);f.kb.xd(d,h,m.x,m.y,o.x,o.y,v,g,null,u);var E=v.u,C=0,R=1,I=new f.h;for(I.N(m);E*(R-C)>1e-12*d;){var F=.5*(C+R);if(f.kb.pj(d,h,m.x,m.y,E*F,g.u,v,w,u),I.x=v.u,I.y=w.u,c.L(m.y,I.y),I.y==0)break;if(c.contains(0))R=F;else{if(c.L(o.y,I.y),!c.contains(0))return NaN;C=F}}return I.x},T.Jp=function(d,h,o,c,u,m,g){var v=new f.l;if(d.A(v),v.B())return d;var w=new f.Oc;v.en(w);var E=new f.Oc;if(E.L(h,h+o),E.contains(w)&&E.wa!=w.wa)return d;var C=new f.l;C.L(v);var R=d.K();if(R==33)return((v=(C=u?d:d.Pf()).Mg())<E.pa||v>=E.wa||g&&v==E.wa)&&(v+=Math.ceil((E.pa-v)/o)*o,v=E.Jt(v),C.WB(v)),C;if(R==550){for(c=(C=u?d:d.Pf()).vb(0),R=2*C.I(),d=!1,u=0;u<R;u+=2)((v=c.read(u))<E.pa||v>=E.wa||g&&v==E.wa)&&(d=!0,v+=Math.ceil((E.pa-v)/o)*o,v=E.Jt(v),c.write(u,v));return d&&C.Qc(1993),C}if(E.contains(w))return d;if(R==197)return o=u?d:d.Pf(),v.Fa(C),o.Yo(v),o;var I=.1*Math.max(v.da(),v.S());for(C.X(0,I),g=d,E=c.Yd(0),d=f.Hh.local(),u=new f.Ed;;){var F=Math.floor((w.pa-h)/o),U=Math.ceil((w.wa-h)/o);if(!(3<U-F))break;F=Math.floor(.5*(U+F)),C.v=v.v-I,C.C=h+o*F;var j=f.Vd.clip(g,C,E,m);C.v=C.C,C.C=v.C+I;var ee=f.Vd.clip(g,C,E,m);u.gg((F-U)*o,0),ee.Pc(u),R==1736?g=d.W(j,ee,c,null):(g=j).add(ee,!1),g.A(v),v.en(w)}for(C.v=h,C.C=h+o,(h=new f.l).L(C),h.X(E,0),(h=Math.floor((v.v-C.v)/o)*o)!=0?(C.move(h,0),u.gg(-h,0)):u.KB(),h=R==1607?new f.Ua(g.description):new f.Ea(g.description),m=new f.l,w=new f.l;v.C>C.v;)(I=f.Vd.clip(g,C,E,0)).A(w),(R==1607?!I.B()&&(w.S()>E||w.da()>E):!I.B()&&(R!=1736||w.S()>E))&&(I.Pc(u),I.A(w),h.A(m),m.X(E,E),m.isIntersecting(w)&&R==1736?h=d.W(h,I,c,null):h.add(I,!1)),C.move(o,0),u.shift(-o,0);return h},T.NI=function(d,h,o,c){var u=new f.de(o.description);u.Gd(o,0,-1),u=f.cb.Ah(u,d,h);var m=o.I();if(c.Pa(),!f.cb.Xc(d)||m!=u.I())return!1;var g=new f.l;o.A(g);var v=new f.l;if(u.A(v),g=g.S(),v=v.S(),g!=0&&v!=0){if(v/=g,d=f.cb.hh(h).S()/f.cb.hh(d).S(),1e-10<Math.abs(v/d-1))return!1}else if(g!=0||v!=0)return!1;for(c.add(o,!1),o=0;o<m;o++)d=u.Oa(o),c.Db(o,d);return!0},T.Jz=function(){throw f.i.Fe()},T}()}(ae||(ae={})),function(f){var N,T,d;(T=N=f.ti||(f.ti={}))[T.Clip=0]="Clip",T[T.DontClip=1]="DontClip",T[T.PannableFold=2]="PannableFold",function(h){h[h.Geodesic=0]="Geodesic",h[h.Loxodrome=1]="Loxodrome",h[h.GreatElliptic=2]="GreatElliptic",h[h.NormalSection=3]="NormalSection",h[h.ShapePreserving=4]="ShapePreserving"}(d=f.OK||(f.OK={})),f.Ab=function(){function h(){}return h.yv=function(o,c,u){if(u||0<c){for(o=o.toString(f.Tc.PE_STR_NAME_CANON|f.Tc.PE_STR_AUTH_NONE),c=[],u=0;u<o.length;u++)c[u]="a"<=o[u]&&"z">=o[u]?c[u]=o[u].toUpperCase():o[u];return c.join()}return o.toString(f.Tc.PE_STR_AUTH_TOP)},h.wr=function(o,c,u,m){var g=m.length,v=u.I();if(v!=0){var w=u.vb(0),E=Math.min(v,g),C=0,R=o.fh();isNaN(c)&&(c=0);for(var I=o.Xc(),F=179*(o=I?o.tc().Le().S():0)/360;0<v;){if(w.oB(C<<1,E,m),f.fj.projToGeogCenter(R,E,m,c),I)for(var U=0;U<E;U++){var j=m[U][0]-c,ee=f.mc.sign(j),te=w.read(2*(C+U));0>ee*f.mc.sign(te)&&Math.abs(j)>F&&(m[U][0]+=-ee*o)}w.nC(C<<1,E,m),C+=E,v-=E,E=Math.min(v,g)}u.Qc(1993)}},h.AL=function(o,c,u,m){var g=0,v=o.fh();isNaN(g)&&(g=0);var w=o.Xc(),E=o.bf();o=360*E,E*=179;for(var C=m.length,R=0;R<u;){for(var I=R;I<u&&c[I].isNaN();++I)R++;var F=Math.min(C,u-R);if(0<F){I=1;for(var U=R+1;I<F;++I,++U)if(c[U].isNaN()){F=I;break}if(f.ta.Dy(m,c,R,F),f.fj.projToGeogCenter(v,F,m,g),w)for(I=0,U=R;I<F;++I,++U){var j=c[U].x,ee=m[I][0]-g,te=f.mc.sign(ee);0>te*f.mc.sign(j)&&Math.abs(ee)>E&&(m[I][0]-=te*o)}f.ta.Cy(c,R,m,F),R+=F}}},h.Jx=function(o,c,u){var m=u.length,g=c.I();if(!(1>g)){var v=c.vb(0),w=Math.min(g,m),E=0,C=o.fh(),R=o.Xc(),I=R?o.Le().S():0,F=179*I/360,U=0;for(R&&(U=o.Ai());0<g;){if(v.oB(E<<1,w,u),f.fj.geogToProj(C,w,u),R)for(o=0;o<w;o++){var j=u[o][0],ee=f.mc.sign(j),te=v.read(2*(E+o))-U;0>ee*f.mc.sign(te)&&Math.abs(j)>F&&(u[o][0]+=-ee*I)}v.nC(E<<1,w,u),E+=w,g-=w,w=Math.min(g,m)}c.Qc(1993)}},h.zL=function(o,c,u,m){if(u!=0){var g=o.fh(),v=o.Xc(),w=v?o.Le().S():0,E=179*w/360,C=0;for(v&&(C=o.Ai()),o=0;o<u;){for(var R=o;R<u&&c[R].isNaN();++R)o++;var I=Math.min(m.length,u-o);if(0<I){R=1;for(var F=o+1;R<I;++R,++F)if(c[F].isNaN()){I=R;break}if(f.ta.Dy(m,c,o,I),f.fj.geogToProj(g,I,m),v)for(R=0,F=o;R<I;R++){var U=m[R][0],j=f.mc.sign(U);0>j*f.mc.sign(c[F].x-C)&&Math.abs(U)>E&&(m[R][0]-=j*w)}f.ta.Cy(c,o,m,I),o+=I}}}},h.vr=function(o,c,u,m){var g=c.I();if(g!=0){var v=c.vb(0),w=o.ef,E=o.Zf,C=w.tc().Sp(),R=E.tc().Sp(),I=w.bf(),F=E.bf();if((o=o.Xf)==null||o.count()==0){for(u=C/R,m=(w.Wp()-E.Wp())*F,R=-90*I,o=90*I,C=!1,F=1,w=2*g;F<w;)I=v.get(F),(E=f.P.Rk(I,R,o))!=I&&(v.set(F,E),C=!0),F+=2;if(m!=0||u!=1)for(C=!0,R=new f.h,F=0;F<g;F++)v.uc(2*F,R),R.x*=u,R.x+=m,R.y*=u,v.Ut(2*F,R);C&&c.Qc(1993)}else{w=m.length,E=Math.min(g,w);var U=f.P.lg(E),j=null,ee=0,te=NaN,Z=NaN,le=360*F,ve=F/I;u&&(Z=90*F,te=89.9*I,j=f.P.lg(E));for(var be=!0,ue=0;g!=0;){for(I=!1,v.oB(ee<<1,E,m),F=0;F<E;F++)U[F]=m[F][0];if(u)for(F=0;F<E;F++){var Le=Math.abs(m[F][1])-te;0<Le&&(I=m[F][1],m[F][1]=f.mc.Dn(te,I),j[F]=f.mc.Dn(Le,I),I=!0)}for(F=m[0][0],o.transform(m,E,C,R),be&&(ue=m[0][0]-ve*F,be=!1),F=0;F<E;F++)Le=m[F][0]-U[F]*ve-ue,200<Math.abs(Le)&&(m[F][0]=0<Le?m[F][0]-le:m[F][0]+le);if(I){for(F=0;F<E;F++)j[F]!=0&&(m[F][1]+=ve*j[F],m[F][1]>Z?m[F][1]=Z:m[F][1]<-Z&&(m[F][1]=-Z));for(I=0;I<E;I++)j[I]=0}v.nC(ee<<1,E,m),ee+=E,g-=E,E=Math.min(g,w)}c.Qc(1993)}}},h.yL=function(o,c,u,m){if(o.nw)m=90*o.ef.bf(),f.ta.WJ(c,u,-m,m);else{var g=o.Xf,v=o.ef,w=o.Zf;o=v.Yr();var E=w.Yr(),C=v.bf(),R=90*C,I=w.bf();if(g==null||g.count()==0){if(m=o/E,g=(v.Wp()-w.Wp())*I,f.ta.WJ(c,u,-R,R),g!=0||m!=1)for(I=0;I<u;I++)c[I].x*=m,c[I].x+=g,c[I].y*=m}else{v=Math.min(u,m.length),R=f.P.lg(v),w=360*I,C=I/C;for(var F=!0,U=0,j=0;u!=0;){for(I=0;I<v;I++)R[I]=c[I+j].x;for(I=c[0].x,f.ta.Dy(m,c,j,v),g.transform(m,v,o,E),f.ta.Cy(c,j,m,v),F&&(U=c[0].x-C*I,F=!1),I=0;I<v;I++){var ee=c[j+I].x-R[I]*C-U;200<Math.abs(ee)&&(c[j+I].x=0<ee?c[j+I].x-w:c[j+I].x+w)}j+=v,u-=v,v=Math.min(u,m.length)}}}},h.ev=function(o,c){return o=o.hh(),isNaN(c)||o.Ku(c,0),o},h.MQ=function(o,c,u,m,g,v,w,E){for(var C=h.ev(m,g),R=C.S(),I=R/360,F=h.hE*I,U=o.vb(0),j=c.Xc(),ee=j?R/c.Le().S():0,te=!1,Z=new f.Ea(u.description),le=0,ve=u.ea();le<ve;++le){var be=j,ue=new f.Ua(u.description);if(ue.addPath(u,le,!0),w!=0){var Le=h.GD(!0,ue,C.H-E,C.H,w);(te=te||Le)&&(be=!1)}var Be=-1;be&&(Be=o.Ca(le));var it=ue.vb(0),Ke=ue.I(),Je=0,pt=it.read(0),qt=0;Le=3*m.Yd(0);var ri=!1,Ji=new f.h;Ji.Sc();var Zi=new f.h;Zi.Sc();for(var an=!1,Br=1;Br<Ke;++Br){var Rt=f.h.construct(it.Bg(2*Br),it.Bg(2*Br+1)),gr=Rt.x,Ri=gr+Je,Ps=Ri-pt;if(Rt.x=Ri,Math.abs(Ps)>F){if(be){var rs=Be+(Br+1<Ke?Br:0),Js=U.read(2*(Be+Br-1));rs=(U.read(2*rs)-Js)*ee,Math.abs(Ps-rs)>1*I&&(be=!1)}be||(Ri=gr+(Je-=f.mc.Dn(R,Ri-pt)),++qt,an=Je!=0,Rt.x=Ri)}else ri||f.ta.sG(Zi,Ji,Rt,Le)&&(ri=!0);an&&it.write(2*Br,Ri),pt=Ri,Zi.N(Ji),Ji.N(Rt)}0<qt&&ue.Qc(1993),be=ue.Oa(0),Ke=ue.Oa(Ke-1),ue=f.h.ub(be,Ke)<Le?h.mQ(ue,m,g,v,ri):h.nQ(o,le,ue,m,g),Z.add(ue,!1)}return g=m.Yd(0),u=C.S()/180,h.Kt(Z,C,.1*g,!1),Z=Z!=(g=f.si.clip(Z,C,g,u,v)),o=o.He(),w=0,0<(E=g.He())&&0>o?w=1:0>=E&&0<o&&(E==0?(E=NaN,c.Tb()==2?E=c.ol().He():c.Tb()==1&&(E=c.Le().oF()),o>.99*E&&(w=-1)):w=-1),w!=0&&((c=new f.Ea(g.description)).vp(C),(c=f.Zl.local().W(c,u,v)).add(g,!1),Z=!0,g=c),Z&&(g=f.$l.local().W(g,m,!1,v)),g},h.nQ=function(o,c,u,m,g){var v=u.I(),w=u.Oa(0),E=u.Oa(v-1);g=(m=h.ev(m,g)).S(),w=f.mc.sign(E.x-w.x);var C=new f.l;u.yc(C);var R=m.gk();if(E=R-g,R+=g,0<=w){var I=Math.ceil((E-C.v)/g);for(I*=g;E>C.v+I;)I+=g;for(;E<C.C+I;)I-=g;var F=I;720<C.S()&&(R=E+360*Math.ceil(C.S()/360))}else{for(I=Math.ceil((R-C.C)/g),I*=g;R<C.C+I;)I-=g;for(;R>C.v+I;)I+=g;F=I,720<C.S()&&(E=R-360*Math.ceil(C.S()/360))}I=w*g;var U=f.l.construct(C.v,C.G,C.C,C.H);U.move(F,0);var j=new f.Ed;j.gg(F,0),u.Pc(j),(C=new f.Ua(u.description)).add(u,!1),F=u.Oa(v-1),g=0;for(var ee=C.Oa(0).x;0<w?U.C<R:U.v>E;)U.move(I,0),j.Lb=I,u.Pc(j),ee+=I,m.v<=ee&&m.C>=ee&&(g=C.I()-1),u.Db(0,F),F=u.Oa(v-1),C.Fr(u,0,0,v-1,!1);return u=new f.Ea(C.description),v=0<o.Kr(c),u.add(C,!1),o=C.Oa(0),E=C.Oa(C.I()-1),c=u.ea()-1,(0>w?v:!v)?(w=f.h.construct(E.x,m.H),u.Di(w),w=f.h.construct(m.gk(),m.H),u.Di(w),m=f.h.construct(o.x,m.H)):(w=f.h.construct(E.x,m.G),u.Di(w),w=f.h.construct(m.gk(),m.G),u.Di(w),m=f.h.construct(o.x,m.G)),u.Di(m),u.pG(0,c,0),u.cO(g),u},h.mQ=function(o,c,u,m,g){var v=new f.Ea(o.description);v.add(o,!1),v.xB(0,v.I()-1);var w=new f.l;v.yc(w);var E=(u=h.ev(c,u)).S(),C=Math.ceil((u.v-w.v)/E);for(C*=E;u.v>w.v+C;)C+=E;for(;u.v<w.C+C;)C-=E;if((C+=E)!=0){w.move(C,0);var R=new f.Ed;R.gg(C,0),v.Pc(R)}if(u.v<=w.v&&u.C>w.C)return g&&(g=v.He(),c=(v=f.$l.local().W(v,c,!0,m)).He(),(c=f.mc.sign(g)!=f.mc.sign(c))&&v.gJ()),v;for((o=new f.Ea(o.description)).add(v,!1),g=g||w.S()>E-c.Yd(0);w.v<u.C;)w.move(E,0),(R=new f.Ed).gg(E,0),v.Pc(R),o.add(v,!1);return g&&(g=o.He(),o.Zo(1),c=(o=f.$l.local().W(o,c,!0,m)).He(),(c=f.mc.sign(g)!=f.mc.sign(c))&&o.gJ()),o},h.GD=function(o,c,u,m,g){for(var v=c.vb(0),w=c.I(),E=!1,C=0;C<w;C++){var R=f.h.construct(v.Bg(2*C),v.Bg(2*C+1));if((1&g)!=0&&R.y>=u){E=!0;break}if((2&g)!=0&&R.y<=-u){E=!0;break}}if(!E)return!1;v=!1,o&&(v=c.On(0)),w=(o=new f.hd).Ib(c),E=o.Ob(w);var I=-1,F=!0,U=new f.h;U.Sc(),C=new f.Ta;for(var j=-1,ee=o.Ya(E);ee!=-1;ee=o.V(ee)){R=o.Oa(ee);var te=(1&g)!=0&&90<=R.y?1:0;if(te|=(2&g)!=0&&R.y<=-u?2:0,0<I&&I!=te){if(U.x!=R.x){U.x=R.x,o.Wi(o.Na(ee),C);var Z=o.xj(E,ee,C);o.mf(Z,U)}if(v)for(j=j!=-1?o.V(j):o.Ya(E),Z=o.Na(ee);j!=Z;)j=o.pd(j,!1);j=-1}0<te&&(R.y=f.mc.Dn(m,R.y),o.mf(ee,R),F||I==te||(R.x!=U.x?(o.Wi(ee,C),Z=o.xj(E,ee,C),o.Db(Z,U.x,R.y),j=Z):j=ee)),I=te,U=R,F=!1}if(v){if(j!=-1)for(j=o.V(j);j!=-1;)j=o.pd(j,!1);u=o.Ya(E),o.hq(u,o.sj(E))||(o.Wi(u,C),o.xj(E,-1,C))}return o.Ke(w).copyTo(c),!0},h.Hz=function(o,c,u,m){var g=o;if(g.B()||u==N.DontClip)return g;var v=g.K();if(v==33)return g=[(m=g).D()],h.qG(g,1,c,u),g[0].isNaN()?m.Pa():m.Db(g[0]),o;var w=(o=c.tc()).bf(),E=90*w,C=180*w,R=360*w,I=c.Ai(),F=.5*w,U=new f.l;g.A(U);var j=c.Wr(),ee=c.HQ(),te=j.K()==197;if(c=new f.l,j.A(c),u==N.PannableFold&&(u=o.Le().S(),c.v=I-.5*u,c.C=c.v+u),U.G<-E||U.H>E){if(new f.l().L(U.v-w,-E,U.C+w,E),(g=f.si.Pu(g,c,o,NaN,0,m)).B())return g;g.A(U)}if(ee&&(c.H<U.G||c.G>U.H))return g.Ja();if(U.S()>R&&(g=h.Jp(g,I-C,R,o,!0,0,!0,m)).A(U),(E=h.XN(U.v,U.C,c.v,c.C,R))!=0&&U.move(E,0),U.C>c.C||U.v<c.v){if(U.C>c.C)for(;U.v>=c.C;)U.move(-R,0),E-=R;for(;U.v<c.C-R;)U.move(R,0),E+=R}if(u=f.ta.Iu(o,j),E!=0&&((w=new f.Ed).gg(E,0),g.Pc(w)),ee){if(te&&c.contains(U))return g;for(ee=[null,null],E=0;2>E;E++){if(te?w=f.ba.Ic(v)?f.si.clip(g,c,u,F,m):f.si.clip(g,c,u,0,m):(w=f.Wk.local().W(g,j,o,m))==j&&(w=f.ba.ig(w)),c.v<=U.v&&c.C>=U.C||c.v>=U.v&&c.C<=U.C)return w;ee[E]=w,E==0&&(U.move(-R,0),(w=new f.Ed).gg(-R,0),g.Pc(w))}if(v==550)ee[0].Gd(ee[1],0,-1);else if(f.ba.Ic(v))ee[0].add(ee[1],!1);else{if(v!=33)throw f.i.ga("intersect_with_GCS_horizon: unexpected geometry type");ee[0].B()&&(ee[0]=ee[1])}return ee[0]}if(c.H<U.G||c.G>U.H)return g;for(v=0;!g.B()&&U.C>c.v;)v!=0&&((w=new f.Ed).gg(v,0),g.Pc(w)),f.ej.local().W(4,g,j,o,m)||j==(g=f.lp.local().W(g,j,o,m))&&(g=f.ba.ig(g)),v!=0&&((F=new f.Ed).gg(-v,0),g.Pc(F)),v-=R,U.move(-R,0);return g},h.qG=function(o,c,u,m){if(c!=0&&m!=N.DontClip)if(m==N.PannableFold){m=u.zR();for(var g=c,v=0;v<c;v++)(o[v].y>m.H||o[v].y<m.G)&&(o[v].Sc(),g--);g!=0&&h.bv(o,c,m.v,m.S())}else{var w=90*(m=u.bf()),E=180*m;for(m*=360,g=c,v=0;v<c;v++)(o[v].y>w||o[v].y<-w)&&(o[v].Sc(),g--);if(g!=0){(g=new f.l).ax(o,c),w=u.Wr();var C=u.jv();v=w.K()==197;var R=new f.l;if(w.A(R),!C||!(R.H<g.G||R.G>g.H))if(C)if(h.bv(o,c,R.gk()-E,m),g=c,v)for(v=0;v<c;v++)R.contains(o[v])||(o[v].Sc(),g--);else for(u=f.ta.Iu(u.tc(),w),v=0;v<c;v++)(E=f.jd.Zd(w,o[v],u)!=0)||(o[v].Sc(),g--);else for(h.bv(o,c,-E,m),g=c,u=f.ta.Iu(u.tc(),w),v=0;v<c;v++)(E=o[v]).isNaN()&&g--,C=h.lE(E.x,R.v,R.C,m),E.x+=C,(E=f.jd.Zd(w,E,u)!=0)&&(o[v].Sc(),g--)}}},h.Jp=function(o,c,u,m,g,v,w,E){var C=o.K(),R=c+u;if(C===33){var I=(m=g?o:o.Pf()).Mg();return(I<c||I>=R||w&&I==R)&&(I+=Math.ceil((c-I)/u)*u,I=f.P.Rk(I,c,R),m.WB(I)),m}if(o.B()||(I=new f.l,o.A(I),I.B()))return o;var F=new f.Oc;I.en(F);var U=new f.Oc;if(U.L(c,R),U.contains(F))return o;if((R=new f.l).L(I),C===550){for(E=(m=g?o:o.Pf()).vb(0),C=2*m.I(),R=!1,c=0;c<C;c+=2)((I=E.read(c))<U.pa||I>=U.wa||w&&I==U.wa)&&(R=!0,I+=Math.ceil((U.pa-I)/u)*u,I=U.Jt(I),E.write(c,I));return R&&m.Qc(1993),m}if(C==197)return u=g?o:o.Pf(),I.Fa(R),u.Yo(I),u;var j=.1*Math.max(I.da(),I.S());for(R.X(0,j),w=o,U=m.Yd(0),o=f.Hh.local(),g=new f.Ed;;){var ee=Math.floor((F.pa-c)/u),te=Math.ceil((F.wa-c)/u);if(!(3<te-ee))break;ee=Math.floor(.5*(te+ee)),R.v=I.v-j,R.C=c+u*ee;var Z=f.si.clip(w,R,U,v,E);R.v=R.C,R.C=I.C+j;var le=f.si.clip(w,R,U,v,E);g.gg((ee-te)*u,0),le.Pc(g),C==1736?w=o.W(Z,le,m,null):(w=Z).add(le,!1),w.A(I),I.en(F)}for(R.v=c,R.C=c+u,(c=new f.l).L(R),c.X(U,0),(c=Math.floor((I.v-R.v)/u)*u)!=0?(R.move(c,0),g.gg(-c,0)):g.KB(),c=C==1607?new f.Ua(w.description):new f.Ea(w.description),v=new f.l,F=new f.l;I.C>R.v;)(j=f.si.clip(w,R,U,0,E)).A(F),(C==1607?!j.B()&&(F.S()>U||F.da()>U):!j.B()&&(C!=1736||F.S()>U))&&(j.Pc(g),j.A(F),c.A(v),v.X(U,U),v.isIntersecting(F)&&C==1736?c=o.W(c,j,m,null):c.add(j,!1)),R.move(u,0),g.shift(-u,0);return c},h.bv=function(o,c,u,m){for(var g=u+m,v=0;v<c;v++){var w=o[v].x;u<=w&&w<g||!(w<u||w>g||w==g)||(w+=Math.ceil((u-w)/m)*m,w=f.P.Rk(w,u,g),o[v].x=w)}},h.Gn=function(o,c,u,m,g,v){if(!c.Xc())throw f.i.ga("fold_into_360_degree_range");if(o.B())return o;if(c.Tb()==2){u=c.qv();var w=c.pv()-u}else{var E=c.bf();w=360*E,u-=180*E}return h.Jp(o,u,w,c,m,g,!0,v)},h.iF=function(o,c,u,m){if(u.Tb()==2)m=u.qv(),u=u.pv()-m;else{var g=u.bf();u=360*g,m-=180*g}h.bv(o,c,m,u)},h.mj=function(o,c){var u=c.Le();if(o.K()==33){var m=o.jh();return u.G<=m&&m<=u.H?o:o.Ja()}m=new f.l,o.A(m);var g=new f.l;return g.L(u),g.v=m.v,g.C=m.C,g.X(.01*g.da(),0),u=f.ta.oy(c,m),g.contains(m)?o:f.si.clip(o,g,u,0,null)},h.kr=function(o,c,u){return o>c.C&&o-c.C<u?c.C:o<c.v&&c.v-o<u?c.v:o},h.tX=function(o,c,u,m){m.x=h.kr(o.x,c,u),m.y=o.y},h.sX=function(o,c,u,m){for(var g=0;g<c;g++)o[g].y<u.G||o[g].y>u.H?o[g].Sc():o[g].x=h.kr(o[g].x,u,m)},h.Kt=function(o,c,u,m){if(!o.B()){var g=o.K();if(!m||g!=1736)if(f.ba.yj(g)){m=o.vb(0),g=0;for(var v=o.I();g<v;g++){var w=m.read(2*g),E=h.kr(w,c,u);E!=w&&m.write(2*g,E)}o.Qc(1993)}else if(g==197)m=new f.l,o.A(m),m.v=h.kr(m.v,c,u),m.C=h.kr(m.C,c,u),o.Yo(m);else{if(g!=33)throw f.i.ga("internal error");o.WB(h.kr(o.Mg(),c,u))}}},h.lS=function(o,c,u,m){var g=new f.hd,v=g.Ib(o);return o=f.ta.Iu(c,o),h.ls(g,v,c,o,u,!0,m),g.Ke(v)},h.ls=function(o,c,u,m,g,v,w){if(!u.Xc())throw f.i.O("invalid call");var E=u.Le(),C=u.tc(),R=C.fh().getDatum().getSpheroid();C=C.Id().bi;var I=R.getFlattening();R=R.getAxis(),I*=2-I;var F=new f.Oc;E.en(F);var U=null,j=[[0,0],[0,0]];if(u.Tb()==2?(U=u.fh(),v?(j[0][0]=h.an(w,F),j[0][1]=E.Lp(),f.fj.projToGeog(U,1,j),E=j[0][0]*C):(j[0][0]=E.gk(),j[0][1]=w,f.fj.projToGeog(U,1,j),E=j[0][1]*C)):E=w*C,!v&&E!=0&&g!=d.GreatElliptic)throw f.i.ga("invalid argument");var ee=new f.ha,te=[0],Z=new f.h,le=new f.h,ve=new f.h,be=[null,null],ue=new f.h,Le=new f.h,Be=new f.h,it=new f.h;for(c=o.Ob(c);c!=-1;c=o.Sb(c)){var Ke=o.Ya(c);o.D(Ke,ue);for(var Je=!1,pt=Ke=o.V(Ke);pt!=-1;pt=o.V(pt)){if(pt==Ke){if(Je)break;Je=!0}if(o.D(pt,Le),v&&(m<w-ue.x&&Le.x-w>m||m<w-Le.x&&ue.x-w>m)||!v&&(w!=0||m<-ue.y&&Le.y>m||m<-Le.y&&ue.y>m))do if(!(Math.abs(ue.x-Le.x)>=.5*F.S())){if(u.Tb()==2?(j[0][0]=h.an(ue.x,F),j[0][1]=ue.y,j[1][0]=h.an(Le.x,F),j[1][1]=Le.y,f.fj.projToGeogCenter(U,2,j,0),Be.x=j[0][0]*C,Be.y=j[0][1]*C,it.y=j[1][1]*C):(Be.x=ue.x*C,Be.y=ue.y*C,it.y=Le.y*C),it.x=2*(Le.x-ue.x)*Math.PI/F.S()+Be.x,v){if(le.x=E,le.y=h.Iz(R,I,Be,it,E,g),isNaN(le.y))break;be[0]=le;var qt=1}else if(g==d.GreatElliptic){var ri=[0,0];if((qt=f.Mx.Jz(I,Be,it,E,ri))==0)break;le.x=ri[0],le.y=E,be[0]=le,qt==2&&(ve.x=ri[1],ve.y=E,be[1]=ve)}else{if(le.x=h.Gz(R,I,Be,it,g),isNaN(le.x))break;le.y=0,be[0]=le,qt=1}var Ji=-1;for(ri=0;ri<qt;ri++){f.kb.xd(R,I,Be.x,Be.y,it.x,it.y,ee,null,null,g);var Zi=ee.u;f.kb.xd(R,I,Be.x,Be.y,be[ri].x,be[ri].y,ee,null,null,g);var an=ee.u;if(u.Tb()==2?(j[0][0]=be[ri].x/C,j[0][1]=be[ri].y/C,f.fj.geogToProj(U,1,j),v?(Z.y=j[0][1],Z.x=w):(Z.x=h.ps(j[0][0],ue.x,Le.x,F),Z.y=w)):v?(Z.x=w,Z.y=be[ri].y/C):(Z.x=h.ps(be[ri].x/C,ue.x,Le.x,F),Z.y=w),te[0]=0<Zi?f.P.Rk(an/Zi,0,1):.5,te[0]==0||te[0]==1)break;Ji>te[0]||(Ji=o.Na(pt),o.Wl(Ji,te,1),o.Db(o.V(Ji),Z.x,Z.y),Ji=te[0])}}while(0);ue.N(Le)}}},h.an=function(o,c){var u=c.wa-c.pa;return c.Jt(o-Math.floor((o-c.pa)/u)*u)},h.ps=function(o,c,u,m){var g=new f.Oc;for(g.L(c,u),u=m.S(),o=Math.floor((o-c)/u)*u+o,g=g.tf();Math.abs(o-g)>Math.abs(o+u-g);)o+=u;return o},h.Tn=function(o,c,u){return o=f.sr.Ep(o),c=f.sr.lx(o,f.sr.Ep(c)),(u=f.sr.lx(o,f.sr.Ep(u)))==0||0<c&&0<u&&u<=c||0>c&&0>u&&u>=c},h.Iz=function(o,c,u,m,g,v){if(v==d.GreatElliptic)return f.Mx.IS(c,u,m,g);if(Math.abs(u.x-m.x)>=Math.PI||!h.Tn(u.x,m.x,g))return NaN;if(u.x>m.x)var w=m;else w=u,u=m;m=new f.ha;var E=new f.ha,C=new f.ha;f.kb.xd(o,c,w.x,w.y,u.x,u.y,E,m,null,v);var R=E.u,I=0,F=1,U=new f.h;for(U.N(w);R*(F-I)>1e-12*o;){var j=.5*(I+F);if(f.kb.pj(o,c,w.x,w.y,R*j,m.u,E,C,v),U.x=E.u,U.y=C.u,U.x==g)break;if(h.Tn(w.x,U.x,g))F=j;else{if(!h.Tn(u.x,U.x,g))return NaN;I=j}}return U.y},h.Gz=function(o,c,u,m,g){if(g==d.GreatElliptic)return o=[0,0],f.Mx.Jz(c,u,m,0,o),o[0];if(u.y>m.y)var v=m;else v=u,u=m;if((m=new f.Oc).L(v.y,u.y),!m.contains(0)||Math.abs(v.x-u.x)>=Math.PI)return NaN;if(v.x==u.x)return v.x;var w=new f.ha,E=new f.ha,C=new f.ha;f.kb.xd(o,c,v.x,v.y,u.x,u.y,E,w,null,g);var R=E.u,I=0,F=1,U=new f.h;for(U.N(v);R*(F-I)>1e-12*o;){var j=.5*(I+F);if(f.kb.pj(o,c,v.x,v.y,R*j,w.u,E,C,g),U.x=E.u,U.y=C.u,m.L(v.y,U.y),U.y==0)break;if(m.contains(0))F=j;else{if(m.L(u.y,U.y),!m.contains(0))return NaN;I=j}}return U.x},h.NI=function(o,c,u,m){if(!o.ef.Xc())return!1;var g=new f.de(c.description);if(g.Gd(c,0,-1),m=f.Fx.local().W(g,o,m),g=c.I(),u.Pa(),g!=m.I())return!1;var v=new f.l;c.A(v);var w=new f.l;if(m.A(w),v=v.S(),w=w.S(),v!=0&&w!=0){if(w/=v,o=o.Zf.hh().S()/o.ef.hh().S(),1e-10<Math.abs(w/o-1))return!1}else if(v!=0||w!=0)return!1;for(u.add(c,!1),c=new f.h,o=0;o<g;o++)m.D(o,c),u.Db(o,c);return!0},h.iN=function(o,c){return(o%=360*c)>=180*c&&(o-=360*c),o},h.LI=function(o,c,u,m){if(u==N.Clip){var g=c.ol();g.K()==197?(u=new f.l,g.A(u),g=f.ta.oy(c,u),o=f.si.clip(o,u,g,5e4*c.rm(),m)):f.ej.local().W(1,g,o,c,m)||(o=f.Wk.local().W(o,g,c,m))==g&&(o=f.Vk.ig(o))}else c.Xc()&&(m=new f.l,o.yc(m),c.Le().contains(m)||(h.Kt(o,c.Le(),c.Yd(0),!0),u==N.PannableFold&&(o=h.mj(o,c)),o=h.Gn(o,c,0,!0,1e5*c.rm(),null)));return o},h.PD=function(o,c,u){var m=c.Xr();if(m==null)return o;var g=(c=c.tc()).Le().S(),v=new f.l;o.yc(v);var w=new f.Oc;v.en(w),v=m.Ha(),m=null;for(var E=new f.Ed;v.ab();)for(;v.Ia();){var C=v.ia(),R=C.Ug(0,0),I=new f.Oc;for(I.L(R.pa,R.wa),R=0;I.wa>w.pa;)I.move(-g),--R;for(;I.pa<=w.wa;){if(I.isIntersecting(w)){m==null&&(m=new f.Ua);var F=f.zb.VO(C.ac(),C.xc());R!=0&&(E.gg(R*g,0),F.Pc(E)),m.oc(F,!0)}I.move(g),++R}}return m!=null?(c=f.ta.ZN(c,m),c=f.ta.Gr(c),f.au.dP(o,m,c,u)):o},h.XN=function(o,c,u,m,g){return o>=u&&c<=m?0:h.lE(.5*(c+o),u,m,g)},h.lE=function(o,c,u,m){return f.mc.round((.5*(u+c)-o)/m)*m},h.NQ=function(o,c,u,m,g,v,w,E){var C=h.ev(m,g),R=C.S(),I=R/360,F=h.hE*I,U=o.vb(0),j=c.Xc(),ee=j?R/c.Le().S():0;c=o.Ja();for(var te=0,Z=u.ea();te<Z;++te){var le=j,ve=new f.Ua(u.description);ve.addPath(u,te,!0);var be=u.ec(te);w!=0&&(be=h.GD(be,ve,C.H-E,C.H,w))&&(le=!1);var ue=-1;be=ve.I();var Le=!1;le&&(ue=o.Ca(te),Le=o.ec(te));var Be=ve.vb(0),it=0,Ke=Be.read(0),Je=0,pt=3*m.Yd(0),qt=!1,ri=new f.h;ri.Sc();var Ji=new f.h;Ji.Sc();for(var Zi=!1,an=1;an<be;++an){var Br=f.h.construct(Be.Bg(2*an),Be.Bg(2*an+1)),Rt=Br.x,gr=Rt+it,Ri=gr-Ke;if(Br.x=gr,Math.abs(Ri)>F){if(le){var Ps=ue+an-1,rs=ue;(!Le||an+1<be)&&(rs+=an),Ps=U.read(2*Ps),rs=(U.read(2*rs)-Ps)*ee,Math.abs(Ri-rs)>1*I&&(j=!1)}le||(gr=Rt+(it-=f.mc.Dn(R,gr-Ke)),++Je,Zi=it!=0,Br.x=gr)}else qt||f.ta.sG(ri,Ji,Br,pt)&&(qt=!0);Zi&&Be.write(2*an,gr),Ke=gr,ri.N(Ji),Ji.N(Br)}Je!=0&&ve.Qc(1993),le=ve.Oa(0),be=ve.Oa(be-1),f.h.ub(le,be),ve=h.oQ(ve,m,isNaN(g)?0:g,v),c.add(ve,!1)}return o=m.Yd(0),u=C.S()/180,h.Kt(c,C,.1*o,!1),f.si.clip(c,C,o,u,v)},h.oQ=function(o,c,u,m){return h.Gn(o,c,u,!0,0,m)},h.FS=function(o,c,u,m){var g=o.K();if(g==1736)for(c=c!=null?c.Yd(0):0,g=0;g<m;g++)f.jd.Zd(o,u[g],c)!=1&&u[g].Sc();else{if(g!=197)throw f.i.O();for(g=0;g<m;g++)o.WO(u[g])||u[g].Sc()}},h.al=function(o,c,u,m){if(32>u)for(var g=new f.Ta,v=0;v<u;v++)g.Db(c[v]),o.al(g,m).D(c[v]);else{var w=new f.de;for(w.se(3),w.zD(c,u),g=w.vb(3),v=0;v<u;v++)g.write(v,v);for(v=o.al(w,m),o=v.vb(0),g=v.vb(3),m=f.h.construct(NaN,NaN),w=0;w<u;w++)c[w]=m;for(u=v.I(),v=0;v<u;v++)m=g.read(v),o.uc(2*v,c[m])}},h.$k=function(o,c,u,m){if(32>u)for(var g=new f.Ta,v=0;v<u;v++)g.Db(c[v]),o.$k(g,m).D(c[v]);else{var w=new f.de;for(w.se(3),w.zD(c,u),g=w.vb(3),v=0;v<u;v++)g.write(v,v);for(v=o.$k(w,m),o=v.vb(0),g=v.vb(3),m=f.h.construct(NaN,NaN),w=0;w<u;w++)c[w]=m;for(u=v.I(),v=0;v<u;v++)m=g.read(v),o.uc(2*v,c[m])}},h.hE=210,h}()}(ae||(ae={})),function(f){var N;(N=f.ML||(f.ML={}))[N.rightSide=1]="rightSide";var T=function(){function d(h,o,c){this.Cs=new f.h,h===void 0?this.Jo=-1:(this.Cs.N(h),this.Jo=o,this.La=c,this.ow=0)}return d.prototype.OJ=function(h){this.ow=h?1|this.ow:-2&this.ow},d.prototype.B=function(){return 0>this.Jo},d.prototype.az=function(){if(this.B())throw f.i.ga("invalid call");return new f.Ta(this.Cs.x,this.Cs.y)},d.prototype.Va=function(){if(this.B())throw f.i.ga("invalid call");return this.Jo},d.prototype.cz=function(){if(this.B())throw f.i.ga("invalid call");return this.La},d.prototype.Nz=function(){return(1&this.ow)!=0},d.prototype.ay=function(h,o,c,u){this.Cs.x=h,this.Cs.y=o,this.Jo=c,this.La=u},d}();f.bm=T}(ae||(ae={})),function(f){var N=function(){function d(){}return d.prototype.Vo=function(h,o){this.uh.resize(0),this.Ji.length=0,this.tk=-1,h.yc(this.Ek),this.Ek.X(o,o),this.Ek.isIntersecting(this.Gb.Da)?((this.ws=f.ba.zd(h.K()))?(this.LH=h.ac(),this.KH=h.xc(),this.ra=o):this.ra=NaN,this.uh.add(this.Gb.kf),this.Ji.push(this.Gb.Da),this.Rs=this.Gb.Vr(this.Gb.kf)):this.Rs=-1},d.prototype.Yi=function(h,o){this.uh.resize(0),this.Ji.length=0,this.tk=-1,this.Ek.L(h),this.Ek.X(o,o),this.ra=NaN,this.Ek.isIntersecting(this.Gb.Da)?(this.uh.add(this.Gb.kf),this.Ji.push(this.Gb.Da),this.Rs=this.Gb.Vr(this.Gb.kf),this.ws=!1):this.Rs=-1},d.prototype.next=function(){if(this.uh.size==0)return-1;this.tk=this.Rs;var h=null,o=null,c=null,u=null;this.ws&&(h=new f.h,o=new f.h,c=new f.l);for(var m=!1;!m;){for(;this.tk!=-1;){var g=this.Gb.Xy(this.Gb.gv(this.tk));if(g.isIntersecting(this.Ek)){if(!this.ws){m=!0;break}if(h.N(this.LH),o.N(this.KH),c.L(g),c.X(this.ra,this.ra),0<c.ty(h,o)){m=!0;break}}this.tk=this.Gb.ov(this.tk)}if(this.tk==-1){g=this.uh.Gc();var v=this.Ji[this.Ji.length-1];for(u==null&&((u=[])[0]=new f.l,u[1]=new f.l,u[2]=new f.l,u[3]=new f.l),T.wJ(v,u),this.uh.Jf(),--this.Ji.length,v=0;4>v;v++){var w=this.Gb.Np(g,v);if(w!=-1&&0<this.Gb.NR(w)&&u[v].isIntersecting(this.Ek))if(this.ws){if(h.N(this.LH),o.N(this.KH),c.L(u[v]),c.X(this.ra,this.ra),0<c.ty(h,o)){var E=new f.l;E.L(u[v]),this.uh.add(w),this.Ji.push(E)}}else(E=new f.l).L(u[v]),this.uh.add(w),this.Ji.push(E)}if(this.uh.size==0)return-1;this.tk=this.Gb.Vr(this.uh.get(this.uh.size-1))}}return this.Rs=this.Gb.ov(this.tk),this.tk},d.UO=function(h,o,c){var u=new d;return u.Gb=h,u.Ek=new f.l,u.uh=new f.ja(0),u.Ji=[],u.Vo(o,c),u},d.TO=function(h,o,c){var u=new d;return u.Gb=h,u.Ek=new f.l,u.uh=new f.ja(0),u.Ji=[],u.Yi(o,c),u},d.SO=function(h){var o=new d;return o.Gb=h,o.Ek=new f.l,o.uh=new f.ja(0),o.Ji=[],o},d}();f.vY=N;var T=function(){function d(h,o){this.jf=new f.ad(11),this.$h=new f.ad(5),this.xs=[],this.hw=new f.ja(0),this.Da=new f.l,this.Nk(h,o)}return d.prototype.reset=function(h,o){this.jf.nj(!1),this.$h.nj(!1),this.xs.length=0,this.hw.clear(!1),this.Nk(h,o)},d.prototype.wj=function(h,o){return this.Av(h,o,0,this.Da,this.kf,!1,-1)},d.prototype.Ez=function(h,o,c){c=c==-1?this.kf:this.OF(c);var u=this.da(c),m=this.gR(c);return this.Av(h,o,u,m,c,!1,-1)},d.prototype.ka=function(h){return this.bR(h)},d.prototype.yF=function(h){return this.Xy(this.gv(h))},d.prototype.da=function(h){return this.kv(h)},d.prototype.gR=function(h){var o=new f.l;o.L(this.Da);var c=this.kv(h);h=this.IF(h);for(var u=0;u<2*c;u+=2){var m=f.P.truncate(3&h>>u);m==0?(o.v=.5*(o.v+o.C),o.G=.5*(o.G+o.H)):m==1?(o.C=.5*(o.v+o.C),o.G=.5*(o.G+o.H)):(m==2?o.C=.5*(o.v+o.C):o.v=.5*(o.v+o.C),o.H=.5*(o.G+o.H))}return o},d.prototype.NR=function(h){return this.vz(h)},d.prototype.mR=function(h,o){return N.UO(this,h,o)},d.prototype.EF=function(h,o){return N.TO(this,h,o)},d.prototype.getIterator=function(){return N.SO(this)},d.prototype.Nk=function(h,o){if(0>o||32<2*o)throw f.i.O("invalid height");this.rT=o,this.Da.L(h),this.kf=this.jf.De(),this.ix(this.kf,0),this.cx(this.kf,0),this.FJ(this.kf,0),this.CJ(this.kf,0)},d.prototype.Av=function(h,o,c,u,m,g,v){if(!u.contains(o))return c==0?-1:this.Av(h,o,0,this.Da,this.kf,g,v);if(!g)for(var w=m;w!=-1;w=this.AR(w))this.ix(w,this.vz(w)+1);(w=new f.l).L(u),u=m;var E=[];for(E[0]=new f.l,E[1]=new f.l,E[2]=new f.l,E[3]=new f.l;c<this.rT&&this.aO(u);c++){d.wJ(w,E);for(var C=!1,R=0;4>R;R++)if(E[R].contains(o)){C=!0;var I=this.Np(u,R);I==-1&&(I=this.jP(u,R)),this.ix(I,this.vz(I)+1),u=I,w.L(E[R]);break}if(!C)break}return this.jS(h,o,c,w,u,g,m,v)},d.prototype.jS=function(h,o,c,u,m,g,v,w){var E=this.FF(m);if(g){if(m==v)return w;this.KP(w),g=w}else g=this.lP(),this.HB(g,h),this.zW(this.gv(g),o);return this.$W(g,m),E!=-1?(this.gx(g,E),this.dx(E,g)):this.yJ(m,g),this.LB(m,g),this.cx(m,this.mv(m)+1),this.$N(m)&&this.EQ(c,u,m),g},d.prototype.KP=function(h){var o=this.OF(h),c=this.FF(o),u=this.FR(h),m=this.ov(h);this.Vr(o)==h?(m!=-1?this.gx(m,-1):this.LB(o,-1),this.yJ(o,m)):c==h?(this.dx(u,-1),this.LB(o,u)):(this.gx(m,u),this.dx(u,m)),this.gx(h,-1),this.dx(h,-1),this.cx(o,this.mv(o)-1)},d.wJ=function(h,o){var c=.5*(h.v+h.C),u=.5*(h.G+h.H);o[0].L(c,u,h.C,h.H),o[1].L(h.v,u,c,h.H),o[2].L(h.v,h.G,c,u),o[3].L(c,h.G,h.C,u)},d.prototype.$N=function(h){return this.mv(h)==8&&!this.ZF(h)},d.prototype.EQ=function(h,o,c){var u=this.Vr(c);do{var m=this.gv(u),g=this.$h.U(u,0);m=this.Xy(m),this.Av(g,m,h,o,c,!0,u),u=g=this.ov(u)}while(u!=-1)},d.prototype.aO=function(h){return 8<=this.mv(h)||this.ZF(h)},d.prototype.ZF=function(h){return this.Np(h,0)!=-1||this.Np(h,1)!=-1||this.Np(h,2)!=-1||this.Np(h,3)!=-1},d.prototype.jP=function(h,o){var c=this.jf.De();return this.EW(h,o,c),this.ix(c,0),this.cx(c,0),this.Pk(c,h),this.CJ(c,this.kv(h)+1),this.FJ(c,o<<2*this.kv(h)|this.IF(h)),c},d.prototype.lP=function(){var h=this.$h.De();if(0<this.hw.size){var o=this.hw.Gc();this.hw.Jf()}else o=this.xs.length,this.xs.push(new f.l);return this.AW(h,o),h},d.prototype.Np=function(h,o){return this.jf.U(h,o)},d.prototype.EW=function(h,o,c){this.jf.T(h,o,c)},d.prototype.Vr=function(h){return this.jf.U(h,4)},d.prototype.yJ=function(h,o){this.jf.T(h,4,o)},d.prototype.FF=function(h){return this.jf.U(h,5)},d.prototype.LB=function(h,o){this.jf.T(h,5,o)},d.prototype.IF=function(h){return this.jf.U(h,6)},d.prototype.FJ=function(h,o){this.jf.T(h,6,o)},d.prototype.mv=function(h){return this.jf.U(h,7)},d.prototype.vz=function(h){return this.jf.U(h,8)},d.prototype.cx=function(h,o){this.jf.T(h,7,o)},d.prototype.ix=function(h,o){this.jf.T(h,8,o)},d.prototype.AR=function(h){return this.jf.U(h,9)},d.prototype.Pk=function(h,o){this.jf.T(h,9,o)},d.prototype.kv=function(h){return this.jf.U(h,10)},d.prototype.CJ=function(h,o){this.jf.T(h,10,o)},d.prototype.bR=function(h){return this.$h.U(h,0)},d.prototype.HB=function(h,o){this.$h.T(h,0,o)},d.prototype.FR=function(h){return this.$h.U(h,1)},d.prototype.ov=function(h){return this.$h.U(h,2)},d.prototype.gx=function(h,o){this.$h.T(h,1,o)},d.prototype.dx=function(h,o){this.$h.T(h,2,o)},d.prototype.OF=function(h){return this.$h.U(h,3)},d.prototype.$W=function(h,o){this.$h.T(h,3,o)},d.prototype.gv=function(h){return this.$h.U(h,4)},d.prototype.AW=function(h,o){this.$h.T(h,4,o)},d.prototype.Xy=function(h){return this.xs[h]},d.prototype.zW=function(h,o){this.xs[h].L(o)},d}();f.eu=T}(ae||(ae={})),function(f){var N;(N=f.TK||(f.TK={}))[N.Outside=0]="Outside",N[N.Inside=1]="Inside",N[N.Border=2]="Border";var T=function(){function h(o,c){this.FT=c,this.Wh=o}return h.prototype.$w=function(o,c){this.aH!=c&&o.flush(),this.aH=c},h.prototype.ZE=function(o,c){for(var u=0;u<c;)for(var m=o[u++],g=o[u++],v=o[u++]*this.FT;m<g;m++)this.Wh[v+(m>>4)]|=this.aH<<2*(15&m)},h}();f.wY=T;var d=function(){function h(o,c,u){this.Wh=null,this.MA=this.Ik=this.VH=this.TH=this.Fs=this.iH=this.Hf=this.Wm=0,this.Si=this.Jk=this.xl=null,this.Az(o,c,u)}return h.create=function(o,c,u){if(!h.rE(o))throw f.i.O();return h.oP(o,c,u)},h.fW=function(o){switch(o){case 0:o=1024;break;case 1:o=16384;break;case 2:o=262144;break;default:throw f.i.ga("Internal Error")}return o},h.rE=function(o){return!(o.B()||o.K()!=1607&&o.K()!=1736)},h.prototype.jQ=function(o,c){c=c.Ha();for(var u=new f.h,m=new f.h;c.ab();)for(;c.Ia();){var g=c.ia();if(g.K()!=322)throw f.i.ga("Internal Error");o.Fh(g.ac(),u),o.Fh(g.xc(),m),this.Si.ey(u.x,u.y,m.x,m.y)}this.Si.aJ(f.Nx.Ax)},h.prototype.kQ=function(){throw f.i.ga("Internal Error")},h.prototype.My=function(o,c){for(var u=1;4>u;u++)o.ey(c[u-1].x,c[u-1].y,c[u].x,c[u].y);o.ey(c[3].x,c[3].y,c[0].x,c[0].y),this.Si.aJ(f.Nx.Ax)},h.prototype.jK=function(o,c,u){for(var m=[null,null,null,null],g=0;g<m.length;g++)m[g]=new f.h;c=c.Ha(),u=this.Jk.SX(u)+1.5,g=new f.h;for(var v=new f.h,w=new f.h,E=new f.h,C=new f.h,R=new f.l,I=new f.h;c.ab();){var F=!1,U=!0;for(I.na(0,0);c.Ia();){var j=c.ia();if(E.x=j.sa,E.y=j.oa,C.x=j.qa,C.y=j.ma,R.Pa(),R.$b(E.x,E.y),R.Lk(C.x,C.y),this.xl.zG(R)){this.Jk.Fh(C,C),U?(this.Jk.Fh(E,E),I.N(E),U=!1):E.N(I),g.vc(C,E);var ee=.5>(j=g.length());j==0?g.na(1,0):(ee||I.N(C),g.scale(u/j),v.na(-g.y,g.x),w.na(g.y,-g.x),E.sub(g),C.add(g),m[0].add(E,v),m[1].add(E,w),m[2].add(C,w),m[3].add(C,v),ee?F=!0:this.My(o,m))}else F&&(this.My(o,m),F=!1),U=!0}F&&this.My(o,m)}},h.prototype.lC=function(o){return f.P.truncate(o*this.iH+this.TH)},h.prototype.mC=function(o){return f.P.truncate(o*this.Fs+this.VH)},h.oP=function(o,c,u){return new h(o,c,u)},h.prototype.Az=function(o,c,u){this.Hf=Math.max(f.P.truncate(2*Math.sqrt(u)+.5),64),this.Wm=f.P.truncate((2*this.Hf+31)/32),this.xl=new f.l,this.Ik=c,u=0;for(var m=this.Hf,g=this.Wm;8<=m;)u+=m*g,m=f.P.truncate(m/2),g=f.P.truncate((2*m+31)/32);this.Wh=f.P.lg(u,0),this.Si=new f.Nx,u=new T(this.Wh,this.Wm,this),this.Si.oX(this.Hf,this.Hf,u),o.A(this.xl),this.xl.X(c,c),m=new f.l;var v=c*(g=f.l.construct(1,1,this.Hf-2,this.Hf-2)).S();switch(c*=g.da(),m.L(this.xl.tf(),Math.max(v,this.xl.S()),Math.max(c,this.xl.da())),this.MA=this.Ik,this.Jk=new f.Ed,this.Jk.gS(m,g),new f.Ed,o.K()){case 550:u.$w(this.Si,2),this.kQ();break;case 1607:u.$w(this.Si,2),this.jK(this.Si,o,this.MA);break;case 1736:u.$w(this.Si,1),this.jQ(this.Jk,o),u.$w(this.Si,2),this.jK(this.Si,o,this.MA)}this.iH=this.Jk.eb,this.Fs=this.Jk.bb,this.TH=this.Jk.Lb,this.VH=this.Jk.Qb,this.PN()},h.prototype.PN=function(){this.Si.flush();for(var o=0,c=this.Hf*this.Wm,u=this.Hf,m=f.P.truncate(this.Hf/2),g=this.Wm,v=f.P.truncate((2*m+31)/32);8<u;){for(u=0;u<m;u++)for(var w=2*u,E=2*u+1,C=0;C<m;C++){var R=2*C,I=2*C+1,F=R>>4;R=2*(15&R);var U=I>>4;I=2*(15&I);var j=this.Wh[o+g*w+F]>>R&3;j|=this.Wh[o+g*w+U]>>I&3,j|=this.Wh[o+g*E+F]>>R&3,j|=this.Wh[o+g*E+U]>>I&3,this.Wh[c+v*u+(C>>4)]|=j<<2*(15&C)}u=m,g=v,o=c,m=f.P.truncate(u/2),v=f.P.truncate((2*m+31)/32),c=o+g*u}},h.prototype.To=function(o,c){return this.xl.contains(o,c)?(o=this.lC(o),c=this.mC(c),0>o||o>=this.Hf||0>c||c>=this.Hf||(c=this.Wh[this.Wm*c+(o>>4)]>>2*(15&o)&3)==0?0:c==1?1:2):0},h.prototype.So=function(o){if(!o.Fa(this.xl))return 0;var c=this.lC(o.v),u=this.lC(o.C),m=this.mC(o.G);if(o=this.mC(o.H),0>c&&(c=0),0>m&&(m=0),u>=this.Hf&&(u=this.Hf-1),o>=this.Hf&&(o=this.Hf-1),c>u||m>o)return 0;for(var g=Math.max(u-c,1)*Math.max(o-m,1),v=0,w=this.Wm,E=this.Hf,C=0;;){if(32>g||16>E){for(g=m;g<=o;g++)for(var R=c;R<=u;R++)if(1<(C=this.Wh[v+w*g+(R>>4)]>>2*(15&R)&3))return 2;if(C==0)return 0;if(C==1)return 1}v+=w*E,E=f.P.truncate(E/2),w=f.P.truncate((2*E+31)/32),c=f.P.truncate(c/2),m=f.P.truncate(m/2),u=f.P.truncate(u/2),o=f.P.truncate(o/2),g=Math.max(u-c,1)*Math.max(o-m,1)}},h.prototype.IR=function(){return this.Hf*this.Wm},h}();f.Lx=d}(ae||(ae={})),function(f){var N;(N=f.NL||(f.NL={}))[N.contains=1]="contains",N[N.within=2]="within",N[N.equals=3]="equals",N[N.disjoint=4]="disjoint",N[N.touches=8]="touches",N[N.crosses=16]="crosses",N[N.overlaps=32]="overlaps",N[N.unknown=0]="unknown",N[N.intersects=1073741824]="intersects";var T=function(){function h(){}return h.construct=function(o,c,u,m,g,v,w,E){var C=new h;return C.qw=o,C.Om=c,C.Lj=u,C.Ti=m,C.tH=g,C.HY=v,C.IY=w,C.JY=E,C},h}();f.Wt=function(){function h(){}return h.uD=function(o,c,u){if(h.qy(o)){var m=f.ta.lj(c,o,!1);c=!1,f.Uk.uE(o)&&(c=c||o.mu(m,u)),(m=o.K())!=1736&&m!=1607||!f.Uk.sE(o)||u==0||(c=c||o.gj(u)),m!=1736&&m!=1607||!f.Uk.tE(o)||u==0||c||o.$L()}},h.qy=function(o){return f.Uk.uE(o)||f.Uk.sE(o)||f.Uk.tE(o)},h}();var d=function(){function h(){this.sh=[]}return h.tB=function(o,c,u,m,g){var v=o.K(),w=c.K();if(v==197){if(w==197)return h.jW(o,c,u,m);if(w==33)return m==2?m=1:m==1&&(m=2),h.$I(c,o,u,m)}else if(v==33){if(w==197)return h.$I(o,c,u,m);if(w==33)return h.lW(o,c,u,m)}if(o.B()||c.B())return m==4;var E=new f.l;o.A(E);var C=new f.l;c.A(C);var R=new f.l;if(R.L(E),R.$b(C),u=f.ta.Xd(u,R,!1),h.dk(E,C,u))return m==4;switch(E=!1,f.Vk.zd(v)&&((v=new f.Ua(o.description)).oc(o,!0),o=v,v=1607),f.Vk.zd(w)&&((w=new f.Ua(c.description)).oc(c,!0),c=w,w=1607),v!=197&&w!=197?(o.Eb()<c.Eb()||v==33&&w==550)&&(m==2?m=1:m==1&&(m=2)):v!=1736&&w!=197&&(m==2?m=1:m==1&&(m=2)),v){case 1736:switch(w){case 1736:E=h.rt(o,c,u,m,g);break;case 1607:E=h.bn(o,c,u,m,g);break;case 33:E=h.qt(o,c,u,m);break;case 550:E=h.pt(o,c,u,m,g);break;case 197:E=h.yI(o,c,u,m,g)}break;case 1607:switch(w){case 1736:E=h.bn(c,o,u,m,g);break;case 1607:E=h.aB(o,c,u,m,g);break;case 33:E=h.tt(o,c,u,m,g);break;case 550:E=h.st(o,c,u,m,g);break;case 197:E=h.EI(o,c,u,m)}break;case 33:switch(w){case 1736:E=h.qt(c,o,u,m);break;case 1607:E=h.tt(c,o,u,m,g);break;case 550:E=h.lt(c,o,u,m)}break;case 550:switch(w){case 1736:E=h.pt(c,o,u,m,g);break;case 1607:E=h.st(c,o,u,m,g);break;case 550:E=h.TA(o,c,u,m,g);break;case 33:E=h.lt(o,c,u,m);break;case 197:E=h.$H(o,c,u,m)}break;case 197:switch(w){case 1736:E=h.yI(c,o,u,m,g);break;case 1607:E=h.EI(c,o,u,m);break;case 550:E=h.$H(c,o,u,m)}}return E},h.jW=function(o,c,u,m){if(o.B()||c.B())return m==4;var g=new f.l,v=new f.l,w=new f.l;switch(o.A(g),c.A(v),w.L(g),w.$b(v),o=f.ta.Xd(u,w,!1),m){case 4:return h.dk(g,v,o);case 2:return h.bF(v,g,o);case 1:return h.bF(g,v,o);case 3:return h.ek(g,v,o);case 8:return h.VP(g,v,o);case 32:return h.UP(g,v,o);case 16:return h.TP(g,v,o)}return!1},h.$I=function(o,c,u,m){if(o.B()||c.B())return m==4;o=o.D();var g=new f.l,v=new f.l;switch(c.A(g),v.L(o),v.$b(g),c=f.ta.Xd(u,v,!1),m){case 4:return h.Sw(o,g,c);case 2:return h.ZA(o,g,c);case 1:return h.HU(o,g,c);case 3:return h.nI(o,g,c);case 8:return h.YA(o,g,c)}return!1},h.lW=function(o,c,u,m){if(o.B()||c.B())return m==4;o=o.D(),c=c.D();var g=new f.l;switch(g.L(o),g.$b(c),u=f.ta.Xd(u,g,!1),m){case 4:return h.IU(o,c,u);case 2:return h.mI(c,o,u);case 1:return h.mI(o,c,u);case 3:return h.oI(o,c,u)}return!1},h.rt=function(o,c,u,m,g){switch(m){case 4:return h.aV(o,c,u);case 2:return h.Tw(c,o,u,g);case 1:return h.Tw(o,c,u,g);case 3:return h.dV(o,c,u);case 8:return h.lV(o,c,u);case 32:return h.gV(o,c,u,g)}return!1},h.bn=function(o,c,u,m,g){switch(m){case 4:return h.bV(o,c,u);case 1:return h.$A(o,c,u,g);case 8:return h.mV(o,c,u,g);case 16:return h.XU(o,c,u)}return!1},h.qt=function(o,c,u,m){switch(m){case 4:return h.$U(o,c,u);case 1:return h.UU(o,c,u);case 8:return h.kV(o,c,u)}return!1},h.pt=function(o,c,u,m){switch(m){case 4:return h.ZU(o,c,u);case 1:return h.TU(o,c,u);case 8:return h.jV(o,c,u);case 16:return h.WU(o,c,u)}return!1},h.yI=function(o,c,u,m,g){if(h.YU(o,c,u))return m==4;if(m==4)return!1;switch(m){case 2:return h.nV(o,c,u);case 1:return h.SU(o,c,u);case 3:return h.cV(o,c,u);case 8:return h.iV(o,c,u,g);case 32:return h.fV(o,c,u,g);case 16:return h.VU(o,c,u,g)}return!1},h.aB=function(o,c,u,m){switch(m){case 4:return h.wV(o,c,u);case 2:return h.CI(c,o,u);case 1:return h.CI(o,c,u);case 3:return h.yV(o,c,u);case 8:return h.FI(o,c,u);case 32:return h.CV(o,c,u);case 16:return h.DI(o,c,u)}return!1},h.tt=function(o,c,u,m){switch(m){case 4:return h.vV(o,c,u);case 1:return h.qV(o,c,u);case 8:return h.GV(o,c,u)}return!1},h.st=function(o,c,u,m){switch(m){case 4:return h.uV(o,c,u);case 1:return h.pV(o,c,u);case 8:return h.FV(o,c,u);case 16:return h.sV(o,c,u)}return!1},h.EI=function(o,c,u,m){if(h.tV(o,c,u))return m==4;if(m==4)return!1;switch(m){case 2:return h.HV(o,c,u);case 1:return h.oV(o,c,u);case 3:return h.xV(o,c,u);case 8:return h.EV(o,c,u);case 32:return h.BV(o,c,u);case 16:return h.rV(o,c,u)}return!1},h.TA=function(o,c,u,m){switch(m){case 4:return h.XT(o,c,u);case 2:return h.XH(c,o,u);case 1:return h.XH(o,c,u);case 3:return h.ZT(o,c,u);case 32:return h.eU(o,c,u)}return!1},h.lt=function(o,c,u,m){switch(m){case 4:return h.YH(o,c,u);case 2:return h.iU(o,c,u);case 1:return h.UT(o,c,u);case 3:return h.Ow(o,c,u)}return!1},h.$H=function(o,c,u,m){switch(m){case 4:return h.WT(o,c,u);case 2:return h.hU(o,c,u);case 1:return h.TT(o,c,u);case 3:return h.YT(o,c,u);case 8:return h.gU(o,c,u);case 16:return h.VT(o,c,u)}return!1},h.dV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!!h.ek(m,g,u)&&(m=h.qc(o,c,!1))!=4&&m!=1&&m!=2&&(!!h.WH(o,c,u)||(m=o.Rb(),g=c.Rb(),!(Math.abs(m-g)>4*Math.max(o.I(),c.I())*u)&&h.Rz(o,c,u,!0)))},h.aV=function(o,c,u){var m=h.qc(o,c,!0);return m==4||m!=1&&m!=2&&m!=1073741824&&h.wI(o,c,u)},h.lV=function(o,c,u){var m=h.qc(o,c,!1);return m!=4&&m!=1&&m!=2&&h.AI(o,c,u,null)},h.gV=function(o,c,u,m){var g=h.qc(o,c,!1);return g!=4&&g!=1&&g!=2&&h.xI(o,c,u,m)},h.Tw=function(o,c,u,m){var g=new f.l,v=new f.l;return o.A(g),c.A(v),!!h.Ac(g,v,u)&&(g=h.qc(o,c,!1))!=4&&g!=2&&(g==1||h.tI(o,c,u,m))},h.bV=function(o,c,u){var m=h.qc(o,c,!0);return m==4||m!=1&&m!=1073741824&&h.wI(o,c,u)},h.mV=function(o,c,u,m){var g=h.qc(o,c,!1);return g!=4&&g!=1&&h.BI(o,c,u,m)},h.XU=function(o,c,u){var m=h.qc(o,c,!1);return m!=4&&m!=1&&h.vI(o,c,u,null)},h.$A=function(o,c,u,m){var g=new f.l,v=new f.l;return o.A(g),c.A(v),!!h.Ac(g,v,u)&&(g=h.qc(o,c,!1))!=4&&(g==1||h.uI(o,c,u,m))},h.$U=function(o,c,u){return f.jd.CG(o,c,u)==0},h.kV=function(o,c,u){return c=c.D(),h.zI(o,c,u)},h.UU=function(o,c,u){return c=c.D(),h.sI(o,c,u)},h.ZU=function(o,c,u){var m=h.qc(o,c,!1);if(m==4)return!0;if(m==1)return!1;m=new f.l,o.A(m),m.X(u,u);for(var g=new f.h,v=0;v<c.I();v++)if(c.D(v,g),m.contains(g)){var w=f.jd.Zd(o,g,u);if(w==1||w==2)return!1}return!0},h.jV=function(o,c,u){var m=this.qc(o,c,!1);if(m==4||m==1)return!1;m=new f.l,o.A(m),m.X(u,u);for(var g=!1,v=o,w=!1,E=0;E<c.I();E++){var C=c.Oa(E);if(m.contains(C)){if((C=f.jd.Zd(v,C,u))==2)g=!0;else if(C==1)return!1}w||(!f.Fg.Ol(o,c.I()-1)||o.Cb!=null&&o.Cb.Gb!=null?v=o:(v=new f.Ea,o.copyTo(v),v.gj(1)),w=!0)}return!!g},h.WU=function(o,c,u){var m=this.qc(o,c,!1);if(m==4||m==1)return!1;var g=new f.l;m=new f.l;var v=new f.l;o.A(g),c.A(v),m.L(g),m.X(u,u),v=g=!1;for(var w=o,E=!1,C=0;C<c.I();C++){var R=c.Oa(C);if(m.contains(R)?(R=f.jd.Zd(w,R,u))==0?v=!0:R==1&&(g=!0):v=!0,g&&v)return!0;E||(!f.Fg.Ol(o,c.I()-1)||o.Cb!=null&&o.Cb.Gb!=null?w=o:(w=new f.Ea,o.copyTo(w),w.gj(1)),E=!0)}return!1},h.TU=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),!this.Ac(m,g,u)||(g=this.qc(o,c,!1))==4)return!1;if(g==1)return!0;g=!1;for(var v=o,w=!1,E=0;E<c.I();E++){var C=c.Oa(E);if(!m.contains(C))return!1;if((C=f.jd.Zd(v,C,u))==1)g=!0;else if(C==0)return!1;w||(!f.Fg.Ol(o,c.I()-1)||o.Cb!=null&&o.Cb.Gb!=null?v=o:(v=new f.Ea,o.copyTo(v),v.gj(1)),w=!0)}return g},h.cV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!!h.ek(m,g,u)&&((m=new f.Ea).bd(c,!1),h.Rz(o,m,u,!0))},h.YU=function(o,c,u){var m=h.qc(o,c,!1);if(m==4)return!0;if(m==1||m==2)return!1;var g=new f.l;if(m=new f.l,o.A(g),c.A(m),h.Ac(m,g,u)||(g=new f.h,m.fn(g),(c=f.jd.Zd(o,g,u))!=0)||(m.SI(g),(c=f.jd.Zd(o,g,u))!=0)||(m.gn(g),(c=f.jd.Zd(o,g,u))!=0)||(m.VI(g),(c=f.jd.Zd(o,g,u))!=0))return!1;c=o.vb(0),(g=new f.l).L(m),g.X(u,u);for(var v=0,w=o.I();v<w;v++){var E=c.read(2*v),C=c.read(2*v+1);if(g.contains(E,C))return!1}return!h.KG(o,m,u)},h.iV=function(o,c,u,m){var g=h.qc(o,c,!1);if(g==4||g==1||g==2)return!1;g=new f.l;var v=new f.l;return o.A(g),c.A(v),!h.Ac(v,g,u)&&(v.S()<=u&&v.da()<=u?(c=c.Kp(),h.zI(o,c,u)):v.S()<=u||v.da()<=u?(g=new f.Ua,v=new f.Ta,c.If(0,v),g.nf(v),c.If(2,v),g.lineTo(v),h.BI(o,g,u,m)):((g=new f.Ea).bd(c,!1),h.AI(o,g,u,m)))},h.fV=function(o,c,u,m){var g=h.qc(o,c,!1);if(g==4||g==1||g==2)return!1;g=new f.l;var v=new f.l;return o.A(g),c.A(v),!(h.Ac(v,g,u)||v.S()<=u||v.da()<=u)&&((g=new f.Ea).bd(c,!1),h.xI(o,g,u,m))},h.nV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),h.Ac(g,m,u)},h.SU=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!!h.Ac(m,g,u)&&(m=h.qc(o,c,!1))!=4&&m!=2&&(m==1||(g.S()<=u&&g.da()<=u?(c=c.Kp(),h.sI(o,c,u)):g.S()<=u||g.da()<=u?(g=new f.Ua,m=new f.Ta,c.If(0,m),g.nf(m),c.If(2,m),g.lineTo(m),h.uI(o,g,u,null)):((g=new f.Ea).bd(c,!1),h.tI(o,g,u,null))))},h.VU=function(o,c,u,m){var g=new f.l,v=new f.l;return o.A(g),c.A(v),!(h.Ac(v,g,u)||v.da()>u&&v.S()>u||v.da()<=u&&v.S()<=u)&&(g=new f.Ua,v=new f.Ta,c.If(0,v),g.nf(v),c.If(2,v),g.lineTo(v),h.vI(o,g,u,m))},h.yV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(!h.ek(m,g,u)||h.qc(o,c,!1)==4)&&(!!h.WH(o,c,u)||h.Rz(o,c,u,!1))},h.wV=function(o,c,u){return this.qc(o,c,!1)==4||!!new f.am(o,c,u,!0).next()&&!this.LG(o,c,u)},h.FI=function(o,c,u){if(h.qc(o,c,!1)==4)return!1;var m=new f.ce(0);if(h.Sz(o,c,u,m)!=0)return!1;for(var g=new f.de,v=0;v<m.size;v+=2){var w=m.read(v),E=m.read(v+1);g.Cu(w,E)}return o=o.mg(),c=c.mg(),o.Gd(c,0,c.I()),h.Nw(o,g,u)},h.DI=function(o,c,u){if(h.qc(o,c,!1)==4)return!1;var m=new f.ce(0);if(h.Sz(o,c,u,m)!=0)return!1;for(var g=new f.de,v=0;v<m.size;v+=2){var w=m.read(v),E=m.read(v+1);g.Cu(w,E)}return o=o.mg(),c=c.mg(),o.Gd(c,0,c.I()),!h.Nw(o,g,u)},h.CV=function(o,c,u){return h.qc(o,c,!1)!=4&&h.NG(o,c,u)},h.CI=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(!h.Ac(m,g,u)||h.qc(o,c,!1)==4)&&h.Am(c,o,u,!1)},h.vV=function(o,c,u){return h.qc(o,c,!1)==4||(c=c.D(),!h.Tz(o,c,u))},h.GV=function(o,c,u){return h.qc(o,c,!1)!=4&&(c=c.D(),h.Uz(o,c,u))},h.qV=function(o,c,u){return h.qc(o,c,!1)!=4&&(c=c.D(),h.JG(o,c,u))},h.uV=function(o,c,u){return h.qc(o,c,!1)==4||!h.MG(o,c,u,!1)},h.FV=function(o,c,u){if(this.qc(o,c,!1)==4)return!1;var m=o.Ha(),g=new f.l,v=new f.l,w=new f.l;o.A(g),c.A(v),g.X(u,u),v.X(u,u),w.L(g),w.Fa(v),g=null;var E=o.Cb;if(E!=null){var C=E.Gb;g=E.Ao,C==null&&(C=E=f.ta.kj(o,w))}else C=E=f.ta.kj(o,w);var R=C.getIterator(),I=null;g!=null&&(I=g.getIterator());var F=new f.h,U=new f.h,j=!1,ee=u*u;for(g=new f.rn(c.I()),E=0;E<c.I();E++)g.write(E,0);for(E=0;E<c.I();E++)if(c.D(E,F),w.contains(F)){if(v.L(F.x,F.y,F.x,F.y),I!=null&&(I.Yi(v,u),I.next()==-1))continue;R.Yi(v,u);for(var te=R.next();te!=-1;te=R.next())if(m.Wb(C.ka(te)),(te=m.ia()).ic(te.fe(F,!1),U),f.h.zc(F,U)<=ee){g.write(E,1),j=!0;break}}if(!j)return!1;for(o=o.mg(),m=new f.de,v=new f.h,E=0;E<c.I();E++)g.read(E)!=0&&(c.D(E,v),m.Cu(v.x,v.y));return this.Nw(o,m,u)},h.sV=function(o,c,u){if(this.qc(o,c,!1)==4)return!1;var m=o.Ha(),g=new f.l,v=new f.l,w=new f.l;o.A(g),c.A(v),g.X(u,u),v.X(u,u),w.L(g),w.Fa(v),g=null;var E=o.Cb;if(E!=null){var C=E.Gb;g=E.Ao,C==null&&(C=E=f.ta.kj(o,w))}else C=E=f.ta.kj(o,w);var R=C.getIterator(),I=null;g!=null&&(I=g.getIterator());var F=new f.h,U=new f.h,j=!1,ee=!1,te=u*u;for(g=new f.rn(c.I()),E=0;E<c.I();E++)g.write(E,0);for(E=0;E<c.I();E++)if(c.D(E,F),w.contains(F)){if(v.L(F.x,F.y,F.x,F.y),I!=null&&(I.Yi(v,u),I.next()==-1)){ee=!0;continue}R.Yi(v,u);for(var Z=!1,le=R.next();le!=-1;le=R.next())if(m.Wb(C.ka(le)),(le=m.ia()).ic(le.fe(F,!1),U),f.h.zc(F,U)<=te){g.write(E,1),Z=j=!0;break}Z||(ee=!0)}else ee=!0;if(!j||!ee)return!1;for(o=o.mg(),m=new f.de,v=new f.h,E=0;E<c.I();E++)g.read(E)!=0&&(c.D(E,v),m.Cu(v.x,v.y));return!this.Nw(o,m,u)},h.pV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(!h.Ac(m,g,u)||h.qc(o,c,!1)==4||!h.MG(o,c,u,!0))&&(o=o.mg(),!h.ZH(o,c,u))},h.xV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(g.da()>u&&g.S()>u)&&h.ek(m,g,u)},h.tV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!h.Ac(g,m,u)&&!h.KG(o,g,u)},h.EV=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),g.da()<=u&&g.S()<=u)return g=c.Kp(),h.Uz(o,g,u);if(g.da()<=u||g.S()<=u)return g=new f.Ua,m=new f.Ta,c.If(0,m),g.nf(m),c.If(2,m),g.lineTo(m),h.FI(o,g,u);o=o.Ha(),c=new f.l,m=new f.l,c.L(g),m.L(g),c.X(-u,-u),m.X(u,u),g=!1;for(var v=new f.l,w=new f.l;o.ab();)for(;o.Ia();){if(o.ia().A(v),w.L(c),w.Fa(v),!w.B()&&(w.da()>u||w.S()>u))return!1;w.L(m),w.Fa(v),w.B()||(g=!0)}return g},h.BV=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(h.Ac(m,g,u)||h.Ac(g,m,u)||h.Ac(g,m,u)||g.da()>u&&g.S()>u||g.da()<=u&&g.S()<=u)&&(m=new f.Ua,g=new f.Ta,c.If(0,g),m.nf(g),c.If(2,g),m.lineTo(g),h.NG(o,m,u))},h.HV=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),!h.Ac(g,m,u)||g.da()<=u&&g.S()<=u)return!1;if(g.da()<=u||g.S()<=u)return h.Ac(g,m,u);o=o.Ha(),(c=new f.l).L(g),c.X(-u,-u),g=!1,m=new f.l;for(var v=new f.l;o.ab();)for(;o.Ia();)o.ia().A(m),c.jm(m)?g=!0:(v.L(c),v.Fa(m),!v.B()&&(v.da()>u||v.S()>u)&&(g=!0));return g},h.oV=function(o,c,u){var m=new f.l,g=new f.l;return c.A(g),o.A(m),!(!h.Ac(m,g,u)||g.da()>u&&g.S()>u)&&(g.da()<=u&&g.S()<=u?(c=c.Kp(),h.JG(o,c,u)):(m=new f.Ua,g=new f.Ta,c.If(0,g),m.nf(g),c.If(2,g),m.lineTo(g),h.Am(m,o,u,!1)))},h.rV=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),h.Ac(g,m,u)||g.da()<=u&&g.S()<=u)return!1;if(g.da()<=u||g.S()<=u)return m=new f.Ua,g=new f.Ta,c.If(0,g),m.nf(g),c.If(2,g),m.lineTo(g),h.DI(o,m,u);o=o.Ha(),c=new f.l,(m=new f.l).L(g),c.L(g),m.X(-u,-u),c.X(u,u);for(var v=g=!1,w=new f.l,E=new f.l;o.ab();)for(;o.Ia();)if(o.ia().A(w),v||c.contains(w)||(v=!0),g||(E.L(m),E.Fa(w),!E.B()&&(E.da()>u||E.S()>u)&&(g=!0)),g&&v)return!0;return!1},h.ZT=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!!h.ek(m,g,u)&&(!!h.$T(o,c,u)||h.SA(o,c,u,!1,!0,!1))},h.XT=function(o,c,u){return!h.ZH(o,c,u)},h.eU=function(o,c,u){return h.SA(o,c,u,!1,!1,!0)},h.XH=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!!h.Ac(m,g,u)&&h.SA(c,o,u,!0,!1,!1)},h.Nw=function(o,c,u){u*=u;for(var m=new f.h,g=new f.h,v=0;v<c.I();v++){c.D(v,g);for(var w=!1,E=0;E<o.I();E++)if(o.D(E,m),f.h.zc(m,g)<=u){w=!0;break}if(!w)return!1}return!0},h.Ow=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),h.ek(m,g,u)},h.YH=function(o,c,u){return c=c.D(),h.kt(o,c,u)},h.iU=function(o,c,u){return h.Ow(o,c,u)},h.UT=function(o,c,u){return!h.YH(o,c,u)},h.YT=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(g.da()>u||g.S()>u)&&h.ek(m,g,u)},h.WT=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),h.Ac(g,m,u))return!1;for((c=new f.l).L(g),c.X(u,u),u=new f.h,g=0;g<o.I();g++)if(o.D(g,u),c.contains(u))return!1;return!0},h.gU=function(o,c,u){var m=new f.l,g=new f.l,v=new f.l;if(c.A(m),m.da()<=u&&m.S()<=u)return!1;if(m.da()<=u||m.S()<=u){c=new f.h;var w=!1;g.L(m),v.L(m),g.X(u,u),m.da()>u?v.X(0,-u):v.X(-u,0);for(var E=0;E<o.I();E++)if(o.D(E,c),g.contains(c)){if(m.da()>u){if(c.y>v.G&&c.y<v.H)return!1}else if(c.x>v.v&&c.x<v.C)return!1;w=!0}return w}for(g.L(m),v.L(m),g.X(u,u),v.X(-u,-u),c=new f.h,w=!1,E=0;E<o.I();E++)if(o.D(E,c),g.contains(c)){if(v.jm(c))return!1;w=!0}return w},h.hU=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),!h.Ac(g,m,u))return!1;if(g.da()<=u&&g.S()<=u)return h.ek(m,g,u);if(g.da()<=u||g.S()<=u){c=!1,m=new f.l;var v=new f.l;m.L(g),v.L(g),g.da()>u?m.X(0,-u):m.X(-u,0),v.X(u,u);for(var w=new f.h,E=0;E<o.I();E++){if(o.D(E,w),!v.contains(w))return!1;g.da()>u?w.y>m.G&&w.y<m.H&&(c=!0):w.x>m.v&&w.x<m.C&&(c=!0)}return c}for(c=!1,m=new f.l,v=new f.l,m.L(g),v.L(g),m.X(-u,-u),v.X(u,u),w=new f.h,E=0;E<o.I();E++){if(o.D(E,w),!v.contains(w))return!1;m.jm(w)&&(c=!0)}return c},h.TT=function(o,c,u){var m=new f.l,g=new f.l;return o.A(m),c.A(g),!(!h.Ac(m,g,u)||g.da()>u||g.S()>u)&&(c=c.Kp(),!h.kt(o,c,u))},h.VT=function(o,c,u){var m=new f.l,g=new f.l;if(o.A(m),c.A(g),h.Ac(g,m,u)||g.da()<=u&&g.S()<=u)return!1;if(g.da()<=u||g.S()<=u){c=new f.l,m=new f.l,c.L(g),g.da()>u?c.X(0,-u):c.X(-u,0),m.L(g),m.X(u,u);for(var v=new f.h,w=!1,E=!1,C=0;C<o.I();C++)if(o.D(C,v),w||(g.da()>u?v.y>c.G&&v.y<c.H&&(w=!0):v.x>c.v&&v.x<c.C&&(w=!0)),E||m.contains(v)||(E=!0),w&&E)return!0;return!1}for(c=new f.l,m=new f.l,c.L(g),c.X(-u,-u),m.L(g),m.X(u,u),v=new f.h,E=w=!1,C=0;C<o.I();C++)if(o.D(C,v),!w&&c.jm(v)&&(w=!0),E||m.contains(v)||(E=!0),w&&E)return!0;return!1},h.oI=function(o,c,u){return f.h.zc(o,c)<=u*u},h.IU=function(o,c,u){return f.h.zc(o,c)>u*u},h.mI=function(o,c,u){return h.oI(o,c,u)},h.nI=function(o,c,u){var m=new f.l;return m.L(o),h.ek(m,c,u)},h.Sw=function(o,c,u){var m=new f.l;return m.L(c),m.X(u,u),!m.contains(o)},h.YA=function(o,c,u){if(c.da()<=u&&c.S()<=u)return!1;var m=new f.l,g=new f.l;if(m.L(c),m.X(u,u),!m.contains(o))return!1;if(c.da()<=u||c.S()<=u){if(g.L(c),c.da()>u?g.X(0,-u):g.X(-u,0),c.da()>u){if(o.y>g.G&&o.y<g.H)return!1}else if(o.x>g.v&&o.x<g.C)return!1;return!0}return g.L(c),g.X(-u,-u),!g.jm(o)},h.ZA=function(o,c,u){if(c.da()<=u&&c.S()<=u)return!0;if(c.da()<=u||c.S()<=u){var m=new f.l;m.L(c),c.da()>u?m.X(0,-u):m.X(-u,0);var g=!1;return c.da()>u?o.y>m.G&&o.y<m.H&&(g=!0):o.x>m.v&&o.x<m.C&&(g=!0),g}return(m=new f.l).L(c),m.X(-u,-u),m.jm(o)},h.HU=function(o,c,u){return h.nI(o,c,u)},h.ek=function(o,c,u){return h.Ac(o,c,u)&&h.Ac(c,o,u)},h.dk=function(o,c,u){var m=new f.l;return m.L(c),m.X(u,u),!o.isIntersecting(m)},h.VP=function(o,c,u){if(o.da()<=u&&o.S()<=u){var m=o.tf();return h.YA(m,c,u)}if(c.da()<=u&&c.S()<=u)return m=c.tf(),h.YA(m,o,u);if(o.da()>u&&o.S()>u&&(c.da()<=u||c.S()<=u)?m=c:(m=o,o=c),m.da()<=u||m.S()<=u){if(o.da()<=u||o.S()<=u){c=new f.zb;var g=new f.zb,v=[0,0],w=[0,0],E=new f.h;return m.fn(E),c.Ec(E),m.gn(E),c.Rc(E),o.fn(E),g.Ec(E),o.gn(E),g.Rc(E),c.Fa(g,null,v,w,u),c.Fa(g,null,null,null,u)==1&&(v[0]==0||v[1]==1||w[0]==0||w[1]==1)}return c=new f.l,g=new f.l,c.L(o),c.X(-u,-u),g.L(c),g.Fa(m),!(!g.B()&&(g.da()>u||g.S()>u))}return o.X(u,u),(g=new f.l).L(m),g.Fa(o),!(g.B()||!g.B()&&g.da()>u&&g.S()>u)},h.UP=function(o,c,u){if(h.Ac(o,c,u)||h.Ac(c,o,u)||o.da()<=u&&o.S()<=u||c.da()<=u&&c.S()<=u)return!1;if(o.da()<=u||o.S()<=u){if(c.da()>u&&c.S()>u)return!1;var m=new f.zb,g=new f.zb,v=[0,0],w=[0,0],E=new f.h;return o.fn(E),m.Ec(E),o.gn(E),m.Rc(E),c.fn(E),g.Ec(E),c.gn(E),g.Rc(E),m.Fa(g,null,v,w,u),m.Fa(g,null,null,null,u)==2&&(0<v[0]||1>v[1])&&(0<w[0]||1>w[1])}return!(c.da()<=u||c.S()<=u)&&((m=new f.l).L(o),m.Fa(c),!(m.B()||m.da()<=u||m.S()<=u))},h.bF=function(o,c,u){if(!h.Ac(o,c,u))return!1;if(o.da()<=u&&o.S()<=u)return o=o.tf(),h.ZA(o,c,u);if(c.da()<=u&&c.S()<=u)return c=c.tf(),h.ZA(c,o,u);if(o.da()<=u||o.S()<=u)return h.Ac(o,c,u);if(c.da()<=u||c.S()<=u){var m=new f.l;return m.L(o),m.X(-u,-u),m.jm(c)?!0:((o=new f.l).L(m),o.Fa(c),!(o.B()||o.da()<=u&&o.S()<=u))}return h.Ac(o,c,u)},h.TP=function(o,c,u){if(h.Ac(o,c,u)||h.Ac(c,o,u)||o.da()<=u&&o.S()<=u||c.da()<=u&&c.S()<=u||c.da()>u&&c.S()>u&&o.da()>u&&o.S()>u)return!1;if(o.da()>u&&o.S()>u)var m=c;else m=o,o=c;if(o.da()>u&&o.S()>u){c=new f.l;var g=new f.l;return g.L(o),g.X(-u,-u),c.L(g),c.Fa(m),!(c.B()||c.da()<=u&&c.S()<=u)}c=new f.zb,g=new f.zb;var v=[0,0],w=[0,0],E=new f.h;return m.fn(E),c.Ec(E),m.gn(E),c.Rc(E),o.fn(E),g.Ec(E),o.gn(E),g.Rc(E),c.Fa(g,null,v,w,u),c.Fa(g,null,null,null,u)==1&&0<v[0]&&1>v[1]&&0<w[0]&&1>w[1]},h.wI=function(o,c,u){var m=new f.l,g=new f.l,v=new f.am(o,c,u,!0);if(!v.next())return!0;if(this.LG(o,c,u))return!1;var w=o,E=null;c.K()==1736&&(E=c);var C=!1,R=!1;do{var I=v.pl(),F=v.jl();if(F=c.Oa(c.Ca(F)),m.L(v.oz()),m.X(u,u),m.contains(F)&&(F=f.jd.Zd(w,F,0))!=0||c.K()==1736&&(I=o.Oa(o.Ca(I)),g.L(v.Wy()),g.X(u,u),g.contains(I)&&(F=f.jd.Zd(E,I,0))!=0))return!1;C||(!f.Fg.Ol(o,c.ea()-1)||o.Cb!=null&&o.Cb.Gb!=null?w=o:(w=new f.Ea,o.copyTo(w),w.gj(1)),C=!0),c.K()!=1736||R||(R=c,!f.Fg.Ol(R,o.ea()-1)||c.Cb!=null&&c.Cb.Gb!=null?E=c:(E=new f.Ea,R.copyTo(E),E.gj(1)),R=!0)}while(v.next());return!0},h.Ac=function(o,c,u){var m=new f.l;return m.L(o),m.X(u,u),m.contains(c)},h.ms=function(o,c,u){var m=new f.l;return m.L(c),m.X(u,u),c=new f.h,o.fn(c),!m.contains(c)||(o.SI(c),!m.contains(c)||(o.VI(c),!m.contains(c)||(o.gn(c),!m.contains(c))))},h.WH=function(o,c,u){if(o.ea()!=c.ea()||o.I()!=c.I())return!1;var m=new f.h,g=new f.h,v=!0;u*=u;for(var w=0;w<o.ea();w++){if(o.Wc(w)!=c.Wc(w)){v=!1;break}for(var E=o.Ca(w);E<c.Wc(w);E++)if(o.D(E,m),c.D(E,g),f.h.zc(m,g)>u){v=!1;break}if(!v)break}return!!v},h.$T=function(o,c,u){if(o.I()!=c.I())return!1;var m=new f.h,g=new f.h,v=!0;u*=u;for(var w=0;w<o.I();w++)if(o.D(w,m),c.D(w,g),f.h.zc(m,g)>u){v=!1;break}return!!v},h.SA=function(o,c,u,m,g,v){var w=!1;if(o.I()>c.I()){m&&(m=!1,w=!0);var E=c}else E=o,o=c;if(c=null,g||v||w){c=new f.rn(o.I());for(var C=0;C<o.I();C++)c.write(C,0)}C=new f.l;var R=new f.l,I=new f.l;E.A(C),o.A(R),C.X(u,u),R.X(u,u),I.L(C),I.Fa(R),R=new f.h;for(var F=new f.h,U=!0,j=f.ta.gE(o,I),ee=j.getIterator(),te=u*u,Z=0;Z<E.I();Z++)if(E.D(Z,R),I.contains(R)){var le=!1;C.L(R.x,R.y,R.x,R.y),ee.Yi(C,u);for(var ve=ee.next();ve!=-1&&(ve=j.ka(ve),o.D(ve,F),!(f.h.zc(R,F)<=te&&((g||v||w)&&c.write(ve,1),le=!0,m)));ve=ee.next());if(!le&&(U=!1,g||m))return!1}else{if(g||m)return!1;U=!1}if(v&&U)return!1;if(m)return!0;for(C=0;C<o.I();C++)if(c.read(C)==1){if(v)return!0}else if(g||w)return!1;return!v},h.ZH=function(o,c,u){if(o.I()>c.I())var m=c;else m=o,o=c;c=new f.l;var g=new f.l,v=new f.l;m.A(c),o.A(g),c.X(u,u),g.X(u,u),v.L(c),v.Fa(g),g=new f.h;for(var w=new f.h,E=u*u,C=f.ta.gE(o,v),R=C.getIterator(),I=0;I<m.I();I++)if(m.D(I,g),v.contains(g)){c.L(g.x,g.y,g.x,g.y),R.Yi(c,u);for(var F=R.next();F!=-1;F=R.next())if(o.D(C.ka(F),w),f.h.zc(g,w)<=E)return!0}return!1},h.Rz=function(o,c,u,m){return h.Am(o,c,u,m)&&h.Am(c,o,u,m)},h.Am=function(o,c,u,m){function g(Je,pt){return F.IE(Je,pt)}var v,w=!0,E=[0,0],C=[0,0],R=0,I=new f.ja(0),F=new h,U=new f.l,j=new f.l,ee=new f.l;o.A(U),c.A(j),U.X(u,u),j.X(u,u),ee.L(U),ee.Fa(j),o=o.Ha(),j=c.Ha();var te=null,Z=te=null,le=c.Cb;for(le!=null?(te=le.Gb,Z=le.Ao,te==null&&(te=f.ta.kj(c,ee))):te=f.ta.kj(c,ee),c=te.getIterator(),le=null,Z!=null&&(le=Z.getIterator());o.ab();)for(;o.Ia();){var ve=!1,be=o.ia();if(be.A(U),!U.isIntersecting(ee)||le!=null&&(le.Yi(U,u),le.next()==-1))return!1;for(Z=be.Rb(),c.Vo(be,u),v=c.next();v!=-1;v=c.next()){j.Wb(te.ka(v)),v=j.ia();var ue=be.Fa(v,null,E,C,u);if(ue==2&&(!m||C[0]<=C[1])){ue=E[0];var Le=E[1],Be=C[0],it=C[1];if(ue*Z<=u&&(1-Le)*Z<=u){ve=!0,R=0,I.resize(0),F.sh.length=0;var Ke=o.xb();for(Be=!0;Be;){if(o.Ia()){if(Z=(be=o.ia()).Rb(),(ue=be.Fa(v,null,E,C,u))==2&&(!m||C[0]<=C[1])&&(ue=E[0],Le=E[1],ue*Z<=u&&(1-Le)*Z<=u)){Ke=o.xb();continue}if(j.Ia()&&(v=j.ia(),(ue=be.Fa(v,null,E,C,u))==2&&(!m||C[0]<=C[1])&&(ue=E[0],Le=E[1],ue*Z<=u&&(1-Le)*Z<=u))){Ke=o.xb();continue}}Be=!1}Ke!=o.xb()&&(o.Wb(Ke),o.ia());break}Ke=o.xb(),v=T.construct(Ke,o.gb,ue,Le,j.xb(),j.gb,Be,it),F.sh.push(v),I.add(I.size)}}if(!ve){if(R==F.sh.length)return!1;for(1<I.size-R&&I.Wd(R,I.size,g),ve=0;R<F.sh.length;R++)if(!((v=F.sh[I.get(R)]).Lj<ve&&v.Ti<ve)){if(Z*(v.Lj-ve)>u)return!1;if(Z*(1-(ve=v.Ti))<=u||ve==1)break}if(Z*(1-ve)>u)return!1;R=0,I.resize(0),F.sh.length=0}}return w},h.NG=function(o,c,u){if(1>h.Sz(o,c,u,null))return!1;var m=new f.l,g=new f.l;o.A(m),c.A(g);var v=h.ms(m,g,u);return m=h.ms(g,m,u),!(!v||!m)||(v&&!m?!h.Am(c,o,u,!1):m&&!v?!h.Am(o,c,u,!1):!h.Am(o,c,u,!1)&&!h.Am(c,o,u,!1))},h.Sz=function(o,c,u,m){function g(Ji,Zi){return U.IE(Ji,Zi)}if(o.sz()>c.sz())var v=c,w=o;else v=o,w=c;o=v.Ha(),c=w.Ha();var E=[0,0],C=[0,0],R=-1,I=0,F=new f.ja(0),U=new h,j=new f.l,ee=new f.l,te=new f.l;v.A(j),w.A(ee),j.X(u,u),ee.X(u,u),te.L(j),te.Fa(ee),v=null,m!=null&&(v=new f.h);var Z=ee=ee=null,le=w.Cb;for(le!=null?(ee=le.Gb,Z=le.Ao,ee==null&&(ee=f.ta.kj(w,te))):ee=f.ta.kj(w,te),w=ee.getIterator(),le=null,Z!=null&&(le=Z.getIterator());o.ab();)for(Z=0;o.Ia();){var ve=o.ia();if(ve.A(j),j.isIntersecting(te)){if(le!=null&&(le.Yi(j,u),le.next()==-1))continue;var be=ve.Rb();w.Vo(ve,u);for(var ue=w.next();ue!=-1;ue=w.next()){var Le=ee.ka(ue);c.Wb(Le);var Be=c.ia(),it=Be.Rb(),Ke=ve.Fa(Be,null,E,C,u);if(0<Ke){ue=E[0],R=C[0];var Je=Ke==2?E[1]:NaN,pt=Ke==2?C[1]:NaN;if(Ke==2){if(be*(Je-ue)>u)return 1;var qt=be*(Je-ue);if(c.Ia()){if(Be=c.ia(),(Ke=ve.Fa(Be,null,E,null,u))==2){Ke=E[0];var ri=E[1];if(qt+(Ke=be*(ri-Ke))>u)return 1}c.Wb(Le),c.ia()}if(!c.xm()){if(c.mi(),Be=c.mi(),(Ke=ve.Fa(Be,null,E,null,u))==2&&(Ke=E[0],qt+(Ke=be*((ri=E[1])-Ke))>u))return 1;c.Wb(Le),c.ia()}if(o.Ia()){if(Le=o.xb(),(Ke=(ve=o.ia()).Fa(Be,null,E,null,u))==2&&(Ke=E[0],qt+(Ke=be*((ri=E[1])-Ke))>u))return 1;o.Wb(Le),o.ia()}if(!o.xm()){if(Le=o.xb(),o.mi(),(Ke=(ve=o.mi()).Fa(Be,null,E,null,u))==2&&(Ke=E[0],qt+(Ke=it*((ri=E[1])-Ke))>u))return 1;o.Wb(Le),o.ia()}Be=T.construct(o.xb(),o.gb,ue,Je,c.xb(),c.gb,R,pt),U.sh.push(Be),F.add(F.size)}R=0,m!=null&&(ve.ic(ue,v),m.add(v.x),m.add(v.y))}}if(I<U.sh.length){for(F.Wd(I,F.size,g),ve=0,ue=U.sh[F.get(I)].Om;I<U.sh.length;I++)if(!((Be=U.sh[F.get(I)]).Lj<ve&&Be.Ti<ve))if(be*(Be.Lj-ve)>u)Z=be*(Be.Ti-Be.Lj),ve=Be.Ti,ue=Be.Om;else{if(Be.Om!=ue?(Z=be*(Be.Ti-Be.Lj),ue=Be.Om):Z+=be*(Be.Ti-Be.Lj),Z>u)return 1;if((ve=Be.Ti)==1)break}be*(1-ve)>u&&(Z=0),I=0,F.resize(0),U.sh.length=0}}}return R},h.LG=function(o,c,u){var m=o.Ha(),g=c.Ha();for(o=new f.am(o,c,u,!1);o.next();){c=o.pl();var v=o.jl();if(m.Wb(c),g.Wb(v),c=m.ia(),0<g.ia().Fa(c,null,null,null,u))return!0}return!1},h.MG=function(o,c,u,m){var g=o.Ha(),v=new f.l,w=new f.l,E=new f.l;o.A(v),c.A(w),v.X(u,u),v.contains(w),w.X(u,u),E.L(v),E.Fa(w),(v=o.Cb)!=null?(v=v.Gb)==null&&(v=f.ta.kj(o,E)):v=f.ta.kj(o,E),o=v.getIterator();for(var C=new f.h,R=new f.h,I=u*u,F=0;F<c.I();F++)if(c.D(F,C),E.contains(C)){w.L(C.x,C.y,C.x,C.y),o.Yi(w,u);for(var U=!1,j=o.next();j!=-1;j=o.next())if(g.Wb(v.ka(j)),(j=g.ia()).ic(j.fe(C,!1),R),f.h.zc(R,C)<=I){U=!0;break}if(m){if(!U)return!1}else if(U)return!0}return!!m},h.Tz=function(o,c,u){var m=new f.h,g=u*u,v=o.Ha();if((o=o.Cb)!=null&&(o=o.Gb)!=null){var w=new f.l;for(w.L(c),w=(u=o.EF(w,u)).next();w!=-1;w=u.next())if(v.Wb(o.ka(w)),v.Ia()){var E=(w=v.ia()).fe(c,!1);if(w.ic(E,m),f.h.zc(c,m)<=g)return!0}return!1}for(o=new f.l;v.ab();)for(;v.Ia();)if((w=v.ia()).A(o),o.X(u,u),o.contains(c)&&(E=w.fe(c,!1),w.ic(E,m),f.h.zc(c,m)<=g))return!0;return!1},h.JG=function(o,c,u){return h.Tz(o,c,u)&&!h.Uz(o,c,u)},h.Uz=function(o,c,u){return o=o.mg(),!h.kt(o,c,u)},h.KG=function(o,c,u){if(o.vm()){var m=new f.zb(c.v,c.G,c.v,c.H),g=new f.zb(c.v,c.H,c.C,c.H),v=new f.zb(c.C,c.H,c.C,c.G);for(c=new f.zb(c.C,c.G,c.v,c.G),o=o.Ha();o.ab();)for(;o.Ia();){var w=o.ia();if(w.isIntersecting(m,u)||w.isIntersecting(g,u)||w.isIntersecting(v,u)||w.isIntersecting(c,u))return!0}}else{(m=new f.l).L(c),m.X(u,u),u=o.vb(0),g=new f.h,v=new f.h,c=new f.h,w=new f.h;for(var E=0,C=o.ea();E<C;E++)for(var R=!0,I=o.Ca(E),F=o.Wc(E);I<F;I++)if(R)u.uc(2*I,v),R=!1;else{if(u.uc(2*I,g),c.N(v),w.N(g),m.ty(c,w)!=0)return!0;v.N(g)}}return!1},h.qc=function(o,c,u){var m=o.K(),g=c.K();if(f.ba.yj(m)){var v=o.Cb;if(v!=null&&(v=v.Fk)!=null)if(g==33){var w=c.D();if((w=v.To(w.x,w.y))==1)return 1;if(w==0)return 4}else{if(w=new f.l,c.A(w),(w=v.So(w))==1)return 1;if(w==0)return 4;if(u&&f.ba.yj(g)&&h.zE(c,v))return 1073741824}}if(f.ba.yj(g)&&(v=c.Cb)!=null&&(v=v.Fk)!=null)if(m==33){if(o=o.D(),(w=v.To(o.x,o.y))==1)return 2;if(w==0)return 4}else{if(c=new f.l,o.A(c),(w=v.So(c))==1)return 2;if(w==0)return 4;if(u&&f.ba.yj(m)&&h.zE(o,v))return 1073741824}return 0},h.zE=function(o,c){for(var u=o.I(),m=new f.h,g=0;g<u;g++)if(o.D(g,m),c.To(m.x,m.y)==1)return!0;return!1},h.AI=function(o,c,u,m){for(var g=1<=o.qm(0)&&1<=c.qm(0),v=o.Ha(),w=c.Ha(),E=[0,0],C=[0,0],R=new f.am(o,c,u,!1),I=!1;R.next();){var F=R.pl(),U=R.jl();if(v.Wb(F),w.Wb(U),F=v.ia(),(U=w.ia().Fa(F,null,C,E,u))==2){if(I=E[0],U=E[1],F=F.Rb(),g&&(U-I)*F>u)return!1;I=!0}else if(U!=0){if(I=E[0],F=C[0],0<I&&1>I&&0<F&&1>F)return!1;I=!0}}return!!I&&(v=new f.l,w=new f.l,g=new f.l,o.A(v),c.A(w),v.X(1e3*u,1e3*u),w.X(1e3*u,1e3*u),g.L(v),g.Fa(w),!(10<o.I()&&(o=f.Vd.clip(o,g,u,0),o.B())||10<c.I()&&(c=f.Vd.clip(c,g,u,0),c.B()))&&f.cm.rt(o,c,u,"F********",m))},h.xI=function(o,c,u,m){var g=1<=o.qm(0)&&1<=c.qm(0),v=new f.l,w=new f.l,E=new f.l;o.A(v),c.A(w);for(var C=!1,R=h.ms(v,w,u),I=h.ms(w,v,u),F=o.Ha(),U=c.Ha(),j=[0,0],ee=[0,0],te=new f.am(o,c,u,!1);te.next();){var Z=te.pl(),le=te.jl();if(F.Wb(Z),U.Wb(le),le=F.ia(),(Z=U.ia().Fa(le,null,ee,j,u))==2){Z=j[0];var ve=j[1];if(le=le.Rb(),g&&(ve-Z)*le>u&&(C=!0,R&&I))return!0}else if(Z!=0&&(Z=j[0],le=ee[0],0<Z&&1>Z&&0<le&&1>le))return!0}if(g=new f.l,F=new f.l,g.L(v),g.X(1e3*u,1e3*u),F.L(w),F.X(1e3*u,1e3*u),E.L(g),E.Fa(F),v="",v=C?v+"**":v+"T*",R){if(10<c.I()&&(c=f.Vd.clip(c,E,u,0)).B())return!1;v+="****"}else v+="T***";if(I){if(10<o.I()&&(o=f.Vd.clip(o,E,u,0)).B())return!1;v+="***"}else v+="T**";return f.cm.rt(o,c,u,v.toString(),m)},h.tI=function(o,c,u,m){var g=[!1],v=h.rI(o,c,u,g);return g[0]?v:(g=new f.l,c.A(g),g.X(1e3*u,1e3*u),!(10<o.I()&&(o=f.Vd.clip(o,g,u,0),o.B()))&&f.cm.Tw(o,c,u,m))},h.rI=function(o,c,u,m){m[0]=!1;for(var g=o.Ha(),v=c.Ha(),w=[0,0],E=[0,0],C=new f.am(o,c,u,!1),R=!1;C.next();){var I=C.pl(),F=C.jl();if(g.Wb(I,-1),v.Wb(F,-1),I=g.ia(),(I=v.ia().Fa(I,null,E,w,u))!=0&&(R=!0,I==1&&(I=w[0],F=E[0],0<I&&1>I&&0<F&&1>F)))return m[0]=!0,!1}if(!R){for(m[0]=!0,w=new f.l,o.A(w),w.X(u,u),C=o,R=!1,E=new f.l,m=0,g=c.ea();m<g;m++)if(0<c.Ka(m)){if(c.Sj(m,E),!w.isIntersecting(E)||(v=c.Oa(c.Ca(m)),(v=f.Fg.ym(C,v,0))==0))return!1;R||(!f.Fg.Ol(o,c.ea()-1)||o.Cb!=null&&o.Cb.Gb!=null?C=o:(v=new f.Ea,o.copyTo(v),v.gj(1),C=v),R=!0)}if(o.ea()==1||c.K()==1607)return!0;for(w=new f.l,c.A(w),w.X(u,u),E=c,C=!1,u=new f.l,m=0,g=o.ea();m<g;m++)if(0<o.Ka(m)){if(o.Sj(m,u),w.isIntersecting(u)&&(v=o.Oa(o.Ca(m)),(v=f.Fg.ym(E,v,0))==1))return!1;C||(!f.Fg.Ol(c,o.ea()-1)||c.Cb!=null&&c.Cb.Gb!=null?E=c:(v=new f.Ea,c.copyTo(v),v.gj(1),E=v),C=!0)}return!0}return!1},h.BI=function(o,c,u,m){for(var g=o.Ha(),v=c.Ha(),w=[0,0],E=[0,0],C=new f.am(o,c,u,!1),R=!1;C.next();){var I=C.pl(),F=C.jl();if(g.Wb(I),v.Wb(F),I=g.ia(),(I=v.ia().Fa(I,null,E,w,u))==2)R=!0;else if(I!=0){if(R=w[0],I=E[0],0<R&&1>R&&0<I&&1>I)return!1;R=!0}}return!!R&&(v=new f.l,w=new f.l,g=new f.l,o.A(v),c.A(w),v.X(1e3*u,1e3*u),w.X(1e3*u,1e3*u),g.L(v),g.Fa(w),!(10<o.I()&&(o=f.Vd.clip(o,g,u,0),o.B())||10<c.I()&&(c=f.Vd.clip(c,g,u,0),c.B()))&&f.cm.bn(o,c,u,"F********",m))},h.vI=function(o,c,u,m){for(var g=o.Ha(),v=c.Ha(),w=[0,0],E=[0,0],C=new f.am(o,c,u,!1),R=!1;C.next();){var I=C.pl(),F=C.jl();if(g.Wb(I),v.Wb(F),I=g.ia(),(I=v.ia().Fa(I,null,E,w,u))==2)R=!0;else if(I!=0){if(R=w[0],I=E[0],0<R&&1>R&&0<I&&1>I)return!0;R=!0}}return!!R&&(v=new f.l,w=new f.l,E=new f.l,C=new f.l,g=new f.l,o.A(v),c.A(w),h.ms(w,v,u)?(E.L(v),E.X(1e3*u,1e3*u),C.L(w),C.X(1e3*u,1e3*u),g.L(E),g.Fa(C),!(10<o.I()&&(o=f.Vd.clip(o,g,u,0),o.B())||10<c.I()&&(c=f.Vd.clip(c,g,u,0),c.B()))&&(u=f.cm.bn(o,c,u,"T********",m))):u=f.cm.bn(o,c,u,"T*****T**",m))},h.uI=function(o,c,u,m){var g=[!1],v=h.rI(o,c,u,g);return g[0]?v:(g=new f.l,c.A(g),g.X(1e3*u,1e3*u),!(10<o.I()&&(o=f.Vd.clip(o,g,u,0),o.B()))&&f.cm.$A(o,c,u,m))},h.sI=function(o,c,u){return f.jd.Zd(o,c,u)==1},h.zI=function(o,c,u){return f.jd.Zd(o,c,u)==2},h.kt=function(o,c,u){var m=new f.h;u*=u;for(var g=0;g<o.I();g++)if(o.D(g,m),f.h.zc(m,c)<=u)return!1;return!0},h.prototype.IE=function(o,c){return o=this.sh[o],c=this.sh[c],o.Om<c.Om||o.Om==c.Om&&(o.qw<c.qw||o.qw==c.qw&&(o.Lj<c.Lj||o.Lj==c.Lj&&(o.Ti<c.Ti||o.Ti==c.Ti&&o.tH<c.tH)))?-1:1},h}();f.vd=d}(ae||(ae={})),function(f){var N,T,d;(T=N||(N={}))[T.InteriorInterior=0]="InteriorInterior",T[T.InteriorBoundary=1]="InteriorBoundary",T[T.InteriorExterior=2]="InteriorExterior",T[T.BoundaryInterior=3]="BoundaryInterior",T[T.BoundaryBoundary=4]="BoundaryBoundary",T[T.BoundaryExterior=5]="BoundaryExterior",T[T.ExteriorInterior=6]="ExteriorInterior",T[T.ExteriorBoundary=7]="ExteriorBoundary",T[T.ExteriorExterior=8]="ExteriorExterior",function(h){h[h.AreaAreaPredicates=0]="AreaAreaPredicates",h[h.AreaLinePredicates=1]="AreaLinePredicates",h[h.LineLinePredicates=2]="LineLinePredicates",h[h.AreaPointPredicates=3]="AreaPointPredicates",h[h.LinePointPredicates=4]="LinePointPredicates",h[h.PointPointPredicates=5]="PointPointPredicates"}(d||(d={})),N=function(){function h(){this.le=0,this.j=new f.ju,this.J=[0,0,0,0,0,0,0,0,0],this.$a=[0,0,0,0,0,0,0,0,0],this.fa=[!1,!1,!1,!1,!1,!1,!1,!1,!1],this.Um=this.ww=-1}return h.sB=function(o,c,u,m,g){if(m.length!=9)throw f.i.ga("relation string length has to be 9 characters");for(var v=0;9>v;v++){var w=m.charAt(v);if(w!="*"&&w!="T"&&w!="F"&&w!="0"&&w!="1"&&w!="2")throw f.i.ga("relation string")}if((v=this.DR(m,o.Eb(),c.Eb()))!=0)return f.vd.tB(o,c,u,v,g);v=new f.l,o.A(v),w=new f.l,c.A(w);var E=new f.l;if(E.L(v),E.$b(w),u=f.ta.Xd(u,E,!1),o=this.OE(o,u),c=this.OE(c,u),o.B()||c.B())return this.kW(o,c,m);switch(v=c.K(),w=!1,o.K()){case 1736:switch(v){case 1736:w=this.rt(o,c,u,m,g);break;case 1607:w=this.bn(o,c,u,m,g);break;case 33:w=this.qt(o,c,u,m);break;case 550:w=this.pt(o,c,u,m,g)}break;case 1607:switch(v){case 1736:w=this.bn(c,o,u,this.aq(m),g);break;case 1607:w=this.aB(o,c,u,m,g);break;case 33:w=this.tt(o,c,u,m,g);break;case 550:w=this.st(o,c,u,m,g)}break;case 33:switch(v){case 1736:w=this.qt(c,o,u,this.aq(m));break;case 1607:w=this.tt(c,o,u,this.aq(m),g);break;case 33:w=this.QU(o,c,u,m);break;case 550:w=this.lt(c,o,u,this.aq(m))}break;case 550:switch(v){case 1736:w=this.pt(c,o,u,this.aq(m),g);break;case 1607:w=this.st(c,o,u,this.aq(m),g);break;case 550:w=this.TA(o,c,u,m,g);break;case 33:w=this.lt(o,c,u,m)}break;default:w=!1}return w},h.rt=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.pJ();var w=new f.l,E=new f.l;return o.A(w),c.A(E),m=!1,f.vd.dk(w,E,u)&&(v.Du(o,c),m=!0),m||((w=f.vd.qc(o,c,!1))==4?(v.Du(o,c),m=!0):w==1?(v.gy(c),m=!0):w==2&&(v.RD(o),m=!0)),m||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.Dp(o,c),v.j.Vg()),h.fg(v.J,v.Yc)},h.Tw=function(o,c,u,m){var g=new h;g.Zi(),g.cj("T*****F**"),g.pJ();var v=new f.l,w=new f.l;o.A(v),c.A(w);var E=!1;return f.vd.dk(v,w,u)&&(g.Du(o,c),E=!0),E||((v=f.vd.qc(o,c,!1))==4?(g.Du(o,c),E=!0):v==1?(g.gy(c),E=!0):v==2&&(g.RD(o),E=!0)),E?this.fg(g.J,g.Yc):(o=(E=new f.hd).Ib(o),v=E.Ib(c),f.Tk.W(E,u,m,!1),u=E.Ke(v).mg(),E.Ip(0,!0,!0),f.tn.W(E,o,-1,!1,m),E.I(o)!=0&&(f.tn.W(E,v,-1,!1,m),g.gr(E,m),(c=E.I(v)==0)||(g.Dp(o,v),g.j.Vg(),v=this.fg(g.J,g.Yc))?(o=E.Ke(o),o=(E=new f.hd).Ib(o),v=E.Ib(u),g.gr(E,m),g.le=0,g.Zi(),g.cj(c?"T*****F**":"******F**"),g.CB(),g.Dp(o,v),g.j.Vg(),this.fg(g.J,g.Yc)):v))},h.bn=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.CB();var w=new f.l,E=new f.l;return o.A(w),c.A(E),m=!1,f.vd.dk(w,E,u)&&(v.Eu(o,c),m=!0),m||((w=f.vd.qc(o,c,!1))==4?(v.Eu(o,c),m=!0):w==1&&(v.SD(c),m=!0)),m||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.lh=v.j.Fp(),h.Kw(c,v.j,v.lh),v.Dp(o,c),v.j.Gp(v.lh),v.j.Vg()),h.fg(v.J,v.Yc)},h.$A=function(o,c,u,m){var g=new h;g.Zi(),g.cj("T*****F**"),g.CB();var v=new f.l,w=new f.l;o.A(v),c.A(w);var E=!1;return f.vd.dk(v,w,u)&&(g.Eu(o,c),E=!0),E||((v=f.vd.qc(o,c,!1))==4?(g.Eu(o,c),E=!0):v==1&&(g.SD(c),E=!0)),E?this.fg(g.J,g.Yc):(o=(E=new f.hd).Ib(o),c=E.Ib(c),g.Xo(E,u,m),E.I(o)!=0&&(g.Dp(o,c),g.j.Vg(),this.fg(g.J,g.Yc)))},h.pt=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.qJ();var w=new f.l,E=new f.l;return o.A(w),c.A(E),m=!1,f.vd.dk(w,E,u)&&(v.Fu(o),m=!0),m||((w=f.vd.qc(o,c,!1))==4?(v.Fu(o),m=!0):w==1&&(v.rN(),m=!0)),m||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.Ay(o,c),v.j.Vg()),h.fg(v.J,v.Yc)},h.aB=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.SW(),m=new f.l;var w=new f.l;o.A(m),c.A(w);var E=!1;return f.vd.dk(m,w,u)&&(v.HG(o,c),E=!0),E||f.vd.qc(o,c,!1)!=4||(v.HG(o,c),E=!0),E||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.Zh=v.j.Fp(),v.lh=v.j.Fp(),h.Kw(o,v.j,v.Zh),h.Kw(c,v.j,v.lh),v.Dp(o,c),v.j.Gp(v.Zh),v.j.Gp(v.lh),v.j.Vg()),h.fg(v.J,v.Yc)},h.st=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.EJ(),m=new f.l;var w=new f.l;o.A(m),c.A(w);var E=!1;return f.vd.dk(m,w,u)&&(v.Qz(o),E=!0),E||f.vd.qc(o,c,!1)!=4||(v.Qz(o),E=!0),E||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.Zh=v.j.Fp(),h.Kw(o,v.j,v.Zh),v.Ay(o,c),v.j.Gp(v.Zh),v.j.Vg()),h.fg(v.J,v.Yc)},h.TA=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.JJ(),m=new f.l;var w=new f.l;o.A(m),c.A(w);var E=!1;return f.vd.dk(m,w,u)&&(v.qI(),E=!0),E||(o=(m=new f.hd).Ib(o),c=m.Ib(c),v.Xo(m,u,g),v.Ay(o,c),v.j.Vg()),h.fg(v.J,v.Yc)},h.qt=function(o,c,u,m){var g=new h;g.Zi(),g.cj(m),g.qJ();var v=new f.l;o.A(v),c=c.D();var w=!1;return f.vd.Sw(c,v,u)&&(g.Fu(o),w=!0),w||((u=f.jd.Zd(o,c,u))==1?(g.J[0]=0,g.J[2]=2,g.J[3]=-1,g.J[5]=1,g.J[6]=-1):u==2?(g.J[6]=-1,o.He()!=0?(g.J[0]=-1,g.J[3]=0,g.J[2]=2,g.J[5]=1):(g.J[0]=0,g.J[3]=-1,g.J[5]=-1,u=new f.l,o.A(u),g.J[2]=u.da()==0&&u.S()==0?-1:1)):g.Fu(o)),this.fg(g.J,m)},h.tt=function(o,c,u,m,g){var v=new h;v.Zi(),v.cj(m),v.EJ();var w=new f.l;o.A(w),m=c.D();var E=!1;if(f.vd.Sw(m,w,u)&&(v.Qz(o),E=!0),!E){w=null;var C=E=!1;(v.fa[0]||v.fa[6])&&(f.vd.Tz(o,m,u)?(v.fa[0]&&(w=f.ri.im(o,g),C=!f.vd.kt(w,m,u),E=!0,v.J[0]=C?-1:0),v.J[6]=-1):(v.J[0]=-1,v.J[6]=0)),v.fa[3]&&(w!=null&&w.B()?v.J[3]=-1:(E||(w==null&&(w=f.ri.im(o,g)),C=!f.vd.kt(w,m,u),E=!0),v.J[3]=C?0:-1)),v.fa[5]&&(w!=null&&w.B()?v.J[5]=-1:E&&!C?v.J[5]=0:(w==null&&(w=f.ri.im(o,g)),g=f.vd.Ow(w,c,u),v.J[5]=g?-1:0)),v.fa[2]&&(o.Rb()!=0?v.J[2]=1:((g=new f.de(o.description)).Gd(o,0,o.I()),o=f.vd.Ow(g,c,u),v.J[2]=o?-1:0))}return this.fg(v.J,v.Yc)},h.lt=function(o,c,u,m){var g=new h;g.Zi(),g.cj(m),g.JJ();var v=new f.l;o.A(v),c=c.D();var w=!1;if(f.vd.Sw(c,v,u)&&(g.qI(),w=!0),!w){v=!1,w=!0,u*=u;for(var E=0;E<o.I();E++){var C=o.Oa(E);if(f.h.zc(C,c)<=u?v=!0:w=!1,v&&!w)break}v?(g.J[0]=0,g.J[2]=w?-1:0,g.J[6]=-1):(g.J[0]=-1,g.J[2]=0,g.J[6]=0)}return h.fg(g.J,m)},h.QU=function(o,c,u,m){o=o.D(),c=c.D();for(var g=[],v=0;9>v;v++)g[v]=-1;return f.h.zc(o,c)<=u*u?g[0]=0:(g[2]=0,g[6]=0),g[8]=2,h.fg(g,m)},h.fg=function(o,c){for(var u=0;9>u;u++)switch(c.charAt(u)){case"T":if(o[u]==-1)return!1;break;case"F":if(o[u]!=-1)return!1;break;case"0":if(o[u]!=0)return!1;break;case"1":if(o[u]!=1)return!1;break;case"2":if(o[u]!=2)return!1}return!0},h.kW=function(o,c,u){var m=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(o.B()&&c.B()){for(var g=0;9>g;g++)m[g]=-1;return this.fg(m,u)}return g=!1,o.B()&&(o=c,g=!0),m[0]=-1,m[1]=-1,m[3]=-1,m[4]=-1,m[6]=-1,m[7]=-1,m[8]=2,c=o.K(),f.ba.Ic(c)?c==1736?o.He()!=0?(m[2]=2,m[5]=1):(m[5]=-1,c=new f.l,o.A(c),m[2]=c.da()==0&&c.S()==0?0:1):(c=o.Rb()!=0,m[2]=c?1:0,m[5]=f.ri.cq(o)?0:-1):(m[2]=0,m[5]=-1),g&&this.nK(m),this.fg(m,u)},h.DR=function(o,c,u){return h.WP(o)?3:h.MP(o)?4:h.RX(o,c,u)?8:h.uP(o,c,u)?16:h.XO(o)?1:h.uU(o,c,u)?32:0},h.WP=function(o){return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="F"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="F"&&o.charAt(6)=="F"&&o.charAt(7)=="F"&&o.charAt(8)=="*"},h.MP=function(o){return o.charAt(0)=="F"&&o.charAt(1)=="F"&&o.charAt(2)=="*"&&o.charAt(3)=="F"&&o.charAt(4)=="F"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"},h.RX=function(o,c,u){return(c!=0||u!=0)&&((c!=2||u!=2)&&(o.charAt(0)=="F"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="T"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"||c==1&&u==1&&o.charAt(0)=="F"&&o.charAt(1)=="T"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*")||u!=0&&o.charAt(0)=="F"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="T"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*")},h.uP=function(o,c,u){return c>u?o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*":c==1&&u==1&&o.charAt(0)=="0"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"},h.XO=function(o){return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="F"&&o.charAt(7)=="F"&&o.charAt(8)=="*"},h.uU=function(o,c,u){if(c==u){if(c!=1)return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="T"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*";if(o.charAt(0)=="1"&&o.charAt(1)=="*"&&o.charAt(2)=="T"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*")return!0}return!1},h.Kw=function(o,c,u){o=c.Ma(o);for(var m=c.Oe;m!=-1;m=c.Sf(m))if((c.yd(m)&o)!=0){var g=c.Je(m);if(g==-1)c.pn(m,u,0);else{var v=g,w=0;do(c.eh(v)&o)!=0&&w++,v=c.kc(c.ya(v));while(v!=g);c.pn(m,u,w)}}},h.aq=function(o){var c=""+o.charAt(0);return c+=o.charAt(3),c+=o.charAt(6),c+=o.charAt(1),c+=o.charAt(4),c+=o.charAt(7),c+=o.charAt(2),(c+=o.charAt(5))+o.charAt(8)},h.prototype.Zi=function(){for(var o=0;9>o;o++)this.J[o]=-2,this.$a[o]=-2},h.nK=function(o){var c=o[1],u=o[2],m=o[5];o[1]=o[3],o[2]=o[6],o[5]=o[7],o[3]=c,o[6]=u,o[7]=m},h.prototype.cj=function(o){for(this.Yc=o,o=0;9>o;o++)this.Yc.charAt(o)!="*"?(this.fa[o]=!0,this.le++):this.fa[o]=!1},h.prototype.MJ=function(){for(var o=0;9>o;o++)this.fa[o]&&this.J[o]==-2&&(this.J[o]=-1,this.fa[o]=!1)},h.prototype.pc=function(o){return this.J[o]!=-2&&(this.J[o]==-1?(this.fa[o]=!1,this.le--,!0):this.Yc.charAt(o)!="T"&&this.Yc.charAt(o)!="F"?!(this.J[o]<this.$a[o])&&(this.fa[o]=!1,this.le--,!0):(this.fa[o]=!1,this.le--,!0))},h.prototype.pJ=function(){this.ww=0,this.$a[0]=2,this.$a[1]=1,this.$a[2]=2,this.$a[3]=1,this.$a[4]=1,this.$a[5]=1,this.$a[6]=2,this.$a[7]=1,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.CB=function(){this.ww=1,this.Um=3,this.$a[0]=1,this.$a[1]=0,this.$a[2]=2,this.$a[3]=1,this.$a[4]=0,this.$a[5]=1,this.$a[6]=1,this.$a[7]=0,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.SW=function(){this.ww=2,this.Um=4,this.$a[0]=1,this.$a[1]=0,this.$a[2]=1,this.$a[3]=0,this.$a[4]=0,this.$a[5]=0,this.$a[6]=1,this.$a[7]=0,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.qJ=function(){this.Um=3,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=2,this.$a[3]=0,this.$a[4]=-1,this.$a[5]=1,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.EJ=function(){this.Um=4,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=1,this.$a[3]=0,this.$a[4]=-1,this.$a[5]=0,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.JJ=function(){this.Um=5,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=0,this.$a[3]=-1,this.$a[4]=-1,this.$a[5]=-1,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[3]&&(this.J[3]=-1,this.fa[3]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[5]&&(this.J[5]=-1,this.fa[5]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},h.prototype.pN=function(o,c,u){var m=!0;return this.fa[0]&&(this.tS(o,c,u),m=m&&this.pc(0)),this.fa[1]&&(this.kG(o,c,1),m=m&&this.pc(1)),this.fa[2]&&(this.lG(o,c,u,2),m=m&&this.pc(2)),this.fa[3]&&(this.kG(o,u,3),m=m&&this.pc(3)),this.fa[4]&&(this.tN(o,c,u),m=m&&this.pc(4)),this.fa[5]&&(this.XD(o,u,5),m=m&&this.pc(5)),this.fa[6]&&(this.lG(o,u,c,6),m=m&&this.pc(6)),this.fa[7]&&(this.XD(o,c,7),m=m&&this.pc(7)),m},h.prototype.Du=function(o,c){this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.Hr(o,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5)),this.Hr(c,this.fa[6]?6:-1,this.Yc.charAt(6),this.fa[7]?7:-1,this.Yc.charAt(7))},h.prototype.Hr=function(o,c,u,m,g){c==-1&&m==-1||((u!="T"&&u!="F"&&c!=-1||g!="T"&&g!="F"&&m!=-1)&&o.He()==0?(m!=-1&&(this.J[m]=-1),c!=-1&&(u=new f.l,o.A(u),this.J[c]=u.da()==0&&u.S()==0?0:1)):(c!=-1&&(this.J[c]=2),m!=-1&&(this.J[m]=1)))},h.prototype.gy=function(o){this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1,this.Hr(o,this.fa[0]?0:-1,this.Yc.charAt(0),this.fa[1]?1:-1,this.Yc.charAt(1))},h.prototype.RD=function(o){this.gy(o),h.nK(this.J)},h.prototype.Eu=function(o,c){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.fa[6]){var u=this.Yc.charAt(6);u=u=="T"||u=="F"||c.Rb()!=0,this.J[6]=u?1:0}this.fa[7]&&(c=f.ri.cq(c),this.J[7]=c?0:-1),this.Hr(o,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5))},h.prototype.SD=function(o){if(this.fa[0]){var c=this.Yc.charAt(0);c=c=="T"||c=="F"||o.Rb()!=0,this.J[0]=c?1:0}this.fa[1]&&(o=f.ri.cq(o),this.J[1]=o?0:-1),this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1},h.prototype.Fu=function(o){this.J[0]=-1,this.J[3]=-1,this.J[6]=0,this.Hr(o,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5))},h.prototype.rN=function(){this.J[0]=0,this.J[2]=2,this.J[3]=-1,this.J[5]=1,this.J[6]=-1},h.prototype.HG=function(o,c){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.fa[2]){var u=this.Yc.charAt(2);u=u=="T"||u=="F"||o.Rb()!=0,this.J[2]=u?1:0}this.fa[5]&&(o=f.ri.cq(o),this.J[5]=o?0:-1),this.fa[6]&&(u=(u=this.Yc.charAt(6))=="T"||u=="F"||c.Rb()!=0,this.J[6]=u?1:0),this.fa[7]&&(c=f.ri.cq(c),this.J[7]=c?0:-1)},h.prototype.Qz=function(o){if(this.J[0]=-1,this.J[3]=-1,this.fa[2]){var c=this.Yc.charAt(2);c=c=="T"||c=="F"||o.Rb()!=0,this.J[2]=c?1:0}this.fa[5]&&(o=f.ri.cq(o),this.J[5]=o?0:-1),this.J[6]=0},h.prototype.qI=function(){this.J[0]=-1,this.J[2]=0,this.J[6]=0},h.prototype.qN=function(o,c,u){var m=!0;return this.fa[0]&&(this.uS(o,c),m=m&&this.pc(0)),this.fa[1]&&(this.qS(o,c,u,this.lh),m=m&&this.pc(1)),this.fa[2]&&(this.rS(o,c),m=m&&this.pc(2)),this.fa[3]&&(this.xN(o,c,u,this.lh),m=m&&this.pc(3)),this.fa[4]&&(this.uN(o,c,u,this.lh),m=m&&this.pc(4)),this.fa[5]&&(this.vN(o,c,u),m=m&&this.pc(5)),this.fa[6]&&(this.dQ(o,c),m=m&&this.pc(6)),this.fa[7]&&(this.cQ(o,c,u,this.lh),m=m&&this.pc(7)),m},h.prototype.cT=function(o,c,u){var m=!0;return this.fa[0]&&(this.xS(o,c,u,this.Zh,this.lh),m=m&&this.pc(0)),this.fa[1]&&(this.mG(o,c,u,this.Zh,this.lh,1),m=m&&this.pc(1)),this.fa[2]&&(this.nG(o,c,u,2),m=m&&this.pc(2)),this.fa[3]&&(this.mG(o,u,c,this.lh,this.Zh,3),m=m&&this.pc(3)),this.fa[4]&&(this.zN(o,c,u,this.Zh,this.lh),m=m&&this.pc(4)),this.fa[5]&&(this.YD(o,u,this.Zh,5),m=m&&this.pc(5)),this.fa[6]&&(this.nG(o,u,c,6),m=m&&this.pc(6)),this.fa[7]&&(this.YD(o,c,this.lh,7),m=m&&this.pc(7)),m},h.prototype.TD=function(o,c,u){var m=!0;return this.fa[0]&&(this.vS(o,c),m=m&&this.pc(0)),this.fa[2]&&(this.sS(o,c),m=m&&this.pc(2)),this.fa[3]&&(this.yN(o,c,u),m=m&&this.pc(3)),this.fa[5]&&(this.wN(o,c),m=m&&this.pc(5)),this.fa[6]&&(this.eQ(o,c),m=m&&this.pc(6)),m},h.prototype.IG=function(o,c,u){var m=!0;return this.fa[0]&&(this.yS(o,c,u,this.Zh),m=m&&this.pc(0)),this.fa[2]&&(this.wS(o,u),m=m&&this.pc(2)),this.fa[3]&&(this.BN(o,c,u,this.Zh),m=m&&this.pc(3)),this.fa[5]&&(this.AN(o,c,u,this.Zh),m=m&&this.pc(5)),this.fa[6]&&(this.fQ(o,c,u),m=m&&this.pc(6)),m},h.prototype.PU=function(o,c,u){var m=!0;return this.fa[0]&&(this.zS(o,c,u),m=m&&this.pc(0)),this.fa[2]&&(this.oG(o,c,u,2),m=m&&this.pc(2)),this.fa[6]&&(this.oG(o,u,c,6),m=m&&this.pc(6)),m},h.prototype.tS=function(o,c,u){this.J[0]!=2&&((o=this.j.af(o))&c)!=0&&(o&u)!=0&&(this.J[0]=2)},h.prototype.kG=function(o,c,u){if(this.J[u]!=1){var m=this.j.af(this.j.ya(o));(this.j.af(o)&c)!=0&&(m&c)!=0&&(this.J[u]=1)}},h.prototype.lG=function(o,c,u,m){this.J[m]!=2&&((o=this.j.af(o))&c)!=0&&(o&u)==0&&(this.J[m]=2)},h.prototype.tN=function(o,c,u){if(this.J[4]!=1){var m=this.j.eh(o);(m&c)!=0&&(m&u)!=0?this.J[4]=1:this.J[4]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1&&((o=this.j.yd(this.j.vf(o)))&c)!=0&&(o&u)!=0&&(this.J[4]=0)}},h.prototype.XD=function(o,c,u){if(this.J[u]!=1){var m=this.j.af(this.j.ya(o));(this.j.af(o)&c)==0&&(m&c)==0&&(this.J[u]=1)}},h.prototype.uS=function(o,c){if(this.J[0]!=1){var u=this.j.af(this.j.ya(o));(this.j.af(o)&c)!=0&&(u&c)!=0&&(this.J[0]=1)}},h.prototype.qS=function(o,c,u,m){if(this.J[1]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1){var g=this.j.vf(o),v=this.j.yd(g);(v&c)==0&&(this.j.af(o)&c)!=0&&(o=this.j.ng(g,m),(v&u)!=0&&o%2!=0&&(this.J[1]=0))}},h.prototype.rS=function(o,c){this.J[2]!=2&&(this.j.eh(o)&c)!=0&&(this.J[2]=2)},h.prototype.xN=function(o,c,u,m){if(this.J[3]!=1){var g=this.j.eh(o);(g&c)!=0&&(g&u)!=0?this.J[3]=1:this.J[3]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1&&(g=this.j.vf(o),((o=this.j.yd(g))&c)!=0&&(c=this.j.ng(g,m),(o&u)!=0&&c%2==0&&(this.J[3]=0)))}},h.prototype.uN=function(o,c,u,m){if(this.J[4]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1){var g=this.j.vf(o);((o=this.j.yd(g))&c)!=0&&(c=this.j.ng(g,m),(o&u)!=0&&c%2!=0&&(this.J[4]=0))}},h.prototype.vN=function(o,c,u){this.J[5]!=1&&((o=this.j.eh(o))&c)!=0&&(o&u)==0&&(this.J[5]=1)},h.prototype.dQ=function(o,c){if(this.J[6]!=1){var u=this.j.af(this.j.ya(o));(this.j.af(o)&c)==0&&(u&c)==0&&(this.J[6]=1)}},h.prototype.cQ=function(o,c,u,m){if(this.J[7]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1){var g=this.j.vf(o),v=this.j.yd(g);(v&c)==0&&(this.j.af(o)&c)==0&&(o=this.j.ng(g,m),(v&u)!=0&&o%2!=0&&(this.J[7]=0))}},h.prototype.xS=function(o,c,u,m,g){if(this.J[0]!=1){var v=this.j.eh(o);(v&c)!=0&&(v&u)!=0?this.J[0]=1:this.J[0]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1&&(o=this.j.vf(o),((v=this.j.yd(o))&c)!=0&&(v&u)!=0&&(c=this.j.ng(o,m),g=this.j.ng(o,g),c%2==0&&g%2==0&&(this.J[0]=0)))}},h.prototype.mG=function(o,c,u,m,g,v){if(this.J[v]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1){o=this.j.vf(o);var w=this.j.yd(o);(w&c)!=0&&(w&u)!=0&&(c=this.j.ng(o,m),g=this.j.ng(o,g),c%2==0&&g%2!=0&&(this.J[v]=0))}},h.prototype.nG=function(o,c,u,m){this.J[m]!=1&&((o=this.j.eh(o))&c)!=0&&(o&u)==0&&(this.J[m]=1)},h.prototype.zN=function(o,c,u,m,g){if(this.J[4]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1){o=this.j.vf(o);var v=this.j.yd(o);(v&c)!=0&&(v&u)!=0&&(c=this.j.ng(o,m),g=this.j.ng(o,g),c%2!=0&&g%2!=0&&(this.J[4]=0))}},h.prototype.YD=function(o,c,u,m){this.J[m]!=0&&this.j.Bb(this.j.ue(this.j.ya(o)),this.Vi)!=1&&(o=this.j.vf(o),(this.j.yd(o)&c)==0&&this.j.ng(o,u)%2!=0&&(this.J[m]=0))},h.prototype.vS=function(o,c){this.J[0]!=0&&(this.j.yd(o)&c)==0&&(this.j.hk(this.j.Yy(o))&c)!=0&&(this.J[0]=0)},h.prototype.sS=function(o,c){this.J[2]!=2&&(this.j.yd(o)&c)!=0&&(this.J[2]=2)},h.prototype.yN=function(o,c,u){this.J[3]!=0&&((o=this.j.yd(o))&c)!=0&&(o&u)!=0&&(this.J[3]=0)},h.prototype.wN=function(o,c){this.J[5]!=1&&(this.j.yd(o)&c)!=0&&(this.J[5]=1)},h.prototype.eQ=function(o,c){this.J[6]!=0&&(this.j.yd(o)&c)==0&&(this.j.hk(this.j.Yy(o))&c)==0&&(this.J[6]=0)},h.prototype.yS=function(o,c,u,m){if(this.J[0]!=0){var g=this.j.yd(o);(g&c)!=0&&(g&u)!=0&&this.j.ng(o,m)%2==0&&(this.J[0]=0)}},h.prototype.wS=function(o,c){this.J[2]!=1&&(this.j.Je(o)!=-1?this.J[2]=1:this.J[2]!=0&&(this.j.yd(o)&c)==0&&(this.J[2]=0))},h.prototype.BN=function(o,c,u,m){if(this.J[3]!=0){var g=this.j.yd(o);(g&c)!=0&&(g&u)!=0&&this.j.ng(o,m)%2!=0&&(this.J[3]=0)}},h.prototype.AN=function(o,c,u,m){if(this.J[5]!=0){var g=this.j.yd(o);(g&c)!=0&&(g&u)==0&&this.j.ng(o,m)%2!=0&&(this.J[5]=0)}},h.prototype.fQ=function(o,c,u){this.J[6]!=0&&((o=this.j.yd(o))&c)==0&&(o&u)!=0&&(this.J[6]=0)},h.prototype.zS=function(o,c,u){this.J[0]!=0&&((o=this.j.yd(o))&c)!=0&&(o&u)!=0&&(this.J[0]=0)},h.prototype.oG=function(o,c,u,m){this.J[m]!=0&&((o=this.j.yd(o))&c)!=0&&(o&u)==0&&(this.J[m]=0)},h.prototype.Dp=function(o,c){var u=!1;o=this.j.Ma(o),c=this.j.Ma(c),this.Vi=this.j.ah();for(var m=this.j.Oe;m!=-1;m=this.j.Sf(m)){var g=this.j.Je(m);if(g==-1){if(this.Um!=-1)switch(this.Um){case 3:u=this.TD(m,o,c);break;case 4:u=this.IG(m,o,c);break;default:throw f.i.ga("internal error")}}else{var v=g;do{var w=v;if(this.j.Bb(w,this.Vi)!=1)do{switch(this.ww){case 0:u=this.pN(w,o,c);break;case 1:u=this.qN(w,o,c);break;case 2:u=this.cT(w,o,c);break;default:throw f.i.ga("internal error")}if(u)break;this.j.Kb(w,this.Vi,1),w=this.j.kc(w)}while(w!=v&&!u);if(u)break;v=this.j.kc(this.j.ya(w))}while(v!=g);if(u)break}}u||this.MJ(),this.j.Lg(this.Vi)},h.prototype.Ay=function(o,c){var u=!1;o=this.j.Ma(o),c=this.j.Ma(c);for(var m=this.j.Oe;m!=-1;m=this.j.Sf(m)){switch(this.Um){case 3:u=this.TD(m,o,c);break;case 4:u=this.IG(m,o,c);break;case 5:u=this.PU(m,o,c);break;default:throw f.i.Ra()}if(u)break}u||this.MJ()},h.prototype.gr=function(o,c){this.j.fr(o,c)},h.prototype.Xo=function(o,c,u){this.QP(o,c,u),this.gr(o,u)},h.prototype.QP=function(o,c,u){for(f.Tk.W(o,c,u,!1),o.Ip(0,!0,!0),c=o.ld;c!=-1;c=o.ve(c))o.jc(c)==1736&&f.tn.W(o,c,-1,!1,u)},h.OE=function(o,c){var u=o.K();return f.ba.zd(u)?((c=new f.Ua(o.description)).oc(o,!0),c):u==197?(u=new f.l,o.A(u),u.da()<=c&&u.S()<=c?(c=new f.Ta(o.description),o.tf(c),c):u.da()<=c||u.S()<=c?(c=new f.Ua(o.description),u=new f.Ta,o.If(0,u),c.nf(u),o.If(2,u),c.lineTo(u),c):((c=new f.Ea(o.description)).bd(o,!1),c)):o},h}(),f.cm=N}(ae||(ae={})),function(f){var N=function(){function h(o){this.Gm=new f.ja(0),this.ew=new f.ja(0),this.wt=new f.h,this.xt=new f.h,this.g=o,this.Is=-1}return h.prototype.cc=function(o){return this.g.cc(this.uz(o))},h.prototype.Cv=function(o){var c=this.dz(o);if(o=this.zF(o),this.g.Na(c)==o){var u=c;c=o,o=u}return this.g.Hc(c,this.wt),this.g.Hc(o,this.xt),this.wt.y<this.xt.y},h.prototype.uz=function(o){var c=this.dz(o);return o=this.zF(o),this.g.V(c)==o?c:o},h.prototype.dz=function(o){return this.Gm.get(o)},h.prototype.zF=function(o){return this.ew.get(o)},h.prototype.jF=function(o){this.Gm.set(o,this.Is),this.Is=o},h.prototype.fI=function(o){if(this.Is!=-1){var c=this.Is;return this.Is=this.Gm.get(c),this.Gm.set(c,o),this.ew.set(c,this.g.V(o)),c}return this.Gm==null&&(this.Gm=new f.ja(0),this.ew=new f.ja(0)),c=this.Gm.size,this.Gm.add(o),this.ew.add(this.g.V(o)),c},h.prototype.mz=function(o){return this.g.cd(this.dz(o))},h}();f.mY=N;var T=function(){function h(o){this.Ce=o,this.ie=new f.zb,this.Pm=new f.zb,this.uH=0,this.Bo=null,this.sA=-1}return h.prototype.compare=function(o,c,u){u=o.ka(u);var m=this.Ce.hb;if(this.sA==c)var g=this.uH;else this.Bo=m.cc(c),this.Bo==null?((o=m.g).fd(m.uz(c),this.ie),this.Bo=this.ie,g=this.ie.Me(this.Ce.zh,0)):g=this.Bo.Me(this.Ce.zh,0),this.uH=g,this.sA=c;if((o=m.cc(u))==null){(o=m.g).fd(m.uz(u),this.Pm),o=this.Pm;var v=this.Pm.Me(this.Ce.zh,0)}else v=o.Me(this.Ce.zh,0);return g==v&&(c=m.Cv(c),u=m.Cv(u),(c=.5*((u=Math.min(c?this.Bo.ma:this.Bo.oa,u?o.ma:o.oa))+this.Ce.zh))==this.Ce.zh&&(c=u),g=this.Bo.Me(c,0),v=o.Me(c,0)),g<v?-1:g>v?1:0},h.prototype.reset=function(){this.sA=-1},h}(),d=function(){function h(){this.Ym=this.Il=null,this.fb=new f.Yj,this.fb.JP(),this.ae=new T(this),this.fb.Wo(this.ae)}return h.prototype.zQ=function(){var o=!1;if(this.gw&&(o=this.AQ()),this.g.ea(this.Y)==1){var c=this.g.Ob(this.Y);return o=this.g.qz(c),this.g.JB(c,!0),0>o&&(o=this.g.Ya(c),this.g.hJ(o),this.g.Xg(c,this.g.Na(o)),!0)}for(this.Gl=this.g.Ey(),this.xo=this.g.Ey(),c=this.g.Ob(this.Y);c!=-1;c=this.g.Sb(c))this.g.ir(c,this.Gl,0),this.g.ir(c,this.xo,-1);c=new f.ja(0),this.zh=NaN;var u=new f.h;this.et=this.g.ea(this.Y),this.so=this.g.Hd(),this.Ss=this.g.Hd();for(var m=this.Il.sc(this.Il.je);m!=-1;m=this.Il.lb(m)){var g=this.Il.getData(m);if(this.g.Hc(g,u),u.y!=this.zh&&c.size!=0&&(o=this.ut(c)||o,this.ae.reset(),c.clear(!1)),c.add(g),this.zh=u.y,this.et==0)break}for(0<this.et&&(o=this.ut(c)||o,c.clear(!1)),this.g.Ud(this.so),this.g.Ud(this.Ss),c=this.g.Ob(this.Y);c!=-1;)if(this.g.tj(c,this.Gl)==3){for(this.g.JB(c,!0),u=c,c=this.g.tj(c,this.xo);c!=-1;)m=this.g.tj(c,this.xo),this.g.PT(this.Y,this.g.Sb(u),c),u=c,c=m;c=this.g.Sb(u)}else this.g.JB(c,!1),c=this.g.Sb(c);return this.g.wB(this.Gl),this.g.wB(this.xo),o},h.prototype.ut=function(o){return this.QV(o)},h.prototype.QV=function(o){var c=!1;this.hb==null&&(this.hb=new N(this.g)),this.Ym==null?(this.Ym=new f.ja(0),this.Ym.Jb(16)):this.Ym.clear(!1),this.PV(o);for(var u=0,m=o.size;u<m;u++){var g=o.get(u);g!=-1&&this.gG(g,-1)}for(u=0;u<this.Ym.size&&0<this.et;u++)if(o=this.Ym.get(u),g=this.hb.mz(this.fb.ka(o)),m=-1,this.g.tj(g,this.Gl)==0){g=this.fb.xe(o);for(var v,w=o;g!=-1;){var E=this.fb.ka(g),C=this.hb.mz(E),R=this.g.tj(C,this.Gl);if(R!=0){m=C;break}w=g,g=this.fb.xe(g)}g==-1?(v=!0,g=w):(E=this.fb.ka(g),v=this.hb.Cv(E),g=this.fb.lb(g),v=!v);do{if(E=this.fb.ka(g),C=this.hb.mz(E),(R=this.g.tj(C,this.Gl))==0&&(v!=this.hb.Cv(E)&&(c=this.g.Ya(C),this.g.hJ(c),this.g.Xg(C,this.g.Na(c)),c=!0),this.g.ir(C,this.Gl,v?3:2),v||(w=this.g.tj(m,this.xo),this.g.ir(m,this.xo,C),this.g.ir(C,this.xo,w)),this.et--,this.et==0))return c;m=C,w=g,g=this.fb.lb(g),v=!v}while(w!=o)}return c},h.prototype.PV=function(o){for(var c=0,u=o.size;c<u;c++){var m=o.get(c),g=this.g.Qa(m,this.so),v=this.g.Qa(m,this.Ss);if(g!=-1){var w=this.fb.ka(g);this.hb.jF(w),this.g.Sa(m,this.so,-1)}v!=-1&&(w=this.fb.ka(v),this.hb.jF(w),this.g.Sa(m,this.Ss,-1)),w=-1,g!=-1&&v!=-1?(this.fb.wd(g,-1),this.fb.wd(v,-1),o.set(c,-1)):w=g!=-1?g:v,w!=-1&&(this.gG(m,w)||this.fb.wd(w,-1),o.set(c,-1))}},h.prototype.gG=function(o,c){var u=new f.h,m=new f.h;this.g.Hc(o,u);var g=this.g.V(o);this.g.Hc(g,m);var v=!1;if(u.y<m.y){v=!0;var w=this.hb.fI(o);if(c==-1)var E=this.fb.addElement(w,-1);else E=c,this.fb.Tj(E,w);(w=this.g.Qa(g,this.so))==-1?this.g.Sa(g,this.so,E):this.g.Sa(g,this.Ss,E),g=this.g.cd(o),this.g.tj(g,this.Gl)==0&&this.Ym.add(E)}return g=this.g.Na(o),this.g.Hc(g,m),u.y<m.y&&(v=!0,w=this.hb.fI(g),c==-1?E=this.fb.addElement(w,-1):(E=c,this.fb.Tj(E,w)),(w=this.g.Qa(g,this.so))==-1?this.g.Sa(g,this.so,E):this.g.Sa(g,this.Ss,E),g=this.g.cd(o),this.g.tj(g,this.Gl)==0&&this.Ym.add(E)),v},h.W=function(o,c,u,m){var g=new h;return g.g=o,g.Y=c,g.Il=u,g.gw=m,g.zQ()},h.prototype.AQ=function(){var o=new f.ja(0),c=new f.ja(0),u=-1,m=-1,g=new f.h;g.Sc();for(var v=-1,w=-1,E=-1,C=new f.h,R=this.Il.sc(this.Il.je);R!=-1;R=this.Il.lb(R)){var I=this.Il.getData(R);this.g.Hc(I,C);var F=this.g.cd(I);g.rb(C)&&w==F?(m==-1&&(u=this.g.Ey(),m=this.g.Hd()),E==-1&&(E=c.size,this.g.Sa(v,m,E),c.add(1),this.g.tj(F,u)==-1&&(this.g.ir(F,u,v),o.add(F))),this.g.Sa(I,m,E),c.PW(c.Gc()+1)):(E=-1,g.N(C)),v=I,w=F}if(o.size==0)return!1;for(g=new f.ja(0),v=new f.ja(0),w=0,E=o.size;w<E;w++){F=o.get(w);var U=this.g.tj(F,u);for(I=this.g.Qa(U,m),g.clear(!1),v.clear(!1),g.add(U),v.add(I),I=this.g.V(U);I!=U;I=this.g.V(I)){var j=I;if((C=this.g.Qa(j,m))!=-1)if(v.size==0)v.add(C),g.add(j);else if(v.Gc()==C){R=g.Gc();var ee=this.g.V(R);U=this.g.V(j),this.g.Cc(R,U),this.g.Dc(U,R),this.g.Cc(j,ee),this.g.Dc(ee,j),j=[!1],ee=this.g.fG(this.Y,ee,this.g.Ya(F),j),this.g.Sa(I,m,-1),j[0]&&this.g.Kf(F,U),I=this.g.Ka(F),I-=U=this.g.Ka(ee),this.g.Wj(F,I),c.set(C,c.get(C)-1),c.get(C)==1&&(c.set(C,0),v.Jf(),g.Jf()),I=U=R}else g.add(I),v.add(C)}}return this.g.wB(u),this.g.Ud(m),!0},h}();f.OL=d}(ae||(ae={})),function(f){var N=function(){function T(){}return T.prototype.hg=function(){this.JA=this.tb=null},T.prototype.get=function(){return this.JA},T.prototype.set=function(d){if(this.JA=d,d!=null)throw d.K()==322&&(this.tb=d),f.i.Ra()},T.prototype.create=function(d){if(d!=322)throw f.i.ga("Not Implemented");this.Pr()},T.prototype.Pr=function(){this.tb==null&&(this.tb=new f.zb),this.JA=this.tb},T}();f.hg=N}(ae||(ae={})),function(f){(f=f.PL||(f.PL={}))[f.enumLineSeg=1]="enumLineSeg",f[f.enumBezierSeg=2]="enumBezierSeg",f[f.enumArcSeg=4]="enumArcSeg",f[f.enumNonlinearSegmentMask=6]="enumNonlinearSegmentMask",f[f.enumSegmentMask=7]="enumSegmentMask",f[f.enumDensified=8]="enumDensified"}(ae||(ae={})),function(f){var N=function(d){this.aj=d,this.jC=this.kC=1,this.mB=this.lB=this.nB=0},T=function(){function d(){this.Hq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Bk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Cf=new f.Ta,this.ra=this.Dw=0,this.no=[],this.at=[],this.zw=[],this.Kq=[],this.GA=[]}return d.prototype.qB=function(h){if(h!=null){for(var o=0,c=h.length;o<c;o++)this.hW(h[o]);h.length=0}},d.prototype.hW=function(h){h.aj=null,this.Kq.push(h)},d.prototype.Pw=function(h){if(this.Kq.length===0)var o=new N(h);else(o=this.Kq[this.Kq.length-1]).aj=h,--this.Kq.length;return o},d.prototype.JR=function(h,o){return h==0?this.at[o]:this.zw[o]},d.prototype.VA=function(){this.Dw>=this.GA.length&&this.GA.push(new f.hg);var h=this.GA[this.Dw];return this.Dw++,h},d.prototype.clear=function(){this.qB(this.no),this.qB(this.at),this.qB(this.zw),this.Dw=0},d.prototype.Po=function(h){this.no.push(this.Pw(h))},d.prototype.ql=function(h){return h==0?this.at.length:this.zw.length},d.prototype.Xp=function(h,o){return this.JR(h,o).aj},d.prototype.Fa=function(h,o){if(this.no.length!=2)throw f.i.Ra();this.ra=h;var c=f.mc.nx(.01*h),u=!1,m=this.no[0],g=this.no[1];if(o||(5&m.aj.Br(g.aj,h,!0))!=0){if(m.aj.K()==322){var v=m.aj;if(g.aj.K()==322){o=g.aj;var w=f.zb.Xx(v,o,null,this.Hq,this.Bk,h);if(w==0)throw f.zb.Xx(v,o,null,this.Hq,this.Bk,h),f.i.Ra();h=Array(9),f.P.av(h,null);for(var E=0;E<w;E++){var C=this.Hq[E],R=this.Bk[E],I=m.mB,F=1;C==0?(I=m.nB,F=m.kC):C==1&&(I=m.lB,F=m.jC);var U=g.mB,j=1;R==0?(U=g.nB,j=g.kC):R==1&&(U=g.lB,j=g.jC);var ee=new f.h;I==U?(I=new f.h,v.ic(C,I),C=new f.h,o.ic(R,C),j/=R=F+j,f.mc.GG(I,C,j,ee),f.h.zc(ee,I)+f.h.zc(ee,C)>c&&(u=!0)):I>U?(v.ic(C,ee),C=new f.h,o.ic(R,C),f.h.zc(ee,C)>c&&(u=!0)):(o.ic(R,ee),I=new f.h,v.ic(C,I),f.h.zc(ee,I)>c&&(u=!0)),h[E]=ee}for(m=0,g=-1,E=0;E<=w;E++)(j=E<w?this.Hq[E]:1)!=m&&(c=this.VA(),v.bh(m,j,c),g!=-1&&c.get().Ec(h[g]),E!=w&&c.get().Rc(h[E]),m=j,this.at.push(this.Pw(c.get()))),g=E;for(v=[0,0,0,0,0,0,0,0,0],E=0;E<w;E++)v[E]=E;for(1<w&&this.Bk[0]>this.Bk[1]&&(j=this.Bk[0],this.Bk[0]=this.Bk[1],this.Bk[1]=j,E=v[0],v[0]=v[1],v[1]=E),m=0,g=-1,E=0;E<=w;E++)(j=E<w?this.Bk[E]:1)!=m&&(c=this.VA(),o.bh(m,j,c),g!=-1&&(m=v[g],c.get().Ec(h[m])),E!=w&&(m=v[E],c.get().Rc(h[m])),m=j,this.zw.push(this.Pw(c.get()))),g=E;return u}}throw f.i.Ra()}return!1},d.prototype.Fz=function(h,o,c){if(o.copyTo(this.Cf),this.no.length!=1)throw f.i.Ra();this.ra=h;var u=this.no[0];if(c||u.aj.su(o.D(),h,!0)){if(u.aj.K()!=322)throw f.i.Ra();var m=(h=u.aj).fe(o.D(),!1);this.Hq[0]=m;var g=u.mB;for(c=1,m==0?(g=u.nB,c=u.kC):m==1&&(g=u.lB,c=u.jC),u=new f.h,g==0?(g=new f.h,h.ic(m,g),o=o.D(),f.mc.GG(g,o,1/(c+1),u)):0<g?(u=new f.h,h.ic(m,u)):u=o.D(),c=0,m=-1,g=0;1>=g;g++){if((o=1>g?this.Hq[g]:1)!=c){var v=this.VA();h.bh(c,o,v),m!=-1&&v.get().Ec(u),g!=1&&v.get().Rc(u),c=o,this.at.push(this.Pw(v.get()))}m=g}this.Cf.Db(u)}},d}();f.LC=T}(ae||(ae={})),function(f){var N=function(){function T(d){this.Es=this.rk=this.tb=null,this.bg=0,this.Bm=!1,this.Af=-1,this.El=this.Kd=0,this.gb=-1,this.ib=d,this.bg=this.Ux(this.El),this.Bm=!1,this.rk=null,this.Es=new f.h}return T.prototype.rW=function(d){if(this.ib!=d.ib)throw f.i.Hb();this.Af=d.Af,this.Kd=d.Kd,this.gb=d.gb,this.El=d.El,this.bg=d.bg,this.Bm=d.Bm,this.rk=null},T.prototype.ia=function(){if(this.Af!=this.Kd&&this.tD(),this.Bm)this.Kd=(this.Kd+1)%this.bg;else{if(this.Kd==this.bg)throw f.i.re();this.Kd++}return this.rk},T.prototype.mi=function(){if(this.Bm)this.Kd=(this.bg+this.Kd-1)%this.bg;else{if(this.Kd==0)throw f.i.re();this.Kd--}return this.Kd!=this.Af&&this.tD(),this.rk},T.prototype.sW=function(){this.Af=-1,this.Kd=0},T.prototype.tW=function(){this.Kd=this.bg,this.Af=-1},T.prototype.Wb=function(d,h){if(h===void 0&&(h=-1),0<=this.gb&&this.gb<this.ib.ea()){var o=this.AM();if(d>=o&&d<this.ib.Wc(this.gb))return this.Af=-1,void(this.Kd=d-o)}h=0<=h&&h<this.ib.ea()&&d>=this.ib.Ca(h)&&d<this.ib.Wc(h)?h:this.ib.nz(d),this.El=h+1,this.gb=h,this.Af=-1,this.Kd=d-this.ib.Ca(h),this.bg=this.Ux(h),this.ib.Ca(this.gb),this.ib.ec(this.gb)},T.prototype.ab=function(){return this.gb=this.El,!(this.gb>=this.ib.ea())&&(this.Af=-1,this.Kd=0,this.bg=this.Ux(this.gb),this.ib.Ca(this.gb),this.ib.ec(this.gb),this.El++,!0)},T.prototype.$i=function(){this.bg=this.Kd=this.Af=-1,this.El=0,this.gb=-1},T.prototype.Ux=function(d){if(this.ib.Bc())return 0;var h=1;return this.ib.ec(d)&&(h=0),this.ib.Ka(d)-h},T.prototype.Pn=function(){return this.Af==this.bg-1&&this.ib.ec(this.gb)},T.prototype.DB=function(){this.Bm=!0},T.prototype.xb=function(){return this.ib.nb.o[this.gb]+this.Af},T.prototype.AM=function(){return this.ib.Ca(this.gb)},T.prototype.ik=function(){return this.Pn()?this.ib.Ca(this.gb):this.xb()+1},T.prototype.xm=function(){return this.Af==0},T.prototype.Rn=function(){return this.Af==this.bg-1},T.prototype.Ia=function(){return this.Kd<this.bg},T.prototype.zz=function(){return 0<this.Kd},T.prototype.Pf=function(){var d=new T(this.ib);return d.Af=this.Af,d.Kd=this.Kd,d.bg=this.bg,d.gb=this.gb,d.El=this.El,d.ib=this.ib,d.Bm=this.Bm,d},T.prototype.tD=function(){if(0>this.Kd||this.Kd>=this.bg)throw f.i.re();this.Af=this.Kd;var d=this.xb();this.ib.rc();var h=this.ib.Se,o=1;switch(h!=null&&(o=7&h.read(d)),h=this.ib.description,o){case 1:this.tb==null&&(this.tb=new f.zb),this.rk=this.tb;break;case 2:throw f.i.ga("internal error");default:throw f.i.Ra()}this.rk.kg(h),o=this.ik(),this.ib.Hc(d,this.Es),this.rk.Ec(this.Es),this.ib.Hc(o,this.Es),this.rk.Rc(this.Es);for(var c=1,u=h.Ba;c<u;c++)for(var m=h.qd(c),g=f.ua.Wa(m),v=0;v<g;v++){var w=this.ib.Vc(m,d,v);this.rk.RB(m,v,w),w=this.ib.Vc(m,o,v),this.rk.IB(m,v,w)}},T.prototype.QS=function(){return this.gb==this.ib.ea()-1},T.prototype.Qn=function(){var d=this.ib.MR();return d!=null&&(7&d.read(this.Af))!=1},T}();f.QL=N}(ae||(ae={})),function(f){var N=function(){function T(d){d instanceof f.ba?(this.pH=d,this.za=-1,this.Fi=1):(this.kT=d.slice(0),this.za=-1,this.Fi=d.length)}return T.prototype.Ma=function(){return this.za},T.prototype.next=function(){return this.za<this.Fi-1?(this.za++,this.pH!=null?this.pH:this.kT[this.za]):null},T.prototype.qe=function(){},T}();f.$c=N}(ae||(ae={})),function(f){var N=function(){this.next=null},T=function(){function d(){this.Vq=this.Lw=this.Mw=0,this.cF=!1,this.ZJ=0,this.jn=this.Lf=this.Yl=this.Kh=null,this.Ql=0,this.py=null,this.rl=this.pi=-1}return d.prototype.oX=function(h,o,c){this.pi=h,this.rl=o,this.Kh=this.Yl=null,this.Vq=0,this.py=c,this.jn==null&&(this.jn=f.P.lg(384,0)),this.fK()},d.prototype.S=function(){return this.pi},d.prototype.da=function(){return this.rl},d.prototype.flush=function(){0<this.Ql&&(this.py.ZE(this.jn,this.Ql),this.Ql=0)},d.prototype.fK=function(){if(0<this.Vq){for(var h=0;h<this.rl;h++){for(var o=this.Yl[h];o!=null;){var c=o;o=o.next,c.next=null}this.Yl[h]=null}this.Kh=null}this.Mw=this.rl,this.Lw=-1,this.Vq=0},d.prototype.aJ=function(h){for(this.cF=h==d.Ax,h=this.Mw;h<=this.Lw;h++)this.kN(),this.dN(h),this.RP();this.fK()},d.prototype.ey=function(h,o,c,u){if(o!=u){var m=1;if(o>u&&(m=h,h=c,c=m,m=o,o=u,u=m,m=-1),!(0>u||o>=this.rl)){0>h&&0>c?c=h=-1:h>=this.pi&&c>=this.pi&&(c=h=this.pi);var g=(c-h)/(u-o);u>this.rl&&(c=g*((u=this.rl)-o)+h),0>o&&(h=g*(0-o)+h,o=0);var v=Math.max(this.pi+1,8388607);-8388607>h?(o=(0-h)/g+o,h=0):h>v&&(o=(this.pi-h)/g+o,h=this.pi),-8388607>c?u=(0-h)/g+o:c>v&&(u=(this.pi-h)/g+o),(o=f.P.truncate(o))!=(u=f.P.truncate(u))&&((c=new N).x=f.P.truncate(4294967296*h),c.y=o,c.H=u,c.OP=f.P.truncate(4294967296*g),c.dir=m,this.Yl==null&&(this.Yl=f.P.lg(this.rl,null)),c.next=this.Yl[c.y],this.Yl[c.y]=c,c.y<this.Mw&&(this.Mw=c.y),c.H>this.Lw&&(this.Lw=c.H),this.Vq++)}}},d.prototype.kN=function(){if(this.Kh!=null){for(var h=!1,o=null,c=this.Kh;c!=null;)if(c.y++,c.y==c.H){var u=c;c=c.next,o!=null?o.next=c:this.Kh=c,u.next=null}else c.x+=c.OP,o!=null&&o.x>c.x&&(h=!0),o=c,c=c.next;h&&(this.Kh=this.YJ(this.Kh))}},d.prototype.dN=function(h){if(!(h>=this.rl)){var o=this.Yl[h];if(o!=null){this.Yl[h]=null,o=this.YJ(o),this.Vq-=this.ZJ,h=this.Kh;for(var c=!0,u=o,m=null;h!=null&&u!=null;)h.x>u.x?(c&&(this.Kh=u),c=u.next,u.next=h,m!=null&&(m.next=u),m=u,u=c):(c=h.next,h.next=u,m!=null&&(m.next=h),m=h,h=c),c=!1;this.Kh==null&&(this.Kh=o)}}},d.XJ=function(h,o){return 0>h?0:h>o?o:h},d.prototype.RP=function(){if(this.Kh!=null){for(var h=0,o=this.Kh,c=f.P.truncate(f.P.OG(o.x)),u=o.next;u!=null;u=u.next)if(h=this.cF?1^h:h+u.dir,u.x>o.x){var m=f.P.truncate(f.P.OG(u.x));h!=0&&(o=d.XJ(c,this.pi),(c=d.XJ(m,this.pi))>o&&o<this.pi&&(this.jn[this.Ql++]=o,this.jn[this.Ql++]=c,this.jn[this.Ql++]=u.y,this.Ql==this.jn.length&&(this.py.ZE(this.jn,this.Ql),this.Ql=0))),o=u,c=m}}},d.prototype.YJ=function(h){for(var o=0,c=h;c!=null;c=c.next)o++;if(this.ZJ=o,o==1)return h;this.Lf==null?this.Lf=f.P.lg(Math.max(o,16),null):this.Lf.length<o&&(this.Lf=f.P.lg(Math.max(o,2*this.Lf.length),null));var u=0;for(c=h;c!=null;c=c.next)this.Lf[u++]=c;for(o==2?this.Lf[0].x>this.Lf[1].x&&(h=this.Lf[0],this.Lf[0]=this.Lf[1],this.Lf[1]=h):d.sN(this.Lf,o,function(m,g){return m==g?0:m.x<g.x?-1:m.x>g.x?1:0}),h=this.Lf[0],this.Lf[0]=null,c=h,u=1;u<o;u++)c.next=this.Lf[u],c=this.Lf[u],this.Lf[u]=null;return c.next=null,h},d.sN=function(h,o,c){if(o==h.length)h.sort(c);else{var u=h.slice(0,0),m=h.slice(o);o=h.slice(0,o).sort(c),h.length=0,h.push.apply(h,u.concat(o).concat(m))}},d.Ax=0,d}();f.Nx=T}(ae||(ae={})),function(f){var N=function(){function T(){}return T.prototype.vi=function(d,h){var o=this.g.Qa(d,this.Rq);if(this.Fl==o&&(this.Fl=this.oe.lb(this.Fl)),this.io==o&&(this.io=this.oe.lb(this.io)),this.oe.kd(this.LA,o),this.bk(d),h&&(h=this.g.cd(d))!=-1&&this.g.Ya(h)==d){var c=this.g.V(d);if(c!=d){if((o=this.g.cd(c))==h)return void this.g.Kf(h,c);if((c=this.g.Na(d))!=d&&(o=this.g.cd(c))==h)return void this.g.Kf(h,c)}this.g.Kf(h,-1),this.g.Xg(h,-1)}},T.prototype.hD=function(){for(var d=!1,h=new f.h;;){this.Xh==null?(this.Xh=new f.ja(0),this.As=new f.ja(0),this.ye=new f.ja(0)):(this.Xh.clear(!1),this.As.clear(!1),this.ye.clear(!1));for(var o=this.io,c=0,u=!0;o!=this.Fl;){var m=this.oe.getData(o),g=new f.h;this.g.Hc(m,g),u&&(this.g.Hc(m,h),u=!1),g=this.g.Na(m);var v=this.g.V(m);this.g.Qa(g,this.zg)!=-559038737&&(this.Xh.add(g),this.g.Sa(g,this.zg,-559038737),this.As.add(m),this.ye.add(c++)),this.g.Qa(v,this.zg)!=-559038737&&(this.Xh.add(v),this.g.Sa(v,this.zg,-559038737),this.As.add(m),this.ye.add(c++)),o=this.oe.lb(o)}if(2>this.Xh.size)break;var w=this;for(this.ye.Wd(0,this.ye.size,function(E,C){return w.hM(E,C)}),o=0,c=this.ye.size;o<c;o++)u=this.ye.get(o),u=this.Xh.get(u),this.g.Sa(u,this.zg,o),g=new f.h,this.g.Hc(u,g);for(g=this.LM(h),o=0,c=this.ye.size;o<c;o++)(u=this.ye.get(o))!=-1&&(u=this.Xh.get(u),this.g.Sa(u,this.zg,-1));if(!g)break;d=!0}return d},T.prototype.LM=function(d){for(var h=!1,o=!0;o;){o=!1;var c=0;this.ye.get(c)==-1&&(c=this.em(c));for(var u=this.em(c),m=0,g=this.ye.size;m<g&&c!=-1&&u!=-1&&c!=u;m++){var v=this.ye.get(c);u=this.ye.get(u),v=this.Xh.get(v),u=this.Xh.get(u);var w=this.g.V(v);this.g.Ev(w,d)||(w=this.g.Na(v));var E=this.g.V(u);this.g.Ev(E,d)||(E=this.g.Na(u));var C=this.qu(w,v),R=this.qu(E,u),I=C?this.g.Na(w):this.g.V(w),F=R?this.g.Na(E):this.g.V(E),U=!1;(this.tp(w)||this.tp(E)||this.tp(v)||this.tp(u)||this.tp(I)||this.tp(F))&&(U=!0),!U&&this.g.hq(v,u)&&(U=!0,this.lD(C,R,w,v,E,u)),!U&&this.g.hq(I,F)&&(U=!0,this.lD(!C,!R,w,I,E,F)),U&&(h=!0),o=o||U,c=this.em(c),u=this.em(c)}}if(!h)for(c=0,this.ye.get(c)==-1&&(c=this.em(c)),u=this.em(c),m=0,g=this.ye.size;m<g&&c!=-1&&u!=-1&&c!=u;m++)v=this.ye.get(c),u=this.ye.get(u),v=this.Xh.get(v),u=this.Xh.get(u),w=this.g.V(v),this.g.Ev(w,d)||(w=this.g.Na(v)),E=this.g.V(u),this.g.Ev(E,d)||(E=this.g.Na(u)),C=this.qu(w,v),R=this.qu(E,u),I=C?this.g.Na(w):this.g.V(w),F=R?this.g.Na(E):this.g.V(E),this.vM(C,R,v,w,I,u,E,F)&&(h=!0),c=this.em(c),u=this.em(c);return h},T.prototype.PM=function(){this.g.jc(this.Y)==1736&&this.g.Jn(this.Y)==1&&new f.Hg().CU(this.gw,this.g,this.Y,this.nd);var d=!1,h=!0;this.zg=this.Rq=-1;var o=this.g.I(this.Y),c=new f.ja(0);c.Jb(o);for(var u=this.g.Ob(this.Y);u!=-1;u=this.g.Sb(u))for(var m=this.g.Ya(u),g=0,v=this.g.Ka(u);g<v;g++)c.add(m),m=this.g.V(m);var w=this.g.ud.o,E=this.g.ud.Mf;this.g.wb.rc();var C=this.g.wb.Aa[0].o;for(c.Wd(0,o,function(I,F){var U=w[E*I],j=w[E*F],ee=C[2*U];U=C[2*U+1];var te=C[2*j];return(ee=U<(j=C[2*j+1])?-1:U>j?1:ee<te?-1:ee>te?1:0)==0&&(ee=(I=w[E*I+3])<(F=w[E*F+3])?-1:I==F?0:1),ee}),this.Rq=this.g.Hd(),this.oe=new f.kp,this.LA=this.oe.Qh(0),this.oe.hn(o),u=0;u<o;u++)m=c.get(u),g=this.oe.addElement(this.LA,m),this.g.Sa(m,this.Rq,g);for(this.zg=this.g.Hd(),this.Fl=-1,this.VC()&&(d=!0);h;){h=!1,o=0,c=!1;do{c=!1,this.io=-1,v=0,u=new f.h,g=new f.h;for(var R=this.oe.sc(this.LA);R!=-1;)m=this.oe.getData(R),this.io!=-1?(this.g.Hc(m,g),u.rb(g)?v++:(u.N(g),this.Fl=R,0<v&&(m=this.hD())&&(c=!0,this.Fl!=-1&&(m=this.oe.getData(this.Fl),this.g.Hc(m,u))),this.io=R=this.Fl,v=0)):(this.io=R,this.g.Hc(this.oe.getData(R),u),v=0),R!=-1&&(R=this.oe.lb(R));if(this.Fl=-1,0<v&&(m=this.hD())&&(c=!0),10<o++)throw f.i.Ra();c&&this.yM(),this.VC()&&(c=!0),h=h||c&&!1,d=d||c}while(c)}return this.g.Ud(this.Rq),this.g.Ud(this.zg),f.OL.W(this.g,this.Y,this.oe,this.gw)||d},T.prototype.qu=function(d,h){return this.g.V(h)!=d},T.prototype.vM=function(d,h,o,c,u,m,g,v){if(c==g)return this.bk(o),this.bk(m),!1;var w=this.g.Qa(o,this.zg),E=this.g.Qa(u,this.zg),C=this.g.Qa(m,this.zg),R=this.g.Qa(v,this.zg),I=[0,0,0,0];for((o=[0,0,0,0,0,0,0,0])[0]=0,I[0]=w,o[1]=0,I[1]=E,o[2]=1,I[2]=C,o[3]=1,I[3]=R,w=1;4>w;w++){for(E=I[w],C=o[w],R=w-1;0<=R&&I[R]>E;)I[R+1]=I[R],o[R+1]=o[R],R--;I[R+1]=E,o[R+1]=C}return I=0,o[0]!=0&&(I|=1),o[1]!=0&&(I|=2),o[2]!=0&&(I|=4),o[3]!=0&&(I|=8),(I==5||I==10)&&(d==h?d?(this.g.Cc(v,c),this.g.Dc(c,v),this.g.Cc(u,g),this.g.Dc(g,u)):(this.g.Dc(v,c),this.g.Cc(c,v),this.g.Dc(u,g),this.g.Cc(g,u)):d?(this.g.Dc(c,m),this.g.Cc(m,c),this.g.Dc(g,u),this.g.Cc(u,g)):(this.g.Cc(c,m),this.g.Dc(m,c),this.g.Cc(g,u),this.g.Dc(u,g)),!0)},T.prototype.lD=function(d,h,o,c,u,m){this.BY?this.NM():this.MM(d,h,o,c,u,m)},T.prototype.NM=function(){throw f.i.ga("not implemented.")},T.prototype.MM=function(d,h,o,c,u,m){if(d!=h)d?(this.g.Cc(o,u),this.g.Dc(u,o),this.g.Cc(m,c),this.g.Dc(c,m),this.wn(u,o),this.vi(u,!0),this.g.ni(u,!0),this.bk(o),this.wn(m,c),this.vi(m,!0),this.g.ni(m,!1)):(this.g.Cc(u,o),this.g.Dc(o,u),this.g.Cc(c,m),this.g.Dc(m,c),this.wn(u,o),this.vi(u,!0),this.g.ni(u,!1),this.bk(o),this.wn(m,c),this.vi(m,!0),this.g.ni(m,!0)),this.bk(c);else{var g=d?o:c,v=h?u:m;for(d=d?c:o,h=h?m:u,u=!1,this.g.Cc(g,v),this.g.Cc(v,g),this.g.Dc(d,h),this.g.Dc(h,d),m=h;m!=v;)o=this.g.Na(m),c=this.g.V(m),this.g.Dc(m,c),this.g.Cc(m,o),u=u||m==g,m=c;u||(o=this.g.Na(v),c=this.g.V(v),this.g.Dc(v,c),this.g.Cc(v,o)),this.wn(v,g),this.vi(v,!0),this.g.ni(v,!1),this.bk(g),this.wn(h,d),this.vi(h,!0),this.g.ni(h,!1),this.bk(d)}},T.prototype.VC=function(){for(var d=!1,h=this.g.Ob(this.Y);h!=-1;){for(var o=this.g.Ya(h),c=0,u=this.g.Ka(h);c<u&&1<u;){var m=this.g.Na(o),g=this.g.V(o);this.g.hq(m,g)?(d=!0,this.vi(o,!1),this.g.pd(o,!0),this.vi(g,!1),this.g.pd(g,!0),o=m,c=0,u=this.g.Ka(h)):(o=g,c++)}if(2>this.g.Ka(h)){for(d=this.g.Ya(h),c=0,u=this.g.Ka(h);c<u;c++)this.vi(d,!1),d=this.g.V(d);h=this.g.ar(h),d=!0}else h=this.g.Sb(h)}return d},T.prototype.tp=function(d){for(var h=!1;;){var o=this.g.V(d),c=this.g.Na(d);if(o==d)return this.vi(d,!0),this.g.ni(d,!1),!0;if(!this.g.hq(o,c)||(h=!0,this.bk(c),this.bk(o),this.vi(d,!0),this.g.ni(d,!1),this.wn(o,c),this.vi(o,!0),this.g.ni(o,!0),o==c))break;d=c}return h},T.prototype.yM=function(){for(var d=0,h=this.oe.sc(this.oe.je);h!=-1;h=this.oe.lb(h)){var o=this.oe.getData(h);this.g.bj(o,-1)}for(var c=0,u=this.g.Ob(this.Y);u!=-1;)if((h=this.g.Ya(u))==-1||this.g.cd(h)!=-1)o=u,u=this.g.Sb(u),this.g.br(o);else{this.g.bj(h,u);var m=1;for(o=this.g.V(h);o!=h;o=this.g.V(o))this.g.bj(o,u),m++;this.g.ep(u,!1),this.g.Wj(u,m),this.g.Xg(u,this.g.Na(h)),c+=m,d++,u=this.g.Sb(u)}for(h=this.oe.sc(this.oe.je);h!=-1;h=this.oe.lb(h))o=this.oe.getData(h),this.g.cd(o)==-1&&(u=this.g.fG(this.Y,o,o,null),c+=this.g.Ka(u),d++);for(this.g.Tl(this.Y,d),this.g.Uj(this.Y,c),d=0,c=this.g.ld;c!=-1;c=this.g.ve(c))d+=this.g.I(c);this.g.VB(d)},T.prototype.em=function(d){for(var h=0,o=this.ye.size-1;h<o;h++)if(d=(d+1)%this.ye.size,this.ye.get(d)!=-1)return d;return-1},T.prototype.wn=function(d,h){var o=this.g.Qa(h,this.Rq),c=this.g.Qa(h,this.zg);this.g.eC(d,h),this.g.Sa(h,this.Rq,o),this.g.Sa(h,this.zg,c)},T.prototype.bk=function(d){var h=this.g.Qa(d,this.zg);h!=-1&&(this.ye.set(h,-1),this.g.Sa(d,this.zg,-1))},T.W=function(d,h,o,c,u){var m=new T;return m.g=d,m.Y=h,m.rA=o,m.gw=c,m.nd=u,m.PM()},T.prototype.hM=function(d,h){var o=this.Xh.get(d),c=new f.h;this.g.Hc(o,c),o=new f.h;var u=this.Xh.get(h);return this.g.Hc(u,o),c.rb(o)?0:(u=this.As.get(d),d=new f.h,this.g.Hc(u,d),u=this.As.get(h),h=new f.h,this.g.Hc(u,h),(u=new f.h).vc(c,d),(c=new f.h).vc(o,h),f.h.ou(u,c))},T}();f.tn=N}(ae||(ae={})),function(f){var N;(N=f.SL||(f.SL={}))[N.Local=0]="Local",N[N.Geographic=1]="Geographic",N[N.Projected=2]="Projected",N[N.Image=3]="Image",N[N.Unknown=4]="Unknown",function(d){d[d.Integer32=0]="Integer32",d[d.Integer64=1]="Integer64",d[d.FloatingPoint=2]="FloatingPoint"}(f.LL||(f.LL={}));var T=function(){function d(){this.qp="",this.tu=null,this.eg=0,this.RH=this.Io=-1,this.xh=null}return d.prototype.Fc=function(){return this.eg},d.prototype.NF=function(){return 1},d.prototype.Yd=function(){var h=.001;return this.eg!=0?h=f.yr.uQ(this.eg):this.xh!=null&&(h=f.PC.vQ(this.xh)),h},d.prototype.wz=function(){return this.xh},d.prototype.Id=function(){return this.eg!=0?f.Uc.$g(f.yr.Ny(this.eg)):this.xh!=null?f.PC.wQ(this.xh):void 0},d.Tb=function(h){if(h.eg!=0){if(f.yr.PS(h.eg)===!0)return 1;if(f.yr.RS(h.eg)===!0)return 2}return 4},d.prototype.bs=function(){var h=this.Fc();return this.Io!=-1?this.Io:(this.Io=f.yr.xK(h),this.Io!=-1?this.Io:h)},d.create=function(h){if(0>=h)throw f.i.O("Invalid or unsupported wkid: "+h);var o=new d;return o.eg=h,o},d.iP=function(h){if(h==null||h.length==0)throw f.i.O("Cannot create SpatialReference from null or empty text.");var o=new d;return o.xh=h,o},d.prototype.Nb=function(h){return this==h||h!=null&&this.constructor==h.constructor&&this.eg==h.eg&&(this.eg!=0||this.xh===h.xh)},d.prototype.toString=function(){return"[ tol: "+this.Ln()+"; wkid: "+this.Fc()+"; wkt: "+this.wz()+"]"},d.prototype.dc=function(){if(this.qp!=="")return this.qp;var h=this.toString();if(Array.prototype.reduce)return this.qp="S"+h.split("").reduce(function(u,m){return(u=(u<<5)-u+m.charCodeAt(0))&u},0);var o=0;if(h.length===0)return"";for(var c=0;c<h.length;c++)o=(o<<5)-o+h.charCodeAt(c),o&=o;return this.qp="S"+o},d.prototype.Ln=function(){return this.Yd(0)},d.prototype.gh=function(){return this.tu!==null?this.tu:this.tu=f.hu.qP(this)},d.RN=2147483645,d.SN=9007199254740990,d}();f.Gg=T}(ae||(ae={})),function(f){var N=function(T){function d(){var h=T!==null&&T.apply(this,arguments)||this;return h.Ki=null,h.IT=null,h.Jq=new f.RL,h.Fo=null,h.kw=null,h}return Hi(d,T),d.qP=function(h){var o=new d;if(o.eg=h.eg,o.Io=h.Io,o.RH=h.RH,o.xh=h.xh,o.xh!==""&&o.xh!==null){h=d.cM(o.xh);var c=d.aM(o.xh);o.Jq.Vx(h,c,f.iu.Integer64),o.$x(h),o.by(c),o.eg=h.bs()}else h=d.bM(o.eg),o.$x(h),o.by(null),o.Jq.Vx(h,null,f.iu.Integer64);return o},d.prototype.Yd=function(h){return this.Jq.Ln(h)},d.aM=function(h){if(0>=h.length)throw f.i.O();var o=null;try{o=f.FC.fromString(h)}catch{o=null}return o==null?null:d.UC(o,!0)},d.prototype.$x=function(h){this.Ld=h,this.Fo=this.Ld.Id()},d.prototype.by=function(h){this.CH=h,this.IT=this.CH!=null?this.CH.Fo:null},d.prototype.Xc=function(){return this.Tb()!=0&&this.Tb()!=3&&this.Ld.Xc()},d.prototype.AG=function(){return this.Tb()!=0&&(this.Tb()==3?this.Ki.fk().Xc():this.Ld.Xc())},d.prototype.fh=function(){return this.Ld!=null?this.Ld.Re:null},d.prototype.rm=function(){return this.Ld.rm()},d.prototype.bf=function(){return this.Ld.bf()},d.prototype.ih=function(){return this.Ld!=null?this.Ld.tw:NaN},d.prototype.Wp=function(){return this.Ld.Wp()},d.prototype.Xr=function(){return this.Ld.Xr()},d.prototype.kk=function(){return this.Ld.kk()},d.prototype.bS=function(h){return f.GC.Ky(this.Ld,h.Ld)},d.prototype.ol=function(){return this.Ld.ol()},d.prototype.Wr=function(){return this.Ld.Wr()},d.prototype.Ai=function(){return this.Tb()==3?this.Ki.fk().Ai():this.Ld.Ai()},d.prototype.hh=function(){if(!this.Xc())throw f.i.O("!isPannable()");var h=new f.l;return this.Ld.hh(h),h},d.prototype.Le=function(){if(!this.Xc())throw f.i.O("!isPannable()");return this.Ld.to},d.prototype.zR=function(){if(!this.Xc())throw f.i.O("!isPannable()");var h=new f.l;return this.Ld.yR(h),h},d.prototype.qv=function(){if(!this.Xc())throw f.i.O("!isPannable()");return this.Ld.qv()},d.prototype.pv=function(){if(!this.Xc())throw f.i.O("!isPannable()");return this.Ld.pv()},d.prototype.Yr=function(){return this.Ki!=null?this.Ki.fk().Yr():this.Ld.Yr()},d.prototype.HQ=function(){return this.Ld.jv()},d.prototype.Sp=function(){return this.Fo.getUnitFactor()},d.prototype.pz=function(h){return this.Jq.pz(h)},d.prototype.tc=function(){var h=this.Tb();if(h==1)return this;if(h==3)return this.Ki.fk().tc();if(h==0||h===4)throw f.i.ga("invalid call");if(this.kw!==null)return this.kw;if((h=this.fh().getGeogcs())==null)throw f.i.Ra();return this.kw=d.UE(h,this.Jq.NF())},d.UE=function(h,o){if(h==null)throw f.i.O("null pointer.");var c=new d;return h=d.nu(h,!0),c.Jq.Vx(h,null,o),c.$x(h),c.by(null),c.eg=h.bs(),c},d.prototype.Tb=function(){var h=this.fh();if(h!=null)switch(h.getType()){case f.Tc.PE_TYPE_GEOGCS:return 1;case f.Tc.PE_TYPE_PROJCS:return 2}return 4},d.prototype.jv=function(){return this.Ld.jv()},d.nu=function(h,o){var c=h.getCode();if(0>=c&&0<(c=f.qf.getCode(h))){if((h=f.qf.coordsys(c))==null)throw f.i.O("Text to wkid mapping had failed: "+c);return d.nu(h,o)}if(o&&0<c&&(o=d.px[c]))return o;o=f.Ab.yv(h,c,!1);var u=d.dK[o];return u||(h=0>=c?h:f.qf.coordsys(c),h=new f.GC(h),d.dK[o]=h,0<c&&(d.px[c]=h),h)},d.bM=function(h){if(0>=h)throw f.i.O("Invalid or unsupported wkid: "+h);var o=d.px[h];if(o!=null)return o;if((o=f.qf.coordsys(h))==null)throw f.i.O("Invalid or unsupported wkid: "+h);return(o=d.nu(o,!1)).bs()!=h&&(d.px[h]=o),o},d.cM=function(h){if(h==null||h===void 0||h.length==0)throw f.i.O("Cannot create SpatialReference from null or empty text.");var o=null;try{o=f.qf.fromString(f.Tc.PE_TYPE_COORDSYS,h)}catch(c){throw f.i.O("Cannot create SpatialReference from text. "+c.message)}if(o===null)throw f.i.O("Cannot create SpatialReference from text. ");return d.nu(o,!0)},d.UC=function(h,o){var c,u=h.getCode();if(0>=u&&0<(u=f.qf.getCode(h))){if((u=f.qf.vertcs(u))===null)throw f.i.O();return d.UC(u,o)}if(o&&0<u&&(o=d.cK[u])||(h=f.Ab.yv(h,u,!1),o=d.eK[h]))return o;if(0>=u||(c=f.qf.vertcs(u)),c===null)throw f.i.O();return c=new f.HL(c),d.eK[h]=c,0<u&&(d.cK[u]=c),c},d.kI=function(h,o){if(o===null||o.B())return null;var c=new f.l;if(o!==null&&h.Tb()!=1){var u=h.tc(),m=u.fh();h=f.xr.Or(h,u,null,null),(o=f.Fx.local().W(o,h,null)).A(c)}else m=h.fh(),o.A(c);return o=m.getPrimem().getLongitude(),m=m.getUnit().getUnitFactor(),new f.DC(c.v,c.G,c.C,c.H,o,m)},d.dD=function(h){var o={name:"",steps:[],_pt:null,_entry:null},c=0;for(h=h.getEntries();c<h.length;c++){var u=h[c],m={AY:!1,OY:"",NY:-1,geogtran:null};u.getDirection()===0?m.isInverse=!1:m.isInverse=!0;var g=u.getGeogtran().getCode();-1<g?m.wkid=g:m.wkt=u.getGeogtran().toString(),o.steps.push(m)}return o},d.OR=function(h,o,c,u){return c===void 0&&(c=null),c=d.kI(u,c),h=f.mp.getGTlist(h.fh(),o.fh(),2,f.mp.PE_GTLIST_OPTS_COMMON,c,1),o=null,h&&0<h.length&&(o=this.dD(h[0]),f.Kx.destroy(h)),c!==null&&c.destroy(),o},d.PR=function(h,o,c,u){var m;if(c===void 0&&(c=null),u===void 0&&(u=null),m===void 0&&(m=30),c=d.kI(u,c),h=f.mp.getGTlist(h.fh(),o.fh(),2,f.mp.PE_GTLIST_OPTS_COMMON,c,m),o=[],h&&0<h.length){for(m=0;m<h.length;m++)o.push(this.dD(h[m]));f.Kx.destroy(h)}return c!==null&&c.destroy(),o},d.px={},d.dK={},d.cK={},d.eK={},d}(f.Gg);f.hu=N}(ae||(ae={})),function(f){var N,T;(T=N=f.iu||(f.iu={}))[T.Integer32=0]="Integer32",T[T.Integer64=1]="Integer64",T[T.FloatingPoint=2]="FloatingPoint";var d=function(){function h(){this.rp()}return h.prototype.assign=function(o){this.Hm=o.Hm,this.Im=o.Im,this.Qj=o.Qj,this.mA=o.mA,this.Go=o.Go,this.lA=o.lA,this.Ik=o.Ik,this.Oq=o.Oq,this.Nq=o.Nq,this.Tm=o.Tm},h.prototype.NF=function(){return this.Tm},h.prototype.rp=function(){this.Im=this.Hm=0,this.Qj=1,this.mA=0,this.Go=1,this.lA=0,this.Nq=this.Oq=this.Ik=2220446049250313e-29,this.Tm=N.FloatingPoint},h.prototype.Vx=function(o,c,u){if(this.rp(),this.Tm=u,u!=N.FloatingPoint){var m=new f.l;o.$Q(m),this.Hm=m.v,this.Im=m.G}else this.Im=this.Hm=-17976931348623157e292;(m=o.Re.getType())==f.Tc.PE_TYPE_GEOGCS?(m=(u==N.Integer64?1e-9:1/18e5)*o.bf(),this.Qj=1/m):m==f.Tc.PE_TYPE_PROJCS&&(m=(u==N.Integer64?1e-4:.001)*o.rm(),this.Qj=1/m),c!=null?(m=(u==N.Integer32?.001:1e-4)*c.AH,this.Go=1/m):this.Go=1e4,this.QM(),this.Ik=o.tw,this.Oq=c!=null?.001*c.AH:.001,this.Nq=2220446049250313e-29},h.prototype.QM=function(){if(this.Tm!=N.FloatingPoint){var o=this.Tm==N.Integer64?f.Gg.SN:f.Gg.RN,c=o/this.Qj,u=this.Hm+c,m=f.P.truncate((u-this.Hm)*this.Qj);m>o&&(this.Qj=o/(u-this.Hm)),c=this.Im+c,(m=f.P.truncate((c-this.Im)*this.Qj))>o&&(this.Qj=o/(c-this.Im))}},h.prototype.UB=function(o){switch(o){case 0:this.Ik=void 0;case 1:this.Oq=void 0;case 2:this.Nq=void 0}},h.prototype.Ln=function(o){switch(o){case 0:return this.Ik;case 1:return this.Oq;case 2:return this.Nq}return 0},h.prototype.pz=function(o){if(this.Tm==N.FloatingPoint)return 0;switch(o){case 0:return 1/this.Qj;case 1:case 2:return 1/this.Go;default:return 0}},h.prototype.toString=function(){var o="SRPD [m_toleranceXY: "+this.Ik.toString();return(o=(o=(o=(o=(o=(o=(o=(o=(o=o+";m_falseX: "+this.Hm.toString())+";m_falseY: "+this.Im.toString())+";m_unitsXY: "+this.Qj.toString())+";m_falseZ: "+this.mA.toString())+";m_unitsZ: "+this.Go.toString())+";m_falseM: "+this.lA.toString())+";m_toleranceZ: "+this.Oq.toString())+";m_toleranceM: "+this.Nq.toString())+";m_precision: "+this.Tm.toString())+"] "},h}();f.RL=d}(ae||(ae={})),function(f){function N(u,m){return 89.99999<m?m=89.99999:-89.99999>m&&(m=-89.99999),m*=.017453292519943,[111319.49079327169*u,31890685e-1*Math.log((1+Math.sin(m))/(1-Math.sin(m)))]}function T(u,m,g){return u=u/6378137*57.29577951308232,g?[u,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*m/6378137)))]:[u-360*Math.floor((u+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*m/6378137)))]}function d(u,m,g){var v=u.Pf();if(u.K()===33)m=m(v.Mg(),v.jh()),v.Db(m[0],m[1]);else if(u.K()===197){var w=m(u.fs(),u.hs(),g);m=m(u.es(),u.gs(),g),v.L(w[0],w[1],m[0],m[1])}else for(w=new f.h,u=0;u<v.I();u++){v.D(u,w);var E=m(w.x,w.y,g);w.na(E[0],E[1]),v.Db(u,w)}return v}function h(u){return d(u,T,!0)}function o(u){return d(u,N,!0)}var c=Math.PI/180;f.MK=function(){function u(){}return u.wu=function(m){var g=Math.sqrt(.006694379990197414),v=Math.sin(m.y*c);return f.h.construct(6378137*m.x*c,3.1677196636462314e6*(v/(1-.006694379990197414*v*v)-1/(2*g)*Math.log((1-g*v)/(1+g*v))))},u.Tx=function(m,g,v,w){var E=.0033528106647474805,C=Math.sin(v);v=Math.cos(v);var R=(1-E)*Math.tan(m),I=R*(m=1/Math.sqrt(1+R*R)),F=Math.atan2(R,v),U=(R=m*C)*R,j=1-U,ee=27233160610754688e-5*j/4040829998466145e-2,te=1+ee/16384*(4096+ee*(ee*(320-175*ee)-768)),Z=ee/1024*(256+ee*(ee*(74-47*ee)-128));ee=w/(635675231424518e-8*te);for(var le,ve,be,ue=2*Math.PI;1e-12<Math.abs(ee-ue);)be=Math.cos(2*F+ee),ue=ee,ee=w/(635675231424518e-8*te)+Z*(le=Math.sin(ee))*(be+Z/4*((ve=Math.cos(ee))*(2*be*be-1)-Z/6*be*(4*le*le-3)*(4*be*be-3)));return w=I*le-m*ve*v,j=E/16*j*(4+E*(4-3*j)),f.h.construct((g+(Math.atan2(le*C,m*ve-I*le*v)-(1-j)*E*R*(ee+j*le*(be+j*ve*(2*be*be-1)))))/c,Math.atan2(I*ve+m*le*v,(1-E)*Math.sqrt(U+w*w))/c)},u.EM=function(m,g,v,w){var E=.0033528106647474805,C=w-g,R=Math.atan((1-E)*Math.tan(m)),I=Math.atan((1-E)*Math.tan(v)),F=Math.sin(R);R=Math.cos(R);var U=Math.sin(I);I=Math.cos(I);var j=C,ee=1e3;do{var te=Math.sin(j),Z=Math.cos(j),le=Math.sqrt(I*te*I*te+(R*U-F*I*Z)*(R*U-F*I*Z));if(le===0)return 0;Z=F*U+R*I*Z;var ve=Math.atan2(le,Z),be=R*I*te/le,ue=1-be*be;te=Z-2*F*U/ue,isNaN(te)&&(te=0);var Le=E/16*ue*(4+E*(4-3*ue)),Be=j;j=C+(1-Le)*E*be*(ve+Le*le*(te+Le*Z*(2*te*te-1)))}while(1e-12<Math.abs(j-Be)&&0<--ee);return ee===0?(F=w-g,{azimuth:Math.atan2(Math.sin(F)*Math.cos(v),Math.cos(m)*Math.sin(v)-Math.sin(m)*Math.cos(v)*Math.cos(F)),geodesicDistance:6371008771415059e-9*Math.acos(Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos(w-g))}):(g=(m=27233160610754688e-5*ue/4040829998466145e-2)/1024*(256+m*(m*(74-47*m)-128)),{azimuth:Math.atan2(I*Math.sin(j),R*U-F*I*Math.cos(j)),QQ:635675231424518e-8*(1+m/16384*(4096+m*(m*(320-175*m)-768)))*(ve-g*le*(te+g/4*(Z*(2*te*te-1)-g/6*te*(4*le*le-3)*(4*te*te-3)))),MY:Math.atan2(R*Math.sin(j),R*U*Math.cos(j)-F*I)})},u.bQ=function(m){var g=m.hasAttribute(1),v=m.hasAttribute(2),w=[],E=m.ea(),C=null,R=null;g&&(C=m.vb(1)),v&&(R=m.vb(2));for(var I=new f.h,F=0;F<E;F++){for(var U=m.Ca(F),j=m.Ka(F),ee=0,te=0,Z=NaN,le=NaN,ve=NaN,be=NaN,ue=m.ec(F),Le=[],Be=U;Be<U+j;Be++){m.D(Be,I),be=ve=NaN;var it=[I.x,I.y];g&&(ve=C.get(Be),it.push(ve)),v&&(E=R.get(Be),it.push(be)),Be==U&&ue&&(ee=I.x,te=I.y,Z=ve,le=be),Le.push(it)}!ue||ee==I.x&&te==I.y&&(!g||isNaN(Z)&&isNaN(ve)||Z==ve)&&(!v||isNaN(le)&&isNaN(be)||le==be)||Le.push(Le[0].slice(0)),w.push(Le)}return w},u.Ry=function(m,g){m=u.bQ(m),637.100877141506>g&&(g=637.100877141506);for(var v,w=[],E=0;E<m.length;E++){var C,R,I=m[E];w.push(v=[]),v.push([I[0][0],I[0][1]]);var F=I[0][0]*c,U=I[0][1]*c;for(C=0;C<I.length-1;C++){var j=I[C+1][0]*c,ee=I[C+1][1]*c;if(F!==j||U!==ee){j=(ee=u.EM(U,F,ee,j)).azimuth;var te=(ee=ee.QQ)/g;if(1<te){for(R=1;R<=te-1;R++){var Z=u.Tx(U,F,j,R*g);v.push([Z.x,Z.y])}R=u.Tx(U,F,j,(ee+Math.floor(te-1)*g)/2),v.push([R.x,R.y])}U=u.Tx(U,F,j,ee),v.push([U.x,U.y]),F=U.x*c,U=U.y*c}}}return{iJ:w}},u.PQ=function(m){for(var g=[],v=0;v<m.length;v++){var w=m[v];w=u.Ry(w,1e4),g.push(w)}m=[];for(var E=0;E<g.length;E++){w=g[E];var C=0;for(v=0;v<w.iJ.length;v++){var R,I=w.iJ[v],F=u.wu(f.h.construct(I[0][0],I[0][1])),U=u.wu(f.h.construct(I[I.length-1][0],I[I.length-1][1])),j=U.x*F.y-F.x*U.y;for(R=0;R<I.length-1;R++)F=u.wu(f.h.construct(I[R+1][0],I[R+1][1])),j+=(U=u.wu(f.h.construct(I[R][0],I[R][1]))).x*F.y-F.x*U.y;C+=j}C/=1,m.push(C/-2)}return m},u}(),f.cb=function(){function u(){}return u.rB=function(m,g,v,w,E,C,R){u.ZC[m.dc()]=g,isNaN(v)==0&&(u.eD[m.dc()]=v),isNaN(w)==0&&(u.rD[m.dc()]=w),isNaN(E)==0&&(u.TC[m.dc()]=E),u.fD[m.dc()]=C,R!==null&&(u.gD[m.dc()]=R)},u.Xw=function(m,g,v){u.kD[m.dc()+"-"+g.dc()]=v},u.tc=function(m){if((m=u.ZC[m.dc()])==null)throw f.i.Fe();return m},u.bf=function(m){if((m=u.eD[m.dc()])==null)throw f.i.Fe();return m},u.wv=function(m){if((m=u.rD[m.dc()])==null)throw f.i.Fe();return m},u.fv=function(m){if((m=u.TC[m.dc()])==null)throw f.i.Fe();return m},u.hh=function(m){if((m=u.gD[m.dc()])==null)throw f.i.Fe();return f.l.construct(m[0],m[1],m[2],m[3])},u.Xc=function(m){if((m=u.fD[m.dc()])==null)throw f.i.Fe();return m},u.Ah=function(m,g,v){if(g.Nb(v))return m;var w=u.kD[g.dc()+"-"+v.dc()];if(w!==void 0)return w(m,g,v);throw f.i.Fe()},u.vt=function(){throw f.i.Fe()},u.UQ=function(){throw f.i.Fe()},u.UV=function(){throw f.i.Fe()},u.ol=function(){throw f.i.Fe()},u.iW=function(){var m=f.Gg.create(102100),g=f.Gg.create(3857),v=f.Gg.create(4326);f.cb.rB(m,v,NaN,NaN,NaN,!1,null),f.cb.rB(v,v,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]),f.cb.rB(g,v,NaN,NaN,NaN,!1,null),f.cb.Xw(m,v,h),f.cb.Xw(v,m,o),f.cb.Xw(g,v,h),f.cb.Xw(v,g,o)},u.ZC=[],u.eD=[],u.rD=[],u.TC=[],u.fD=[],u.gD=[],u.kD=[],u}()}(ae||(ae={})),ae.cb.iW(),function(f){var N=function(){function T(d){this.o=new Int32Array(0),this.jo=-1,this.Jg=this.size=this.Dl=0,this.Mf=d}return T.prototype.kd=function(d){d<this.Dl?(this.o[d*this.Mf]=this.jo,this.jo=d):this.Dl--,this.size--},T.prototype.U=function(d,h){return this.o[d*this.Mf+h]},T.prototype.T=function(d,h,o){this.o[d*this.Mf+h]=o},T.prototype.De=function(){var d=this.jo;if(d==-1){if(this.Dl==this.Jg){if(2147483647<(d=this.Jg!=0?f.P.truncate(3*(this.Jg+1)/2):1)&&(d=2147483647),d==this.Jg)throw f.i.re();this.yz(d)}d=this.Dl,this.Dl++}else this.jo=this.o[d*this.Mf];this.size++;for(var h=d*this.Mf;h<d*this.Mf+this.Mf;h++)this.o[h]=-1;return d},T.prototype.Nl=function(d){var h=this.jo;if(h==-1){if(this.Dl==this.Jg){if(2147483647<(h=this.Jg!=0?f.P.truncate(3*(this.Jg+1)/2):1)&&(h=2147483647),h==this.Jg)throw f.i.re();this.yz(h)}h=this.Dl,this.Dl++}else this.jo=this.o[h*this.Mf];this.size++;for(var o=h*this.Mf,c=0;c<d.length;c++)this.o[o+c]=d[c];return h},T.prototype.nj=function(d){this.jo=-1,this.size=this.Dl=0,d&&(this.o=null,this.Jg=0)},T.prototype.Ee=function(d){d>this.Jg&&this.yz(d)},T.prototype.rx=function(d,h){d*=this.Mf,h*=this.Mf;for(var o=0;o<this.Mf;o++){var c=this.o[h+o];this.o[h+o]=this.o[d+o],this.o[d+o]=c}},T.prototype.$B=function(d,h,o){var c=this.o[this.Mf*h+o];this.o[this.Mf*h+o]=this.o[this.Mf*d+o],this.o[this.Mf*d+o]=c},T.DG=function(d){return 0<=d},T.prototype.yz=function(d){this.o==null&&(this.o=new Int32Array(0));var h=new Int32Array(this.Mf*d);h.set(this.o,0),this.o=h,this.Jg=d},T}();f.ad=N}(ae||(ae={})),function(f){var N,T;(T=N||(N={}))[T.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",T[T.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate",T[T.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding",T[T.enumInputModeIsSimplePolygon=7]="enumInputModeIsSimplePolygon";var d=function(){function o(c){this.Ce=c,this.zh=NaN,this.XG=new f.hg,this.YG=new f.hg,this.ns=new f.Oc,this.os=new f.Oc}return o.prototype.compare=function(c,u,m){if(c=c.ka(m),this.Ce.jB(u,this.XG),this.Ce.jB(c,this.YG),u=this.XG.get(),c=this.YG.get(),this.ns.L(u.sa,u.qa),this.os.L(c.sa,c.qa),this.ns.wa<this.os.pa)return-1;if(this.ns.pa>this.os.wa)return 1;m=u.oa==u.ma;var g=c.oa==c.ma;if(m||g){if(m&&g)return 0;if(u.oa==c.oa&&u.sa==c.sa)return m?1:-1;if(u.ma==c.ma&&u.qa==c.qa)return m?-1:1}return(m=u.Me(this.zh,this.ns.pa))==(g=c.Me(this.zh,this.os.pa))&&((g=.5*((m=Math.min(u.ma,c.ma))+this.zh))==this.zh&&(g=m),m=u.Me(g,this.ns.pa),g=c.Me(g,this.os.pa)),m<g?-1:m>g?1:0},o.prototype.TJ=function(c){this.zh=c},o}(),h=function(){function o(c){this.ib=c,this.OH=new f.hg,this.Cf=new f.h,this.qA=new f.Oc}return o.prototype.YW=function(c){this.Cf.N(c)},o.prototype.compare=function(c,u){return this.ib.jB(c.ka(u),this.OH),c=this.OH.get(),this.qA.L(c.sa,c.qa),this.Cf.x<this.qA.pa?-1:this.Cf.x>this.qA.wa?1:(c=c.Me(this.Cf.y,this.Cf.x),this.Cf.x<c?-1:this.Cf.x>c?1:0)},o}();N=function(){function o(){this.$G=this.Ei=this.Hi=this.fA=this.Zn=this.ze=this.Lc=this.kh=this.ge=null,this.Ho=this.xg=-1,this.ZG=!0,this.jA=!1,this.gA=NaN,this.Oi=new f.Nd,this.UN=2147483647,this.TN=f.P.truncate(-2147483648),this.dg=this.be=this.Jl=this.Eq=this.Em=this.Dq=this.Ps=this.Oe=-1,this.xa=0}return o.prototype.sy=function(c){this.gA=c},o.prototype.$m=function(){this.ge==null&&(this.ge=new f.ad(8));var c=this.ge.De();return this.ge.T(c,1,0),c},o.prototype.lU=function(){this.Lc==null&&(this.Lc=new f.ad(8));var c=this.Lc.De();this.Lc.T(c,2,0),this.Lc.T(c,3,0);var u=this.Lc.De();return this.Lc.T(u,2,0),this.Lc.T(u,3,0),this.BJ(c,u),this.BJ(u,c),c},o.prototype.eI=function(){this.ze==null&&(this.ze=new f.ad(8));var c=this.ze.De();return this.ze.T(c,2,0),c},o.prototype.HW=function(c,u){this.ge.T(c,7,u)},o.prototype.on=function(c,u){this.ge.T(c,2,u)},o.prototype.GW=function(c,u){this.ge.T(c,1,u)},o.prototype.ZW=function(c,u){this.ge.T(c,3,u)},o.prototype.WW=function(c,u){this.ge.T(c,4,u)},o.prototype.er=function(c,u){this.ge.T(c,5,u)},o.prototype.XQ=function(c){return this.ge.U(c,5)},o.prototype.FW=function(c,u){this.ge.T(c,6,u)},o.prototype.VM=function(c,u){this.FW(u,c)},o.prototype.AJ=function(c,u){this.Lc.T(c,1,u)},o.prototype.BJ=function(c,u){this.Lc.T(c,4,u)},o.prototype.Vl=function(c,u){this.Lc.T(c,5,u)},o.prototype.Ul=function(c,u){this.Lc.T(c,6,u)},o.prototype.NW=function(c,u){this.Lc.T(c,2,u)},o.prototype.bx=function(c,u){this.Lc.T(c,3,u)},o.prototype.DF=function(c){return this.Lc.U(c,3)},o.prototype.Gt=function(c,u){this.Lc.T(c,7,u)},o.prototype.wK=function(c,u){if(this.om(c)!=-1)for(u=u?-1:c,c=this.om(c);c!=-1;c=this.ks(c))this.g.Sa(this.uj(c),this.Eq,u)},o.prototype.wx=function(c,u){c!=-1&&(this.wK(c,u),this.wK(this.ya(c),u))},o.prototype.Dt=function(c,u){this.ze.T(c,1,u)},o.prototype.Wg=function(c,u){this.ze.T(c,2,u)},o.prototype.ln=function(c,u){this.ze.T(c,3,u),this.DW(c,this.WQ(u)),this.BW(u,c)},o.prototype.BW=function(c,u){this.ze.T(c,4,u)},o.prototype.DW=function(c,u){this.ze.T(c,5,u)},o.prototype.vJ=function(c,u){this.ze.T(c,6,u)},o.prototype.tJ=function(c,u){this.ze.T(c,7,u)},o.prototype.sJ=function(c,u){this.Zn.write(c,u)},o.prototype.uJ=function(c,u){this.fA.write(c,u)},o.prototype.ZX=function(c){var u=0,m=0,g=this.sF(c),v=new f.h,w=new f.h,E=new f.h;this.Zr(g,v),w.N(v);var C=g;do this.nm(C,E),m+=f.h.ub(w,E),this.$e(this.ya(C))!=c&&(u+=(E.x-v.x-(w.x-v.x))*(E.y-v.y+(w.y-v.y))*.5),w.N(E),C=this.kc(C);while(C!=g);this.Zn.write(c,u),this.fA.write(c,m)},o.prototype.FU=function(c,u){var m=new d(this),g=new f.Yj;g.Ee(f.P.truncate(this.xa/2)),g.Wo(m);for(var v=new f.ja(0),w=this.ah(),E=null,C=0,R=new f.h,I=this.Oe;I!=-1;I=this.Sf(I)){if((255&++C)==0&&u!=null&&!u.progress(-1,-1))throw f.i.OC();var F=this.Je(I);if(F!=-1){if(v.Ch(0),!this.VX(g,w,v,F)){this.D(I,R),m.TJ(R.y);var U=F;do{var j=this.Bb(U,w);j!=-1&&(g.wd(j,-1),this.Kb(U,w,-2)),U=this.kc(this.ya(U))}while(F!=U);U=F;do(j=this.Bb(U,w))==-1&&(j=g.addElement(U,-1),v.add(j)),U=this.kc(this.ya(U));while(F!=U)}for(F=v.size-1;0<=F;F--)j=v.get(F),U=g.ka(j),this.Kb(this.ya(U),w,j),this.EU(g,j,c)}else this.Yy(I)==-1&&(E==null&&(E=new h(this)),this.D(I,R),E.YW(R),U=g.xW(E),F=this.Jl,U!=-1&&(j=g.ka(U),this.$e(j)==this.$e(this.ya(j))&&(j=this.GF(g,U)),j!=-1&&(F=this.$e(j))),this.VM(F,I))}this.Lg(w)},o.prototype.EU=function(c,u,m){var g=c.ka(u),v=this.$e(g);if(this.Hn(v)==-1){var w=this.GF(c,u),E=this.ya(g),C=this.$e(E);this.Mp(v),this.Mp(C);var R=this.Hn(v),I=this.Hn(C);if(w==-1&&R==-1&&(C==v?(this.ln(C,this.Jl),R=I=this.Jl):(I==-1&&(this.ln(C,this.Jl),I=this.Jl),this.ln(v,C),R=C)),w!=-1){var F=this.$e(w);I==-1&&(0>=this.Mp(F)?(I=this.Hn(F),this.ln(C,I)):(this.ln(C,F),I=F),C==v&&(R=I))}R==-1&&this.WX(v,C),m==0?this.$V(c,u,g,w,v,C):m==5?this.aW(c,u,g,E,v,C):m==4&&this.ZV(g,w,v,C)}},o.prototype.$V=function(c,u,m,g,v,w){var E=this.hk(v);if(g!=-1){var C=this.hk(w),R=this.hk(this.$e(g));g=E&C&R,R^=R&this.eh(m),(R|=g)!=0&&(this.Wg(w,C|R),this.Wg(v,R|E),E=E||R)}for(u=c.lb(u);u!=-1&&(g=c.ka(u),m=this.$e(this.ya(g)),v=this.hk(m),w=this.eh(g),C=this.$e(g),g=v&(R=this.hk(C))&E,E^=E&w,(E|=g)!=0);u=c.lb(u))this.Wg(m,v|E),this.Wg(C,R|E)},o.prototype.aW=function(c,u,m,g,v,w){if(v!=w){m=this.Bb(m,this.dg),m+=this.Bb(g,this.dg),g=0;var E=new f.ja(0),C=new f.ja(0);C.add(0);for(var R=c.sc(-1);R!=u;R=c.lb(R)){var I=c.ka(R),F=this.ya(I),U=this.$e(I),j=this.$e(F);if(U!=j){if(I=this.Bb(I,this.dg),g+=I+=this.Bb(F,this.dg),F=!1,E.size!=0&&E.Gc()==j&&(C.Jf(),E.Jf(),F=!0),this.Hn(j)==-1)throw f.i.Ra();F&&this.Hn(j)==U||(C.add(g),E.add(U))}}g+=m,E.size!=0&&E.Gc()==w&&(C.Jf(),E.Jf()),g!=0?C.Gc()==0&&(c=this.g.ld,c=this.Ma(c),this.Wg(v,c)):C.Gc()!=0&&(c=this.g.ld,c=this.Ma(c),this.Wg(v,c))}},o.prototype.ZV=function(c,u,m,g){var v=this.Ma(this.g.ld);if(u==-1)this.Wg(g,this.Ho),(1&(c=this.Bb(c,this.xg)))!=0?this.Wg(m,v):this.Wg(m,this.Ho);else{var w=this.hk(g);w==0?(w=this.hk(this.$e(u)),this.Wg(g,w),(1&(c=this.Bb(c,this.xg)))!=0?this.Wg(m,w==v?this.Ho:v):this.Wg(m,w)):(1&(c=this.Bb(c,this.xg)))!=0?this.Wg(m,w==v?this.Ho:v):this.Wg(m,w)}},o.prototype.VX=function(c,u,m,g){var v=g,w=-1,E=-1,C=0;do{if(C==2)return!1;var R=this.Bb(v,u);if(R!=-1){if(w!=-1)return!1;w=R}else{if(E!=-1)return!1;E=v}C++,v=this.kc(this.ya(v))}while(g!=v);return E!=-1&&w!=-1&&(this.Kb(c.ka(w),u,-2),c.Tj(w,E),m.add(w),!0)},o.prototype.WX=function(c,u){var m=this.Mp(c);if(m!=0){var g=this.Mp(u);0<m&&0>g||0>m&&0<g?this.ln(c,u):(u=this.Hn(u))!=-1&&this.ln(c,u)}},o.prototype.nP=function(c,u){this.Eq=this.g.Hd();for(var m=0,g=u.size;m<g;m++){var v=u.get(m),w=this.g.Qa(v,this.Em),E=this.g.Rf(this.g.cd(v)),C=this.g.jc(E);if(f.ba.Ic(C)){var R=this.g.V(v);if(R!=-1){var I=this.g.Qa(R,this.Em);if(w!=I){var F=this.lU(),U=this.ya(F),j=this.kh.De();this.kh.T(j,0,v),this.kh.T(j,1,-1),this.Gt(F,j),this.AJ(F,w),(j=this.Je(w))==-1?(this.on(w,F),this.Vl(F,U),this.Ul(U,F)):(w=this.ue(j),this.Vl(j,U),this.Ul(U,j),this.Ul(w,F),this.Vl(F,w)),this.AJ(U,I),(w=this.Je(I))==-1?(this.on(I,U),this.Ul(F,U),this.Vl(U,F)):(I=this.ue(w),this.Vl(w,F),this.Ul(F,w),this.Ul(I,U),this.Vl(U,I)),E=this.Ma(E),c==0?(this.Kb(U,this.be,0),this.Kb(F,this.be,C==1736?E:0)):c==5?(I=new f.h,this.g.D(v,I),v=new f.h,this.g.D(R,v),w=R=0,0>I.compare(v)?R=1:w=-1,this.Kb(U,this.be,0),this.Kb(F,this.be,0),this.Kb(F,this.dg,R),this.Kb(U,this.dg,w)):c==7?(this.Kb(U,this.be,this.Ho),this.Kb(F,this.be,C==1736?E:0)):c==4&&(this.Kb(U,this.be,0),this.Kb(F,this.be,0),this.Kb(F,this.xg,1),this.Kb(U,this.xg,1)),C=C==1736?this.TN:0,this.bx(F,E|C),this.bx(U,E|C)}}}}},o.prototype.LT=function(c,u){var m=this.om(u);if(m!=-1){var g=this.om(c);this.kh.T(m,1,g),this.Gt(c,m),this.Gt(u,-1)}c=this.ya(c),u=this.ya(u),(m=this.om(u))!=-1&&(g=this.om(c),this.kh.T(m,1,g),this.Gt(c,m),this.Gt(u,-1))},o.prototype.wX=function(c){function u(ve,be){return g.zO(ve,be)}var m=new f.ja(0);m.Jb(10);for(var g=this,v=this.Oe;v!=-1;v=this.Sf(v)){m.clear(!1);var w=this.Je(v);if(w!=-1){var E=w;do m.add(E),E=this.kc(this.ya(E));while(E!=w);if(1<m.size){if(E=!0,2<m.size)m.Wd(0,m.size,u),m.add(m.get(0));else if(0<this.yO(m.get(0),m.get(1))){var C=m.get(0);m.set(0,m.get(1)),m.set(1,C)}else E=!1;for(var R=C=m.get(0),I=this.vf(R),F=this.ya(R),U=-1,j=1,ee=m.size;j<ee;j++){var te=m.get(j),Z=this.ya(te),le=this.jk(Z);if(le==I&&te!=R){if(c==0)U=this.DF(R)|this.DF(te),this.bx(R,U),this.bx(F,U),this.Kb(R,this.be,this.Bb(R,this.be)|this.Bb(te,this.be)),this.Kb(F,this.be,this.Bb(F,this.be)|this.Bb(Z,this.be));else if(this.dg!=-1)U=this.Bb(R,this.dg)+this.Bb(te,this.dg),Z=this.Bb(F,this.dg)+this.Bb(Z,this.dg),this.Kb(R,this.dg,U),this.Kb(F,this.dg,Z);else{if(c==7)return void(this.Oi=new f.Nd(5,v,-1));this.xg!=-1&&(U=this.Bb(R,this.xg)+this.Bb(te,this.xg),Z=this.Bb(F,this.xg)+this.Bb(Z,this.xg),this.Kb(R,this.xg,U),this.Kb(F,this.xg,Z))}this.LT(R,te),this.Fy(te),U=R,m.set(j,-1),te==C&&(m.set(0,-1),C=-1)}else this.wx(U,!1),U=-1,R=te,I=le,F=Z}if(this.wx(U,!1),U=-1,E){for(C=-1,j=0,ee=m.size;j<ee;j++)if((te=m.get(j))!=-1){if(C==-1)R=C=te,I=this.vf(R),F=this.ya(R);else if(te!=R&&(Z=this.ya(te),le=this.jk(Z),this.Ul(F,te),this.Vl(te,F),R=te,I=le,F=Z,c==7&&(this.Bb(te,this.be)|this.Bb(this.ue(te),this.be))==(1|this.Ho)))return void(this.Oi=new f.Nd(5,v,-1))}this.on(v,C)}else{for(C=-1,j=0,ee=m.size;j<ee;j++)if((te=m.get(j))!=-1){C=te;break}w!=C&&this.on(v,C)}}}}},o.prototype.ON=function(){for(var c=-1,u=this.ah(),m=this.Oe;m!=-1;m=this.Sf(m)){var g=this.Je(m);if(g!=-1){var v=g;do{if(this.Bb(v,u)!=1){var w=this.eI();this.Dt(w,v),this.tJ(w,c),c!=-1&&this.vJ(c,w),c=w;var E=0,C=v;do E|=this.Bb(C,this.be),this.NW(C,w),this.Kb(C,u,1),C=this.kc(C);while(C!=v);this.Wg(w,E)}v=this.kc(this.ya(v))}while(v!=g)}}w=this.eI(),this.Dt(w,-1),this.tJ(w,c),c!=-1&&this.vJ(c,w),this.Jl=w,this.Zn=f.ce.rf(this.ze.size,NaN),this.fA=f.ce.rf(this.ze.size,NaN),this.sJ(this.Jl,1/0),this.uJ(this.Jl,1/0),this.Lg(u)},o.prototype.jR=function(c,u,m){if((u=u!=-1?u:this.Je(c))==-1)return-1;for(c=u;;){if(this.Bb(u,m)!=1)return u;if((u=this.kc(this.ya(u)))==c)return-1}},o.prototype.oW=function(){for(var c=this.ah(),u=this.Oe;u!=-1;u=this.Sf(u))for(var m=-1;;){var g=this.jR(u,m,c);if(g==-1)break;m=this.kc(this.ya(g));for(var v=g;;){var w=this.kc(v),E=this.ue(v),C=this.ya(v);if(E==C){if(this.AP(v),m!=v&&m!=C||(m=-1),v==g||E==g){if(v==(g=w)||E==g)break;v=w;continue}}else this.Kb(v,c,1);if((v=w)==g)break}}this.Lg(c)},o.prototype.GB=function(c,u,m,g,v){this.Vg(),this.ZG=v,this.g=c,this.Dq=this.g.TE(),(c=new f.ja(0)).Jb(m!=null?this.g.I(m.get(0)):this.g.gd);var w=0,E=1,C=m!=null?m.get(0):this.g.ld;for(v=1;C!=-1;){this.g.zJ(C,this.Dq,E),E<<=1;for(var R=this.g.Ob(C);R!=-1;R=this.g.Sb(R))for(var I=this.g.Ya(R),F=0,U=this.g.Ka(R);F<U;F++)c.add(I),I=this.g.V(I);f.ba.Sn(this.g.jc(C))||(w+=this.g.ea(C)),m!=null?(C=v<m.size?m.get(v):-1,v++):C=this.g.ve(C)}for(this.Ho=E,this.xa=c.size,this.g.mx(c,this.xa),this.kh==null&&(this.kh=new f.ad(2),this.ge=new f.ad(8),this.Lc=new f.ad(8),this.ze=new f.ad(8)),this.kh.Ee(this.xa),f.np.Bp(g),this.ge.Ee(this.xa+10),this.Lc.Ee(2*this.xa+32),this.ze.Ee(Math.max(32,w)),this.Em=this.g.Hd(),m=new f.h,v=0,w=new f.h,m.Sc(),E=0;E<=this.xa;E++)if(E<this.xa?(I=c.get(E),this.g.D(I,w)):w.Sc(),!m.rb(w)){if(v<E){for(I=this.$m(),U=F=-1;v<E;v++)U=c.get(v),this.g.Sa(U,this.Em,I),C=this.kh.De(),this.kh.T(C,0,U),this.kh.T(C,1,F),F=C,R=this.g.cd(U),C=this.g.Rf(R),C=this.Ma(C),this.GW(I,this.yd(I)|C);this.HW(I,F),this.er(I,this.g.Va(U)),this.Ps!=-1&&this.WW(this.Ps,I),this.ZW(I,this.Ps),this.Ps=I,this.Oe==-1&&(this.Oe=I)}v=E,m.N(w)}f.np.Bp(g),this.be=this.ah(),u==5&&(this.dg=this.ah()),u==4&&(this.xg=this.ah()),this.nP(u,c),this.Oi.Kj==0&&(this.wX(u),this.Oi.Kj==0&&(isNaN(this.gA)||this.pO()?(this.ON(),this.Oi.Kj==0&&(this.Lg(this.be),this.be=-1,this.ZG&&this.FU(u,g))):this.jA=!0))},o.prototype.Fy=function(c){var u=this.kc(c),m=this.ue(c),g=this.ya(c),v=this.kc(g),w=this.ue(g);u!=g&&(this.Ul(w,u),this.Vl(u,w)),m!=g&&(this.Ul(m,v),this.Vl(v,m)),m=this.jk(c),this.Je(m)==c&&(v!=c?this.on(m,v):this.on(m,-1)),v=this.jk(g),this.Je(v)==g&&(u!=g?this.on(v,u):this.on(v,-1)),this.Lc.kd(c),this.Lc.kd(g)},o.prototype.GF=function(c,u){for(;;){if((u=c.xe(u))==-1)return-1;var m=c.ka(u);if(this.$e(m)!=this.$e(this.ya(m)))return m}},o.prototype.fr=function(c,u){var m;m===void 0&&(m=!0),this.GB(c,0,null,u,m)},o.prototype.nJ=function(c,u,m){var g=new f.ja(0);g.add(u),this.GB(c,4,g,m,c.jc(u)==1736)},o.prototype.oJ=function(c,u,m){var g=new f.ja(0);g.add(u),this.GB(c,5,g,m,!0)},o.prototype.Vg=function(){this.g!=null&&(this.Dq!=-1&&(this.g.nW(this.Dq),this.Dq=-1),this.Em!=-1&&(this.g.Ud(this.Em),this.Em=-1),this.Eq!=-1&&(this.g.Ud(this.Eq),this.Eq=-1),this.be!=-1&&(this.Lg(this.be),this.be=-1),this.dg!=-1&&(this.Lg(this.dg),this.dg=-1),this.xg!=-1&&(this.Lg(this.xg),this.xg=-1),this.g=null,this.ge.nj(!0),this.kh.nj(!0),this.Ps=this.Oe=-1,this.Lc!=null&&this.Lc.nj(!0),this.Hi!=null&&(this.Hi.length=0),this.Ei!=null&&(this.Ei.length=0),this.$G!=null&&(this.$G.length=0),this.ze!=null&&this.ze.nj(!0),this.Jl=-1,this.Zn=null)},o.prototype.Je=function(c){return this.ge.U(c,2)},o.prototype.D=function(c,u){this.g.WF(this.XQ(c),u)},o.prototype.yd=function(c){return this.ge.U(c,1)},o.prototype.Sf=function(c){return this.ge.U(c,4)},o.prototype.Yy=function(c){return this.ge.U(c,6)},o.prototype.mm=function(c){return this.ge.U(c,7)},o.prototype.ks=function(c){return this.kh.U(c,1)},o.prototype.uj=function(c){return this.kh.U(c,0)},o.prototype.ng=function(c,u){return(u=this.Ei[u]).size<=c?-1:u.read(c)},o.prototype.pn=function(c,u,m){(u=this.Ei[u]).size<=c&&u.resize(this.ge.size,-1),u.write(c,m)},o.prototype.Fp=function(){this.Ei==null&&(this.Ei=[]);for(var c=f.ja.rf(this.ge.Jg,-1),u=0,m=this.Ei.length;u<m;u++)if(this.Ei[u]==null)return this.Ei[u]=c,u;return this.Ei.push(c),this.Ei.length-1},o.prototype.Gp=function(c){this.Ei[c]=null},o.prototype.jk=function(c){return this.Lc.U(c,1)},o.prototype.vf=function(c){return this.jk(this.ya(c))},o.prototype.ya=function(c){return this.Lc.U(c,4)},o.prototype.ue=function(c){return this.Lc.U(c,5)},o.prototype.kc=function(c){return this.Lc.U(c,6)},o.prototype.$e=function(c){return this.Lc.U(c,2)},o.prototype.af=function(c){return this.hk(this.Lc.U(c,2))},o.prototype.om=function(c){return this.Lc.U(c,7)},o.prototype.Zr=function(c,u){this.D(this.jk(c),u)},o.prototype.nm=function(c,u){this.D(this.vf(c),u)},o.prototype.eh=function(c){return this.Lc.U(c,3)&this.UN},o.prototype.Bb=function(c,u){return(u=this.Hi[u]).size<=c?-1:u.read(c)},o.prototype.Kb=function(c,u,m){(u=this.Hi[u]).size<=c&&u.resize(this.Lc.size,-1),u.write(c,m)},o.prototype.ah=function(){this.Hi==null&&(this.Hi=[]);for(var c=f.ja.rf(this.Lc.Jg,-1),u=0,m=this.Hi.length;u<m;u++)if(this.Hi[u]==null)return this.Hi[u]=c,u;return this.Hi.push(c),this.Hi.length-1},o.prototype.Lg=function(c){this.Hi[c]=null},o.prototype.AP=function(c){var u=this.$e(c),m=this.ya(c),g=this.kc(c);g==m&&(g=this.kc(g))==c&&(g=-1);var v=this.sF(u);v!==c&&v!=m||this.Dt(u,g),m=this.Zn.read(u),isNaN(m)||(this.sJ(u,NaN),this.uJ(u,NaN)),this.wx(c,!0),this.Fy(c)},o.prototype.BP=function(c){for(var u=0,m=c.size;u<m;u++){var g=c.get(u),v=this.$e(this.ya(g));this.Dt(this.$e(g),-1),this.Dt(v,-1),this.wx(g,!0),this.Fy(g)}},o.prototype.sF=function(c){return this.ze.U(c,1)},o.prototype.hk=function(c){return this.ze.U(c,2)},o.prototype.Hn=function(c){return this.ze.U(c,3)},o.prototype.WQ=function(c){return this.ze.U(c,4)},o.prototype.Mp=function(c){var u=this.Zn.read(c);return isNaN(u)&&(this.ZX(c),u=this.Zn.read(c)),u},o.prototype.Ma=function(c){return this.g.CF(c,this.Dq)},o.prototype.Ie=function(c){return this.g.Qa(c,this.Em)},o.prototype.lR=function(c){return this.g.Qa(c,this.Eq)},o.prototype.kR=function(c,u){var m=this.Je(c);if(m==-1)return-1;var g=m,v=-1,w=-1;do{if(this.vf(g)==u)return g;if(v==-1){if((v=this.Je(u))==-1)break;w=v}if(this.vf(w)==c)return this.ya(w);g=this.kc(this.ya(g)),w=this.kc(this.ya(w))}while(g!=m&&w!=v);return-1},o.prototype.jB=function(c,u){u.Pr(),u=u.get();var m=new f.h;this.Zr(c,m),u.Ec(m),this.nm(c,m),u.Rc(m)},o.prototype.zO=function(c,u){if(c==u)return 0;var m=new f.h;this.nm(c,m);var g=new f.h;return this.nm(u,g),m.rb(g)?0:(u=new f.h,this.Zr(c,u),(c=new f.h).vc(m,u),(m=new f.h).vc(g,u),f.h.ou(c,m))},o.prototype.yO=function(c,u){if(c==u)return 0;var m=new f.h;this.nm(c,m);var g=new f.h;return this.nm(u,g),m.rb(g)?0:(u=new f.h,this.Zr(c,u),(c=new f.h).vc(m,u),(m=new f.h).vc(g,u),0<=m.y&&0<c.y?f.h.ou(c,m):0)},o.prototype.pO=function(){for(var c=f.mc.nx(this.gA),u=new f.h,m=new f.h,g=new f.h,v=new f.h,w=new f.h,E=this.Oe;E!=-1;E=this.Sf(E)){var C=this.Je(E);if(C!=-1){var R=C;this.Zr(R,u),this.nm(R,m),w.vc(m,u);var I=w.Sk();do{var F=R;if((R=this.kc(this.ya(R)))!=F){this.nm(R,g),v.vc(g,u),F=v.Sk();var U=v.xi(w);if(U*U/(F*I)*Math.min(F,I)<=c)return!1;w.N(v),I=F,m.N(g)}}while(R!=C)}}return!0},o}(),f.ju=N}(ae||(ae={})),function(f){var N=function(){function T(){this.j=null,this.gH=new f.h,this.hH=new f.h,this.Hj=null,this.Nv=!1,this.vl=-1}return T.prototype.cf=function(d){return d<this.Hj.length&&this.Hj[d]},T.prototype.el=function(d,h,o,c){var u=f.ba.uf(this.j.g.jc(o));if(f.ba.uf(this.j.g.jc(h))!=2||u!=1)throw f.i.Ra();this.xP(d,h,o,c)},T.prototype.fr=function(d,h){this.j==null&&(this.j=new f.ju),this.j.fr(d,h)},T.prototype.Ft=function(d,h,o){for(f.Tk.W(d,h,o,!0),h=d.ld;h!=-1;h=d.ve(h))d.jc(h)==1736&&f.tn.W(d,h,-1,this.Nv,o);this.fr(d,o)},T.prototype.EE=function(d,h,o,c,u){var m=this.j.g;if(m.jc(d)==1736)for(d=m.Ob(d);d!=-1;d=m.Sb(d)){var g=m.Ya(d);this.j.Ie(g),this.j.Ie(m.V(g));var v=this.j.lR(g);if(v!=-1){var w=this.j.Bb(v,o);if(w!=1&&w!=2)if(this.cf(this.j.af(v))){this.j.Kb(v,o,1),w=m.wf(h,-1);var E=v,C=this.j.Ie(g),R=1;do{var I=this.um(g,u);m.jj(w,I),c!=-1&&this.j.pn(C,c,1),this.j.Kb(E,o,1),E=this.j.kc(E);do var F=(I=R==1?m.V(g):m.Na(g))!=-1?this.j.Ie(I):-1;while(F==C);var U=this.j.jk(E);if(U!=F){do F=(I=R==1?m.Na(g):m.V(g))!=-1?this.j.Ie(I):-1;while(F==C);U!=F?(F=U,I=this.j.uj(this.j.mm(F))):R=-R}C=F,g=I}while(E!=v);m.mn(w,!0)}else this.j.Kb(v,o,2)}}},T.prototype.XE=function(){for(var d=this.j.ah(),h=new f.ja(0),o=this.j.Oe;o!=-1;o=this.j.Sf(o)){var c=this.j.Je(o),u=c;if(c!=-1)do{if(this.j.Bb(u,d)!=1){var m=this.j.ya(u);this.j.Kb(m,d,1),this.j.Kb(u,d,1),this.cf(this.j.af(u))&&this.cf(this.j.af(m))&&h.add(u)}u=this.j.kc(this.j.ya(u))}while(u!=c)}this.j.Lg(d),this.j.BP(h)},T.prototype.um=function(d,h){return h==-1?d:this.SR(d,h)},T.prototype.SR=function(d,h){var o=this.j.g,c=this.j.mm(this.j.Ie(d));do{var u=this.j.uj(c);if(o.Rf(o.cd(u))==h)return u;c=this.j.ks(c)}while(c!=-1);return d},T.prototype.Pt=function(d,h,o){this.XE();var c=this.j.g,u=c.Kg(1736),m=this.j.ah();return this.mK(d,h,u,o,m,-1),this.j.Lg(m),f.tn.W(c,u,1,this.Nv,null),u},T.prototype.mK=function(d,h,o,c,u,m){for(this.EE(d,o,u,m,c),h!=-1&&this.EE(h,o,u,m,c),d=this.j.g,h=this.j.Oe;h!=-1;h=this.j.Sf(h)){var g=this.j.Je(h);if(g!=-1){var v=g;do{var w=this.j.Bb(v,u);if(w!=1&&w!=2)if(this.cf(this.j.af(v))){w=d.wf(o,-1);var E=v;do{var C=this.j.om(E);C!=-1?C=this.j.uj(C):(C=this.j.uj(this.j.om(this.j.ya(E))),C=this.j.g.V(C)),C=this.um(C,c),d.jj(w,C),this.j.Kb(E,u,1),m!=-1&&(C=this.j.Ie(C),this.j.pn(C,m,1)),E=this.j.kc(E)}while(E!=v);d.mn(w,!0)}else this.j.Kb(v,u,2);v=this.j.kc(this.j.ya(v))}while(v!=g)}}},T.prototype.PX=function(d,h,o){var c=this.j.g,u=c.Kg(1736),m=c.Kg(1607),g=c.Kg(550);this.XE();var v=-1,w=this.j.ah(),E=this.j.Fp();for(this.mK(d,h,u,o,w,E),d=this.j.Oe;d!=-1;d=this.j.Sf(d))if((h=this.j.Je(d))!=-1){var C=h;do{var R=this.j.Bb(C,w),I=this.j.Bb(this.j.ya(C),w);if((R|=I)==2)if(R=this.j.eh(C),this.cf(R)){var F=c.wf(m,-1),U=C;R=this.Zw(d,c),R=this.um(R,o),c.jj(F,R),this.j.pn(d,E,1);do{if(R=this.j.vf(U),I=this.Zw(R,c),I=this.um(I,o),c.jj(F,I),this.j.Kb(U,w,1),this.j.Kb(this.j.ya(U),w,1),this.j.pn(R,E,1),U=this.j.kc(U),R=this.j.Bb(U,w),(R|=I=this.j.Bb(this.j.ya(U),w))!=2)break;if(R=this.j.eh(U),!this.cf(R)){this.j.Kb(U,w,1),this.j.Kb(this.j.ya(U),w,1);break}}while(U!=C)}else this.j.Kb(C,w,1),this.j.Kb(this.j.ya(C),w,1);C=this.j.kc(this.j.ya(C))}while(C!=h)}for(d=this.j.Oe;d!=-1;d=this.j.Sf(d))(R=this.j.ng(d,E))!=1&&(R=this.j.yd(d),this.cf(R)&&(v==-1&&(v=c.wf(g,-1)),(h=this.j.mm(d))!=-1&&(h=this.j.uj(h),R=this.um(h,o),c.jj(v,R))));return this.j.Gp(E),this.j.Lg(w),f.tn.W(c,u,1,this.Nv,null),(o=[])[0]=g,o[1]=m,o[2]=u,o},T.prototype.Zw=function(d,h){var o=-1;for(d=this.j.mm(d);d!=-1;d=this.j.ks(d)){var c=this.j.uj(d);o==-1&&(o=c);var u=this.j.Ma(h.Rf(h.cd(c)));if(this.cf(u)){o=c;break}}return o},T.prototype.fB=function(d,h){for(var o=this.ll(h),c=this.j.jk(h),u=this.j.vf(h),m=0,g=0,v=this.j.mm(c);v!=-1;v=this.j.ks(v)){var w=this.j.uj(v),E=d.cd(w),C=this.j.Ma(d.Rf(E));E=d.Ya(E),(C=(C&o)!=0)&&E==w&&(this.vl=h);var R=d.V(w);R!=-1&&this.j.Ie(R)==u?(m++,C&&(this.vl===-1&&E==R&&(w=this.j.kc(h),this.cf(this.ll(w))&&(this.vl=w)),g++)):(w=d.Na(w))!=-1&&this.j.Ie(w)==u&&(m--,C&&(this.vl===-1&&E===w&&(w=this.j.kc(h),this.cf(this.ll(w))&&(this.vl=w)),g--))}return this.j.D(c,this.gH),this.j.D(u,this.hH),(g!=0?g:m)*(d=f.h.ub(this.gH,this.hH))},T.prototype.ll=function(d){return this.j.eh(d)|this.j.af(d)|this.j.af(this.j.ya(d))},T.prototype.pK=function(d){for(var h=this.j.ya(this.j.ue(d)),o=-1;h!=d;){if(this.cf(this.ll(h))){if(o!=-1)return-1;o=h}h=this.j.ya(this.j.ue(h))}return o!=-1?this.j.ya(o):-1},T.prototype.qK=function(d){for(var h=this.j.ya(this.j.kc(d)),o=-1;h!=d;){if(this.cf(this.ll(h))){if(o!=-1)return-1;o=h}h=this.j.ya(this.j.kc(h))}return o!=-1?this.j.ya(o):-1},T.prototype.eJ=function(d,h,o,c,u){var m=this.j.g,g=d,v=this.j.ya(g);this.j.Kb(g,o,1),this.j.Kb(v,o,1),this.vl=-1;for(var w=this.fB(m,g),E=g,C=-1,R=!1,I=1;;){var F=this.j.ue(g);if(F==v)break;if(v=this.j.kc(v),this.j.ya(F)!=v){if((g=this.pK(g))==-1){R=!0;break}v=this.j.ya(g)}else g=F;if(g==d){C=d;break}if(F=this.ll(g),!this.cf(F))break;this.j.Kb(g,o,1),this.j.Kb(v,o,1),E=g,w+=this.fB(m,g),I++}if(C==-1)for(g=d,v=this.j.ya(g),C=g;(d=this.j.kc(g))!=v;){if(v=this.j.ue(v),this.j.ya(d)!=v){if((g=this.qK(g))==-1){R=!0;break}v=this.j.ya(g)}else g=d;if(F=this.ll(g),!this.cf(F))break;this.j.Kb(g,o,1),this.j.Kb(v,o,1),C=g,w+=this.fB(m,g),I++}else if(this.vl!=-1&&(E=this.vl,C=this.j.ue(this.vl),this.j.ya(C)!=this.j.kc(this.j.ya(E))&&(C=this.pK(E))==-1))throw f.i.Ra();for(0<=w||(g=C,C=this.j.ya(E),E=this.j.ya(g)),o=m.wf(h,-1),g=E,E=this.j.jk(E),R=this.j.vf(C)==E&&R,w=this.Zw(E,m),w=this.um(w,u),m.jj(o,w),c!=-1&&this.j.pn(E,c,1),E=0,I=R?f.P.truncate((I+1)/2):-1;d=this.j.vf(g),w=this.Zw(d,m),w=this.um(w,u),m.jj(o,w),E++,c!=-1&&this.j.pn(d,c,1),R&&E==I&&(o=m.wf(h,-1),m.jj(o,w)),g!=C;)if(d=this.j.kc(g),this.j.ue(this.j.ya(g))!=this.j.ya(d)){if((g=this.qK(g))==-1)throw f.i.Ra()}else g=d},T.prototype.Qt=function(d){for(var h=this.j.g.Kg(1607),o=this.j.ah(),c=this.j.Oe;c!=-1;c=this.j.Sf(c)){var u=this.j.Je(c),m=u;do this.j.Bb(m,o)!=1&&this.cf(this.ll(m))&&this.eJ(m,h,o,-1,d),m=this.j.kc(this.j.ya(m));while(m!=u)}return this.j.Lg(o),h},T.prototype.QX=function(d){for(var h=this.j.g,o=h.Kg(1607),c=h.Kg(550),u=this.j.ah(),m=this.j.Fp(),g=-1,v=this.j.Oe;v!=-1;v=this.j.Sf(v)){var w=this.j.Je(v),E=w;do{var C=this.j.Bb(E,u);C!=1&&(C=this.ll(E),this.cf(C)&&this.eJ(E,o,u,m,d)),E=this.j.kc(this.j.ya(E))}while(E!=w)}for(v=this.j.Oe;v!=-1;v=this.j.Sf(v))(C=this.j.ng(v,m))!=1&&(C=this.j.yd(v),this.cf(C)&&(g==-1&&(g=h.wf(c,-1)),(w=this.j.mm(v))!=-1&&(w=this.j.uj(w),w=this.um(w,d),h.jj(g,w))));return this.j.Lg(u),this.j.Gp(m),(d=[])[0]=c,d[1]=o,d},T.prototype.pr=function(){for(var d=this.j.g,h=d.Kg(550),o=d.wf(h,-1),c=this.j.Oe;c!=-1;c=this.j.Sf(c))if(this.cf(this.j.yd(c))){for(var u=-1,m=this.j.mm(c);m!=-1;m=this.j.ks(m)){var g=this.j.uj(m);u==-1&&(u=g);var v=this.j.Ma(d.Rf(d.cd(g)));if(this.cf(v)){u=g;break}}d.jj(o,u)}return h},T.prototype.eq=function(d){this.Hj=[];for(var h=0;h<d;h++)this.Hj[h]=!1},T.RV=function(d,h,o){var c=d.Ja(),u=Array(1e3);f.P.av(u,null);var m=f.P.lg(1e3,0),g=d.I(),v=!0,w=h.Eb()==2;if(h.Eb()!=1&&h.Eb()!=2)throw f.i.Ra();for(var E=0;E<g;){var C=f.P.truncate(d.bW(u,E)-E);w?f.jd.kK(h,u,C,o,m):f.jd.lK(h,u,C,o,m);for(var R=0,I=0;I<C;I++)m[I]==0&&(v&&(v=!1,c.Gd(d,0,E)),R!=I&&c.Gd(d,E+R,E+I),R=I+1);v||R==C||c.Gd(d,E+R,E+C),E+=C}return v?d:c},T.rG=function(d,h,o){return d instanceof f.de?T.RV(d,h,o):h instanceof f.Ta?d.B()||h.B()?d.Ja():f.Tk.pU(o,d,h)?f.Tk.uO(d,h):d.Ja():T.SV(d,h,o)},T.Bv=function(d,h,o,c){var u=new f.l;d.A(u);var m=new f.l;h.A(m);var g=new f.l;if(g.L(u),g.$b(m),o=f.ta.Xd(o,g,!0),(g=new f.l).L(m),m=f.ta.Gr(o),g.X(m,m),!u.isIntersecting(g)){if(d.Eb()<=h.Eb())return T.li(T.Ue(d.Ja()),d,"&");if(d.Eb()>h.Eb())return T.li(T.Ue(h.Ja()),d,"&")}return m=new T,g=(u=new f.hd).Ib(T.Ue(d)),h=u.Ib(T.Ue(h)),m.Ft(u,o,c),c=m.Bv(g,h),d=T.li(u.Ke(c),d,"&"),f.ba.Ic(d.K())&&(d.Dh(2,o),d.K()==1736&&d.hm()),d},T.SV=function(d,h,o){if(d.B()||h.B())return d.Ja();var c=[null],u=[0],m=h.Eb()==2;if(h.Eb()!=1&&h.Eb()!=2)throw f.i.Ra();return c[0]=d.D(),m?f.jd.kK(h,c,1,o,u):f.jd.lK(h,c,1,o,u),u[0]==0?d.Ja():d},T.prototype.BU=function(d,h,o,c,u){if(d.B())return d;var m=new f.hd;return d=m.Ib(d),this.Mk(m,d,h,o,c,u)},T.prototype.DU=function(d,h,o,c,u,m){if(u&&d.jc(h)!=550){var g=new f.JC;g.HX(d,o),g.Og?(f.Tk.W(d,o,m,!0),u=!1):this.j.sy(o)}else f.Tk.W(d,o,m,!0),u=!1;if(c&&d.jc(h)!=550?this.j.oJ(d,h,m):this.j.nJ(d,h,m),this.j.jA)return this.j.Vg(),this.j=null,this.Mk(d,h,o,c,!1,m);if(this.j.sy(NaN),m=this.j.Ma(h),this.eq(m+1),this.Hj[m]=!0,d.jc(h)==1736||c&&d.jc(h)!=550)return d.Zo(h,0),h=this.Pt(h,-1,-1),(d=d.Ke(h)).Zo(0),u?d.Dh(1,0):(d.Dh(2,o),d.hm()),d;if(d.jc(h)==1607)return h=this.Qt(-1),d=d.Ke(h),u||d.Dh(2,o),d;if(d.jc(h)==550)return h=this.pr(),d=d.Ke(h),u||d.Dh(2,o),d;throw f.i.Ra()},T.prototype.Mk=function(d,h,o,c,u,m){this.j=new f.ju;try{return this.DU(d,h,o,c,u,m)}finally{this.j.Vg()}},T.Mk=function(d,h,o,c,u){return new T().BU(d,h,o,c,u)},T.prototype.CU=function(d,h,o,c){this.Nv=d,this.j=new f.ju,d=h.Jn(o);var u=h.jc(o);if(d!=1||u==550?this.j.nJ(h,o,c):this.j.oJ(h,o,c),!this.j.jA)if(this.j.sy(NaN),c=this.j.Ma(o),this.eq(c+1),this.Hj[c]=!0,h.jc(o)==1736||d==1&&h.jc(o)!=550)h.Zo(o,0),c=this.Pt(o,-1,-1),h.aC(c,o),h.vB(c);else if(h.jc(o)==1607)c=this.Qt(-1),h.aC(c,o),h.vB(c);else{if(h.jc(o)!=550)throw f.i.ga("internal error");c=this.pr(),h.aC(c,o),h.vB(c)}},T.prototype.km=function(d,h){var o=f.ba.uf(this.j.g.jc(d)),c=f.ba.uf(this.j.g.jc(h));if(o>c)return d;var u=this.j.Ma(d),m=this.j.Ma(h);if(this.eq(1+(u|m)),this.Hj[this.j.Ma(d)]=!0,o==2&&c==2)return this.Pt(d,h,-1);if(o==1&&c==2||o==1&&c==1)return this.Qt(-1);if(o==0)return this.pr();throw f.i.Ra()},T.prototype.Bv=function(d,h){var o=f.ba.uf(this.j.g.jc(d)),c=f.ba.uf(this.j.g.jc(h)),u=this.j.Ma(d),m=this.j.Ma(h);if(this.eq(1+(u|m)),this.Hj[this.j.Ma(d)|this.j.Ma(h)]=!0,u=-1,1<this.j.g.ht.Ba&&(u=d),o==2&&c==2)return this.Pt(d,h,u);if(o==1&&0<c||c==1&&0<o)return this.Qt(u);if(o==0||c==0)return this.pr();throw f.i.Ra()},T.prototype.Kz=function(d,h){var o=f.ba.uf(this.j.g.jc(d)),c=f.ba.uf(this.j.g.jc(h)),u=this.j.Ma(d),m=this.j.Ma(h);if(this.eq(1+(u|m)),this.Hj[this.j.Ma(d)|this.j.Ma(h)]=!0,u=-1,1<this.j.g.ht.Ba&&(u=d),o==2&&c==2)return this.PX(d,h,u);if(o==1&&0<c||c==1&&0<o)return this.QX(u);if(o==0||c==0)return(d=[])[0]=this.pr(),d;throw f.i.Ra()},T.prototype.fp=function(d,h){var o=f.ba.uf(this.j.g.jc(d)),c=f.ba.uf(this.j.g.jc(h)),u=this.j.Ma(d),m=this.j.Ma(h);if(this.eq(1+(u|m)),this.Hj[this.j.Ma(d)]=!0,this.Hj[this.j.Ma(h)]=!0,o==2&&c==2)return this.Pt(d,h,-1);if(o==1&&c==1)return this.Qt(-1);if(o==0&&c==0)return this.pr();throw f.i.Ra()},T.Ue=function(d){var h=d.K();return h==197?(h=new f.Ea(d.description),d.B()||h.bd(d,!1),h):h==33?(h=new f.de(d.description),d.B()||h.add(d),h):h==322?(h=new f.Ua(d.description),d.B()||h.oc(d,!0),h):d},T.li=function(d,h,o){var c=d.K();return c==197?(h=new f.Ea(d.description),d.B()||h.bd(d,!1),h):c!=33||o!="|"&&o!="^"?c==322?(h=new f.Ua(d.description),d.B()||h.oc(d,!0),h):c==33&&o=="-"&&h.K()==33||c==550&&o=="&"&&h.K()==33?(h=new f.Ta(d.description),d.B()||d.we(0,h),h):d:(h=new f.de(d.description),d.B()||h.add(d),h)},T.km=function(d,h,o,c){if(d.B()||h.B()||d.Eb()>h.Eb())return T.li(T.Ue(d),d,"-");var u=new f.l;d.A(u);var m=new f.l;if(h.A(m),!u.isIntersecting(m))return T.li(T.Ue(d),d,"-");var g=new f.l;return g.L(u),g.$b(m),o=f.ta.Xd(o,g,!0),m=new T,g=(u=new f.hd).Ib(T.Ue(d)),h=u.Ib(T.Ue(h)),m.Ft(u,o,c),c=m.km(g,h),c=u.Ke(c),d=T.li(c,d,"-"),f.ba.Ic(d.K())&&(d.Dh(2,o),d.K()==1736&&d.hm()),d},T.NP=function(d,h,o){if(2>d.length)throw f.i.O("not enough geometries to dissolve");for(var c=0,u=0,m=d.length;u<m;u++)c=Math.max(d[u].Eb(),c);var g=new f.l;g.Pa();var v=new f.hd,w=-1,E=0,C=-1;for(u=0,m=d.length;u<m;u++)if(d[u].Eb()==c)if(d[u].B())C==-1&&(C=u);else{C=u,w==-1?w=v.Ib(T.Ue(d[u])):v.mN(w,T.Ue(d[u]));var R=new f.l;d[u].yc(R),g.$b(R),E++}return 2>E?T.Ue(d[C]):(d=c==2,h=f.ta.Xd(c==0?h:null,g,!0),new T().Mk(v,w,h,d,!0,o))},T.Kz=function(d,h,o,c){var u=[null,null,null],m=new f.l;d.A(m);var g=new f.l;h.A(g);var v=new f.l;if(v.L(m),v.$b(g),o=f.ta.Xd(o,v,!0),(v=new f.l).L(g),g=f.ta.Gr(o),v.X(g,g),!m.isIntersecting(v)){if(d.Eb()<=h.Eb())return u[(d=T.li(T.Ue(d.Ja()),d,"&")).Eb()]=d,u;if(d.Eb()>h.Eb())return u[(d=T.li(T.Ue(h.Ja()),d,"&")).Eb()]=d,u}for(g=new T,v=(m=new f.hd).Ib(T.Ue(d)),h=m.Ib(T.Ue(h)),g.Ft(m,o,c),c=g.Kz(v,h),h=0;h<c.length;h++)g=T.li(m.Ke(c[h]),d,"&"),f.ba.Ic(g.K())&&(g.Dh(2,o),g.K()==1736&&g.hm()),u[g.Eb()]=g;return u},T.fp=function(d,h,o,c){if(d.Eb()>h.Eb())return T.li(T.Ue(d),d,"^");if(d.Eb()<h.Eb()||d.B())return T.li(T.Ue(h),d,"^");if(h.B())return T.li(T.Ue(d),d,"^");var u=new f.l;d.A(u);var m=new f.l;h.A(m);var g=new f.l;return g.L(u),g.$b(m),o=f.ta.Xd(o,g,!0),m=new T,g=(u=new f.hd).Ib(T.Ue(d)),h=u.Ib(T.Ue(h)),m.Ft(u,o,c),c=m.fp(g,h),d=T.li(u.Ke(c),d,"^"),f.ba.Ic(d.K())&&(d.Dh(2,o),d.K()==1736&&d.hm()),d},T.prototype.DQ=function(d,h){var o=this.j.g;d=o.wf(d,-1);for(var c=h.size,u=0;u<c;u++){var m=h.get(u);o.jj(d,m)}o.mn(d,!0)},T.prototype.OW=function(d,h){for(var o=this.j.g,c=o.ld;c!=-1;c=o.ve(c))if(c==h)for(var u=o.Ob(c);u!=-1;u=o.Sb(u)){var m=o.Ya(u);if(m!=-1)for(var g=o.V(m);g!=-1;){m=this.j.Ie(m);var v=this.j.Ie(g);(m=this.j.kR(m,v))!=-1&&(v=this.j.ya(m),this.j.Kb(m,d,1),this.j.Kb(v,d,2)),m=g,g=o.V(m)}}},T.prototype.TV=function(d,h,o,c){o=this.j.Ma(o),c=this.j.Ma(c);var u=new f.ja(0);u.Jb(256);for(var m=this.j.g,g=this.j.ah(),v=this.j.Oe;v!=-1;v=this.j.Sf(v)){var w=this.j.Je(v);if(w!=-1){var E=w;do{if(this.j.Bb(E,g)!=1){var C=E,R=E,I=!1,F=0;do{if(this.j.Kb(C,g,1),!I){var U=this.j.eh(C);(U&c)!=0&&(this.j.af(C)&o)!=0&&(R=C,I=!0)}I&&(u.add(this.j.uj(this.j.mm(this.j.jk(C)))),d!=-1&&((U=this.j.eh(C))&c)!=0&&(F|=U=this.j.Bb(C,d))),C=this.j.kc(C)}while(C!=R);I&&0<this.j.Mp(this.j.$e(R))&&(C=m.Kg(1736),this.DQ(C,u),h!=-1&&m.zJ(C,h,F)),u.clear(!1)}E=this.j.kc(this.j.ya(E))}while(E!=w)}}this.j.Lg(g)},T.prototype.xP=function(d,h,o,c){this.j.oW();var u=-1;d!=-1&&(u=this.j.ah(),this.OW(u,o)),this.TV(u,d,h,o),u!=-1&&(this.j.Lg(u),u=-1);var m=this.j.g;for(d=0,u=m.ld;u!=-1;u=m.ve(u))u!=h&&u!=o&&(c.add(u),d++);c.Wd(0,d,function(g,v){return(g=m.qz(m.Ob(g)))<(v=m.qz(m.Ob(v)))?-1:g==v?0:1})},T.prototype.Vg=function(){this.j!=null&&(this.j.Vg(),this.j=null)},T}();f.Hg=N}(ae||(ae={})),function(f){var N=function(){function T(d){d!==void 0?this.It(d):this.KB()}return T.prototype.kx=function(){this.Qb=this.Lb=this.qb=this.jb=this.bb=this.eb=0},T.prototype.Nb=function(d){return this==d||d instanceof T&&this.eb==d.eb&&this.jb==d.jb&&this.Lb==d.Lb&&this.qb==d.qb&&this.bb==d.bb&&this.Qb==d.Qb},T.prototype.dc=function(){return f.P.vj(),f.P.vj(),f.P.vj(),f.P.vj(),f.P.vj(),f.P.vj()},T.prototype.Fh=function(d,h){var o=this.qb*d.x+this.bb*d.y+this.Qb;h.x=this.eb*d.x+this.jb*d.y+this.Lb,h.y=o},T.prototype.TX=function(d,h,o){for(var c=0;c<h;c++){var u=d[c].x,m=d[c].y,g=this.eb*u+this.jb*m+this.Lb;u=this.qb*u+this.bb*m+this.Qb,o[c]!=null?o[c].na(g,u):o[c]=f.h.construct(g,u)}},T.prototype.multiply=function(d){T.multiply(this,d,this)},T.multiply=function(d,h,o){var c=d.eb*h.eb+d.qb*h.jb,u=d.jb*h.eb+d.bb*h.jb,m=d.Lb*h.eb+d.Qb*h.jb+h.Lb,g=d.eb*h.qb+d.qb*h.bb,v=d.jb*h.qb+d.bb*h.bb;d=d.Lb*h.qb+d.Qb*h.bb+h.Qb,o.eb=c,o.jb=u,o.Lb=m,o.qb=g,o.bb=v,o.Qb=d},T.prototype.Pf=function(){var d=new T;return d.eb=this.eb,d.jb=this.jb,d.Lb=this.Lb,d.qb=this.qb,d.bb=this.bb,d.Qb=this.Qb,d},T.prototype.fC=function(d){if(!d.B()){for(var h=[],o=0;4>o;o++)h[o]=new f.h;d.hB(h),this.UX(h,h),d.ax(h,4)}},T.prototype.UX=function(d,h){for(var o=0;o<d.length;o++){var c=new f.h,u=d[o];c.x=this.eb*u.x+this.jb*u.y+this.Lb,c.y=this.qb*u.x+this.bb*u.y+this.Qb,h[o]=c}},T.prototype.gS=function(d,h){d.B()||h.B()||d.S()==0||d.da()==0?this.kx():(this.jb=this.qb=0,this.eb=h.S()/d.S(),this.bb=h.da()/d.da(),this.Lb=h.v-d.v*this.eb,this.Qb=h.G-d.G*this.bb)},T.prototype.SX=function(d){var h=new f.h,o=new f.h;h.na(this.eb,this.qb),o.na(this.jb,this.bb),h.sub(h);var c=.5*h.Sk();return h.na(this.eb,this.qb),o.na(this.jb,this.bb),h.add(o),d*(c>(h=.5*h.Sk())?Math.sqrt(c):Math.sqrt(h))},T.prototype.KB=function(){this.eb=1,this.qb=this.Lb=this.jb=0,this.bb=1,this.Qb=0},T.prototype.isIdentity=function(d){if(d!==void 0){var h=f.h.construct(0,1);return this.Fh(h,h),h.sub(f.h.construct(0,1)),h.Sk()>d*d?!1:(h.na(0,0),this.Fh(h,h),!(h.Sk()>d*d)&&(h.na(1,0),this.Fh(h,h),h.sub(f.h.construct(1,0)),h.Sk()<=d*d))}return this.eb==1&&this.bb==1&&this.jb==0&&this.Lb==0&&this.qb==0&&this.Qb==0},T.prototype.Ci=function(d){return Math.abs(this.eb*this.bb-this.qb*this.jb)<=2*d*(Math.abs(this.eb*this.bb)+Math.abs(this.qb*this.jb))},T.prototype.gg=function(d,h){this.eb=1,this.jb=0,this.Lb=d,this.qb=0,this.bb=1,this.Qb=h},T.prototype.It=function(d,h){h!==void 0?(this.eb=d,this.qb=this.Lb=this.jb=0,this.bb=h,this.Qb=0):this.It(d,d)},T.prototype.TB=function(){this.eb=0,this.jb=1,this.Lb=0,this.qb=1,this.Qb=this.bb=0},T.prototype.cX=function(d){this.dX(Math.cos(d),Math.sin(d))},T.prototype.dX=function(d,h){this.eb=d,this.jb=-h,this.Lb=0,this.qb=h,this.bb=d,this.Qb=0},T.prototype.shift=function(d,h){this.Lb+=d,this.Qb+=h},T.prototype.scale=function(d,h){this.eb*=d,this.jb*=d,this.Lb*=d,this.qb*=h,this.bb*=h,this.Qb*=h},T.prototype.flipX=function(d,h){this.eb=-this.eb,this.jb=-this.jb,this.Lb=d+h-this.Lb},T.prototype.flipY=function(d,h){this.qb=-this.qb,this.bb=-this.bb,this.Qb=d+h-this.Qb},T.prototype.rotate=function(d){var h=new T;h.cX(d),this.multiply(h)},T.prototype.inverse=function(d){if(d!==void 0){var h=this.eb*this.bb-this.jb*this.qb;h==0?d.kx():(h=1/h,d.Lb=(this.jb*this.Qb-this.Lb*this.bb)*h,d.Qb=(this.Lb*this.qb-this.eb*this.Qb)*h,d.eb=this.bb*h,d.jb=-this.jb*h,d.qb=-this.qb*h,d.bb=this.eb*h)}else this.inverse(this)},T}();f.Ed=N}(ae||(ae={})),function(f){var N=function(){function T(){}return T.prototype.kx=function(){this.Cg=this.Qb=this.Lb=this.Ze=this.We=this.Ve=this.Ye=this.bb=this.jb=this.pf=this.qb=this.eb=0},T.prototype.It=function(d,h){this.eb=d,this.jb=this.pf=this.qb=0,this.bb=h,this.We=this.Ve=this.Ye=0,this.Ze=void 0,this.Cg=this.Qb=this.Lb=0},T.prototype.translate=function(d,h,o){this.Lb+=d,this.Qb+=h,this.Cg+=o},T.prototype.fC=function(d){if(!d.B()){for(var h=new f.Od[8],o=0;8>o;o++)h[o]=new f.Od;d.hB(h),this.transform(h,8,h),d.ax(h)}},T.prototype.transform=function(d,h,o){for(var c=0;c<h;c++){var u=new f.Od,m=d[c];u.x=this.eb*m.x+this.jb*m.y+this.Ve*m.z+this.Lb,u.y=this.qb*m.x+this.bb*m.y+this.We*m.z+this.Qb,u.z=this.pf*m.x+this.Ye*m.y+this.Ze*m.z+this.Cg,o[c]=u}},T.prototype.gp=function(d){var h=new f.Od;return h.x=this.eb*d.x+this.jb*d.y+this.Ve*d.z+this.Lb,h.y=this.qb*d.x+this.bb*d.y+this.We*d.z+this.Qb,h.z=this.pf*d.x+this.Ye*d.y+this.Ze*d.z+this.Cg,h},T.prototype.Ag=function(d){T.multiply(this,d,this)},T.multiply=function(d,h,o){var c=d.eb*h.eb+d.qb*h.jb+d.pf*h.Ve,u=d.eb*h.qb+d.qb*h.bb+d.pf*h.We,m=d.eb*h.pf+d.qb*h.Ye+d.pf*h.Ze,g=d.jb*h.eb+d.bb*h.jb+d.Ye*h.Ve,v=d.jb*h.qb+d.bb*h.bb+d.Ye*h.We,w=d.jb*h.pf+d.bb*h.Ye+d.Ye*h.Ze,E=d.Ve*h.eb+d.We*h.jb+d.Ze*h.Ve,C=d.Ve*h.qb+d.We*h.bb+d.Ze*h.We,R=d.Ve*h.pf+d.We*h.Ye+d.Ze*h.Ze,I=d.Lb*h.eb+d.Qb*h.jb+d.Cg*h.Ve+h.Lb,F=d.Lb*h.qb+d.Qb*h.bb+d.Cg*h.We+h.Qb;d=d.Lb*h.pf+d.Qb*h.Ye+d.Cg*h.Ze+h.Cg,o.eb=c,o.qb=u,o.pf=m,o.jb=g,o.bb=v,o.Ye=w,o.Ve=E,o.We=C,o.Ze=R,o.Lb=I,o.Qb=F,o.Cg=d},T.inverse=function(d,h){var o=d.eb*(d.bb*d.Ze-d.Ye*d.We)-d.qb*(d.jb*d.Ze-d.Ye*d.Ve)+d.pf*(d.jb*d.We-d.bb*d.Ve);if(o==0)throw f.i.ga("math singularity");var c=1/o;o=(d.bb*d.Ze-d.Ye*d.We)*c;var u=-(d.jb*d.Ze-d.Ye*d.Ve)*c,m=(d.jb*d.We-d.bb*d.Ve)*c,g=-(d.qb*d.Ze-d.We*d.pf)*c,v=(d.eb*d.Ze-d.pf*d.Ve)*c,w=-(d.eb*d.We-d.qb*d.Ve)*c,E=(d.qb*d.Ye-d.pf*d.bb)*c,C=-(d.eb*d.Ye-d.pf*d.jb)*c;c*=d.eb*d.bb-d.qb*d.jb;var R=-(d.Lb*o+d.Qb*u+d.Cg*m),I=-(d.Lb*g+d.Qb*v+d.Cg*w);d=-(d.Lb*E+d.Qb*C+d.Cg*c),h.eb=o,h.qb=g,h.pf=E,h.jb=u,h.bb=v,h.Ye=C,h.Ve=m,h.We=w,h.Ze=c,h.Lb=R,h.Qb=I,h.Cg=d},T.prototype.Pf=function(){var d=new T;return d.eb=this.eb,d.qb=this.qb,d.pf=this.pf,d.jb=this.jb,d.bb=this.bb,d.Ye=this.Ye,d.Ve=this.Ve,d.We=this.We,d.Ze=this.Ze,d.Lb=this.Lb,d.Qb=this.Qb,d.Cg=this.Cg,d},T}();f.yY=N}(ae||(ae={})),function(f){var N=function(d){function h(o){if(o!==void 0)o=d.call(this,o.dc(),o)||this;else{(o=d.call(this)||this).cg=[],o.cg[0]=0,o.Ba=1,o.vh=[];for(var c=0;10>c;c++)o.vh[c]=-1;o.vh[o.cg[0]]=0}return o.lq=!0,o}return Hi(h,d),h.prototype.se=function(o){this.hasAttribute(o)||(this.vh[o]=0,this.bD())},h.prototype.removeAttribute=function(o){if(o==0)throw f.i.O("Position attribue cannot be removed");this.hasAttribute(o)&&(this.vh[o]=-1,this.bD())},h.prototype.reset=function(){this.cg[0]=0,this.Ba=1;for(var o=0;o<this.vh.length;o++)this.vh[o]=-1;this.vh[this.cg[0]]=0,this.lq=!0},h.prototype.wF=function(){return T.fz().add(this)},h.og=function(){return T.fz().RR()},h.prototype.lM=function(){var o=this.dc();return new f.ua(o,this)},h.prototype.bD=function(){for(var o=this.Ba=0,c=0;10>o;o++)0<=this.vh[o]&&(this.cg[c]=o,this.vh[o]=c,c++,this.Ba++);this.lq=!0},h.prototype.dc=function(){return this.lq&&(this.yl=this.Bn(),this.lq=!1),this.yl},h.prototype.Nb=function(o){if(o==null)return!1;if(o==this)return!0;if(!(o instanceof h)||o.Ba!=this.Ba)return!1;for(var c=0;c<this.Ba;c++)if(this.cg[c]!=o.cg[c])return!1;return this.lq==o.lq},h.prototype.yG=function(o){if(o.Ba!=this.Ba)return!1;for(var c=0;c<this.Ba;c++)if(this.cg[c]!=o.cg[c])return!1;return!0},h.Jw=function(o,c){for(var u=[],m=0;m<o.Ba;m++)u[m]=-1;m=0;for(var g=o.Ba;m<g;m++)u[m]=c.Qf(o.qd(m));return u},h.tR=function(o,c){return(o=new h(o)).se(c),o.wF()},h.uR=function(o,c){for(var u=null,m=0;10>m;m++)!o.hasAttribute(m)&&c.hasAttribute(m)&&(u==null&&(u=new h(o)),u.se(m));return u!=null?u.wF():o},h}(f.ua);f.ee=N;var T=function(){function d(){this.map=[];var h=new N;this.add(h),(h=new N).se(1),this.add(h)}return d.fz=function(){return d.UK},d.prototype.RR=function(){return d.ft},d.prototype.add=function(h){var o=h.dc();if(d.ft!=null&&d.ft.dc()==o&&h.yG(d.ft))return d.ft;if(d.Ew!=null&&d.Ew.dc()==o&&h.yG(d.Ew))return d.Ew;var c=null;return this.map[o]!==void 0&&(c=this.map[o]),c==null&&((c=h.lM()).Ba==1?d.ft=c:c.Ba==2&&c.qd(1)==1?d.Ew=c:this.map[o]=c),c},d.UK=new d,d}()}(ae||(ae={}));var Xp={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},Qv={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},e1=new(function(){function f(){this.JM=50,this.op=new Map,this.hj=[]}return f.prototype.clear=function(){this.hj.length=0,this.op.clear()},f.prototype.delete=function(N){return!!this.op.delete(N)&&(this.hj.splice(this.hj.indexOf(N),1),!0)},f.prototype.get=function(N){var T=this.op.get(N);if(T!==void 0)return this.hj[0]!==N&&(this.hj.splice(this.hj.indexOf(N),1),this.hj.unshift(N)),T},f.prototype.has=function(N){return this.op.has(N)},f.prototype.set=function(N,T){return this.get(N)!==void 0&&this.delete(N),this.hj.unshift(N),this.op.set(N,T),this.gM(),this},f.prototype.gM=function(){for(;this.hj.length&&this.hj.length>this.JM;){var N=this.hj.pop();this.op.delete(N)}},f}()),ft=((ji={}).convertJSONToGeometry=function(f){return ae.bc.YO(f)},ji.hasM=function(f){return f.hasAttribute(ae.Jh.M)},ji.hasZ=function(f){return f.hasAttribute(ae.Jh.Z)},ji.getPointX=function(f){return f.Mg()},ji.getPointY=function(f){return f.jh()},ji.getPointZ=function(f){return f.TR()},ji.getPointM=function(f){return f.rR()},ji.getXMin=function(f){return f.fs()},ji.getYMin=function(f){return f.hs()},ji.getXMax=function(f){return f.es()},ji.getYMax=function(f){return f.gs()},ji.getZExtent=function(f){return f.Ug(ae.Jh.Z,0)},ji.getMExtent=function(f){return f.Ug(ae.Jh.M,0)},ji.exportPaths=function(f){var N=[],T=f.ea(),d=null,h=null,o=f.hasAttribute(ae.Jh.Z),c=f.hasAttribute(ae.Jh.M);o&&(d=f.vb(ae.Jh.Z)),c&&(h=f.vb(ae.Jh.M));for(var u=new ae.h,m=0;m<T;m++){for(var g=f.Ca(m),v=f.Ka(m),w=0,E=0,C=NaN,R=NaN,I=NaN,F=NaN,U=f.ec(m),j=[],ee=g;ee<g+v;ee++){f.D(ee,u),F=I=NaN;var te=[u.x,u.y];o&&(I=d.get(ee),te.push(I)),c&&(F=h.get(ee),te.push(F)),ee==g&&U&&(w=u.x,E=u.y,C=I,R=F),j.push(te)}!U||w==u.x&&E==u.y&&(!o||isNaN(C)&&isNaN(I)||C==I)&&(!c||isNaN(R)&&isNaN(F)||R==F)||j.push(j[0].slice(0)),N.push(j)}return N},ji.exportPathsFlat=function(){},ji.exportPoints=function(f){var N=f.hasAttribute(ae.Jh.Z),T=f.hasAttribute(ae.Jh.M),d=null,h=null;N&&(d=f.vb(ae.Jh.Z)),T&&(h=f.vb(ae.Jh.M));for(var o=new ae.h,c=f.I(),u=[],m=0;m<c;m++){f.D(m,o);var g=[o.x,o.y];N&&g.push(d.get(m)),T&&g.push(h.get(m)),u.push(g)}return u},ji.exportPointsFlat=function(){},ji);return function(){function f(){}return f.buffer=De,f.clip=A,f.contains=P,f.convexHull=fe,f.crosses=$,f.cut=M,f.densify=xe,f.difference=me,f.disjoint=q,f.distance=k,f.equals=z,f.extendedSpatialReferenceInfo=x,f.generalize=Ie,f.geodesicArea=Mt,f.geodesicBuffer=ne,f.geodesicDensify=$e,f.geodesicLength=at,f.intersect=Ce,f.intersects=G,f.isSimple=de,f.nearestCoordinate=ye,f.nearestVertex=we,f.nearestVertices=Ee,f.offset=Pe,f.overlaps=X,f.planarArea=et,f.planarLength=ct,f.relate=oe,f.simplify=he,f.symmetricDifference=ge,f.touches=B,f.union=Ae,f.within=W,f.rotate=ae.Cx.rotate,f.flipHorizontal=ae.Cx.BQ,f.flipVertical=ae.Cx.CQ,f._enableProjection=nt,f._project=wr,f._getTransformation=dt,f._getTransformationBySuitability=xt,f}()}var r=i();r!==void 0&&(e.exports=r)})(aK);const dr=aK.exports,ubt=Object.freeze(hbt({__proto__:null,default:dr},[aK.exports]));var dbt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",G:dr,g:ubt});const zr={convertToGEGeometry:pbt,exportPoint:fbt,exportPolygon:mbt,exportPolyline:gbt,exportMultipoint:ybt,exportExtent:vbt};function pbt(e,t){if(t==null)return null;let i="cache"in t?t.cache._geVersion:void 0;return i==null&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i}function fbt(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new Gt({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(n.z=e.getPointZ(t)),s&&(n.m=e.getPointM(t)),n.cache._geVersion=t,n}function mbt(e,t,i){const r=new Fa({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function gbt(e,t,i){const r=new Hc({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function ybt(e,t,i){const r=new Bv({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r}function vbt(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new ki({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(r){const a=e.getZExtent(t);n.zmin=a.vmin,n.zmax=a.vmax}if(s){const a=e.getMExtent(t);n.mmin=a.vmin,n.mmax=a.vmax}return n.cache._geVersion=t,n}var _bt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hydratedAdapter:zr});function Yr(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function bbt(e){return dr.extendedSpatialReferenceInfo(e)}function wbt(e,t){return dr.clip(zr,Yr(e),e,t)}function xbt(e,t){return dr.cut(zr,Yr(e),e,t)}function Tbt(e,t){return dr.contains(zr,Yr(e),e,t)}function Sbt(e,t){return dr.crosses(zr,Yr(e),e,t)}function Ebt(e,t,i){return dr.distance(zr,Yr(e),e,t,i)}function Abt(e,t){return dr.equals(zr,Yr(e),e,t)}function Cbt(e,t){return dr.intersects(zr,Yr(e),e,t)}function Mbt(e,t){return dr.touches(zr,Yr(e),e,t)}function Rbt(e,t){return dr.within(zr,Yr(e),e,t)}function Obt(e,t){return dr.disjoint(zr,Yr(e),e,t)}function Pbt(e,t){return dr.overlaps(zr,Yr(e),e,t)}function Ibt(e,t,i){return dr.relate(zr,Yr(e),e,t,i)}function $bt(e){return dr.isSimple(zr,Yr(e),e)}function Dbt(e){return dr.simplify(zr,Yr(e),e)}function Lbt(e,t=!1){return dr.convexHull(zr,Yr(e),e,t)}function Nbt(e,t){return dr.difference(zr,Yr(e),e,t)}function Fbt(e,t){return dr.symmetricDifference(zr,Yr(e),e,t)}function kbt(e,t){return dr.intersect(zr,Yr(e),e,t)}function Ubt(e,t=null){return dr.union(zr,Yr(e),e,t)}function zbt(e,t,i,r,s,n){return dr.offset(zr,Yr(e),e,t,i,r,s,n)}function Bbt(e,t,i,r=!1){return dr.buffer(zr,Yr(e),e,t,i,r)}function Vbt(e,t,i,r,s,n){return dr.geodesicBuffer(zr,Yr(e),e,t,i,r,s,n)}function Gbt(e,t,i=!0){return dr.nearestCoordinate(zr,Yr(e),e,t,i)}function jbt(e,t){return dr.nearestVertex(zr,Yr(e),e,t)}function Hbt(e,t,i,r){return dr.nearestVertices(zr,Yr(e),e,t,i,r)}function lK(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function qbt(e,t,i){var r;if(e==null)throw new Error("Illegal Argument Exception");const s=e.spatialReference;if((i=(r=i)!=null?r:lK(e))==null)throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(dr.rotate(e,t,i));return n.spatialReference=s,n}function Wbt(e,t){var i;if(e==null)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if((t=(i=t)!=null?i:lK(e))==null)throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(dr.flipHorizontal(e,t));return s.spatialReference=r,s}function Xbt(e,t){var i;if(e==null)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if((t=(i=t)!=null?i:lK(e))==null)throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(dr.flipVertical(e,t));return s.spatialReference=r,s}function Ybt(e,t,i,r){return dr.generalize(zr,Yr(e),e,t,i,r)}function Jbt(e,t,i){return dr.densify(zr,Yr(e),e,t,i)}function Zbt(e,t,i,r=0){return dr.geodesicDensify(zr,Yr(e),e,t,i,r)}function Kbt(e,t){return dr.planarArea(zr,Yr(e),e,t)}function Qbt(e,t){return dr.planarLength(zr,Yr(e),e,t)}function e2t(e,t,i){return dr.geodesicArea(zr,Yr(e),e,t,i)}function t2t(e,t,i){return dr.geodesicLength(zr,Yr(e),e,t,i)}var gEt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",buffer:Bbt,clip:wbt,contains:Tbt,convexHull:Lbt,crosses:Sbt,cut:xbt,densify:Jbt,difference:Nbt,disjoint:Obt,distance:Ebt,equals:Abt,extendedSpatialReferenceInfo:bbt,flipHorizontal:Wbt,flipVertical:Xbt,generalize:Ybt,geodesicArea:e2t,geodesicBuffer:Vbt,geodesicDensify:Zbt,geodesicLength:t2t,intersect:kbt,intersects:Cbt,isSimple:$bt,nearestCoordinate:Gbt,nearestVertex:jbt,nearestVertices:Hbt,offset:zbt,overlaps:Pbt,planarArea:Kbt,planarLength:Qbt,relate:Ibt,rotate:qbt,simplify:Dbt,symmetricDifference:Fbt,touches:Mbt,union:Ubt,within:Rbt});let Fm=class extends ive(uve(JO)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new O2,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};_([S({type:sve})],Fm.prototype,"elevationInfo",void 0),_([S(O6(O2,"graphics"))],Fm.prototype,"graphics",void 0),_([S({type:["show","hide"]})],Fm.prototype,"listMode",void 0),_([S()],Fm.prototype,"screenSizePerspectiveEnabled",void 0),_([S({readOnly:!0})],Fm.prototype,"type",void 0),_([S({constructOnly:!0})],Fm.prototype,"internal",void 0),Fm=_([re("esri.layers.GraphicsLayer")],Fm);const i2t=Fm;function cz(e){switch(e){case is.SUPPORTED:break;case is.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case is.GEOMETRY_MISSING:return"no geometry";case is.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case is.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case is.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var is;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(is||(is={}));function r2t(e,t){return J(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function uSe(e,t){return r2t(!!L(e)&&e.hasZ,t)}function J8(e){const t=hK(e);return uSe(e.geometry,t)}function yEt(e){const t=hK(e),i=uSe(e.geometry,t);return{mode:i,offset:L(t)&&i!=="on-the-ground"?Wt(t.offset,0)*rve(Wt(t.unit,"meters")):0}}function cK(e){if(J8(e)==="on-the-ground")return!1;const t=hK(e),i=L(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!i||i==="0")}function hK(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function vEt(e,t,i){if(J(i)||!i.mode)return;const r=e.hasZ?e.z:0,s=L(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-(Wt(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+s);case"relative-to-scene":return r-(Wt(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+s)}}function _Et(e,t,i,r=null){return dSe(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,r)}function Eq(e,t,i,r,s=null){return dSe(e,t[0],t[1],t.length>2?t[2]:0,i,r,s)}function dSe(e,t,i,r,s,n,a=null){if(J(n))return;const l=L(a)?a.mode:"absolute-height";return l==="on-the-ground"?0:n2t(s2t(t,i,r,s,e,n),t,i,r,s,e,a,l)}function s2t(e,t,i,r,s,n){const a=L(n.offset)?n.offset:0;switch(n.mode){case"absolute-height":return i+a;case"on-the-ground":return Wt(s.elevationProvider.getElevation(e,t,0,r,"ground"),0);case"relative-to-ground":return i+Wt(s.elevationProvider.getElevation(e,t,i,r,"ground"),0)+a;case"relative-to-scene":return i+Wt(s.elevationProvider.getElevation(e,t,i,r,"scene"),0)+a}}function n2t(e,t,i,r,s,n,a,l){const p=L(a)&&L(a.offset)?a.offset:0;switch(l){case"absolute-height":return e-p;case"relative-to-ground":return e-(Wt(n.elevationProvider.getElevation(t,i,r,s,"ground"),0)+p);case"relative-to-scene":return e-(Wt(n.elevationProvider.getElevation(t,i,r,s,"scene"),0)+p)}}function o2t(e){var t;if(((t=e.layer)==null?void 0:t.type)!=="graphics")return is.GRAPHICS_LAYER_MISSING;if(J(e.geometry))return is.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return is.GEOMETRY_TYPE_UNSUPPORTED}return J8(e)!=="on-the-ground"&&cK(e)?is.ELEVATION_MODE_UNSUPPORTED:is.SUPPORTED}function pSe(e){if(!e)return null;if(e.isGeographic&&e.wkid){const t=NLe[e.wkid];if(t)return t}if(e.wkt){const t=a2t(e.wkt);if(t)return t}return null}function a2t(e){const t=DLe.exec(e);if(!t||t.length!==2)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:s===0?0:1/s}}function fSe(e){const t=pSe(e||It.WGS84);if(l2t(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function l2t(e){return"b"in e&&"eSq"in e&&"radius"in e}function c2t(e){return pSe(e)!==null}function bEt(e,t="meters"){if(!e)throw new Se("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(r=>!c2t(r.spatialReference)))throw new Se("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<e.length;r++){const s=e[r],{spatialReference:n}=s,a=s.type==="polyline"?s.paths:s.rings;let l=0;for(let p=0;p<a.length;p++){const y=a[p];let b=0;for(let x=1;x<y.length;x++){const A=y[x-1][0],M=y[x][0],P=y[x-1][1],$=y[x][1];if(P!==$||A!==M){const k={distance:null};u2t(k,[A,P],[M,$],n),b+=k.distance}}l+=b}l=dn(l,"meters",t),i.push(l)}return i}function h2t(e,t,i,r,s){const n=t[0],a=t[1],l=n*Hu,p=a*Hu,y=i*Hu,{a:b,b:x,f:A}=fSe(s),M=Math.sin(y),P=Math.cos(y),$=(1-A)*Math.tan(p),k=1/Math.sqrt(1+$*$),z=$*k,G=Math.atan2($,P),B=k*M,W=B*B,q=1-W,X=q*(b*b-x*x)/(x*x),oe=1+X/16384*(4096+X*(X*(320-175*X)-768)),de=X/1024*(256+X*(X*(74-47*X)-128));let he,fe,me,ge,Ce=r/(x*oe),Ae=2*Math.PI;for(;Math.abs(Ce-Ae)>1e-12;)me=Math.cos(2*G+Ce),he=Math.sin(Ce),fe=Math.cos(Ce),ge=de*he*(me+de/4*(fe*(2*me*me-1)-de/6*me*(4*he*he-3)*(4*me*me-3))),Ae=Ce,Ce=r/(x*oe)+ge;const Pe=z*he-k*fe*P,De=Math.atan2(z*fe+k*he*P,(1-A)*Math.sqrt(W+Pe*Pe)),ne=Math.atan2(he*M,k*fe-z*he*P),pe=A/16*q*(4+A*(4-3*q)),ye=De/Hu,we=(l+(ne-(1-pe)*A*B*(Ce+pe*he*(me+pe*fe*(2*me*me-1)))))/Hu;return e[0]=we,e[1]=ye,e}function u2t(e,t,i,r){const s=t[0]*Hu,n=t[1]*Hu,a=i[0]*Hu,l=i[1]*Hu,{a:p,b:y,f:b,radius:x}=fSe(r),A=a-s,M=Math.atan((1-b)*Math.tan(n)),P=Math.atan((1-b)*Math.tan(l)),$=Math.sin(M),k=Math.cos(M),z=Math.sin(P),G=Math.cos(P);let B,W,q,X,oe,de,he,fe,me,ge,Ce=1e3,Ae=A;do{if(he=Math.sin(Ae),fe=Math.cos(Ae),q=Math.sqrt(G*he*(G*he)+(k*z-$*G*fe)*(k*z-$*G*fe)),q===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;oe=$*z+k*G*fe,de=Math.atan2(q,oe),me=k*G*he/q,W=1-me*me,X=oe-2*$*z/W,isNaN(X)&&(X=0),ge=b/16*W*(4+b*(4-3*W)),B=Ae,Ae=A+(1-ge)*b*me*(de+ge*q*(X+ge*oe*(2*X*X-1)))}while(Math.abs(Ae-B)>1e-12&&--Ce>0);if(Ce===0){const we=x,Ee=Math.acos(Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos(a-s))*we,Ie=a-s,xe=Math.sin(Ie)*Math.cos(l),$e=Math.cos(n)*Math.sin(l)-Math.sin(n)*Math.cos(l)*Math.cos(Ie),et=Math.atan2(xe,$e);return e.azimuth=et/Hu,e.distance=Ee,e.reverseAzimuth=void 0,e}const Pe=W*(p*p-y*y)/(y*y),De=Pe/1024*(256+Pe*(Pe*(74-47*Pe)-128)),ne=y*(1+Pe/16384*(4096+Pe*(Pe*(320-175*Pe)-768)))*(de-De*q*(X+De/4*(oe*(2*X*X-1)-De/6*X*(4*q*q-3)*(4*X*X-3)))),pe=Math.atan2(G*Math.sin(Ae),k*z-$*G*Math.cos(Ae)),ye=Math.atan2(k*Math.sin(Ae),k*z*Math.cos(Ae)-$*G);return e.azimuth=pe/Hu,e.distance=ne,e.reverseAzimuth=ye/Hu,e}var Aq;let gy=Aq=class extends Fa{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return ie(ie(ie({},super.normalizeCtorArgs()),i),t)}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,this.rings.length!==0||!e)return;const i=dn(this.radius,this.radiusUnit,"meters"),r=e.spatialReference;let s,n="geographic";if(r.isWebMercator?n="webMercator":(ce[r.wkid]!=null||r.wkt&&r.wkt.indexOf("PROJCS")===0)&&(n="projected"),this.geodesic){let a;switch(n){case"webMercator":a=q3(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":a=e}s=this._createGeodesicCircle(a,i,t),n==="webMercator"&&(s=e0(s))}else{let a;n==="webMercator"||n==="projected"?a=i/this._convert2Meters(1,e.spatialReference):n==="geographic"&&(a=X0e(i,"meters",ir(e.spatialReference).radius)),s=this._createPlanarCircle(e,a,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s}=this;return new Aq({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(e,t,i){let r=0;const s=[];for(;r<360;){const n=[0,0],a=[e.x,e.y];h2t(n,a,r,t),this.hasZ&&n.push(e.z),s.push(n),r+=360/i}return s.push(s[0]),new Fa(s)}_createPlanarCircle(e,t,i){const r=[],s=2*Math.PI/i;for(let n=0;n<i;++n){const a=s*n,l=[e.x+Math.cos(-a)*t,e.y+Math.sin(-a)*t];this.hasZ&&l.push(e.z),r.push(l)}return r.push(r[0]),new Fa({spatialReference:e.spatialReference,rings:[r]})}_convert2Meters(e,t){let i;if(ce[t.wkid]!=null)i=ce.values[ce[t.wkid]];else{const r=t.wkt,s=r.lastIndexOf(",")+1,n=r.lastIndexOf("]]");i=parseFloat(r.substring(s,n))}return e*i}};_([S({type:Gt})],gy.prototype,"center",void 0),_([S()],gy.prototype,"geodesic",void 0),_([S()],gy.prototype,"numberOfPoints",void 0),_([S()],gy.prototype,"radius",void 0),_([S()],gy.prototype,"radiusUnit",void 0),gy=Aq=_([re("esri.geometry.Circle")],gy);const d2t=gy;function PI(e){return mSe(e).result}function wEt(e){return mSe(e).geometry}function mSe(e){var t;return((t=e.layer)==null?void 0:t.type)!=="graphics"?{result:is.GRAPHICS_LAYER_MISSING,geometry:null}:J(e.geometry)?{result:is.GEOMETRY_MISSING,geometry:null}:J8(e)!=="on-the-ground"&&cK(e)?{result:is.ELEVATION_MODE_UNSUPPORTED,geometry:null}:e.geometry.type!=="point"&&e.geometry.type!=="polyline"&&(e.geometry.type!=="polygon"||e.geometry instanceof d2t)?{result:is.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:is.SUPPORTED,geometry:e.geometry}}function p2t(e){var t;if(((t=e.layer)==null?void 0:t.type)!=="graphics")return is.GRAPHICS_LAYER_MISSING;if(J(e.geometry))return is.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return is.SUPPORTED;default:return is.GEOMETRY_TYPE_UNSUPPORTED}const i=L(e.symbol)&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return i&&i.length>0&&i.some(r=>r.type==="object")?J8(e)!=="on-the-ground"&&cK(e)?is.ELEVATION_MODE_UNSUPPORTED:is.SUPPORTED:is.SYMBOL_TYPE_UNSUPPORTED}function Phe(e,t,i){if(!t||!e||!e.map)return;const{map:r}=e,s=r.layers.find(n=>n===t);s||r.add(t,i),i!=null&&r.layers.reorder(s,i)}function xEt(e,t){return e.allLayerViews.find(i=>{const r=i.layer;return"sublayers"in r&&L(r.sublayers)&&!!r.sublayers.find(s=>s===t)||r===t})}const ns={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};function f2t(e,t){const i=gSe[e.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(t.length<i.minParams||t.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return i.evaluate(t)}function m2t(e,t){const i=gSe[e.toLowerCase()];return i!=null&&t>=i.minParams&&t<=i.maxParams}const gSe={min:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:ySe(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:g2t(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.sqrt(Ihe(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Ihe(e[0])}};function ySe(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function g2t(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t}function Ihe(e){const t=ySe(e),i=e.length;let r=0;for(const s of e)r+=(s-t)**2;return i>1?r/(i-1):0}class Xl{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static _fixDefaults(t){if(t.precision!==null||t.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(t){const i=new Xl;return i.second=t/1e3,i}static createFromValueAndQualifer(t,i,r){let s=null;const n=new Xl;if(n.op=r==="-"?"-":"+",i.type==="interval-period"){Xl._fixDefaults(i);const a=new RegExp("^[0-9]{1,}$");if(i.period==="year"||i.period==="month")throw new Error("Year-Month Intervals not supported");if(!a.test(t))throw new Error("Illegal Interval");n[i.period]=parseFloat(t)}else{if(Xl._fixDefaults(i.start),Xl._fixDefaults(i.end),i.start.period==="year"||i.start.period==="month")throw new Error("Year-Month Intervals not supported");if(i.end.period==="year"||i.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(i.start.period){case"day":switch(i.end.period){case"hour":if(s=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");n[i.start.period]=parseFloat(t.split(" ")[0]),n[i.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(t.split(" ")[0]);const a=t.split(" ")[1].split(":");n.hour=parseFloat(a[0]),n.minute=parseFloat(a[1])}break;case"second":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(t.split(" ")[0]);const a=t.split(" ")[1].split(":");n.hour=parseFloat(a[0]),n.minute=parseFloat(a[1]),n.second=parseFloat(a[2])}break;default:throw"Invalid Interval."}break;case"hour":switch(i.end.period){case"minute":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");n.hour=parseFloat(t.split(":")[0]),n.minute=parseFloat(t.split(":")[1]);break;case"second":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{const a=t.split(":");n.hour=parseFloat(a[0]),n.minute=parseFloat(a[1]),n.second=parseFloat(a[2])}break;default:throw"Invalid Interval."}break;case"minute":if(i.end.period!=="second")throw"Invalid Interval.";if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{const a=t.split(":");n.minute=parseFloat(a[0]),n.second=parseFloat(a[1])}break;default:throw"Invalid Interval."}}return n}valueInMilliseconds(){return(this.op==="-"?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function vSe(e,t){const i=_Se[e.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(t.length<i.minParams||t.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return i.evaluate(t)}function y2t(e,t){const i=_Se[e.toLowerCase()];return i!=null&&t>=i.minParams&&t<=i.maxParams}const _Se={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(t==null)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(e.length===2){const[t,i]=e;return t==null||i==null?null:t.toString().substring(i-1)}if(e.length===3){const[t,i,r]=e;return t==null||i==null||r==null?null:r<=0?"":t.toString().substring(i-1,i+r-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>e==null||t==null?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=e.length===3,i=t?e[1]:" ",r=t?e[2]:e[1];if(i==null||r==null)return null;const s=`(${Dq(i)})`;switch(e[0]){case"BOTH":return r.replace(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return r.replace(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return r.replace(new RegExp(`${s}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>e[0]==null||e[1]==null?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>e[0]==null||e[1]==null?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],i=e.length===2?10**e[1]:1;return t==null?null:Math.round(t*i)/i}},truncate:{minParams:1,maxParams:2,evaluate:e=>e[0]==null?null:e.length===1?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>typeof e[0]=="string"||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let i=0;i<e.length;i++){if(e[i]==null)return null;t+=e[i].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].toString().toUpperCase()}};var $he,Dhe,bSe={exports:{}};Dhe=function(){function e(s,n){function a(){this.constructor=s}a.prototype=n.prototype,s.prototype=new a}function t(s,n,a,l){var p=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(p,t.prototype),p.expected=n,p.found=a,p.location=l,p.name="SyntaxError",p}function i(s,n,a){return a=a||" ",s.length>n?s:(n-=s.length,s+(a+=a.repeat(n)).slice(0,n))}function r(s,n){var a,l={},p=(n=n!==void 0?n:{}).grammarSource,y={start:$K},b=$K,x="!",A="=",M=">=",P=">",$="<=",k="<>",z="<",G="!=",B="+",W="-",q="*",X="/",oe="@",de="'",he="N'",fe="''",me=".",ge="null",Ce="true",Ae="false",Pe="in",De="is",ne="like",pe="escape",ye="not",we="and",Ee="or",Ie="between",xe="from",$e="for",et="substring",ct="extract",Mt="trim",at="position",nt="timestamp",dt="date",xt="leading",wr="trailing",vs="both",ji="to",ae="interval",sr="year",Bs="month",Hi="day",Os="hour",li="minute",vl="second",Jn="case",_l="end",Xp="when",Qv="then",e1="else",ft=",",f="(",N=")",T="`",d=/^[A-Za-z_\x80-\uFFFF]/,h=/^[A-Za-z0-9_]/,o=/^[A-Za-z0-9_.\x80-\uFFFF]/,c=/^[^']/,u=/^[0-9]/,m=/^[eE]/,g=/^[+\-]/,v=/^[ \t\n\r]/,w=/^[^`]/,E=ui("!",!1),C=ui("=",!1),R=ui(">=",!1),I=ui(">",!1),F=ui("<=",!1),U=ui("<>",!1),j=ui("<",!1),ee=ui("!=",!1),te=ui("+",!1),Z=ui("-",!1),le=ui("*",!1),ve=ui("/",!1),be=k0([["A","Z"],["a","z"],"_",["\x80","\uFFFF"]],!1,!1),ue=k0([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Le=k0([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uFFFF"]],!1,!1),Be=ui("@",!1),it=ui("'",!1),Ke=ui("N'",!1),Je=ui("''",!1),pt=k0(["'"],!0,!1),qt=ui(".",!1),ri=k0([["0","9"]],!1,!1),Ji=k0(["e","E"],!1,!1),Zi=k0(["+","-"],!1,!1),an=ui("NULL",!0),Br=ui("TRUE",!0),Rt=ui("FALSE",!0),gr=ui("IN",!0),Ri=ui("IS",!0),Ps=ui("LIKE",!0),rs=ui("ESCAPE",!0),Js=ui("NOT",!0),Xi=ui("AND",!0),Zn=ui("OR",!0),bi=ui("BETWEEN",!0),t1=ui("FROM",!0),F0=ui("FOR",!0),i1=ui("SUBSTRING",!0),e_=ui("EXTRACT",!0),sF=ui("TRIM",!0),nF=ui("POSITION",!0),oF=ui("TIMESTAMP",!0),uc=ui("DATE",!0),aF=ui("LEADING",!0),lF=ui("TRAILING",!0),Me=ui("BOTH",!0),Qe=ui("TO",!0),ut=ui("INTERVAL",!0),zi=ui("YEAR",!0),Eo=ui("MONTH",!0),Zs=ui("DAY",!0),dc=ui("HOUR",!0),zw=ui("MINUTE",!0),JSe=ui("SECOND",!0),ZSe=ui("CASE",!0),KSe=ui("END",!0),QSe=ui("WHEN",!0),eEe=ui("THEN",!0),tEe=ui("ELSE",!0),iEe=ui(",",!1),rEe=ui("(",!1),sEe=ui(")",!1),nEe=k0([" ","	",`
`,"\r"],!1,!1),wK=ui("`",!1),xK=k0(["`"],!0,!1),oEe=function(D){return D},aEe=function(D,K){var se={type:"expr_list"},_e=VCe(D,K);return se.value=_e,se},cF=function(D,K){return bF(D,K)},lEe=function(D){return zCe("NOT",D)},cEe=function(D,K){return K==""||K==null||K==null?D:K.type=="arithmetic"?bF(D,K.tail):aQ(K.op,D,K.right,K.escape)},hEe=function(D){return{type:"arithmetic",tail:D}},uEe=function(D,K){return{op:D+"NOT",right:K}},dEe=function(D,K){return{op:D,right:K}},pEe=function(D,K,se){return{op:"NOT"+D,right:{type:"expr_list",value:[K,se]}}},fEe=function(D,K,se){return{op:D,right:{type:"expr_list",value:[K,se]}}},TK=function(D){return D[0]+" "+D[2]},mEe=function(D,K,se){return{op:D,right:K,escape:se.value}},gEe=function(D,K){return{op:D,right:K,escape:""}},yEe=function(D,K){return{op:D,right:K}},vEe=function(D){return{op:D,right:{type:"expr_list",value:[]}}},_Ee=function(D,K){return{op:D,right:K}},bEe=function(D,K){return bF(D,K)},wEe=function(D){return D.paren=!0,D},xEe=function(D){return/^CURRENT_DATE$/i.test(D)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(D)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:D}},SK=function(D){return D},EK=function(D,K){return D+K.join("")},TEe=function(D){return{type:"param",value:D[1]}},SEe=function(D,K){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:D},K]}}},EEe=function(D,K,se){return{type:"function",name:"substring",args:{type:"expr_list",value:se?[D,K,se[2]]:[D,K]}}},AEe=function(D,K,se){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:D==null?"BOTH":D},K,se]}}},CEe=function(D,K){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:D==null?"BOTH":D},K]}}},MEe=function(D,K){return{type:"function",name:"position",args:{type:"expr_list",value:[D,K]}}},REe=function(D,K){return{type:"function",name:D,args:K||{type:"expr_list",value:[]}}},OEe=function(D){return{type:"timestamp",value:D.value}},PEe=function(D,K,se){return{type:"interval",value:K,qualifier:se,op:D}},IEe=function(D,K){return{type:"interval",value:D,qualifier:K,op:""}},$Ee=function(D,K){return{type:"interval-qualifier",start:D,end:K}},DEe=function(D,K){return{type:"interval-period",period:D.value,precision:K,secondary:null}},AK=function(D){return{type:"interval-period",period:D.value,precision:null,secondary:null}},LEe=function(D){return{type:"interval-period",period:D.value,precision:null,secondary:null}},CK=function(D,K){return{type:"interval-period",period:"second",precision:D,secondary:K}},NEe=function(D){return{type:"interval-period",period:"second",precision:D,secondary:null}},FEe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},kEe=function(D,K){return{type:"interval-period",period:D.value,precision:K,secondary:null}},UEe=function(D){return{type:"interval-period",period:"second",precision:D,secondary:null}},zEe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},BEe=function(){return{type:"string",value:"day"}},VEe=function(){return{type:"string",value:"hour"}},GEe=function(){return{type:"string",value:"minute"}},jEe=function(){return{type:"string",value:"month"}},HEe=function(){return{type:"string",value:"year"}},MK=function(D){return parseFloat(D)},qEe=function(D){return{type:"date",value:D.value}},WEe=function(){return{type:"null",value:null}},XEe=function(){return{type:"bool",value:!0}},YEe=function(){return{type:"bool",value:!1}},RK=function(){return"'"},JEe=function(D){return{type:"string",value:D.join("")}},ZEe=function(D,K){return{type:"case_expression",format:"simple",operand:D,clauses:K,else:null}},KEe=function(D,K,se){return{type:"case_expression",format:"simple",operand:D,clauses:K,else:se.value}},QEe=function(D){return{type:"case_expression",format:"searched",clauses:D,else:null}},eAe=function(D,K){return{type:"case_expression",format:"searched",clauses:D,else:K.value}},OK=function(D,K){return{type:"when_clause",operand:D,value:K}},tAe=function(D){return{type:"else_clause",value:D}},iAe=function(D){return{type:"number",value:D}},rAe=function(D,K,se){return parseFloat(D+K+se)},sAe=function(D,K){return parseFloat(D+K)},nAe=function(D,K){return parseFloat(D+K)},oAe=function(D){return parseFloat(D)},aAe=function(D,K){return D[0]+K},lAe=function(D){return"."+(D!=null?D:"")},cAe=function(D,K){return D+K},hAe=function(D){return D.join("")},uAe=function(D,K){return"e"+(K===null?"":K)},dAe=function(){return"IN"},pAe=function(){return"IS"},fAe=function(){return"LIKE"},mAe=function(){return"ESCAPE"},gAe=function(){return"NOT"},yAe=function(){return"AND"},vAe=function(){return"OR"},_Ae=function(){return"BETWEEN"},bAe=function(){return"FROM"},wAe=function(){return"FOR"},xAe=function(){return"SUBSTRING"},TAe=function(){return"EXTRACT"},SAe=function(){return"TRIM"},EAe=function(){return"POSITION"},AAe=function(){return"TIMESTAMP"},CAe=function(){return"DATE"},MAe=function(){return"LEADING"},RAe=function(){return"TRAILING"},OAe=function(){return"BOTH"},PAe=function(){return"TO"},IAe=function(){return"INTERVAL"},$Ae=function(){return"YEAR"},DAe=function(){return"MONTH"},LAe=function(){return"DAY"},NAe=function(){return"HOUR"},FAe=function(){return"MINUTE"},kAe=function(){return"SECOND"},UAe=function(){return"CASE"},zAe=function(){return"END"},BAe=function(){return"WHEN"},VAe=function(){return"THEN"},GAe=function(){return"ELSE"},jAe=function(D){return D.join("")},H=0,S4=[{line:1,column:1}],Yp=0,hF=[],He=0;if("startRule"in n){if(!(n.startRule in y))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');b=y[n.startRule]}function ui(D,K){return{type:"literal",text:D,ignoreCase:K}}function k0(D,K,se){return{type:"class",parts:D,inverted:K,ignoreCase:se}}function HAe(){return{type:"end"}}function PK(D){var K,se=S4[D];if(se)return se;for(K=D-1;!S4[K];)K--;for(se={line:(se=S4[K]).line,column:se.column};K<D;)s.charCodeAt(K)===10?(se.line++,se.column=1):se.column++,K++;return S4[D]=se,se}function IK(D,K){var se=PK(D),_e=PK(K);return{source:p,start:{offset:D,line:se.line,column:se.column},end:{offset:K,line:_e.line,column:_e.column}}}function Dt(D){H<Yp||(H>Yp&&(Yp=H,hF=[]),hF.push(D))}function qAe(D,K,se){return new t(t.buildMessage(D,K),D,K,se)}function $K(){var D,K;return D=H,Ze(),(K=Kn())!==l?(Ze(),D=oEe(K)):(H=D,D=l),D}function DK(){var D,K,se,_e,Lt,xr,Is,ln;if(D=H,(K=Kn())!==l){for(se=[],_e=H,Lt=Ze(),(xr=D4())!==l?(Is=Ze(),(ln=Kn())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);_e!==l;)se.push(_e),_e=H,Lt=Ze(),(xr=D4())!==l?(Is=Ze(),(ln=Kn())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);D=aEe(K,se)}else H=D,D=l;return D}function Kn(){var D,K,se,_e,Lt,xr,Is,ln;if(D=H,(K=uF())!==l){for(se=[],_e=H,Lt=Ze(),(xr=YK())!==l?(Is=Ze(),(ln=uF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);_e!==l;)se.push(_e),_e=H,Lt=Ze(),(xr=YK())!==l?(Is=Ze(),(ln=uF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);D=cF(K,se)}else H=D,D=l;return D}function uF(){var D,K,se,_e,Lt,xr,Is,ln;if(D=H,(K=E4())!==l){for(se=[],_e=H,Lt=Ze(),(xr=P4())!==l?(Is=Ze(),(ln=E4())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);_e!==l;)se.push(_e),_e=H,Lt=Ze(),(xr=P4())!==l?(Is=Ze(),(ln=E4())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);D=cF(K,se)}else H=D,D=l;return D}function E4(){var D,K,se,_e,Lt;return D=H,(K=$E())===l&&(K=H,s.charCodeAt(H)===33?(se=x,H++):(se=l,He===0&&Dt(E)),se!==l?(_e=H,He++,s.charCodeAt(H)===61?(Lt=A,H++):(Lt=l,He===0&&Dt(C)),He--,Lt===l?_e=void 0:(H=_e,_e=l),_e!==l?K=se=[se,_e]:(H=K,K=l)):(H=K,K=l)),K!==l?(se=Ze(),(_e=E4())!==l?D=lEe(_e):(H=D,D=l)):(H=D,D=l),D===l&&(D=WAe()),D}function WAe(){var D,K,se;return D=H,(K=U0())!==l?(Ze(),(se=XAe())===l&&(se=null),D=cEe(K,se)):(H=D,D=l),D}function XAe(){var D;return(D=YAe())===l&&(D=QAe())===l&&(D=ZAe())===l&&(D=JAe())===l&&(D=KAe()),D}function YAe(){var D,K,se,_e,Lt,xr;if(D=[],K=H,se=Ze(),(_e=LK())!==l?(Lt=Ze(),(xr=U0())!==l?K=se=[se,_e,Lt,xr]:(H=K,K=l)):(H=K,K=l),K!==l)for(;K!==l;)D.push(K),K=H,se=Ze(),(_e=LK())!==l?(Lt=Ze(),(xr=U0())!==l?K=se=[se,_e,Lt,xr]:(H=K,K=l)):(H=K,K=l);else D=l;return D!==l&&(D=hEe(D)),D}function LK(){var D;return s.substr(H,2)===M?(D=M,H+=2):(D=l,He===0&&Dt(R)),D===l&&(s.charCodeAt(H)===62?(D=P,H++):(D=l,He===0&&Dt(I)),D===l&&(s.substr(H,2)===$?(D=$,H+=2):(D=l,He===0&&Dt(F)),D===l&&(s.substr(H,2)===k?(D=k,H+=2):(D=l,He===0&&Dt(U)),D===l&&(s.charCodeAt(H)===60?(D=z,H++):(D=l,He===0&&Dt(j)),D===l&&(s.charCodeAt(H)===61?(D=A,H++):(D=l,He===0&&Dt(C)),D===l&&(s.substr(H,2)===G?(D=G,H+=2):(D=l,He===0&&Dt(ee)))))))),D}function JAe(){var D,K,se,_e;return D=H,(K=WK())!==l?(Ze(),(se=$E())!==l?(Ze(),(_e=U0())!==l?D=uEe(K,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=WK())!==l?(Ze(),(se=U0())!==l?D=dEe(K,se):(H=D,D=l)):(H=D,D=l)),D}function ZAe(){var D,K,se,_e,Lt,xr;return D=H,(K=$E())!==l?(Ze(),(se=JK())!==l?(Ze(),(_e=U0())!==l?(Ze(),(Lt=P4())!==l?(Ze(),(xr=U0())!==l?D=pEe(se,_e,xr):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=JK())!==l?(Ze(),(se=U0())!==l?(Ze(),(_e=P4())!==l?(Ze(),(Lt=U0())!==l?D=fEe(K,se,Lt):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)),D}function NK(){var D,K,se,_e,Lt;return D=H,K=H,(se=$E())!==l?(_e=Ze(),(Lt=XK())!==l?K=se=[se,_e,Lt]:(H=K,K=l)):(H=K,K=l),K!==l&&(K=TK(K)),(D=K)===l&&(D=XK()),D}function dF(){var D,K,se,_e,Lt;return D=H,K=H,(se=$E())!==l?(_e=Ze(),(Lt=vF())!==l?K=se=[se,_e,Lt]:(H=K,K=l)):(H=K,K=l),K!==l&&(K=TK(K)),(D=K)===l&&(D=vF()),D}function KAe(){var D,K,se,_e;return D=H,(K=NK())!==l?(Ze(),(se=Bw())!==l?(Ze(),CCe()!==l?(Ze(),(_e=yF())!==l?D=mEe(K,se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=NK())!==l?(Ze(),(se=Bw())!==l?D=gEe(K,se):(H=D,D=l)):(H=D,D=l)),D}function QAe(){var D,K,se,_e;return D=H,(K=dF())!==l?(Ze(),(se=bl())!==l?(Ze(),(_e=DK())!==l?(Ze(),wl()!==l?D=yEe(K,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=dF())!==l?(Ze(),(se=bl())!==l?(Ze(),(_e=wl())!==l?D=vEe(K):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=dF())!==l?(Ze(),(se=gF())!==l?D=_Ee(K,se):(H=D,D=l)):(H=D,D=l))),D}function U0(){var D,K,se,_e,Lt,xr,Is,ln;if(D=H,(K=pF())!==l){for(se=[],_e=H,Lt=Ze(),(xr=FK())!==l?(Is=Ze(),(ln=pF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);_e!==l;)se.push(_e),_e=H,Lt=Ze(),(xr=FK())!==l?(Is=Ze(),(ln=pF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);D=cF(K,se)}else H=D,D=l;return D}function FK(){var D;return s.charCodeAt(H)===43?(D=B,H++):(D=l,He===0&&Dt(te)),D===l&&(s.charCodeAt(H)===45?(D=W,H++):(D=l,He===0&&Dt(Z))),D}function pF(){var D,K,se,_e,Lt,xr,Is,ln;if(D=H,(K=fF())!==l){for(se=[],_e=H,Lt=Ze(),(xr=kK())!==l?(Is=Ze(),(ln=fF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);_e!==l;)se.push(_e),_e=H,Lt=Ze(),(xr=kK())!==l?(Is=Ze(),(ln=fF())!==l?_e=Lt=[Lt,xr,Is,ln]:(H=_e,_e=l)):(H=_e,_e=l);D=bEe(K,se)}else H=D,D=l;return D}function kK(){var D;return s.charCodeAt(H)===42?(D=q,H++):(D=l,He===0&&Dt(le)),D===l&&(s.charCodeAt(H)===47?(D=X,H++):(D=l,He===0&&Dt(ve))),D}function fF(){var D,K;return(D=cCe())===l&&(D=rCe())===l&&(D=sCe())===l&&(D=nCe())===l&&(D=oCe())===l&&(D=aCe())===l&&(D=vCe())===l&&(D=eCe())===l&&(D=gF())===l&&(D=H,bl()!==l?(Ze(),(K=Kn())!==l?(Ze(),wl()!==l?D=wEe(K):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)),D}function eCe(){var D;return(D=tCe())!==l&&(D=xEe(D)),D}function tCe(){var D;return(D=iCe())!==l&&(D=SK(D)),D}function iCe(){var D,K,se,_e;if(D=H,(K=mF())!==l){for(se=[],_e=zK();_e!==l;)se.push(_e),_e=zK();D=EK(K,se)}else H=D,D=l;return D}function UK(){var D,K,se,_e;if(D=H,(K=mF())!==l){for(se=[],_e=pr();_e!==l;)se.push(_e),_e=pr();D=EK(K,se)}else H=D,D=l;return D}function mF(){var D;return d.test(s.charAt(H))?(D=s.charAt(H),H++):(D=l,He===0&&Dt(be)),D}function pr(){var D;return h.test(s.charAt(H))?(D=s.charAt(H),H++):(D=l,He===0&&Dt(ue)),D}function zK(){var D;return o.test(s.charAt(H))?(D=s.charAt(H),H++):(D=l,He===0&&Dt(Le)),D}function gF(){var D,K,se;return D=H,s.charCodeAt(H)===64?(K=oe,H++):(K=l,He===0&&Dt(Be)),K!==l&&(se=UK())!==l?D=K=[K,se]:(H=D,D=l),D!==l&&(D=TEe(D)),D}function rCe(){var D,K,se;return D=H,OCe()!==l?(Ze(),bl()!==l?(Ze(),(K=lCe())!==l?(Ze(),_F()!==l?(Ze(),(se=Kn())!==l?(Ze(),wl()!==l?D=SEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function sCe(){var D,K,se,_e,Lt,xr,Is;return D=H,RCe()!==l?(Ze(),bl()!==l?(Ze(),(K=Kn())!==l?(Ze(),_F()!==l?(Ze(),(se=Kn())!==l?(Ze(),_e=H,(Lt=MCe())!==l?(xr=Ze(),(Is=Kn())!==l?_e=Lt=[Lt,xr,Is,Ze()]:(H=_e,_e=l)):(H=_e,_e=l),_e===l&&(_e=null),(Lt=wl())!==l?D=EEe(K,se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function nCe(){var D,K,se,_e;return D=H,ZK()!==l?(Ze(),bl()!==l?(Ze(),(K=BK())===l&&(K=null),Ze(),(se=Kn())!==l?(Ze(),_F()!==l?(Ze(),(_e=Kn())!==l?(Ze(),wl()!==l?D=AEe(K,se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,ZK()!==l?(Ze(),bl()!==l?(Ze(),(K=BK())===l&&(K=null),Ze(),(se=Kn())!==l?(Ze(),wl()!==l?D=CEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)),D}function BK(){var D;return(D=DCe())===l&&(D=LCe())===l&&(D=NCe()),D}function oCe(){var D,K,se;return D=H,PCe()!==l?(Ze(),bl()!==l?(Ze(),(K=Kn())!==l?(Ze(),vF()!==l?(Ze(),(se=Kn())!==l?(Ze(),wl()!==l?D=MEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function aCe(){var D,K,se;return D=H,(K=UCe())!==l?(Ze(),bl()!==l?(Ze(),(se=DK())===l&&(se=null),Ze(),wl()!==l?D=REe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function lCe(){var D;return(D=QK())===l&&(D=eQ())===l&&(D=tQ())===l&&(D=iQ())===l&&(D=rQ())===l&&(D=t_()),D}function cCe(){var D;return(D=yF())===l&&(D=wCe())===l&&(D=yCe())===l&&(D=gCe())===l&&(D=mCe())===l&&(D=hCe())===l&&(D=uCe()),D}function hCe(){var D,K;return D=H,ICe()!==l?(Ze(),(K=Bw())!==l?D=OEe(K):(H=D,D=l)):(H=D,D=l),D}function uCe(){var D,K,se,_e;return D=H,KK()!==l?(Ze(),s.charCodeAt(H)===45?(K=W,H++):(K=l,He===0&&Dt(Z)),K===l&&(s.charCodeAt(H)===43?(K=B,H++):(K=l,He===0&&Dt(te))),K!==l?(Ze(),(se=Bw())!==l?(Ze(),(_e=VK())!==l?D=PEe(K,se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,KK()!==l?(Ze(),(K=Bw())!==l?(Ze(),(se=VK())!==l?D=IEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)),D}function VK(){var D,K,se;return D=H,(K=dCe())!==l?(Ze(),FCe()!==l?(Ze(),(se=pCe())!==l?D=$Ee(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=fCe()),D}function dCe(){var D,K,se;return D=H,(K=IE())!==l?(Ze(),bl()!==l?(Ze(),(se=C4())!==l?(Ze(),wl()!==l?D=DEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=IE())!==l&&(K=AK(K)),D=K),D}function pCe(){var D,K,se,_e;return D=H,(K=IE())!==l&&(K=LEe(K)),(D=K)===l&&(D=H,(K=t_())!==l?(Ze(),bl()!==l?(Ze(),(se=C4())!==l?(Ze(),D4()!==l?(Ze(),(_e=A4())!==l?(Ze(),wl()!==l?D=CK(se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=t_())!==l?(Ze(),bl()!==l?(Ze(),(se=C4())!==l?(Ze(),wl()!==l?D=NEe(se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=t_())!==l&&(K=FEe()),D=K))),D}function fCe(){var D,K,se,_e;return D=H,(K=IE())!==l?(Ze(),bl()!==l?(Ze(),(se=A4())!==l?(Ze(),wl()!==l?D=kEe(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=IE())!==l&&(K=AK(K)),(D=K)===l&&(D=H,(K=t_())!==l?(Ze(),bl()!==l?(Ze(),(se=C4())!==l?(Ze(),D4()!==l?(Ze(),(_e=A4())!==l?(Ze(),wl()!==l?D=CK(se,_e):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=t_())!==l?(Ze(),bl()!==l?(Ze(),(se=A4())!==l?(Ze(),wl()!==l?D=UEe(se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D===l&&(D=H,(K=t_())!==l&&(K=zEe()),D=K)))),D}function IE(){var D,K;return D=H,(K=tQ())!==l&&(K=BEe()),(D=K)===l&&(D=H,(K=iQ())!==l&&(K=VEe()),(D=K)===l&&(D=H,(K=rQ())!==l&&(K=GEe()),(D=K)===l&&(D=H,(K=eQ())!==l&&(K=jEe()),(D=K)===l&&(D=H,(K=QK())!==l&&(K=HEe()),D=K)))),D}function A4(){var D;return(D=Vw())!==l&&(D=MK(D)),D}function C4(){var D;return(D=Vw())!==l&&(D=MK(D)),D}function mCe(){var D,K;return D=H,$Ce()!==l?(Ze(),(K=Bw())!==l?D=qEe(K):(H=D,D=l)):(H=D,D=l),D}function gCe(){var D;return(D=SCe())!==l&&(D=WEe()),D}function yCe(){var D,K;return D=H,(K=ECe())!==l&&(K=XEe()),(D=K)===l&&(D=H,(K=ACe())!==l&&(K=YEe()),D=K),D}function Bw(){var D;return(D=yF())===l&&(D=gF()),D}function yF(){var D,K,se,_e,Lt;if(D=H,s.charCodeAt(H)===39?(K=de,H++):(K=l,He===0&&Dt(it)),K===l&&(s.substr(H,2)===he?(K=he,H+=2):(K=l,He===0&&Dt(Ke))),K!==l){for(se=[],_e=H,s.substr(H,2)===fe?(Lt=fe,H+=2):(Lt=l,He===0&&Dt(Je)),Lt!==l&&(Lt=RK()),(_e=Lt)===l&&(c.test(s.charAt(H))?(_e=s.charAt(H),H++):(_e=l,He===0&&Dt(pt)));_e!==l;)se.push(_e),_e=H,s.substr(H,2)===fe?(Lt=fe,H+=2):(Lt=l,He===0&&Dt(Je)),Lt!==l&&(Lt=RK()),(_e=Lt)===l&&(c.test(s.charAt(H))?(_e=s.charAt(H),H++):(_e=l,He===0&&Dt(pt)));s.charCodeAt(H)===39?(_e=de,H++):(_e=l,He===0&&Dt(it)),_e!==l?D=JEe(se):(H=D,D=l)}else H=D,D=l;return D}function vCe(){var D;return(D=_Ce())===l&&(D=bCe()),D}function _Ce(){var D,K,se,_e,Lt;if(D=H,I4()!==l)if(Ze(),(K=Kn())!==l){for(Ze(),se=[],_e=R4();_e!==l;)se.push(_e),_e=R4();_e=Ze(),(Lt=$4())!==l?D=ZEe(K,se):(H=D,D=l)}else H=D,D=l;else H=D,D=l;if(D===l)if(D=H,I4()!==l)if(Ze(),(K=Kn())!==l){for(Ze(),se=[],_e=R4();_e!==l;)se.push(_e),_e=R4();_e=Ze(),(Lt=GK())!==l?(Ze(),$4()!==l?D=KEe(K,se,Lt):(H=D,D=l)):(H=D,D=l)}else H=D,D=l;else H=D,D=l;return D}function bCe(){var D,K,se,_e;if(D=H,I4()!==l){for(Ze(),K=[],se=M4();se!==l;)K.push(se),se=M4();se=Ze(),(_e=$4())!==l?D=QEe(K):(H=D,D=l)}else H=D,D=l;if(D===l)if(D=H,I4()!==l){for(Ze(),K=[],se=M4();se!==l;)K.push(se),se=M4();se=Ze(),(_e=GK())!==l?(Ze(),$4()!==l?D=eAe(K,_e):(H=D,D=l)):(H=D,D=l)}else H=D,D=l;return D}function M4(){var D,K,se;return D=H,sQ()!==l?(Ze(),(K=Kn())!==l?(Ze(),nQ()!==l?(Ze(),(se=Kn())!==l?D=OK(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function R4(){var D,K,se;return D=H,sQ()!==l?(Ze(),(K=Kn())!==l?(Ze(),nQ()!==l?(Ze(),(se=Kn())!==l?D=OK(K,se):(H=D,D=l)):(H=D,D=l)):(H=D,D=l)):(H=D,D=l),D}function GK(){var D,K;return D=H,kCe()!==l?(Ze(),(K=Kn())!==l?D=tAe(K):(H=D,D=l)):(H=D,D=l),D}function wCe(){var D,K,se,_e;return D=H,(K=xCe())!==l?(se=H,He++,_e=mF(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=iAe(K):(H=D,D=l)):(H=D,D=l),D}function xCe(){var D,K,se,_e;return D=H,(K=O4())!==l&&(se=jK())!==l&&(_e=HK())!==l?D=rAe(K,se,_e):(H=D,D=l),D===l&&(D=H,(K=O4())!==l&&(se=jK())!==l?D=sAe(K,se):(H=D,D=l),D===l&&(D=H,(K=O4())!==l&&(se=HK())!==l?D=nAe(K,se):(H=D,D=l),D===l&&(D=H,(K=O4())!==l&&(K=oAe(K)),D=K))),D}function O4(){var D,K,se;return(D=Vw())===l&&(D=H,s.charCodeAt(H)===45?(K=W,H++):(K=l,He===0&&Dt(Z)),K===l&&(s.charCodeAt(H)===43?(K=B,H++):(K=l,He===0&&Dt(te))),K!==l&&(se=Vw())!==l?D=aAe(K,se):(H=D,D=l)),D}function jK(){var D,K,se;return D=H,s.charCodeAt(H)===46?(K=me,H++):(K=l,He===0&&Dt(qt)),K!==l?((se=Vw())===l&&(se=null),D=lAe(se)):(H=D,D=l),D}function HK(){var D,K,se;return D=H,(K=TCe())!==l&&(se=Vw())!==l?D=cAe(K,se):(H=D,D=l),D}function Vw(){var D,K;if(D=[],(K=qK())!==l)for(;K!==l;)D.push(K),K=qK();else D=l;return D!==l&&(D=hAe(D)),D}function qK(){var D;return u.test(s.charAt(H))?(D=s.charAt(H),H++):(D=l,He===0&&Dt(ri)),D}function TCe(){var D,K,se;return D=H,m.test(s.charAt(H))?(K=s.charAt(H),H++):(K=l,He===0&&Dt(Ji)),K!==l?(g.test(s.charAt(H))?(se=s.charAt(H),H++):(se=l,He===0&&Dt(Zi)),se===l&&(se=null),D=uAe(K,se)):(H=D,D=l),D}function SCe(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===ge?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(an)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=K=[K,se]:(H=D,D=l)):(H=D,D=l),D}function ECe(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Ce?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(Br)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=K=[K,se]:(H=D,D=l)):(H=D,D=l),D}function ACe(){var D,K,se,_e;return D=H,s.substr(H,5).toLowerCase()===Ae?(K=s.substr(H,5),H+=5):(K=l,He===0&&Dt(Rt)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=K=[K,se]:(H=D,D=l)):(H=D,D=l),D}function vF(){var D,K,se,_e;return D=H,s.substr(H,2).toLowerCase()===Pe?(K=s.substr(H,2),H+=2):(K=l,He===0&&Dt(gr)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=dAe():(H=D,D=l)):(H=D,D=l),D}function WK(){var D,K,se,_e;return D=H,s.substr(H,2).toLowerCase()===De?(K=s.substr(H,2),H+=2):(K=l,He===0&&Dt(Ri)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=pAe():(H=D,D=l)):(H=D,D=l),D}function XK(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===ne?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(Ps)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=fAe():(H=D,D=l)):(H=D,D=l),D}function CCe(){var D,K,se,_e;return D=H,s.substr(H,6).toLowerCase()===pe?(K=s.substr(H,6),H+=6):(K=l,He===0&&Dt(rs)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=mAe():(H=D,D=l)):(H=D,D=l),D}function $E(){var D,K,se,_e;return D=H,s.substr(H,3).toLowerCase()===ye?(K=s.substr(H,3),H+=3):(K=l,He===0&&Dt(Js)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=gAe():(H=D,D=l)):(H=D,D=l),D}function P4(){var D,K,se,_e;return D=H,s.substr(H,3).toLowerCase()===we?(K=s.substr(H,3),H+=3):(K=l,He===0&&Dt(Xi)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=yAe():(H=D,D=l)):(H=D,D=l),D}function YK(){var D,K,se,_e;return D=H,s.substr(H,2).toLowerCase()===Ee?(K=s.substr(H,2),H+=2):(K=l,He===0&&Dt(Zn)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=vAe():(H=D,D=l)):(H=D,D=l),D}function JK(){var D,K,se,_e;return D=H,s.substr(H,7).toLowerCase()===Ie?(K=s.substr(H,7),H+=7):(K=l,He===0&&Dt(bi)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=_Ae():(H=D,D=l)):(H=D,D=l),D}function _F(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===xe?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(t1)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=bAe():(H=D,D=l)):(H=D,D=l),D}function MCe(){var D,K,se,_e;return D=H,s.substr(H,3).toLowerCase()===$e?(K=s.substr(H,3),H+=3):(K=l,He===0&&Dt(F0)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=wAe():(H=D,D=l)):(H=D,D=l),D}function RCe(){var D,K,se,_e;return D=H,s.substr(H,9).toLowerCase()===et?(K=s.substr(H,9),H+=9):(K=l,He===0&&Dt(i1)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=xAe():(H=D,D=l)):(H=D,D=l),D}function OCe(){var D,K,se,_e;return D=H,s.substr(H,7).toLowerCase()===ct?(K=s.substr(H,7),H+=7):(K=l,He===0&&Dt(e_)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=TAe():(H=D,D=l)):(H=D,D=l),D}function ZK(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Mt?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(sF)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=SAe():(H=D,D=l)):(H=D,D=l),D}function PCe(){var D,K,se,_e;return D=H,s.substr(H,8).toLowerCase()===at?(K=s.substr(H,8),H+=8):(K=l,He===0&&Dt(nF)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=EAe():(H=D,D=l)):(H=D,D=l),D}function ICe(){var D,K,se,_e;return D=H,s.substr(H,9).toLowerCase()===nt?(K=s.substr(H,9),H+=9):(K=l,He===0&&Dt(oF)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=AAe():(H=D,D=l)):(H=D,D=l),D}function $Ce(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===dt?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(uc)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=CAe():(H=D,D=l)):(H=D,D=l),D}function DCe(){var D,K,se,_e;return D=H,s.substr(H,7).toLowerCase()===xt?(K=s.substr(H,7),H+=7):(K=l,He===0&&Dt(aF)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=MAe():(H=D,D=l)):(H=D,D=l),D}function LCe(){var D,K,se,_e;return D=H,s.substr(H,8).toLowerCase()===wr?(K=s.substr(H,8),H+=8):(K=l,He===0&&Dt(lF)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=RAe():(H=D,D=l)):(H=D,D=l),D}function NCe(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===vs?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(Me)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=OAe():(H=D,D=l)):(H=D,D=l),D}function FCe(){var D,K,se,_e;return D=H,s.substr(H,2).toLowerCase()===ji?(K=s.substr(H,2),H+=2):(K=l,He===0&&Dt(Qe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=PAe():(H=D,D=l)):(H=D,D=l),D}function KK(){var D,K,se,_e;return D=H,s.substr(H,8).toLowerCase()===ae?(K=s.substr(H,8),H+=8):(K=l,He===0&&Dt(ut)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=IAe():(H=D,D=l)):(H=D,D=l),D}function QK(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===sr?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(zi)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=$Ae():(H=D,D=l)):(H=D,D=l),D}function eQ(){var D,K,se,_e;return D=H,s.substr(H,5).toLowerCase()===Bs?(K=s.substr(H,5),H+=5):(K=l,He===0&&Dt(Eo)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=DAe():(H=D,D=l)):(H=D,D=l),D}function tQ(){var D,K,se,_e;return D=H,s.substr(H,3).toLowerCase()===Hi?(K=s.substr(H,3),H+=3):(K=l,He===0&&Dt(Zs)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=LAe():(H=D,D=l)):(H=D,D=l),D}function iQ(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Os?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(dc)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=NAe():(H=D,D=l)):(H=D,D=l),D}function rQ(){var D,K,se,_e;return D=H,s.substr(H,6).toLowerCase()===li?(K=s.substr(H,6),H+=6):(K=l,He===0&&Dt(zw)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=FAe():(H=D,D=l)):(H=D,D=l),D}function t_(){var D,K,se,_e;return D=H,s.substr(H,6).toLowerCase()===vl?(K=s.substr(H,6),H+=6):(K=l,He===0&&Dt(JSe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=kAe():(H=D,D=l)):(H=D,D=l),D}function I4(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Jn?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(ZSe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=UAe():(H=D,D=l)):(H=D,D=l),D}function $4(){var D,K,se,_e;return D=H,s.substr(H,3).toLowerCase()===_l?(K=s.substr(H,3),H+=3):(K=l,He===0&&Dt(KSe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=zAe():(H=D,D=l)):(H=D,D=l),D}function sQ(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Xp?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(QSe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=BAe():(H=D,D=l)):(H=D,D=l),D}function nQ(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===Qv?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(eEe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=VAe():(H=D,D=l)):(H=D,D=l),D}function kCe(){var D,K,se,_e;return D=H,s.substr(H,4).toLowerCase()===e1?(K=s.substr(H,4),H+=4):(K=l,He===0&&Dt(tEe)),K!==l?(se=H,He++,_e=pr(),He--,_e===l?se=void 0:(H=se,se=l),se!==l?D=GAe():(H=D,D=l)):(H=D,D=l),D}function D4(){var D;return s.charCodeAt(H)===44?(D=ft,H++):(D=l,He===0&&Dt(iEe)),D}function bl(){var D;return s.charCodeAt(H)===40?(D=f,H++):(D=l,He===0&&Dt(rEe)),D}function wl(){var D;return s.charCodeAt(H)===41?(D=N,H++):(D=l,He===0&&Dt(sEe)),D}function Ze(){var D,K;for(D=[],K=oQ();K!==l;)D.push(K),K=oQ();return D}function oQ(){var D;return v.test(s.charAt(H))?(D=s.charAt(H),H++):(D=l,He===0&&Dt(nEe)),D}function UCe(){var D,K,se,_e;if(D=H,(K=UK())!==l&&(K=SK(K)),(D=K)===l)if(D=H,s.charCodeAt(H)===96?(K=T,H++):(K=l,He===0&&Dt(wK)),K!==l){if(se=[],w.test(s.charAt(H))?(_e=s.charAt(H),H++):(_e=l,He===0&&Dt(xK)),_e!==l)for(;_e!==l;)se.push(_e),w.test(s.charAt(H))?(_e=s.charAt(H),H++):(_e=l,He===0&&Dt(xK));else se=l;se!==l?(s.charCodeAt(H)===96?(_e=T,H++):(_e=l,He===0&&Dt(wK)),_e!==l?D=jAe(se):(H=D,D=l)):(H=D,D=l)}else H=D,D=l;return D}function zCe(D,K){return{type:"unary_expr",operator:D,expr:K}}function aQ(D,K,se,_e){var Lt={type:"binary_expr",operator:D,left:K,right:se};return _e!==void 0&&(Lt.escape=_e),Lt}function BCe(D,K){for(var se=[D],_e=0;_e<K.length;_e++)se.push(K[_e][3]);return se}function VCe(D,K,se){return BCe(D,K)}function bF(D,K){for(var se=D,_e=0;_e<K.length;_e++)se=aQ(K[_e][1],se,K[_e][3]);return se}if((a=b())!==l&&H===s.length)return a;throw a!==l&&H<s.length&&Dt(HAe()),qAe(hF,Yp<s.length?s.charAt(Yp):null,Yp<s.length?IK(Yp,Yp+1):IK(Yp,Yp))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var a,l=null;for(a=0;a<s.length;a++)if(s[a].source===this.location.source){l=s[a].text.split(/\r\n|\n|\r/g);break}var p=this.location.start,y=this.location.source+":"+p.line+":"+p.column;if(l){var b=this.location.end,x=i("",p.line.toString().length),A=l[p.line-1],M=p.line===b.line?b.column:A.length+1;n+=`
 --> `+y+`
`+x+` |
`+p.line+" | "+A+`
`+x+" | "+i("",p.column-1)+i("",M-p.column,"^")}else n+=`
 at `+y}return n},t.buildMessage=function(s,n){var a={literal:function(M){return'"'+p(M.text)+'"'},class:function(M){var P=M.parts.map(function($){return Array.isArray($)?y($[0])+"-"+y($[1]):y($)});return"["+(M.inverted?"^":"")+P+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(M){return M.description}};function l(M){return M.charCodeAt(0).toString(16).toUpperCase()}function p(M){return M.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+l(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+l(P)})}function y(M){return M.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+l(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+l(P)})}function b(M){return a[M.type](M)}function x(M){var P,$,k=M.map(b);if(k.sort(),k.length>0){for(P=1,$=1;P<k.length;P++)k[P-1]!==k[P]&&(k[$]=k[P],$++);k.length=$}switch(k.length){case 1:return k[0];case 2:return k[0]+" or "+k[1];default:return k.slice(0,-1).join(", ")+", or "+k[k.length-1]}}function A(M){return M?'"'+p(M)+'"':"end of input"}return"Expected "+x(s)+" but "+A(n)+" found."},{SyntaxError:t,parse:r}},($he=bSe).exports&&($he.exports=Dhe());class v2t{static parse(t){return bSe.exports.parse(t)}}const wSe=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,_2t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,b2t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,w2t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,x2t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,T2t=new Set(["current_timestamp","current_date","current_time"]);function k_(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function XA(e,t,i="0",r="0",s="0",n="0",a="",l="0",p="0"){if(a==="+"||a==="-"){const y=`${k_(parseInt(e,10),4)}-${k_(parseInt(t,10),2)}-${k_(parseInt(i,10),2)}`;let b="";parseFloat(n)<10&&(b="0");const x=`${k_(parseInt(r,10),2)}:${k_(parseInt(s,10),2)}:${b+parseFloat(n).toString()}`,A=`${a}${k_(parseInt(l,10),2)}:${k_(parseInt(p,10),2)}`;return new Date(y+"T"+x+A)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(i,10),parseInt(r,10),parseInt(s,10),parseFloat(n))}class S2t{static makeBool(t){return xSe(t)}static featureValue(t,i,r,s){return CSe(t,i,r,s)}static equalsNull(t){return t===null}static applyLike(t,i,r){return Rq(t,i,r)}static ensureArray(t){return Cq(t)}static applyIn(t,i){return Mq(t,i)}static currentDate(){const t=new Date;return t.setHours(0,0,0,0),t}static makeSqlInterval(t,i,r){return Xl.createFromValueAndQualifer(t,i,r)}static convertInterval(t){return t instanceof Xl?t.valueInMilliseconds():t}static currentTimestamp(){return new Date}static compare(t,i,r){return ESe(t,i,r)}static calculate(t,i,r){return ASe(t,i,r)}static makeComparable(t){return Wm(t)}static evaluateFunction(t,i){return vSe(t,i)}static lookup(t,i){const r=i[t];return r===void 0?null:r}static between(t,i){return t==null||i[0]==null||i[1]==null?null:t>=i[0]&&t<=i[1]}static notbetween(t,i){return t==null||i[0]==null||i[1]==null?null:t<i[0]||t>i[1]}static ternaryNot(t){return B$(t)}static ternaryAnd(t,i){return TSe(t,i)}static ternaryOr(t,i){return SSe(t,i)}}class Z8{constructor(t,i){this.fieldsIndex=i,this.datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=v2t.parse(t);const{isStandardized:r,isAggregate:s,referencedFieldNames:n}=this._extractExpressionInfo(i);this.referencedFieldNames=n,this.isStandardized=r,this.isAggregate=s}static create(t,i){return new Z8(t,i)}get fieldNames(){return this.referencedFieldNames}testSet(t,i=Lb){const r={};for(const s of this.fieldNames)r[s]=t.map(n=>i.getAttribute(n,s));return!!this._evaluateNode(this.parseTree,{attributes:r},Lb)}calculateValue(t,i=Lb){const r=this._evaluateNode(this.parseTree,t,i);return r instanceof Xl?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(t,i=Lb){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(t,this.parameters,i,this.datefields):je("esri-csp-restrictions")?this.calculateValue(t,i):(this._compileMe(),this.parseTree._compiledVersion(t,this.parameters,i,this.datefields))}testFeature(t,i=Lb){return!!this._evaluateNode(this.parseTree,t,i)}testFeatureCompiled(t,i=Lb){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(t,this.parameters,i,this.datefields):je("esri-csp-restrictions")?this.testFeature(t,i):(this._compileMe(),!!this.parseTree._compiledVersion(t,this.parameters,i,this.datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,t=>{t.type==="current_time"?this._hasDateFunctions=!0:t.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||T2t.has(t.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const t=new Set;return this._visitAll(this.parseTree,i=>{i.type==="function"&&t.add(i.name.toLowerCase())}),Array.from(t)}getExpressions(){const t=new Map;return this._visitAll(this.parseTree,i=>{if(i.type==="function"){const r=i.name.toLowerCase(),s=i.args.value[0];if(s.type==="column_ref"){const n=s.column,a=`${r}-${n}`;t.has(a)||t.set(a,{aggregateType:r,field:n})}}}),[...t.values()]}getVariables(){const t=new Set;return this._visitAll(this.parseTree,i=>{i.type==="param"&&t.add(i.value.toLowerCase())}),Array.from(t)}_compileMe(){const t="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",t).bind(S2t)}_extractExpressionInfo(t){const i=[],r=new Set;let s=!0,n=!0;return this._visitAll(this.parseTree,a=>{switch(a.type){case"column_ref":{const l=t.get(a.column);let p,y;l?p=y=l.name:(y=a.column,p=y.toLowerCase()),!l||l.type!=="date"&&l.type!=="esriFieldTypeDate"||(this.datefields[l.name]=1),r.has(p)||(r.add(p),i.push(y)),a.column=y;break}case"function":{const{name:l,args:p}=a,y=p.value.length;s&&(s=y2t(l,y)),n&&(n=m2t(l,y));break}}}),{referencedFieldNames:Array.from(i),isStandardized:s,isAggregate:n}}_visitAll(t,i){if(t!=null)switch(i(t),t.type){case"when_clause":this._visitAll(t.operand,i),this._visitAll(t.value,i);break;case"case_expression":for(const r of t.clauses)this._visitAll(r,i);t.format==="simple"&&this._visitAll(t.operand,i),t.else!==null&&this._visitAll(t.else,i);break;case"expr_list":for(const r of t.value)this._visitAll(r,i);break;case"unary_expr":this._visitAll(t.expr,i);break;case"binary_expr":this._visitAll(t.left,i),this._visitAll(t.right,i);break;case"function":this._visitAll(t.args,i)}}evaluateNodeToJavaScript(t){switch(t.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(t.value)+", "+JSON.stringify(t.qualifier)+","+JSON.stringify(t.op)+")";case"case_expression":{let i="";if(t.format==="simple"){const r="this.makeComparable("+this.evaluateNodeToJavaScript(t.operand)+")";i="( ";for(let s=0;s<t.clauses.length;s++)i+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(t.clauses[s].operand)+")) ? ("+this.evaluateNodeToJavaScript(t.clauses[s].value)+") : ";t.else!==null?i+=this.evaluateNodeToJavaScript(t.else):i+="null",i+=" )"}else{i="( ";for(let r=0;r<t.clauses.length;r++)i+=" this.makeBool("+this.evaluateNodeToJavaScript(t.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(t.clauses[r].value)+") : ";t.else!==null?i+=this.evaluateNodeToJavaScript(t.else):i+="null",i+=" )"}return i}case"param":return"this.lookup("+JSON.stringify(t.value.toLowerCase())+",lookups)";case"expr_list":{let i="[";for(const r of t.value)i!=="["&&(i+=","),i+=this.evaluateNodeToJavaScript(r);return i+="]",i}case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(t.expr)+")";case"binary_expr":switch(t.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+" )";case"IS":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(t.left)+")";case"ISNOT":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(t.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(t.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(t.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(t.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(t.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+","+JSON.stringify(t.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+","+JSON.stringify(t.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(t.operator)+","+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(t.operator)+","+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")"}throw new Error("Not Supported Operator "+t.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(t.value);case"date":return"(new Date("+Nhe(t.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Lhe(t.value).getTime().toString()+"))";case"current_time":return t.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(t.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(t.name)+","+this.evaluateNodeToJavaScript(t.args)+")"}throw new Error("Unsupported sql syntax "+t.type)}_evaluateNode(t,i,r){switch(t.type){case"interval":{const s=this._evaluateNode(t.value,i,r);return Xl.createFromValueAndQualifer(s,t.qualifier,t.op)}case"case_expression":if(t.format==="simple"){const s=Wm(this._evaluateNode(t.operand,i,r));for(let n=0;n<t.clauses.length;n++)if(s===Wm(this._evaluateNode(t.clauses[n].operand,i,r)))return this._evaluateNode(t.clauses[n].value,i,r);if(t.else!==null)return this._evaluateNode(t.else,i,r)}else{for(let s=0;s<t.clauses.length;s++)if(xSe(this._evaluateNode(t.clauses[s].operand,i,r)))return this._evaluateNode(t.clauses[s].value,i,r);if(t.else!==null)return this._evaluateNode(t.else,i,r)}return null;case"param":return this.parameters[t.value.toLowerCase()];case"expr_list":{const s=[];for(const n of t.value)s.push(this._evaluateNode(n,i,r));return s}case"unary_expr":return B$(this._evaluateNode(t.expr,i,r));case"binary_expr":switch(t.operator){case"AND":return TSe(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"OR":return SSe(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"IS":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(t.left,i,r)===null;case"ISNOT":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(t.left,i,r)!==null;case"IN":{const s=Cq(this._evaluateNode(t.right,i,r));return Mq(this._evaluateNode(t.left,i,r),s)}case"NOT IN":{const s=Cq(this._evaluateNode(t.right,i,r));return B$(Mq(this._evaluateNode(t.left,i,r),s))}case"BETWEEN":{const s=this._evaluateNode(t.left,i,r),n=this._evaluateNode(t.right,i,r);return s==null||n[0]==null||n[1]==null?null:s>=Wm(n[0])&&s<=Wm(n[1])}case"NOTBETWEEN":{const s=this._evaluateNode(t.left,i,r),n=this._evaluateNode(t.right,i,r);return s==null||n[0]==null||n[1]==null?null:s<Wm(n[0])||s>Wm(n[1])}case"LIKE":return Rq(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r),t.escape);case"NOT LIKE":return B$(Rq(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r),t.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return ESe(t.operator,this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"-":case"+":case"*":case"/":return ASe(t.operator,this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r))}case"null":case"bool":case"string":case"number":return t.value;case"date":return Nhe(t.value);case"timestamp":return Lhe(t.value);case"current_time":{const s=new Date;return t.mode==="date"&&s.setHours(0,0,0,0),s}case"column_ref":return CSe(i,t.column,this.datefields,r);case"function":{const s=this._evaluateNode(t.args,i,r);return this.isAggregate?f2t(t.name,s):vSe(t.name,s)}}throw new Error("Unsupported sql syntax "+t.type)}}function Lhe(e){let t=_2t.exec(e);if(t!==null){const[,i,r,s,n,a,l]=t;return XA(i,r,s,n,a,l)}if(t=b2t.exec(e),t!==null){const[,i,r,s,n,a,l,p,y,b]=t;return XA(i,r,s,n,a,l,p,y,b)}if(t=w2t.exec(e),t!==null){const[,i,r,s,n,a,l,p,y]=t;return XA(i,r,s,n,a,"0",l,p,y)}if(t=x2t.exec(e),t!==null){const[,i,r,s,n,a]=t;return XA(i,r,s,n,a)}if(t=wSe.exec(e),t!==null){const[,i,r,s]=t;return XA(i,r,s)}throw new Error("SQL Invalid Timestamp")}function Nhe(e){const t=wSe.exec(e);if(t===null)throw new Error("SQL Invalid Date");const[,i,r,s]=t;return new Date(parseInt(i,10),parseInt(r,10)-1,parseInt(s,10))}function xSe(e){return e===!0}function Cq(e){return Array.isArray(e)?e:[e]}function B$(e){return e!==null?e!==!0:null}function TSe(e,t){return e!=null&&t!=null?e===!0&&t===!0:e!==!1&&t!==!1&&null}function SSe(e,t){return e!=null&&t!=null?e===!0||t===!0:e===!0||t===!0||null}function Mq(e,t){if(e==null)return null;let i=!1;for(const r of t)if(r==null)i=null;else if(e===r){i=!0;break}return i}const Fhe="-[]/{}()*+?.\\^$|";var t2;function E2t(e,t){const i=t;let r="",s=t2.Normal;for(let n=0;n<e.length;n++){const a=e.charAt(n);switch(s){case t2.Normal:a===i?s=t2.Escaped:Fhe.includes(a)?r+="\\"+a:r+=a==="%"?".*":a==="_"?".":a;break;case t2.Escaped:Fhe.includes(a)?r+="\\"+a:r+=a,s=t2.Normal}}return new RegExp("^"+r+"$","m")}function Rq(e,t,i){return e==null?null:E2t(t,i).test(e)}function Wm(e){return e instanceof Date?e.valueOf():e}function ESe(e,t,i){if(t==null||i==null)return null;const r=Wm(t),s=Wm(i);switch(e){case"<>":return r!==s;case"=":return r===s;case">":return r>s;case"<":return r<s;case">=":return r>=s;case"<=":return r<=s}}function ASe(e,t,i){if(t instanceof Xl)if(i instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+i.getTime());case"-":return t.valueInMilliseconds()-i.getTime();case"*":return t.valueInMilliseconds()*i.getTime();case"/":return t.valueInMilliseconds()/i.getTime()}else if(i instanceof Xl)switch(e){case"+":return Xl.createFromMilliseconds(t.valueInMilliseconds()+i.valueInMilliseconds());case"-":return Xl.createFromMilliseconds(t.valueInMilliseconds()-i.valueInMilliseconds());case"*":return t.valueInMilliseconds()*i.valueInMilliseconds();case"/":return t.valueInMilliseconds()/i.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(i instanceof Xl)if(t instanceof Date)switch(e){case"+":return new Date(i.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-i.valueInMilliseconds());case"*":return t.getTime()*i.valueInMilliseconds();case"/":return t.getTime()/i.valueInMilliseconds()}else i=i.valueInMilliseconds();else if(t instanceof Date&&typeof i=="number")switch(i=24*i*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+i);case"-":return new Date(t-i);case"*":return new Date(t*i);case"/":return new Date(t/i)}else if(i instanceof Date&&typeof t=="number")switch(t=24*t*60*60*1e3,i=i.getTime(),e){case"+":return new Date(t+i);case"-":return new Date(t-i);case"*":return new Date(t*i);case"/":return new Date(t/i)}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i}}function A2t(e){return e&&typeof e.attributes=="object"}function CSe(e,t,i,r){const s=r.getAttribute(e,t);return s!=null&&i[t]===1?new Date(s):s}(function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"})(t2||(t2={}));const Lb={getAttribute:(e,t)=>(A2t(e)?e.attributes:e)[t]};var uK=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",WhereClause:Z8,defaultAttributeAdapter:Lb});class C2t{constructor(t,i){this._cache=new $j(t),this._invalidCache=new $j(i)}get(t,i){const r=`${i.uid}:${t}`,s=this._cache.get(r);if(s)return s;if(this._invalidCache.get(r)!==void 0)return null;try{const n=Z8.create(t,i);return this._cache.put(r,n),n}catch{return this._invalidCache.put(r,null),null}}}const dK=new C2t(50,500),mv="feature-store:unsupported-query",MSe=" as ",M2t=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function TEt(e,t){if(!t)return!0;const i=dK.get(t,e);if(!i)throw new Se(mv,"invalid SQL expression",{where:t});if(!i.isStandardized)throw new Se(mv,"where clause is not standard",{where:t});return pK(e,i.fieldNames,"where clause contains missing fields"),!0}function SEt(e,t,i){if(!t)return!0;const r=dK.get(t,e);if(!r)throw new Se(mv,"invalid SQL expression",{having:t});if(!r.isAggregate)throw new Se(mv,"having does not contain a valid aggregate function",{having:t});const s=r.fieldNames;if(pK(e,s,"having contains missing fields"),!r.getExpressions().every(n=>{const{aggregateType:a,field:l}=n,p=e.has(l)&&e.get(l).name;return i.some(y=>{const{onStatisticField:b,statisticType:x}=y;return(e.has(b)&&e.get(b).name)===p&&x.toLowerCase().trim()===a})}))throw new Se(mv,"expressions in having should also exist in outStatistics",{having:t});return!0}function fT(e,t){return e?dK.get(e,t):null}function pK(e,t,i,r=!0){const s=[];for(const n of t)if(n!=="*"&&!e.has(n))if(r){const a=RSe(n);try{const l=fT(a,e);if(!l)throw new Se(mv,"invalid SQL expression",{where:a});if(!l.isStandardized)throw new Se(mv,"expression is not standard",{clause:l});pK(e,l.fieldNames,"expression contains missing fields")}catch(l){const p=l&&l.details;if(p&&(p.clause||p.where))throw l;p&&p.missingFields?s.push(...p.missingFields):s.push(n)}}else s.push(n);if(s.length)throw new Se(mv,i,{missingFields:s})}function RSe(e){return e.split(MSe)[0]}function R2t(e){return e.split(MSe)[1]}function EEt(e,t){const i=t.get(e);return!!i&&!M2t.has(i.type)}const khe=new Ui({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let B3=class extends Ye{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};_([S({type:hc,json:{write:!0}})],B3.prototype,"baseSymbol",void 0),_([S({types:Tye,json:{read:{reader:Sye},write:!0}})],B3.prototype,"colorRamp",void 0),_([S({json:{read:khe.read,write:khe.write}})],B3.prototype,"type",void 0),B3=_([re("esri.rest.support.ClassificationDefinition")],B3);const O2t=B3,Uhe=new Ui({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),zhe=new Ui({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let sp=class extends O2t{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(e){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",e)}set definedInterval(e){this.classificationMethod==="defined-interval"&&this._set("definedInterval",e)}};_([S({json:{write:!0}})],sp.prototype,"breakCount",void 0),_([S({json:{write:!0}})],sp.prototype,"classificationField",void 0),_([S({type:String,json:{read:Uhe.read,write:Uhe.write}})],sp.prototype,"classificationMethod",void 0),_([S({json:{write:!0}})],sp.prototype,"normalizationField",void 0),_([S({json:{read:zhe.read,write:zhe.write}})],sp.prototype,"normalizationType",void 0),_([S({value:null,json:{write:!0}})],sp.prototype,"standardDeviationInterval",null),_([S({value:null,json:{write:!0}})],sp.prototype,"definedInterval",null),_([S()],sp.prototype,"type",void 0),sp=_([re("esri.rest.support.ClassBreaksDefinition")],sp);const P2t=sp;function Ux(e,t){return Number(e.toFixed(t))}function I2t(e){const{normalizationTotal:t}=e;return{classBreaks:$2t(e),normalizationTotal:t}}function $2t(e){const t=e.definition,{classificationMethod:i,breakCount:r,normalizationType:s,definedInterval:n}=t,a=[];let l=e.values;if(l.length===0)return[];l=l.sort((b,x)=>b-x);const p=l[0],y=l[l.length-1];if(i==="equal-interval")if(l.length>=r){const b=(y-p)/r;let x=p;for(let A=1;A<r;A++){const M=Ux(p+A*b,6);a.push({minValue:x,maxValue:M,label:_c(x,M,s)}),x=M}a.push({minValue:x,maxValue:y,label:_c(x,y,s)})}else l.forEach(b=>{a.push({minValue:b,maxValue:b,label:_c(b,b,s)})});else if(i==="natural-breaks"){const b=D2t(l),x=e.valueFrequency||b.valueFrequency,A=L2t(b.uniqueValues,x,r);let M=p;for(let P=1;P<r;P++)if(b.uniqueValues.length>P){const $=Ux(b.uniqueValues[A[P]],6);a.push({minValue:M,maxValue:$,label:_c(M,$,s)}),M=$}a.push({minValue:M,maxValue:y,label:_c(M,y,s)})}else if(i==="quantile")if(l.length>=r&&p!==y){let b=p,x=Math.ceil(l.length/r),A=0;for(let M=1;M<r;M++){let P=x+A-1;P>l.length&&(P=l.length-1),P<0&&(P=0),a.push({minValue:b,maxValue:l[P],label:_c(b,l[P],s)}),b=l[P],A+=x,x=Math.ceil((l.length-A)/(r-M))}a.push({minValue:b,maxValue:y,label:_c(b,y,s)})}else{let b=-1;for(let x=0;x<l.length;x++){const A=l[x];A!==b&&(b=A,a.push({minValue:b,maxValue:A,label:_c(b,A,s)}),b=A)}}else if(i==="standard-deviation"){const b=k2t(l),x=U2t(l,b);if(x===0)a.push({minValue:l[0],maxValue:l[0],label:_c(l[0],l[0],s)});else{const A=F2t(p,y,r,b,x)*x;let M=0,P=p;for(let k=r;k>=1;k--){const z=Ux(b-(k-.5)*A,6);a.push({minValue:P,maxValue:z,label:_c(P,z,s)}),P=z,M++}let $=Ux(b+.5*A,6);a.push({minValue:P,maxValue:$,label:_c(P,$,s)}),P=$,M++;for(let k=1;k<=r;k++)$=M===2*r?y:Ux(b+(k+.5)*A,6),a.push({minValue:P,maxValue:$,label:_c(P,$,s)}),P=$,M++}}else if(i==="defined-interval"){if(!n)return a;const b=l[0],x=l[l.length-1],A=Math.ceil((x-b)/n);let M=b;for(let P=1;P<A;P++){const $=Ux(b+P*n,6);a.push({minValue:M,maxValue:$,label:_c(M,$,s)}),M=$}a.push({minValue:M,maxValue:x,label:_c(M,x,s)})}return a}function _c(e,t,i){let r=null;return r=e===t?i&&i==="percent-of-total"?e+"%":e.toString():i&&i==="percent-of-total"?e+"% - "+t+"%":e+" - "+t,r}function D2t(e){const t=[],i=[];let r=Number.MIN_VALUE,s=1,n=-1;for(let a=0;a<e.length;a++){const l=e[a];l===r?(s++,i[n]=s):l!==null&&(t.push(l),r=l,s=1,i.push(s),n++)}return{uniqueValues:t,valueFrequency:i}}function L2t(e,t,i){const r=e.length,s=[];i>r&&(i=r);for(let a=0;a<i;a++)s.push(Math.round(a*r/i-1));s.push(r-1);let n=Bhe(s,e,t,i);return N2t(n.mean,n.sdcm,s,e,t,i)&&(n=Bhe(s,e,t,i)),s}function Bhe(e,t,i,r){let s=[],n=[],a=[],l=0;const p=[],y=[];for(let M=0;M<r;M++){const P=mT(M,e,t,i);p.push(P.sbMean),y.push(P.sbSdcm),l+=y[M]}let b,x=l,A=!0;for(;A||l<x;){A=!1,s=[];for(let M=0;M<r;M++)s.push(e[M]);for(let M=0;M<r;M++)for(let P=e[M]+1;P<=e[M+1];P++)if(b=t[P],M>0&&P!==e[M+1]&&Math.abs(b-p[M])>Math.abs(b-p[M-1]))e[M]=P;else if(M<r-1&&e[M]!==P-1&&Math.abs(b-p[M])>Math.abs(b-p[M+1])){e[M+1]=P-1;break}x=l,l=0,n=[],a=[];for(let M=0;M<r;M++){n.push(p[M]),a.push(y[M]);const P=mT(M,e,t,i);p[M]=P.sbMean,y[M]=P.sbSdcm,l+=y[M]}}if(l>x){for(let M=0;M<r;M++)e[M]=s[M],p[M]=n[M],y[M]=a[M];l=x}return{mean:p,sdcm:y}}function N2t(e,t,i,r,s,n){let a=0,l=0,p=0,y=0,b=!0;for(let x=0;x<2&&b;x++){x===0&&(b=!1);for(let A=0;A<n-1;A++)for(;i[A+1]+1!==i[A+2];){i[A+1]=i[A+1]+1;const M=mT(A,i,r,s);p=M.sbMean,a=M.sbSdcm;const P=mT(A+1,i,r,s);if(y=P.sbMean,l=P.sbSdcm,!(a+l<t[A]+t[A+1])){i[A+1]=i[A+1]-1;break}t[A]=a,t[A+1]=l,e[A]=p,e[A+1]=y,b=!0}for(let A=n-1;A>0;A--)for(;i[A]!==i[A-1]+1;){i[A]=i[A]-1;const M=mT(A-1,i,r,s);p=M.sbMean,a=M.sbSdcm;const P=mT(A,i,r,s);if(y=P.sbMean,l=P.sbSdcm,!(a+l<t[A-1]+t[A])){i[A]=i[A]+1;break}t[A-1]=a,t[A]=l,e[A-1]=p,e[A]=y,b=!0}}return b}function F2t(e,t,i,r,s){let n=Math.max(r-e,t-r)/s/i;return n=n>=1?1:n>=.5?.5:.25,n}function k2t(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/=e.length,t}function U2t(e,t){let i=0;for(let r=0;r<e.length;r++){const s=e[r];i+=(s-t)*(s-t)}return i/=e.length,Math.sqrt(i)}function mT(e,t,i,r){let s=0,n=0;for(let p=t[e]+1;p<=t[e+1];p++){const y=r[p];s+=i[p]*y,n+=y}n<=0&&console.log("Exception in Natural Breaks calculation");const a=s/n;let l=0;for(let p=t[e]+1;p<=t[e+1];p++)l+=r[p]*(i[p]-a)**2;return{sbMean:a,sbSdcm:l}}const z2t="equal-interval",B2t=1,V2t=5,G2t=10,j2t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,Vhe=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),H2t=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function OSe(e){const t=e.normalizationField!=null||e.normalizationType!=null,i=e.minValue!=null||e.maxValue!=null,r=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!i&&!r}function Ghe(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,i=t.filter(s=>s!=null).length,r={count:i};return e.supportsNullCount&&(r.nullcount=t.length-i),e.percentileParams&&(r.median=fK(t,e.percentileParams)),r}function Oq(e){const{values:t,useSampleStdDev:i,supportsNullCount:r}=e;let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=null,l=null,p=null,y=null,b=0;const x=e.minValue==null?-1/0:e.minValue,A=e.maxValue==null?1/0:e.maxValue;for(const P of t)Number.isFinite(P)?P>=x&&P<=A&&(a+=P,s=Math.min(s,P),n=Math.max(n,P),b++):typeof P=="string"&&b++;if(b&&a!=null){l=a/b;let P=0;for(const $ of t)Number.isFinite($)&&$>=x&&$<=A&&(P+=($-l)**2);y=i?b>1?P/(b-1):0:b>0?P/b:0,p=Math.sqrt(y)}else s=null,n=null;const M={avg:l,count:b,max:n,min:s,stddev:p,sum:a,variance:y};return r&&(M.nullcount=t.length-b),e.percentileParams&&(M.median=fK(t,e.percentileParams)),M}function fK(e,t){const{fieldType:i,value:r,orderBy:s,isDiscrete:n}=t,a=PSe(i,s==="desc");if((e=[...e].filter(M=>M!=null).sort((M,P)=>a(M,P))).length===0)return null;if(r<=0)return e[0];if(r>=1)return e[e.length-1];const l=(e.length-1)*r,p=Math.floor(l),y=p+1,b=l%1,x=e[p],A=e[y];return y>=e.length||n||typeof x=="string"||typeof A=="string"?x:x*(1-b)+A*b}function PSe(e,t){const i=t?1:-1,r=q2t(t),s=jhe(t);if(!(!!e&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Vhe].includes(e)))return(n,a)=>typeof n=="number"&&typeof a=="number"?r(n,a):typeof n=="string"&&typeof a=="string"?s(n,a):i;if(e==="esriFieldTypeDate")return(n,a)=>{const l=new Date(n).getTime(),p=new Date(a).getTime();return isNaN(l)||isNaN(p)?i:r(l,p)};if(Vhe.has(e))return(n,a)=>r(n,a);if(e==="esriFieldTypeString")return(n,a)=>s(n,a);if(e==="esriFieldTypeGUID"||e==="esriFieldTypeGlobalID"){const n=jhe(t);return(a,l)=>n(Hhe(a),Hhe(l))}return t?(n,a)=>1:(n,a)=>-1}function jhe(e){return e?(t,i)=>{var r,s;return(t=(r=t)==null?void 0:r.toUpperCase())>(i=(s=i)==null?void 0:s.toUpperCase())?-1:t<i?1:0}:(t,i)=>{var r,s;return(t=(r=t)==null?void 0:r.toUpperCase())<(i=(s=i)==null?void 0:s.toUpperCase())?-1:t>i?1:0}}function q2t(e){return e?(t,i)=>i-t:(t,i)=>t-i}function Hhe(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function W2t(e,t){let i;for(i in e)H2t.indexOf(i)>-1&&(Number.isFinite(e[i])||(e[i]=null));return t&&["avg","stddev","variance"].forEach(r=>{e[r]!=null&&(e[r]=Math.ceil(e[r]))}),e}function X2t(e){const t={};for(let i of e)(i==null||typeof i=="string"&&i.trim()==="")&&(i=null),t[i]==null?t[i]={count:1,data:i}:t[i].count++;return{count:t}}function Y2t(e,t,i){const r=e.count,s=[];i&&t&&t.type==="coded-value"&&t.codedValues.forEach(n=>{const a=n.code;r.hasOwnProperty(a)||(r[a]={data:a,count:0})});for(const n in r){const a=r[n];s.push({value:a.data,count:a.count,label:a.label})}return{uniqueValueInfos:s}}function J2t(e,t,i,r){let s=null;switch(t){case"log":e!==0&&(s=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(r)&&r!==0&&(s=e/r*100);break;case"field":Number.isFinite(i)&&i!==0&&(s=e/i);break;case"natural-log":e>0&&(s=Math.log(e));break;case"square-root":e>0&&(s=e**.5)}return s}function ISe(e,t){const i=K2t({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||V2t});return e=Z2t(e,t.minValue,t.maxValue),I2t({definition:i,values:e,normalizationTotal:t.normalizationTotal})}function Z2t(e,t,i){return t=t==null?-1/0:t,i=i==null?1/0:i,e.filter(r=>Number.isFinite(r)&&r>=t&&r<=i)}function K2t(e){const t=e.field,i=e.classificationMethod||z2t,r=e.normalizationType,s=e.normalizationField,n=new P2t;return n.classificationField=t,n.breakCount=e.breakCount,n.classificationMethod=i,n.standardDeviationInterval=i==="standard-deviation"?e.standardDeviationInterval||B2t:void 0,n.normalizationType=r,n.normalizationField=r==="field"?s:void 0,n}function Q2t(e,t){let i=e.classBreaks;const r=i.length,s=i[0].minValue,n=i[r-1].maxValue,a=t==="standard-deviation",l=j2t;return i=i.map(p=>{const y=p.label,b={minValue:p.minValue,maxValue:p.maxValue,label:y};if(a&&y){const x=y.match(l).map(A=>+A.trim());x.length===2?(b.minStdDev=x[0],b.maxStdDev=x[1],x[0]<0&&x[1]>0&&(b.hasAvg=!0)):x.length===1&&(y.includes("<")?(b.minStdDev=null,b.maxStdDev=x[0]):y.includes(">")&&(b.minStdDev=x[0],b.maxStdDev=null))}return b}),{minValue:s,maxValue:n,classBreakInfos:i,normalizationTotal:e.normalizationTotal}}function ewt(e,t){const{min:i,max:r,intervals:s}=twt(e,t),n=s.map((a,l)=>({minValue:s[l][0],maxValue:s[l][1],count:0}));for(const a of e)if(a!=null&&a>=i&&a<=r){const l=iwt(s,a);l>-1&&n[l].count++}return{bins:n,minValue:i,maxValue:r,normalizationTotal:t.normalizationTotal}}function twt(e,t){const{field:i,classificationMethod:r,standardDeviationInterval:s,normalizationType:n,normalizationField:a,normalizationTotal:l,minValue:p,maxValue:y}=t,b=t.numBins||G2t;let x=null,A=null,M=null;if((!r||r==="equal-interval")&&!n){if(p!=null&&y!=null)x=p,A=y;else{const P=Oq({values:e,minValue:p,maxValue:y,useSampleStdDev:!n,supportsNullCount:OSe({normalizationType:n,normalizationField:a,minValue:p,maxValue:y})});x=P.min,A=P.max}M=rwt(x,A,b)}else{const{classBreaks:P}=ISe(e,{field:i,normalizationType:n,normalizationField:a,normalizationTotal:l,classificationMethod:r,standardDeviationInterval:s,minValue:p,maxValue:y,numClasses:b});x=P[0].minValue,A=P[P.length-1].maxValue,M=P.map($=>[$.minValue,$.maxValue])}return{min:x,max:A,intervals:M}}function iwt(e,t){let i=-1;for(let r=e.length-1;r>=0;r--)if(t>=e[r][0]){i=r;break}return i}function rwt(e,t,i){const r=(t-e)/i,s=[];let n,a=e;for(let l=1;l<=i;l++)n=a+r,n=Number(n.toFixed(16)),s.push([a,l===i?t:n]),a=n;return s}class II{constructor(t,i,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=i;const s=t.outFields;if(s&&s.indexOf("*")===-1){this.outFields=s;let n=0;for(const a of s){const l=RSe(a),p=this.fieldsIndex.get(l),y=p?null:fT(l,r),b=p?p.name:R2t(a)||"FIELD_EXP_"+n++;this._fieldDataCache.set(a,{alias:b,clause:y})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,r){const s=r?r.name:i;let n=null;return this._fieldDataCache.has(s)?n=this._fieldDataCache.get(s).clause:r||(n=fT(i,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:n})),r?this.featureAdapter.getAttribute(t,s):n.calculateValue(t,this.featureAdapter)}getNormalizedValue(t,i){const r=i.normalizationType,s=i.normalizationTotal;let n=this.getFieldValue(t,i.field,i.fieldInfo);if(r&&Number.isFinite(n)){const a=this.getFieldValue(t,i.normalizationField,i.normalizationFieldInfo);n=J2t(n,r,a,s)}return n}getExpressionValue(t,i,r){const s={attributes:this.featureAdapter.getAttributes(t)},n=r.createExecContext(s,i.viewInfo);return r.executeFunction(i.compiledFunc,n)}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:fT(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testFeature(t,this.featureAdapter)}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:fT(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testSet(t,this.featureAdapter)}_processAttributesForOutFields(t){const i=this.outFields;if(!i||!i.length)return this.featureAdapter.getAttributes(t);const r={};for(const s of i){const{alias:n,clause:a}=this._fieldDataCache.get(s);r[n]=a?a.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return r}_processAttributesForDistinctValues(t){if(J(t)||!this.returnDistinctValues)return t;const i=this.outFields,r=[];if(i)for(const a of i){const{alias:l}=this._fieldDataCache.get(a);r.push(t[l])}else for(const a in t)r.push(t[a]);const s=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++n),n>1?null:t}}const $Se={convertToGEGeometry:swt,exportPoint:owt,exportPolygon:lwt,exportPolyline:hwt,exportMultipoint:dwt,exportExtent:fwt};function swt(e,t){return t==null?null:e.convertJSONToGeometry(t)}class nwt{constructor(t,i,r){this.x=t,this.y=i,this.spatialReference=r,this.z=void 0,this.m=void 0}}function owt(e,t,i){const r=new nwt(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),n=e.hasM(t);return s&&(r.z=e.getPointZ(t)),n&&(r.m=e.getPointM(t)),r}class awt{constructor(t,i,r,s){this.rings=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function lwt(e,t,i){return new awt(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))}class cwt{constructor(t,i,r,s){this.paths=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function hwt(e,t,i){return new cwt(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))}class uwt{constructor(t,i,r,s){this.points=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function dwt(e,t,i){return new uwt(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))}class pwt{constructor(t,i,r,s,n){this.xmin=t,this.ymin=i,this.xmax=r,this.ymax=s,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}function fwt(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new pwt(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(r){const a=e.getZExtent(t);n.zmin=a.vmin,n.zmax=a.vmax}if(s){const a=e.getMExtent(t);n.mmin=a.vmin,n.mmax=a.vmax}return n}const hz=[0,0];function DSe(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,hz),t.z!=null&&(i.z=t.z),t.m!=null&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,hz),[i.xmax,i.ymax]=e(t.xmax,t.ymax,hz),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:qhe(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:qhe(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:LSe(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function qhe(e,t){const i=[];for(const r of e)i.push(LSe(r,t));return i}function LSe(e,t){const i=[];for(const r of e){const s=t(r[0],r[1],[0,0]);i.push(s),r.length>2&&s.push(r[2]),r.length>3&&s.push(r[3])}return i}async function NSe(e,t){if(!t)return;const i=Array.isArray(e)?e.map(r=>L(r.geometry)&&r.geometry.spatialReference):[e];await GLe(i.map(r=>({source:r,dest:t})))}const FSe=DSe.bind(null,i2),kSe=DSe.bind(null,TT);function dL(e,t,i){if(!e||(i||(i=t,t=e.spatialReference),!ml(t)||!ml(i)||Vo(t,i)))return e;if(Mp(t,i)){const r=c0(i)?FSe(e):kSe(e);return r.spatialReference=i,r}return z6($Se,[e],t,i,null)[0]}class mwt{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,i,r){if(!t||!t.length||!i||!r||Vo(i,r))return t;const s={geometries:t,inSpatialReference:i,outSpatialReference:r,resolve:null};return this._jobs.push(s),new Promise(n=>{s.resolve=n,this._timer===null&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:i,inSpatialReference:r,outSpatialReference:s,resolve:n}=t;Mp(r,s)?c0(s)?n(i.map(FSe)):n(i.map(kSe)):n(z6($Se,i,r,s,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const gwt=new mwt;function ywt(e,t,i){return gwt.push(e,t,i)}function AEt(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:r,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(r&&s)t.forEach(l=>{const p=i.getAttribute(l,r),y=i.getAttribute(l,s);p==null||isNaN(p)||(n=Math.min(n,p)),y==null||isNaN(y)||(a=Math.max(a,y))});else{const l=r||s;t.forEach(p=>{const y=i.getAttribute(p,l);y==null||isNaN(y)||(n=Math.min(n,y),a=Math.max(a,y))})}return{start:n,end:a}}function vwt(e,t,i){if(!t||!e)return null;const{startTimeField:r,endTimeField:s}=e;if(!r&&!s)return null;const{start:n,end:a}=t;return n===null&&a===null?null:n===void 0&&a===void 0?wwt():r&&s?_wt(i,r,s,n,a):bwt(i,r||s,n,a)}function _wt(e,t,i,r,s){return r!=null&&s!=null?n=>{const a=e.getAttribute(n,t),l=e.getAttribute(n,i);return(a==null||a<=s)&&(l==null||l>=r)}:r!=null?n=>{const a=e.getAttribute(n,i);return a==null||a>=r}:s!=null?n=>{const a=e.getAttribute(n,t);return a==null||a<=s}:void 0}function bwt(e,t,i,r){return i!=null&&r!=null&&i===r?s=>e.getAttribute(s,t)===i:i!=null&&r!=null?s=>{const n=e.getAttribute(s,t);return n>=i&&n<=r}:i!=null?s=>e.getAttribute(s,t)>=i:r!=null?s=>e.getAttribute(s,t)<=r:void 0}function wwt(){return()=>!1}function mK(e,t){return e?t?4:3:t?3:2}function CEt(e,t,i,r,s){if(J(t)||!t.lengths.length)return null;const n=(s==null?void 0:s.originPosition)==="upperLeft"?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],p=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:y,coords:b}=t,x=mK(i,r);let A=0;for(const M of y){const P=xwt(p,b,A,M,i,r,n);P&&l.push(P),A+=M*x}if(l.sort((M,P)=>{let $=n*M[2]-n*P[2];return $===0&&i&&($=M[4]-P[4]),$}),l.length){let M=6*l[0][2];a[0]=l[0][0]/M,a[1]=l[0][1]/M,i&&(M=6*l[0][4],a[2]=M!==0?l[0][3]/M:0),(a[0]<p[0]||a[0]>p[1]||a[1]<p[2]||a[1]>p[3]||i&&(a[2]<p[4]||a[2]>p[5]))&&(a.length=0)}if(!a.length){const M=t.lengths[0]?Twt(b,0,y[0],i,r):null;if(!M)return null;a[0]=M[0],a[1]=M[1],i&&M.length>2&&(a[2]=M[2])}return e}function xwt(e,t,i,r,s,n,a=1){const l=mK(s,n);let p=i,y=i+l,b=0,x=0,A=0,M=0,P=0;for(let k=0,z=r-1;k<z;k++,p+=l,y+=l){const G=t[p],B=t[p+1],W=t[p+2],q=t[y],X=t[y+1],oe=t[y+2];let de=G*X-q*B;M+=de,b+=(G+q)*de,x+=(B+X)*de,s&&(de=G*oe-q*W,A+=(W+oe)*de,P+=de),G<e[0]&&(e[0]=G),G>e[1]&&(e[1]=G),B<e[2]&&(e[2]=B),B>e[3]&&(e[3]=B),s&&(W<e[4]&&(e[4]=W),W>e[5]&&(e[5]=W))}if(M*a>0&&(M*=-1),P*a>0&&(P*=-1),!M)return null;const $=[b,x,.5*M];return s&&($[3]=A,$[4]=.5*P),$}function Twt(e,t,i,r,s){const n=mK(r,s);let a=t,l=t+n,p=0,y=0,b=0,x=0;for(let A=0,M=i-1;A<M;A++,a+=n,l+=n){const P=e[a],$=e[a+1],k=e[a+2],z=e[l],G=e[l+1],B=e[l+2],W=r?Ewt(P,$,k,z,G,B):Swt(P,$,z,G);if(W)if(p+=W,r){const q=Cwt(P,$,k,z,G,B);y+=W*q[0],b+=W*q[1],x+=W*q[2]}else{const q=Awt(P,$,z,G);y+=W*q[0],b+=W*q[1]}}return p>0?r?[y/p,b/p,x/p]:[y/p,b/p]:i>0?r?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function Swt(e,t,i,r){const s=i-e,n=r-t;return Math.sqrt(s*s+n*n)}function Ewt(e,t,i,r,s,n){const a=r-e,l=s-t,p=n-i;return Math.sqrt(a*a+l*l+p*p)}function Awt(e,t,i,r){return[e+.5*(i-e),t+.5*(r-t)]}function Cwt(e,t,i,r,s,n){return[e+.5*(r-e),t+.5*(s-t),i+.5*(n-i)]}const Mwt=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),Whe=Object.freeze({}),Xhe=new za,Rwt=new za,Pq=new za,uz={esriGeometryPoint:dG,esriGeometryPolyline:iY,esriGeometryPolygon:rY,esriGeometryMultipoint:tY};function Yhe(e,t,i,r=e.hasZ,s=e.hasM){if(J(t))return null;const n=e.hasZ&&r,a=e.hasM&&s;if(i){const l=_R(Pq,t,e.hasZ,e.hasM,"esriGeometryPoint",i,r,s);return dG(l,n,a)}return dG(t,n,a)}function $I(e,t,i,r,s,n,a=t,l=i){const p=t&&a,y=i&&l,b=L(r)?"coords"in r?r:r.geometry:null;if(J(b))return null;if(s){let x=H7e(Rwt,b,t,i,e,s,a,l);return n&&(x=_R(Pq,x,p,y,e,n)),uz[e](x,p,y)}if(n){const x=_R(Pq,b,t,i,e,n,a,l);return uz[e](x,p,y)}return W7e(Xhe,b,t,i,a,l),uz[e](Xhe,p,y)}async function MEt(e,t,i){const{outFields:r,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:a}=e;if(r)for(let l=0;l<r.length;l++)r[l]=r[l].trim();if(s)for(let l=0;l<s.length;l++)s[l]=s[l].trim();if(n)for(let l=0;l<n.length;l++)n[l]=n[l].trim();if(a)for(let l=0;l<a.length;l++)a[l].onStatisticField&&(a[l].onStatisticField=a[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),Owt(e,t,i)}async function Owt(e,t,i){if(!e)return null;let{where:r}=e;if(e.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let s=await Pwt(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:p}=e.geometry;s=rB(s),s.spatialReference=p}e.geometry=s,await NSe(s.spatialReference,i);const n=(await fN(Lp(s)))[0];if(J(n))throw Whe;const a=n.toJSON(),l=await dL(a,a.spatialReference,i);if(!l)throw Whe;return l.spatialReference=i,e.geometry=l,e}async function Pwt(e){const{geometry:t,distance:i,units:r}=e;if(i==null||"vertexAttributes"in t)return t;const s=t.spatialReference,n=r?Mwt.fromJSON(r):mX(s),a=s&&(PW(s)||c0(s))?t:await NSe(s,Qz).then(()=>dL(t,Qz));return(await Iwt())(a.spatialReference,a,i,n)}async function Iwt(){return(await import("./geometryEngineJSON.7b5bdc4f.js")).geodesicBuffer}function dz(e){return e&&USe in e?JSON.parse(JSON.stringify(e,$wt)):e}const USe="_geVersion",$wt=(e,t)=>e!==USe?t:void 0;class Nb{constructor(t,i,r){this.items=t,this.queryGeometry=i,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter,this.aggregateAdapter=r.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(t){const i=new II(t,this.featureAdapter,this.fieldsIndex);if(!t.outStatistics)return i.countDistinctValues(this.items);const{groupByFieldsForStatistics:r,having:s}=t;if(!(r==null?void 0:r.length))return 1;const n=new Map,a=new Map,l=new Set,p=t.outStatistics;for(const y of p){const{statisticType:b}=y,x=b!=="exceedslimit"?y.onStatisticField:void 0;if(!a.has(x)){const M=[];for(const P of r){const $=this._getAttributeValues(i,P,n);M.push($)}a.set(x,this._calculateUniqueValues(M,i.returnDistinctValues))}const A=a.get(x);for(const M in A){const{data:P,items:$}=A[M],k=P.join(",");s&&!i.validateItems($,s)||l.add(k)}}return l.size}async createQueryResponse(t){let i;return t.outStatistics?i=t.outStatistics.some(r=>r.statisticType==="exceedslimit")?this._createExceedsLimitQueryResponse(t):await this._createStatisticsQueryResponse(t):i=this._createFeatureQueryResponse(t),t.returnQueryGeometry&&(ml(t.outSR)&&!Vo(this.queryGeometry.spatialReference,t.outSR)?i.queryGeometry=dz(ie({spatialReference:t.outSR},dL(this.queryGeometry,this.queryGeometry.spatialReference,t.outSR))):i.queryGeometry=dz(ie({spatialReference:t.outSR},this.queryGeometry))),i}createSnappingResponse(t,i){const r=this.featureAdapter,s=Lwt(this.hasZ,this.hasM),{x:n,y:a}=t.point,l=typeof t.distance=="number"?t.distance:t.distance.x,p=typeof t.distance=="number"?t.distance:t.distance.y,y={candidates:[]},b=this.geometryType==="esriGeometryPolygon",x=this._getPointCreator(t.point,this.spatialReference,i);for(const A of this.items){const M=r.getGeometry(A);if(J(M))continue;const{coords:P,lengths:$}=M;if(t.types&QS.EDGE){let k=0;for(let z=0;z<$.length;z++){const G=$[z];for(let B=0;B<G;B++,k+=s){const W=P[k],q=P[k+1];if(B!==G-1){const X=P[k+s],oe=P[k+s+1],{x:de,y:he}=Dwt(n,a,W,q,X,oe),fe=(n-de)/l,me=(a-he)/p,ge=fe*fe+me*me;ge<=1&&y.candidates.push({type:"edge",objectId:r.getObjectId(A),distance:Math.sqrt(ge),target:x(de,he),start:x(W,q),end:x(X,oe)})}}}}if(t.types&QS.VERTEX){const k=b?P.length-s:P.length;for(let z=0;z<k;z+=s){const G=P[z],B=P[z+1],W=(n-G)/l,q=(a-B)/p,X=W*W+q*q;X<=1&&y.candidates.push({type:"vertex",objectId:r.getObjectId(A),distance:Math.sqrt(X),target:x(G,B)})}}}return y.candidates.sort((A,M)=>A.distance-M.distance),y}_getPointCreator(t,i,r){const s=L(r)&&!Vo(i,r)?n=>dL(n,i,r):n=>n;return t.z!=null&&t.m!=null?(n,a)=>s({x:n,y:a,z:t.z,m:t.m}):t.z!=null?(n,a)=>s({x:n,y:a,z:t.z}):t.m!=null?(n,a)=>s({x:n,y:a,m:t.m}):(n,a)=>s({x:n,y:a})}executeAttributesQuery(t){const i=fT(t.where,this.fieldsIndex);if(!i)return Promise.resolve(this);if(i.isStandardized){let r=0;const s=[];for(const a of this.items)i.testFeature(a,this.featureAdapter)&&(s[r++]=a);const n=new Nb(s,this.queryGeometry,this);return n.definitionExpression=t.where,Promise.resolve(n)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(t){if(!t.aggregateIds||!t.aggregateIds.length||J(this.aggregateAdapter))return Promise.resolve(this);const i=new Set;for(const s of t.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(s).forEach(n=>i.add(n));const r=this.featureAdapter.getObjectId;return Promise.resolve(new Nb(this.items.filter(s=>i.has(r(s))),this.queryGeometry,this))}executeObjectIdsQuery(t){if(!t.objectIds||!t.objectIds.length)return Promise.resolve(this);const i=new Set(t.objectIds),r=this.featureAdapter.getObjectId;return Promise.resolve(new Nb(this.items.filter(s=>i.has(r(s))),this.queryGeometry,this))}executeTimeQuery(t){const i=vwt(this.timeInfo,t.timeExtent,this.featureAdapter);if(!L(i))return Promise.resolve(this);const r=this.items.filter(i);return Promise.resolve(new Nb(r,this.queryGeometry,this))}filterLatest(){const{trackIdField:t,startTimeField:i,endTimeField:r}=this.timeInfo,s=r||i,n=new Map,a=this.featureAdapter.getAttribute;for(const p of this.items){const y=a(p,t),b=a(p,s),x=n.get(y);(!x||b>a(x,s))&&n.set(y,p)}const l=Array.from(n.values());return Promise.resolve(new Nb(l,this.queryGeometry,this))}async project(t){if(!t||Vo(this.spatialReference,t))return this;const i=this.featureAdapter,r=(await ywt(this.items.map(s=>$I(this.geometryType,this.hasZ,this.hasM,i.getGeometry(s))),this.spatialReference,t)).map((s,n)=>i.cloneWithGeometry(this.items[n],h1e(s,this.hasZ,this.hasM)));return new Nb(r,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})}async createSummaryStatisticsResponse(t,i){const{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,minValue:p,maxValue:y,scale:b}=i,x=this.fieldsIndex.isDateField(r),A=await this._getDataValues(t,{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,scale:b}),M=OSe({normalizationType:a,normalizationField:n,minValue:p,maxValue:y}),P=this.fieldsIndex.get(r),$={value:.5,fieldType:P==null?void 0:P.type},k=ite(P)?Ghe({values:A,supportsNullCount:M,percentileParams:$}):Oq({values:A,minValue:p,maxValue:y,useSampleStdDev:!a,supportsNullCount:M,percentileParams:$});return W2t(k,x)}async createUniqueValuesResponse(t,i){const{field:r,valueExpression:s,domain:n,returnAllCodedValues:a,scale:l}=i,p=await this._getDataValues(t,{field:r,valueExpression:s,scale:l}),y=X2t(p);return Y2t(y,n,a)}async createClassBreaksResponse(t,i){const{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,classificationMethod:p,standardDeviationInterval:y,minValue:b,maxValue:x,numClasses:A,scale:M}=i,P=await this._getDataValues(t,{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,scale:M}),$=ISe(P,{field:r,normalizationField:n,normalizationType:a,normalizationTotal:l,classificationMethod:p,standardDeviationInterval:y,minValue:b,maxValue:x,numClasses:A});return Q2t($,p)}async createHistogramResponse(t,i){const{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,classificationMethod:p,standardDeviationInterval:y,minValue:b,maxValue:x,numBins:A,scale:M}=i,P=await this._getDataValues(t,{field:r,valueExpression:s,normalizationField:n,normalizationType:a,normalizationTotal:l,scale:M});return ewt(P,{field:r,normalizationField:n,normalizationType:a,normalizationTotal:l,classificationMethod:p,standardDeviationInterval:y,minValue:b,maxValue:x,numBins:A})}_sortFeatures(t,i,r){if(t.length>1&&i&&i.length)for(const s of i.reverse()){const n=s.split(" "),a=n[0],l=this.fieldsIndex.get(a),p=n[1]&&n[1].toLowerCase()==="desc",y=PSe(l==null?void 0:l.type,p);t.sort((b,x)=>{const A=r(b,a,l),M=r(x,a,l);return y(A,M)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:r,hasM:s,hasZ:n,objectIdField:a,spatialReference:l}=this,{outFields:p,outSR:y,quantizationParameters:b,resultRecordCount:x,resultOffset:A,returnZ:M,returnM:P}=t,$=x!=null&&i.length>(A||0)+x,k=p&&(p.includes("*")?[...this.fieldsIndex.fields]:p.map(z=>this.fieldsIndex.get(z)));return{exceededTransferLimit:$,features:this._createFeatures(t,i),fields:k,geometryType:r,hasM:s&&P,hasZ:n&&M,objectIdFieldName:a,spatialReference:dz(y||l),transform:b&&woe(b)||null}}_createFeatures(t,i){const r=new II(t,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:n}=this,{orderByFields:a,quantizationParameters:l,returnGeometry:p,returnCentroid:y,maxAllowableOffset:b,resultOffset:x,resultRecordCount:A,returnZ:M=!1,returnM:P=!1}=t,$=n&&M,k=s&&P;let z=[],G=0;const B=[...i];if(this._sortFeatures(B,a,(q,X,oe)=>r.getFieldValue(q,X,oe)),p||y){const q=woe(l);if(p&&!y)for(const X of B)z[G++]={attributes:r.getAttributes(X),geometry:$I(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(X),b,q,$,k)};else if(!p&&y)for(const X of B)z[G++]={attributes:r.getAttributes(X),centroid:Yhe(this,this.featureAdapter.getCentroid(X,this),q)};else for(const X of B)z[G++]={attributes:r.getAttributes(X),centroid:Yhe(this,this.featureAdapter.getCentroid(X,this),q),geometry:$I(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(X),b,q,$,k)}}else for(const q of B){const X=r.getAttributes(q);X&&(z[G++]={attributes:X})}const W=x||0;if(A!=null){const q=W+A;z=z.slice(W,Math.min(z.length,q))}return z}_createExceedsLimitQueryResponse(t){let i=!1,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const a of t.outStatistics)if(a.statisticType==="exceedslimit"){r=a.maxPointCount!=null?a.maxPointCount:Number.POSITIVE_INFINITY,s=a.maxRecordCount!=null?a.maxRecordCount:Number.POSITIVE_INFINITY,n=a.maxVertexCount!=null?a.maxVertexCount:Number.POSITIVE_INFINITY;break}if(this.geometryType==="esriGeometryPoint")i=this.items.length>r;else if(this.items.length>s)i=!0;else{const a=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;i=this.items.reduce((p,y)=>{const b=l.getGeometry(y);return p+(L(b)&&b.coords.length||0)},0)/a>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}async _createStatisticsQueryResponse(t){const i={attributes:{}},r=[],s=new Map,n=new Map,a=new Map,l=new Map,p=new II(t,this.featureAdapter,this.fieldsIndex),y=t.outStatistics,{groupByFieldsForStatistics:b,having:x,orderByFields:A}=t,M=b&&b.length,P=!!M,$=P&&b[0],k=P&&!this.fieldsIndex.get($);for(const G of y){const{outStatisticFieldName:B,statisticType:W}=G,q=G,X=W!=="exceedslimit"?G.onStatisticField:void 0,oe=W==="percentile_disc"||W==="percentile_cont",de=W==="EnvelopeAggregate"||W==="CentroidAggregate"||W==="ConvexHullAggregate",he=P&&M===1&&(X===$||k)&&W==="count";if(P){if(!a.has(X)){const me=[];for(const ge of b){const Ce=this._getAttributeValues(p,ge,s);me.push(Ce)}a.set(X,this._calculateUniqueValues(me,p.returnDistinctValues))}const fe=a.get(X);for(const me in fe){const{count:ge,data:Ce,items:Ae,itemPositions:Pe}=fe[me],De=Ce.join(",");if(!x||p.validateItems(Ae,x)){const ne=l.get(De)||{attributes:{}};if(de){ne.aggregateGeometries||(ne.aggregateGeometries={});const{aggregateGeometries:pe,outStatisticFieldName:ye}=await this._getAggregateGeometry(q,Ae);ne.aggregateGeometries[ye]=pe}else{let pe=null;if(he)pe=ge;else{const ye=this._getAttributeValues(p,X,s),we=Pe.map(Ee=>ye[Ee]);pe=oe&&"statisticParameters"in q?this._getPercentileValue(q,we):this._getStatisticValue(q,we,null,p.returnDistinctValues)}ne.attributes[B]=pe}b.forEach((pe,ye)=>ne.attributes[this.fieldsIndex.get(pe)?pe:`EXPR_${ye+1}`]=Ce[ye]),l.set(De,ne)}}}else if(de){i.aggregateGeometries||(i.aggregateGeometries={});const{aggregateGeometries:fe,outStatisticFieldName:me}=await this._getAggregateGeometry(q,this.items);i.aggregateGeometries[me]=fe}else{const fe=this._getAttributeValues(p,X,s);i.attributes[B]=oe&&"statisticParameters"in q?this._getPercentileValue(q,fe):this._getStatisticValue(q,fe,n,p.returnDistinctValues)}r.push({name:B,alias:B,type:"esriFieldTypeDouble"})}const z=P?Array.from(l.values()):[i];return this._sortFeatures(z,A,(G,B)=>G.attributes[B]),{fields:r,features:z}}async _getAggregateGeometry(t,i){const r=await import("./geometryEngineJSON.7b5bdc4f.js"),{statisticType:s,outStatisticFieldName:n}=t,{featureAdapter:a,spatialReference:l,geometryType:p,hasZ:y,hasM:b}=this,x=i.map(P=>$I(p,y,b,a.getGeometry(P))),A=r.convexHull(l,x,!0)[0],M={aggregateGeometries:null,outStatisticFieldName:null};if(s==="EnvelopeAggregate"){const P=A?VW(A):rB(r.union(l,x));M.aggregateGeometries=qe(ie({},P),{spatialReference:l}),M.outStatisticFieldName=n||"extent"}else if(s==="CentroidAggregate"){const P=A?bfe(A):Q9e(rB(r.union(l,x)));M.aggregateGeometries={x:P[0],y:P[1],spatialReference:l},M.outStatisticFieldName=n||"centroid"}else s==="ConvexHullAggregate"&&(M.aggregateGeometries=A,M.outStatisticFieldName=n||"convexHull");return M}_getStatisticValue(t,i,r,s){const{onStatisticField:n,statisticType:a}=t;let l=null;return l=r!=null&&r.has(n)?r.get(n):ite(this.fieldsIndex.get(n))?Ghe({values:i,returnDistinct:s}):Oq({values:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,l),l[a==="var"?"variance":a]}_getPercentileValue(t,i){const{onStatisticField:r,statisticParameters:s,statisticType:n}=t,{value:a,orderBy:l}=s,p=this.fieldsIndex.get(r),y={value:a,orderBy:l,fieldType:p==null?void 0:p.type,isDiscrete:n==="percentile_disc"};return fK(i,y)}_getAttributeValues(t,i,r){if(r.has(i))return r.get(i);const s=this.fieldsIndex.get(i),n=this.items.map(a=>t.getFieldValue(a,i,s));return r.set(i,n),n}_getAttributeNormalizedValues(t,i){return this.items.map(r=>t.getNormalizedValue(r,{field:i.field,fieldInfo:this.fieldsIndex.get(i.field),normalizationField:i.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(i.normalizationField),normalizationType:i.normalizationType,normalizationTotal:i.normalizationTotal}))}async _getAttributeExpressionValues(t,i,r){const{arcadeUtils:s}=await Np(),n=s.createFunction(i),a=r&&s.getViewInfo(r);return this.items.map(l=>t.getExpressionValue(l,{compiledFunc:n,viewInfo:a},s))}_calculateUniqueValues(t,i){const r={},s=this.items,n=s.length;for(let a=0;a<n;a++){const l=s[a],p=[];for(const b of t)p.push(b[a]);const y=p.join(",");i?r[y]==null&&(r[y]={count:1,data:p,items:[l],itemPositions:[a]}):r[y]==null?r[y]={count:1,data:p,items:[l],itemPositions:[a]}:(r[y].count++,r[y].items.push(l),r[y].itemPositions.push(a))}return r}async _getDataValues(t,i){const r=new II(t,this.featureAdapter,this.fieldsIndex),{valueExpression:s,field:n,normalizationField:a,normalizationType:l,normalizationTotal:p,scale:y}=i,b=s?{viewingMode:"map",scale:y,spatialReference:t.outSR||this.spatialReference}:null;return s?this._getAttributeExpressionValues(r,s,b):this._getAttributeNormalizedValues(r,{field:n,normalizationField:a,normalizationType:l,normalizationTotal:p})}}function Dwt(e,t,i,r,s,n){const a=s-i,l=n-r,p=a*a+l*l,y=(e-i)*a+(t-r)*l,b=Math.min(1,Math.max(0,y/p));return{x:i+a*b,y:r+l*b}}function Lwt(e,t){return e?t?4:3:t?3:2}var QS;(function(e){e[e.NONE=0]="NONE",e[e.EDGE=1]="EDGE",e[e.VERTEX=2]="VERTEX"})(QS||(QS={}));let Tp=class extends Ye{constructor(){super(...arguments),this.enabled=!0}};_([S({type:Boolean})],Tp.prototype,"enabled",void 0),Tp=_([re("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Tp);let bn=class extends Ye{constructor(e){super(e),this.lineSnapper=new Tp,this.parallelLineSnapper=new Tp,this.rightAngleSnapper=new Tp,this.rightAngleTriangleSnapper=new Tp,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ft([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};_([S({type:Tp,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"lineSnapper",void 0),_([S({type:Tp,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"parallelLineSnapper",void 0),_([S({type:Tp,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"rightAngleSnapper",void 0),_([S({type:Tp,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"rightAngleTriangleSnapper",void 0),_([S({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],bn.prototype,"shortLineThreshold",void 0),_([S({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],bn.prototype,"distance",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"pointThreshold",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"intersectionParallelLineThreshold",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"parallelLineThreshold",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"touchSensitivityMultiplier",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"pointOnLineThreshold",void 0),_([S({type:Ft,nonNullable:!0})],bn.prototype,"orange",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"lineHintWidthReference",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"lineHintWidthTarget",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bn.prototype,"lineHintFadedExtensions",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"parallelLineHintWidth",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],bn.prototype,"parallelLineHintLength",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],bn.prototype,"parallelLineHintOffset",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],bn.prototype,"rightAngleHintSize",void 0),_([S({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],bn.prototype,"rightAngleHintOutlineSize",void 0),bn=_([re("esri.views.interactive.snapping.Settings.Defaults")],bn);const Ng=new bn;function bw(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function Ip(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function Bo(e,t,i,r){return r.type==="2d"?r.toScreen(t.vectorToPoint(e,Nwt)):(zSe(e,t,i,r,Jhe),r.state.camera.projectToScreen(Jhe,pz),dd(pz[0],pz[1]))}function zSe(e,t,i,r,s=Q()){const n=t.toXYZ(e);return n[2]=Eq(r,n,t.spatialReference,i)||0,r.renderCoordsHelper.toRenderCoords(n,t.spatialReference,s),s}function REt(e,t,i,r,s,n,a){const l=i.toXYZ(e),p=i.toXYZ(t),y=Eq(s,l,i.spatialReference,r),b=Eq(s,p,i.spatialReference,r),x=(y==null?b:b==null?y:Math.min(y,b))||0;l[2]=x,p[2]=x,s.renderCoordsHelper.toRenderCoords(l,i.spatialReference,n),s.renderCoordsHelper.toRenderCoords(p,i.spatialReference,a)}function gK(e,t){t.sort((i,r)=>v0(i.targetPoint,e)-v0(r.targetPoint,e))}var Gp;(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Gp||(Gp={}));const Jhe=Q(),pz=Ns(),Nwt=new Gt;function fz(e,t){return e[0]*t[1]-e[1]*t[0]}function BSe(e,t,i){const r=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(r)/ug(t,i)}function Fwt(e,t,i){const r=bs(i,t)/Q2(i);return Wl(e,i,r)}function VT(e,t,i,r,s=i){return Fs(Sp,r,i),Fs(ud,t,s),Fwt(eE,ud,Sp),kh(e,s,eE)}function kwt(e,t,i,r){Fs(Sp,r,i),Fs(ud,t,i);const s=bs(Sp,ud)/Q2(Sp);return s>0?r0(e,i,Sp,s):Pn(e,i)}function yK(e,t,i,r){Fs(Sp,t,i);const s=r/$N(Sp);return r0(e,i,Sp,s)}function VSe(e,t){return VT(ud,t,e.start,e.end),_2(ud[0],t[0])&&_2(ud[1],t[1])?[a2(t)]:[]}function GSe(e,t,i){return yK(ud,i,e,t),_2(ud[0],i[0])&&_2(ud[1],i[1])?[a2(i)]:[]}function Uwt(e,t){const i=e.start,r=e.end,s=t.start,n=t.end,a=Fs(Sp,r,i),l=Fs(HSe,n,s),p=fz(a,l);if(Math.abs(p)<=zwt)return[];const y=Fs(ud,i,s),b=fz(l,y)/p,x=fz(a,y)/p;if(b>=0){if(x>=0||t.type===go.LINE)return[r0(eE,i,a,b)]}else if(e.type===go.LINE&&(x>=0||t.type===go.LINE))return[r0(eE,i,a,b)];return[]}function jSe(e,t,i){const r=[],s=Fs(Sp,e.end,e.start),n=Fs(HSe,e.start,t),a=Q2(s),l=2*bs(s,n),p=l*l-4*a*(Q2(n)-i*i);if(p===0){const y=-l/(2*a);(e.type===go.LINE||y>=0)&&r.push(r0(eE,e.start,s,y))}else if(p>0){const y=Math.sqrt(p),b=(-l+y)/(2*a);(e.type===go.LINE||b>=0)&&r.push(r0(eE,e.start,s,b));const x=(-l-y)/(2*a);(e.type===go.LINE||x>=0)&&r.push(r0(ud,e.start,s,x))}return r}var go;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(go||(go={}));const zwt=1e-6,Sp=St(),HSe=St(),ud=St(),eE=St();class K8{constructor(t){this.coordinateHelper=t}}class Q8 extends K8{constructor(t,i){super(t),this.point=i}objectEqual(t){return t instanceof Q8&&Ip(this.point,t.point)}check(t){return v0(t,this.point)<Ng.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(t){const i=[];return t instanceof ww?i.push(...VSe({start:t.start,end:t.end,type:t instanceof Ep?go.LINE:go.RAY},this.point)):t instanceof T4&&i.push(...GSe(t.center,t.radius,this.point)),i.map(r=>new OE(this.coordinateHelper,r,this,t))}}class ww extends K8{constructor(t,i,r){super(t),this.start=i,this.end=r}objectEqual(t){return t instanceof ww&&Ip(this.start,t.start)&&Ip(this.end,t.end)}intersect(t){const i=[];return t instanceof Q8?i.push(...VSe({start:this.start,end:this.end,type:this instanceof Ep?go.LINE:go.RAY},t.point)):t instanceof ww?i.push(...Uwt({start:this.start,end:this.end,type:this instanceof Ep?go.LINE:go.RAY},{start:t.start,end:t.end,type:t instanceof Ep?go.LINE:go.RAY})):t instanceof T4&&i.push(...jSe({start:this.start,end:this.end,type:this instanceof Ep?go.LINE:go.RAY},t.center,t.radius)),i.map(r=>new OE(this.coordinateHelper,r,this,t))}}class eF extends ww{constructor(t,i,r){super(t,i,r),this.dir=St(),this.p=St()}objectEqual(t){return t instanceof eF&&super.objectEqual(t)}check(t){return Fs(this.dir,this.end,this.start),Fs(this.p,t,this.start),bs(this.dir,this.p)>=0&&BSe(t,this.start,this.end)<Ng.pointOnLineThreshold}closestTo(t){const i=this.coordinateHelper.clone(t);return kwt(i,t,this.start,this.end),i}}class Ep extends ww{constructor(t,i,r){super(t,i,r)}objectEqual(t){return t instanceof Ep&&super.objectEqual(t)}check(t){return BSe(t,this.start,this.end)<Ng.pointOnLineThreshold}closestTo(t){const i=this.coordinateHelper.clone(t);return VT(i,t,this.start,this.end),i}}class OE extends K8{constructor(t,i,r,s){super(t),this.intersection=i,this.first=r,this.second=s}objectEqual(t){return t instanceof OE&&this.first.objectEqual(t.first)&&this.second.objectEqual(t.second)}check(){return!1}closestTo(t){const i=this.coordinateHelper.clone(t);return Pn(i,this.intersection),i}intersect(){return[]}}class T4 extends K8{constructor(t,i,r){super(t),this.center=i,this.radius=r}objectEqual(t){return t instanceof T4&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}check(){return!1}closestTo(t){const i=this.coordinateHelper.clone(t);return yK(i,t,this.center,this.radius),i}intersect(t){const i=[];return t instanceof ww?i.push(...jSe({start:t.start,end:t.end,type:t instanceof Ep?go.LINE:go.RAY},this.center,this.radius)):t instanceof Q8&&i.push(...GSe(this.center,this.radius,t.point)),i.map(r=>new OE(this.coordinateHelper,r,this,t))}}class PE{constructor(t,i,r){this.coordinateHelper=t,this.targetPoint=i,this.constraint=r}}class qSe extends PE{constructor({coordinateHelper:t,targetPoint:i,objectId:r,constraint:s}){super(t,i,s),this.objectId=r}}class tF{}Ge.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class jp extends tF{constructor(t,i,r,s=!0,n=!0){super(),this.type=t,this.lineStart=i,this.lineEnd=r,this.fadeLeft=s,this.fadeRight=n}equals(t){return t instanceof jp&&this.type===t.type&&Ip(this.lineStart,t.lineStart)&&Ip(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}}class Bwt extends qSe{constructor(t){super(qe(ie({},t),{constraint:new Ep(t.coordinateHelper,t.edgeStart,t.edgeEnd)}))}get hints(){return[new jp(Gp.REFERENCE,this.constraint.start,this.constraint.end)]}}Ge.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class iF extends tF{constructor(t,i,r){super(),this.previousVertex=t,this.centerVertex=i,this.nextVertex=r}equals(t){return t instanceof iF&&Ip(this.previousVertex,t.previousVertex)&&Ip(this.centerVertex,t.centerVertex)&&Ip(this.nextVertex,t.nextVertex)}}class WSe extends PE{constructor({coordinateHelper:t,targetPoint:i,constraint:r,previousVertex:s,otherVertex:n,otherVertexType:a,objectId:l}){super(t,i,r),this.previousVertex=s,this.otherVertex=n,this.otherVertexType=a,this.objectId=l}get hints(){const t=this.previousVertex,i=this.otherVertexType===tE.CENTER?this.otherVertex:this.targetPoint,r=this.otherVertexType===tE.CENTER?this.targetPoint:this.otherVertex;return[new jp(Gp.TARGET,i,r),new jp(Gp.REFERENCE,t,i),new iF(this.previousVertex,i,r)]}}var tE;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(tE||(tE={}));let yy=class extends xv{constructor(e){super(e),this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return rn(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){var e;const t=this._get("snappingSources")||new Map,i=new Map;if((e=this.options)!=null&&e.featureSources)for(const r of this.options.featureSources.items){const s=r.layer.uid,n=t.get(s);if(n){t.delete(s),i.set(s,n);continue}if(!r.layer.loaded){this.updatingHandles.addPromise(r.layer.load());continue}const a=this._createSourceInfo(r);L(a)&&i.set(s,a)}for(const[,r]of t)r.destroy();return i}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),Pc),L(this.view)&&this.handles.add([this.view.on("layerview-create",e=>this._updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this._updateLayerView(e.layer,null))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if(!this.options.effectiveFeatureEnabled)return[];const r=[],s=this._computeScreeenSizeDistanceParameters(e,t),n={distance:s,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:l,layerView:p}]of this.snappingSources)!l.layerSource.enabled||L(p)&&p.suspended||r.push(l.fetchCandidates(n,i).then(y=>y.filter(b=>!this._candidateIsExcluded(l,b,t.excludeFeature))));const a=(await due(r)).flat();return this._addRightAngleCandidates(a,e,s,t),Gi(i),gK(e,a),a}_addRightAngleCandidates(e,t,i,r){var s,n,a,l,p,y,b,x;const A=L(r.vertexHandle)?(s=r.vertexHandle.rightEdge)==null||(n=s.rightVertex)==null?void 0:n.pos:L(r.editGeometryOperations)&&r.editGeometryOperations.data.type==="polygon"?(a=(l=r.editGeometryOperations.data.components[0])==null?void 0:l.getFirstVertex())==null?void 0:a.pos:null,M=L(r.vertexHandle)?(p=r.vertexHandle.leftEdge)==null||(y=p.leftVertex)==null?void 0:y.pos:L(r.editGeometryOperations)?(b=(x=r.editGeometryOperations.data.components[0])==null?void 0:x.getLastVertex())==null?void 0:b.pos:null,P=e.length;for(let $=0;$<P;$++)this._addRightAngleCandidate(e[$],M,t,i,r,e),this._addRightAngleCandidate(e[$],A,t,i,r,e)}_addRightAngleCandidate(e,t,i,r,s,n){if(J(t)||!(e instanceof Bwt))return;const a=e.constraint.closestTo(t),l=(a[0]-i[0])/r.x,p=(a[1]-i[1])/r.y;if(l*l+p*p<=1){const y=s.coordinateHelper;n.push(new WSe({coordinateHelper:y,targetPoint:a,otherVertex:t,otherVertexType:tE.NEXT,previousVertex:e.constraint.start,constraint:new eF(y,t,a),objectId:e.objectId}))}}_computeScreeenSizeDistanceParameters(e,t){const i=this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1);return J(this.view)?{x:i,y:i}:this.view.type==="2d"?{x:i*this.view.resolution,y:i*this.view.resolution}:this._computeScreeenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreeenSizeDistanceParameters3D(e,t,i,r){const{coordinateHelper:s,elevationInfo:n}=r,a=i.state.camera.computeScreenPixelSizeAt(zSe(e,s,n,i,Gwt))*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,l=t*a;return{x:l/this._computeScreenMagnitudeOfMapOffset(e,a,0,i,r),y:l/this._computeScreenMagnitudeOfMapOffset(e,0,a,i,r)}}_computeScreenMagnitudeOfMapOffset(e,t,i,r,{coordinateHelper:s,elevationInfo:n}){const a=s.clone(e);a[0]+=t,a[1]+=i;const l=Bo(e,s,n,r),p=Bo(a,s,n,r),y=p.x-l.x,b=p.y-l.y;return Math.sqrt(y*y+b*b)}get types(){return QS.EDGE|QS.VERTEX}_candidateIsExcluded(e,t,i){if(J(i))return!1;const r=this._getCandidateObjectId(t);if(J(r))return!1;const s=e.layerSource.layer;return s.type==="graphics"?i.uid===r:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===r}_getCandidateObjectId(e){return e instanceof qSe?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if(J(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const i=L(this.view)?this.view.allLayerViews.find(r=>r.layer===e.layer):null;return new Vwt(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this._getSourceModule("featureService");return L(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if(e.layer.geometryType==="mesh")return null;const t=this._getSourceModule("featureCollection");return L(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return L(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this.sourceModules[e];if(J(t.loader)){const i=this._loadSourceModule(e).then(r=>{t.module=r});return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(import("./FeatureServiceSnappingSource.454c6bed.js"));case"featureCollection":return this.updatingHandles.addPromise(import("./FeatureCollectionSnappingSource.44f2e324.js"));case"graphics":return this.updatingHandles.addPromise(import("./GraphicsSnappingSource.4b61085e.js"))}return null}};_([S({constructOnly:!0})],yy.prototype,"spatialReference",void 0),_([S({constructOnly:!0})],yy.prototype,"view",void 0),_([S()],yy.prototype,"options",void 0),_([S({readOnly:!0})],yy.prototype,"updating",null),_([S({readOnly:!0})],yy.prototype,"snappingSources",null),yy=_([re("esri.views.interactive.snapping.FeatureSnappingEngine")],yy);class Vwt{constructor(t,i){this.snappingSource=t,this.layerView=i,this.handles=new Ei;const r=this.snappingSource.layerSource.layer;if("refresh"in r){const s=r;this.handles.add(s.on("refresh",()=>t.refresh()))}this.handles.add([Pi(t,"updating",s=>t.layerSource.updating=s,!0),Pi(t,"availability",s=>t.layerSource.availability=s,!0)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const Gwt=Q();class rF{constructor(t,i){this.view=t,this.options=i,this.squaredShortLineThreshold=Ng.shortLineThreshold*Ng.shortLineThreshold}snap(t,i){return L(i.vertexHandle)?i.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(t,i):this.snapNewVertex(t,i)}edgeExceedsShortLineThreshold(t,i){return this.exceedsShortLineThreshold(t.leftVertex.pos,t.rightVertex.pos,i)}exceedsShortLineThreshold(t,i,{elevationInfo:r,editGeometryOperations:s}){const n=s.data.coordinateHelper;return this.squaredShortLineThreshold===0||bw(Bo(i,n,r,this.view),Bo(t,n,r,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(t){return t==="touch"?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:i}=this.options,r=t*i;return r*r}}class jwt extends PE{constructor({coordinateHelper:t,lineStart:i,lineEnd:r,targetPoint:s}){super(t,s,new Ep(t,i,r)),this.referenceLineHint=new jp(Gp.REFERENCE_EXTENSION,i,r)}get hints(){return[this.referenceLineHint,new jp(Gp.TARGET,this._lineEndClosestToTarget(),this.targetPoint)]}_lineEndClosestToTarget(){const t=this.constraint.start,i=this.constraint.end;return Math.sign(bs(Fs(qwt,i,t),Fs(Hwt,this.targetPoint,t)))>0?i:t}}const Hwt=St(),qwt=St();class Wwt extends rF{snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=[];if(s<1)return n;const a=i.coordinateHelper,l=Bo(t,a,i.elevationInfo,this.view),p=r.edges[s-1];let y=p;do this.edgeExceedsShortLineThreshold(y,i)&&this._processCandidateProposal(y.leftVertex.pos,y.rightVertex.pos,t,l,i,n),y=y.leftVertex.leftEdge;while(y&&y!==p);return n}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<2)return r;const a=i.coordinateHelper,l=Bo(t,a,i.elevationInfo,this.view),p=s.leftEdge,y=s.rightEdge;p&&y&&this.edgeExceedsShortLineThreshold(p,i)&&this.edgeExceedsShortLineThreshold(y,i)&&this._processCandidateProposal(p.leftVertex.pos,y.rightVertex.pos,t,l,i,r);const b=n.edges[0];let x=b;do x!==s.leftEdge&&x!==s.rightEdge&&this.edgeExceedsShortLineThreshold(x,i)&&this._processCandidateProposal(x.leftVertex.pos,x.rightVertex.pos,t,l,i,r),x=x.rightVertex.rightEdge;while(x&&x!==b);return r}_processCandidateProposal(t,i,r,s,n,a){const l=VT(St(),r,t,i),p=n.coordinateHelper,y=p.fromXYZ(l,p.getZ(r,0));bw(s,Bo(y,p,n.elevationInfo,this.view))<this.squaredProximityTreshold(n.pointer)&&a.push(new jwt({coordinateHelper:n.coordinateHelper,lineStart:t,lineEnd:i,targetPoint:y}))}}Ge.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class vK extends tF{constructor(t,i){super(),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof vK&&Ip(this.lineStart,t.lineStart)&&Ip(this.lineEnd,t.lineEnd)}}class Xwt extends PE{constructor({coordinateHelper:t,referenceLine:i,lineStart:r,targetPoint:s}){const n=t.clone(r);Fs(n,kh(n,n,i.rightVertex.pos),i.leftVertex.pos),super(t,s,new Ep(t,r,n)),this._referenceLines=[{edge:i,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new jp(Gp.TARGET,this.constraint.start,this.targetPoint),new vK(this.constraint.start,this.targetPoint),...this._referenceLines.map(t=>new jp(Gp.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const i={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{t.rightVertex.rightEdge===r.edge&&(r.fadeLeft=!1,i.fadeRight=!1),t.leftVertex.leftEdge===r.edge&&(r.fadeRight=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}}class Ywt extends rF{constructor(){super(...arguments),this._tmpProjection=St()}snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=r.vertices.length,a=[];if(s<2)return a;const l=Bo(t,i.coordinateHelper,i.elevationInfo,this.view),p=r.vertices[n-1],y=r.vertices[0],b=r.edges[s-1];let x=b;do this.edgeExceedsShortLineThreshold(x,i)&&(this._checkEdgeForParalleLines(x,p.pos,t,l,i,a),this._checkEdgeForParalleLines(x,y.pos,t,l,i,a)),x=x.leftVertex.leftEdge;while(x&&x!==b);return a}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<3)return r;const a=Bo(t,i.coordinateHelper,i.elevationInfo,this.view),l=s.leftEdge,p=s.rightEdge,y=n.vertices[0],b=n.vertices.length,x=n.vertices[b-1],A=n.edges[0];let M=A;do M!==l&&M!==p&&this.edgeExceedsShortLineThreshold(M,i)&&(l&&this._checkEdgeForParalleLines(M,l.leftVertex.pos,t,a,i,r),p&&this._checkEdgeForParalleLines(M,p.rightVertex.pos,t,a,i,r),s===y?this._checkEdgeForParalleLines(M,x.pos,t,a,i,r):s===x&&this._checkEdgeForParalleLines(M,y.pos,t,a,i,r)),M=M.rightVertex.rightEdge;while(M&&M!==A);return r}_checkEdgeForParalleLines(t,i,r,s,n,a){const l=t.leftVertex.pos,p=t.rightVertex.pos;if(VT(this._tmpProjection,i,l,p),v0(this._tmpProjection,i)<Ng.parallelLineThreshold)return;VT(this._tmpProjection,r,l,p,i);const y=n.coordinateHelper,b=y.fromXYZ(this._tmpProjection,y.getZ(r,0));if(bw(s,Bo(b,y,n.elevationInfo,this.view))<this.squaredProximityTreshold(n.pointer)){if(this._parallelToPreviousCandidate(t,a))return;a.push(new Xwt({coordinateHelper:y,referenceLine:t,lineStart:i,targetPoint:b}))}}_parallelToPreviousCandidate(t,i){const r=t.leftVertex.pos,s=t.rightVertex.pos;for(const n of i)if(VT(this._tmpProjection,s,n.constraint.start,n.constraint.end,r),v0(this._tmpProjection,s)<Ng.parallelLineThreshold)return n.addReferenceLine(t),!0;return!1}}class Jwt extends rF{constructor(){super(...arguments),this._tmp=St()}snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.vertices.length,n=[];if(s<2)return n;const a=Bo(t,i.coordinateHelper,i.elevationInfo,this.view),l=r.vertices[s-1];this._checkForSnappingCandidate(n,l.leftEdge,l.pos,t,l.leftEdge.leftVertex.pos,l.pos,i,t,a);const p=r.vertices[0];return this._checkForSnappingCandidate(n,p.rightEdge,p.pos,t,p.rightEdge.rightVertex.pos,p.pos,i,t,a),n}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component,a=n.vertices.length;if(a<3)return r;const l=Bo(t,i.coordinateHelper,i.elevationInfo,this.view),p=s.leftEdge,y=s.rightEdge,b=n.vertices[0],x=n.vertices[a-1];if(!p)return this._checkForSnappingCandidate(r,b.rightEdge.rightVertex.rightEdge,b.rightEdge.rightVertex.pos,t,b.rightEdge.rightVertex.rightEdge.rightVertex.pos,b.rightEdge.rightVertex.pos,i,t,l),r;if(!y)return this._checkForSnappingCandidate(r,x.leftEdge.leftVertex.leftEdge,x.leftEdge.leftVertex.pos,t,x.leftEdge.leftVertex.leftEdge.leftVertex.pos,x.leftEdge.leftVertex.pos,i,t,l),r;if(p&&p.leftVertex.leftEdge){const A=p.leftVertex.leftEdge;this._checkForSnappingCandidate(r,A,p.leftVertex.pos,t,A.leftVertex.pos,p.leftVertex.pos,i,t,l)}if(y&&y.rightVertex.rightEdge){const A=y.rightVertex.rightEdge;this._checkForSnappingCandidate(r,A,y.rightVertex.pos,t,A.rightVertex.pos,y.rightVertex.pos,i,t,l)}return r}_checkForSnappingCandidate(t,i,r,s,n,a,l,p,y){if(!this.edgeExceedsShortLineThreshold(i,l))return;Fs(this._tmp,i.rightVertex.pos,i.leftVertex.pos);const b=yr(this._tmp[1],-this._tmp[0]),x=bs(b,Fs(this._tmp,s,r))/Q2(b),A=l.coordinateHelper,M=A.fromXYZ(r0(St(),a,b,x),A.getZ(p,0));bw(y,Bo(M,A,l.elevationInfo,this.view))<this.squaredProximityTreshold(l.pointer)&&t.push(new WSe({coordinateHelper:A,targetPoint:M,constraint:new eF(A,a,r0(A.createVector(),a,b,Math.sign(x))),previousVertex:n,otherVertex:a,otherVertexType:tE.CENTER}))}}class Zwt extends PE{constructor({coordinateHelper:t,targetPoint:i,point1:r,point2:s}){super(t,i,new T4(t,$y(Kwt,r,s,.5),.5*ug(r,s))),this.p1=r,this.p2=s}get hints(){return[new jp(Gp.REFERENCE,this.targetPoint,this.p1),new jp(Gp.REFERENCE,this.targetPoint,this.p2),new iF(this.p1,this.targetPoint,this.p2)]}}const Kwt=St();class Qwt extends rF{snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=[],n=r.vertices.length;if(i.editGeometryOperations.data.type!=="polygon"||n<2)return s;const a=r.vertices[0],l=r.vertices[n-1];return this._processCandidateProposal(a.pos,l.pos,t,i,s),s}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;return n.edges.length<2||(i.editGeometryOperations.data.type!=="polyline"||s.index!==0&&s.index!==n.vertices.length-1)&&this._processCandidateProposal(s.leftEdge.leftVertex.pos,s.rightEdge.rightVertex.pos,t,i,r),r}_processCandidateProposal(t,i,r,s,n){if(!this.exceedsShortLineThreshold(t,i,s))return;const a=$y(St(),t,i,.5),l=.5*ug(t,i),p=yK(St(),r,a,l),y=s.coordinateHelper,b=y.fromXYZ(p,y.getZ(r,0)),x=Bo(r,y,s.elevationInfo,this.view);bw(x,Bo(b,y,s.elevationInfo,this.view))<this.squaredProximityTreshold(s.pointer)&&n.push(new Zwt({coordinateHelper:y,targetPoint:b,point1:t,point2:i}))}}let V3=class extends st{constructor(e){super(e),this.updating=!1,this._snappers=new kt}initialize(){this._snappers.push(new Ywt(this.view,this.options),new Wwt(this.view,this.options),new Jwt(this.view,this.options),new Qwt(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const r of this._snappers.items)i.push(...r.snap(e,t));return gK(e,i),i}};_([S({readOnly:!0})],V3.prototype,"updating",void 0),_([S({constructOnly:!0})],V3.prototype,"view",void 0),_([S()],V3.prototype,"options",null),V3=_([re("esri.views.interactive.snapping.SelfSnappingEngine")],V3);let Fb=class extends st{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};_([S({constructOnly:!0})],Fb.prototype,"layer",void 0),_([S()],Fb.prototype,"enabled",void 0),_([S()],Fb.prototype,"updating",void 0),_([S()],Fb.prototype,"availability",void 0),Fb=_([re("esri.views.interactive.snapping.SnappingLayerSource")],Fb);const ext=Fb;let Ah=class extends st{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new kt,this.distance=Ng.distance,this.touchSensitivityMultiplier=Ng.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};_([S()],Ah.prototype,"enabled",void 0),_([S()],Ah.prototype,"enabledToggled",void 0),_([S()],Ah.prototype,"selfEnabled",void 0),_([S()],Ah.prototype,"featureEnabled",void 0),_([S({type:kt.ofType(ext)})],Ah.prototype,"featureSources",void 0),_([S()],Ah.prototype,"distance",void 0),_([S()],Ah.prototype,"touchSensitivityMultiplier",void 0),_([S({readOnly:!0})],Ah.prototype,"effectiveEnabled",null),_([S({readOnly:!0})],Ah.prototype,"effectiveSelfEnabled",null),_([S({readOnly:!0})],Ah.prototype,"effectiveFeatureEnabled",null),Ah=_([re("esri.views.interactive.snapping.SnappingOptions")],Ah);const _K=Ah;class bK extends tF{constructor(t){super(),this.intersectionPoint=t}equals(t){return t instanceof bK&&Ip(this.intersectionPoint,t.intersectionPoint)}}class DI extends PE{constructor(t,i,r,s){super(t,i,new OE(t,i,r.constraint,s.constraint)),this.first=r,this.second=s}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new bK(this.targetPoint)]}}let km=class extends ps.EventedMixin(xv){constructor(e){super(e),this.options=new _K,this.engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([vi(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}},()=>{this.doneSnapping(),this.emit("changed")},Pc),vi(()=>this.options,e=>{for(const t of this.engines)t.options=e},Pc),vi(()=>({ready:this.view.ready,spatialReference:this.view.spatialReference}),({ready:e,spatialReference:t})=>this._onViewChange(e,t),Oa)])}destroy(){this._destroyEngines()}get updating(){return this.engines.some(e=>e.updating)}_onViewChange(e,t){this._destroyEngines(),e&&(this.engines=[new V3({view:this.view,options:this.options}),new yy({view:this.view,spatialReference:t!=null?t:It.WGS84,options:this.options})])}_destroyEngines(){for(const e of this.engines)e.destroy();this.engines.length=0}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const r=t.coordinateHelper.pointToVector(e),s=await this._fetchCandidates(r,t,i);return{get valid(){return!zn(i)},apply:()=>{const{snappedPoint:n,hints:a}=this._processCandidates(r,s,t);return this._removeVisualization(),L(t.visualizer)&&this.handles.add(t.visualizer.draw(a,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),LI),n}}}update(e,t){this._removeVisualization();let i=e;const r=[];if(L(this._currentMainCandidate)){const s=t.coordinateHelper,n=s.pointToVector(e),a=this._currentMainCandidate.constraint.closestTo(n);if(bw(Bo(n,s,t.elevationInfo,this.view),Bo(a,s,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){i=s.vectorToDehydratedPoint(a),this._currentMainCandidate.targetPoint=a,r.push(...this._currentMainCandidate.hints);for(const l of this._currentOtherActiveCandidates)l.targetPoint=a,r.push(...l.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return L(t.visualizer)&&this.handles.add(t.visualizer.draw(r,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),LI),i}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(LI)}async _fetchCandidates(e,t,i){return(await Promise.all(this.engines.map(r=>r.fetchCandidates(e,t,i)))).flat()}_processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};gK(e,t);const r=this._currentMainCandidate;if(L(r)){const s=this._findOldConstraintInNewCandidates(r,t);if(s>=0){if(!(t[s]instanceof DI))return this._intersectWithOtherCandidates(s,t,e,i);if(v0(e,r.targetPoint)<this._squaredPointProximityThreshold(i.pointer))return this._updateSnappingCandidate(r,t,i)}}return this._intersectWithOtherCandidates(0,t,e,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof DI?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,r){const s=t[e],n=[],a=r.coordinateHelper;for(let l=0;l<t.length;++l){if(l===e)continue;const p=t[l];for(const y of s.constraint.intersect(p.constraint)){const b=a.fromXYZ(y.intersection,s.targetPoint[2]);n.push([new DI(a,b,s,p),bw(Bo(i,r.coordinateHelper,r.elevationInfo,this.view),Bo(b,r.coordinateHelper,r.elevationInfo,this.view))])}}return n.length>0&&(n.sort((l,p)=>l[1]-p[1]),n[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(n[0][0],t,r):this._updateSnappingCandidate(s,t,r)}_updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const n of t){if(e instanceof DI){if(n.constraint.objectEqual(e.first.constraint)||n.constraint.objectEqual(e.second.constraint))continue}else if(n.constraint.objectEqual(e.constraint))continue;n.constraint.check(r)&&(n.targetPoint=r,this._currentOtherActiveCandidates.push(n),s.push(...n.hints))}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(r),hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.objectEqual(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.handles.has(LI),engines:this.engines}}};_([S({constructOnly:!0})],km.prototype,"view",void 0),_([S()],km.prototype,"options",void 0),_([S({readOnly:!0})],km.prototype,"updating",null),_([S()],km.prototype,"engines",void 0),_([S()],km.prototype,"squaredMouseProximityTreshold",null),_([S()],km.prototype,"squaredTouchProximityThreshold",null),km=_([re("esri.views.interactive.snapping.SnappingManager")],km);const LI="visualization-handle";let ta=class extends ps.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};_([S()],ta.prototype,"activeComponent",void 0),_([S()],ta.prototype,"cancelled",void 0),_([S()],ta.prototype,"history",void 0),_([S()],ta.prototype,"tool",null),_([S()],ta.prototype,"type",void 0),_([S()],ta.prototype,"canUndo",null),_([S()],ta.prototype,"canRedo",null),_([S()],ta.prototype,"onEnd",void 0),_([S()],ta.prototype,"undo",null),_([S()],ta.prototype,"redo",null),_([S()],ta.prototype,"toggleTool",void 0),_([S()],ta.prototype,"addToSelection",void 0),_([S()],ta.prototype,"removeFromSelection",void 0),ta=_([re("esri.widgets.Sketch.support.OperationHandle")],ta);let mz=class extends ta{};_([S()],mz.prototype,"activeComponent",void 0),mz=_([re("esri.widgets.Sketch.support.CreateOperationHandle")],mz);let Xm=class extends ta{constructor(e){super(e)}};_([S()],Xm.prototype,"activeComponent",void 0),Xm=_([re("esri.widgets.Sketch.support.UpdateOperationHandle")],Xm);const XSe="esri.widgets.Sketch.SketchViewModel",txt=Ge.getLogger(XSe),Zhe={defaultZ:0},NI={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let $s=class extends ps.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new Ei,this._internalGraphicsLayer=new i2t({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new Ei,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new cg({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Ag({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new tu({color:[130,130,130,1],width:2}),this._snappingManager=null,this.updateGraphics=new kt,this.updateOnGraphicClick=!0,this.updatePointSymbol=new cg({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new Ag({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new tu({color:[12,207,255],width:2}),this.vertexSymbol=new cg({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Zhe,this.defaultUpdateOptions=NI,this.snappingOptions=new _K}initialize(){this._handles.add([av(()=>{var e,t;return(e=this.view)==null||(t=e.map)==null?void 0:t.layers},"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),av(()=>{var e;return(e=this.layer)==null?void 0:e.graphics},"change",e=>{if(L(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),vi(()=>{var e,t;return(e=(t=this.layer)==null?void 0:t.elevationInfo)!=null?e:null},e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Oa),vi(()=>this.view,e=>{Ht(this._snappingManager),e&&(this._snappingManager=new km({view:e,options:this.snappingOptions}),e.type==="2d"?import("./editingTools.f0200e22.js"):e.type==="3d"&&(import("./editingTools.70c67b89.js").then(function(t){return t.e}),import("./GraphicsLayerView3D.1442bfb6.js")))},Oa),vi(()=>{var e;return(e=this.view)==null?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})])}destroy(){this.cancel(),this._handles=Ht(this._handles),this._viewHandles=Ht(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=Ht(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return this.view.type==="3d"?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!L(this.activeComponent)||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}set defaultCreateOptions(e){this._set("defaultCreateOptions",ie(ie({},Zhe),e))}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",qe(ie(ie({},NI),e),{reshapeOptions:ie(ie({},NI.reshapeOptions),e==null?void 0:e.reshapeOptions)}))}set snappingOptions(e){L(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){var e;const t=!((e=this.view)==null||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:r,map:s}=t;r&&(t.cursor=null),s&&s.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),e&&this._handles.add(CO(()=>e.ready,r=>{this._viewHandles.removeAll(),r&&this._viewHandles.add(this._generateViewHandles(e))},Oa),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Ql(this._moduleLoaderAbortController),this._viewReadyAbortController=Ql(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:r}=this,s=t.toArray();r.removeMany(s),this.cancel(),this._emitDeleteEvent({graphics:s,tool:i})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),this.state==="disabled")throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),rr();if(L(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Phe(this.view,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if(J(i)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);const r=()=>{if(i===this._operationHandle){const s=this.createGraphic,n=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||s==null||this.layer.add(s),this.emit("create",{graphic:s,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};i.on("complete",r),this._operationHandle=i,this.view.ready&&Oqe(this.view)&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:s}=this;if(s==="disabled")throw r||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),rr();L(this.view.activeTool)&&(this.view.activeTool=null);const n=Array.isArray(e)?e:[e];if(e==null||!n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(l=>l.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!J(l.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._setupUpdateOperation(n,t);this.destroyed||J(a)||no(a)||(Phe(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const t of e)L(t.geometry)&&t.geometry.type!=="mesh"&&!Vo(t.geometry.spatialReference,this.view.spatialReference)&&(Tv(t.geometry.spatialReference,this.view.spatialReference)||_X()||await U6(),t.geometry=mE(t.geometry,this.view.spatialReference));this._endAsyncOperation()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const i=[];this.view.map.allLayers.forEach(s=>{s.type!=="vector-tile"&&s.type!=="imagery"||i.push(s)});const r=await this.view.hitTest(e,{exclude:i});if(r.results.length>0){const s=r.results[0];s.graphic&&t.push(s)}}break;case"3d":{const i=[this.view.map.ground];this.view.map.allLayers.forEach(s=>{s.type==="integrated-mesh"&&i.push(s)});const r=await this.view.hitTest(e,{exclude:i});if(r.results.length>0){const s=r.results[0];(!r.ground.mapPoint||this.view.map.ground.opacity<1||r.ground.distance-Wt(s.distance,0)>-Math.min(3*r.ground.distance,this.view.viewingMode==="global"?ir(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(s)}}}return{screenPoint:e,results:t}}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle.type==="create";if(this.state==="disabled"||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const r=(await t.async(()=>this._getFirstHit(ku(t)))).results;let s=null;if(r.length){for(const n of r)if(n.graphic){const a=n.graphic;if(this.updateGraphics.includes(a)||a.layer===this.layer){t.stopPropagation(),s=a;break}e.type!=="2d"||this._isComponentGraphic(a)||this.state!=="active"||this.cancel()}}else this.state==="active"&&this.cancel();L(s)&&!this.updateGraphics.includes(s)&&await this.update([s],qe(ie({},this.defaultUpdateOptions),{reshapeOptions:ie({},this.defaultUpdateOptions.reshapeOptions)})),this._endAsyncOperation()},ls.WIDGET)]}async _setupCreateOperation(e,t){const i=ie(ie({hasZ:this.view.type==="3d"},this.defaultCreateOptions),t),r=await this._setupDrawGraphicTool(e,this.view,i);return J(r)?null:(this.view.tools.add(r),this.view.activeTool=r,this._setupCreateOperationHandle(r))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView"),null;const r=e!=="rectangle",s=e!=="rectangle";this.snappingOptions.enabledToggled=!1;const n=qe(ie({view:t,mode:e==="rectangle"||e==="circle"?"hybrid":"click"},i),{snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:s,centered:r});return this.view.type==="2d"?this._makeDrawGraphicTool2D(n):this._makeDrawGraphicTool3D(n)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(import("./editingTools.f0200e22.js"));return no(t)||this.destroyed?null:new t.module.DrawGraphicTool2D(qe(ie({},e),{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ixt(e.geometryType)?this.activeFillSymbol:null}))}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(import("./editingTools.70c67b89.js").then(function(i){return i.e}));return no(t)||this.destroyed?null:new t.module.DrawGraphicTool3D(qe(ie({},e),{elevationInfo:this.layer.elevationInfo,snapToScene:!L(this.layer.elevationInfo)||this.layer.elevationInfo.mode==="absolute-height"}))}_setupCreateOperationHandle(e){let t=null;const i=e.forceUniformSize,r=e.centered,s=[this.view.on("key-down",a=>{if(a.key===ns.pan)a.stopPropagation(),a.repeat||(e.enabled=!1);else if(a.key===ns.complete)a.stopPropagation(),e.completeCreateOperation();else if(a.key!==ns.vertexAdd||a.repeat)a.key===ns.undo?(a.stopPropagation(),n.undo()):a.key===ns.redo?(a.stopPropagation(),n.redo()):a.key!==ns.snappingToggle||e.geometryType==="rectangle"||e.geometryType==="circle"||a.repeat?a.key!==ns.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||a.repeat?a.key===ns.center&&(a.repeat||(e.centered=!r,a.stopPropagation())):(e.forceUniformSize=!i,a.stopPropagation()):(this.snappingOptions.enabledToggled=!0,a.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(a.stopPropagation(),e.drawOperation.commitStagedVertex())}},ls.WIDGET),this.view.on("key-up",a=>{a.key===ns.pan?e.enabled=!0:a.key===ns.snappingToggle&&e.geometryType!=="rectangle"&&e.geometryType!=="circle"?(this.snappingOptions.enabledToggled=!1,a.stopPropagation()):a.key!==ns.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?a.key===ns.center&&(e.centered=r,a.stopPropagation()):(e.forceUniformSize=i,a.stopPropagation())},ls.WIDGET),e.on("vertex-add",a=>{switch(t=J(t)?"start":"active",a.operation){case"apply":this.emit("create",{graphic:e.graphic,state:t,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",a=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",a=>{this._set("createGraphic",a.graphic),t="complete",a.aborted?n&&n.cancel():n&&n.complete()}),vi(()=>this._getGraphicSymbolFromTool(e.geometryType),a=>{e.graphicSymbol=a})],n=new ta({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var a;s.forEach(l=>l.remove()),s.length=0,(a=this.view.tools)==null||a.remove(e),e.destroy()},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return n}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:i,view:r}=this,s=qe(ie(ie({tool:this._defaultUpdateTool},this.defaultUpdateOptions),t),{reshapeOptions:ie(ie({},this.defaultUpdateOptions.reshapeOptions),t==null?void 0:t.reshapeOptions)});let n=s.tool;for(const a of e)i.remove(a),i.add(a);if(r.type==="3d"){if(e.length===0)return null;switch(n){case"move":return this._setupMove3DOperation(e,s,r,n);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const a=PI(e[0]);return a===is.SUPPORTED?this._setupReshape3DOperation(e[0],s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${cz(a)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,s,r)}}switch(n){case"move":return this._setupMove2DOperation(e,s,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const a=PI(e[0]);return a===is.SUPPORTED?this._setupTransformOrReshape2DOperation(e,n,s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${cz(a)}).`),null)}case"transform":if(e.length===1){const a=Ss(e[0].geometry,"type");a!=="point"&&a!=="multipoint"||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,s,r)}}async _setupMove3DOperation(e,t,i,r,s=!1){for(const y of e){const b=o2t(y);if(b!==is.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${cz(b)}).`),null}const n=await this._requireModule(import("./editingTools.70c67b89.js").then(function(y){return y.e}));if(no(n))return n;const a=new n.module.GraphicMoveTool({view:i,enableZ:t.enableZ,snappingManager:this._snappingManager});this.view.tools.add(a),a.graphics.addMany(e),s||this.updateGraphics.addMany(e);const l=[],p=new Xm({activeComponent:a,tool:r,type:"update",onEnd:()=>{var y;l.forEach(b=>b.remove()),l.length=0,(y=this.view.tools)==null||y.remove(a),a.destroyed||a.destroy()},undo:()=>{FI(p,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{kI(p,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:y=>{this.updateGraphics.push(y),a.graphics.push(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const b=this.updateGraphics.indexOf(y);p.history.undo.forEach(x=>x.updates.splice(b,1)),p.history.redo.forEach(x=>x.updates.splice(b,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?a.graphics.remove(y):p.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||r!=="transform")return;const y=this.updateGraphics.getItemAt(0);if(PI(y)!==is.SUPPORTED)return;const b=await this._setupReshape3DOperation(y,t,i,!0);no(b)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(b,t))}});return l.push(...this._getHandlesForComponent(p,t),this.view.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(p,y,t),ls.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(p,y),y.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!0,y.stopPropagation())},ls.WIDGET),i.on("key-up",y=>{y.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!1,y.stopPropagation())},ls.WIDGET)),p}_setupGraphicTransform3DOperation(e,t,i,r=!1){if(e.length===1&&p2t(e[0])===is.SUPPORTED){const s=e[0],n=s.geometry;if(L(n)&&(n.type==="point"||n.type==="mesh"))return this._setupPointTransform3DOperation(s,t,i);if(L(n)&&(n.type==="polygon"||n.type==="polyline"))return this._setupPolyTransform3DOperation(s,t,i,r)}return this._setupMove3DOperation(e,t,i,"transform",r)}async _setupPointTransform3DOperation(e,t,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:a}=t,l=await this._requireModule(import("./editingTools.70c67b89.js").then(function(x){return x.e}));if(no(l))return l;const p=new l.module.GraphicTransformTool({graphic:e,view:i,enableRotation:s,enableScaling:n,enableZ:a,snappingManager:this._snappingManager});this.view.tools.add(p),this.updateGraphics.add(e);const y=[],b=new Xm({activeComponent:p,tool:r,type:"update",onEnd:()=>{var x;y.forEach(A=>A.remove()),y.length=0,(x=this.view.tools)==null||x.remove(p),p.destroyed||p.destroy()},undo:()=>{FI(b,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{kI(b,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async x=>{this.updateGraphics.add(x),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[x],removed:[],type:"selection-change"},type:"update"});const A=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);no(A)||(b.onEnd(),b.destroy(),this._setUpdateOperationHandle(A,t))},removeFromSelection:x=>{this.updateGraphics.remove(x),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[x],type:"selection-change"},type:"update"}),b.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(b,t),this.view.on("immediate-click",x=>this._getCommonUpdateOperationClickHandlers(b,x,t),ls.WIDGET),i.on("key-down",x=>{this._getCommonUpdateOperationKeyDownHandlers(b,x),x.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!0,x.stopPropagation())},ls.WIDGET),i.on("key-up",x=>{x.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!1,x.stopPropagation())},ls.WIDGET)),b}async _setupPolyTransform3DOperation(e,t,i,r=!1){const s="transform",{enableRotation:n,enableScaling:a,enableZ:l,preserveAspectRatio:p}=t,y=await this._requireModule(import("./editingTools.70c67b89.js").then(function(M){return M.e}));if(no(y))return y;const b=new y.module.ExtentTransformTool({graphic:e,view:i,enableRotation:n,enableScaling:a,enableZ:l,preserveAspectRatio:p});this.view.tools.add(b),r||this.updateGraphics.add(e);const x=[],A=new Xm({activeComponent:b,tool:s,type:"update",onEnd:()=>{var M;x.forEach(P=>P.remove()),x.length=0,(M=this.view.tools)==null||M.remove(b),b.destroyed||b.destroy()},canUndo:()=>b.canUndo,undo:()=>{b.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>b.canRedo,redo:()=>{b.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async M=>{this.updateGraphics.add(M),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[M],removed:[],type:"selection-change"},type:"update"});const P=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);no(P)||(A.onEnd(),A.destroy(),this._setUpdateOperationHandle(P,t))},removeFromSelection:M=>{this.updateGraphics.remove(M),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[M],type:"selection-change"},type:"update"}),A.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const M=this.updateGraphics.getItemAt(0);if(PI(M)!==is.SUPPORTED)return;const P=await this._setupReshape3DOperation(M,t,i,!0);no(P)||(A.onEnd(),A.destroy(),this._setUpdateOperationHandle(P,t))}});return x.push(...this._getHandlesForComponent(A,t),this.view.on("immediate-click",M=>this._getCommonUpdateOperationClickHandlers(A,M,t),ls.WIDGET),this.view.on("key-down",M=>this._getCommonUpdateOperationKeyDownHandlers(A,M),ls.WIDGET),this.view.on("key-down",M=>{M.key!==ns.constraint||M.repeat||(b.preserveAspectRatio=!b.preserveAspectRatio,M.stopPropagation())},ls.WIDGET),this.view.on("key-up",M=>{M.key===ns.constraint&&(b.preserveAspectRatio=!b.preserveAspectRatio,M.stopPropagation())},ls.WIDGET)),A}async _setupMove2DOperation(e,t,i){const r="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const s=await this._getGraphicMover(e,t,i);if(no(s))return s;const n=new Xm({activeComponent:s,tool:r,type:"update",onEnd:()=>{var y;this._displayDefaultCursor(),p.forEach(b=>b.remove()),l.forEach(b=>b.remove()),p=[],l=[],s.destroy(),(y=this._internalGraphicsLayer)==null||y.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const y=this.updateGraphics.toArray();FI(n,y),n.refreshComponent(),this._emitUndoEvent({graphics:y,tool:r})},redo:()=>{const y=this.updateGraphics.toArray();kI(n,y),n.refreshComponent(),this._emitRedoEvent({graphics:y,tool:r})},addToSelection:async y=>{await this._updateSpatialReference(y),this.updateGraphics.push(y),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const b=this.updateGraphics.indexOf(y);n.history.undo.forEach(A=>A.updates.splice(b,1)),n.history.redo.forEach(A=>A.updates.splice(b,1)),this.updateGraphics.remove(y);const x=this.updateGraphics.toArray();this.emit("update",{graphics:x,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?s.graphics=x:n.complete()}});let a=!1,l=[i.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(n,y,t),ls.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(n,y),y.key!==ns.constraint||y.repeat||(a=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},ls.WIDGET),i.on("key-up",y=>{y.key===ns.constraint&&a&&(a=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},ls.WIDGET)],p=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(e,t,i,r=!1){const s="reshape",n=await this._requireModule(import("./editingTools.70c67b89.js").then(function(y){return y.e}));if(no(n))return n;this.snappingOptions.enabledToggled=!1;const a=new n.module.GraphicReshapeTool({view:i,graphic:e,enableZVertex:t.enableZ&&t.reshapeOptions.vertexOperation==="move",enableZShape:t.enableZ&&t.reshapeOptions.shapeOperation==="move",enableMoveGraphic:t.reshapeOptions.shapeOperation==="move"||t.reshapeOptions.shapeOperation==="move-xy",enableMidpoints:t.reshapeOptions.edgeOperation==="split",enableEdgeOffset:t.reshapeOptions.edgeOperation==="offset",snappingManager:this._snappingManager});i.tools.add(a),r||this.updateGraphics.add(e);const l=[],p=new Xm({activeComponent:a,tool:s,type:"update",onEnd:()=>{var y;l.forEach(b=>b.remove()),l.length=0,(y=this.view.tools)==null||y.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async y=>{this.updateGraphics.add(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"});const b=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);no(b)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(b,t))},removeFromSelection:y=>{this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),p.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;const y=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);no(y)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(y,t))}});return l.push(...this._getHandlesForComponent(p,t),i.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(p,y,t),ls.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(p,y),y.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!0,y.stopPropagation())},ls.WIDGET),i.on("key-up",y=>{y.key===ns.snappingToggle&&(this.snappingOptions.enabledToggled=!1,y.stopPropagation())},ls.WIDGET)),p}async _setupTransformOrReshape2DOperation(e,t,i,r){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const s=t==="transform"?await this._getBox(e,i,r):await this._getReshape(e,i,r);if(no(s))return s;const n=new Xm({activeComponent:s,type:"update",onEnd:()=>{l.forEach(p=>p.remove()),a.forEach(p=>p.remove()),l=[],a=[],n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{FI(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{kI(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async p=>{let y=n.activeComponent;if(y.type==="reshape"){const b=[...this.updateGraphics,p];this.updateGraphics.removeAll();const x=await this._setupMove2DOperation(b,i,r);if(no(x))return;n.onEnd(),n.destroy(),this._setUpdateOperationHandle(x,i)}else this.updateGraphics.add(p),y=y,y.graphics=this.updateGraphics.toArray(),y.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const y=this.updateGraphics.indexOf(p);n.history.undo.forEach(x=>x.updates.splice(y,1)),n.history.redo.forEach(x=>x.updates.splice(y,1)),this.updateGraphics.remove(p);const b=this.updateGraphics.toArray();if(b.length===0)n.complete();else{const x=b[0].geometry;b.length!==1||!L(x)||x.type!=="point"&&x.type!=="multipoint"?n.activeComponent.graphics=b:n.toggleTool()}this.emit("update",{graphics:b,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.getItemAt(0),y=p.geometry;if(L(y)&&(n.tool==="reshape"&&(y.type==="point"||y.type==="multipoint")||n.tool==="transform"&&y.type==="extent"))return;let b=null;n.tool==="transform"?b=await this._getReshape([p],i,r):n.tool==="reshape"&&(b=await this._getBox([p],i,r)),no(b)||(n.activeComponent.destroy(),n.activeComponent=b,n.activeComponent&&(l.forEach(x=>x.remove()),l=this._getHandlesForComponent(n,i)))}});let a=[r.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(n,p,i),ls.WIDGET),r.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,p),p.key!==ns.snappingToggle||p.repeat||(this.snappingOptions.enabledToggled=!0,p.stopPropagation()),p.key===ns.constraint&&!p.repeat&&n){const y=n.activeComponent;y&&y.type==="box"&&(y.preserveAspectRatio=!y.preserveAspectRatio)}},ls.WIDGET),r.on("key-up",p=>{var y;if(p.key===ns.snappingToggle&&(n==null||(y=n.activeComponent)==null?void 0:y.type)==="reshape"&&(this.snappingOptions.enabledToggled=!1,p.stopPropagation()),p.key===ns.constraint&&n){const b=n.activeComponent;b&&b.type==="box"&&(b.preserveAspectRatio=!b.preserveAspectRatio)}},ls.WIDGET)],l=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:r}=t,s=await this._requireModule(import("./GraphicMover.fdd00006.js").then(function(n){return n.G}));return no(s)?s:new s.module.default({enableMoveAllGraphics:r,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:n,dy:a,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:a,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:n,dy:a,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:a,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:n,dy:a,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:a,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:r,enableScaling:s,preserveAspectRatio:n}=t,a=await this._requireModule(import("./Box.37d1d466.js"));return no(a)?a:new a.module.default({graphics:e,enableRotation:r,enableScaling:s,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:i,callbacks:{onMoveStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onMove:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onMoveStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onScaleStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onScale:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onScaleStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onRotateStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onRotate:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"}),onRotateStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},l),type:"update"})}})}async _getReshape(e,t,i){var r,s;const n=((r=t.reshapeOptions)==null?void 0:r.edgeOperation)==="split",a=((s=t.reshapeOptions)==null?void 0:s.shapeOperation)==="move",l=await this._requireModule(import("./Reshape.30758904.js"));return no(l)?l:new l.module.default({enableMidpoints:n,enableMovement:a,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:i,callbacks:{onReshapeStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},p),type:"update"}),onReshape:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:ie({},p),type:"update"}),onReshapeStop:({mover:p,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:p,type:y},type:"update"}),onMoveStart:({dx:p,dy:y,mover:b,type:x})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:y,mover:b,type:x},type:"update"}),onMove:({dx:p,dy:y,mover:b,type:x})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:y,mover:b,type:x},type:"update"}),onMoveStop:({dx:p,dy:y,mover:b,type:x})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:y,mover:b,type:x},type:"update"}),onVertexAdd:({added:p,type:y,vertices:b})=>{const x=p.map(A=>Zee(A.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:x,vertices:b,type:y},type:"update"})},onVertexRemove:({removed:p,type:y,vertices:b})=>{const x=p.map(A=>Zee(A.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:x,vertices:b,type:y},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:r,viewEvent:s})=>{var n;(n=s.native)!=null&&n.shiftKey&&(s.stopPropagation(),e.removeFromSelection(r))}),i.on("graphic-move-start",r=>e.addToHistory(nm(r.allGraphics)))];case"box":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),i.on("move-start",r=>e.addToHistory(nm(r.graphics))),i.on("rotate-start",r=>e.addToHistory(nm(r.graphics))),i.on("scale-start",r=>e.addToHistory(nm(r.graphics)))];case"reshape":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),i.on("move-start",r=>e.addToHistory(nm([r.mover]))),i.on("reshape-start",r=>e.addToHistory(nm([r.graphic]))),i.on("vertex-add",r=>e.addToHistory(nm([r.oldGraphic]))),i.on("vertex-remove",r=>e.addToHistory(nm([r.oldGraphic])))];case"move-3d":return[i.on("graphic-move-start",r=>{e.addToHistory(nm(r.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-start"},type:"update"})}),i.on("graphic-move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r.dx,dy:r.dy,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move"},type:"update"})}),i.on("graphic-move-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-stop"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.on("record-undo",({record:r})=>{e.addToHistory({updates:[r]})}),i.on("graphic-translate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-start"},type:"update"})}),i.on("graphic-translate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-stop"},type:"update"})}),i.on("graphic-rotate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-start"},type:"update"})}),i.on("graphic-rotate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-stop"},type:"update"})}),i.on("graphic-scale-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-start"},type:"update"})}),i.on("graphic-scale-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-stop"},type:"update"})}),i.on("graphic-translate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move"},type:"update"})}),i.on("graphic-rotate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate"},type:"update"})}),i.on("graphic-scale",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.on("reshape",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-add",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-remove",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var r;const{graphic:s,viewEvent:n}=i;return(r=n.native)!=null&&r.shiftKey&&s.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(s)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);const r=()=>{if(e===this._operationHandle){const s=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:s,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}};e.on("complete",r)}async _getCommonUpdateOperationClickHandlers(e,t,i){const r=ku(t),s=(await t.async(()=>this._getFirstHit(r))).results;if(!s.length)return void e.complete();if(t.native.shiftKey&&this._toggleSelection(s.map(n=>n.graphic),e,i))return void t.stopPropagation();s.some(n=>n.graphic&&this.updateGraphics.includes(n.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const r=!!i.multipleSelectionEnabled;return e.some(s=>s!=null&&!(!r||s.layer!==this.layer)&&(this.updateGraphics.includes(s)?t.removeFromSelection(s):t.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===ns.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===ns.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===ns.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&ns.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();J(t)||t.type==="reshape-3d"||(t.type!=="reshape"||i.length===1&&Ss(i[0].geometry,"type")==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Ht(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||J(t))&&(e.attributes&&e.attributes.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){txt.error(new Se(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",qe(ie({},e),{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",qe(ie({},e),{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",qe(ie({},e),{type:"delete"}))}test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:NI}}wait(){return qT(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return((t=this.view)==null?void 0:t.type)!=="3d"||this.updateOnGraphicClick||L(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&J(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&L(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const e=this.view;e&&(Ql(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Fq(qT(()=>e==null?void 0:e.ready),this._viewReadyAbortController.signal))}};function ixt(e){return e==="polygon"||e==="rectangle"||e==="circle"}function FI(e,t){YSe("undo",e.history.undo,e.history.redo,t)}function kI(e,t){YSe("redo",e.history.redo,e.history.undo,t)}function YSe(e,t,i,r){const s=t.pop().updates,n=[];r.forEach((a,l)=>{const p=s[l];p!=null&&("geometry"in p&&L(p.geometry)&&(n.push({geometry:a.geometry}),a.geometry=p.geometry),"symbol"in p&&L(p.symbol)&&(n.push({symbol:a.symbol}),a.symbol=p.symbol),"undo"in p&&(n.push(p),p[e](a)))}),i.push({updates:n})}function nm(e){return{updates:e.map(t=>({geometry:t.geometry}))}}function no(e){return"requireError"in e&&e.requireError==="aborted"}_([S()],$s.prototype,"updating",null),_([S()],$s.prototype,"_operationHandle",void 0),_([S({readOnly:!0})],$s.prototype,"activeTool",null),_([S()],$s.prototype,"activeFillSymbol",void 0),_([S()],$s.prototype,"activeLineSymbol",void 0),_([S()],$s.prototype,"activeVertexSymbol",void 0),_([S()],$s.prototype,"allowDeleteKey",void 0),_([S({readOnly:!0})],$s.prototype,"createGraphic",null),_([S()],$s.prototype,"defaultCreateOptions",null),_([S()],$s.prototype,"defaultUpdateOptions",null),_([S()],$s.prototype,"layer",void 0),_([S({types:Lc})],$s.prototype,"pointSymbol",void 0),_([S({types:Lc})],$s.prototype,"polygonSymbol",void 0),_([S({types:Lc})],$s.prototype,"polylineSymbol",void 0),_([S({type:_K,nonNullable:!0})],$s.prototype,"snappingOptions",null),_([S()],$s.prototype,"_snappingManager",void 0),_([S({readOnly:!0})],$s.prototype,"state",null),_([S({readOnly:!0})],$s.prototype,"updateGraphics",void 0),_([S()],$s.prototype,"updateOnGraphicClick",void 0),_([S({types:Lc})],$s.prototype,"updatePointSymbol",void 0),_([S({types:Lc})],$s.prototype,"updatePolygonSymbol",void 0),_([S({types:Lc})],$s.prototype,"updatePolylineSymbol",void 0),_([S({types:Lc})],$s.prototype,"vertexSymbol",void 0),_([S({value:null})],$s.prototype,"view",null),$s=_([re(XSe)],$s);const OEt=$s;class rxt{constructor(t){this.view=t,this.camera=new br,this.sunLight={direction:Q(),ambient:{color:Q(),intensity:1},diffuse:{color:Q(),intensity:1}},this._renderTargetHelper=null}get gl(){return this.rctx.gl}resetWebGLState(){this.rctx!=null&&(this.rctx.enforceState(),this._renderTargetHelper&&this._renderTargetHelper.bindFramebuffer())}bindRenderTarget(){this._renderTargetHelper&&this._renderTargetHelper.framebuffer.initializeAndBind()}}const sxt=Ge.getLogger("esri.views.3d.externalRenderers.ExternalRendererStore");class nxt{constructor(){this._renderers=new kt}add(t,i){this._findOrCreateStageRenderer(t).add(i)}remove(t,i){const r=this._findStageRenderer(t);r&&r.remove(i),r.renderers.length===0&&(r.destroy(),this._renderers.remove(r))}_findStageRenderer(t){return this._renderers.find(i=>i.view===t)}_findOrCreateStageRenderer(t){let i=this._findStageRenderer(t);return i||(i=new oxt(t),this._renderers.add(i)),i}}class oxt{constructor(t){this.view=t,this.canRender=!0,this.renderers=new kt,this._readyWatchHandle=Pi(t,"ready",i=>{i?(this.context=new rxt(this.view),this.view._stage.addRenderPlugin([tt.OPAQUE_PLUGIN,tt.TRANSPARENT_PLUGIN],this)):(this.renderers.forEach(r=>U_(r,"dispose",this.context)),this.context=null)})}destroy(){this.renderers.drain(t=>{this.context&&U_(t,"dispose",this.context)}),this.view._stage&&this.view._stage.removeRenderPlugin(this),this._readyWatchHandle&&(this._readyWatchHandle.remove(),this._readyWatchHandle=null),this.context=null}add(t){this.renderers.indexOf(t)===-1?(this.renderers.add(t),this.context&&(this._webglStateReset(),U_(t,"setup",this.context),this.view._stage.renderView.requestRender())):sxt.warn("add(): Cannot add external renderer: renderer has already been added")}remove(t){const i=this.renderers.indexOf(t);i!==-1&&(this.renderers.removeAt(i),this.context&&(U_(t,"dispose",this.context),this.view._stage.renderView.requestRender()))}initializeRenderContext(t){this.context.rctx=t.renderContext.rctx,this.renderers.length>0&&this._webglStateReset(),this.renderers.forEach(i=>U_(i,"setup",this.context))}uninitializeRenderContext(){}render(t){this.renderers.length===0||t.pass!==bt.MATERIAL||t.slot!==tt.OPAQUE_PLUGIN&&t.slot!==tt.TRANSPARENT_PLUGIN||(this._updateContext(t),this._webglStateReset(),this.renderers.forEach(i=>{switch(t.slot){case tt.OPAQUE_PLUGIN:U_(i,"render",this.context);break;case tt.TRANSPARENT_PLUGIN:U_(i,"renderTransparent",this.context)}}))}_updateContext(t){this.context.camera.copyFrom(t.camera),ke(this.context.sunLight.direction,t.scenelightingData.old.direction),ke(this.context.sunLight.diffuse.color,t.scenelightingData.old.diffuse.color),ke(this.context.sunLight.ambient.color,t.scenelightingData.old.ambient.color),this.context._renderTargetHelper=t.offscreenRenderingHelper}_webglStateReset(){var t;this.context.rctx.resetState(),(t=this.context._renderTargetHelper)==null||t.bindFramebuffer()}get needsTransparentPass(){return this.renderers.some(t=>typeof t.renderTransparent=="function")}}function U_(e,t,i){typeof e[t]=="function"&&e[t](i)}new nxt;function PEt(e,t,i,r,s,n,a){return r=r||e.spatialReference,ys(t,r,i,s,e.renderCoordsHelper.spatialReference,n,a)?s:null}function IEt(e,t,i,r,s,n,a){return n=n||e.spatialReference,ys(t,e.renderCoordsHelper.spatialReference,i,r,n,s,a)?r:null}var axt=1e-6,wO=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function $Et(){var e=new wO(16);return wO!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function DEt(e,t,i,r){var s=r[0],n=r[1],a=r[2],l=Math.hypot(s,n,a),p,y,b,x,A,M,P,$,k,z,G,B,W,q,X,oe,de,he,fe,me,ge,Ce,Ae,Pe;return l<axt?null:(l=1/l,s*=l,n*=l,a*=l,p=Math.sin(i),y=Math.cos(i),b=1-y,x=t[0],A=t[1],M=t[2],P=t[3],$=t[4],k=t[5],z=t[6],G=t[7],B=t[8],W=t[9],q=t[10],X=t[11],oe=s*s*b+y,de=n*s*b+a*p,he=a*s*b-n*p,fe=s*n*b-a*p,me=n*n*b+y,ge=a*n*b+s*p,Ce=s*a*b+n*p,Ae=n*a*b-s*p,Pe=a*a*b+y,e[0]=x*oe+$*de+B*he,e[1]=A*oe+k*de+W*he,e[2]=M*oe+z*de+q*he,e[3]=P*oe+G*de+X*he,e[4]=x*fe+$*me+B*ge,e[5]=A*fe+k*me+W*ge,e[6]=M*fe+z*me+q*ge,e[7]=P*fe+G*me+X*ge,e[8]=x*Ce+$*Ae+B*Pe,e[9]=A*Ce+k*Ae+W*Pe,e[10]=M*Ce+z*Ae+q*Pe,e[11]=P*Ce+G*Ae+X*Pe,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function lxt(){var e=new wO(3);return wO!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function LEt(e){var t=e[0],i=e[1],r=e[2];return Math.hypot(t,i,r)}function NEt(e,t,i){var r=new wO(3);return r[0]=e,r[1]=t,r[2]=i,r}function FEt(e,t){var i=t[0],r=t[1],s=t[2],n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function kEt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function UEt(e,t,i){var r=t[0],s=t[1],n=t[2],a=i[0],l=i[1],p=i[2];return e[0]=s*p-n*l,e[1]=n*a-r*p,e[2]=r*l-s*a,e}function zEt(e,t,i){var r=t[0],s=t[1],n=t[2],a=i[3]*r+i[7]*s+i[11]*n+i[15];return a=a||1,e[0]=(i[0]*r+i[4]*s+i[8]*n+i[12])/a,e[1]=(i[1]*r+i[5]*s+i[9]*n+i[13])/a,e[2]=(i[2]*r+i[6]*s+i[10]*n+i[14])/a,e}(function(){var e=lxt();return function(t,i,r,s,n,a){var l,p;for(i||(i=3),r||(r=0),s?p=Math.min(s*i+r,t.length):p=t.length,l=r;l<p;l+=i)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],n(e,e,a),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2];return t}})();export{Cs as $,kt as A,i2t as B,OEt as C,cc as D,mEt as E,xge as F,Ve as G,qT as H,t0 as I,_ as J,L as K,fE as L,J as M,bve as N,Vi as O,No as P,U6 as Q,NL as R,Ag as S,UM as T,kq as U,Ht as V,rte as W,xv as X,mE as Y,OS as Z,yVe as _,UO as a,sxe as a$,DSt as a0,LSt as a1,JO as a2,crt as a3,Rg as a4,ql as a5,vi as a6,Oa as a7,Hp as a8,ASt as a9,uS as aA,rve as aB,Wt as aC,jr as aD,tX as aE,ke as aF,u0 as aG,pd as aH,Q as aI,On as aJ,zv as aK,ki as aL,AS as aM,Ci as aN,ISt as aO,PSt as aP,XSt as aQ,gZ as aR,OSt as aS,RSt as aT,BX as aU,m0 as aV,W6 as aW,Pi as aX,SE as aY,ii as aZ,_o as a_,USt as aa,Se as ab,iVe as ac,Vje as ad,WL as ae,Gje as af,jje as ag,hX as ah,fve as ai,e6e as aj,XTt as ak,ps as al,SSt as am,jLe as an,za as ao,g0 as ap,Lut as aq,fst as ar,nh as as,Gi as at,Iq as au,je as av,b3t as aw,Ge as ax,_d as ay,ma as az,PEt as b,Lp as b$,bo as b0,rn as b1,$xt as b2,Gh as b3,Fo as b4,gv as b5,Ss as b6,yp as b7,ze as b8,Ho as b9,p3t as bA,lv as bB,nte as bC,QW as bD,rdt as bE,ir as bF,CEt as bG,vxt as bH,tue as bI,Qhe as bJ,GTt as bK,jTt as bL,sHe as bM,SS as bN,Ar as bO,ha as bP,Gn as bQ,Fe as bR,RL as bS,fN as bT,Ui as bU,d0 as bV,yke as bW,jVe as bX,R0 as bY,YFe as bZ,Kh as b_,Xe as ba,Ue as bb,Gt as bc,Uh as bd,A5 as be,TSt as bf,Ote as bg,vSt as bh,gst as bi,qL as bj,Tv as bk,uxt as bl,Rw as bm,Nut as bn,eZ as bo,Np as bp,MY as bq,Hn as br,EO as bs,Mi as bt,w3e as bu,w3t as bv,ys as bw,tN as bx,oSt as by,bv as bz,lxt as c,LN as c$,Lje as c0,Nje as c1,Fje as c2,GLe as c3,cSt as c4,h0e as c5,lh as c6,Fq as c7,Fg as c8,Bv as c9,Tw as cA,cpt as cB,Ir as cC,da as cD,V as cE,Ws as cF,Yn as cG,nu as cH,Te as cI,ND as cJ,P0 as cK,su as cL,ht as cM,Oe as cN,Fr as cO,Qt as cP,Rs as cQ,Ur as cR,Xr as cS,$r as cT,mr as cU,hh as cV,Jg as cW,I0 as cX,kw as cY,Ti as cZ,Zg as c_,Hc as ca,$ft as cb,Pft as cc,Dft as cd,av as ce,SO as cf,zn as cg,Jm as ch,H2 as ci,$c as cj,BL as ck,ws as cl,Y as cm,w2 as cn,YL as co,ur as cp,ka as cq,rr as cr,Cxt as cs,Ni as ct,Sn as cu,ei as cv,Tn as cw,JS as cx,aSt as cy,o9 as cz,S as d,QG as d$,Jv as d0,ac as d1,e8 as d2,Ii as d3,b0 as d4,kv as d5,Kv as d6,r8 as d7,Sd as d8,Wp as d9,Zmt as dA,pTe as dB,F3t as dC,tMe as dD,Txt as dE,wxt as dF,aMe as dG,lMe as dH,JL as dI,_ot as dJ,pfe as dK,G_e as dL,lJ as dM,nEt as dN,uEt as dO,B_e as dP,i4 as dQ,a0 as dR,yv as dS,Ms as dT,nr as dU,zs as dV,Ct as dW,u0e as dX,wt as dY,us as dZ,HTt as d_,t8 as da,KN as db,tt as dc,fw as dd,p8 as de,Zst as df,HJ as dg,oE as dh,zg as di,Vrt as dj,Bn as dk,rN as dl,Da as dm,Z8 as dn,kfe as dp,e3t as dq,L$e as dr,zGe as ds,GT as dt,V3e as du,Qh as dv,wDe as dw,kp as dx,lt as dy,Grt as dz,fEt as e,TO as e$,Yje as e0,aHe as e1,sve as e2,AVe as e3,nve as e4,kL as e5,ti as e6,Zje as e7,VL as e8,lte as e9,k3t as eA,Go as eB,bg as eC,fl as eD,pE as eE,wi as eF,Pye as eG,Iye as eH,CSt as eI,mX as eJ,h6e as eK,zF as eL,Ot as eM,ar as eN,Iw as eO,n3t as eP,Ye as eQ,MX as eR,yt as eS,au as eT,es as eU,dEt as eV,hSt as eW,YT as eX,Pr as eY,A3t as eZ,nd as e_,Hh as ea,g0e as eb,Gc as ec,Kg as ed,U3e as ee,gL as ef,L2 as eg,wLe as eh,Ts as ei,dSt as ej,hEt as ek,jN as el,mS as em,GV as en,z2e as eo,ch as ep,Fgt as eq,DE as er,D3t as es,pgt as et,UT as eu,S2 as ev,As as ew,gLe as ex,md as ey,yg as ez,kO as f,U6e as f$,JR as f0,cu as f1,MSt as f2,Dbe as f3,Yl as f4,_rt as f5,cEt as f6,ev as f7,ONe as f8,wo as f9,Vv as fA,NSe as fB,EY as fC,sVe as fD,dz as fE,AEt as fF,MEt as fG,Whe as fH,Nb as fI,cS as fJ,dL as fK,QS as fL,Vo as fM,hxt as fN,Kxt as fO,pK as fP,TEt as fQ,SEt as fR,EEt as fS,TPe as fT,Tde as fU,rX as fV,W2 as fW,fR as fX,I_t as fY,zy as fZ,Xh as f_,Er as fa,rt as fb,dl as fc,We as fd,W9 as fe,Yf as ff,u6e as fg,lSt as fh,ppt as fi,E3t as fj,Tg as fk,nNe as fl,oNe as fm,Et as fn,L3t as fo,hr as fp,$q as fq,V9e as fr,X9e as fs,b2 as ft,l1e as fu,Lfe as fv,LO as fw,$I as fx,Jxt as fy,ml as fz,gl as g,Do as g$,eS as g0,EL as g1,Ipe as g2,ih as g3,T3t as g4,VO as g5,vE as g6,Yge as g7,bSt as g8,BGe as g9,Kye as gA,wnt as gB,Pc as gC,Xt as gD,Mme as gE,U3t as gF,_ge as gG,FSt as gH,$L as gI,cTt as gJ,fxt as gK,To as gL,vZ as gM,rc as gN,Rr as gO,_ue as gP,Dfe as gQ,Axt as gR,S3t as gS,Mp as gT,ote as gU,gTt as gV,NTt as gW,sX as gX,Eg as gY,wH as gZ,_r as g_,qTt as ga,S5e as gb,tTt as gc,o3t as gd,t3t as ge,r3t as gf,i3t as gg,s3t as gh,hR as gi,hd as gj,D$e as gk,CO as gl,ywe as gm,gSt as gn,ort as go,wSt as gp,g3t as gq,Sxt as gr,iEt as gs,d3t as gt,zL as gu,vt as gv,GFe as gw,xSt as gx,gs as gy,Gge as gz,st as h,VLe as h$,iTt as h0,rTt as h1,or as h2,sEt as h3,oEt as h4,y3t as h5,w6e as h6,Rb as h7,rEt as h8,UD as h9,ege as hA,due as hB,mD as hC,N4 as hD,La as hE,Va as hF,xY as hG,DBe as hH,Yi as hI,Y3 as hJ,MT as hK,wg as hL,bL as hM,vX as hN,F9e as hO,$t as hP,uee as hQ,jT as hR,Tge as hS,jle as hT,bhe as hU,_X as hV,EV as hW,en as hX,SV as hY,CV as hZ,F6 as h_,qp as ha,Yg as hb,kr as hc,jo as hd,Zt as he,x3t as hf,KO as hg,fr as hh,er as hi,Na as hj,p0e as hk,aEt as hl,lEt as hm,eX as hn,TNe as ho,bt as hp,D0 as hq,QL as hr,Nv as hs,mi as ht,In as hu,Fi as hv,tr as hw,WSt as hx,Uge as hy,kFe as hz,$Et as i,N5e as i$,Vt as i0,_t as i1,ai as i2,M2 as i3,V0e as i4,qf as i5,KSt as i6,tEt as i7,z3e as i8,Lle as i9,u2t as iA,YLe as iB,e2t as iC,Yxt as iD,XLe as iE,ot as iF,si as iG,J2 as iH,St as iI,Jh as iJ,N3t as iK,qxt as iL,ds as iM,Wxt as iN,ug as iO,tB as iP,XS as iQ,xi as iR,wp as iS,j0e as iT,qDe as iU,$3t as iV,ga as iW,Xg as iX,qs as iY,F2 as iZ,zSt as i_,ZSt as ia,QSt as ib,JSt as ic,rL as id,R9 as ie,vft as ig,Pt as ih,sc as ii,Oxt as ij,hZ as ik,Ju as il,$le as im,Ypt as io,Jpt as ip,_i as iq,mn as ir,HW as is,GW as it,jW as iu,bfe as iv,LD as iw,iSt as ix,Fp as iy,O8e as iz,kEt as j,Kae as j$,Pxt as j0,dn as j1,P3t as j2,O3t as j3,tLe as j4,QDe as j5,hpe as j6,I3t as j7,xV as j8,Fs as j9,$y as jA,dNe as jB,Pn as jC,zl as jD,tW as jE,lg as jF,$2 as jG,kg as jH,PX as jI,yS as jJ,Kr as jK,Uwt as jL,go as jM,bs as jN,wM as jO,nN as jP,W3t as jQ,WT as jR,X3t as jS,fXe as jT,vXe as jU,c2t as jV,bEt as jW,t2t as jX,Qc as jY,on as jZ,Ixt as j_,OR as ja,ca as jb,uN as jc,Q3t as jd,eTt as je,Z3t as jf,K3t as jg,kh as jh,Wl as ji,XY as jj,$N as jk,J$e as jl,Ns as jm,Wn as jn,Tt as jo,Xxt as jp,$9e as jq,nn as jr,Qg as js,Jc as jt,kZ as ju,Qdt as jv,lT as jw,MH as jx,yw as jy,yr as jz,It as k,qFe as k$,ZL as k0,pxt as k1,H3t as k2,ua as k3,Ym as k4,z3t as k5,Ube as k6,HTe as k7,V6 as k8,r_t as k9,C0 as kA,TX as kB,yme as kC,p0 as kD,fa as kE,Yv as kF,i8 as kG,QN as kH,Kt as kI,Cr as kJ,h4 as kK,v3t as kL,rme as kM,dS as kN,MNe as kO,Cae as kP,yl as kQ,MYe as kR,B3t as kS,eL as kT,th as kU,vR as kV,n8e as kW,Cg as kX,aN as kY,lu as kZ,gke as k_,vhe as ka,Yq as kb,qn as kc,m3t as kd,f3t as ke,Ql as kf,F1 as kg,vz as kh,Pw as ki,dLe as kj,zO as kk,T0 as kl,NW as km,Xu as kn,M0 as ko,br as kp,Ose as kq,Uq as kr,drt as ks,Ow as kt,OX as ku,A2 as kv,h3t as kw,j3t as kx,v0 as ky,Rse as kz,Ft as l,vEt as l$,wpe as l0,iE as l1,iGe as l2,rje as l3,uje as l4,OY as l5,yft as l6,aR as l7,jv as l8,JGe as l9,Nxt as lA,xO as lB,ML as lC,Uxt as lD,ZO as lE,ZVe as lF,kxt as lG,hE as lH,cg as lI,tu as lJ,Ng as lK,hXe as lL,T$ as lM,H0t as lN,eTe as lO,Hv as lP,mYe as lQ,kW as lR,Zxt as lS,Dbt as lT,K9e as lU,Ebt as lV,d2t as lW,RR as lX,Oqe as lY,Jit as lZ,_Et as l_,j9 as la,xxt as lb,nVe as lc,Rxt as ld,YSt as le,Ys as lf,apt as lg,$3e as lh,WFe as li,TN as lj,$ye as lk,cd as ll,WBe as lm,dd as ln,Epe as lo,qr as lp,jn as lq,yxt as lr,Zc as ls,om as lt,zz as lu,spe as lv,sue as lw,bT as lx,p6 as ly,mpe as lz,pEt as m,Rz as m$,bK as m0,jp as m1,vK as m2,iF as m3,tF as m4,Ip as m5,Zee as m6,sS as m7,iK as m8,Xv as m9,wat as mA,bat as mB,uSe as mC,$St as mD,r2t as mE,yEt as mF,_xt as mG,_3t as mH,d0e as mI,u3t as mJ,q3t as mK,ah as mL,o2t as mM,is as mN,CX as mO,nSt as mP,Rn as mQ,Mse as mR,wEt as mS,PI as mT,_v as mU,qc as mV,SNe as mW,QRe as mX,oXe as mY,aXe as mZ,yE as m_,OJ as ma,qo as mb,N2e as mc,V3t as md,ytt as me,Ga as mf,fJ as mg,G3t as mh,VKe as mi,iu as mj,mSt as mk,pSt as ml,fSt as mm,ld as mn,wNe as mo,jc as mp,Vp as mq,H2e as mr,qS as ms,XT as mt,YJ as mu,bxt as mv,zSe as mw,REt as mx,Gp as my,mJ as mz,LEt as n,ite as n$,pS as n0,J8 as n1,YTt as n2,U_e as n3,z_e as n4,xEt as n5,dqe as n6,Phe as n7,ms as n8,ku as n9,RLe as nA,GSt as nB,IS as nC,pw as nD,BSt as nE,jSt as nF,sLe as nG,VSt as nH,blt as nI,Slt as nJ,wlt as nK,xlt as nL,Tlt as nM,e1e as nN,Jge as nO,nTt as nP,fTt as nQ,pTt as nR,Qge as nS,dve as nT,J3t as nU,YX as nV,h1e as nW,u1e as nX,c1e as nY,uTt as nZ,hTt as n_,ls as na,F8e as nb,Z9e as nc,ns as nd,J2t as ne,OSe as nf,Ghe as ng,Oq as nh,W2t as ni,X2t as nj,Y2t as nk,ISe as nl,Q2t as nm,ewt as nn,dr as no,$Se as np,x$e as nq,c0 as nr,i2 as ns,z6 as nt,Qz as nu,Vze as nv,gn as nw,g4 as nx,TV as ny,SZ as nz,UEt as o,Qze as o$,a3t as o0,l3t as o1,c3t as o2,TOe as o3,_St as o4,fG as o5,ySt as o6,ec as o7,C7e as o8,gVe as o9,M3t as oA,C3t as oB,pPe as oC,vW as oD,eEt as oE,Fc as oF,Lq as oG,Dle as oH,Bl as oI,Vl as oJ,Ra as oK,rh as oL,O0 as oM,b9 as oN,TR as oO,_Y as oP,sD as oQ,eR as oR,G3 as oS,xn as oT,uBe as oU,cv as oV,ul as oW,cBe as oX,fd as oY,sBe as oZ,eBe as o_,p$e as oa,h7e as ob,yTt as oc,w7e as od,fie as oe,Zge as of,woe as og,mTt as oh,IDe as oi,LTt as oj,ese as ok,_R as ol,h7 as om,u7 as on,yz as oo,Wu as op,WCe as oq,mxt as or,gxt as os,kc as ot,sTt as ou,Uc as ov,dTt as ow,mN as ox,Bi as oy,Hy as oz,FEt as p,Gxt as p$,K2 as p0,Fh as p1,vye as p2,kke as p3,Wze as p4,Jze as p5,Di as p6,yye as p7,Wh as p8,hBe as p9,oY as pA,_Q as pB,ITt as pC,Zze as pD,Kze as pE,Yze as pF,Xze as pG,J3 as pH,SVe as pI,FTt as pJ,$Tt as pK,vPe as pL,TVe as pM,uE as pN,kTt as pO,HSt as pP,jlt as pQ,mR as pR,gM as pS,oV as pT,UTt as pU,Hxt as pV,Vxt as pW,zxt as pX,Gpe as pY,IIe as pZ,jxt as p_,nBe as pa,$w as pb,dBe as pc,pBe as pd,fBe as pe,yY as pf,gBe as pg,mBe as ph,yBe as pi,wW as pj,xR as pk,Gze as pl,lBe as pm,oBe as pn,tBe as po,ABe as pp,TBe as pq,xBe as pr,MTt as ps,SBe as pt,EBe as pu,iBe as pv,rBe as pw,Nq as px,aBe as py,bBe as pz,NEt as q,Vc as q$,Bxt as q0,Nmt as q1,oge as q2,e8e as q3,Ma as q4,Bve as q5,gWe as q6,qSe as q7,Q8 as q8,Bwt as q9,Bgt as qA,H1t as qB,$j as qC,e5 as qD,VF as qE,C6e as qF,lJe as qG,kwe as qH,nst as qI,eSt as qJ,QTt as qK,ZTt as qL,W3 as qM,zHe as qN,KTt as qO,tSt as qP,kHe as qQ,NO as qR,Hot as qS,rSt as qT,sSt as qU,VTt as qV,ou as qW,Ant as qX,Op as qY,VD as qZ,znt as q_,p5 as qa,q9e as qb,SM as qc,c2 as qd,gK as qe,DXe as qf,BYe as qg,id as qh,fJe as qi,_Je as qj,zp as qk,wJe as ql,Vh as qm,zJe as qn,YJe as qo,ewe as qp,hit as qq,FD as qr,Sot as qs,Mot as qt,eot as qu,Kl as qv,dot as qw,hmt as qx,gmt as qy,vTe as qz,DEt as r,ZT as r$,_1t as r0,aa as r1,Dg as r2,L1t as r3,W8 as r4,Pp as r5,K1t as r6,Lg as r7,eyt as r8,gW as r9,wv as rA,dWe as rB,cWe as rC,fse as rD,nc as rE,cR as rF,ZGe as rG,hc as rH,XL as rI,aje as rJ,UGe as rK,VGe as rL,_je as rM,ete as rN,Ffe as rO,Wje as rP,ove as rQ,UY as rR,Gre as rS,F9 as rT,Gye as rU,YGe as rV,zY as rW,vve as rX,Nye as rY,oi as rZ,Sw as r_,fu as ra,_lt as rb,NSt as rc,vnt as rd,Tyt as re,Xst as rf,Nat as rg,Alt as rh,zht as ri,lut as rj,iut as rk,ive as rl,uve as rm,gje as rn,r0e as ro,XVe as rp,dX as rq,WTt as rr,KGe as rs,eje as rt,KVe as ru,IY as rv,eGe as rw,tGe as rx,Ahe as ry,Ehe as rz,IEt as s,j0t as s$,_z as s0,lTt as s1,O7e as s2,M7e as s3,BOe as s4,rHe as s5,XO as s6,Wr as s7,IBe as s8,Tye as s9,dxt as sA,MVe as sB,U9 as sC,kre as sD,lS as sE,CY as sF,ije as sG,tje as sH,rE as sI,k0e as sJ,zTt as sK,nE as sL,Lxt as sM,a_t as sN,QGe as sO,BTt as sP,b9e as sQ,Mxt as sR,ce as sS,R3t as sT,kSt as sU,O0t as sV,sTe as sW,tTe as sX,wb as sY,JZ as sZ,YZ as s_,Sye as sa,Mye as sb,tqe as sc,XBe as sd,iqe as se,zye as sf,aD as sg,Dxt as sh,xye as si,lD as sj,QVe as sk,DO as sl,Qxt as sm,Ext as sn,Y3t as so,Uv as sp,iW as sq,t3 as sr,tHe as ss,Nh as st,g6 as su,Qee as sv,l0 as sw,o0 as sx,Kfe as sy,Lc as sz,zEt as t,zPe as t$,vTt as t0,ZZ as t1,Uje as t2,zje as t3,Bje as t4,Owt as t5,vwt as t6,RTt as t7,CTt as t8,ere as t9,gYe as tA,Fxt as tB,t3e as tC,r3e as tD,GM as tE,Qb as tF,So as tG,lc as tH,vd as tI,vx as tJ,Klt as tK,Jxe as tL,e3e as tM,Kxe as tN,Zlt as tO,IH as tP,Qxe as tQ,Pv as tR,Wlt as tS,Ov as tT,bH as tU,ow as tV,bst as tW,Act as tX,Ect as tY,Sct as tZ,uSt as t_,_Tt as ta,Qie as tb,_Be as tc,ATt as td,PTt as te,OTt as tf,Z2 as tg,wTt as th,bTt as ti,xTt as tj,TTt as tk,ETt as tl,qze as tm,ire as tn,STt as to,vBe as tp,xN as tq,bye as tr,wye as ts,x0 as tt,AYe as tu,uNe as tv,cNe as tw,Jf as tx,jxe as ty,yde as tz,jy as u,oTt as u0,aTt as u1,DTt as u2,JTt as u3,ESt as u4,qSt as u5,gEt as u6,uK as u7,Fa as v,HL as w,re as x,Ei as y,Mw as z};
