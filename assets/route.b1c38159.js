var K=Object.defineProperty,V=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var D=(s,t,i)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,T=(s,t)=>{for(var i in t||(t={}))Z.call(t,i)&&D(s,i,t[i]);if(k)for(var i of k(t))z.call(t,i)&&D(s,i,t[i]);return s},L=(s,t)=>V(s,W(t));import{I as a,d as f,eC as C,g as $,u as q,eF as F,dJ as E,kQ as G,fC as H,bN as U,J as O}from"./vendor.d1b93dad.js";import{a as X,i as j,u as Y,f as _,d as ee,o as te}from"./NAMessage.e6b76703.js";import{c as re}from"./DirectionsFeatureSet.b4eac167.js";let g=class extends F{constructor(s){super(s),this.directionLines=null,this.directionPoints=null,this.directions=null,this.route=null,this.routeName=null,this.stops=null}};a([f({type:C,json:{write:!0}})],g.prototype,"directionLines",void 0),a([f({type:C,json:{write:!0}})],g.prototype,"directionPoints",void 0),a([f({type:re,json:{write:!0}})],g.prototype,"directions",void 0),a([f({type:$,json:{write:!0}})],g.prototype,"route",void 0),a([f({type:String,json:{write:!0}})],g.prototype,"routeName",void 0),a([f({type:[$],json:{write:!0}})],g.prototype,"stops",void 0),g=a([q("esri.rest.support.RouteResult")],g);const se=g;function x(s){return s&&C.fromJSON(s).features.map(t=>t)}let c=class extends F{constructor(s){super(s),this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(s,t){return x(t.barriers)}readPolylineBarriers(s){return x(s)}readPolygonBarriers(s){return x(s)}};a([f({type:[X]})],c.prototype,"messages",void 0),a([f({type:[$]})],c.prototype,"pointBarriers",void 0),a([E("pointBarriers",["barriers"])],c.prototype,"readPointBarriers",null),a([f({type:[$]})],c.prototype,"polylineBarriers",void 0),a([E("polylineBarriers")],c.prototype,"readPolylineBarriers",null),a([f({type:[$]})],c.prototype,"polygonBarriers",void 0),a([E("polygonBarriers")],c.prototype,"readPolygonBarriers",null),a([f({type:[se]})],c.prototype,"routeResults",void 0),c=a([q("esri.rest.support.RouteSolveResult")],c);const oe=c,ie=te({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:s=>s.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});function I(s){return(s==null?void 0:s.declaredClass)==="esri.rest.support.FeatureSet"}async function ce(s,t,i){const A=[],v=[],d={},e={},B=G(s),{path:m}=B;I(t.stops)&&j(t.stops.features,v,"stops.features",d),I(t.pointBarriers)&&j(t.pointBarriers.features,v,"pointBarriers.features",d),I(t.polylineBarriers)&&j(t.polylineBarriers.features,v,"polylineBarriers.features",d),I(t.polygonBarriers)&&j(t.polygonBarriers.features,v,"polygonBarriers.features",d);const w=await H(v);for(const l in d){const h=d[l];A.push(l),e[l]=w.slice(h[0],h[1])}if(Y(e,A)){let l=null;try{l=await _(m,t.apiKey,i)}catch{}l&&!l.hasZ&&ee(e,A)}for(const l in e)e[l].forEach((h,S)=>{t.get(l)[S].geometry=h});const N=L(T({},i),{query:L(T(T({},B.query),ie.toQueryParams(t)),{f:"json"})}),y=m.endsWith("/solve")?m:`${m}/solve`,{data:P}=await U(y,N);return ae(P)}function ae(s){var t,i,A,v,d;const e=new Map,{directionLines:B,directionPoints:m,directions:w,routes:N,stops:y,barriers:P,polygonBarriers:l,polylineBarriers:h,messages:S}=s,J=(t=(i=(A=(v=N==null?void 0:N.spatialReference)!=null?v:y==null?void 0:y.spatialReference)!=null?A:P==null?void 0:P.spatialReference)!=null?i:l==null?void 0:l.spatialReference)!=null?t:h==null?void 0:h.spatialReference;N==null||N.features.forEach(r=>{const o=r.attributes.Name,u=r.attributes.ObjectID;e.has(o)?(e.get(o).route=r,e.get(o).routeId=u):e.set(o,{route:r,routeId:u,routeName:o}),O(r.geometry)&&(r.geometry.spatialReference=J)}),w==null||w.forEach(r=>{const o=r.routeName;e.has(o)?e.get(o).directions=r:e.set(o,{routeName:o,directions:r})}),y==null||y.features.forEach(r=>{var o;const u=(o=r.attributes.RouteName)!=null?o:null;e.has(u)?e.get(u).stops?e.get(u).stops.push(r):e.get(u).stops=[r]:e.set(u,{stops:[r],routeName:u}),O(r.geometry)&&(r.geometry.spatialReference=J)});const M=(d=y==null?void 0:y.features.every(r=>r.attributes.RouteName==null))==null||d;if((y==null?void 0:y.features.length)>0&&M){const r=Array.from(e.keys())[0];e.get(r).stops=e.get(null).stops,e.delete(null)}B==null||B.features.forEach(r=>{var o;const u=r.attributes.RouteID,n=(o=Array.from(e.values()).find(p=>p.routeId===u))==null?void 0:o.routeName;if(n)if(e.has(n))if(e.get(n).directionLines)e.get(n).directionLines.features.push(r);else{const{fieldAliases:p,geometryType:R,spatialReference:b}=B;e.get(n).directionLines={features:[r],fieldAliases:p,geometryType:R,spatialReference:b}}else{const{fieldAliases:p,geometryType:R,spatialReference:b}=B;e.set(n,{routeName:n,directionLines:{features:[r],fieldAliases:p,geometryType:R,spatialReference:b}})}}),m==null||m.features.forEach(r=>{var o;const u=r.attributes.RouteID,n=(o=Array.from(e.values()).find(p=>p.routeId===u))==null?void 0:o.routeName;if(n)if(e.has(n))if(e.get(n).directionPoints)e.get(n).directionPoints.features.push(r);else{const{fieldAliases:p,geometryType:R,spatialReference:b}=m;e.get(n).directionPoints={features:[r],fieldAliases:p,geometryType:R,spatialReference:b}}else{const{fieldAliases:p,geometryType:R,spatialReference:b}=m;e.set(n,{routeName:n,directionPoints:{features:[r],fieldAliases:p,geometryType:R,spatialReference:b}})}});const Q=Array.from(e.values());return oe.fromJSON({routeResults:Q,barriers:P,polygonBarriers:l,polylineBarriers:h,messages:S})}export{ce as p};
