import{y as ve,O as we,N as Ne,P as Ie,o as be,r as Se,f as Te,S as Re,p as Oe,u as Ae,I as Ce,g as Ue,b as f,a as T,_ as fe,e as Me,s as Fe}from"./arcadeUtils.1e20f716.js";import{nw as h,mP as D,mX as H,mG as O,n0 as q,nA as w,n2 as F,d7 as xe,nE as I,nF as Q,m$ as u,nC as A,nD as Y,n1 as j,mQ as m,qG as De,mT as C,mW as P,mI as N,m_ as L,nn as x,nu as he,mH as M,ne as G,mR as p,mJ as ae,nx as Pe,ny as Le,mU as ke,aS as _e,v as Ve,bC as je,bB as Be,ao as Ye,nv as Ge,nb as ze,n9 as He,nz as oe}from"./vendor.f59113c8.js";import{registerFunctions as qe}from"./geomasync.32fc3adf.js";import"./geometryEngineAsync.b8c0bd7a.js";function ce(n){return n&&typeof n.then=="function"}const z=100;function g(n){return n instanceof Error?w(n):w(new Error(n))}function pe(n){return m(n)}function $(n,e){const r=[];for(let t=0;t<e.arguments.length;t++)r.push(i(n,e.arguments[t]));return D(r)}function S(n,e,r){return h((t,a)=>{if(e.preparsed===!0)return t(r(n,null,e.arguments));$(n,e).then(o=>{try{t(r(n,e,o))}catch(c){a(c)}},a)})}function _(n,e,r){try{if(e.preparsed===!0){const t=r(n,null,e.arguments);return ce(t)?t:m(t)}return $(n,e).then(t=>{try{const a=r(n,e,t);return ce(a)?a:m(a)}catch(a){return g(a)}})}catch(t){return g(t)}}function i(n,e,r){try{if(e.breakpoint&&r!==!0)return e.breakpoint().then(()=>i(n,e,!0));switch(e.type){case"VariableDeclarator":return sn(n,e);case"VariableDeclaration":return ge(n,e,0);case"BlockStatement":return an(n,e);case"FunctionDeclaration":return cn(n,e);case"ReturnStatement":return on(n,e);case"IfStatement":return tn(n,e);case"ExpressionStatement":return rn(n,e);case"UpdateExpression":return en(n,e);case"AssignmentExpression":return nn(n,e);case"ForStatement":return Xe(n,e);case"ForInStatement":return $e(n,e);case"BreakStatement":return m(A);case"EmptyStatement":return m(u);case"ContinueStatement":return m(Y);case"TemplateElement":return gn(n,e);case"TemplateLiteral":return En(n,e);case"Identifier":return ee(n,e);case"MemberExpression":return ln(n,e);case"Literal":return pe(e.value);case"CallExpression":return dn(n,e);case"UnaryExpression":return un(n,e);case"BinaryExpression":return hn(n,e);case"LogicalExpression":return pn(n,e);case"ArrayExpression":return fn(n,e);case"ObjectExpression":return Ze(n,e);case"Property":return We(n,e);default:return g(f(e,"RUNTIME","UNREOGNISED"))}}catch(t){return g(t)}}function Ze(n,e){try{const r=[];for(let t=0;t<e.properties.length;t++)r.push(i(n,e.properties[t]));return D(r).then(t=>h(a=>{const o={};for(let s=0;s<t.length;s++){const l=t[s];if(G(l.value))throw new Error("Illegal Argument");if(N(l.key)===!1)throw new Error("Illegal Argument");l.value===u?o[l.key.toString()]=null:o[l.key.toString()]=l.value}const c=new T(o);c.immutable=!1,a(c)}))}catch(r){return g(r)}}function We(n,e){try{return i(n,e.value).then(r=>h(t=>{e.key.type==="Identifier"?t({key:e.key.name,value:r}):i(n,e.key).then(a=>{t({key:a,value:r})})}))}catch(r){return w(r)}}function se(n,e,r){try{return i(n,e.body).then(t=>{try{return r.lastAction=t,r.lastAction===A||r.lastAction instanceof I?(r.testResult=!1,m(r)):e.update!==null?i(n,e.update).then(()=>m(r)):m(r)}catch(a){return w(a)}})}catch(t){return w(t)}}function Ke(n,e,r){try{return e.test!==null?i(n,e.test).then(t=>{try{return n.abortSignal.aborted===!0?w(new Error("Cancelled")):(r.testResult=t,r.testResult===!1?m(r):r.testResult!==!0?w(new Error(f(e,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):se(n,e,r))}catch(a){return w(a)}}):se(n,e,r)}catch(t){return w(t)}}function B(n,e,r,t,a,o){try{Ke(n,e,r).then(()=>{try{r.testResult===!0?++o>z?(o=0,setTimeout(()=>{B(n,e,r,t,a,o)},0)):B(n,e,r,t,a,o):r.lastAction instanceof I?t(r.lastAction):t(u)}catch(c){a(c)}},c=>{a(c)})}catch(c){a(c)}}function Xe(n,e){try{return e.init!==null?i(n,e.init).then(()=>h((r,t)=>{B(n,e,{testResult:!0,lastAction:u},a=>{r(a)},a=>{t(a)},0)})):h((r,t)=>{B(n,e,{testResult:!0,lastAction:u},a=>{r(a)},a=>{t(a)},0)})}catch(r){return w(r)}}function Z(n,e,r,t,a,o,c,s,l,E){try{if(t<=o)return void s(u);a.value=c==="k"?r[o]:o,i(n,e.body).then(d=>{try{d instanceof I?s(d):d===A?s(u):++E>z?(E=0,setTimeout(()=>{Z(n,e,r,t,a,o+1,c,s,l,E)},0)):Z(n,e,r,t,a,o+1,c,s,l,E)}catch(y){l(y)}},d=>{l(d)})}catch(d){l(d)}}function W(n,e,r,t,a,o,c,s,l){try{if(r.length()<=a)return void c(u);t.value=o==="k"?r.get(a):a,i(n,e.body).then(E=>{E instanceof I?c(E):E===A?c(u):++l>z?(l=0,setTimeout(()=>{W(n,e,r,t,a+1,o,c,s,l)},0)):W(n,e,r,t,a+1,o,c,s,l)},E=>{s(E)})}catch(E){s(E)}}function K(n,e,r,t,a,o){try{if(o===void 0&&(o="i"),r.length===0)return void t.resolve(u);Z(n,e,r,r.length,a,0,o,c=>{t.resolve(c)},c=>{t.reject(c)},0)}catch(c){t.reject(c)}}function Je(n,e,r,t,a,o){try{if(o===void 0&&(o="i"),r.length===0)return void t.resolve(u);W(n,e,r,a,0,o,c=>{t.resolve(c)},c=>{t.reject(c)},0)}catch(c){t.reject(c)}}function Qe(n,e,r,t,a){try{K(n,e,r.keys(),t,a,"k")}catch(o){t.reject(o)}}function X(n,e,r,t,a,o,c,s){try{n.next().then(l=>{try{if(l===null)o(u);else{const E=fe.createFromGraphicLikeObject(l.geometry,l.attributes,t);E._underlyingGraphic=l,a.value=E,i(e,r.body).then(d=>{try{d===A?o(u):d instanceof I?o(d):++s>z?(s=0,setTimeout(()=>{X(n,e,r,t,a,o,c,s)},0)):X(n,e,r,t,a,o,c,s)}catch(y){c(y)}},d=>{c(d)})}}catch(E){c(E)}},l=>{c(l)})}catch(l){c(l)}}function $e(n,e){return h((r,t)=>{i(n,e.right).then(a=>{try{let o=null;o=e.left.type==="VariableDeclaration"?i(n,e.left):m(),o.then(()=>{try{let c="";if(e.left.type==="VariableDeclaration"){const l=e.left.declarations[0].id;l.type==="Identifier"&&(c=l.name)}else e.left.type==="Identifier"&&(c=e.left.name);if(!c)throw new Error(f(e,"RUNTIME","INVALIDVARIABLE"));c=c.toLowerCase();let s=null;if(n.localScope!==null&&n.localScope[c]!==void 0&&(s=n.localScope[c]),s===null&&n.globalScope[c]!==void 0&&(s=n.globalScope[c]),s===null)return void t(new Error(f(e,"RUNTIME","VARIABLENOTDECLARED")));P(a)||N(a)?K(n,e,a,{reject:t,resolve:r},s):L(a)?Je(n,e,a,{reject:t,resolve:r},s):a instanceof T||x(a)?Qe(n,e,a,{reject:t,resolve:r},s):he(a)?X(a.iterator(n.abortSignal),n,e,a,s,l=>{r(l)},l=>{t(l)},0):K(n,e,[],{reject:t,resolve:r},s)}catch(c){t(c)}},t)}catch(o){t(o)}},t)})}function en(n,e){try{const r=e.argument;if(r.type==="MemberExpression"){const t={t:null};return i(n,r.object).then(a=>{let o=null;return t.t=a,r.computed===!0?o=i(n,r.property):r.property.type==="Identifier"&&(o=m(r.property.name)),o}).then(a=>h(o=>{const c=t.t;let s;if(P(c)){if(!M(a))throw new Error("Invalid Parameter");if(a<0&&(a=c.length+a),a<0||a>=c.length)throw new Error("Assignment outside of array bounds");s=p(c[a]),c[a]=e.operator==="++"?s+1:s-1}else if(c instanceof T){if(N(a)===!1)throw new Error("Dictionary accessor must be a string");if(c.hasField(a)!==!0)throw new Error("Invalid Parameter");s=p(c.field(a)),c.setField(a,e.operator==="++"?s+1:s-1)}else{if(!x(c))throw L(c)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(N(a)===!1)throw new Error("Feature accessor must be a string");if(c.hasField(a)!==!0)throw new Error("Invalid Parameter");s=p(c.field(a)),c.setField(a,e.operator==="++"?s+1:s-1)}e.prefix===!1?o(s):o(e.operator==="++"?s+1:s-1)}))}return h((t,a)=>{const o=e.argument.type==="Identifier"?e.argument.name.toLowerCase():"";if(!o)throw new Error("Invalid identifier");let c;return n.localScope!==null&&n.localScope[o]!==void 0?(c=p(n.localScope[o].value),n.localScope[o]={value:e.operator==="++"?c+1:c-1,valueset:!0,node:e},void(e.prefix===!1?t(c):t(e.operator==="++"?c+1:c-1))):n.globalScope[o]!==void 0?(c=p(n.globalScope[o].value),n.globalScope[o]={value:e.operator==="++"?c+1:c-1,valueset:!0,node:e},void(e.prefix===!1?t(c):t(e.operator==="++"?c+1:c-1))):void a(new Error("Variable not recognised"))})}catch(r){return w(r)}}function R(n,e,r,t){switch(e){case"=":return n===u?null:n;case"/=":return p(r)/p(n);case"*=":return p(r)*p(n);case"-=":return p(r)-p(n);case"+=":return N(r)||N(n)?C(r)+C(n):p(r)+p(n);case"%=":return p(r)%p(n);default:throw new Error(f(t,"RUNTIME","OPERATORNOTRECOGNISED"))}}function nn(n,e){return h((r,t)=>{const a=e.left;if(a.type==="MemberExpression")i(n,e.right).then(o=>{try{i(n,a.object).then(c=>{try{let s=null;if(a.computed===!0)s=i(n,a.property);else{if(a.property.type!=="Identifier")throw new Error("Expected computed or identifier for assignemnt target");s=m(a.property.name)}s.then(l=>{try{if(P(c)){if(!M(l))throw new Error("Invalid Parameter");if(l<0&&(l=c.length+l),l<0||l>c.length)throw new Error("Assignment outside of array bounds");if(l===c.length){if(e.operator!=="=")throw new Error("Invalid Parameter");c[l]=R(o,e.operator,c[l],e)}else c[l]=R(o,e.operator,c[l],e)}else if(c instanceof T){if(N(l)===!1)throw new Error("Dictionary accessor must be a string");if(c.hasField(l)===!0)c.setField(l,R(o,e.operator,c.field(l),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");c.setField(l,R(o,e.operator,null,e))}}else{if(!x(c))throw L(c)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(N(l)===!1)throw new Error("Feature accessor must be a string");if(c.hasField(l)===!0)c.setField(l,R(o,e.operator,c.field(l),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");c.setField(l,R(o,e.operator,null,e))}}r(u)}catch(E){t(E)}},t)}catch(s){t(s)}},t)}catch(c){t(c)}},t);else{const o=a.name.toLowerCase();if(n.localScope!==null&&n.localScope[o]!==void 0)return void i(n,e.right).then(c=>{try{n.localScope[o]={value:R(c,e.operator,n.localScope[o].value,e),valueset:!0,node:e.right},r(u)}catch(s){t(s)}},t);n.globalScope[o]!==void 0?i(n,e.right).then(c=>{try{n.globalScope[o]={value:R(c,e.operator,n.globalScope[o].value,e),valueset:!0,node:e.right},r(u)}catch(s){t(s)}},t):t(new Error("Cannot assign undeclared variable"))}})}function rn(n,e){try{return e.expression.type==="AssignmentExpression"?i(n,e.expression):(e.expression.type,i(n,e.expression).then(r=>h(t=>{t(r===u?u:new Q(r))})))}catch(r){return w(r)}}function tn(n,e){return h((r,t)=>{e.test.type!=="AssignmentExpression"&&e.test.type!=="UpdateExpression"?i(n,e.test).then(a=>{try{a===!0?i(n,e.consequent).then(r,t):a===!1?e.alternate!==null?i(n,e.alternate).then(r,t):r(u):t(new Error(f(e.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(o){t(o)}},t):t(new Error(f(e.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))})}function an(n,e){try{return de(n,e,0)}catch(r){return g(r)}}function de(n,e,r){try{return r>=e.body.length?m(u):h((t,a)=>{i(n,e.body[r]).then(o=>{try{o instanceof I||o===A||o===Y||r===e.body.length-1?t(o):de(n,e,r+1).then(t,a)}catch(c){a(c)}},a)})}catch(t){return g(t)}}function on(n,e){return h((r,t)=>{e.argument===null?r(new I(u)):i(n,e.argument).then(a=>{try{r(new I(a))}catch(o){t(o)}},t)})}function cn(n,e){try{const r=e.id.name.toLowerCase();return n.globalScope[r]={valueset:!0,node:null,value:new j(e,n)},m(u)}catch(r){return g(r)}}function ge(n,e,r){return h((t,a)=>{r>=e.declarations.length?t(u):i(n,e.declarations[r]).then(()=>{r===e.declarations.length-1?t(u):ge(n,e,r+1).then(()=>{t(u)},a)},a)})}function sn(n,e){try{let r=null;return r=e.init===null?m(null):i(n,e.init),n.localScope!==null?r.then(t=>h(a=>{if(t===u&&(t=null),e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const o=e.id.name.toLowerCase();n.localScope[o]={value:t,valueset:!0,node:e.init},a(u)})):r.then(t=>h(a=>{if(e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const o=e.id.name.toLowerCase();t===u&&(t=null),n.globalScope[o]={value:t,valueset:!0,node:e.init},a(u)}))}catch(r){return g(r)}}let b=0;function le(n,e,r,t){let a;switch(e=e.toLowerCase()){case"hasz":{const o=n.hasZ;return o!==void 0&&o}case"hasm":{const o=n.hasM;return o!==void 0&&o}case"spatialreference":{let o=n.spatialReference._arcadeCacheId;if(o===void 0){let s=!0;Object.freeze&&Object.isFrozen(n.spatialReference)&&(s=!1),s&&(b++,n.spatialReference._arcadeCacheId=b,o=b)}const c=new T({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid});return o!==void 0&&(c._arcadeCacheId="SPREF"+o.toString()),c}}switch(n.type){case"extent":switch(e){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const o=n[e];return o!==void 0?o:null}case"type":return"Extent"}break;case"polygon":switch(e){case"rings":return a=n.cache._arcadeCacheId,a===void 0&&(b++,a=b,n.cache._arcadeCacheId=a),new oe(n.rings,n.spatialReference,n.hasZ===!0,n.hasM===!0,a);case"type":return"Polygon"}break;case"point":switch(e){case"x":case"y":case"z":case"m":return n[e]!==void 0?n[e]:null;case"type":return"Point"}break;case"polyline":switch(e){case"paths":return a=n.cache._arcadeCacheId,a===void 0&&(b++,a=b,n.cache._arcadeCacheId=a),new oe(n.paths,n.spatialReference,n.hasZ===!0,n.hasM===!0,a);case"type":return"Polyline"}break;case"multipoint":switch(e){case"points":return a=n.cache._arcadeCacheId,a===void 0&&(b++,a=b,n.cache._arcadeCacheId=a),new He(n.points,n.spatialReference,n.hasZ===!0,n.hasM===!0,a,1);case"type":return"Multipoint"}}throw new Error(f(t,"RUNTIME","PROPERTYNOTFOUND"))}function ln(n,e){try{return i(n,e.object).then(r=>{try{return r===null?w(new Error(f(e,"RUNTIME","NOTFOUND"))):e.computed===!1?e.property.type==="Identifier"?r instanceof T||x(r)?m(r.field(e.property.name)):r instanceof ae?m(le(r,e.property.name,n,e)):w(new Error(f(e,"RUNTIME","INVALIDTYPE"))):w(new Error(f(e,"RUNTIME","INVALIDTYPE"))):i(n,e.property).then(t=>h((a,o)=>{if(r instanceof T||x(r))N(t)?a(r.field(t)):o(new Error(f(e,"RUNTIME","INVALIDTYPE")));else if(r instanceof ae)N(t)?a(le(r,t,n,e)):o(new Error(f(e,"RUNTIME","INVALIDTYPE")));else if(P(r))if(M(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length+t),t>=r.length||t<0)throw new Error(f(e,"RUNTIME","OUTOFBOUNDS"));a(r[t])}else o(new Error(f(e,"RUNTIME","INVALIDTYPE")));else if(L(r))if(M(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length()+t),t>=r.length()||t<0)throw new Error(f(e,"RUNTIME","OUTOFBOUNDS"));a(r.get(t))}else o(new Error(f(e,"RUNTIME","INVALIDTYPE")));else if(N(r))if(M(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length+t),t>=r.length||t<0)throw new Error(f(e,"RUNTIME","OUTOFBOUNDS"));a(r[t])}else o(new Error(f(e,"RUNTIME","INVALIDTYPE")));else o(new Error(f(e,"RUNTIME","INVALIDTYPE")))}))}catch(t){return g(t)}})}catch(r){return g(r)}}function un(n,e){try{return i(n,e.argument).then(r=>h((t,a)=>{O(r)&&e.operator==="!"?t(!r):e.operator==="-"?t(-1*p(r)):e.operator==="+"?t(1*p(r)):e.operator==="~"?t(~p(r)):a(new Error(f(e,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))}catch(r){return g(r)}}function fn(n,e){try{const r=[];for(let t=0;t<e.elements.length;t++)r.push(i(n,e.elements[t]));return D(r).then(t=>h((a,o)=>{for(let c=0;c<t.length;c++){if(G(t[c]))return void o(new Error(f(e,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));t[c]===u&&(t[c]=null)}a(t)}))}catch(r){return g(r)}}function hn(n,e){try{return D([i(n,e.left),i(n,e.right)]).then(r=>h((t,a)=>{const o=r[0],c=r[1];switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":t(Le(p(o),p(c),e.operator));case"==":t(q(o,c));break;case"!=":t(!q(o,c));break;case"<":case">":case"<=":case">=":t(Pe(o,c,e.operator));break;case"+":N(o)||N(c)?t(C(o)+C(c)):t(p(o)+p(c));break;case"-":t(p(o)-p(c));break;case"*":t(p(o)*p(c));break;case"/":t(p(o)/p(c));break;case"%":t(p(o)%p(c));break;default:a(new Error(f(e,"RUNTIME","OPERATORNOTRECOGNISED")))}}))}catch(r){return g(r)}}function pn(n,e){return h((r,t)=>{e.left.type!=="AssignmentExpression"&&e.left.type!=="UpdateExpression"?e.right.type!=="AssignmentExpression"&&e.right.type!=="UpdateExpression"?i(n,e.left).then(a=>{try{if(!O(a))throw new Error(f(e,"RUNTIME","ONLYBOOLEAN"));switch(e.operator){case"||":a===!0?r(a):i(n,e.right).then(o=>{try{if(!O(o))throw new Error(f(e,"RUNTIME","ONLYORORAND"));r(o)}catch(c){t(c)}},t);break;case"&&":a===!1?r(a):i(n,e.right).then(o=>{try{if(!O(o))throw new Error(f(e,"RUNTIME","ONLYORORAND"));r(o)}catch(c){t(c)}},t);break;default:throw new Error(f(e,"RUNTIME","ONLYORORAND"))}}catch(o){t(o)}},t):t(new Error(f(e.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):t(new Error(f(e.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))})}function ee(n,e){return h((r,t)=>{const a=e.name.toLowerCase();if(n.localScope===null||n.localScope[a]===void 0)if(n.globalScope[a]===void 0)t(new Error(f(e,"RUNTIME","VARIABLENOTFOUND")));else{const o=n.globalScope[a];o.valueset===!0?r(o.value):o.d!==null?o.d.then(r,t):(o.d=i(n,o.node),o.d.then(c=>{try{o.value=c,o.valueset=!0,r(c)}catch(s){t(s)}},t))}else{const o=n.localScope[a];o.valueset===!0?r(o.value):o.d!==null?o.d.then(r,t):(o.d=i(n,o.node),o.d.then(c=>{try{o.value=c,o.valueset=!0,r(c)}catch(s){t(s)}},t))}})}function dn(n,e){try{if(e.callee.type!=="Identifier")return g(f(e,"RUNTIME","ONLYNODESSUPPORTED"));if(n.localScope!==null&&n.localScope[e.callee.name.toLowerCase()]!==void 0){const r=n.localScope[e.callee.name.toLowerCase()];return r.value instanceof F?r.value.fn(n,e):r.value instanceof j?ue(n,e,r.value.definition):g(f(e,"RUNTIME","NOTAFUNCTION"))}if(n.globalScope[e.callee.name.toLowerCase()]!==void 0){const r=n.globalScope[e.callee.name.toLowerCase()];return r.value instanceof F?r.value.fn(n,e):r.value instanceof j?ue(n,e,r.value.definition):g(f(e,"RUNTIME","NOTAFUNCTION"))}return g(f(e,"RUNTIME","NOTFOUND"))}catch(r){return g(r)}}function gn(n,e){return m(e.value?e.value.cooked:"")}function En(n,e){return h(r=>{const t=[];De(e.expressions,(a,o,c,s)=>i(n,o).then(l=>{t[c]=C(l)})).then(()=>{let a="",o=0;for(const c of e.quasis)a+=c.value?c.value.cooked:"",c.tail===!1&&(a+=t[o]?t[o]:"",o++);r(a)})})}const v={};function ie(n){return n===null?"":P(n)||L(n)?"Array":ke(n)?"Date":N(n)?"String":O(n)?"Boolean":M(n)?"Number":n instanceof Me?"Attachment":n instanceof Fe?"Portal":n instanceof T?"Dictionary":x(n)?"Feature":n instanceof _e?"Point":n instanceof Ve?"Polygon":n instanceof je?"Polyline":n instanceof Be?"Multipoint":n instanceof Ye?"Extent":G(n)?"Function":he(n)?"FeatureSet":Ge(n)?"FeatureSetCollection":n===u?"":typeof n=="number"&&isNaN(n)?"Number":"Unrecognised Type"}function Ee(n,e,r,t){return h((a,o)=>{i(n,e.arguments[r]).then(c=>{try{if(q(c,t))return void i(n,e.arguments[r+1]).then(a,o);{const s=e.arguments.length-r;return s===1?void i(n,e.arguments[r]).then(a,o):(s===2&&a(null),s===3?void i(n,e.arguments[r+2]).then(a,o):void Ee(n,e,r+2,t).then(a,o))}}catch(s){o(s)}},o)})}function me(n,e,r,t){return h((a,o)=>{t===!0?i(n,e.arguments[r+1]).then(a,o):e.arguments.length-r===3?i(n,e.arguments[r+2]).then(a,o):i(n,e.arguments[r+2]).then(c=>{try{if(O(c)===!1)return void o(new Error("WHEN needs boolean test conditions"));me(n,e,r+2,c).then(a,o)}catch(s){o(s)}})})}function J(n,e){try{const r=n.length,t=Math.floor(r/2);return r===0?m([]):r===1?m([n[0]]):h((a,o)=>{const c=[J(n.slice(0,t),e),J(n.slice(t,r),e)];D(c).then(s=>{try{V(s[0],s[1],e,[]).then(a,o)}catch(l){o(l)}},o)})}catch(r){return g(r)}}function V(n,e,r,t){return h((a,o)=>{const c=t;n.length>0||e.length>0?n.length>0&&e.length>0?r(n[0],e[0]).then(s=>{try{isNaN(s)&&(s=1),s<=0?(c.push(n[0]),n=n.slice(1)):(c.push(e[0]),e=e.slice(1)),V(n,e,r,t).then(a,o)}catch(l){o(l)}},o):n.length>0?(c.push(n[0]),V(n=n.slice(1),e,r,t).then(a,o)):e.length>0&&(c.push(e[0]),e=e.slice(1),V(n,e,r,t).then(a,o)):a(t)})}function U(n,e){const r=n.length,t=Math.floor(r/2);return e||(e=function(a,o){return a<o?-1:a===o?0:1}),r===0?[]:r===1?[n[0]]:mn(U(n.slice(0,t),e),U(n.slice(t,r),e),e)}function mn(n,e,r){const t=[];for(;n.length>0||e.length>0;)if(n.length>0&&e.length>0){let a=r(n[0],e[0]);isNaN(a)&&(a=1),a<=0?(t.push(n[0]),n=n.slice(1)):(t.push(e[0]),e=e.slice(1))}else n.length>0?(t.push(n[0]),n=n.slice(1)):e.length>0&&(t.push(e[0]),e=e.slice(1));return t}function ye(n,e,r){try{const t=n.body;if(r.length!==n.params.length)return g(new Error("Invalid Parameter calls to function."));for(let a=0;a<r.length;a++){const o=n.params[a];o.type==="Identifier"&&(e.localScope[o.name.toLowerCase()]={d:null,value:r[a],valueset:!0,node:null})}return i(e,t).then(a=>h((o,c)=>{a instanceof I?o(a.value):a!==A?a!==Y?o(a instanceof Q?a.value:a):c(new Error("Cannot Continue from a Function")):c(new Error("Cannot Break from a Function"))}))}catch(t){return w(t)}}function ue(n,e,r){return _(n,e,function(t,a,o){const c={spatialReference:n.spatialReference,services:n.services,console:n.console,lrucache:n.lrucache,interceptor:n.interceptor,localScope:{},abortSignal:n.abortSignal,globalScope:n.globalScope,depthCounter:n.depthCounter+1};if(c.depthCounter>64)throw new Error("Exceeded maximum function depth");return ye(r,c,o)})}function ne(n){return function(){const r={abortSignal:n.context.abortSignal,spatialReference:n.context.spatialReference,console:n.context.console,lrucache:n.context.lrucache,interceptor:n.context.interceptor,services:n.context.services,localScope:{},globalScope:n.context.globalScope,depthCounter:n.context.depthCounter+1};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return ye(n.definition,r,arguments)}}ve(v,S),we(v,S),Ne(v,S),Ie(v,S),be(v,S),qe({functions:v,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:S,standardFunctionAsync:_}),v.typeof=function(n,e){return S(n,e,function(r,t,a){H(a,1,1);const o=ie(a[0]);if(o==="Unrecognised Type")throw new Error("Unrecognised Type");return o})},v.iif=function(n,e){return h((r,t)=>{H(e.arguments===null?[]:e.arguments,3,3),i(n,e.arguments[0]).then(a=>{try{if(O(a)===!1)return void t(new Error("IF Function must have a boolean test condition"));D([i(n,e.arguments[1]),i(n,e.arguments[2])]).then(o=>{r(a?o[0]:o[1])},t)}catch(o){t(o)}},t)})},v.decode=function(n,e){return h((r,t)=>{e.arguments.length<2?t(new Error("Missing Parameters")):e.arguments.length!==2?(e.arguments.length-1)%2!=0?i(n,e.arguments[0]).then(a=>{try{Ee(n,e,1,a).then(r,t)}catch(o){t(o)}},t):t(new Error("Must have a default value result.")):i(n,e.arguments[1]).then(r,t)})},v.when=function(n,e){try{return e.arguments.length<3?g("Missing Parameters"):e.arguments.length%2==0?g("Must have a default value result."):i(n,e.arguments[0]).then(r=>h((t,a)=>{if(O(r)===!1)return void a(new Error("WHEN needs boolean test conditions"));me(n,e,0,r).then(t,a)}))}catch(r){return g(r)}},v.sort=function(n,e){return _(n,e,function(r,t,a){H(a,1,2);let o=a[0];if(L(o)&&(o=o.toArray()),P(o)===!1)return g(Error("Illegal Argument"));if(a.length>1)return G(a[1])===!1?g(Error("Illegal Argument")):J(o,ne(a[1]));{let c=o;if(c.length===0)return m([]);const s={};for(let d=0;d<c.length;d++){const y=ie(c[d]);y!==""&&(s[y]=!0)}if(s.Array===!0||s.Dictionary===!0||s.Feature===!0||s.Point===!0||s.Polygon===!0||s.Polyline===!0||s.Multipoint===!0||s.Extent===!0||s.Function===!0)return m(c.slice(0));let l=0,E="";for(const d in s)l++,E=d;return l>1||E==="String"?c=U(c,function(d,y){if(d==null||d===u)return y==null||y===u?0:1;if(y==null||y===u)return-1;const re=C(d),te=C(y);return re<te?-1:re===te?0:1}):E==="Number"?c=U(c,function(d,y){return d-y}):E==="Boolean"?c=U(c,function(d,y){return d===y?0:y?-1:1}):E==="Date"&&(c=U(c,function(d,y){return y-d})),m(c)}})};const yn={failDefferred:g,resolveDeffered:pe,fixSpatialReference:ze,parseArguments:$,standardFunction:S,standardFunctionAsync:_,evaluateIdentifier:ee,arcadeCustomFunction:ne};for(const n in v)v[n]={value:new F(v[n]),valueset:!0,node:null};const k=function(){};function vn(n,e){const r=new k;n==null&&(n={}),e==null&&(e={});const t=new T({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});t.immutable=!1,r.textformatting={value:t,valueset:!0,node:null};for(const a in e)r[a]={value:new F(e[a]),native:!0,valueset:!0,node:null};for(const a in n)n[a]&&n[a].declaredClass==="esri.Graphic"?r[a]={value:fe.createFromGraphic(n[a]),valueset:!0,node:null}:r[a]={value:n[a],valueset:!0,node:null};return r}function wn(n){console.log(n)}k.prototype=v,k.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},k.prototype.pi={value:Math.PI,valueset:!0,node:null};const Rn=yn;function Nn(n){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:S,standardFunctionAsync:_,failDefferred:g,evaluateIdentifier:ee,arcadeCustomFunctionHandler:ne};for(let r=0;r<n.length;r++)n[r].registerFunctions(e);for(const r in e.functions)v[r]={value:new F(e.functions[r]),valueset:!0,node:null},k.prototype[r]=v[r];for(let r=0;r<e.signatures.length;r++)Se(e.signatures[r],"async")}function On(n,e){let r=e.spatialReference;r==null&&(r=new xe({wkid:102100}));const t=vn(e.vars,e.customfunctions);return i({spatialReference:r,services:e.services,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:t,console:e.console?e.console:wn,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:1},n.body[0].body).then(a=>h((o,c)=>{a instanceof I&&(a=a.value),a instanceof Q&&(a=a.value),a===u&&(a=null),a!==A?a!==Y?a instanceof F||a instanceof j?c(new Error("Cannot return FUNCTION")):o(a):c(new Error("Cannot return CONTINUE")):c(new Error("Cannot return BREAK"))}))}function An(n,e){return Te(n)}function Cn(n,e){return Re(n,e,"full")}function Un(n,e){return Oe(n,e)}function Mn(n,e){return Ae(n,e)}function Fn(n){return Ce(n)}Nn([Ue]);export{On as executeScript,Nn as extend,An as extractFieldLiterals,Fn as findFunctionCalls,Rn as functionHelper,Mn as referencesFunction,Un as referencesMember,Cn as validateScript};
