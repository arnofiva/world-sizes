var wn=Object.defineProperty,Mn=Object.defineProperties;var Rn=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Pn=Object.prototype.hasOwnProperty,bn=Object.prototype.propertyIsEnumerable;var D=(n,t,e)=>t in n?wn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,L=(n,t)=>{for(var e in t||(t={}))Pn.call(t,e)&&D(n,e,t[e]);if(Z)for(var e of Z(t))bn.call(t,e)&&D(n,e,t[e]);return n},q=(n,t)=>Mn(n,Rn(t));import{hV as fn,Q as Sn,aL as H,Y as W,M as C,K as b,c6 as j,bc as E,bk as En,ab as kn,hW as G,hX as k,hY as nn,hZ as Gn,h_ as Nn,k as vn,h$ as tn}from"./vendor.5a0f9a12.js";function un(n,t,e){return!En(n,t,e)}function T(n,t,e){const r=un(n,t,e);if(r&&!fn())throw new kn("rasterprojectionhelper-project","projection engine is not loaded");return r}const en=function(n,t,e,r=0){if(e[0]===1)return[0,0];let a=1,o=-1,i=1,l=-1;for(let c=0;c<n.length;c+=2)isNaN(n[c])||(a=a>n[c]?n[c]:a,o=o>n[c]?o:n[c],i=i>n[c+1]?n[c+1]:i,l=l>n[c+1]?l:n[c+1]);const{cols:s,rows:x}=t,h=(o-a)/s/e[0],R=(l-i)/x/e[1],y=2*r;let w=0,f=!1,m=[0,0];for(let c=0;c<s-3;c++){for(let g=0;g<x-3;g++){const u=c*x*2+2*g,p=(n[u]+n[u+4]+n[u+4*x]+n[u+4*x+4])/4,d=(n[u+1]+n[u+5]+n[u+4*x+1]+n[u+4*x+5])/4,M=Math.abs((p-n[u+2*x+2])/h),P=Math.abs((d-n[u+2*x+3])/R);if(M+P>w&&(w=M+P,m=[M,P]),y&&w>y){f=!0;break}}if(f)break}return m},Tn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},A=32,I=4,J=I,X=new Map,K=new Map;async function In(){if(fn())return null;await Sn()}function Bn(n,t,e){return T(n.spatialReference,t)?e?tn(t,n.spatialReference,n):tn(n.spatialReference,t,n):null}function Fn(n,t,e,r=null){const a=n.spatialReference;if(a.equals(t))return n;T(a,t,r);const o=e.center,i=new H({xmin:o.x-n.x/2,xmax:o.x+n.x/2,ymin:o.y-n.y/2,ymax:o.y+n.y/2,spatialReference:a}),l=W(i,t,r);if(C(l))return null;const s={x:l.xmax-l.xmin,y:l.ymax-l.ymin},x=v(t);if(b(x)&&s.x>=x){const h=j(a)/j(t);s.x=n.x*h,s.y=n.y*h}return s}function N(n,t=.01){return j(n)?t/j(n):0}function on(n,t,e=null,r=!0){const a=n.spatialReference;if(a.equals(t))return n;T(a,t,e);const o=W(n,t,e);if(!r||!o)return o;const i=B(a,!0),l=B(t,!0),s=N(a);return s&&b(i)&&b(l)&&(o.x>0&&Math.abs(n.x-i[0])<s?o.x-=l[1]-l[0]:o.x<0&&Math.abs(n.x-i[1])<s&&(o.x+=l[1]-l[0])),o}function _n(n){const{inSR:t,outSR:e,datumTransformation:r,preferPE:a}=n;if(t.equals(e)){const{points:o}=U(n,null);return o}if(t.isWebMercator&&e.isWGS84||t.isWGS84&&e.isWebMercator)return $n(n);if(T(t,e,r)&&a){if(t.isGeographic)return sn(n);const o=$(t);if(b(o))return sn(n)}return Cn(n)}function Cn(n){const{points:t}=U(n,null),e=t.map(r=>new E(r[0],r[1],n.inSR));return W(e,n.outSR,n.datumTransformation).map(r=>r?[r.x,r.y]:[NaN,NaN])}function sn(n){const{inSR:t,outSR:e,datumTransformation:r}=n,a=$(t),{points:o,mask:i}=U(n,a);if(!t.isGeographic){const s=t.wkid?G.coordsys(t.wkid):G.fromString(t.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,t.wkt);nn.projToGeog(s,o.length,o)}if(b(r)&&r.steps.length&&r.steps.forEach(s=>{const x=s.wkid?G.geogtran(s.wkid):G.fromString(k.PE_TYPE_GEOGTRAN,s.wkt);Gn.geogToGeog(x,o.length,o,null,s.isInverse?k.PE_TRANSFORM_2_TO_1:k.PE_TRANSFORM_1_TO_2)}),!e.isGeographic){const s=$(e,!0),x=b(s)&&s.isEnvelope?[s.bbox[1],s.bbox[3]]:[-90,90];Wn(o,x);const h=e.wkid?G.coordsys(e.wkid):G.fromString(e.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,e.wkt);nn.geogToProj(h,o.length,o)}let l=o;if(i&&o.length!==i.length){l=[];for(let s=0,x=0;s<i.length;s++)i[s]?l.push(o[x++]):l.push([NaN,NaN])}return l}function $n(n){const{cols:t,rows:e,xres:r,yres:a,usePixelCenter:o,inSR:i,outSR:l}=n;let{xmin:s,ymax:x}=n;o&&(s+=r/2,x-=a/2);const h=[],R=[],y=Math.max(t,e);for(let f=0;f<y;f++){const m=s+r*Math.min(t,f),c=x-a*Math.min(e,f),g=W(new E({x:m,y:c,spatialReference:i}),l);f<=t&&h.push(g.x),f<=e&&R.push(g.y)}const w=[];for(let f=0;f<t;f++)for(let m=0;m<e;m++)w.push([h[f],R[m]]);return w}function $(n,t=!1){let e=n.wkid||n.wkt;if(!e||n.isGeographic)return null;if(e=String(e),X.has(e)){const i=X.get(e);return t?i==null?void 0:i.gcs:i==null?void 0:i.pcs}const r=n.wkid?G.coordsys(n.wkid):G.fromString(n.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,n.wkt),a=rn(r,N(n,1e-4)),o=rn(r,0,!0);return X.set(e,{pcs:a,gcs:o}),t?o:a}function rn(n,t=0,e=!1){const r=Nn.generate(n),a=e?n.horizonGcsGenerate():n.horizonPcsGenerate();if(a==null||!a.length)return null;let o=!1,i=a.find(m=>m.getInclusive()===1&&m.getKind()===1);if(!i){if(i=a.find(m=>m.getInclusive()===1&&m.getKind()===0),!i)return null;o=!0}const l=r.isPannableRectangle(),s=i.getCoord();if(o)return{isEnvelope:o,isPannable:l,vertices:s,coef:null,bbox:[s[0][0]-t,s[0][1]-t,s[1][0]+t,s[1][1]+t]};let x=0;const h=[];let[R,y]=s[0],[w,f]=s[0];for(let m=0,c=s.length;m<c;m++){x++,x===c&&(x=0);const[g,u]=s[m],[p,d]=s[x];if(d===u)h.push([g,p,u,d,2]);else{const M=(p-g)/(d-u||1e-4),P=g-M*u;u<d?h.push([M,P,u,d,0]):h.push([M,P,d,u,1])}R=R<g?R:g,y=y<u?y:u,w=w>g?w:g,f=f>u?f:u}return{isEnvelope:!1,isPannable:l,vertices:s,coef:h,bbox:[R,y,w,f]}}function U(n,t){const e=[],{cols:r,rows:a,xres:o,yres:i,usePixelCenter:l}=n;let{xmin:s,ymax:x}=n;if(l&&(s+=o/2,x-=i/2),!b(t)){for(let w=0;w<r;w++)for(let f=0;f<a;f++)e.push([s+o*w,x-i*f]);return{points:e}}const h=new Uint8Array(r*a);if(t.isEnvelope){const{bbox:[w,f,m,c]}=t;for(let g=0,u=0;g<r;g++){const p=s+o*g,d=t.isPannable||p>=w&&p<=m;for(let M=0;M<a;M++,u++){const P=x-i*M;d&&P>=f&&P<=c&&(e.push([p,P]),h[u]=1)}}return{points:e,mask:h}}const{coef:R}=t,y=[];for(let w=0;w<a;w++){const f=x-i*w,m=[],c=[];for(let u=0;u<R.length;u++){const[p,d,M,P,z]=R[u];if(f===M&&M===P)m.push(p),m.push(d),c.push(2),c.push(2);else if(f>=M&&f<=P){const O=p*f+d;m.push(O),c.push(z)}}let g=m;if(m.length>2){let u=c[0]===2?0:c[0],p=m[0];g=[];for(let d=1;d<c.length;d++)c[d]===2&&d!==c.length-1||(c[d]!==u&&(g.push(u===0?Math.min(p,m[d-1]):Math.max(p,m[d-1])),u=c[d],p=m[d]),d===c.length-1&&g.push(c[d]===0?Math.min(p,m[d]):Math.max(p,m[d])));g.sort((d,M)=>d-M)}else m[0]>m[1]&&(g=[m[1],m[0]]);y.push(g)}for(let w=0,f=0;w<r;w++){const m=s+o*w;for(let c=0;c<a;c++,f++){const g=x-i*c,u=y[c];if(u.length===2)m>=u[0]&&m<=u[1]&&(e.push([m,g]),h[f]=1);else if(u.length>2){let p=!1;for(let d=0;d<u.length;d+=2)if(m>=u[d]&&m<=u[d+1]){p=!0;break}p&&(e.push([m,g]),h[f]=1)}}}return{points:e,mask:h}}function Wn(n,t){const[e,r]=t;for(let a=0;a<n.length;a++){const o=n[a][1];(o<e||o>r)&&(n[a]=[NaN,NaN])}}function xn(n){const t=v(n[0].spatialReference);if(n.length<2||!b(t))return n[0];let{xmin:e,xmax:r,ymin:a,ymax:o}=n[0];for(let i=1;i<n.length;i++){const l=n[i];r=l.xmax+t*i,a=Math.min(a,l.ymin),o=Math.max(o,l.ymax)}return new H({xmin:e,xmax:r,ymin:a,ymax:o,spatialReference:n[0].spatialReference})}function zn(n,t,e=null,r=!0){if(n.spatialReference.equals(t))return n;const a=On(n),o=v(n.spatialReference,!0),i=v(t);if(a===0||C(o)||C(i))return an(n,t,e,r);const l=n.clone().normalize();if(l.length===1&&n.xmax<o&&n.xmax-o/2>N(n.spatialReference)){const{xmin:s,xmax:x}=n;for(let h=0;h<=a;h++){const R=h===0?s:-o/2,y=h===a?x-o*h:o/2;l[h]=new H({xmin:R,xmax:y,ymin:n.ymin,ymax:n.ymax,spatialReference:n.spatialReference})}}return xn(l.map(s=>an(s,t,e,r)).filter(s=>!!s))}function an(n,t,e=null,r=!0,a=!0){const o=n.spatialReference;if(o.equals(t))return n;T(o,t,e);const i=W(n,t,e);if(a&&t.isWebMercator&&i&&(i.ymax=Math.min(20037508342787e-6,i.ymax),i.ymin=Math.max(-20037508342787e-6,i.ymin),i.ymin>=i.ymax))return null;if(!r||!i)return i;const l=B(o,!0),s=B(t,!0);if(C(l)||C(s))return i;const x=N(o,.001),h=N(o,500),R=N(t,.001);if(Math.abs(i.xmin-s[0])<R&&Math.abs(i.xmax-s[1])<R){const y=Math.abs(n.xmin-l[0]),w=Math.abs(l[1]-n.xmax);if(y<x&&w>h){i.xmin=s[0];const f=[];f.push(new E(n.xmax,n.ymin,o)),f.push(new E(n.xmax,(n.ymin+n.ymax)/2,o)),f.push(new E(n.xmax,n.ymax,o));const m=f.map(c=>on(c,t,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);i.xmax=Math.max.apply(null,m)}if(w<x&&y>h){i.xmax=s[1];const f=[];f.push(new E(n.xmin,n.ymin,o)),f.push(new E(n.xmin,(n.ymin+n.ymax)/2,o)),f.push(new E(n.xmin,n.ymax,o));const m=f.map(c=>on(c,t,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);i.xmin=Math.min.apply(null,m)}}else{const y=N(t,.001);Math.abs(i.xmin-s[0])<y&&(i.xmin=s[0]),Math.abs(i.xmax-s[1])<y&&(i.xmax=s[1])}return i}function v(n,t=!1){const e=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*e:n.wkid&&n.isGeographic?360:2*Tn[n.wkid]||null}function B(n,t=!1){if(n.isGeographic)return[-180,180];const e=v(n,t);return b(e)?[-e/2,e/2]:null}function ln(n,t,e,r){let a=(n-t)/e;return a-Math.floor(a)!=0?a=Math.floor(a):r&&(a-=1),a}function On(n,t=!1){const e=v(n.spatialReference);if(!b(e))return 0;const r=t?0:-(e/2),a=N(n.spatialReference),o=!t&&Math.abs(n.xmax-e/2)<a?e/2:n.xmax,i=!t&&Math.abs(n.xmin+e/2)<a?-e/2:n.xmin;return ln(o,r,e,!0)-ln(i,r,e,!1)}function Ln(n){const t=n.storageInfo.origin.x,e=v(n.spatialReference,!0);if(!b(e))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=e/2,{nativePixelSize:a,storageInfo:o,extent:i}=n,{maximumPyramidLevel:l,blockWidth:s,pyramidScalingFactor:x}=o;let h=a.x;const R=[],y=b(n.transform)&&n.transform.type==="gcs-shift",w=t+(y?0:r),f=y?e-t:r-t;for(let m=0;m<=l;m++){const c=(i.xmax-t)/h/s,g=c-Math.floor(c)==0?c:Math.ceil(c),u=f/h/s,p=u-Math.floor(u)==0?u:Math.ceil(u),d=Math.floor(w/h/s),M=Math.round(w/h)%s,P=(s-Math.round(f/h)%s)%s;R.push({resolutionX:h,blockWidth:s,datsetColumnCount:g,worldColumnCountFromOrigin:p,leftMargin:M,rightPadding:P,originColumnOffset:d}),h*=x}return{originX:t,halfWorldWidth:r,pyramidsInfo:R,hasGCSSShiftTransform:y}}function Yn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt);let e;return K.has(t)?e=K.get(t):(e=(n.wkid?G.coordsys(n.wkid):G.fromString(k.PE_TYPE_PROJCS,n.wkt)).getGeogcs().getCode(),K.set(t,e)),new vn({wkid:e})}function qn(n){const t=n.isAdaptive&&n.spacing==null;let e=n.spacing||[A,A],r=Q(n),a={cols:r.size[0]+1,rows:r.size[1]+1};const o=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let i=r.outofBoundPointCount===r.offsets.length/2||t&&o?[0,0]:en(r.offsets,a,e,J);const l=(i[0]+i[1])/2,s=n.projectedExtent.spatialReference,x=n.srcBufferExtent.spatialReference;if(t&&(o||l>J)&&(un(s,x,n.datumTransformation)&&(s.isGeographic||b($(s))),e=[I,I],r=Q(q(L({},n),{spacing:e})),a={cols:r.size[0]+1,rows:r.size[1]+1},i=en(r.offsets,a,e,J)),r.error=i,e[0]>1&&(r.coefficients=cn(r.offsets,a,o)),n.includeGCSGrid&&!s.isGeographic&&!s.isWebMercator)if(x.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:e};else{const h=$(s);if(b(h)&&!h.isEnvelope){const R=Yn(s),y=zn(n.projectedExtent,R),{offsets:w}=Q(q(L({},n),{srcBufferExtent:y,spacing:e})),f=cn(w,a,o);r.gcsGrid={offsets:w,coefficients:f,spacing:e}}}return r}function Q(n){const{projectedExtent:t,srcBufferExtent:e,pixelSize:r,datumTransformation:a,rasterTransform:o}=n,i=t.spatialReference,l=e.spatialReference;T(i,l);const{xmin:s,ymin:x,xmax:h,ymax:R}=t,y=v(l),w=b(y)&&(n.hasWrapAround||(o==null?void 0:o.type)==="gcs-shift"),f=n.spacing||[A,A],m=f[0]*r.x,c=f[1]*r.y,g=f[0]===1,u=Math.ceil((h-s)/m-.1/f[0])+(g?0:1),p=Math.ceil((R-x)/c-.1/f[1])+(g?0:1),d=_n({cols:u,rows:p,xmin:s,ymax:R,xres:m,yres:c,inSR:i,outSR:l,datumTransformation:a,preferPE:f[0]<=I,usePixelCenter:g}),M=[];let P,z=0;const O=g?-1:NaN,{xmin:mn,xmax:hn,ymax:pn,width:gn,height:yn}=e,dn=N(l,500);for(let Y=0;Y<u;Y++){const F=[];for(let _=0;_<p;_++){let S=d[Y*p+_];if(w&&S[0]>hn&&S[0]>y/2-dn&&(S[0]-=y),!S||isNaN(S[0])||isNaN(S[1]))M.push(O),M.push(O),F.push(null),z++;else{if(o){const V=o.inverseTransform(new E({x:S[0],y:S[1],spatialReference:l}));S=[V.x,V.y]}F.push(S),Y>0&&w&&P[_]&&S[0]<P[_][0]&&(S[0]+=y),M.push((S[0]-mn)/gn),M.push((pn-S[1])/yn)}}P=F}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:z,spacing:f,size:g?[u,p]:[u-1,p-1]}}function cn(n,t,e){const{cols:r,rows:a}=t,o=new Float32Array((r-1)*(a-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let s=0;s<r-1;s++){for(let x=0;x<a-1;x++){let h=s*a*2+2*x;const R=n[h],y=n[h+1],w=n[h+2],f=n[h+3];h+=2*a;const m=n[h],c=n[h+1],g=n[h+2],u=n[h+3];let p=0,d=12*(x*(r-1)+s);for(let M=0;M<3;M++)o[d++]=i[p++]*R+i[p++]*w+i[p++]*g;p=0;for(let M=0;M<3;M++)o[d++]=i[p++]*y+i[p++]*f+i[p++]*u;p=0;for(let M=0;M<3;M++)o[d++]=l[p++]*R+l[p++]*m+l[p++]*g;p=0;for(let M=0;M<3;M++)o[d++]=l[p++]*y+l[p++]*c+l[p++]*u}if(e)for(let x=0;x<o.length;x++)isNaN(o[x])&&(o[x]=-1)}return o}function Jn(n){const t=n.clone().normalize();return t.length===1?t[0]:xn(t)}function Xn(n,t,e){const{storageInfo:r,pixelSize:a}=t;let o,i=!1;const{pyramidResolutions:l}=r;if(b(l)&&l.length){const y=(n.x+n.y)/2,w=l[l.length-1],f=(w.x+w.y)/2,m=(a.x+a.y)/2;if(y<=m)o=0;else if(y>=f)o=l.length,i=y/f>8;else{let g,u=m;for(let p=1;p<=l.length;p++){if(g=(l[p-1].x+l[p-1].y)/2,y<=g){y===g?o=p:e==="down"?(o=p-1,i=y/u>8):o=e==="up"||y-u>g-y||y/u>2?p:p-1;break}u=g}}const c=o===0?a:l[o-1];return{pyramidLevel:o,pyramidResolution:new E({x:c.x,y:c.y,spatialReference:t.spatialReference}),excessiveReading:i}}const s=Math.log(n.x/a.x)/Math.LN2,x=Math.log(n.y/a.y)/Math.LN2,h=t.storageInfo.maximumPyramidLevel||0;o=e==="down"?Math.floor(Math.min(s,x)):e==="up"?Math.ceil(Math.max(s,x)):Math.round((s+x)/2),o<0?o=0:o>h&&(i=o>h+3,o=h);const R=2**o;return{pyramidLevel:o,pyramidResolution:new E({x:R*t.nativePixelSize.x,y:R*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:i}}export{zn as B,qn as D,In as G,Ln as K,v as L,Fn as N,on as T,Jn as V,On as X,Xn as Z,Bn as k,un as y};
