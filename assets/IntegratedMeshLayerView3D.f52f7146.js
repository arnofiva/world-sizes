import{bE as v,bF as _,gJ as m,gK as f,dk as T,bZ as y,gL as s,r as g,be as x,bJ as c,bK as p,P as u,g as O,t as C,a as o,d as l,cV as S,n as N}from"./vendor.f59113c8.js";import{l as b}from"./I3SMeshView3D.64856d5d.js";import"./I3SAttributeOverrides.aae34906.js";import"./I3SNode.70e433a7.js";import"./I3SUtil.329b1a5b.js";import"./I3SBinaryReader.e417d1d0.js";import"./SceneModification.54e55ccb.js";import"./persistable.f2f26400.js";import"./Graphics3DScaleVisibility.6830207b.js";import"./optimizedFeatureQueryEngineAdapter.28cc0a99.js";import"./centroid.7fe573f3.js";import"./PooledRBush.17f5b4ee.js";import"./quickselect.02d2bace.js";import"./SceneLayerWorker.add8071b.js";import"./attributeUtils.987422a2.js";const H=.2;let a=class extends b(v(_)){constructor(){super(...arguments),this.type="integrated-mesh-3d",this.lodFactor=1,this._elevationContext="im",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=m.WithoutRasterImage,this._overlayTexOffset=f(-1,-1,-1,-1),this._overlayTexScale=T(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?H:1}setDrapingTextures(e){this._clearDrapingTexture(y.INNER),this._clearDrapingTexture(y.OUTER);for(const t of e){const i=t.index,r=t.extent,n=t.needsColorWithoutRasterImage?t.getValidTarget(s.ColorNoRasterImage):t.hasDrapedFeatureSource?t.getValidTarget(s.Color):null;if(g(n)&&x(r)>0){this._overlayTexOffset[2*i]=-r[0]/c(r),this._overlayTexOffset[2*i+1]=-r[1]/p(r),this._overlayTexScale[2*i]=1/c(r),this._overlayTexScale[2*i+1]=1/p(r);const h=t.getValidTarget(s.Highlight),d=t.getValidTarget(s.Water);this._overlayColor=n.getTexture(),this._overlayHighlight=h?h.getTexture():null,this._overlayNormal=d?d.getTexture():null}}this._forAllNodes(t=>g(t)&&this._collection.updateMaterial(t.objectHandle,i=>this._updateMaterialOverlay(i)))}_clearDrapingTexture(e){this._overlayTexOffset[2*e]=-1,this._overlayTexOffset[2*e+1]=-1,this._overlayTexScale[2*e]=0,this._overlayTexScale[2*e+1]=0,this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(()=>this.layer.modifications,()=>this._loadModifications(),u)}_createLayerGraphic(){const e=new O;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove("modifications"),C(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(()=>e,()=>this._modifications=e.toArray(),u),"modifications")}};o([l()],a.prototype,"layer",void 0),o([l({aliasOf:"layer"})],a.prototype,"i3slayer",void 0),o([l(S)],a.prototype,"updatingProgress",void 0),o([l({readOnly:!0,aliasOf:"_controller.updatingProgress"})],a.prototype,"updatingProgressValue",void 0),o([l({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],a.prototype,"lodFactor",void 0),o([l({readOnly:!0})],a.prototype,"progressiveLoadFactor",null),a=o([N("esri.views.3d.layers.SceneLayerView3D")],a);const j=a;export{j as default};
