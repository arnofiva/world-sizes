var v=Object.defineProperty,C=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var d=(t,i,e)=>i in t?v(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,p=(t,i)=>{for(var e in i||(i={}))w.call(i,e)&&d(t,e,i[e]);if(u)for(var e of u(i))S.call(i,e)&&d(t,e,i[e]);return t},y=(t,i)=>C(t,V(i));import{a as n,d as a,n as x,w as E,x as G,r as o,y as O,z as A,p as h,A as j,B as _,C as P,D as R,E as c,F as I,g,G as H,t as b,H as $,U as D,I as U,J as z,K as B}from"./vendor.f59113c8.js";import{b as q,L}from"./Graphics3DScaleVisibility.6830207b.js";import{d as T,l as k,s as M}from"./Graphics3DObjectStates.311f0ec9.js";let r=class extends E{constructor(t){super(t),this.type="graphics-3d",this.graphicsCore=null,this.elevationAlignment=new T,this._suspendResumeExtent=null}normalizeCtorArgs(t){const i=y(p({},t),{scaleVisibility:null,frustumVisibility:null});return delete i.scaleVisibilityEnabled,delete i.frustumVisibilityEnabled,t.scaleVisibilityEnabled&&(i.scaleVisibility=new q),t.frustumVisibilityEnabled&&(i.frustumVisibility=new k),i}initialize(){const t=new L({owner:this,layer:this.owner.layer,preferredUpdatePolicy:G.SYNC,graphicSymbolSupported:!0});this._set("graphicsCore",t);const{layer:i,scaleVisibility:e}=this;if(o(e)&&"effectiveScaleRange"in i){const s=i;this.updatingHandles.add(()=>s.effectiveScaleRange,()=>e.layerMinMaxScaleChangeHandler())}if("fullOpacity"in this.owner){const s=this.owner;this.updatingHandles.add(()=>s.fullOpacity,()=>this.graphicsCore.opacityChange())}if("elevationInfo"in i){const s=i;this.updatingHandles.add(()=>s.elevationInfo,(l,m)=>{O(l,m)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})}}async setup(){const t=(i,e,s)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(i,e,s);if(this.elevationAlignment.setup(this,t,this.graphicsCore,this.view.elevationProvider),o(this.scaleVisibility)&&"effectiveScaleRange"in this.layer){const i=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this,this.layer,t,this.graphicsCore,i)}o(this.frustumVisibility)&&this.frustumVisibility.setup(this),this._set("objectStates",new M(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(i){if(A(i))return;throw i}this.destroyed||(this.handles.add(this.view.watch("clippingArea",()=>this._updateClippingExtent(),!0)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("elevationAlignment",h(this.elevationAlignment)),this._set("scaleVisibility",h(this.scaleVisibility)),this._set("frustumVisibility",h(this.frustumVisibility)),this._set("objectStates",h(this.objectStates)),this._set("graphicsCore",h(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibilitySuspended(){return!(!o(this.scaleVisibility)||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return!(!o(this.frustumVisibility)||!this.frustumVisibility.suspended)}get suspended(){var t;return(t=this.owner.suspended)!=null&&t}get updating(){var t;return!!((t=this.graphicsCore)!=null&&t.updating||o(this.scaleVisibility)&&this.scaleVisibility.updating||o(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles.updating)}get graphics3DGraphics(){var t;return(t=this.graphicsCore)==null?void 0:t.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var t;return(t=this.graphicsCore)==null?void 0:t.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var t;return(t=this.owner.fullOpacity)!=null?t:1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get drapeSourceType(){return this.owner.drapeSourceType}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(t){this.graphicsCore.notifyGraphicGeometryChanged(t)}notifyGraphicVisibilityChanged(t){this.graphicsCore.notifyGraphicVisibilityChanged(t)}getRenderingInfo(t,i,e){const s=j(t,{renderer:i,arcade:e});if(o(s)&&s.color){const l=s.color;l[0]=l[0]/255,l[1]=l[1]/255,l[2]=l[2]/255}return s}getRenderingInfoAsync(t,i,e,s){return _(t,p({renderer:i,arcade:e},s))}getGraphicFromGraphicUid(t){if(this.owner.loadedGraphics){const i=this.owner.loadedGraphics.find(e=>e.uid===t);if(i){const e=this.layer instanceof P?this.layer:null;return R(i,e)}}}whenGraphicBounds(t,i){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,i):Promise.reject()}computeAttachmentOrigin(t,i){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,i):null}getSymbolLayerSize(t,i){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,i):null}maskOccludee(t){const{set:i,handle:e}=this.objectStates.acquireSet(c.MaskOccludee,null);return this.objectStates.setUid(i,t.uid),e}highlight(t){if(t instanceof I)return f;if(typeof t=="number")return this.highlight([t]);if(t instanceof g)return this.highlight([t]);if(t instanceof H&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof g){const i=t.map(l=>l.uid),{set:e,handle:s}=this.objectStates.acquireSet(c.Highlight,null);return this.objectStates.setUids(e,i),s}if(typeof t[0]=="number"){const i=t,{set:e,handle:s}=this.objectStates.acquireSet(c.Highlight,null);return this.objectStates.setObjectIds(e,i),s}}return f}_setupSuspendResumeExtent(){const{scaleVisibility:t,frustumVisibility:i}=this;if(b(t)&&b(i))return;const e=({computedExtent:s,extentPadding:l})=>{this._suspendResumeExtent=z(s,this._suspendResumeExtent,B,l),o(t)&&t.setExtent(this._suspendResumeExtent),o(i)&&i.setExtent(this._suspendResumeExtent)};this.handles.add($(()=>{var s,l;return{computedExtent:(s=this.graphicsCore)==null?void 0:s.computedExtent,extentPadding:(l=this.graphicsCore)==null?void 0:l.extentPadding}},s=>e(s),D))}_updateClippingExtent(){const t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};n([a()],r.prototype,"type",void 0),n([a({constructOnly:!0})],r.prototype,"owner",void 0),n([a()],r.prototype,"layer",null),n([a()],r.prototype,"view",null),n([a({constructOnly:!0})],r.prototype,"graphicsCore",void 0),n([a({constructOnly:!0})],r.prototype,"scaleVisibility",void 0),n([a({constructOnly:!0})],r.prototype,"frustumVisibility",void 0),n([a({readOnly:!0})],r.prototype,"elevationAlignment",void 0),n([a({readOnly:!0})],r.prototype,"objectStates",void 0),n([a({readOnly:!0})],r.prototype,"scaleVisibilitySuspended",null),n([a({readOnly:!0})],r.prototype,"frustumVisibilitySuspended",null),n([a()],r.prototype,"suspended",null),n([a({readOnly:!0})],r.prototype,"updating",null),n([a()],r.prototype,"loadedGraphics",null),n([a()],r.prototype,"fullOpacity",null),n([a()],r.prototype,"slicePlaneEnabled",null),n([a()],r.prototype,"drapeSourceType",null),n([a()],r.prototype,"updatePolicy",null),r=n([x("esri.views.3d.layers.graphics.GraphicsProcessor")],r);const f=U();export{r as O};
