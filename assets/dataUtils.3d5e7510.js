var Xt=Object.defineProperty,Zt=Object.defineProperties;var Qt=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var er=Object.prototype.hasOwnProperty,tr=Object.prototype.propertyIsEnumerable;var at=(e,t,r)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ie=(e,t)=>{for(var r in t||(t={}))er.call(t,r)&&at(e,r,t[r]);if(it)for(var r of it(t))tr.call(t,r)&&at(e,r,t[r]);return e},fe=(e,t)=>Zt(e,Qt(t));import{L as de,bI as rr,bU as or,eY as nr,r as Z,t as ze,dC as ir,a$ as we,a as V,d as W,aS as ar,n as qe,en as Xe,ao as st,d7 as sr,l as lt,aa as Lt,a6 as lr,lQ as Ut}from"./vendor.f59113c8.js";import{u as J}from"./PixelBlock.30fdfa76.js";import{p as cr,z as ct,y as Ot}from"./colorUtils.4a110f06.js";var Fe,ft,ut,Gt={exports:{}};ft=Gt,Fe=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,l=r?r.byteLength:0;if(t<l)return r;for(var f=512;f<t;)f<<=1;for(var s=new Uint8Array(f),u=0;u<l;++u)s[u]=r[u];return this.buffer=s},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var l=r+t;!this.eof&&this.bufferLength<l;)this.readBlock();var f=this.bufferLength;l>f&&(l=f)}else{for(;!this.eof;)this.readBlock();l=this.bufferLength}return this.pos=l,this.buffer.subarray(r,l)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,l){for(var f=t+r;this.bufferLength<=f&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,l)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(ut=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),l=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],f=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function s(i){throw new Error(i)}function u(i){var o=0,n=i[o++],h=i[o++];n!=-1&&h!=-1||s("Invalid header in flate stream"),(15&n)!=8&&s("Unknown compression method in flate stream"),((n<<8)+h)%31!=0&&s("Bad FCHECK in flate stream"),32&h&&s("FDICT bit set in flate stream"),this.bytes=i,this.bytesPos=o,this.codeSize=0,this.codeBuf=0,Fe.call(this)}return u.prototype=Object.create(Fe.prototype),u.prototype.getBits=function(i){for(var o,n=this.codeSize,h=this.codeBuf,c=this.bytes,a=this.bytesPos;n<i;)(o=c[a++])===void 0&&s("Bad encoding in flate stream"),h|=o<<n,n+=8;return o=h&(1<<i)-1,this.codeBuf=h>>i,this.codeSize=n-=i,this.bytesPos=a,o},u.prototype.getCode=function(i){for(var o=i[0],n=i[1],h=this.codeSize,c=this.codeBuf,a=this.bytes,d=this.bytesPos;h<n;){var w;(w=a[d++])===void 0&&s("Bad encoding in flate stream"),c|=w<<h,h+=8}var g=o[c&(1<<n)-1],C=g>>16,p=65535&g;return(h==0||h<C||C==0)&&s("Bad encoding in flate stream"),this.codeBuf=c>>C,this.codeSize=h-C,this.bytesPos=d,p},u.prototype.generateHuffmanTable=function(i){for(var o=i.length,n=0,h=0;h<o;++h)i[h]>n&&(n=i[h]);for(var c=1<<n,a=new Uint32Array(c),d=1,w=0,g=2;d<=n;++d,w<<=1,g<<=1)for(var C=0;C<o;++C)if(i[C]==d){var p=0,y=w;for(h=0;h<d;++h)p=p<<1|1&y,y>>=1;for(h=p;h<c;h+=g)a[h]=d<<16|C;++w}return[a,n]},u.prototype.readBlock=function(){function i(U,G,_,N,$){for(var q=U.getBits(_)+N;q-- >0;)G[g++]=$}var o=this.getBits(3);if(1&o&&(this.eof=!0),(o>>=1)!=0){var n,h;if(o==1)n=l,h=f;else if(o==2){for(var c=this.getBits(5)+257,a=this.getBits(5)+1,d=this.getBits(4)+4,w=Array(e.length),g=0;g<d;)w[e[g++]]=this.getBits(3);for(var C=this.generateHuffmanTable(w),p=0,y=(g=0,c+a),T=new Array(y);g<y;){var v=this.getCode(C);v==16?i(this,T,2,3,p):v==17?i(this,T,3,3,p=0):v==18?i(this,T,7,11,p=0):T[g++]=p=v}n=this.generateHuffmanTable(T.slice(0,c)),h=this.generateHuffmanTable(T.slice(c,y))}else s("Unknown block type in flate stream");for(var m=(L=this.buffer)?L.length:0,S=this.bufferLength;;){var b=this.getCode(n);if(b<256)S+1>=m&&(m=(L=this.ensureBuffer(S+1)).length),L[S++]=b;else{if(b==256)return void(this.bufferLength=S);var k=(b=t[b-=257])>>16;k>0&&(k=this.getBits(k)),p=(65535&b)+k,b=this.getCode(h),(k=(b=r[b])>>16)>0&&(k=this.getBits(k));var x=(65535&b)+k;S+p>=m&&(m=(L=this.ensureBuffer(S+p)).length);for(var A=0;A<p;++A,++S)L[S]=L[S-x]}}}else{var M,R=this.bytes,I=this.bytesPos;(M=R[I++])===void 0&&s("Bad block header in flate stream");var D=M;(M=R[I++])===void 0&&s("Bad block header in flate stream"),D|=M<<8,(M=R[I++])===void 0&&s("Bad block header in flate stream");var E=M;(M=R[I++])===void 0&&s("Bad block header in flate stream"),(E|=M<<8)!=(65535&~D)&&s("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var P=this.bufferLength,L=this.ensureBuffer(P+D),B=P+D;this.bufferLength=B;for(var F=P;F<B;++F){if((M=R[I++])===void 0){this.eof=!0;break}L[F]=M}this.bytesPos=I}},u}())!==void 0&&(ft.exports=ut);const be=Gt.exports;class Ze{constructor(t){t&&(this.canvas=t.canvas,this.ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,l){if(!t||t.byteLength<10)throw new de("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:f,height:s,format:u}=r;const{applyJpegMask:i}=r;if(i&&(!f||!s))throw new de("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((o,n)=>{let h=null;u==="jpg"&&i&&(h=Ze._getMask(t,{width:f,height:s}));const c=new Blob([new Uint8Array(t)],{type:"image/"+u=="jpg"?"jpeg":u}),a=URL.createObjectURL(c),d=new Image;let w;d.src=a,d.onload=()=>{if(URL.revokeObjectURL(a),rr(l))return void n(or());f=d.width,s=d.height,this.canvas?(this.canvas.width===f&&this.canvas.height===s||(this.canvas.width=f,this.canvas.height=s),this.ctx.clearRect(0,0,f,s)):(this.canvas=document.createElement("canvas"),this.canvas.width=f,this.canvas.height=s,this.ctx=this.canvas.getContext("2d")),this.ctx.drawImage(d,0,0);const g=this.ctx.getImageData(0,0,f,s);let C;if(w=g.data,r.renderOnCanvas){if(h)for(C=0;C<h.length;C++)h[C]?w[4*C+3]=255:w[4*C+3]=0;return this.ctx.putImageData(g,0,0),void o(null)}const p=f*s,y=new Uint8Array(p),T=new Uint8Array(p),v=new Uint8Array(p);if(h)for(C=0;C<p;C++)y[C]=w[4*C],T[C]=w[4*C+1],v[C]=w[4*C+2];else for(h=new Uint8Array(p),C=0;C<p;C++)y[C]=w[4*C],T[C]=w[4*C+1],v[C]=w[4*C+2],h[C]=w[4*C+3];o({width:f,height:s,pixels:[y,T,v],mask:h,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(a),n("cannot load image")}})}static _getMask(t,r){let l=null;try{const f=new Uint8Array(t),s=Math.ceil(f.length/2);let u=0;const i=f.length-2;for(u=s;u<i&&(f[u]!==255||f[u+1]!==217);u++);if(u+=2,u<f.length-1){const o=new be(f.subarray(u)).getBytes();l=new Uint8Array(r.width*r.height);let n=0;for(let h=0;h<o.length;h++)for(let c=7;c>=0;c--)l[n++]=o[h]>>c&1}}catch{}return l}}var ht,dt,pt,_t={exports:{}};ht=_t,dt=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,l=799,f=3406,s=2276,u=1567,i=3784,o=5793,n=2896;function h(){this.decodeTransform=null,this.colorTransform=-1}function c(p,y){for(var T,v,m=0,S=[],b=16;b>0&&!p[b-1];)b--;S.push({children:[],index:0});var k,x=S[0];for(T=0;T<b;T++){for(v=0;v<p[T];v++){for((x=S.pop()).children[x.index]=y[m];x.index>0;)x=S.pop();for(x.index++,S.push(x);S.length<=T;)S.push(k={children:[],index:0}),x.children[x.index]=k.children,x=k;m++}T+1<b&&(S.push(k={children:[],index:0}),x.children[x.index]=k.children,x=k)}return S[0].children}function a(p,y,T){return 64*((p.blocksPerLine+1)*y+T)}function d(p,y,T,v,m,S,b,k,x){var A=T.mcusPerLine,M=T.progressive,R=y,I=0,D=0;function E(){if(D>0)return D--,I>>D&1;if((I=p[y++])===255){var O=p[y++];if(O)throw new e("unexpected marker "+(I<<8|O).toString(16))}return D=7,I>>>7}function P(O){for(var j=O;;){if(typeof(j=j[E()])=="number")return j;if(typeof j!="object")throw new e("invalid huffman sequence")}}function L(O){for(var j=0;O>0;)j=j<<1|E(),O--;return j}function B(O){if(O===1)return E()===1?1:-1;var j=L(O);return j>=1<<O-1?j:j+(-1<<O)+1}function F(O,j){var z=P(O.huffmanTableDC),ee=z===0?0:B(z);O.blockData[j]=O.pred+=ee;for(var oe=1;oe<64;){var le=P(O.huffmanTableAC),te=15&le,ne=le>>4;if(te!==0){var qt=t[oe+=ne];O.blockData[j+qt]=B(te),oe++}else{if(ne<15)break;oe+=16}}}function U(O,j){var z=P(O.huffmanTableDC),ee=z===0?0:B(z)<<x;O.blockData[j]=O.pred+=ee}function G(O,j){O.blockData[j]|=E()<<x}var _=0;function N(O,j){if(_>0)_--;else for(var z=S,ee=b;z<=ee;){var oe=P(O.huffmanTableAC),le=15&oe,te=oe>>4;if(le!==0){var ne=t[z+=te];O.blockData[j+ne]=B(le)*(1<<x),z++}else{if(te<15){_=L(te)+(1<<te)-1;break}z+=16}}}var $,q=0;function Q(O,j){for(var z,ee,oe=S,le=b,te=0;oe<=le;){var ne=t[oe];switch(q){case 0:if(te=(ee=P(O.huffmanTableAC))>>4,(z=15&ee)==0)te<15?(_=L(te)+(1<<te),q=4):(te=16,q=1);else{if(z!==1)throw new e("invalid ACn encoding");$=B(z),q=te?2:3}continue;case 1:case 2:O.blockData[j+ne]?O.blockData[j+ne]+=E()<<x:--te==0&&(q=q===2?3:0);break;case 3:O.blockData[j+ne]?O.blockData[j+ne]+=E()<<x:(O.blockData[j+ne]=$<<x,q=0);break;case 4:O.blockData[j+ne]&&(O.blockData[j+ne]+=E()<<x)}oe++}q===4&&--_==0&&(q=0)}function Se(O,j,z,ee,oe){var le=z%A;j(O,a(O,(z/A|0)*O.v+ee,le*O.h+oe))}function xe(O,j,z){j(O,a(O,z/O.blocksPerLine|0,z%O.blocksPerLine))}var ce,ae,ue,pe,Y,Me,me=v.length;Me=M?S===0?k===0?U:G:k===0?N:Q:F;var se,ge,Ee,Pe,he=0;for(ge=me===1?v[0].blocksPerLine*v[0].blocksPerColumn:A*T.mcusPerColumn;he<ge;){var Le=m?Math.min(ge-he,m):ge;for(ae=0;ae<me;ae++)v[ae].pred=0;if(_=0,me===1)for(ce=v[0],Y=0;Y<Le;Y++)xe(ce,Me,he),he++;else for(Y=0;Y<Le;Y++){for(ae=0;ae<me;ae++)for(Ee=(ce=v[ae]).h,Pe=ce.v,ue=0;ue<Pe;ue++)for(pe=0;pe<Ee;pe++)Se(ce,Me,he,ue,pe);he++}D=0,(se=C(p,y))&&se.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+se.invalid),y=se.offset);var ye=se&&se.marker;if(!ye||ye<=65280)throw new e("marker was not found");if(!(ye>=65488&&ye<=65495))break;y+=2}return(se=C(p,y))&&se.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+se.invalid),y=se.offset),y-R}function w(p,y,T){var v,m,S,b,k,x,A,M,R,I,D,E,P,L,B,F,U,G=p.quantizationTable,_=p.blockData;if(!G)throw new e("missing required Quantization Table.");for(var N=0;N<64;N+=8)R=_[y+N],I=_[y+N+1],D=_[y+N+2],E=_[y+N+3],P=_[y+N+4],L=_[y+N+5],B=_[y+N+6],F=_[y+N+7],R*=G[N],(I|D|E|P|L|B|F)!=0?(I*=G[N+1],D*=G[N+2],E*=G[N+3],P*=G[N+4],L*=G[N+5],B*=G[N+6],F*=G[N+7],m=(v=(v=o*R+128>>8)+(m=o*P+128>>8)+1>>1)-m,U=(S=D)*i+(b=B)*u+128>>8,S=S*u-b*i+128>>8,A=(k=(k=n*(I-F)+128>>8)+(A=L<<4)+1>>1)-A,x=(M=(M=n*(I+F)+128>>8)+(x=E<<4)+1>>1)-x,b=(v=v+(b=U)+1>>1)-b,S=(m=m+S+1>>1)-S,U=k*s+M*f+2048>>12,k=k*f-M*s+2048>>12,M=U,U=x*l+A*r+2048>>12,x=x*r-A*l+2048>>12,A=U,T[N]=v+M,T[N+7]=v-M,T[N+1]=m+A,T[N+6]=m-A,T[N+2]=S+x,T[N+5]=S-x,T[N+3]=b+k,T[N+4]=b-k):(U=o*R+512>>10,T[N]=U,T[N+1]=U,T[N+2]=U,T[N+3]=U,T[N+4]=U,T[N+5]=U,T[N+6]=U,T[N+7]=U);for(var $=0;$<8;++$)R=T[$],((I=T[$+8])|(D=T[$+16])|(E=T[$+24])|(P=T[$+32])|(L=T[$+40])|(B=T[$+48])|(F=T[$+56]))!=0?(m=(v=4112+((v=o*R+2048>>12)+(m=o*P+2048>>12)+1>>1))-m,U=(S=D)*i+(b=B)*u+2048>>12,S=S*u-b*i+2048>>12,b=U,A=(k=(k=n*(I-F)+2048>>12)+(A=L)+1>>1)-A,x=(M=(M=n*(I+F)+2048>>12)+(x=E)+1>>1)-x,U=k*s+M*f+2048>>12,k=k*f-M*s+2048>>12,M=U,U=x*l+A*r+2048>>12,x=x*r-A*l+2048>>12,R=(R=(v=v+b+1>>1)+M)<16?0:R>=4080?255:R>>4,I=(I=(m=m+S+1>>1)+(A=U))<16?0:I>=4080?255:I>>4,D=(D=(S=m-S)+x)<16?0:D>=4080?255:D>>4,E=(E=(b=v-b)+k)<16?0:E>=4080?255:E>>4,P=(P=b-k)<16?0:P>=4080?255:P>>4,L=(L=S-x)<16?0:L>=4080?255:L>>4,B=(B=m-A)<16?0:B>=4080?255:B>>4,F=(F=v-M)<16?0:F>=4080?255:F>>4,_[y+$]=R,_[y+$+8]=I,_[y+$+16]=D,_[y+$+24]=E,_[y+$+32]=P,_[y+$+40]=L,_[y+$+48]=B,_[y+$+56]=F):(U=(U=o*R+8192>>14)<-2040?0:U>=2024?255:U+2056>>4,_[y+$]=U,_[y+$+8]=U,_[y+$+16]=U,_[y+$+24]=U,_[y+$+32]=U,_[y+$+40]=U,_[y+$+48]=U,_[y+$+56]=U)}function g(p,y){for(var T=y.blocksPerLine,v=y.blocksPerColumn,m=new Int16Array(64),S=0;S<v;S++)for(var b=0;b<T;b++)w(y,a(y,S,b),m);return y.blockData}function C(p,y,T){function v(x){return p[x]<<8|p[x+1]}var m=p.length-1,S=T<y?T:y;if(y>=m)return null;var b=v(y);if(b>=65472&&b<=65534)return{invalid:null,marker:b,offset:y};for(var k=v(S);!(k>=65472&&k<=65534);){if(++S>=m)return null;k=v(S)}return{invalid:b.toString(16),marker:k,offset:S}}return h.prototype={parse:function(p){function y(){var O=p[b]<<8|p[b+1];return b+=2,O}function T(){var O=y(),j=b+O-2,z=C(p,j,b);z&&z.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+z.invalid),j=z.offset);var ee=p.subarray(b,j);return b+=ee.length,ee}function v(O){for(var j=Math.ceil(O.samplesPerLine/8/O.maxH),z=Math.ceil(O.scanLines/8/O.maxV),ee=0;ee<O.components.length;ee++){Y=O.components[ee];var oe=Math.ceil(Math.ceil(O.samplesPerLine/8)*Y.h/O.maxH),le=Math.ceil(Math.ceil(O.scanLines/8)*Y.v/O.maxV),te=j*Y.h,ne=z*Y.v*64*(te+1);Y.blockData=new Int16Array(ne),Y.blocksPerLine=oe,Y.blocksPerColumn=le}O.mcusPerLine=j,O.mcusPerColumn=z}var m,S,b=0,k=null,x=null,A=[],M=[],R=[],I=y();if(I!==65496)throw new e("SOI not found");for(I=y();I!==65497;){var D,E,P;switch(I){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var L=T();I===65504&&L[0]===74&&L[1]===70&&L[2]===73&&L[3]===70&&L[4]===0&&(k={version:{major:L[5],minor:L[6]},densityUnits:L[7],xDensity:L[8]<<8|L[9],yDensity:L[10]<<8|L[11],thumbWidth:L[12],thumbHeight:L[13],thumbData:L.subarray(14,14+3*L[12]*L[13])}),I===65518&&L[0]===65&&L[1]===100&&L[2]===111&&L[3]===98&&L[4]===101&&(x={version:L[5]<<8|L[6],flags0:L[7]<<8|L[8],flags1:L[9]<<8|L[10],transformCode:L[11]});break;case 65499:for(var B=y()+b-2;b<B;){var F=p[b++],U=new Uint16Array(64);if(F>>4==0)for(E=0;E<64;E++)U[t[E]]=p[b++];else{if(F>>4!=1)throw new e("DQT - invalid table spec");for(E=0;E<64;E++)U[t[E]]=y()}A[15&F]=U}break;case 65472:case 65473:case 65474:if(m)throw new e("Only single frame JPEGs supported");y(),(m={}).extended=I===65473,m.progressive=I===65474,m.precision=p[b++],m.scanLines=y(),m.samplesPerLine=y(),m.components=[],m.componentIds={};var G,_=p[b++],N=0,$=0;for(D=0;D<_;D++){G=p[b];var q=p[b+1]>>4,Q=15&p[b+1];N<q&&(N=q),$<Q&&($=Q);var Se=p[b+2];P=m.components.push({h:q,v:Q,quantizationId:Se,quantizationTable:null}),m.componentIds[G]=P-1,b+=3}m.maxH=N,m.maxV=$,v(m);break;case 65476:var xe=y();for(D=2;D<xe;){var ce=p[b++],ae=new Uint8Array(16),ue=0;for(E=0;E<16;E++,b++)ue+=ae[E]=p[b];var pe=new Uint8Array(ue);for(E=0;E<ue;E++,b++)pe[E]=p[b];D+=17+ue,(ce>>4==0?R:M)[15&ce]=c(ae,pe)}break;case 65501:y(),S=y();break;case 65498:y();var Y,Me=p[b++],me=[];for(D=0;D<Me;D++){var se=m.componentIds[p[b++]];Y=m.components[se];var ge=p[b++];Y.huffmanTableDC=R[ge>>4],Y.huffmanTableAC=M[15&ge],me.push(Y)}var Ee=p[b++],Pe=p[b++],he=p[b++],Le=d(p,b,m,me,S,Ee,Pe,he>>4,15&he);b+=Le;break;case 65535:p[b]!==255&&b--;break;default:if(p[b-3]===255&&p[b-2]>=192&&p[b-2]<=254){b-=3;break}throw new e("unknown marker "+I.toString(16))}I=y()}for(this.width=m.samplesPerLine,this.height=m.scanLines,this.jfif=k,this.eof=b,this.adobe=x,this.components=[],D=0;D<m.components.length;D++){var ye=A[(Y=m.components[D]).quantizationId];ye&&(Y.quantizationTable=ye),this.components.push({output:g(m,Y),scaleX:Y.h/m.maxH,scaleY:Y.v/m.maxV,blocksPerLine:Y.blocksPerLine,blocksPerColumn:Y.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(p,y){var T,v,m,S,b,k,x,A,M,R,I,D=this.width/p,E=this.height/y,P=0,L=this.components.length,B=p*y*L,F=new Uint8ClampedArray(B),U=new Uint32Array(p),G=4294967288;for(x=0;x<L;x++){for(v=(T=this.components[x]).scaleX*D,m=T.scaleY*E,P=x,I=T.output,S=T.blocksPerLine+1<<3,b=0;b<p;b++)A=0|b*v,U[b]=(A&G)<<3|7&A;for(k=0;k<y;k++)for(R=S*((A=0|k*m)&G)|(7&A)<<3,b=0;b<p;b++)F[P]=I[R+U[b]],P+=L}var _=this.decodeTransform;if(_)for(x=0;x<B;)for(A=0,M=0;A<L;A++,x++,M+=2)F[x]=(F[x]*_[M]>>8)+_[M+1];return F},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(p){for(var y,T,v,m=0,S=p.length;m<S;m+=3)y=p[m],T=p[m+1],v=p[m+2],p[m]=y-179.456+1.402*v,p[m+1]=y+135.459-.344*T-.714*v,p[m+2]=y-226.816+1.772*T;return p},_convertYcckToRgb:function(p){for(var y,T,v,m,S=0,b=0,k=p.length;b<k;b+=4)y=p[b],T=p[b+1],v=p[b+2],m=p[b+3],p[S++]=T*(-660635669420364e-19*T+.000437130475926232*v-54080610064599e-18*y+.00048449797120281*m-.154362151871126)-122.67195406894+v*(-.000957964378445773*v+.000817076911346625*y-.00477271405408747*m+1.53380253221734)+y*(.000961250184130688*y-.00266257332283933*m+.48357088451265)+m*(-.000336197177618394*m+.484791561490776),p[S++]=107.268039397724+T*(219927104525741e-19*T-.000640992018297945*v+.000659397001245577*y+.000426105652938837*m-.176491792462875)+v*(-.000778269941513683*v+.00130872261408275*y+.000770482631801132*m-.151051492775562)+y*(.00126935368114843*y-.00265090189010898*m+.25802910206845)+m*(-.000318913117588328*m-.213742400323665),p[S++]=T*(-.000570115196973677*T-263409051004589e-19*v+.0020741088115012*y-.00288260236853442*m+.814272968359295)-20.810012546947+v*(-153496057440975e-19*v-.000132689043961446*y+.000560833691242812*m-.195152027534049)+y*(.00174418132927582*y-.00255243321439347*m+.116935020465145)+m*(-.000343531996510555*m+.24165260232407);return p},_convertYcckToCmyk:function(p){for(var y,T,v,m=0,S=p.length;m<S;m+=4)y=p[m],T=p[m+1],v=p[m+2],p[m]=434.456-y-1.402*v,p[m+1]=119.541-y+.344*T+.714*v,p[m+2]=481.816-y-1.772*T;return p},_convertCmykToRgb:function(p){for(var y,T,v,m,S=0,b=1/255,k=0,x=p.length;k<x;k+=4)y=p[k]*b,T=p[k+1]*b,v=p[k+2]*b,m=p[k+3]*b,p[S++]=255+y*(-4.387332384609988*y+54.48615194189176*T+18.82290502165302*v+212.25662451639585*m-285.2331026137004)+T*(1.7149763477362134*T-5.6096736904047315*v-17.873870861415444*m-5.497006427196366)+v*(-2.5217340131683033*v-21.248923337353073*m+17.5119270841813)-m*(21.86122147463605*m+189.48180835922747),p[S++]=255+y*(8.841041422036149*y+60.118027045597366*T+6.871425592049007*v+31.159100130055922*m-79.2970844816548)+T*(-15.310361306967817*T+17.575251261109482*v+131.35250912493976*m-190.9453302588951)+v*(4.444339102852739*v+9.8632861493405*m-24.86741582555878)-m*(20.737325471181034*m+187.80453709719578),p[S++]=255+y*(.8842522430003296*y+8.078677503112928*T+30.89978309703729*v-.23883238689178934*m-14.183576799673286)+T*(10.49593273432072*T+63.02378494754052*v+50.606957656360734*m-112.23884253719248)+v*(.03296041114873217*v+115.60384449646641*m-193.58209356861505)-m*(22.33816807309886*m+180.12613974708367);return p},getData:function(p,y,T){if(this.numComponents>4)throw new e("Unsupported color mode");var v=this._getLinearizedBlockData(p,y);if(this.numComponents===1&&T){for(var m=v.length,S=new Uint8ClampedArray(3*m),b=0,k=0;k<m;k++){var x=v[k];S[b++]=x,S[b++]=x,S[b++]=x}return S}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(v);if(this.numComponents===4){if(this._isColorConversionNeeded())return T?this._convertYcckToRgb(v):this._convertYcckToCmyk(v);if(T)return this._convertCmykToRgb(v)}return v}},h}()},(pt=dt())!==void 0&&(ht.exports=pt);const _e=_t.exports;class fr{static decode(t){const r=new Uint8Array(t),l=new _e;l.parse(r);const{width:f,height:s,numComponents:u,eof:i}=l,o=l.getData(f,s,!0);let n;const h=f*s;let c=0,a=0,d=0;if(i<r.length-1){const C=new be(r.subarray(i)).getBytes();n=new Uint8Array(h);let p=0;for(c=0;c<C.length;c++)for(d=7;d>=0;d--)n[p++]=C[c]>>d&1}let w,g=null;if(u===1)g=[o,o,o];else{for(g=[],c=0;c<3;c++)w=new Uint8Array(h),g.push(w);for(d=0,a=0;a<h;a++)for(c=0;c<3;c++)g[c][a]=o[d++]}return{width:f,height:s,pixels:g,mask:n}}}const Bt=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let $e=null;function Nt(){return $e||($e=import("./lerc-wasm.4c614b8b.js").then(e=>e.l).then(({default:e})=>e({locateFile:t=>nr(`esri/layers/support/rasterFormats/${t}`)})).then(e=>{hr(e)}),$e)}const Be={getBlobInfo:null,decode:null};function ur(e){return 16+(e>>3<<3)}function hr(e){const{_malloc:t,_free:r,_lerc_getBlobInfo:l,_lerc_getDataRanges:f,_lerc_decode_4D:s,asm:u}=e;let i;const o=Object.values(u).find(h=>h&&"buffer"in h&&h.buffer===e.HEAPU8.buffer),n=h=>{const c=h.map(g=>ur(g)),a=c.reduce((g,C)=>g+C),d=t(a);i=new Uint8Array(o.buffer);let w=c[0];c[0]=d;for(let g=1;g<c.length;g++){const C=c[g];c[g]=c[g-1]+w,w=C}return c};Be.getBlobInfo=h=>{const d=new Uint8Array(48),w=new Uint8Array(8*3),[g,C,p]=n([h.length,d.length,w.length]);i.set(h,g),i.set(d,C),i.set(w,p);let y=l(g,h.length,C,p,12,3);if(y)throw r(g),`lerc-getBlobInfo: error code is ${y}`;i=new Uint8Array(o.buffer),d.set(i.slice(C,C+d.length)),w.set(i.slice(p,p+w.length));const T=new Uint32Array(d.buffer),v=new Float64Array(w.buffer),[m,S,b,k,x,A,M,R,I,,D]=T,E={version:m,dimCount:b,width:k,height:x,validPixelCount:M,bandCount:A,blobSize:R,maskCount:I,dataType:S,minValue:v[0],maxValue:v[1],maxZerror:v[2],statistics:[],bandCountWithNoData:D};if(D)return E;if(b===1&&A===1)return r(g),E.statistics.push({minValue:v[0],maxValue:v[1]}),E;const P=b*A*8,L=new Uint8Array(P),B=new Uint8Array(P);let F,U=g,G=0,_=!1;if(i.byteLength<g+2*P?(r(g),_=!0,[U,G,F]=n([h.length,P,P]),i.set(h,U)):[G,F]=n([P,P]),i.set(L,G),i.set(B,F),y=f(g,h.length,b,A,G,F),y)throw r(U),_||r(G),`lerc-getDataRanges: error code is ${y}`;i=new Uint8Array(o.buffer),L.set(i.slice(G,G+P)),B.set(i.slice(F,F+P));const N=new Float64Array(L.buffer),$=new Float64Array(B.buffer),q=E.statistics;for(let Q=0;Q<A;Q++)if(b>1){const Se=N.slice(Q*b,(Q+1)*b),xe=$.slice(Q*b,(Q+1)*b),ce=Math.min.apply(null,Se),ae=Math.max.apply(null,xe);q.push({minValue:ce,maxValue:ae,dimStats:{minValues:Se,maxValues:xe}})}else q.push({minValue:N[Q],maxValue:$[Q]});return r(U),_||r(G),E},Be.decode=(h,c)=>{const{maskCount:a,dimCount:d,bandCount:w,width:g,height:C,dataType:p,bandCountWithNoData:y}=c,T=Bt[p],v=g*C,m=new Uint8Array(v*w),S=v*d*w*T.size,b=new Uint8Array(S),k=new Uint8Array(w),x=8*w,A=new Uint8Array(x),[M,R,I,D,E]=n([h.length,m.length,b.length,k.length,A.length]);i.set(h,M),i.set(m,R),i.set(b,I),i.set(k,D),i.set(A,E);const P=s(M,h.length,a,R,d,g,C,w,p,I,D,E);if(P)throw r(M),`lerc-decode: error code is ${P}`;i=new Uint8Array(o.buffer),b.set(i.slice(I,I+S)),m.set(i.slice(R,R+v));let L=null;if(y){k.set(i.slice(D,D+w)),A.set(i.slice(E,E+x)),L=[];for(let B=0;B<k.length;B++)L.push(k[B]?A[B]:null)}return r(M),{data:b,maskData:m,noDataValues:L}}}function dr(e,t,r,l,f){if(r<2)return e;const s=new l(t*r);if(f)for(let u=0,i=0;u<t;u++)for(let o=0,n=u;o<r;o++,n+=t)s[n]=e[i++];else for(let u=0,i=0;u<t;u++)for(let o=0,n=u;o<r;o++,n+=t)s[i++]=e[n];return s}function Ft(e,t={}){var r;const l=(r=t.inputOffset)!=null?r:0,f=e instanceof Uint8Array?e.subarray(l):new Uint8Array(e,l),s=Be.getBlobInfo(f),{data:u,maskData:i}=Be.decode(f,s),{width:o,height:n,bandCount:h,dimCount:c,dataType:a,maskCount:d,statistics:w}=s,g=Bt[a],C=new g.ctor(u.buffer),p=[],y=[],T=o*n,v=T*c;for(let x=0;x<h;x++){const A=C.subarray(x*v,(x+1)*v);if(t.returnPixelInterleavedDims)p.push(A);else{const M=dr(A,T,c,g.ctor,!0);p.push(M)}y.push(i.subarray(x*v,(x+1)*v))}const m=d===0?null:d===1?y[0]:new Uint8Array(T);if(d>1){m.set(y[0]);for(let x=1;x<y.length;x++){const A=y[x];for(let M=0;M<T;M++)m[M]=m[M]&A[M]}}const{noDataValue:S}=t,b=S!=null&&g.range[0]<=S&&g.range[1]>=S;if(d>0&&b){const{noDataValue:x}=t;for(let A=0;A<h;A++){const M=p[A],R=y[A]||m;for(let I=0;I<T;I++)R[I]===0&&(M[I]=x)}}const k=d===h&&h>1?y:null;return{width:o,height:n,bandCount:h,pixelType:t.pixelType&&s.version===0?t.pixelType:g.pixelType,dimCount:c,statistics:w,pixels:p,mask:m,bandMasks:k}}function pr(e,t,r,l=!0){if(t%4!=0||r%4!=0){const f=new ArrayBuffer(4*Math.ceil(r/4)),s=new Uint8Array(f),u=new Uint8Array(e,t,r);if(l)for(let i=0;i<s.length;i+=4)s[i]=u[i+3],s[i+1]=u[i+2],s[i+2]=u[i+1],s[i+3]=u[i];else s.set(u);return new Uint32Array(s.buffer)}if(l){const f=new Uint8Array(e,t,r),s=new Uint8Array(f.length);for(let u=0;u<s.length;u+=4)s[u]=f[u+3],s[u+1]=f[u+2],s[u+2]=f[u+1],s[u+3]=f[u];return new Uint32Array(s.buffer)}return new Uint32Array(e,t,r/4)}function mt(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function gt(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const ke=new Set;function Qe(e,t,r,l=!0){const f=pr(e,t,r,l);let s=9,u=mt(),i=32,o=u.length,n=[],h=1,c=f[0],a=0;const d=f.length,w=8*(4*d-r),g=[];for(;c!=null;){if(i>=s)i-=s,a=c>>>32-s,c<<=s;else{a=c>>>32-i,c=f[h++];const p=s-i;i=32-p,a=(a<<p)+(c>>>i),c<<=p}if(a===257)break;if(a===256){s=9,u=mt(),o=u.length,n=[];continue}const C=u[a];if(C==null){if(a>u.length)throw"data integrity issue: code does not exist on code page";n.push(n[0]),u[o++]=n.slice(),gt(g,n)}else gt(g,C),n.push(C[0]),n.length>1&&(u[o++]=n.slice()),n=C.slice();if(ke.has(o)&&s++,i===0&&(c=f[h++],i=32),h>d||h===d&&i<=w)break}return new Uint8Array(g)}ke.add(511),ke.add(1023),ke.add(2047),ke.add(4095),ke.add(8191);const yt=function(e,t){const r=t.width*t.height,l=t.pixelType;return Math.floor(e.byteLength/(r*$t(l)))},$t=function(e){let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},mr=function(e,t){if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),l=new Uint8Array(t);let f=0,s=0,u=0,i=0;for(u=0;u<r.length-1;u++)for(s=r[u],i=7;i>=0;i--)l[f++]=s>>i&1;for(i=7;f<t-1;)s=r[r.length-1],l[f++]=s>>i&1,i--;return l};class gr{static decode(t,r){const l=r.pixelType,f=[],s=r.width*r.height,u=yt(t,r),{bandIds:i,format:o}=r,n=i&&i.length||yt(t,r),h=t.byteLength-t.byteLength%(s*$t(l)),c=new l(t,0,s*u);let a,d,w,g,C;if(o==="bip")for(a=0;a<n;a++){for(g=new l(s),C=i?i[a]:a,d=0;d<s;d++)g[d]=c[d*u+C];f.push(g)}else if(o==="bsq")for(a=0;a<n;a++)C=i?i[a]:a,f.push(c.subarray(C*s,(C+1)*s));return h<t.byteLength-1&&(w=mr(t.slice(h),s)),{pixels:f,mask:w}}}function yr(e,t){let r=0,l="",f=0,s=0;const u=e.length;for(;r<u;)s=e[r++],f=s>>4,f<8?f=1:f===15?(f=4,s=(7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):f===14?(f=3,s=(15&s)<<12|(63&e[r++])<<6|63&e[r++]):(f=2,s=(31&s)<<6|63&e[r++]),(s!==0||t)&&(l+=String.fromCharCode(s));return l}const et=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),wr=(()=>{const e=[].concat(et);return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),Cr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],vr=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),Tr=function(e,t){let r=(t||et)[e];return r===void 0&&(r="unknown"+String(e)),r},Ye=new Map;Ye.set("EXIFIFD",wr),Ye.set("GPSIFD",Cr);const Ae={TIFF_TAGS:et,ifdTags:Ye,GEO_KEYS:vr,getTagName:Tr},tt=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),wt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Ie=4294967296,br=new Set([1,5,6,7,8,34712,34887]);function Vt(e,t){let r="unknown";return e===3?r="f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function Ne(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;default:t=Float32Array}return t}function Sr(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function jt(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Te(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Ve(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function K(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function je(e,t,r,l=0,f=Ae.TIFF_TAGS,s=4){const u=s===8,i=u?nt(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),o=4+2*s,n=u?8:2,h=n+i*o;if(r+h>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:h};const c=r+h+4<=e.byteLength?Ge(new DataView(e,r+h,s===8?8:4),0,t,s===8):null,a=r+n,d=new Map;let w,g,C,p,y,T,v;for(let m=0;m<i;m++){g=new DataView(e,a+o*m,o),C=g.getUint16(0,t),y=g.getUint16(2,t),p=Ae.getTagName(C,f);const S=[];s===2?(T=g.getUint16(4,t),v=g.getUint16(6,t)):s===4?(T=g.getUint32(4,t),v=g.getUint32(8,t)):s===8&&(T=Ge(g,4,t,!0),v=Ge(g,12,t,!0),S.push(g.getUint32(12,t)),S.push(g.getUint32(16,t))),w={id:C,type:y,valueCount:T,valueOffset:v,valueOffsets:S,values:null},Dr(e,t,w,l,!1,s),d.set(p,w)}return{success:!0,ifd:d,nextIFD:c,requiredBufferSize:h}}const xr=function(e,t){return Ft(e,{inputOffset:t}).pixels[0]};async function Je(e,t,r,l,f){var s,u;const i=tt===t,o=K(r,"BITSPERSAMPLE"),n=Vt((s=K(r,"SAMPLEFORMAT"))!=null?s:1,o),h=(u=K(r,"COMPRESSION"))!=null?u:1,c=Ne(n);let a,d,w,g,C,p,y;if(h===34887)return await Nt(),xr(e,l);if(h===1)w=e.slice(l,l+f),g=new Uint8Array(w);else if(h===8||h===32946)g=new Uint8Array(e,l,f),p=new be(g),y=p.getBytes(),w=new ArrayBuffer(y.length),g=new Uint8Array(w),g.set(y);else if(h===6){g=new Uint8Array(e,l,f);const T=new _e;T.parse(g);const v=T.getData(T.width,T.height,!0);w=new ArrayBuffer(v.length),g=new Uint8Array(w),g.set(v)}else if(h===7){const T=r.get("JPEGTABLES").values,v=T.length-2;g=new Uint8Array(v+f-2);for(let k=0;k<v;k++)g[k]=T[k];const m=new Uint8Array(e,l+2,f-2);for(let k=0;k<m.length;k++)g[v+k]=m[k];const S=new _e;S.parse(g);const b=S.getData(S.width,S.height,!0);w=new ArrayBuffer(b.length),g=new Uint8Array(w),g.set(b)}else h===5&&(g=Qe(e,l,f,t),w=g.buffer);if(n==="u8"||n==="s8"||i)d=new c(w);else{switch(w=new ArrayBuffer(g.length),C=new Uint8Array(w),n){case"u16":case"s16":for(a=0;a<g.length;a+=2)C[a]=g[a+1],C[a+1]=g[a];break;case"u32":case"s32":case"f32":for(a=0;a<g.length;a+=4)C[a]=g[a+3],C[a+1]=g[a+2],C[a+2]=g[a+1],C[a+3]=g[a]}d=new c(w)}return d}async function kr(e,t,r){var l;const f=Te(r,"TILEOFFSETS");if(f===void 0)return null;const s=Te(r,"TILEBYTECOUNTS"),{width:u,height:i,pixelType:o,tileWidth:n,tileHeight:h}=rt([r]),c=ot(r,t),a=t.planes,d=u*i,w=K(r,"BITSPERSAMPLE"),g=((l=K(r,"COMPRESSION"))!=null?l:1)===34887,C=Ne(o),p=[];for(let P=0;P<a;P++)p.push(new C(d));let y,T,v,m,S,b,k,x,A,M,R,I,D;const E=Math.ceil(u/n);if(w%8==0)if(g&&c&&a>1){const P=Math.round(f.length/a);for(y=0;y<P;y++){b=Math.floor(y/E)*h,k=y%E*n,x=b*u+k;for(let L=0;L<a;L++){const B=y*a+L;for(v=await Je(e,t.littleEndian,r,f[B],s[B]),M=0,A=x,I=Math.min(n,u-k),R=Math.min(h,i-b),D=p[L],m=0;m<R;m++)for(A=x+m*u,M=m*n,S=0;S<I;S++,A++,M++)D[A]=v[M]}}}else for(y=0;y<f.length;y++)for(b=Math.floor(y/E)*h,k=y%E*n,x=b*u+k,v=await Je(e,t.littleEndian,r,f[y],s[y]),M=0,A=x,I=Math.min(n,u-k),R=Math.min(h,i-b),T=0;T<a;T++)if(D=p[T],c||g)for(m=0;m<R;m++)for(A=x+m*u,M=n*h*T+m*n,S=0;S<I;S++,A++,M++)D[A]=v[M];else for(m=0;m<R;m++)for(A=x+m*u,M=m*n*a+T,S=0;S<I;S++,A++,M+=a)D[A]=v[M];return{width:u,height:i,pixelType:o,pixels:p}}const Ar=function(e,t,r){var l;const f=tt===t.littleEndian,s=Te(r,"STRIPOFFSETS");if(s===void 0)return null;const{width:u,height:i,pixelType:o}=rt([r]),n=t.planes,h=u*i,c=K(r,"BITSPERSAMPLE"),a=Ne(o),d=new a(h*n),w=Te(r,"STRIPBYTECOUNTS"),g=K(r,"ROWSPERSTRIP"),C=(l=K(r,"COMPRESSION"))!=null?l:1;let p,y,T,v,m,S,b,k,x,A,M,R=g;if(c%8==0)for(p=0;p<s.length;p++){if(m=p*(g*u)*n,R=(p+1)*g>i?i-p*g:g,o==="u8"||o==="s8"||f){if(C===8||C===32946)b=new Uint8Array(e,s[p],w[p]),A=new be(b),M=A.getBytes(),S=new ArrayBuffer(M.length),b=new Uint8Array(S),b.set(M),b.length!==R*u*n*c/8&&console.log("strip byte counts is different than expected");else if(C===6){b=new Uint8Array(e,s[p],w[p]);const D=new _e;D.parse(b);const E=D.getData(D.width,D.height,!0);S=new ArrayBuffer(E.length),b=new Uint8Array(S),b.set(E)}else C===5?(b=Qe(e,s[p],w[p],t.littleEndian),S=b.buffer):C===1&&(w[p]!==R*u*n*c/8&&console.log("strip byte counts is different than expected"),S=e.slice(s[p],s[p]+w[p]));v=new a(S)}else{switch(C===6||C===8||C===32946?(b=new Uint8Array(e,s[p],w[p]),A=new be(b),b=A.getBytes(),S=new ArrayBuffer(b.length),k=new Uint8Array(S),b.length!==R*u*n*c/8&&console.log("strip byte counts is different than expected")):C===1&&(w[p]!==R*u*n*c/8&&console.log("strip byte counts is different than expected"),S=new ArrayBuffer(w[p]),b=new Uint8Array(e,s[p],w[p]),k=new Uint8Array(S)),o){case"u16":case"s16":for(T=0;T<b.length;T+=2)k[T]=b[T+1],k[T+1]=b[T];break;case"u32":case"s32":case"f32":for(T=0;T<b.length;T+=4)k[T]=b[T+3],k[T+1]=b[T+2],k[T+2]=b[T+1],k[T+3]=b[T]}v=new a(S)}d.set(v,m)}const I=[];if(n===1)I.push(d);else for(p=0;p<n;p++){for(x=new a(h),y=0;y<h;y++)x[y]=d[y*n+p];I.push(x)}return{width:u,height:i,pixelType:o,pixels:I}},Ir=function(e,t,r){if(!(e&&e.length>0&&t&&r))return null;let l,f,s;const u=e[0].length,i=e.length,o=new Uint8Array(u);for(let n=0;n<i;n++)if(l=e[n],f=t[n],s=r[n],n===0)for(let h=0;h<u;h++)o[h]=l[h]<f||l[h]>s?0:1;else for(let h=0;h<u;h++)o[h]&&(o[h]=l[h]<f||l[h]>s?0:1);return o},Mr=function(e){if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let l,f,s,u,i;for(let p=0;p<t.length;p++)l=t[p],f=l.slice(6,l.indexOf(">")),u=l.indexOf("sample="),u>-1&&(i=l.slice(u+8,l.indexOf('"',u+8))),u=l.indexOf("name="),u>-1&&(f=l.slice(u+6,l.indexOf('"',u+6))),f&&(s=l.slice(l.indexOf(">")+1,l.indexOf("</Item>")).trim(),i!=null?r.has(f)?r.get(f)[i]=s:r.set(f,[s]):r.set(f,s)),i=null;const o=r.get("STATISTICS_MINIMUM"),n=r.get("STATISTICS_MAXIMUM"),h=r.get("STATISTICS_MEAN"),c=r.get("STATISTICS_STDDEV");let a=null;if(o&&n){a=[];for(let p=0;p<o.length;p++)a.push({min:parseFloat(o[p]),max:parseFloat(n[p]),avg:h&&parseFloat(h[p]),stddev:c&&parseFloat(c[p])})}const d=r.get("BandName"),w=r.get("WavelengthMin"),g=r.get("WavelengthMax");let C=null;if(d){C=[];for(let p=0;p<d.length;p++)C.push({BandName:d[p],WavelengthMin:w&&parseFloat(w[p]),WavelengthMax:g&&parseFloat(g[p])})}return{statistics:a,bandProperties:C,dataType:r.get("DataType"),rawMetadata:r}};function Dr(e,t,r,l=0,f=!1,s=4){if(r.values)return!0;const u=r.type,i=r.valueCount;let o=r.valueOffset,n=[];const h=wt[u],c=8*h,a=i*h,d=i*wt[u]*8;let w,g;const C=s===8?64:32,p=r.valueOffsets;if(d>C&&a>(f?e.byteLength:e?e.byteLength-o+l:0))return r.offlineOffsetSize=[o,a],r.values=null,!1;if(d<=C){if(!t)if(C<=32)o>>>=32-d;else{const y=p!=null&&p.length?p[0]:o>>>0,T=p!=null&&p.length?p[1]:Math.round((o-y)/Ie);d<=32?(o=y>>>32-d,p[0]=o):(o=y*2**(32-d)+(T>>>32-d),p[0]=y,p[1]=T>>>32-d)}if(i===1&&c===C)n=[o];else if(C===64){const y=p!=null&&p.length?p[0]:o>>>0,T=p!=null&&p.length?p[1]:Math.round((o-y)/Ie);let v=y,m=32;for(g=1;g<=i;g++){const S=32-c*g%32;if(m<c){const b=v<<S>>>32-m,k=T<<32-m>>>32-m;v=T,n.push(b+k*2**(c-m)),m-=32-(c-m)}else n.push(v<<S>>>32-c),m-=c;m===0&&(m=32,v=T)}}else for(g=1;g<=i;g++){const y=32-c*g;n.push(o<<y>>>32-c)}}else{o-=l,f&&(o=0);for(let y=o;y<o+a;y+=h){switch(u){case 1:case 2:case 7:w=new DataView(e,y,1).getUint8(0);break;case 3:w=new DataView(e,y,2).getUint16(0,t);break;case 4:case 13:w=new DataView(e,y,4).getUint32(0,t);break;case 5:w=new DataView(e,y,4).getUint32(0,t)/new DataView(e,y+4,4).getUint32(0,t);break;case 6:w=new DataView(e,y,1).getInt8(0);break;case 8:w=new DataView(e,y,2).getInt16(0,t);break;case 9:w=new DataView(e,y,4).getInt32(0,t);break;case 10:w=new DataView(e,y,4).getInt32(0,t)/new DataView(e,y+4,4).getInt32(0,t);break;case 11:w=new DataView(e,y,4).getFloat32(0,t);break;case 12:w=new DataView(e,y,8).getFloat64(0,t);break;case 16:case 18:w=nt(new DataView(e,y,8),0,t);break;case 17:w=Er(new DataView(e,y,8),0,t);break;default:w=null}n.push(w)}}if(u===2){let y="";const T=n;for(n=[],g=0;g<T.length;g++)T[g]===0&&y!==""?(n.push(y),y=""):y+=String.fromCharCode(T[g]);y===""&&n.length!==0||n.push(y)}return r.values=n,!0}function rt(e){var t,r;const l=e[0],f=K(l,"TILEWIDTH"),s=K(l,"TILELENGTH"),u=K(l,"IMAGEWIDTH"),i=K(l,"IMAGELENGTH"),o=K(l,"BITSPERSAMPLE"),n=K(l,"SAMPLESPERPIXEL"),h=(t=K(l,"SAMPLEFORMAT"))!=null?t:1,c=Vt(h,o),a=ot(l),d=jt(l,"GDAL_NODATA");let w;d!=null&&d.length&&(w=d.map(U=>parseFloat(U)),w.some(U=>isNaN(U))&&(w=null));const g=(r=K(l,"COMPRESSION"))!=null?r:1;let C;switch(g){case 1:C="NONE";break;case 2:case 3:case 4:case 32771:C="CCITT";break;case 5:C="LZW";break;case 6:case 7:C="JPEG";break;case 32773:C="PACKBITS";break;case 8:case 32946:C="DEFLATE";break;case 34712:C="JPEG2000";break;case 34887:C="LERC";break;default:C=String(g)}let p=!0,y="";br.has(g)||(p=!1,y+="unsupported tag compression "+g),h>3&&(p=!1,y+="unsupported tag sampleFormat "+h),o%8!=0&&(p=!1,y+="unsupported tag bitsPerSample "+o);const T=Ve(l,"GEOASCIIPARAMS");let v;if(T){const U=T.split("|").find(_=>_.indexOf("ESRI PE String = ")>-1),G=U?U.replace("ESRI PE String = ",""):"";v=G.startsWith("COMPD_CS")||G.startsWith("PROJCS")||G.startsWith("GEOGCS")?{wkid:null,wkt:G}:null}const m=Te(l,"GEOTIEPOINTS"),S=Te(l,"GEOPIXELSCALE"),b=Te(l,"GEOTRANSMATRIX"),k=l.has("GEOKEYDIRECTORY")?l.get("GEOKEYDIRECTORY").data:null;let x,A,M=!1;if(k){M=K(k,"GTRasterTypeGeoKey")===2;const U=K(k,"GTModelTypeGeoKey");if(U===2){const G=K(k,"GeographicTypeGeoKey");G>=1024&&G<=32766&&(v={wkid:G})}else if(U===1){const G=K(k,"ProjectedCSTypeGeoKey");G>=1024&&G<=32766&&(v={wkid:G})}}if(S&&m&&m.length>=6?(x=[S[0],0,m[3]-m[0]*S[0],0,-Math.abs(S[1]),m[4]-m[1]*S[1]],M&&(x[2]-=.5*x[0]+.5*x[1],x[5]-=.5*x[3]+.5*x[4])):b&&b.length===16&&(x=M?[b[0],b[1],b[3]-.5*b[0],b[4],b[5],b[7]-.5*b[5]]:[b[0],b[1],b[3],b[4],b[5],b[7]]),x){const U=[{x:0,y:i},{x:0,y:0},{x:u,y:i},{x:u,y:0}];let G,_=Number.POSITIVE_INFINITY,N=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let Q=0;Q<U.length;Q++)G=Sr(U[Q],x),_=G.x>_?_:G.x,$=G.x<$?$:G.x,N=G.y>N?N:G.y,q=G.y<q?q:G.y;A={xmin:_,xmax:$,ymin:N,ymax:q,spatialReference:v}}else A={xmin:-.5,ymin:.5-i,xmax:u-.5,ymax:.5,spatialReference:v};const R=e.filter(U=>Ve(U,"NEWSUBFILETYPE")===1);let I,D,E,P,L;if(R.length>0){I=Math.round(Math.log(u/K(R[0],"IMAGEWIDTH"))/Math.LN2);const U=R[R.length-1];D=Math.round(Math.log(u/K(U,"IMAGEWIDTH"))/Math.LN2),E=K(U,"TILEWIDTH"),P=K(U,"TILELENGTH")}E=D>0?E||f:null,P=D>0?P||s:null,f&&(L=[{maxCol:Math.ceil(u/f)-1,maxRow:Math.ceil(i/s)-1,minRow:0,minCol:0}],R.forEach(U=>{L.push({maxCol:Math.ceil(K(U,"IMAGEWIDTH")/K(U,"TILEWIDTH"))-1,maxRow:Math.ceil(K(U,"IMAGELENGTH")/K(U,"TILELENGTH"))-1,minRow:0,minCol:0})}));const B=Ve(e[0],"GDAL_METADATA"),F=Mr(B);return y+=" "+Wt({width:u,height:i,tileWidth:f,tileHeight:s,planes:n,ifds:e}),{width:u,height:i,tileWidth:f,tileHeight:s,planes:n,isBSQ:a,pixelType:c,compression:C,noData:w,isSupported:p,message:y,extent:A,affine:S?null:x,firstPyramidLevel:I,maximumPyramidLevel:D,pyramidBlockWidth:E,pyramidBlockHeight:P,tileBoundary:L,metadata:F}}function ot(e,t){const r=jt(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function Rr(e){const{littleEndian:t,isBigTiff:r,firstIFD:l}=Pr(e);let f=l;const s=[];do{const u=Lr(e,t,f,0,Ae.TIFF_TAGS,r?8:4);if(!u.success)break;s.push(u.ifd),f=u.nextIFD}while(f>0);return fe(ie({},rt(s)),{littleEndian:t,isBigTiff:r,ifds:s})}function nt(e,t,r){const l=e.getUint32(t,r),f=e.getUint32(t+4,r);return r?f*Ie+l:l*Ie+f}function Er(e,t,r){let l=r?e.getInt32(t,r):e.getUint32(t,r),f=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const s=(r?l:f)>=0?1:-1;return r?l*=s:f*=s,s*(r?f*Ie+l:l*Ie+f)}function Ge(e,t,r,l){return l?nt(e,t,r):e.getUint32(t,r)}function Pr(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let l=null;if(r===18761)l=!0;else{if(r!==19789)throw"unexpected endianess byte";l=!1}const f=t.getUint16(2,l);if(f!==42&&f!==43)throw"unexpected tiff identifier";let s=4;const u=f===43;if(u){const i=t.getUint16(s,l);if(s+=2,i!==8||t.getUint16(s,l)!==0)throw"unsupported bigtiff version";s+=2}return{littleEndian:l,isBigTiff:u,firstIFD:Ge(t,s,l,u)}}function Lr(e,t,r,l=0,f=Ae.TIFF_TAGS,s=4){const u=je(e,t,r,l,f,s);let i;const o=u.ifd;if(o){if(Ae.ifdTags.forEach((n,h)=>{o.has(h)&&(i=o.get(h),i.data=je(e,t,i.valueOffset-l,l,n).ifd)}),o.has("GEOKEYDIRECTORY")){i=o.get("GEOKEYDIRECTORY");const n=i.values;if(n&&n.length>4){const h=n[0]+"."+n[1]+"."+n[2];i.data=je(e,t,i.valueOffset+6-l,l,Ae.GEO_KEYS,2).ifd,i.data&&i.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[h]})}}if(o.has("XMP")){i=o.get("XMP");const n=i.values;typeof n[0]=="number"&&i.type===7&&(i.values=[yr(new Uint8Array(n))])}}return u}function Wt(e){const{width:t,height:r,tileHeight:l,tileWidth:f}=e,s=e.planes,u=f?f*l:t*r,i=K(e.ifds[0],"BITSPERSAMPLE");let o="";return u*s>2**30/(i>8?i/8:1)&&(o=f?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),o}async function Ur(e,t){var r;const{headerInfo:l,ifd:f,offsets:s,sizes:u}=t,i=[];for(let A=0;A<s.length;A++){const M=await Je(e,l.littleEndian,f,s[A],u[A]||e.byteLength);i.push(M)}const o=ot(f,l),{pixelType:n,planes:h}=l,c=Ne(n),a=K(f,"TILEWIDTH"),d=K(f,"TILELENGTH"),w=(r=K(f,"COMPRESSION"))!=null?r:1,g=a*d;let C;const p=[];let y=i[0];const T=w===34887;for(let A=0;A<h;A++){if(C=new c(g),o&&T){y=i[A];for(let M=0;M<g;M++)C[M]=y[A][M+A]}else if(o||T&&!o)C=y.slice(g*A,g*(A+1));else for(let M=0;M<g;M++)C[M]=y[M*h+A];p.push(C)}const v=l.noData?l.noData[0]:null,m=l.metadata?l.metadata.statistics:null,S=m?m.map(A=>A.min):null,b=m?m.map(A=>A.max):null;let k,x;if(v!=null)if(k=new Uint8Array(g),Math.abs(v)>1e24)for(x=0;x<g;x++)Math.abs((p[0][x]-v)/v)<1e-6?k[x]=0:k[x]=1;else for(x=0;x<g;x++)p[0][x]===v?k[x]=0:k[x]=1;else S&&b&&t.applyMinMaxConstraint&&(k=Ir(p,S,b));return{pixelType:n,width:a,height:d,pixels:p,mask:k,noDataValue:v}}async function Or(e,t=0,r){r=r||Rr(e);const{ifds:l,noData:f}=r;if(l.length===0)throw"no valid image file directory";const s=Wt(r);if(s)throw s;let u,i;const o=t===-1?l[l.length-1]:l[t],n=f?f[0]:null;if(i=r.tileWidth?await kr(e,r,o):await Ar(e,r,o),n!==null){if(i.mask=new Uint8Array(i.width*i.height),Math.abs(n)>1e24)for(u=0;u<i.width*i.height;u++)Math.abs((i.pixels[0][u]-n)/n)<1e-6?i.mask[u]=0:i.mask[u]=1;else for(u=0;u<i.width*i.height;u++)i.pixels[0][u]===n?i.mask[u]=0:i.mask[u]=1;i.noDataValue=n}return i}var Gr=function(e){var t,r,l,f,s,u;function i(o){var n,h,c,a,d,w,g,C,p,y,T,v,m;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(n=this.readUInt32(),C=function(){var S,b;for(b=[],S=0;S<4;++S)b.push(String.fromCharCode(this.data[this.pos++]));return b}.call(this).join(""),C){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(n);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},a=this.readUInt16(),c=this.readUInt16()||100,d.delay=1e3*a/c,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(C==="fdAT"&&(this.pos+=4,n-=4),o=(d!=null?d.data:void 0)||this.imgData,T=0;0<=n?T<n:T>n;0<=n?++T:--T)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(n),(p=255-this.transparency.indexed.length)>0)for(v=0;0<=p?v<p:v>p;0<=p?++v:--v)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(n)[0];break;case 2:this.transparency.rgb=this.read(n)}break;case"tEXt":w=(y=this.read(n)).indexOf(0),g=String.fromCharCode.apply(String,y.slice(0,w)),this.text[g]=String.fromCharCode.apply(String,y.slice(w+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(m=this.colorType)===4||m===6,h=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*h,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=n}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return i.load=function(o,n,h){var c;return typeof n=="function"&&(h=n),(c=new XMLHttpRequest).open("GET",o,!0),c.responseType="arraybuffer",c.onload=function(){var a;return a=new i(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof(n!=null?n.getContext:void 0)=="function"&&a.render(n),typeof h=="function"?h(a):void 0},c.send(null)},r=1,l=2,t=0,i.prototype.read=function(o){var n,h;for(h=[],n=0;0<=o?n<o:n>o;0<=o?++n:--n)h.push(this.data[this.pos++]);return h},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(o){var n,h,c,a,d,w,g,C,p,y,T,v,m,S,b,k,x,A,M,R,I,D,E;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);for(o=(o=new be(o)).getBytes(),k=(v=this.pixelBitlength/8)*this.width,m=new Uint8Array(k*this.height),w=o.length,b=0,S=0,h=0;S<w;){switch(o[S++]){case 0:for(a=M=0;M<k;a=M+=1)m[h++]=o[S++];break;case 1:for(a=R=0;R<k;a=R+=1)n=o[S++],d=a<v?0:m[h-v],m[h++]=(n+d)%256;break;case 2:for(a=I=0;I<k;a=I+=1)n=o[S++],c=(a-a%v)/v,x=b&&m[(b-1)*k+c*v+a%v],m[h++]=(x+n)%256;break;case 3:for(a=D=0;D<k;a=D+=1)n=o[S++],c=(a-a%v)/v,d=a<v?0:m[h-v],x=b&&m[(b-1)*k+c*v+a%v],m[h++]=(n+Math.floor((d+x)/2))%256;break;case 4:for(a=E=0;E<k;a=E+=1)n=o[S++],c=(a-a%v)/v,d=a<v?0:m[h-v],b===0?x=A=0:(x=m[(b-1)*k+c*v+a%v],A=c&&m[(b-1)*k+(c-1)*v+a%v]),g=d+x-A,C=Math.abs(g-d),y=Math.abs(g-x),T=Math.abs(g-A),p=C<=y&&C<=T?d:y<=T?x:A,m[h++]=(n+p)%256;break;default:throw new Error("Invalid filter algorithm: "+o[S-1])}b++}return m},i.prototype.decodePalette=function(){var o,n,h,c,a,d,w,g,C;for(h=this.palette,d=this.transparency.indexed||[],a=new Uint8Array((d.length||0)+h.length),c=0,o=0,n=w=0,g=h.length;w<g;n=w+=3)a[c++]=h[n],a[c++]=h[n+1],a[c++]=h[n+2],a[c++]=(C=d[o++])!=null?C:255;return a},i.prototype.copyToImageData=function(o,n){var h,c,a,d,w,g,C,p,y,T,v;if(c=this.colors,y=null,h=this.hasAlphaChannel,this.palette.length&&(y=(v=this._decodedPalette)!=null?v:this._decodedPalette=this.decodePalette(),c=4,h=!0),p=(a=o.data||o).length,w=y||n,d=g=0,c===1)for(;d<p;)C=y?4*n[d/4]:g,T=w[C++],a[d++]=T,a[d++]=T,a[d++]=T,a[d++]=h?w[C++]:this.transparency.grayscale&&this.transparency.grayscale===T?0:255,g=C;else for(;d<p;)C=y?4*n[d/4]:g,a[d++]=w[C++],a[d++]=w[C++],a[d++]=w[C++],a[d++]=h?w[C++]:this.transparency.rgb&&this.transparency.rgb[1]===w[C-3]&&this.transparency.rgb[3]===w[C-2]&&this.transparency.rgb[5]===w[C-1]?0:255,g=C},i.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o},s=e.document&&e.document.createElement("canvas"),u=s&&s.getContext("2d"),f=function(o){var n;return u.width=o.width,u.height=o.height,u.clearRect(0,0,o.width,o.height),u.putImageData(o,0,0),(n=new Image).src=s.toDataURL(),n},i.prototype.decodeFrames=function(o){var n,h,c,a,d,w,g,C;if(this.animation){for(C=[],h=d=0,w=(g=this.animation.frames).length;d<w;h=++d)n=g[h],c=o.createImageData(n.width,n.height),a=this.decodePixels(new Uint8Array(n.data)),this.copyToImageData(c,a),n.imageData=c,C.push(n.image=f(c));return C}},i.prototype.renderFrame=function(o,n){var h,c,a;return h=(c=this.animation.frames)[n],a=c[n-1],n===0&&o.clearRect(0,0,this.width,this.height),(a!=null?a.disposeOp:void 0)===r?o.clearRect(a.xOffset,a.yOffset,a.width,a.height):(a!=null?a.disposeOp:void 0)===l&&o.putImageData(a.imageData,a.xOffset,a.yOffset),h.blendOp===t&&o.clearRect(h.xOffset,h.yOffset,h.width,h.height),o.drawImage(h.image,h.xOffset,h.yOffset)},i.prototype.animate=function(o){var n,h,c,a,d,w,g=this;return h=0,w=this.animation,a=w.numFrames,c=w.frames,d=w.numPlays,(n=function(){var C,p;if(C=h++%a,p=c[C],g.renderFrame(o,C),a>1&&h/a<d)return g.animation._timeout=setTimeout(n,p.delay)})()},i.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},i.prototype.render=function(o){var n,h;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,n=o.getContext("2d"),this.animation?(this.decodeFrames(n),this.animate(n)):(h=n.createImageData(this.width,this.height),this.copyToImageData(h,this.decodePixels()),n.putImageData(h,0,0))},i}(self);const _r=new Set(["jpg","png","bmp","gif"]),Br=new Set(["S8","U8","S16","U16","S32","U32","F32","F64"]);async function Nr(e,t){var r;if(!tt)throw new de("rasterCoded:decode","lerc decoder is not supported on big endian platform");await Nt();const{offset:l,noDataValue:f}=t;let s=(r=t.pixelType)==null?void 0:r.toUpperCase();s&&!Br.has(s)&&(s=null);const{width:u,height:i,pixelType:o,statistics:n,pixels:h,mask:c}=Ft(e,{inputOffset:l,noDataValue:f,pixelType:s});return new J({width:u,height:i,pixelType:o.toLowerCase(),pixels:h,mask:c,statistics:n})}async function Fr(e,t){const r=await Or(e,t.pyramidLevel||0),l=new J({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return l.updateStatistics(),l}async function $r(e,t){const r=await Ur(e,t.customOptions),l=new J({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return l.updateStatistics(),l}function Kt(e,t){const r=t.pixelType||"u8",l=J.getPixelArrayConstructor(r),f=r==="u8"?e:new l(e.buffer),s=[],u=t.planes||1;if(u===1)s.push(f);else for(let o=0;o<u;o++){const n=(t.width||1)*(t.height||e.length),h=new l(n);for(let c=0;c<n;c++)h[c]=f[c*u+o];s.push(h)}const i=new J({width:t.width||1,height:t.height||e.length,pixels:s,pixelType:r,statistics:null});return i.updateStatistics(),i}function Vr(e,t){return Kt(new be(new Uint8Array(e)).getBytes(),t)}function jr(e,t){return Kt(Qe(e,t.offset,t.eof,!t.isInputBigEndian),t)}function Wr(e,t,r){const{pixelTypeCtor:l}=Hr(t.pixelType),f=(0,gr.decode)(e,{width:t.width,height:t.height,pixelType:l,format:r}),s=new J({width:t.width,height:t.height,pixels:f.pixels,pixelType:t.pixelType,mask:f.mask,statistics:null});return s.updateStatistics(),s}function Kr(e){const t=fr.decode(e),r=new J({width:t.width,height:t.height,pixels:t.pixels,pixelType:"U8",mask:t.mask,statistics:null});return r.updateStatistics(),r}function zr(e,t){const r=new Uint8Array(e),l=new Gr(r),{width:f,height:s}=t,u=f*s,i=l.decode();let o,n=0,h=0;const c=new Uint8Array(u);for(n=0;n<u;n++)c[n]=i[4*n+3];const a=new J({width:f,height:s,pixels:[],pixelType:"U8",mask:c,statistics:[]});for(n=0;n<3;n++){for(o=new Uint8Array(u),h=0;h<u;h++)o[h]=i[4*h+n];a.addData({pixels:o})}return a.updateStatistics(),a}async function Yr(e,t,r,l){const f=new Ze,s=ie({applyJpegMask:!1,format:t},r),u=await f.decode(e,s,l),i=new J(u);return i.updateStatistics(),i}function zt(e){if(e==null)throw new de("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().indexOf("error")>-1&&(r="error"),r}function Jr(e){let t=null;switch(e){case"lerc":case"lerc2":t=Nr;break;case"jpg":t=Kr;break;case"png":t=zr;break;case"bsq":case"bip":t=(r,l)=>Wr(r,l,e);break;case"tiff":t=Fr;break;case"deflate":t=Vr;break;case"lzw":t=jr;break;case"error":t=()=>{throw new de("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new de("rasterCodec:decode","unsupported raster format")}}return t}function Hr(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function qr(e,t=1){if(!e)return;const{pixels:r,width:l,height:f,mask:s}=e;if(!r||r.length===0)return;const u=r.length,i=l-1,o=f-1,n=[];let h,c,a,d,w,g,C;const p=J.getPixelArrayConstructor(e.pixelType);if(t===0){for(h=0;h<u;h++){for(w=r[h],g=new p(i*o),c=0;c<o;c++)for(d=c*l,a=0;a<i;a++)g[c*i+a]=w[d+a];n.push(g)}if(s)for(C=new Uint8Array(i*o),c=0;c<o;c++)for(d=c*l,a=0;a<i;a++)C[c*i+a]=s[d+a]}else{for(h=0;h<u;h++){for(w=r[h],g=new p(i*o),c=0;c<o;c++)for(d=c*l,a=0;a<i;a++)g[c*i+a]=(w[d+a]+w[d+a+1]+w[d+l+a]+w[d+l+a+1])/4;n.push(g)}if(s)for(C=new Uint8Array(i*o),c=0;c<o;c++)for(d=c*l,a=0;a<i;a++)C[c*i+a]=Math.min.apply(null,[s[d+a],s[d+a+1],s[d+l+a],s[d+l+a+1]])}e.width=i,e.height=o,e.mask=C,e.pixels=n}function Eo(e){let t=zt(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Po(e,t={},r){if(e==null)throw new de("rasterCodec:decode","missing encodeddata parameter.");let l,f,s=t.format&&t.format.toLowerCase();if(!(s!=="bsq"&&s!=="bip"||t.width!=null&&t.height!=null))throw new de("rasterCodec:decode","requires width and height in options parameter.");return s==="tiff"&&t.customOptions?$r(e,t):((!s||s!=="bsq"&&s!=="bip"&&s!=="deflate"&&s!=="lzw")&&(s=zt(e)),t.useCanvas&&_r.has(s)?f=await Yr(e,s,t,r):(l=Jr(s),t.isPoint&&((t=ie({},t)).width++,t.height++),f=await l(e,t),t.isPoint&&qr(f)),f)}function X(e){return Z(e)&&e.declaredClass==="esri.layers.support.PixelBlock"&&e.pixels&&e.pixels.length>0}function Ct(e,t){if(t==null||!t.length||!X(e))return e;const r=e.pixels.length;return t&&t.some(l=>l>=r)||r===1&&t.length===1&&t[0]===0?e:r!==t.length||t.some((l,f)=>l!==f)?new J({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map(l=>e.pixels[l]),statistics:e.statistics&&t.map(l=>e.statistics[l])}):e}function De(e){if(!e)return;const t=e.colormap;if(!t||t.length===0)return;const r=t.sort((c,a)=>c[0]-a[0]);let l=0;r[0][0]<0&&(l=r[0][0]);const f=Math.max(256,r[r.length-1][0]-l+1),s=new Uint8Array(4*f),u=[];let i,o=0,n=0;const h=r[0].length===5;if(f>65536)return r.forEach(c=>{u[c[0]-l]=h?c.slice(1):c.slice(1).concat([255])}),{indexed2DColormap:u,offset:l,alphaSpecified:h};if(e.fillUnspecified)for(i=r[n],o=i[0]-l;o<f;o++)s[4*o]=i[1],s[4*o+1]=i[2],s[4*o+2]=i[3],s[4*o+3]=h?i[4]:255,o===i[0]-l&&(i=n===r.length-1?i:r[++n]);else for(o=0;o<r.length;o++)i=r[o],n=4*(i[0]-l),s[n]=i[1],s[n+1]=i[2],s[n+2]=i[3],s[n+3]=h?i[4]:255;return{indexedColormap:s,offset:l,alphaSpecified:h}}function We(e,t){if(!X(e)||!t&&(t.indexedColormap||t.indexed2DColormap))return e;const r=e.clone(),l=r.pixels;let f=r.mask;const s=r.width*r.height;if(l.length!==1)return e;const{indexedColormap:u,indexed2DColormap:i,offset:o,alphaSpecified:n}=t,h=u.length-1;let c=0;const a=l[0],d=new Uint8Array(a.length),w=new Uint8Array(a.length),g=new Uint8Array(a.length);let C,p=0;if(u)if(f)for(c=0;c<s;c++)f[c]&&(p=4*(a[c]-o),p<o||p>h?f[c]=0:(d[c]=u[p],w[c]=u[p+1],g[c]=u[p+2],f[c]=u[p+3]));else{for(f=new Uint8Array(s),c=0;c<s;c++)p=4*(a[c]-o),p<o||p>h?f[c]=0:(d[c]=u[p],w[c]=u[p+1],g[c]=u[p+2],f[c]=u[p+3]);r.mask=f}else if(f)for(c=0;c<s;c++)f[c]&&(C=i[a[c]],d[c]=C[0],w[c]=C[1],g[c]=C[2],f[c]=C[3]);else{for(f=new Uint8Array(s),c=0;c<s;c++)C=i[a[c]],d[c]=C[0],w[c]=C[1],g[c]=C[2],f[c]=C[3];r.mask=f}return r.pixels=[d,w,g],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=n,r}function Xr(e){if(!X(e))return null;e.statistics||e.updateStatistics();const{pixels:t,mask:r,pixelType:l,statistics:f}=e,s=e.width*e.height,u=t.length;let i,o,n,h,c;const a=[],d=[];let w,g,C,p,y,T,v,m,S,b;const k=256;for(h=0;h<u;h++){if(w=new Uint32Array(k),C=t[h],l==="u8")if(i=-.5,o=255.5,r)for(c=0;c<s;c++)r[c]&&w[C[c]]++;else for(c=0;c<s;c++)w[C[c]]++;else{if(i=f[h].minValue,o=f[h].maxValue,n=(o-i)/k,g=new Uint32Array(k+1),r)for(c=0;c<s;c++)r[c]&&g[Math.floor((C[c]-i)/n)]++;else for(c=0;c<s;c++)g[Math.floor((C[c]-i)/n)]++;for(c=0;c<255;c++)w[c]=g[c];w[255]=g[255]+g[256]}for(a.push({min:i,max:o,size:k,counts:w}),p=0,y=0,m=0,c=0;c<k;c++)p+=w[c],y+=c*w[c];for(S=y/p,c=0;c<k;c++)m+=w[c]*(c-S)**2;b=Math.sqrt(m/(p-1)),n=(o-i)/k,T=(S+.5)*n+i,v=b*n,d.push({min:i,max:o,avg:T,stddev:v})}return{statistics:d,histograms:a}}function Lo(e){const t=[];for(let r=0;r<e.length;r++){const{min:l,max:f,size:s,counts:u}=e[r];let i=0,o=0;for(let w=0;w<s;w++)i+=u[w],o+=w*u[w];const n=o/i;let h=0;for(let w=0;w<s;w++)h+=u[w]*(w-n)**2;const c=(f-l)/s,a=(n+.5)*c+l,d=Math.sqrt(h/(i-1))*c;t.push({min:l,max:f,avg:a,stddev:d})}return t}function vt(e){const{minCutOff:t,maxCutOff:r,gamma:l,pixelType:f}=e,s=e.outMin||0,u=e.outMax||255;if(["u8","u16","s8","s16"].indexOf(f)===-1)return null;const i=t.length;let o,n,h=0;f==="s8"?h=-127:f==="s16"&&(h=-32767);let c=256;["u16","s16"].indexOf(f)>-1&&(c=65536);const a=[],d=[],w=u-s;for(o=0;o<i;o++)d[o]=r[o]-t[o],a[o]=w/(r[o]-t[o]);const g=l&&l.length>=i,C=[];if(g)for(o=0;o<i;o++)l[o]>1?l[o]>2?C[o]=6.5+(l[o]-2)**2.5:C[o]=6.5+100*(2-l[o])**4:C[o]=1;let p;const y=[];let T,v,m;if(g)for(o=0;o<i;o++){for(m=[],n=0;n<c;n++)T=n+h,p=(T-t[o])/d[o],v=1,l[o]>1&&(v-=(1/w)**(p*C[o])),T<r[o]&&T>t[o]?m[n]=Math.floor(v*w*p**(1/l[o]))+s:T>=r[o]?m[n]=u:m[n]=s;y[o]=m}else for(o=0;o<i;o++){for(m=[],n=0;n<c;n++)T=n+h,T<=t[o]?m[n]=s:T>=r[o]?m[n]=u:m[n]=Math.floor((T-t[o])/d[o]*w)+s;y[o]=m}if(e.contrastOffset!=null){const S=Zr(e.contrastOffset,e.brightnessOffset);for(o=0;o<i;o++)for(m=y[o],n=0;n<c;n++)m[n]=S[m[n]]}return{lut:y,offset:h}}function Zr(e,t){const r=Math.min(Math.max(e,-100),100),l=Math.min(Math.max(t,-100),100),f=255,s=128;let u,i;const o=new Uint8Array(256);for(u=0;u<256;u++)r>0&&r<100?i=(200*u-100*f+2*f*l)/(2*(100-r))+s:r<=0&&r>-100?i=(200*u-100*f+2*f*l)*(100+r)/2e4+s:r===100?(i=200*u-100*f+(f+1)*(100-r)+2*f*l,i=i>0?f:0):r===-100&&(i=s),o[u]=i>f?f:i<0?0:i;return o}function Tt(e,t=256){t=Math.min(t,256);const{size:r,counts:l}=e,f=new Uint8Array(r),s=l.reduce((h,c)=>h+c/t,0);let u=0,i=0,o=0,n=s;for(let h=0;h<r;h++)if(o+=l[h],!(h<r-1&&o+l[h+1]<n)){for(;u<t-1&&n<o;)u++,n+=s;for(let c=i;c<=h;c++)f[c]=u;i=h+1}for(let h=i;h<r;h++)f[h]=t-1;return f}function Ke(e,t){if(!X(e))return null;const r=e.clone(),{pixels:l,mask:f}=r,{minCutOff:s,maxCutOff:u,gamma:i}=t,o=t.outMin||0,n=t.outMax||255,h=r.width*r.height,c=l.length;let a,d,w,g,C;const p=n-o,y=[],T=[];for(a=0;a<c;a++)T[a]=u[a]-s[a],y[a]=p/(u[a]-s[a]);const v=i&&i.length>=c,m=[];if(v)for(a=0;a<c;a++)i[a]>1?i[a]>2?m[a]=6.5+(i[a]-2)**2.5:m[a]=6.5+100*(2-i[a])**4:m[a]=1;if(v)if(f!=null){for(d=0;d<h;d++)if(f[d])for(a=0;a<c;a++)w=l[a][d],C=(w-s[a])/T[a],g=1,i[a]>1&&(g-=(1/p)**(C*m[a])),w<u[a]&&w>s[a]?l[a][d]=Math.floor(g*p*C**(1/i[a]))+o:w>=u[a]?l[a][d]=n:l[a][d]=o}else for(d=0;d<h;d++)for(a=0;a<c;a++)w=l[a][d],C=(w-s[a])/T[a],g=1,i[a]>1&&(g-=(1/p)**(C*m[a])),w<u[a]&&w>s[a]?l[a][d]=Math.floor(g*p*C**(1/i[a]))+o:w>=u[a]?l[a][d]=n:l[a][d]=o;else if(f!=null){for(d=0;d<h;d++)if(f[d])for(a=0;a<c;a++)w=l[a][d],w<u[a]&&w>s[a]?l[a][d]=Math.floor((w-s[a])/T[a]*p)+o:w>=u[a]?l[a][d]=n:l[a][d]=o}else for(d=0;d<h;d++)for(a=0;a<c;a++)w=l[a][d],w<u[a]&&w>s[a]?l[a][d]=Math.floor((w-s[a])/T[a]*p)+o:w>=u[a]?l[a][d]=n:l[a][d]=o;return r.pixelType="u8",r.updateStatistics(),r}function bt(e,t){if(!X(e))return null;const{pixels:r,mask:l}=e,f=e.width*e.height,s=r.length;let u=t.lut;const{offset:i}=t;let o,n;u&&u[0].length===1&&(u=r.map(()=>u));const h=[];let c,a,d;if(i)if(l==null)for(o=0;o<s;o++){for(c=r[o],a=u[o],d=new Uint8Array(f),n=0;n<f;n++)d[n]=a[c[n]-i];h.push(d)}else for(o=0;o<s;o++){for(c=r[o],a=u[o],d=new Uint8Array(f),n=0;n<f;n++)l[n]&&(d[n]=a[c[n]-i]);h.push(d)}else if(l==null)for(o=0;o<s;o++){for(c=r[o],a=u[o],d=new Uint8Array(f),n=0;n<f;n++)d[n]=a[c[n]];h.push(d)}else for(o=0;o<s;o++){for(c=r[o],a=u[o],d=new Uint8Array(f),n=0;n<f;n++)l[n]&&(d[n]=a[c[n]]);h.push(d)}const w=new J({width:e.width,height:e.height,pixels:h,mask:l,pixelType:"u8"});return w.updateStatistics(),w}function Qr(e,t){if(!X(e))return null;const r=e.clone(),{pixels:l}=r,f=r.width*r.height,s=t.length,u=Math.floor(s/2),i=t[Math.floor(u)],o=l[0];let n,h,c,a,d,w,g=!1;const C=new Uint8Array(f),p=new Uint8Array(f),y=new Uint8Array(f);let T=r.mask;const v=t[0].mappedColor.length===4;for(T||(T=new Uint8Array(f),T.fill(v?255:1),r.mask=T),d=0;d<f;d++)if(T[d]){for(n=o[d],g=!1,w=u,h=i,c=0,a=s-1;a-c>1;){if(n===h.value){g=!0;break}n>h.value?c=w:a=w,w=Math.floor((c+a)/2),h=t[Math.floor(w)]}g||(n===t[c].value?(h=t[c],g=!0):n===t[a].value?(h=t[a],g=!0):n<t[c].value?(g=!1,h=null):n>t[c].value&&(n<t[a].value?(h=t[c],g=!0):a===s-1?(g=!1,h=null):(h=t[a],g=!0))),g?(C[d]=h.mappedColor[0],p[d]=h.mappedColor[1],y[d]=h.mappedColor[2],T[d]=h.mappedColor[3]):C[d]=p[d]=y[d]=T[d]=0}return r.pixels=[C,p,y],r.mask=T,r.pixelType="u8",r.maskIsAlpha=v,r}function eo(e,t,r,l,f,s,u,i){return{xmin:f<=r*e?0:f<r*e+e?f-r*e:e,ymin:s<=l*t?0:s<l*t+t?s-l*t:t,xmax:f+u<=r*e?0:f+u<r*e+e?f+u-r*e:e,ymax:s+i<=l*t?0:s+i<l*t+t?s+i-l*t:t}}function St(e,t,r,l,f,s){const{width:u,height:i}=r.block,{x:o,y:n}=r.offset,{width:h,height:c}=r.mosaic,a=eo(u,i,l,f,o,n,h,c);let d=0,w=0;if(s){const g=s.hasGCSSShiftTransform?360:s.halfWorldWidth,C=u*s.resolutionX,p=s.startX+l*C,y=p+C;p<g&&y>g?w=s.rightPadding:p>=g&&(d=s.leftMargin-s.rightPadding,w=0)}if(a.xmax-=w,typeof t!="number")for(let g=a.ymin;g<a.ymax;g++){const C=(f*i+g-n)*h+(l*u-o)+d,p=g*u;for(let y=a.xmin;y<a.xmax;y++)e[C+y]=t[p+y]}else for(let g=a.ymin;g<a.ymax;g++){const C=(f*i+g-n)*h+(l*u-o)+d;for(let p=a.xmin;p<a.xmax;p++)e[C+p]=t}}function Uo(e,t,r={}){const{clipOffset:l,clipSize:f,alignmentInfo:s,blockWidths:u}=r;if(u)return to(e,t,{blockWidths:u});const i=e.find(b=>X(b));if(ze(i))return null;const o=f?f.width:t.width,n=f?f.height:t.height,h=i.width,c=i.height,a=t.width/h,d=t.height/c,w={offset:l||{x:0,y:0},mosaic:f||t,block:{width:h,height:c}},g=i.pixelType,C=J.getPixelArrayConstructor(g),p=i.pixels.length,y=[];let T,v;for(let b=0;b<p;b++){v=new C(o*n);for(let k=0;k<d;k++)for(let x=0;x<a;x++){const A=e[k*a+x];X(A)&&(T=A.pixels[b],St(v,T,w,x,k,s))}y.push(v)}let m;if(e.some(b=>ze(b)||b.mask&&b.mask.length>0)){m=new Uint8Array(o*n);for(let b=0;b<d;b++)for(let k=0;k<a;k++){const x=e[b*a+k],A=Z(x)?x.mask:null;St(m,A||(x?1:0),w,k,b,s)}}const S=new J({width:o,height:n,pixels:y,pixelType:g,mask:m});return S.updateStatistics(),S}function to(e,t,r){const l=e.find(d=>Z(d));if(!Z(l))return null;const f=e.some(d=>!Z(d)||!!d.mask),{width:s,height:u}=t,i=f?new Uint8Array(s*u):null,{blockWidths:o}=r,n=[],h=l.getPlaneCount(),c=J.getPixelArrayConstructor(l.pixelType);if(f)for(let d=0,w=0;d<e.length;w+=o[d],d++){const g=e[d];if(!X(g))continue;const C=g.mask;for(let p=0;p<u;p++)for(let y=0;y<o[d];y++)i[p*s+y+w]=C==null?255:C[p*g.width+y]}for(let d=0;d<h;d++){const w=new c(s*u);for(let g=0,C=0;g<e.length;C+=o[g],g++){const p=e[g];if(!X(p))continue;const y=p.pixels[d];if(y!=null)for(let T=0;T<u;T++)for(let v=0;v<o[g];v++)w[T*s+v+C]=y[T*p.width+v]}n.push(w)}const a=new J({width:s,height:u,mask:i,pixels:n,pixelType:l.pixelType});return a.updateStatistics(),a}function Oo(e,t,r){if(!X(e))return null;const{width:l,height:f}=e,s=t.x,u=t.y,i=r.width+s,o=r.height+u;if(s<0||u<0||i>l||o>f||s===0&&u===0&&i===l&&o===f)return e;e.mask||(e.mask=new Uint8Array(l*f));const n=e.mask;for(let h=0;h<f;h++){const c=h*l;for(let a=0;a<l;a++)n[c+a]=h<u||h>=o||a<s||a>=i?0:1}return e.updateStatistics(),e}function ro(e){if(!X(e))return null;const t=e.clone(),{width:r,height:l,pixels:f,mask:s}=e,u=f[0],i=t.pixels[0];for(let o=2;o<l-1;o++){const n=new Map;for(let c=o-2;c<o+2;c++)for(let a=0;a<4;a++){const d=c*r+a;Re(n,u[d],s?s[d]:1)}i[o*r]=xt(n),i[o*r+1]=i[o*r+2]=i[o*r];let h=3;for(;h<r-1;h++){let c=(o-2)*r+h+1;Re(n,u[c],s?s[c]:1),c=(o-1)*r+h+1,Re(n,u[c],s?s[c]:1),c=o*r+h+1,Re(n,u[c],s?s[c]:1),c=(o+1)*r+h+1,Re(n,u[c],s?s[c]:1),c=(o-2)*r+h-3,Ue(n,u[c],s?s[c]:1),c=(o-1)*r+h-3,Ue(n,u[c],s?s[c]:1),c=o*r+h-3,Ue(n,u[c],s?s[c]:1),c=(o+1)*r+h-3,Ue(n,u[c],s?s[c]:1),i[o*r+h]=xt(n)}i[o*r+h+1]=i[o*r+h]}for(let o=0;o<r;o++)i[o]=i[r+o]=i[2*r+o],i[(l-1)*r+o]=i[(l-2)*r+o];return t.updateStatistics(),t}function xt(e){if(e.size===0)return 0;let t=0,r=-1,l=0;const f=e.keys();let s=f.next();for(;!s.done;)l=e.get(s.value),l>t&&(r=s.value,t=l),s=f.next();return r}function Ue(e,t,r){if(r===0)return;const l=e.get(t);l===1?e.delete(t):e.set(t,l-1)}function Re(e,t,r){r!==0&&e.set(t,e.has(t)?e.get(t)+1:1)}function oo(e,t,r){let{x:l,y:f}=t;const{width:s,height:u}=r;if(l===0&&f===0&&u===e.height&&s===e.width)return e;const{width:i,height:o}=e,n=Math.max(0,f),h=Math.max(0,l),c=Math.min(l+s,i),a=Math.min(f+u,o);if(c<0||a<0||!X(e))return null;l=Math.max(0,-l),f=Math.max(0,-f);const{pixels:d,mask:w}=e,g=s*u,C=d.length,p=[];for(let v=0;v<C;v++){const m=d[v],S=J.createEmptyBand(e.pixelType,g);for(let b=n;b<a;b++){const k=b*i;let x=(b+f-n)*s+l;for(let A=h;A<c;A++)S[x++]=m[k+A]}p.push(S)}const y=new Uint8Array(g);for(let v=n;v<a;v++){const m=v*i;let S=(v+f-n)*s+l;for(let b=h;b<c;b++)y[S++]=w?w[m+b]:1}const T=new J({width:r.width,height:r.height,pixelType:e.pixelType,pixels:p,mask:y});return T.updateStatistics(),T}function no(e,t=!0){if(!X(e))return null;const{pixels:r,width:l,height:f,mask:s,pixelType:u}=e,i=[],o=Math.round(l/2),n=Math.round(f/2),h=f-1,c=l-1;for(let d=0;d<r.length;d++){const w=r[d],g=J.createEmptyBand(u,o*n);let C=0;for(let p=0;p<f;p+=2)for(let y=0;y<l;y+=2){const T=w[p*l+y];if(t){const v=y===c?T:w[p*l+y+1],m=p===h?T:w[p*l+y+l],S=y===c?m:p===h?v:w[p*l+y+l+1];g[C++]=(T+v+m+S)/4}else g[C++]=T}i.push(g)}let a=null;if(s){a=new Uint8Array(o*n);let d=0;for(let w=0;w<f;w+=2)for(let g=0;g<l;g+=2){const C=s[w*l+g];if(t){const p=g===c?C:s[w*l+g+1],y=w===h?C:s[w*l+g+l],T=g===c?y:w===h?p:s[w*l+g+l+1];a[d++]=C*p*y*T?1:0}else a[d++]=C}}return new J({width:o,height:n,pixelType:u,pixels:i,mask:a})}function Go(e,t,r){if(!X(e))return null;const{width:l,height:f}=t;let{width:s,height:u}=e;const i=new Map,o={x:0,y:0},n=r==null?1:1+r;let h=e;for(let c=0;c<n;c++){const a=Math.ceil(s/l),d=Math.ceil(u/f);for(let w=0;w<d;w++){o.y=w*f;for(let g=0;g<a;g++){o.x=g*l;const C=oo(h,o,t);i.set(`${c}/${w}/${g}`,C)}}c<n-1&&(h=no(h)),s=Math.round(s/2),u=Math.round(u/2)}return i}function Yt(e,t,r,l,f=.5){const{width:s,height:u}=e,{width:i,height:o}=t,n=l.cols,h=l.rows,c=Math.ceil(i/n-.1/n),a=Math.ceil(o/h-.1/h);let d,w,g,C,p,y,T;const v=c*n,m=v*a*h,S=new Float32Array(m),b=new Float32Array(m),k=new Uint32Array(m),x=new Uint32Array(m);let A,M,R=0;for(let I=0;I<a;I++)for(let D=0;D<c;D++){d=12*(I*c+D),w=r[d],g=r[d+1],C=r[d+2],p=r[d+3],y=r[d+4],T=r[d+5];for(let E=0;E<h;E++){R=(I*h+E)*v+D*n,M=(E+.5)/h;for(let P=0;P<E;P++)A=(P+.5)/n,S[R+P]=(w*A+g*M+C)*s-f,b[R+P]=(p*A+y*M+T)*u-f,k[R+P]=Math.round(S[R+P]),x[R+P]=Math.round(b[R+P])}d+=6,w=r[d],g=r[d+1],C=r[d+2],p=r[d+3],y=r[d+4],T=r[d+5];for(let E=0;E<h;E++){R=(I*h+E)*v+D*n,M=(E+.5)/h;for(let P=E;P<n;P++)A=(P+.5)/n,S[R+P]=(w*A+g*M+C)*s-f,b[R+P]=(p*A+y*M+T)*u-f,k[R+P]=Math.round(S[R+P]),x[R+P]=Math.round(b[R+P])}}return{offsets_x:S,offsets_y:b,offsets_xi:k,offsets_yi:x,gridWidth:v}}function _o(e,t){const{coefficients:r,spacing:l}=t,{offsets_x:f,offsets_y:s,gridWidth:u}=Yt(e,e,r,{rows:l[0],cols:l[1]},.5),{width:i,height:o}=e,n=new Float32Array(i*o),h=180/Math.PI;for(let c=0;c<o;c++)for(let a=0;a<i;a++){const d=c*u+a,w=c===0?d:d-u,g=c===o-1?d:d+u,C=f[w]-f[g],p=s[g]-s[w];if(isNaN(C)||isNaN(p))n[c*i+a]=90;else{let y=Math.atan2(p,C)*h;y=(360+y)%360,n[c*i+a]=y}}return n}function Bo(e,t,r,l,f="nearest"){if(!X(e))return null;f==="majority"&&(e=ro(e));const{pixels:s,mask:u,pixelType:i}=e,o=e.width,n=e.height,h=J.getPixelArrayConstructor(i),c=s.length,{width:a,height:d}=t;let w=!1;for(let x=0;x<r.length;x+=3)r[x]===-1&&r[x+1]===-1&&r[x+2]===-1&&(w=!0);const{offsets_x:g,offsets_y:C,offsets_xi:p,offsets_yi:y,gridWidth:T}=Yt({width:o,height:n},t,r,l,f==="majority"?0:.5);let v;const m=(x,A,M)=>{const R=x instanceof Float32Array||x instanceof Float64Array?0:.5;for(let I=0;I<d;I++){v=I*T;for(let D=0;D<a;D++){if(g[v]<0||C[v]<0)x[I*a+D]=0;else if(M)x[I*a+D]=A[p[v]+y[v]*o];else{const E=Math.floor(g[v]),P=Math.floor(C[v]),L=Math.ceil(g[v]),B=Math.ceil(C[v]),F=g[v]-E,U=C[v]-P;if(!u||u[E+P*o]&&u[E+P*o]&&u[E+B*o]&&u[L+B*o]){const G=(1-F)*A[E+P*o]+F*A[L+P*o],_=(1-F)*A[E+B*o]+F*A[L+B*o];x[I*a+D]=(1-U)*G+U*_+R}else x[I*a+D]=A[p[v]+y[v]*o]}v++}}},S=[];let b;for(let x=0;x<c;x++)b=new h(a*d),m(b,s[x],f==="nearest"||f==="majority"),S.push(b);const k=new J({width:a,height:d,pixelType:i,pixels:S});if(u)k.mask=new Uint8Array(a*d),m(k.mask,u,!0);else if(w){k.mask=new Uint8Array(a*d);for(let x=0;x<a*d;x++)k.mask[x]=g[x]<0||C[x]<0?0:1}return k.updateStatistics(),k}const ve=new Map;ve.set("meter-per-second",1),ve.set("kilometer-per-hour",.277778),ve.set("knots",.514444),ve.set("feet-per-second",.3048),ve.set("mile-per-hour",.44704);const He=180/Math.PI,No=new ir({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function Fo(e,t){return ve.get(e)/ve.get(t)||1}function Jt(e){return(450-e)%360}function io(e,t="geographic"){const[r,l]=e,f=Math.sqrt(r*r+l*l);let s=Math.atan2(l,r)*He;return s=(360+s)%360,t==="geographic"&&(s=Jt(s)),[f,s]}function ao(e,t="geographic"){let r=e[1];t==="geographic"&&(r=Jt(r)),r%=360;const l=e[0];return[l*Math.cos(r/He),l*Math.sin(r/He)]}function $o(e,t,r,l="geographic"){if(!X(e)||ze(r))return e;const f=t==="vector-magdir"?e.clone():we(kt(e,t)),s=f.pixels[1];for(let u=0;u<s.length;u++)s[u]=l==="geographic"?(s[u]+r[u]+270)%360:(s[u]+360-r[u])%360;return t==="vector-magdir"?f:kt(f,"vector-magdir")}function kt(e,t,r="geographic",l=1){if(!X(e))return e;const{pixels:f,width:s,height:u}=e,i=s*u,o=f[0],n=f[1],h=e.pixelType.startsWith("f")?e.pixelType:"f32",c=J.createEmptyBand(h,i),a=J.createEmptyBand(h,i);let d=0;for(let g=0;g<u;g++)for(let C=0;C<s;C++)t==="vector-uv"?([c[d],a[d]]=io([o[d],n[d]],r),c[d]*=l):([c[d],a[d]]=ao([o[d],n[d]],r),c[d]*=l,a[d]*=l),d++;const w=new J({pixelType:h,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[c,a]});return w.updateStatistics(),w}function Vo(e,t,r=1){if(r===1||!X(e))return e;const l=e.clone(),{pixels:f,width:s,height:u}=l,i=f[0],o=f[1];let n=0;for(let h=0;h<u;h++)for(let c=0;c<s;c++)t==="vector-uv"?(i[n]*=r,o[n]*=r):i[n]*=r,n++;return l.updateStatistics(),l}let re=class extends Xe{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.blockBoundary=null}};V([W({type:Number,json:{write:!0}})],re.prototype,"blockWidth",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"blockHeight",void 0),V([W({type:String,json:{write:!0}})],re.prototype,"compression",void 0),V([W({type:ar,json:{write:!0}})],re.prototype,"origin",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"firstPyramidLevel",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"maximumPyramidLevel",void 0),V([W({json:{write:!0}})],re.prototype,"pyramidResolutions",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"pyramidScalingFactor",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"pyramidBlockWidth",void 0),V([W({type:Number,json:{write:!0}})],re.prototype,"pyramidBlockHeight",void 0),V([W({type:Boolean,json:{write:!0}})],re.prototype,"isVirtualTileInfo",void 0),V([W({json:{write:!0}})],re.prototype,"tileInfo",void 0),V([W()],re.prototype,"blockBoundary",void 0),re=V([qe("esri.layers.support.RasterStorageInfo")],re);const so=re;let H=class extends Xe{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get dataType(){var e,t,r;const l=(e=(t=this.keyProperties)==null||(r=t.DataType)==null?void 0:r.toLowerCase())!=null?e:"generic";return l==="stdtime"?"standard-time":l}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(!Z(this.transform)||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}};V([W({json:{write:!0}})],H.prototype,"attributeTable",void 0),V([W({json:{write:!0}})],H.prototype,"bandCount",void 0),V([W({json:{write:!0}})],H.prototype,"colormap",void 0),V([W({type:String,readOnly:!0})],H.prototype,"dataType",null),V([W({type:st,json:{write:!0}})],H.prototype,"extent",void 0),V([W({type:st,json:{write:!0}})],H.prototype,"nativeExtent",null),V([W({json:{write:!0}})],H.prototype,"nativePixelSize",null),V([W({json:{write:!0}})],H.prototype,"format",void 0),V([W({json:{write:!0}})],H.prototype,"height",void 0),V([W({json:{write:!0}})],H.prototype,"width",void 0),V([W({json:{write:!0}})],H.prototype,"histograms",void 0),V([W({json:{write:!0}})],H.prototype,"keyProperties",void 0),V([W({json:{write:!0}})],H.prototype,"multidimensionalInfo",void 0),V([W()],H.prototype,"noDataValue",void 0),V([W({json:{write:!0}})],H.prototype,"pixelSize",void 0),V([W({json:{write:!0}})],H.prototype,"pixelType",void 0),V([W()],H.prototype,"isPseudoSpatialReference",void 0),V([W({type:sr,json:{write:!0}})],H.prototype,"spatialReference",void 0),V([W({json:{write:!0}})],H.prototype,"statistics",void 0),V([W({type:so,json:{write:!0}})],H.prototype,"storageInfo",void 0),V([W({json:{write:!0}})],H.prototype,"transform",void 0),H=V([qe("esri.layers.support.RasterInfo")],H);const lo=H;function Ht(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:l,pixelSizePower:f,pixelSizeFactor:s,scalingType:u,isGCS:i,resolution:o}=e,n=l==="multi-directional"?2*e.zFactor:e.zFactor,{x:h,y:c}=o;let a=n/(8*h),d=n/(8*c);if(i&&n>.001&&(a/=111e3,d/=111e3),u==="adjusted")if(i){const R=111e3*h,I=111e3*c;a=(n+R**f*s)/(8*R),d=(n+I**f*s)/(8*I)}else a=(n+h**f*s)/(8*h),d=(n+c**f*s)/(8*c);let w=(90-t)*Math.PI/180,g=Math.cos(w),C=(360-r+90)*Math.PI/180,p=Math.sin(w)*Math.cos(C),y=Math.sin(w)*Math.sin(C);const T=[315,270,225,360,180,0],v=[60,60,60,60,60,90],m=new Float32Array([3,5,3,2,1,4]),S=m.reduce((R,I)=>R+I),b=m.map(R=>R/S),k=l==="multi-directional"?T.length:1,x=new Float32Array(6),A=new Float32Array(6),M=new Float32Array(6);if(l==="multi-directional")for(let R=0;R<k;R++)t=v[R],r=T[R],w=(90-t)*Math.PI/180,g=Math.cos(w),C=(360-r+90)*Math.PI/180,p=Math.sin(w)*Math.cos(C),y=Math.sin(w)*Math.sin(C),x[R]=g,A[R]=p,M[R]=y;else x.fill(g),A.fill(p),M.fill(y);return{resolution:o,factor:[a,d],sinZcosA:p,sinZsinA:y,cosZ:g,sinZcosAs:A,sinZsinAs:M,cosZs:x,weights:b,hillshadeType:["traditional","multi-directional"].indexOf(l)}}function co(e,t){if(!X(e))return e;const{width:r,height:l,mask:f}=e,s=new Uint8Array(r*l);f&&s.set(f);const{factor:u,sinZcosA:i,sinZsinA:o,cosZ:n,sinZcosAs:h,sinZsinAs:c,cosZs:a,weights:d}=Ht(t),[w,g]=u,{hillshadeType:C}=t,p=e.pixels[0],y=new Uint8Array(r*l);let T,v,m,S,b,k,x,A;const M=1;for(let R=M;R<l-M;R++){const I=R*r;for(let D=M;D<r-M;D++){if(f&&!f[I+D]){y[I+D]=0;continue}let E=8;if(f&&(E=f[I-r+D-1]+f[I-r+D]+f[I-r+D+1]+f[I+D-1]+f[I+D+1]+f[I+r+D-1]+f[I+r+D]+f[I+r+D+1],E<7)){y[I+D]=0,s[I+D]=0;continue}E===7?(T=f[I-r+D-1]?p[I-r+D-1]:p[I+D],v=f[I-r+D]?p[I-r+D]:p[I+D],m=f[I-r+D+1]?p[I-r+D+1]:p[I+D],S=f[I+D-1]?p[I+D-1]:p[I+D],b=f[I+D+1]?p[I+D+1]:p[I+D],k=f[I+r+D-1]?p[I+r+D-1]:p[I+D],x=f[I+r+D]?p[I+r+D]:p[I+D],A=f[I+r+D+1]?p[I+r+D+1]:p[I+D]):(T=p[I-r+D-1],v=p[I-r+D],m=p[I-r+D+1],S=p[I+D-1],b=p[I+D+1],k=p[I+r+D-1],x=p[I+r+D],A=p[I+r+D+1]);const P=(m+b+b+A-(T+S+S+k))*w,L=(k+x+x+A-(T+v+v+m))*g,B=Math.sqrt(1+P*P+L*L);let F=0;if(C==="traditional"){let U=255*(n+o*L-i*P)/B;U<0&&(U=0),F=U}else{const U=c.length;for(let G=0;G<U;G++){let _=255*(a[G]+c[G]*L-h[G]*P)/B;_<0&&(_=0),F+=_*d[G]}}y[I+D]=255&F}}for(let R=0;R<l;R++)y[R*r]=y[R*r+1],y[(R+1)*r-1]=y[(R+1)*r-2];for(let R=1;R<r-1;R++)y[R]=y[R+r],y[R+(l-1)*r]=y[R+(l-2)*r];return new J({width:r,height:l,pixels:[y],mask:f?s:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function fo(e,t,r,l){if(!X(e)||!X(t))return;const{min:f,max:s}=l,u=e.pixels[0],{pixels:i,mask:o}=t,n=i[0],h=255.00001/(s-f),c=new Uint8ClampedArray(n.length),a=new Uint8ClampedArray(n.length),d=new Uint8ClampedArray(n.length),w=r.length-1;for(let g=0;g<n.length;g++){if(o&&o[g]===0)continue;const C=Math.floor((n[g]-f)*h),[p,y]=r[C<0?0:C>w?w:C],T=u[g],v=T*y,m=v*(1-Math.abs(p%2-1)),S=T-v;switch(Math.floor(p)){case 0:c[g]=v+S,a[g]=m+S,d[g]=S;break;case 1:c[g]=m+S,a[g]=v+S,d[g]=S;break;case 2:c[g]=S,a[g]=v+S,d[g]=m+S;break;case 3:c[g]=S,a[g]=m+S,d[g]=v+S;break;case 4:c[g]=m+S,a[g]=S,d[g]=v+S;break;case 5:case 6:c[g]=v+S,a[g]=S,d[g]=m+S}}e.pixels=[c,a,d],e.updateStatistics()}const uo=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],ho={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};function Oe(e,t){if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]>t[r]+2||e[r]<t[r]-2)return!1;return!0}function po(e,t,r){const l=ct(e),f=ct(t),s={l:l.l*(1-r)+r*f.l,a:l.a*(1-r)+r*f.a,b:l.b*(1-r)+r*f.b};return cr(s)}function mo(e,t){if(!e)return;const r=t||uo;let l,f=null;return e.type==="algorithmic"?r.some(s=>{if(Oe(e.fromColor.toRgb(),s.fromColor)&&Oe(e.toColor.toRgb(),s.toColor))return f=s.id,!0}):e.type==="multipart"&&r.some(s=>{if(e.colorRamps&&s.colorRamps&&e.colorRamps.length===s.colorRamps.length&&(l=e.colorRamps,!s.colorRamps.some((u,i)=>{if(!Oe(l[i].fromColor.toRgb(),new lt(u.fromColor).toRgb())||!Oe(l[i].toColor.toRgb(),new lt(u.toColor).toRgb()))return!0}))){if(f)return!0;f=s.id}}),f}function go(e){const t=mo(e);return t?ho[t]:null}function At(e,t,r=!1){if(!e||!t||t<1)return;const l="toJSON"in e?e.toJSON():e,f=l.type==="multipart"?l.colorRamps.length:1,s=[],u=[];let i,o,n,h,c,a=0;if(t===1)return i=l.type==="multipart"?l.colorRamps[0].fromColor:l.fromColor,u.push([0].concat(i)),u;for(let d=0;d<f;d++)s[d]={start:null,end:null},s[d].start=a,s[d].end=a+1/f,a=s[d].end;for(let d=0;d<t;d++)h=d/(t-1),s.forEach((w,g)=>{if(h>=w.start&&(h<w.end||d===t-1&&g===f-1)){c=(h-w.start)/(w.end-w.start),l.type==="multipart"?(i=l.colorRamps[g].fromColor,o=l.colorRamps[g].toColor):(i=l.fromColor,o=l.toColor),d===0?u.push([d].concat(i.slice(0,3))):d===t-1?u.push([d].concat(o.slice(0,3))):(n=po({r:i[0],g:i[1],b:i[2]},{r:o[0],g:o[1],b:o[2]},c),u.push([d,n.r,n.g,n.b]));const C=i[3]!=null?i[3]>1?i[3]/255:i[3]:1,p=o[3]!=null?o[3]>1?o[3]/255:o[3]:1;r&&u[d].push(Math.min(255,Math.round(255*(C*(1-c)+p*c))))}});return u}function jo(e){const t=go(e);if(e){if(e.type==="algorithmic")return fe(ie({},It(e)),{Name:t});if(e.colorRamps){const r=e.colorRamps.map(It);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:t}}}}function It(e){if(!e)return;const t=e.toJSON();return{Algorithm:(t==null?void 0:t.Algorithm)||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Mt(e.fromColor),ToColor:Mt(e.toColor)}}function Mt(e){const t=Ot(e);return{type:"HsvColor",Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function Wo(e){const t=e.reverse().map(r=>{const l=r.toString(16);return l.length<2?"0"+l:l});return 4294967295&Number.parseInt(t.join(""),16)}const Dt=Lt.getLogger("esri.renderers.support.RasterSymbolizer");function yo(e,t){const{attributeTable:r,bandCount:l}=e;return!(!Z(r)||l>1||t&&r.fields.find(f=>f.name.toLowerCase()===t.toLowerCase())==null)}function wo(e){return e.dataType==="elevation"}function Co(e){const{bandCount:t,colormap:r}=e;return Z(r)&&r.length&&t===1}const Rt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};let Ce=class extends Xe{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!Et(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=Ct(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(t);break;case"classBreaks":r=this._symbolizeClassBreaks(t);break;case"rasterStretch":r=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const{extent:l}=e,f=l.spatialReference.isGeographic,s={x:(l.xmax-l.xmin)/t.width,y:(l.ymax-l.ymin)/t.height};r=this._symbolizeShadedRelief(t,{isGCS:f,resolution:s});break}}return r}catch(r){return Dt.error("symbolize",r.message),t}}simpleStretch(e,t){if(!Et(e))return e;try{return e.pixels.length>3&&(e=Ct(e,[0,1,2])),Ke(e,t)}catch(r){return Dt.error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].indexOf(this.rendererJSON.type)>-1){var t;const{indexedColormap:i,offset:o}=((t=this.lookup)==null?void 0:t.colormapLut)||{};return{colormap:i,colormapOffset:o,type:"lut"}}const{pixelBlock:r,isGCS:l,resolution:f,bandIds:s}=e,{rendererJSON:u}=this;return u.type==="rasterStretch"?this._generateStretchWebGLParams(r,u,s):u.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(u,l,f):u.type==="vectorField"?this._generateVectorFieldWebGLParams(u):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:We(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1;return this._isLUTChanged()&&!this.bind().success?e:r?We(e,this.lookup.colormapLut):Qr(e,this.lookup.remapLut)}_symbolizeStretch(e,t){const{pixelType:r,bandCount:l}=this.rasterInfo,f=this.rendererJSON,s=["u8","u16","s8","s16"].indexOf(r)>-1;let u,i;const{dra:o}=f,n=f.useGamma?f.gamma:null;if(f.stretchType==="histogramEqualization"){const a=o?null:this.lookup.histogramLut,d=this._getStretchCutoff(f,e,t,!a),w=Ke(e,fe(ie({},d),{gamma:n}));i=bt(w,{lut:o?d.histogramLut:a,offset:0})}else if(s){var h,c;if(o){const a=this._getStretchCutoff(f,e,t);u=vt(fe(ie({pixelType:r},a),{gamma:n}))}else if(this._isLUTChanged()){if(!this.bind().success)return e;u=this.lookup?this.lookup.stretchLut:null}else u=this.lookup?this.lookup.stretchLut:null;if(!u)return e;l>1&&(t==null?void 0:t.length)===((h=we(e))==null?void 0:h.pixels.length)&&((c=u)==null?void 0:c.lut.length)===l&&(u={lut:t.map(a=>u.lut[a]),offset:u.offset}),i=bt(e,u)}else{const a=this._getStretchCutoff(f,e,t);i=Ke(e,fe(ie({},a),{gamma:n}))}if(f.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;i=We(i,this.lookup.colormapLut)}return i}_symbolizeShadedRelief(e,t){var r,l;const f=this.rendererJSON,s=ie(ie({},f),t),u=co(e,s);if(!f.colorRamp)return u;let i;if(this._isLUTChanged(!0)){if(!this.bind().success)return u;i=this.lookup?this.lookup.hsvMap:null}else i=this.lookup?this.lookup.hsvMap:null;if(!i)return u;const o=(r=(l=we(this.rasterInfo.statistics))==null?void 0:l[0])!=null?r:{min:0,max:8e3};return fo(u,e,i,o),u}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:r,pixelType:l}=this.rasterInfo,f=e.field1;if(!f)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const s=e.defaultSymbol,u=t===1&&["u8","s8"].includes(l);if(!yo(this.rasterInfo,f)&&!u)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const i=[];if(r){const n=r.fields.find(h=>h.name.toLowerCase()==="value");if(!n)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(h=>{var c;const a=e.uniqueValueInfos.find(w=>String(w.value)===String(h.attributes[f])),d=a==null||(c=a.symbol)==null?void 0:c.color;d?i.push([h.attributes[n.name]].concat(d)):s&&i.push([h.attributes[n.name]].concat(s.color))})}else{if(f.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};e.uniqueValueInfos.forEach(n=>{var h;const c=n==null||(h=n.symbol)==null?void 0:h.color;c?i.push([parseInt(""+n.value,10)].concat(c)):s&&i.push([parseInt(""+n.value,10)].concat(s.color))})}if(i.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const o=De({colormap:i});return this.lookup={rendererJSON:e,colormapLut:o},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!Co(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map(l=>[l.value].concat(l.color)).sort((l,f)=>l[0]-f[0]);if(!t||t.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const r=De({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!wo(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation".`};if(e.colorRamp){const t=At(e.colorRamp,256,!0),r=De({colormap:t}),l=[],f=r.indexedColormap;for(let s=0;s<f.length;s+=4){const u=Ot({r:f[s],g:f[s+1],b:f[s+2]});l.push([u.h/60,u.s/100,255*u.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:l}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_updateClassBreaksRenderer(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1,l=e.classBreakInfos;if(l==null||!l.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const f=l.sort((h,c)=>h.classMaxValue-c.classMaxValue),s=f[f.length-1];let u=e.minValue;if(!r){const h=[];for(let c=0;c<f.length;c++){var i;h.push({value:(i=f[c].classMinValue)!=null?i:u,mappedColor:f[c].symbol.color}),u=f[c].classMaxValue}return h.push({value:s.classMaxValue,mappedColor:s.symbol.color}),this.lookup={rendererJSON:e,remapLut:h},this.canRenderInWebGL=!1,{success:!0}}const o=[];u=Math.floor(e.minValue);for(let h=0;h<f.length;h++){const c=f[h];for(let a=u;a<c.classMaxValue;a++)o.push([a].concat(c.symbol.color));u=Math.ceil(c.classMaxValue)}s.classMaxValue===u&&o.push([s.classMaxValue].concat(s.symbol.color));const n=De({colormap:o,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return Z(e)&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var t;let{stretchType:r,dra:l}=e;if(!(r==="none"||(t=e.statistics)!=null&&t.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||l))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const f=we(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||f!=null&&f.length||l||(r="minMax");const{gamma:s,useGamma:u,colorRamp:i}=e,o=this.rasterInfo.pixelType,n=!l&&["u8","u16","s8","s16"].indexOf(o)>-1;if(r==="histogramEqualization"){const h=f.map(c=>Tt(c));this.lookup={rendererJSON:e,histogramLut:h}}else if(n){const h=this._getStretchCutoff(e),c=vt(fe(ie({pixelType:o},h),{gamma:u?s:null}));this.lookup={rendererJSON:e,stretchLut:c}}if(i){const h=At(i,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=De({colormap:h}),this.lookup.rendererJSON=e}return this.canRenderInWebGL=!0,{success:!0}}_getStretchCutoff(e,t=null,r,l){var f,s,u;let i,o,n=e.stretchType;var h;if(e.dra)if(n==="minMax"&&Z(t)&&t.statistics)i=t.statistics.map(M=>[M.minValue,M.maxValue,0,0]);else{const M=Xr(t);i=Z(M)?M.statistics:null,o=Z(M)?M.histograms:null}else i=((h=e.statistics)==null?void 0:h.length)>0?e.statistics:we(this.rasterInfo.statistics),o=e.histograms||we(this.rasterInfo.histograms);!this._isHistogramRequired(n)||(f=o)!=null&&f.length||(n="minMax");const c=((s=i)==null?void 0:s.length)||((u=o)==null?void 0:u.length)||this.rasterInfo.bandCount,a=[],d=[];let w,g,C,p,y,T,v,m,S,b,k,x;switch(i&&!Array.isArray(i[0])&&(i=i.map(M=>[M.min,M.max,M.avg,M.stddev])),n){case"none":{const M=Rt[this.rasterInfo.pixelType]||Rt.f32;for(m=0;m<c;m++)a[m]=M[0],d[m]=M[1]}break;case"minMax":for(m=0;m<c;m++)a[m]=i[m][0],d[m]=i[m][1];break;case"standardDeviation":for(m=0;m<c;m++)a[m]=i[m][2]-e.numberOfStandardDeviations*i[m][3],d[m]=i[m][2]+e.numberOfStandardDeviations*i[m][3],a[m]<i[m][0]&&(a[m]=i[m][0]),d[m]>i[m][1]&&(d[m]=i[m][1]);break;case"histogramEqualization":for(m=0;m<c;m++)a[m]=o[m].min,d[m]=o[m].max;break;case"percentClip":for(m=0;m<o.length;m++){for(w=o[m],y=new Uint32Array(w.size),p=[...w.counts],p.length>=20&&(p[0]=p[1]=p[2]=p[p.length-1]=p[p.length-2]=0),C=0,g=(w.max-w.min)/w.size,v=w.min===-.5&&g===1?.5:0,S=0;S<w.size;S++)C+=p[S],y[S]=C;for(T=(e.minPercent||0)*C/100,S=0;S<w.size;S++)if(y[S]>T){a[m]=w.min+g*(S+v);break}for(T=(1-(e.maxPercent||0)/100)*C,S=w.size-2;S>=0;S--)if(y[S]<T){d[m]=w.min+g*(S+2-v);break}}break;default:for(m=0;m<c;m++)a[m]=i[m][0],d[m]=i[m][1]}n==="histogramEqualization"?(k=o[0].size||256,b=0,l&&(x=o.map(M=>Tt(M)))):(k=e.max||255,b=e.min||0);const A={minCutOff:a,maxCutOff:d,outMax:k,outMin:b,histogramLut:x};return this._getSelectedBandCutoffs(A,r)}_getSelectedBandCutoffs(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:l,maxCutOff:f,outMin:s,outMax:u,histogramLut:i}=e;return l.length===t.length||l.length<=r?e:{minCutOff:t.map(o=>l[o]),maxCutOff:t.map(o=>f[o]),histogramLut:i?t.map(o=>i[o]):null,outMin:s,outMax:u}}_generateStretchWebGLParams(e,t,r){let l=null,f=null;const s=this.lookup&&this.lookup.colormapLut;t.colorRamp&&s&&(l=s.indexedColormap,f=s.offset),t.stretchType==="histogramEqualization"&&(t=fe(ie({},t),{stretchType:"minMax"}));const{gamma:u}=t,i=!!(t.useGamma&&u&&u.some(y=>y!==1)),{minCutOff:o,maxCutOff:n,outMin:h,outMax:c}=this._getStretchCutoff(t,e,r);let a=0;Z(e)&&(a=e.getPlaneCount(),a===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const d=Math.min(3,(r==null?void 0:r.length)||a||this.rasterInfo.bandCount),w=new Float32Array(d),g=l||i?1:255;let C;for(C=0;C<d;C++)w[C]=(c-h)/(n[C]-o[C])/g;const p=new Float32Array(d);if(i)for(C=0;C<d;C++)u[C]>1?u[C]>2?p[C]=6.5+(u[C]-2)**2.5:p[C]=6.5+100*(2-u[C])**4:p[C]=1;return{bandCount:d,outMin:h/g,outMax:c/g,minCutOff:o,maxCutOff:n,factor:w,useGamma:i,gamma:i?u:[1,1,1],gammaCorrection:i?p:[1,1,1],colormap:l,colormapOffset:f,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t,r){var l,f,s;let u=null,i=null;const o=this.lookup&&this.lookup.colormapLut;e.colorRamp&&o&&(u=o.indexedColormap,i=o.offset);const n=fe(ie({},e),{isGCS:t,resolution:r}),h=Ht(n),c=(l=we(this.rasterInfo.statistics))==null?void 0:l[0];return fe(ie({},h),{minValue:(f=c==null?void 0:c.min)!=null?f:0,maxValue:(s=c==null?void 0:c.max)!=null?s:8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:u,colormapOffset:i})}_generateVectorFieldWebGLParams(e){var t,r,l,f,s,u,i,o;const{style:n,inputUnit:h,outputUnit:c,visualVariables:a,symbolTileSize:d,flowRepresentation:w}=e;let g;const C=(t=(r=this.rasterInfo.statistics)==null?void 0:r[0].min)!=null?t:0,p=(l=(f=this.rasterInfo.statistics)==null?void 0:f[0].max)!=null?l:50,y=(s=a==null?void 0:a.find(x=>x.type==="sizeInfo"))!=null?s:{type:"sizeInfo",field:"Magnitude",maxDataValue:p,maxSize:.8*d,minDataValue:C,minSize:.2*d},T=(u=y.minDataValue)!=null?u:C,v=(i=y.maxDataValue)!=null?i:p,m=Z(y.maxSize)&&Z(y.minSize)?[y.minSize/d,y.maxSize/d]:[.2,.8];if(n==="wind_speed"){const x=(m[0]+m[1])/2;m[0]=m[1]=x}const S=Z(T)&&Z(v)?[T,v]:null;if(n==="classified_arrow")if(Z(T)&&Z(v)&&Z(y)){g=[];const x=(y.maxDataValue-y.minDataValue)/5;for(let A=0;A<6;A++)g.push(y.minDataValue+x*A)}else g=[0,1e-6,3.5,7,10.5,14];const b=w==="flow_to"==(n==="ocean_current_kn"||n==="ocean_current_m")?0:Math.PI,k=a==null?void 0:a.find(x=>x.type==="rotationInfo");return{breakValues:g,dataRange:S,inputUnit:h,outputUnit:c,symbolTileSize:d,symbolPercentRange:m,style:n||"single_arrow",rotation:b,rotationType:((o=this.rasterInfo.storageInfo)==null?void 0:o.tileInfo)&&this.rasterInfo.dataType==="vector-uv"?"geographic":(k==null?void 0:k.rotationType)||e.rotationType,type:"vectorField"}}};function Et(e){return X(e)&&e.validPixelCount!==0}V([W({json:{write:!0}})],Ce.prototype,"rendererJSON",void 0),V([W({type:lo,json:{write:!0}})],Ce.prototype,"rasterInfo",void 0),V([W({json:{write:!0}})],Ce.prototype,"lookup",void 0),V([W()],Ce.prototype,"canRenderInWebGL",void 0),Ce=V([qe("esri.renderers.support.RasterSymbolizer")],Ce);const Ko=Ce,vo=Lt.getLogger("esri.views.2d.engine.flow.dataUtils"),Pt=9;async function zo(e,t,r){const l=performance.now(),f=To(e,t),s=performance.now(),u=So(e,f,t.width,t.height),i=performance.now(),o=ko(u,!0),n=performance.now(),h=Ao(o),c=performance.now();if(e.profile){const a={"_createFlowFieldFromData()":Math.round(s-l),"_getStreamlines()":Math.round(i-s),"createAnimatedLinesData()":Math.round(n-i),"createLinesMesh()":Math.round(c-n),"Total elapsed time":Math.round(c-l)};vo.info("createStreamlinesMesh profile",a)}return await Promise.resolve(),lr(r),h}function To(e,t){const r=xo(t.data,t.width,t.height,e.smoothing);return e.interpolate?(l,f)=>{const s=Math.floor(l),u=Math.floor(f);if(s<0||s>=t.width)return[0,0];if(u<0||u>=t.height)return[0,0];const i=l-s,o=f-u,n=s,h=u,c=s<t.width-1?s+1:s,a=u<t.height-1?u+1:u,d=r[2*(h*t.width+n)],w=r[2*(h*t.width+c)],g=r[2*(a*t.width+n)],C=r[2*(a*t.width+c)],p=r[2*(h*t.width+n)+1],y=r[2*(h*t.width+c)+1];return[(d*(1-o)+g*o)*(1-i)+(w*(1-o)+C*o)*i,(p*(1-o)+r[2*(a*t.width+n)+1]*o)*(1-i)+(y*(1-o)+r[2*(a*t.width+c)+1]*o)*i]}:(l,f)=>{const s=Math.round(l),u=Math.round(f);return s<0||s>=t.width||u<0||u>=t.height?[0,0]:[r[2*(u*t.width+s)+0],r[2*(u*t.width+s)+1]]}}function bo(e,t,r,l,f,s,u,i,o){const n=[];let h=r,c=l,a=0,[d,w]=t(h,c);d*=e.velocityScale,w*=e.velocityScale;const g=Math.sqrt(d*d+w*w);let C,p;n.push({x:h,y:c,t:a,speed:g});for(let y=0;y<e.verticesPerLine;y++){let[T,v]=t(h,c);T*=e.velocityScale,v*=e.velocityScale;const m=Math.sqrt(T*T+v*v);if(m<e.minSpeedThreshold)return n;const S=T/m,b=v/m;if(h+=S*e.segmentLength,c+=b*e.segmentLength,a+=e.segmentLength/m,Math.acos(S*C+b*p)>e.maxTurnAngle)return n;if(e.mergeLines){const k=Math.round(h*o),x=Math.round(c*o);if(k<0||k>u-1||x<0||x>i-1)return n;const A=s[x*u+k];if(A!==-1&&A!==f)return n;s[x*u+k]=f}n.push({x:h,y:c,t:a,speed:m}),C=S,p=b}return n}function So(e,t,r,l){const f=[],s=new Ut,u=1/Math.max(e.lineCollisionWidth,1),i=Math.round(r*u),o=Math.round(l*u),n=new Int32Array(i*o);for(let c=0;c<n.length;c++)n[c]=-1;const h=[];for(let c=0;c<l;c+=e.lineSpacing)for(let a=0;a<r;a+=e.lineSpacing)h.push({x:a,y:c,sort:s.getFloat()});h.sort((c,a)=>c.sort-a.sort);for(const{x:c,y:a}of h)if(s.getFloat()<e.density){const d=bo(e,t,c,a,f.length,n,i,o,u);if(d.length<2)continue;f.push(d)}return f}function xo(e,t,r,l){if(l===0)return e;const f=Math.round(3*l),s=new Array(2*f+1);let u=0;for(let n=-f;n<=f;n++){const h=Math.exp(-n*n/(l*l));s[n+f]=h,u+=h}for(let n=-f;n<=f;n++)s[n+f]/=u;const i=new Float32Array(e.length);for(let n=0;n<r;n++)for(let h=0;h<t;h++){let c=0,a=0;for(let d=-f;d<=f;d++){if(h+d<0||h+d>=t)continue;const w=s[d+f];c+=w*e[2*(n*t+(h+d))+0],a+=w*e[2*(n*t+(h+d))+1]}i[2*(n*t+h)+0]=c,i[2*(n*t+h)+1]=a}const o=new Float32Array(e.length);for(let n=0;n<t;n++)for(let h=0;h<r;h++){let c=0,a=0;for(let d=-f;d<=f;d++){if(h+d<0||h+d>=r)continue;const w=s[d+f];c+=w*i[2*((h+d)*t+n)+0],a+=w*i[2*((h+d)*t+n)+1]}o[2*(h*t+n)+0]=c,o[2*(h*t+n)+1]=a}return o}function ko(e,t){const r=new Ut,l=e.reduce((o,n)=>o+n.length,0),f=new Float32Array(4*l),s=new Array(e.length);let u=0,i=0;for(const o of e){const n=u;for(const h of o)f[4*u+0]=h.x,f[4*u+1]=h.y,f[4*u+2]=h.t,f[4*u+3]=h.speed,u++;s[i++]={startVertex:n,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:t?r.getFloat():0}}return{lineVertices:f,lineDescriptors:s}}function Ao(e,t=10){const{lineVertices:r,lineDescriptors:l}=e;let f=0,s=0;for(const a of l)f+=2*a.numberOfVertices,s+=6*(a.numberOfVertices-1);const u=new Float32Array(f*Pt),i=new Uint32Array(s);let o=0,n=0;function h(){i[n++]=o-2,i[n++]=o,i[n++]=o-1,i[n++]=o,i[n++]=o+1,i[n++]=o-1}function c(a,d,w,g,C,p,y,T){const v=o*Pt;let m=0;u[v+m++]=a,u[v+m++]=d,u[v+m++]=1,u[v+m++]=w,u[v+m++]=p,u[v+m++]=y,u[v+m++]=g/2,u[v+m++]=C/2,u[v+m++]=T,o++,u[v+m++]=a,u[v+m++]=d,u[v+m++]=-1,u[v+m++]=w,u[v+m++]=p,u[v+m++]=y,u[v+m++]=-g/2,u[v+m++]=-C/2,u[v+m++]=T,o++}for(const a of l){const{totalTime:d,timeSeed:w}=a;let g=null,C=null,p=null,y=null,T=null,v=null;for(let m=0;m<a.numberOfVertices;m++){const S=r[4*(a.startVertex+m)+0],b=r[4*(a.startVertex+m)+1],k=r[4*(a.startVertex+m)+2],x=r[4*(a.startVertex+m)+3];let A=null,M=null,R=null,I=null;if(m>0){A=S-g,M=b-C;const D=Math.sqrt(A*A+M*M);if(A/=D,M/=D,m>1){let E=A+T,P=M+v;const L=Math.sqrt(E*E+P*P);E/=L,P/=L;const B=Math.min(1/(E*A+P*M),t);E*=B,P*=B,R=-P,I=E}else R=-M,I=A;R!==null&&I!==null&&(c(g,C,p,R,I,d,w,x),h())}g=S,C=b,p=k,T=A,v=M,y=x}c(g,C,p,-v,T,d,w,y)}return{vertexData:u,indexData:i}}export{At as C,Vo as M,Lr as N,Bo as O,Pr as P,Po as S,Ko as T,jo as a,_o as b,Eo as c,kt as d,io as e,go as f,No as g,zo as h,Fo as i,Lo as j,Oo as k,lo as l,$o as m,tt as n,rt as o,so as p,Ae as q,yr as r,Xr as s,uo as t,Wo as u,Go as v,ot as w,Dr as x,Uo as y};
