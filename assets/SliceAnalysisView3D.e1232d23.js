var ke=Object.defineProperty;var q=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var Y=(e,i,t)=>i in e?ke(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,D=(e,i)=>{for(var t in i||(i={}))We.call(i,t)&&Y(e,t,i[t]);if(q)for(var t of q(i))Ue.call(i,t)&&Y(e,t,i[t]);return e};import{j_ as Fe,jJ as je,a as r,d as o,aS as he,i8 as X,n as N,en as Me,j$ as Z,k0 as J,k1 as Ge,jL as ue,h2 as He,c5 as c,c3 as pe,c4 as Be,c6 as qe,cb as Ye,bO as w,c7 as Xe,c8 as Ze,k2 as Je,c9 as E,ce as u,cf as F,cg as S,ch as ge,ci as ve,cj as ye,ck as me,cm as we,cn as Ke,co as fe,k3 as Qe,cp as ei,cq as be,jE as ii,cr as ti,cs as ai,gY as P,cu as si,cv as ri,cw as _e,k4 as ni,dk as li,il as z,al as oi,cB as Ee,jt as b,im as di,a8 as ci,cl as hi,i$ as ui,cd as V,cC as pi,cE as gi,cH as vi,cI as yi,cF as mi,j0 as wi,a$ as K,j1 as j,i1 as Q,eD as ee,r as d,bL as fi,aa as Ce,k5 as L,t as h,i_ as bi,iq as k,ep as T,k6 as $e,k7 as ie,k8 as Se,k9 as M,ka as _i,kb as W,kc as Ei,iy as te,aR as ae,kd as Ci,gD as $i,h as G,u as Ve,C as se,H as f,aN as U,U as re,p as x,aO as Si,ke as Vi,kf as ne,e1 as Pi,j3 as Ti}from"./vendor.f59113c8.js";import{n as xi,g as Oi,b as Ni,a as Li,p as Ai}from"./LineVisualElement.2ffa1b42.js";import{w as $}from"./persistable.f2f26400.js";import{E as Di}from"./BuildingComponentSublayer.dcba7f1a.js";import"./ImageMaterial.44e6df87.js";let v=class extends Fe(Me){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&je(this.position,e.position)&&this.width===e.width&&this.height===e.height}};r([o({readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),r([o({type:he}),$()],v.prototype,"position",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:360}}),$(),X(e=>Z.normalize(J(e),0,!0))],v.prototype,"heading",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:360}}),$(),X(e=>Z.normalize(J(e),0,!0))],v.prototype,"tilt",void 0),r([o({type:Number,nonNullable:!0}),$()],v.prototype,"width",void 0),r([o({type:Number,nonNullable:!0}),$()],v.prototype,"height",void 0),v=r([N("esri.analysis.SlicePlane")],v);const Pe=v;Ge();ue();He();new he({x:0,y:0,z:0,spatialReference:null});function Ri(e){e.vertex.uniforms.add("cameraPosition","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(c`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function Ii(e,i,t){e.setUniform1f("perScreenPixelRatio",t.camera.perScreenPixelRatio),e.setUniform1f("screenSize",i.screenSize)}function zi(e){const i=new pe;return i.include(Be,{linearDepth:!1}),i.include(Ri,{}),i.include(qe,e),i.fragment.include(Ye),i.vertex.uniforms.add("proj","mat4").add("view","mat4"),i.fragment.uniforms.add("uColor","vec4"),i.attributes.add(w.POSITION,"vec3"),i.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&i.varyings.add("depth","float"),e.screenSizeEnabled&&i.attributes.add(w.OFFSET,"vec3"),e.shadingEnabled&&(i.vertex.uniforms.add("viewNormal","mat4"),i.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),i.attributes.add(w.NORMAL,"vec3"),i.varyings.add("vViewNormal","vec3")),i.vertex.code.add(c`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&i.vertex.code.add(c`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),i.vertex.code.add(c`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(i.fragment.include(Xe),i.include(Ze,e)),i.fragment.code.add(c`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?i.fragment.code.add(c`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`):i.fragment.code.add(c`vec4 finalColor = uColor;`),i.fragment.code.add(c`
      if (finalColor.a < ${c.float(Je)}) {
        discard;
      }
      ${e.output===E.Alpha?c`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===E.Color?c`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),i}const ki=Object.freeze({__proto__:null,build:zi});class H extends ye{initializeProgram(i){const t=H.shader.get(),a=this.configuration,s=t.build({output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:a.screenSizeEnabled,shadingEnabled:a.shadingEnabled,oitEnabled:a.transparencyPassType===S.Color,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new me(i.rctx,s,Wi)}bindPass(i,t){const{screenSizeEnabled:a,shadingEnabled:s}=this.configuration,{color:l,shadingTint:n,shadingDirection:C}=i;we(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("uColor",l),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Ke(this.program,t)),s&&(this.program.setUniform4fv("shadedColor",this._blendColor(Ui,n,l)),this.program.setUniform3fv("shadingDirection",C),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),a&&Ii(this.program,i,t)}bindDraw(i){fe(this.program,i),Qe(this.program,i.origin,i.camera.viewInverseTransposeMatrix),ei(this.program,this.configuration,i),this.program.rebindTextures()}_blendColor(i,t,a){const s=1-t[3],l=t[3]+a[3]*s;return l===0?(i[3]=l,i):(i[0]=(t[0]*t[3]+a[0]*a[3]*s)/l,i[1]=(t[1]*t[3]+a[1]*a[3]*s)/l,i[2]=(t[2]*t[3]+a[2]*a[3]*s)/l,i[3]=a[3],i)}_setPipelineState(i){const t=this.configuration,a=i===S.NONE,s=i===S.FrontFace;return be({blending:t.output!==E.Color&&t.output!==E.Alpha||!t.transparent?null:a?ii:ti(i),culling:ai(t.cullFace),depthTest:{func:s?P.LESS:t.shadingEnabled?P.LEQUAL:P.LESS},depthWrite:a?t.writeDepth&&si:ri(i),colorWrite:_e,polygonOffset:a||s?null:ni})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}H.shader=new ve(ki,()=>import("./ShadedColorMaterial.glsl.822b52d8.js"));class p extends ge{constructor(){super(...arguments),this.output=E.Color,this.cullFace=F.None,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=S.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}r([u({count:E.COUNT})],p.prototype,"output",void 0),r([u({count:F.COUNT})],p.prototype,"cullFace",void 0),r([u()],p.prototype,"slicePlaneEnabled",void 0),r([u()],p.prototype,"transparent",void 0),r([u()],p.prototype,"writeDepth",void 0),r([u()],p.prototype,"screenSizeEnabled",void 0),r([u()],p.prototype,"shadingEnabled",void 0),r([u({count:S.COUNT})],p.prototype,"transparencyPassType",void 0),r([u()],p.prototype,"multipassTerrainEnabled",void 0),r([u()],p.prototype,"cullAboveGround",void 0);const Wi=new Map([[w.POSITION,0],[w.NORMAL,1],[w.OFFSET,2]]),Ui=li();D({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:z(oi(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:F.None,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},Ee);function Fi(e,i,t,a){const s=z(b.get(),e),l=z(b.get(),i),n=di(b.get(),s,l);return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=l[0],a[5]=l[1],a[6]=l[2],a[7]=0,a[8]=n[0],a[9]=n[1],a[10]=n[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}ci("mac");const ji=.7,Te=[1,.5,0],Mi=2,xe=1,Oe=[...Te,ji],Ne=[0,0,0,.04],Le=[...Te,.5];function Gi(){const e=new pe;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add(w.POSITION,"vec3"),e.attributes.add(w.UV0,"vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(c`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(c`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const Hi=Object.freeze({__proto__:null,build:Gi});class A extends ye{initializeProgram(i){const t=A.shader.get().build();return new me(i.rctx,t,hi)}bindPass(i,t){we(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",i.backgroundColor),this.program.setUniform4fv("gridColor",i.gridColor),this.program.setUniform1f("gridWidth",i.gridWidth)}bindDraw(i){fe(this.program,i),this.program.rebindTextures()}initializePipeline(){return be({blending:ui(V.ONE,V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA),depthTest:{func:P.LESS},colorWrite:_e})}}A.shader=new ve(Hi,()=>import("./SlicePlaneMaterial.glsl.fdc1f1d7.js"));class Bi extends pi{constructor(i){super(i,Yi),this._config=new ge}intersect(i,t,a,s,l,n,C){return gi(i,t,s,l,n,void 0,C)}createBufferWriter(){return new vi(yi)}requiresSlot(i){return i===mi.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(i){return i.output===E.Color?new qi(i):null}getTechniqueConfig(){return this._config}}class qi extends wi{constructor(i){super(i),this.ensureTechnique(A,null)}updateParameters(){return K(this.technique)}beginSlot(){return K(this.technique)}bind(i,t){t.bindPass(this._material.parameters,i)}}const Yi=D({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},Ee);class Xi extends xi{constructor(i){super(i),this._material=null,this._renderOccluded=j.OccludeAndTransparent,this._gridWidth=1,this._gridColor=Q(1,0,0,1),this._backgroundColor=Q(1,0,0,1),this.applyProps(i)}get renderOccluded(){return this._renderOccluded}set renderOccluded(i){i!==this._renderOccluded&&(this._renderOccluded=i,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(i){this._gridWidth!==i&&(this._gridWidth=i,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(i){ee(this._gridColor,i),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(i){ee(this._backgroundColor,i),this._updateMaterial()}createExternalResources(){this._material=new Bi(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(i){d(this._material)&&i(this._material)}createGeometries(i){if(d(this._material)){const t=fi.createSquareGeometry();i.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){d(this._material)&&this._material.setParameters(this.materialParameters)}}const Zi=Ce.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ji(e,i,t){const a=i.worldUpAtPosition(e.origin,b.get()),s=e.basis1,l=Ae(e,a),n=Math.round(l/O)*O;return W(e,n-l,s,t)}function Ki(e,i){return Fi(e.basis1,e.basis2,e.origin,i)}var le;function Qi(e){const i=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Oi({view:e,attached:!0,color:Oe,width:xe,writeDepthEnabled:!1,renderOccluded:j.OccludeAndTransparent,geometry:[i]})}function et(e){return new Xi({view:e,attached:!0,backgroundColor:[...Ne],gridColor:Le,gridWidth:4,renderOccluded:j.OccludeAndTransparent})}function it(e,i,t,a=new Pe){if(h(e))return null;const{renderCoordsHelper:s}=i,l=s.fromRenderCoords(e.origin,i.spatialReference);if(h(l))return null;const n=bi(l,t);if(h(n))return null;a.position=n;const C=s.worldUpAtPosition(e.origin,b.get()),Re=s.worldBasisAtPosition(e.origin,k.Y,b.get()),Ie=2*T(e.basis1),ze=2*T(e.basis2),B=$e.renderUnitScaleFactor(i.spatialReference,t);return a.width=Ie*B,a.height=ze*B,a.tilt=ie(Ae(e,C)),a.heading=ie(tt(e,C,Re)),a}function Ae(e,i){return Se(i,e.basis2,e.basis1)+O}function tt(e,i,t){return Se(e.basis1,t,i)-O}function at(e,i,t,a,s,l,n=M()){return l.toRenderCoords(e,n.origin)?(l.worldBasisAtPosition(n.origin,k.X,n.basis1),l.worldBasisAtPosition(n.origin,k.Y,n.basis2),_i(n.basis2,n.basis1,n.origin,n.plane),W(n,-te(i),Ei(n),n),W(n,te(t),n.basis1,n),ae(n.basis1,n.basis1,a/2),ae(n.basis2,n.basis2,s/2),Ci(n),n):(Zi.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function st(e,i){if(h(e)||h(e.position))return null;const t=Ni(e.position,i.spatialReference,i.elevationProvider);if(h(t))return null;const a=$e.renderUnitScaleFactor(e.position.spatialReference,i.spatialReference),s=e.width*a,l=e.height*a;return{position:t,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:l}}function rt(e,i,t,a=M()){if(h(e))return null;const s=at(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,i.renderCoordsHelper,a);return!t.tiltEnabled&&d(s)&&Ji(s,i.renderCoordsHelper,s),s}function nt(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return $i(e.type),!1}}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(le||(le={}));L.Custom1;var oe,de;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(oe||(oe={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(de||(de={}));L.Custom2;ue();const O=Math.PI/2;L.Custom1;L.Custom2;var ce;function lt(e){const i=e.type==="building-scene-3d"?e:null;return d(i)}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ce||(ce={}));const R=Ce.getLogger("esri.views.3d.analysis.Slice.SliceController");let y=class extends G{constructor(e){super(e),this._handles=new Ve,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready"}get ready(){return this.state==="ready"}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const i=e.item;i!=null&&(i instanceof se||i instanceof Di)?i instanceof se&&nt(i)?(R.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(i)&&e.preventDefault():(R.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),dt(this.view,this),this._handles.add([f(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),f(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),f(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),f(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([f(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.state!=="destroyed"&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),ct(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await U(this,"ready"),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(lt).flatMap(({sublayerViews:i})=>i.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,i=this._currentSlicePlane;if(h(i)&&h(e)||d(i)&&d(e)&&e.equals(i))return;let t=null,a=null;if(d(e)&&d(e.position)){const s=e.position.spatialReference,l=st(e,this.view);h(l)&&Li(this.analysis,s,R),t=rt(l,this.view,{tiltEnabled:this.analysis.tiltEnabled},M()),d(t)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,i=it(e,this.view,this.view.spatialReference,new Pe);let t=null;d(i)&&(t={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(I)return;const e=De(this.view);if(this.analysisViewData.active)d(e.activeController)&&e.activeController!==this?(I=!0,e.activeController.analysisViewData.active=!1,I=!1):d(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(d(e.activeController)&&e.activeController!==this)return;d(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){this.state==="ready"&&ot(this.view)}_updateLayerViews(){const e=d(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,i=[],t=a=>{"layers"in a?a.layers.forEach(t):i.push(a)};this.analysis.excludedLayers.forEach(t),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&i.indexOf(a.layer)<0),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&i.indexOf(s.sublayer)<0}))}),this.view.basemapTerrain!=null&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};r([o({readOnly:!0})],y.prototype,"state",void 0),r([o()],y.prototype,"view",void 0),r([o()],y.prototype,"analysis",void 0),r([o()],y.prototype,"analysisViewData",void 0),r([o()],y.prototype,"ready",null),r([o()],y.prototype,"_allLayerAndSubLayerViews",null),y=r([N("esri.views.3d.analysis.Slice.SliceController")],y);const _=new Map;let I=!1;function ot(e){const i=De(e).activeController;d(i)&&d(i.analysisViewData.plane)&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null}function dt(e,i){_.has(e)||_.set(e,{all:[],activeController:null}),_.get(e).all.push(i)}function De(e){return _.get(e)}function ct(e,i){if(!_.has(e))throw new Error("view expected in global slice register");const t=_.get(e),a=t.all.lastIndexOf(i);if(a===-1)throw new Error("controller expected in global slice register");t.all.splice(a,1),t.all.length===0&&_.delete(e)}let g=class extends G{constructor(e){super(e),this._handles=new Ve,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return this.state==="ready"}initialize(){this._initialize()}async _initialize(){if(this.state==="destroyed"||this.state==="ready")return;await U(this.view,"ready",!0);const e=this.analysisViewData;if(h(e))throw new Error("expected internal object to be valid");this._gridVisualElement=et(this.view),this._outlineVisualElement=Qi(this.view),this._handles.add([f(()=>({visible:d(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,editable:this.editable,showGrid:this.showGrid}),i=>this._updateMaterials(i),re),f(()=>e.plane,i=>this._updatePlane(i),re)],"internal"),this._set("state","ready")}destroy(){this.state!=="destroyed"&&this.state!=="pending"&&(this._handles.destroy(),this._gridVisualElement=x(this._gridVisualElement),this._outlineVisualElement=x(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await U(this,"ready"),this}_updatePlane(e){if(h(e))return;const i=Si(b.get(),T(e.basis1),T(e.basis2),1),t=Vi(ne.get(),i),a=Ki(e,ne.get()),s=Pi(t,a,t);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:i,editable:t,showGrid:a}){this._outlineVisualElement.color=Oe,this._outlineVisualElement.width=t?xe:Mi,this._outlineVisualElement.stipplePattern=i?null:Ti(5);const s=a?Le:[0,0,0,0];this._gridVisualElement.backgroundColor=Ne,this._gridVisualElement.gridColor=s,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};r([o({readOnly:!0})],g.prototype,"state",void 0),r([o()],g.prototype,"view",void 0),r([o()],g.prototype,"analysis",void 0),r([o()],g.prototype,"analysisViewData",void 0),r([o()],g.prototype,"ready",null),r([o()],g.prototype,"showGrid",void 0),r([o()],g.prototype,"editable",void 0),g=r([N("esri.views.3d.analysis.Slice.SliceVisualization")],g);let m=class extends Ai(G){constructor(e){super(e),this.type="slice-view-3d",this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new g({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new y({view:this.view,analysis:this.analysis,analysisViewData:this})}destroy(){this.analysisVisualization=x(this.analysisVisualization),this.analysisController=x(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};r([o()],m.prototype,"type",void 0),r([o()],m.prototype,"analysis",void 0),r([o()],m.prototype,"plane",void 0),r([o()],m.prototype,"active",void 0),r([o({aliasOf:"analysisVisualization.showGrid"})],m.prototype,"showGrid",void 0),r([o({aliasOf:"analysisVisualization.editable"})],m.prototype,"editable",void 0),m=r([N("esri.views.3d.analysis.SliceAnalysisView3D")],m);const ht=m;var wt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ht});export{wt as S,Gi as i,zi as m};
