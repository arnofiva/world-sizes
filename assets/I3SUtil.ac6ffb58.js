import{dh as $,di as U,aH as K,bE as ee,bs as P,dj as de,dk as pe,dl as ye,au as me,dm as be,dn as ge,J as R,L as C,aa as g,a$ as Se,bN as we,dp as te,dq as Me,a4 as Te,dr as Ee,ds as ve,k as ne,bj as Ie,dt as v,d5 as j,du as xe,d4 as Re,dv as H,bv as I,b7 as T,dw as ae,aE as z,dx as Ce,dy as re,dz as oe,dA as qe,dB as se,dC as Ne,dD as ie,ba as B,b9 as We,dE as ke,dF as Fe,dG as ze,aG as J,b8 as V,dH as E,dI as _,c5 as De}from"./vendor.d1b93dad.js";import{I as Oe}from"./I3SBinaryReader.38718b9a.js";function _e(e,t,n,a){const o=Ae(e,t,n),r=U();return $(n,o,r,a),r}const le=1,Q=5-le;function Ae(e,t,n){const a=K(),o=e[3],r=2**(Math.ceil(Math.log(o)*Math.LOG2E/Q)*Q+le);if(n.isGeographic){const l=r/ee(n).radius*180/Math.PI,c=Math.round(e[1]/l),p=Math.max(-90,Math.min(90,c*l)),d=l/Math.cos((Math.abs(p)-l/2)/180*Math.PI),y=Math.round(e[0]/d)*d;a[0]=y,a[1]=p}else{const l=Math.round(e[0]/r),c=Math.round(e[1]/r);a[0]=l*r,a[1]=c*r}const s=e[2]+t,i=Math.round(s/r);return a[2]=i*r,a}function ce(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function ht(e){if(me("disable-feature:i3s-draco")||!e)return!1;for(const n of e)for(const a of n.geometryBuffers){var t;if(((t=a.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0}return!1}function dt(e,t,n,a,o,r){o.traverse(n,s=>{let i=s.mbs;t!==a&&(i=Ge,be(s.mbs,a,i,t));const l=Le(e,i);return l!==M.OUTSIDE&&(r(s,l),!0)})}function pt(e,t,n){let a=0,o=0;for(let r=0;r<t.length&&a<e.length;r++)e[a]===t[r]&&(n(r)&&(e[o]=e[a],o++),a++);e.length=o}function yt(e,t,n){let a=0,o=0;for(;a<n.length;)ge(e,n[a])>=0===t&&(n[o]=n[a],o++),a++;n.length=o}const x=P();function mt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return x[0]=(e[0]-t.position[0])/t.rotationScale[0],x[1]=(e[1]-t.position[1])/t.rotationScale[4],x[2]=(e[2]-t.position[0])/t.rotationScale[0],x[3]=(e[3]-t.position[1])/t.rotationScale[4],x}const Ge=Fe();var M;function Le(e,t){const n=t[0],a=t[1],o=t[3],r=e[0]-n,s=n-e[2],i=e[1]-a,l=a-e[3],c=Math.max(r,s,0),p=Math.max(i,l,0),d=c*c+p*p;return d>o*o?M.OUTSIDE:d>0?M.INTERSECTS_CENTER_OUTSIDE:-Math.max(r,s,i,l)>o?M.INSIDE:M.INTERSECTS_CENTER_INSIDE}function Ue(e,t,n){const a=[],o=n&&n.missingFields,r=n&&n.originalFields;for(const s of e){const i=s.toLowerCase();let l=!1;for(const c of t)if(i===c.name.toLowerCase()){a.push(c.name),l=!0,r&&r.push(s);break}!l&&o&&o.push(s)}return a}async function bt(e,t,n,a,o){if(t.length===0)return[];const r=e.attributeStorageInfo;if(R(e.associatedLayer))try{return await Pe(e.associatedLayer,t,n,a)}catch(s){if(e.associatedLayer.loaded)throw s}if(r){const s=Ke(t,n,o);if(C(s))throw new g("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const i=e.parsedUrl.path,l=await Promise.all(s.map(c=>je(i,r,c.node,c.indices,a).then(p=>{for(let d=0;d<c.graphics.length;d++){const y=c.graphics[d],f=p[d];if(y.attributes)for(const h in y.attributes)h in f||(f[h]=y.attributes[h]);y.attributes=f}return c.graphics})));return te(l)}throw new g("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function Ke(e,t,n){const a=new Map,o=[],r=n();for(const s of e){const i=s.attributes[t];for(let l=0;l<r.length;l++){const c=r[l],p=c.featureIds.indexOf(i);if(p>=0){let d=a.get(c.node);d||(d={node:c.node,indices:[],graphics:[]},o.push(d),a.set(c.node,d)),d.indices.push(p),d.graphics.push(s);for(let y=l;y>0;y--)r[y]=r[y-1];r[0]=c;break}}}return o}async function Pe(e,t,n,a){t.sort((l,c)=>l.attributes[n]-c.attributes[n]);const o=t.map(l=>l.attributes[n]),r=[],s=Ue(a,e.fields,{originalFields:r}),i=await ue(e,o,s);for(let l=0;l<t.length;l++){const c=t[l],p=i[l],d={};if(c.attributes)for(const y in c.attributes)d[y]=c.attributes[y];for(let y=0;y<r.length;y++)d[r[y]]=p[s[y]];c.attributes=d}return t}function ue(e,t,n){const a=e.capabilities.query.maxRecordCount;if(a!=null&&t.length>a){const r=Me(t,a);return Promise.all(r.map(s=>ue(e,s,n))).then(te)}const o=new Te({objectIds:t,outFields:n,orderByFields:[e.objectIdField]});return e.queryFeatures(o).then(r=>{if(r&&r.features&&r.features.length===t.length)return r.features.map(s=>s.attributes);throw new g("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function je(e,t,n,a,o){const r=[];for(const s of t)if(s&&o.indexOf(s.name)!==-1){const i=`${e}/nodes/${n.resources.attributes}/attributes/${s.key}/0`;r.push({url:i,storageInfo:s})}return Se(r.map(s=>we(s.url,{responseType:"array-buffer"}).then(i=>Oe(s.storageInfo,i.data)))).then(s=>{const i=[];for(const l of a){const c={};for(let p=0;p<s.length;p++)s[p].value!=null&&(c[r[p].storageInfo.name]=Je(s[p].value,l));i.push(c)}return i})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(M||(M={}));const He=-32768,Be=-(2**31);function Je(e,t){if(!e)return null;const n=e[t];return Ee(e)?n===He?null:n:ve(e)?n===Be?null:n:n!=n?null:n}function Ve(e){const t=e.store.indexCRS||e.store.geographicCRS,n=t===void 0?e.store.indexWKT:void 0;if(n){if(!e.spatialReference)throw new g("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(n!==e.spatialReference.wkt)throw new g("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const a=t?new ne(ce(t)):e.spatialReference;return a.equals(e.spatialReference)?e.spatialReference:a}function Qe(e){const t=e.store.vertexCRS||e.store.projectedCRS,n=t===void 0?e.store.vertexWKT:void 0;if(n){if(!e.spatialReference)throw new g("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(n!==e.spatialReference.wkt)throw new g("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const a=t?new ne(ce(t)):e.spatialReference;return a.equals(e.spatialReference)?e.spatialReference:a}function gt(e,t){return C(t)?"@null":t===v(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function G(e,t,n){if(!Ie(e,t))throw new g("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(n==="local"&&!Xe(e,t))throw new g("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Xe(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function Ye(e,t,n){const a=Ve(e),o=Qe(e);G(a,t,n),G(o,t,n)}function Ze(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function St(e){if(e.store==null||e.store.defaultGeometrySchema==null||!Ze(e.store.defaultGeometrySchema))throw new g("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function wt(e,t){Ye(e,t.spatialReference,t.viewingMode)}function $e(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Mt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!$e(e.store.defaultGeometrySchema))throw new g("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Tt(e,t){G(e.spatialReference,t.spatialReference,t.viewingMode)}function et(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function tt(e){return e.type==="mesh-3d"}function Et(e){if(e==null||!et(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const n of t){if(!tt(n)||n.symbolLayers.length===0)return!0;for(const a of n.symbolLayers.items)if(a.type!=="fill"||C(a.material)||C(a.material.color)||a.material.colorMixMode!=="replace")return!0}return!1}const vt=de({color:[0,0,0,0],opacity:0});class nt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function It(e){const t=new nt;let n=!1,a=!1;for(const o of e.symbolLayers.items)if(o.type==="fill"&&o.enabled){const r=o.material,s=o.edges;if(R(r)&&!n){const i=r.color,l=xe(r.colorMixMode);R(i)?t.material={color:[i.r/255,i.g/255,i.b/255],alpha:i.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:j.Multiply},t.castShadows=o.castShadows,n=!0}R(s)&&!a&&(t.edgeMaterial=Re(s,{}),a=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:j.Multiply}),t}function xt(e,t){return(0|e)+(0|t)|0}function at(e,t,n,a,o=0){a===v(a)?t.isGeographic?ct(e,n,t,o):lt(e,n,t,o):t.isWGS84&&(a.isWebMercator||H(a))?rt(t,e,a,n,o):t.isWebMercator&&H(a)?it(t,e,a,n,o):e===n?(n.center[2]+=o,I(n.center,t,0,n.center,a,0,1)):(T(n.center,e.center[0],e.center[1],e.center[2]+o),I(n.center,t,0,n.center,a,0,1),ae(n.quaternion,e.quaternion),z(n.halfSize,e.halfSize))}function rt(e,t,n,a,o){z(w,t.center),w[2]+=o;const r=v(n);I(w,e,0,w,r,0,1),fe(r,t,w,n,a)}const F=new Float64Array(24),ot={data:F,size:3},X=K(),w=K(),st=ze();function it(e,t,n,a,o){z(w,t.center),w[2]+=o,fe(e,t,w,n,a)}function fe(e,t,n,a,o){const r=Ce(st,t.quaternion);for(let s=0;s<8;++s){for(let i=0;i<3;++i)X[i]=t.halfSize[i]*((s&1<<i)!=0?-1:1);for(let i=0;i<3;++i){let l=n[i];for(let c=0;c<3;++c)l+=X[c]*r[3*c+i];F[3*s+i]=l}}I(F,e,0,F,a,0,8),re(ot,o)}function lt(e,t,n,a){oe(e,L),T(t.center,e.center[0],e.center[1],e.center[2]+a),$(n,t.center,b,v(n)),T(t.center,b[12],b[13],b[14]);const o=2*Math.sqrt(1+b[0]+b[5]+b[10]);S[0]=(b[6]-b[9])/o,S[1]=(b[8]-b[2])/o,S[2]=(b[1]-b[4])/o,S[3]=.25*o,qe(t.quaternion,S,e.quaternion),se(S,t.quaternion);let r=0,s=0,i=0;for(const l of L)l[2]+=a,I(l,n,0,l,v(n),0,1),Ne(u,l,t.center),ie(u,u,S),r=Math.max(r,Math.abs(u[0])),s=Math.max(s,Math.abs(u[1])),i=Math.max(i,Math.abs(u[2]));T(t.halfSize,r,s,i)}function ct(e,t,n,a){const o=ee(n),r=1+Math.max(0,a)/(o.radius+e.center[2]);T(t.center,e.center[0],e.center[1],e.center[2]+a),I(t.center,n,0,t.center,v(n),0,1),ae(t.quaternion,e.quaternion),se(S,e.quaternion),T(u,0,0,1),ie(u,u,S),T(u,e.halfSize[0]*Math.abs(u[0]),e.halfSize[1]*Math.abs(u[1]),e.halfSize[2]*Math.abs(u[2])),B(u,u,o.inverseFlattening),We(t.halfSize,e.halfSize,u),B(t.halfSize,t.halfSize,r)}function Rt(e,t,n,a,o,r){if(!r||r.length===0||C(t))return null;const s=_e(e.mbs,o,n,t);let i;ke(k,s);const l=()=>{if(!i)if(i=L,J(W),R(e.serviceObb)){at(e.serviceObb,n,Y,t,o),oe(Y,i);for(const f of i)E(f,f,k),_(W,f)}else{const f=e.mbs,h=f[3];V(f,n,u,t),E(u,u,k),u[2]+=o;for(let m=0;m<8;++m){const q=1&m?h:-h,D=2&m?h:-h,O=4&m?h:-h,N=i[m];z(N,[u[0]+q,u[1]+D,u[2]+O]),_(W,N)}}};let c=1/0,p=-1/0;const d=f=>{if(f.type!=="replace")return;const h=f.geometry;if(!h.hasZ)return;J(A);const m=h.spatialReference||a,q=h.rings.reduce((D,O)=>O.reduce((N,he)=>(V(he,m,u,t),E(u,u,k),_(A,u),Math.min(u[2],N)),D),1/0);l(),De(W,A)&&(c=Math.min(c,q),p=Math.max(p,q))};if(r.forEach(f=>d(f)),c===1/0)return null;const y=(f,h,m)=>{E(u,m,s),f[h+0]=u[0],f[h+1]=u[1],f[h+2]=u[2],h+=24,m[2]=c,E(u,m,s),f[h+0]=u[0],f[h+1]=u[1],f[h+2]=u[2],h+=24,m[2]=p,E(u,m,s),f[h+0]=u[0],f[h+1]=u[1],f[h+2]=u[2]};for(let f=0;f<8;++f)y(Z.data,3*f,i[f]);return re(Z)}const b=U(),S=pe(),L=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],A=P(),W=P(),Y=ye(),u=[0,0,0],Z={data:new Array(72),size:3},k=U();export{It as D,St as M,Rt as Q,Qe as S,Ye as T,at as W,ht as X,dt as Y,xt as _,_e as a,Ve as b,Ue as c,M as d,pt as e,gt as g,Ae as h,Le as i,Tt as j,vt as k,bt as l,mt as o,Et as q,yt as t,wt as v,G as w,Mt as x,Je as y};
