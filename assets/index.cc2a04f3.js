var K=Object.defineProperty;var x=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var S=(r,e,t)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,P=(r,e)=>{for(var t in e||(e={}))Q.call(e,t)&&S(r,t,e[t]);if(x)for(var t of x(e))W.call(e,t)&&S(r,t,e[t]);return r};import{_ as a,h as C,d as l,l as f,e as X,m as J,Q as ee,g as T,a as te,f as $,Y as ie,k as oe,c as m,b as p,i as z,r as O,j as re,n as I,o as ne,p as se,q as ae,t as le,s as ce,v as he,u as b,w as N,x as de,y as _,z as ge,A as ue,B as F,C as pe,D as j,U as G,E as fe,F as k,G as ye}from"./vendor.d1b93dad.js";const me=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}};me();function we(r){let e=r.length;for(;e!=0;){const t=Math.floor(Math.random()*e);e--,[r[e],r[t]]=[r[t],r[e]]}}class U extends C{constructor(e){super();this.colors=e,we(e)}get selectionColor(){return this.colors.length?this.colors[0]:void 0}allocate(){this.colors.length&&this.colors.shift()}reinstate(e){this.colors.push(e)}}a([l()],U.prototype,"selectionColor",null);const ve=["#f700dc","#f8e900","#9400f6","#04ebf3","#35f714"],be=["#f7baf1","#f7f3ba","#dcb8f5","#b6f0f2","#c3f7ba"],Re=["#4d0044","#4d4700","#2e004d","#02484b","#114d06"],E=new U(ve.map((r,e)=>({main:new f(r),dark:new f(Re[e]),light:new f(be[e])}))),w=new X({portalItem:{id:"8e49a0c79bf543fd8fa52b4dd5c9a064"}}),c=new J({container:"viewDiv",map:w,environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},constraints:{altitude:{min:3e6,max:3e7}},padding:{top:20}});function A(r){const e=r.getAttribute("label");if(e)return e;if(r.layer.type==="feature")return r.getAttribute("NAME")||r.getAttribute("COUNTRY")}ee();function Ee(r,e,t){const o=A(r),i=ie(r.geometry,oe.WGS84),n=t.main.clone();n.a=.2;const s=t.light.clone();return s.a=.9,new T({attributes:P({label:o},r.attributes),geometry:i,symbol:new te({symbolLayers:[new $({material:{color:[0,0,0,0]},outline:{color:t.main,size:3}}),new $({material:{color:n},outline:{color:t.light,size:1.2}})]})})}const M=180;class D{constructor(e){this.view=e}rotate(e,t){const o=m();p(this.view,[e.centroid.x,e.centroid.y,0],0,e.spatialReference,o,0,1);const i=z();return O(i,i,t,o),this.transformPolygon(e,i)}moveTo(e,t){const o=e.centroid,i=z();return this.addZRotation(t,i,!1),this.addYRotation(t,i,!1),this.addYRotation(o,i,!0),this.addZRotation(o,i,!0),this.transformPolygon(e,i)}scale(e,t){const o=e.centroid.x,i=e.centroid.y,n=e.clone();return n.rings.forEach(s=>{s.forEach(h=>{h[0]+=(h[0]-o)*(t-1),h[1]+=(h[1]-i)*(t-1)})}),n}clamp(e,t,o){return e<t?t:e>o?o:e}angle(e,t){const o=re(e,t)/(I(e)*I(t));return-Math.acos(this.clamp(o,-1,1))}axisAngleFromPoints(e,t,o=[0,0,1,0]){return ne(o,e,t),se(o,o),o[3]=this.angle(e,t),o}transformCoordinates(e,t,o,i){const n=ae(0,0,0);p(this.view,[e,t,0],0,o,n,0,1),le(n,n,i);const s=[0,0,0];return ce(this.view,n,0,s,0,o,1),[s[0],s[1]]}transformPolygon(e,t){const o=[],i=e.spatialReference,[n]=this.transformCoordinates(e.centroid.x,e.centroid.y,i,t);for(const s of e.rings){const h=[];for(const R of s){let[u,Z]=this.transformCoordinates(R[0],R[1],i,t);const B=u-n;M<Math.abs(B)&&(u=n<0?u-2*M:u+2*M),h.push([u,Z])}o.push(h)}return new he({rings:o,spatialReference:i})}addZRotation(e,t,o){const i=m(),n=m();p(this.view,[0,0,0],0,e.spatialReference,i,0,1),p(this.view,[e.x,0,0],0,e.spatialReference,n,0,1);const s=this.axisAngleFromPoints(i,n);isNaN(s[3])||O(t,t,o?s[3]:-s[3],s)}addYRotation(e,t,o){const i=m(),n=m();p(this.view,[0,0,0],0,e.spatialReference,i,0,1),p(this.view,[0,e.y,0],0,e.spatialReference,n,0,1);const s=this.axisAngleFromPoints(i,n);isNaN(s[3])||O(t,t,o?s[3]:-s[3],s)}}const H=new D(c);let g=class extends C{constructor(e){super(e);this.center=new T({symbol:new N({symbolLayers:[new de({material:{color:[0,0,0,0]},width:5e3,height:5e3,depth:5e3,resource:{primitive:"diamond"}})]})}),this.handlers=new _;const t=e.selection.color,i=(this.graphic=Ee(e.selection.graphic,c,t)).geometry.centroid;this.center.geometry=i;const n=A(e.selection.graphic),s=t.main.clone();s.a=.7,this.label=new T({geometry:i.clone(),symbol:new N({symbolLayers:[new ge({text:n,material:{color:[255,255,255,.9]},halo:{size:.5,color:t.dark},font:{size:12}})]})}),this.handlers.add(this.watch("center.geometry",h=>{this.graphic.geometry=H.moveTo(this.graphic.geometry,h),this.label.geometry=h})),this.handlers.add(this.watch("angle",(h,R=0)=>{const u=(R-h)*Math.PI/180;this.graphic.geometry=H.rotate(this.graphic.geometry,u)}))}get angle(){return this.center.symbol.symbolLayers.getItemAt(0).heading}destroy(){this.handlers.removeAll()}};a([l({constructOnly:!0})],g.prototype,"selection",void 0);a([l()],g.prototype,"graphic",void 0);a([l()],g.prototype,"center",void 0);a([l()],g.prototype,"label",void 0);a([l({readOnly:!0})],g.prototype,"angle",null);a([l()],g.prototype,"handlers",void 0);g=a([b("TrueSize.TransformedRegion")],g);var Le=g;let d=class extends C{constructor(){super(...arguments);this.regions=new ue,this.handles=new _,this.interactive=!1,this.loading=!1}get active(){return this.sketchViewModel.state==="active"}initialize(){this.sketchLayer=new F({title:"Graphics layer for moving country center",listMode:"hide",elevationInfo:{mode:"on-the-ground"}}),this.graphicsLayer=new F({title:"Graphics layer for projecting country",listMode:"hide",elevationInfo:{mode:"on-the-ground"}}),w.loadAll().then(()=>{c.map.layers.push(this.sketchLayer),c.map.layers.push(this.graphicsLayer)}),this.sketchViewModel=new pe({layer:this.sketchLayer,view:c,defaultUpdateOptions:{toggleToolOnClick:!1,enableScaling:!1,enableZ:!0}}),new D(c),this.sketchViewModel.on("update",e=>{if(e.state!=="active"||!e.graphics.length)return;const t=this.regionFromGraphic(e.graphics[0]),o=e.toolEventInfo.type;(o==="move-start"||o==="rotate-start")&&this._set("interactive",!0),(o==="move-stop"||o==="rotate-stop")&&(this._set("interactive",!1),o==="move-stop"&&c.goTo(t.center.geometry))}),this.sketchViewModel.on("delete",e=>{e.graphics.map(t=>this.regionFromGraphic(t)).forEach(t=>{this.graphicsLayer.remove(t.graphic),this.graphicsLayer.remove(t.label),this.regions.remove(t),E.reinstate(t.selection.color)})})}cancelEditing(){this.sketchViewModel.cancel(),this.handles.removeAll()}regionFromGraphic(e){return this.regions.find(t=>t.graphic===e||t.selection.graphic===e||t.label===e||t.center===e)}continueEditing(e){const t=this.regionFromGraphic(e);t&&this.sketchViewModel.update(t.center,{enableScaling:!1})}editSelection(e){E.allocate();const t=new Le({selection:e});this.regions.add(t),this.sketchLayer.add(t.center),this.graphicsLayer.add(t.graphic),this.graphicsLayer.add(t.label),this.continueEditing(e.graphic)}};a([l()],d.prototype,"sketchViewModel",void 0);a([l()],d.prototype,"sketchLayer",void 0);a([l()],d.prototype,"graphicsLayer",void 0);a([l()],d.prototype,"regions",void 0);a([l()],d.prototype,"handles",void 0);a([l()],d.prototype,"active",null);a([l({readOnly:!0})],d.prototype,"interactive",void 0);a([l()],d.prototype,"loading",void 0);d=a([b("TrueSize.RegionEditor")],d);var Ce=d;function V(r){return`${r.layer.id}_${r.getObjectId()}`}let y=class extends C{constructor(e){super(e)}equalsGraphic(e){return V(this.graphic)===V(e)}async highlight(e){if(this.highlightHandle)return;e.highlightOptions={color:this.color.light,fillOpacity:1,haloColor:this.color.main,haloOpacity:.7};const t=this.graphic,i=(await e.whenLayerView(t.layer)).highlight(t);this.highlightHandle=i}removeHighlight(){const e=this.highlightHandle;e&&e.remove()}};a([l({constructOnly:!0})],y.prototype,"color",void 0);a([l({constructOnly:!0})],y.prototype,"graphic",void 0);a([l()],y.prototype,"highlightHandle",void 0);y=a([b("TrueSize.SelectedRegion")],y);var q=y;let v=class extends j{constructor(){super(...arguments);this.selectedRegion=null,this.regionEditor=new Ce,this.highlightAtPointer=G(async e=>{if(this.regionEditor.active||c.interacting)return;const t=E.selectionColor;if(!t)return;const o=await this.queryRegion(e);if(o&&!this.regionEditor.active&&o.layer.type!=="graphics"){const i=this.selectedRegion;if(i&&i.equalsGraphic(o))return;this.selectedRegion=new q({graphic:o,color:t}),await this.selectedRegion.highlight(c),i&&i.removeHighlight()}else this.resetRegion()}),this.selectAtPointer=G(async e=>{if(this.regionEditor.active)return;const t=await this.queryRegion(e);if(t){const o=E.selectionColor;t.layer.type==="graphics"?this.regionEditor.continueEditing(t):o&&(e.preventDefault(),this.regionEditor.editSelection(new q({color:o,graphic:t})),this.resetRegion(),await fe(this.regionEditor,"active"))}})}postInitialize(){c.popup.autoOpenEnabled=!1,this.scheduleEventListener()}render(){const e=this.selectedRegion;return k("div",{class:"place-country"},k("span",null,e?"Compare "+A(e.graphic):""))}async queryRegion(e){const t=w.allLayers.filter(s=>s.type==="feature"||s.type==="graphics"),i=(await c.hitTest(e,{include:t})).results;function n(s){return t.indexOf(s.graphic.layer)}if(i.length)return i.sort((s,h)=>n(h)-n(s)),i[0].graphic}resetRegion(){const e=this.selectedRegion;e&&(e.removeHighlight(),this.selectedRegion=null)}scheduleEventListener(){let e=!1;c.on("pointer-move",async t=>{if(!e)try{await this.highlightAtPointer(t)}catch{}}),c.on("immediate-click",async t=>{e=!0,await this.selectAtPointer(t),e=!1})}};a([l()],v.prototype,"selectedRegion",void 0);a([l()],v.prototype,"regionEditor",void 0);v=a([b("TrueSize.PlaceCountry")],v);const Y=new v;let L=class extends j{constructor(){super(...arguments);this.editor=Y.regionEditor,this.white={light:new f([200,200,200]),main:new f([80,80,80]),dark:new f([20,20,20])}}postInitialize(){c.ui.add([{component:"title",position:"top-left",index:0}]),c.ui.add(Y,"manual"),w.loadAll().then(async()=>{w.allLayers.filter(e=>e.type==="feature").map(e=>e).forEach(e=>{e.fields.find(t=>t.name==="NAME")?e.outFields=["NAME"]:e.fields.find(t=>t.name==="COUNTRY")&&(e.outFields=["COUNTRY"])})})}render(){return k("div",{class:"widgets"})}};a([l({readOnly:!0})],L.prototype,"editor",void 0);L=a([b("TrueSize.App")],L);var Oe=L;new Oe({container:"app"});ye(()=>!c.updating).then(()=>{var e;const r=document.getElementById("loader");(e=r==null?void 0:r.parentElement)==null||e.removeChild(r)});window.view=c;
