var wn=Object.defineProperty,Mn=Object.defineProperties;var Rn=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var Pn=Object.prototype.hasOwnProperty,Sn=Object.prototype.propertyIsEnumerable;var Z=(n,t,e)=>t in n?wn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,B=(n,t)=>{for(var e in t||(t={}))Pn.call(t,e)&&Z(n,e,t[e]);if(V)for(var e of V(t))Sn.call(t,e)&&Z(n,e,t[e]);return n},J=(n,t)=>Mn(n,Rn(t));import{hF as fn,ef as bn,ao as Q,bv as z,t as C,r as S,by as A,aS as E,a_ as En,L as Gn,hG as k,hH as G,hI as nn,hJ as kn,hK as Nn,d7 as vn,hL as tn}from"./vendor.f59113c8.js";function un(n,t,e){return!En(n,t,e)}function T(n,t,e){const r=un(n,t,e);if(r&&!fn())throw new Gn("rasterprojectionhelper-project","projection engine is not loaded");return r}const en=function(n,t,e,r=0){if(e[0]===1)return[0,0];let a=1,o=-1,s=1,l=-1;for(let c=0;c<n.length;c+=2)isNaN(n[c])||(a=a>n[c]?n[c]:a,o=o>n[c]?o:n[c],s=s>n[c+1]?n[c+1]:s,l=l>n[c+1]?l:n[c+1]);const{cols:i,rows:x}=t,h=(o-a)/i/e[0],R=(l-s)/x/e[1],y=2*r;let w=0,f=!1,m=[0,0];for(let c=0;c<i-3;c++){for(let g=0;g<x-3;g++){const u=c*x*2+2*g,p=(n[u]+n[u+4]+n[u+4*x]+n[u+4*x+4])/4,d=(n[u+1]+n[u+5]+n[u+4*x+1]+n[u+4*x+5])/4,M=Math.abs((p-n[u+2*x+2])/h),P=Math.abs((d-n[u+2*x+3])/R);if(M+P>w&&(w=M+P,m=[M,P]),y&&w>y){f=!0;break}}if(f)break}return m},Tn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},I=32,Y=4,q=Y,K=new Map,X=new Map;async function Yn(){if(fn())return null;await bn()}function Fn(n,t,e){return T(n.spatialReference,t)?e?tn(t,n.spatialReference,n):tn(n.spatialReference,t,n):null}function Ln(n,t,e,r=null){const a=n.spatialReference;if(a.equals(t))return n;T(a,t,r);const o=e.center,s=new Q({xmin:o.x-n.x/2,xmax:o.x+n.x/2,ymin:o.y-n.y/2,ymax:o.y+n.y/2,spatialReference:a}),l=z(s,t,r);if(C(l))return null;const i={x:l.xmax-l.xmin,y:l.ymax-l.ymin},x=v(t);if(S(x)&&i.x>=x){const h=A(a)/A(t);i.x=n.x*h,i.y=n.y*h}return i}function N(n,t=.01){return A(n)?t/A(n):0}function on(n,t,e=null,r=!0){const a=n.spatialReference;if(a.equals(t))return n;T(a,t,e);const o=z(n,t,e);if(!r||!o)return o;const s=F(a,!0),l=F(t,!0),i=N(a);return i&&S(s)&&S(l)&&(o.x>0&&Math.abs(n.x-s[0])<i?o.x-=l[1]-l[0]:o.x<0&&Math.abs(n.x-s[1])<i&&(o.x+=l[1]-l[0])),o}function _n(n){const{inSR:t,outSR:e,datumTransformation:r,preferPE:a}=n;if(t.equals(e)){const{points:o}=U(n,null);return o}if(t.isWebMercator&&e.isWGS84||t.isWGS84&&e.isWebMercator)return $n(n);if(T(t,e,r)&&a){if(t.isGeographic)return sn(n);const o=$(t);if(S(o))return sn(n)}return Cn(n)}function Cn(n){const{points:t}=U(n,null),e=t.map(r=>new E(r[0],r[1],n.inSR));return z(e,n.outSR,n.datumTransformation).map(r=>r?[r.x,r.y]:[NaN,NaN])}function sn(n){const{inSR:t,outSR:e,datumTransformation:r}=n,a=$(t),{points:o,mask:s}=U(n,a);if(!t.isGeographic){const i=t.wkid?k.coordsys(t.wkid):k.fromString(t.isGeographic?G.PE_TYPE_GEOGCS:G.PE_TYPE_PROJCS,t.wkt);nn.projToGeog(i,o.length,o)}if(S(r)&&r.steps.length&&r.steps.forEach(i=>{const x=i.wkid?k.geogtran(i.wkid):k.fromString(G.PE_TYPE_GEOGTRAN,i.wkt);kn.geogToGeog(x,o.length,o,null,i.isInverse?G.PE_TRANSFORM_2_TO_1:G.PE_TRANSFORM_1_TO_2)}),!e.isGeographic){const i=$(e,!0),x=S(i)&&i.isEnvelope?[i.bbox[1],i.bbox[3]]:[-90,90];zn(o,x);const h=e.wkid?k.coordsys(e.wkid):k.fromString(e.isGeographic?G.PE_TYPE_GEOGCS:G.PE_TYPE_PROJCS,e.wkt);nn.geogToProj(h,o.length,o)}let l=o;if(s&&o.length!==s.length){l=[];for(let i=0,x=0;i<s.length;i++)s[i]?l.push(o[x++]):l.push([NaN,NaN])}return l}function $n(n){const{cols:t,rows:e,xres:r,yres:a,usePixelCenter:o,inSR:s,outSR:l}=n;let{xmin:i,ymax:x}=n;o&&(i+=r/2,x-=a/2);const h=[],R=[],y=Math.max(t,e);for(let f=0;f<y;f++){const m=i+r*Math.min(t,f),c=x-a*Math.min(e,f),g=z(new E({x:m,y:c,spatialReference:s}),l);f<=t&&h.push(g.x),f<=e&&R.push(g.y)}const w=[];for(let f=0;f<t;f++)for(let m=0;m<e;m++)w.push([h[f],R[m]]);return w}function $(n,t=!1){let e=n.wkid||n.wkt;if(!e||n.isGeographic)return null;if(e=String(e),K.has(e)){const s=K.get(e);return t?s==null?void 0:s.gcs:s==null?void 0:s.pcs}const r=n.wkid?k.coordsys(n.wkid):k.fromString(n.isGeographic?G.PE_TYPE_GEOGCS:G.PE_TYPE_PROJCS,n.wkt),a=rn(r,N(n,1e-4)),o=rn(r,0,!0);return K.set(e,{pcs:a,gcs:o}),t?o:a}function rn(n,t=0,e=!1){const r=Nn.generate(n),a=e?n.horizonGcsGenerate():n.horizonPcsGenerate();if(a==null||!a.length)return null;let o=!1,s=a.find(m=>m.getInclusive()===1&&m.getKind()===1);if(!s){if(s=a.find(m=>m.getInclusive()===1&&m.getKind()===0),!s)return null;o=!0}const l=r.isPannableRectangle(),i=s.getCoord();if(o)return{isEnvelope:o,isPannable:l,vertices:i,coef:null,bbox:[i[0][0]-t,i[0][1]-t,i[1][0]+t,i[1][1]+t]};let x=0;const h=[];let[R,y]=i[0],[w,f]=i[0];for(let m=0,c=i.length;m<c;m++){x++,x===c&&(x=0);const[g,u]=i[m],[p,d]=i[x];if(d===u)h.push([g,p,u,d,2]);else{const M=(p-g)/(d-u||1e-4),P=g-M*u;u<d?h.push([M,P,u,d,0]):h.push([M,P,d,u,1])}R=R<g?R:g,y=y<u?y:u,w=w>g?w:g,f=f>u?f:u}return{isEnvelope:!1,isPannable:l,vertices:i,coef:h,bbox:[R,y,w,f]}}function U(n,t){const e=[],{cols:r,rows:a,xres:o,yres:s,usePixelCenter:l}=n;let{xmin:i,ymax:x}=n;if(l&&(i+=o/2,x-=s/2),!S(t)){for(let w=0;w<r;w++)for(let f=0;f<a;f++)e.push([i+o*w,x-s*f]);return{points:e}}const h=new Uint8Array(r*a);if(t.isEnvelope){const{bbox:[w,f,m,c]}=t;for(let g=0,u=0;g<r;g++){const p=i+o*g,d=t.isPannable||p>=w&&p<=m;for(let M=0;M<a;M++,u++){const P=x-s*M;d&&P>=f&&P<=c&&(e.push([p,P]),h[u]=1)}}return{points:e,mask:h}}const{coef:R}=t,y=[];for(let w=0;w<a;w++){const f=x-s*w,m=[],c=[];for(let u=0;u<R.length;u++){const[p,d,M,P,O]=R[u];if(f===M&&M===P)m.push(p),m.push(d),c.push(2),c.push(2);else if(f>=M&&f<=P){const W=p*f+d;m.push(W),c.push(O)}}let g=m;if(m.length>2){let u=c[0]===2?0:c[0],p=m[0];g=[];for(let d=1;d<c.length;d++)c[d]===2&&d!==c.length-1||(c[d]!==u&&(g.push(u===0?Math.min(p,m[d-1]):Math.max(p,m[d-1])),u=c[d],p=m[d]),d===c.length-1&&g.push(c[d]===0?Math.min(p,m[d]):Math.max(p,m[d])));g.sort((d,M)=>d-M)}else m[0]>m[1]&&(g=[m[1],m[0]]);y.push(g)}for(let w=0,f=0;w<r;w++){const m=i+o*w;for(let c=0;c<a;c++,f++){const g=x-s*c,u=y[c];if(u.length===2)m>=u[0]&&m<=u[1]&&(e.push([m,g]),h[f]=1);else if(u.length>2){let p=!1;for(let d=0;d<u.length;d+=2)if(m>=u[d]&&m<=u[d+1]){p=!0;break}p&&(e.push([m,g]),h[f]=1)}}}return{points:e,mask:h}}function zn(n,t){const[e,r]=t;for(let a=0;a<n.length;a++){const o=n[a][1];(o<e||o>r)&&(n[a]=[NaN,NaN])}}function xn(n){const t=v(n[0].spatialReference);if(n.length<2||!S(t))return n[0];let{xmin:e,xmax:r,ymin:a,ymax:o}=n[0];for(let s=1;s<n.length;s++){const l=n[s];r=l.xmax+t*s,a=Math.min(a,l.ymin),o=Math.max(o,l.ymax)}return new Q({xmin:e,xmax:r,ymin:a,ymax:o,spatialReference:n[0].spatialReference})}function On(n,t,e=null,r=!0){if(n.spatialReference.equals(t))return n;const a=Wn(n),o=v(n.spatialReference,!0),s=v(t);if(a===0||C(o)||C(s))return an(n,t,e,r);const l=n.clone().normalize();if(l.length===1&&n.xmax<o&&n.xmax-o/2>N(n.spatialReference)){const{xmin:i,xmax:x}=n;for(let h=0;h<=a;h++){const R=h===0?i:-o/2,y=h===a?x-o*h:o/2;l[h]=new Q({xmin:R,xmax:y,ymin:n.ymin,ymax:n.ymax,spatialReference:n.spatialReference})}}return xn(l.map(i=>an(i,t,e,r)).filter(i=>!!i))}function an(n,t,e=null,r=!0,a=!0){const o=n.spatialReference;if(o.equals(t))return n;T(o,t,e);const s=z(n,t,e);if(a&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!r||!s)return s;const l=F(o,!0),i=F(t,!0);if(C(l)||C(i))return s;const x=N(o,.001),h=N(o,500),R=N(t,.001);if(Math.abs(s.xmin-i[0])<R&&Math.abs(s.xmax-i[1])<R){const y=Math.abs(n.xmin-l[0]),w=Math.abs(l[1]-n.xmax);if(y<x&&w>h){s.xmin=i[0];const f=[];f.push(new E(n.xmax,n.ymin,o)),f.push(new E(n.xmax,(n.ymin+n.ymax)/2,o)),f.push(new E(n.xmax,n.ymax,o));const m=f.map(c=>on(c,t,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmax=Math.max.apply(null,m)}if(w<x&&y>h){s.xmax=i[1];const f=[];f.push(new E(n.xmin,n.ymin,o)),f.push(new E(n.xmin,(n.ymin+n.ymax)/2,o)),f.push(new E(n.xmin,n.ymax,o));const m=f.map(c=>on(c,t,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmin=Math.min.apply(null,m)}}else{const y=N(t,.001);Math.abs(s.xmin-i[0])<y&&(s.xmin=i[0]),Math.abs(s.xmax-i[1])<y&&(s.xmax=i[1])}return s}function v(n,t=!1){const e=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*e:n.wkid&&n.isGeographic?360:2*Tn[n.wkid]||null}function F(n,t=!1){if(n.isGeographic)return[-180,180];const e=v(n,t);return S(e)?[-e/2,e/2]:null}function ln(n,t,e,r){let a=(n-t)/e;return a-Math.floor(a)!=0?a=Math.floor(a):r&&(a-=1),a}function Wn(n,t=!1){const e=v(n.spatialReference);if(!S(e))return 0;const r=t?0:-(e/2),a=N(n.spatialReference),o=!t&&Math.abs(n.xmax-e/2)<a?e/2:n.xmax,s=!t&&Math.abs(n.xmin+e/2)<a?-e/2:n.xmin;return ln(o,r,e,!0)-ln(s,r,e,!1)}function Bn(n){const t=n.storageInfo.origin.x,e=v(n.spatialReference,!0);if(!S(e))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=e/2,{nativePixelSize:a,storageInfo:o,extent:s}=n,{maximumPyramidLevel:l,blockWidth:i,pyramidScalingFactor:x}=o;let h=a.x;const R=[],y=S(n.transform)&&n.transform.type==="gcs-shift",w=t+(y?0:r),f=y?e-t:r-t;for(let m=0;m<=l;m++){const c=(s.xmax-t)/h/i,g=c-Math.floor(c)==0?c:Math.ceil(c),u=f/h/i,p=u-Math.floor(u)==0?u:Math.ceil(u),d=Math.floor(w/h/i),M=Math.round(w/h)%i,P=(i-Math.round(f/h)%i)%i;R.push({resolutionX:h,blockWidth:i,datsetColumnCount:g,worldColumnCountFromOrigin:p,leftMargin:M,rightPadding:P,originColumnOffset:d}),h*=x}return{originX:t,halfWorldWidth:r,pyramidsInfo:R,hasGCSSShiftTransform:y}}function jn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt);let e;return X.has(t)?e=X.get(t):(e=(n.wkid?k.coordsys(n.wkid):k.fromString(G.PE_TYPE_PROJCS,n.wkt)).getGeogcs().getCode(),X.set(t,e)),new vn({wkid:e})}function Jn(n){const t=n.isAdaptive&&n.spacing==null;let e=n.spacing||[I,I],r=H(n),a={cols:r.size[0]+1,rows:r.size[1]+1};const o=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let s=r.outofBoundPointCount===r.offsets.length/2||t&&o?[0,0]:en(r.offsets,a,e,q);const l=(s[0]+s[1])/2,i=n.projectedExtent.spatialReference,x=n.srcBufferExtent.spatialReference;if(t&&(o||l>q)&&(un(i,x,n.datumTransformation)&&(i.isGeographic||S($(i))),e=[Y,Y],r=H(J(B({},n),{spacing:e})),a={cols:r.size[0]+1,rows:r.size[1]+1},s=en(r.offsets,a,e,q)),r.error=s,e[0]>1&&(r.coefficients=cn(r.offsets,a,o)),n.includeGCSGrid&&!i.isGeographic&&!i.isWebMercator)if(x.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:e};else{const h=$(i);if(S(h)&&!h.isEnvelope){const R=jn(i),y=On(n.projectedExtent,R),{offsets:w}=H(J(B({},n),{srcBufferExtent:y,spacing:e})),f=cn(w,a,o);r.gcsGrid={offsets:w,coefficients:f,spacing:e}}}return r}function H(n){const{projectedExtent:t,srcBufferExtent:e,pixelSize:r,datumTransformation:a,rasterTransform:o}=n,s=t.spatialReference,l=e.spatialReference;T(s,l);const{xmin:i,ymin:x,xmax:h,ymax:R}=t,y=v(l),w=S(y)&&(n.hasWrapAround||(o==null?void 0:o.type)==="gcs-shift"),f=n.spacing||[I,I],m=f[0]*r.x,c=f[1]*r.y,g=f[0]===1,u=Math.ceil((h-i)/m-.1/f[0])+(g?0:1),p=Math.ceil((R-x)/c-.1/f[1])+(g?0:1),d=_n({cols:u,rows:p,xmin:i,ymax:R,xres:m,yres:c,inSR:s,outSR:l,datumTransformation:a,preferPE:f[0]<=Y,usePixelCenter:g}),M=[];let P,O=0;const W=g?-1:NaN,{xmin:mn,xmax:hn,ymax:pn,width:gn,height:yn}=e,dn=N(l,500);for(let j=0;j<u;j++){const L=[];for(let _=0;_<p;_++){let b=d[j*p+_];if(w&&b[0]>hn&&b[0]>y/2-dn&&(b[0]-=y),!b||isNaN(b[0])||isNaN(b[1]))M.push(W),M.push(W),L.push(null),O++;else{if(o){const D=o.inverseTransform(new E({x:b[0],y:b[1],spatialReference:l}));b=[D.x,D.y]}L.push(b),j>0&&w&&P[_]&&b[0]<P[_][0]&&(b[0]+=y),M.push((b[0]-mn)/gn),M.push((pn-b[1])/yn)}}P=L}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:O,spacing:f,size:g?[u,p]:[u-1,p-1]}}function cn(n,t,e){const{cols:r,rows:a}=t,o=new Float32Array((r-1)*(a-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let i=0;i<r-1;i++){for(let x=0;x<a-1;x++){let h=i*a*2+2*x;const R=n[h],y=n[h+1],w=n[h+2],f=n[h+3];h+=2*a;const m=n[h],c=n[h+1],g=n[h+2],u=n[h+3];let p=0,d=12*(x*(r-1)+i);for(let M=0;M<3;M++)o[d++]=s[p++]*R+s[p++]*w+s[p++]*g;p=0;for(let M=0;M<3;M++)o[d++]=s[p++]*y+s[p++]*f+s[p++]*u;p=0;for(let M=0;M<3;M++)o[d++]=l[p++]*R+l[p++]*m+l[p++]*g;p=0;for(let M=0;M<3;M++)o[d++]=l[p++]*y+l[p++]*c+l[p++]*u}if(e)for(let x=0;x<o.length;x++)isNaN(o[x])&&(o[x]=-1)}return o}function qn(n){const t=n.clone().normalize();return t.length===1?t[0]:xn(t)}function Kn(n,t,e){const{storageInfo:r,pixelSize:a}=t;let o,s=!1;const{pyramidResolutions:l}=r;if(S(l)&&l.length){const y=(n.x+n.y)/2,w=l[l.length-1],f=(w.x+w.y)/2,m=(a.x+a.y)/2;if(y<=m)o=0;else if(y>=f)o=l.length,s=y/f>8;else{let g,u=m;for(let p=1;p<=l.length;p++){if(g=(l[p-1].x+l[p-1].y)/2,y<=g){y===g?o=p:e==="down"?(o=p-1,s=y/u>8):o=e==="up"||y-u>g-y||y/u>2?p:p-1;break}u=g}}const c=o===0?a:l[o-1];return{pyramidLevel:o,pyramidResolution:new E({x:c.x,y:c.y,spatialReference:t.spatialReference}),excessiveReading:s}}const i=Math.log(n.x/a.x)/Math.LN2,x=Math.log(n.y/a.y)/Math.LN2,h=t.storageInfo.maximumPyramidLevel||0;o=e==="down"?Math.floor(Math.min(i,x)):e==="up"?Math.ceil(Math.max(i,x)):Math.round((i+x)/2),o<0?o=0:o>h&&(s=o>h+3,o=h);const R=2**o;return{pyramidLevel:o,pyramidResolution:new E({x:R*t.nativePixelSize.x,y:R*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}export{On as B,Jn as D,Yn as G,Bn as K,v as L,Ln as N,on as T,qn as V,Wn as X,Kn as Z,Fn as k,un as y};
