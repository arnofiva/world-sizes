var Te=Object.defineProperty,xe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var be=(e,t,i)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,b=(e,t)=>{for(var i in t||(t={}))je.call(t,i)&&be(e,i,t[i]);if(we)for(var i of we(t))Ge.call(t,i)&&be(e,i,t[i]);return e},P=(e,t)=>xe(e,Re(t));import{ax as Ne,J as r,d as o,x as ge,h as pe,y as me,aI as w,F as ce,V as L,dI as Ie,bk as fe,a6 as z,a7 as A,M as m,gL as K,fa as ue,ca as Ue,jV as We,jW as He,jX as qe,K as j,iE as Le,iA as Fe,iT as ke,iU as Qe,cC as Be,cm as S,cE as ee,cN as te,cP as Y,cQ as Xe,cR as Ye,cS as Ze,cT as Je,cU as Ke,cV as et,cX as tt,cZ as it,jY as st,c_ as at,hc as nt,d1 as rt,d3 as ot,ht as lt,jZ as dt,d9 as ht,dc as ct,cI as ut,iX as gt,d8 as pt,b8 as ie,iF as se,fd as Ve,iG as mt,dW as ae,dy as _t,iY as R,j_ as H,jo as q,cj as vt,dU as _e,ii as yt,i_ as ne,i$ as wt,bb as bt,ba as ft,j4 as Lt,j0 as Pt,j1 as St,j6 as Ot,jN as Pe,iR as Ct,jb as De,jl as ve,aC as Et}from"./vendor.5a0f9a12.js";import{t as zt,e as $,h as F,b as re,f as Se,_ as x,d as k,y as oe,i as At,j as le,s as Vt,a as de,k as he,w as Oe,g as Dt}from"./Segment.07c88bd4.js";import{p as $t}from"./AnalysisView3D.4f71e3f1.js";import{b as Mt,a as Tt,n as xt,g as Q}from"./LineVisualElement.9378dd44.js";import{z as Rt}from"./RightAngleQuadVisualElement.20cf1125.js";const jt=Ne.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController"),Gt=1e5;let V=class extends pe{constructor(e){super(e),this._unitNormalizer=new zt,this._handles=new me,this._tempStartPosition=w(),this._tempEndPosition=w(),this._tempCornerPosition=w()}initialize(){this._handles.add(ce(this.view,"ready",()=>this._initialize(),!0))}destroy(){this._handles=L(this._handles)}_initialize(){const e=this.view.spatialReference,t=Ie(e),i=t===ke?Qe:t;this._sphericalPCPF=i;const s=fe(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([z(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:n})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(n)},A),z(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:n})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(n)},A),z(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:n})=>{n.result=a},A)])}_applyProjectionAndElevationAlignment(e){if(m(e))return e;const t=Mt(e,this.view.spatialReference,this.view.elevationProvider);return m(t)?(Tt(this.analysis,e.spatialReference,jt),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if(m(e)||m(t))return null;const s=this._euclideanDistances(e,t),a=this._geodesicDistance(e,t,s.horizontal.value),n=i===$.Geodesic||i===$.Auto&&s.horizontal.value>Gt?"geodesic":"euclidean";return{mode:n,distance:n==="euclidean"?s.direct:a,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:a}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,a=this._tempEndPosition,n=this._tempCornerPosition,c=this.view.spatialReference,d=this._sphericalPCPF,l=fe(c,d)?d:c;K(e,s,l),K(t,a,l),K(i,n,l);const h=ue(s,a),u=ue(n,a),v=Math.abs(t.z-e.z),y=N=>this._unitNormalizer.normalizeDistance(N),f=y(h),M=y(u),G=y(v);return{direct:F(f,"meters"),horizontal:F(M,"meters"),vertical:F(G,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,a=new Ue({spatialReference:s});a.addPath([e,t]);const n=s.isGeographic&&We(s)?He([a],"meters")[0]:s.isWebMercator?qe(a,"meters"):null,c=j(n)?n:this._fallbackGeodesicDistance(e,t,i);return F(c,"meters")}_fallbackGeodesicDistance(e,t,i){if(Le(e,Ce)&&Le(t,Ee)){const s={distance:0};return Fe(s,Ce,Ee),s.distance}return i}};r([o()],V.prototype,"view",void 0),r([o()],V.prototype,"analysis",void 0),r([o()],V.prototype,"viewData",void 0),r([o()],V.prototype,"_computedResult",null),V=r([ge("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],V);const Ce=w(),Ee=w();var _,E;(function(e){e[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic"})(_||(_={})),function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(E||(E={}));function Nt(){const e=new Be;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.NORMAL,"vec3"),e.attributes.add(S.UV0,"vec2"),e.attributes.add(S.AUXPOS1,"float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(ee`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(ee`
    const float INV_SQRT2 = ${ee.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}const It=Object.freeze({__proto__:null,build:Nt});class Z extends Ze{constructor(t,i,s){super(t,i,s)}initializeProgram(t){const i=Z.shader.get().build();return new Je(t.rctx,i,Ke)}bindPass(t,i){et(this.program,i.camera.projectionMatrix),this.program.setUniform1f("width",t.width),this.program.setUniform1f("outlineSize",t.outlineSize),this.program.setUniform4fv("outlineColor",t.outlineColor),this.program.setUniform1f("stripeLength",t.stripeLength),this.program.setUniform4fv("stripeEvenColor",t.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",t.stripeOddColor)}bindDraw(t){tt(this.program,t),this.program.rebindTextures()}_setPipelineState(t){const i=t===Y.NONE,s=this.configuration;return it({blending:s.transparent?i?st:at(t):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:nt.LESS},depthWrite:rt,colorWrite:ot})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return lt.TRIANGLE_STRIP}}Z.shader=new Ye(It,()=>import("./MeasurementArrow.glsl.92eb3fd5.js"));class B extends Xe{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=Y.NONE}}r([te()],B.prototype,"polygonOffsetEnabled",void 0),r([te()],B.prototype,"transparent",void 0),r([te({count:Y.COUNT})],B.prototype,"transparencyPassType",void 0);class Ut extends ht{constructor(t){super(t,Ht),this.techniqueConfig=new B}getTechniqueConfig(t,i){var s;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=(s=i==null?void 0:i.transparencyPassType)!=null?s:Y.NONE,this.techniqueConfig}dispose(){}getPassParameters(){return this.parameters}intersect(){}requiresSlot(t){return t===ct.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===ut.Color?new Wt(t):null}createBufferWriter(){return new Yt}}class Wt extends gt{updateParameters(t){return this.ensureTechnique(Z,t)}beginSlot(t){return this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const Ht=b({width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},pt),qt=dt().vec3f(S.POSITION).vec3f(S.NORMAL).vec2f(S.UV0).f32(S.AUXPOS1),Ft=w(),kt=w(),Qt=w(),Bt=w(),Xt=w();class Yt{constructor(){this.vertexBufferLayout=qt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 2*(t.indices.get(S.POSITION).length/2+1)}write(t,i,s,a){const n=i.vertexAttributes.get(S.POSITION).data,c=i.vertexAttributes.get(S.NORMAL).data,d=n.length/3,l=i&&i.indices&&i.indices.get(S.POSITION);l&&l.length!==2*(d-1)&&console.warn("MeasurementArrowMaterial does not support indices");const h=Ft,u=kt,v=Qt,y=Bt,f=Xt,M=t.transformation,G=t.invTranspTransformation,N=s.position,ye=s.normal,I=s.uv0;let U=0;for(let O=0;O<d;++O){const J=3*O;if(ie(h,n[J],n[J+1],n[J+2]),O<d-1){const D=3*(O+1);ie(u,n[D],n[D+1],n[D+2]),ie(f,c[D],c[D+1],c[D+2]),se(f,f),Ve(v,u,h),se(v,v),mt(y,f,v),se(y,y)}const Me=ue(h,u);M&&G&&(ae(h,h,M),ae(u,u,M),ae(y,y,G));const T=a+2*O,W=T+1;N.setVec(T,h),N.setVec(W,h),ye.setVec(T,y),ye.setVec(W,y),I.set(T,0,U),I.set(T,1,-1),I.set(W,0,U),I.set(W,1,1),O<d-1&&(U+=Me)}const $e=s.auxpos1;for(let O=0;O<2*d;++O)$e.set(a+O,U)}}class Zt extends xt{constructor(t){super(t),this._parameters=Jt,this._handles=null,this._origin=w(),this._originTransform=_t(),this._arrowCenter=w(),this._renderOccluded=R.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const i=this.opacity,{arrowStripeEvenColor:s,arrowStripeOddColor:a}=this._parameters,n=H(ze,this._stripesEnabled?s:a,i);this._arrowMaterial.setParameters({stripeEvenColor:n})}}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,a=this._stripesEnabled?t:i;this._arrowMaterial=new Ut({outlineColor:s,stripeEvenColor:a,stripeOddColor:i,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new me,this._handles.add(this.view.state.watch("camera",()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(t){t(this._arrowMaterial)}createGeometries(t){if(m(this._geometry)||m(this._geometry.startRenderSpace)||m(this._geometry.endRenderSpace))return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.addGeometry(i,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(t,i,s,a){const n=this.view.renderCoordsHelper,c=[],d=[],l=(h,u)=>{const v=q.get();Ve(v,h,s),c.push(v),d.push(u)};if(a.type==="euclidean"){a.eval(.5,this._arrowCenter);const h=q.get();n.worldUpAtPosition(this._arrowCenter,h),l(t,h),l(i,h)}else{a.eval(.5,this._arrowCenter);const h=this._parameters.arrowSubdivisions+1&-2;for(let u=0;u<h;++u){const v=u/(h-1),y=q.get(),f=q.get();a.eval(v,y),n.worldUpAtPosition(y,f),l(y,f)}}return vt.createPolylineGeometry(c,d)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&j(this._geometry)){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*t})}}_updateArrowOpacity(){const t=this.opacity,{arrowStripeEvenColor:i,arrowStripeOddColor:s,arrowOutlineColor:a}=this._parameters,n=H(ze,this._stripesEnabled?i:s,t),c=H(Kt,a,t),d=H(ei,s,t);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:c,stripeOddColor:d})}}const Jt={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},ze=_e(),Kt=_e(),ei=_e();var C;(function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"})(C||(C={}));let p=class extends pe{constructor(e){super(e),this._params=b({},ii),this._handles=new me,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=w(),this._endPosition=w(),this._cornerPosition=w(),this._startPositionAtSeaLevel=w(),this._endPositionAtSeaLevel=w(),this._state=C.Pending,this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=E.Auto,this.triangleCollapseRatioThreshold=.03}get ready(){return this._state===C.Ready}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if(m(e)||m(t)||e.equals(t))return _.None;const i=this.analysisView.result;if(m(i))return _.Direct;if(i.mode==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?_.ProjectedGeodesic:_.Direct;const{verticalDistance:s,horizontalDistance:a}=i,n=s.value,c=a.value;return Math.min(n/c,c/n)<this.triangleCollapseRatioThreshold?_.Direct:_.Triangle}get actualVisualizedMeasurement(){if(m(this.analysisView.result))switch(this.analysisView.measurementMode){case $.Auto:case $.Euclidean:default:return"euclidean";case $.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return m(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){m(this._triangleOrientationOverride)!==e&&(m(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e=this.actualVisualizedMeasurement==="geodesic";return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){var e;return{labels:this.labels,stripeLength:(e=this._segmentVisualElement)==null?void 0:e.stripeLength}}initialize(){this._handles.add(ce(this.view,"ready",()=>this._initialize(),!0))}_initialize(){switch(this._state){case C.Ready:throw new Error("invalid state");case C.Destroyed:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new Zt(P(b({},t),{geometry:null,renderOccluded:R.OccludeAndTransparent})),this._triangleVisualElement=new Q(P(b({},t),{width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:R.OccludeAndTransparent})),this._rightAngleQuad=new Rt(P(b({},t),{color:X,renderOccluded:R.OccludeAndTransparent}));const i=P(b({},t),{polygonOffset:!0,renderOccluded:R.OccludeAndTransparent});this._projectedGeodesicLine=new Q(P(b({},i),{width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._geodesicStartHint=new Q(P(b({},i),{width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._geodesicEndHint=new Q(P(b({},i),{width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._segmentLabel=new re(P(b({},t),{fontSize:e.direcLabelFontSize})),this._verticalLabel=new re(P(b({},t),{fontSize:e.verticalLabelFontSize})),this._horizontalLabel=new re(P(b({},t),{fontSize:e.horizontalLabelFontSize})),this._handles.add([z(()=>{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:a}=this.analysisView,n=this.view;return{view:n,camera:n.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},s=>this._updateGeometryAndViewMode(s),A),z(()=>({visible:this.visible,viewMode:this.viewMode}),s=>this._updateVisualElementVisibility(s),A),z(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),s=>this._updateLabelText(s),A),z(()=>({visible:this.visible,viewMode:this.viewMode,state:this._state}),s=>this._updateLabelVisibility(s),A),z(()=>this._measurementArrowStripeLength,s=>this._updateSegmentStripeLength(s),A),wt(async()=>this._updateMessageBundle())]),this._state=C.Ready,this._updateMessageBundle()}destroy(){this._state!==C.Destroyed&&(this._handles=L(this._handles),this._segmentVisualElement=L(this._segmentVisualElement),this._triangleVisualElement=L(this._triangleVisualElement),this._rightAngleQuad=L(this._rightAngleQuad),this._projectedGeodesicLine=L(this._projectedGeodesicLine),this._geodesicStartHint=L(this._geodesicStartHint),this._geodesicEndHint=L(this._geodesicEndHint),this._segmentLabel=L(this._segmentLabel),this._verticalLabel=L(this._verticalLabel),this._horizontalLabel=L(this._horizontalLabel),this.set("view",null),this._state=C.Destroyed)}async whenReady(){await ce(this,"ready")}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case _.None:break;case _.Direct:this._segmentVisualElement.visible=!0;break;case _.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case _.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:n,visualizedMeasurement:c,stripeLength:d}){const l=e.renderCoordsHelper;if(m(s)||m(a)||s.equals(a))return;let h=this._startPosition,u=this._endPosition;l.toRenderCoords(s,h),l.toRenderCoords(a,u);const v=n===E.AboveSegment?1:-1,y=v*(l.getAltitude(u)-l.getAltitude(h));y<0&&(h=this._endPosition,u=this._startPosition);const f=c==="geodesic"?new Se(this._startPosition,this._endPosition,l.spatialReference):new x(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=f,this._updateSegmentStripeLength(d),i){case _.Direct:this._updateSegment(f,n);break;case _.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:f,orientation:n,startPosition:h,endPosition:u,deltaSign:v,altitudeDelta:y});break;case _.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:n,startPosition:h,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===E.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:a,endPosition:n,deltaSign:c,altitudeDelta:d}){const l=this._cornerPosition;e.worldUpAtPosition(a,l),bt(l,l,c*Math.abs(d)),ft(l,l,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:a,center:l,next:n};const h=new x(a,l),u=new x(l,n),v=ti(a,n,l,s,t);this._segmentLabel.anchor=v.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=v.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=v.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const a=new Se(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new x(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new x(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=t===E.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){j(e)?(this._segmentLabel.text=t==="euclidean"?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({state:e,visible:t,viewMode:i}){if(e!==C.Ready)return;const s=this._segmentLabel,a=this._horizontalLabel,n=this._verticalLabel;if(s.visible=!1,a.visible=!1,n.visible=!1,t)switch(i){case _.Direct:s.visible=!0;break;case _.Triangle:s.visible=!0,a.visible=!0,n.visible=!0;break;case _.ProjectedGeodesic:s.visible=!0;case _.None:}}get _labelsText(){if(this._state!==C.Ready)return null;const e=this.messages,t=this.analysisView.result;if(m(t)||m(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:a,geodesicDistance:n}=t,c=this.analysisView.unit,d=l=>b({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},l);switch(c){case"metric":return d({euclideanDistance:i&&le(e,i),geodesicDistance:n&&le(e,n),horizontalDistance:s&&le(e,s),verticalDistance:a&&Vt(e,a)});case"imperial":return d({euclideanDistance:i&&oe(e,i),geodesicDistance:n&&oe(e,n),horizontalDistance:s&&oe(e,s),verticalDistance:a&&At(e,a)});default:return d({euclideanDistance:i&&k(e,i,c),geodesicDistance:n&&k(e,n,c),horizontalDistance:s&&k(e,s,c),verticalDistance:a&&k(e,a,c)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;j(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(j(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===E.Auto?this.view.state.camera.aboveGround?E.AboveSegment:E.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(t==null||!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,a=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if(m(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&de(s,"meters");break;case"imperial":i=s&&de(s,Lt(s.value,s.unit));break;default:i=s&&de(s,t)}return m(i)?null:Pt(i.value/30)*St(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,Ot("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}};function ti(e,t,i,s,a){const n=si,c=ai;a.projectToRenderScreen(i,n),a.projectToRenderScreen(t,c);const d={segment:"bottom",horizontal:"top",vertical:n[0]<c[0]?"left":"right"};{const l=ni,h=ri;if(he(e,i,l,a),he(e,t,h,a),Pe(l,h)>=Ae){const u=Math.sign(l[1])===Math.sign(h[1]);d.segment=u?Oe(d.vertical):d.vertical}else{const u=oi;he(i,t,u,a),Pe(u,h)>=Ae&&(d.segment=Math.sign(u[0])===Math.sign(h[0])?Oe(d.horizontal):d.horizontal)}}if(s===E.BelowSegment){const l=h=>h==="top"?"bottom":"top";d.segment=l(d.segment),d.horizontal=l(d.horizontal),d.vertical=l(d.vertical)}return d}r([o()],p.prototype,"_state",void 0),r([o()],p.prototype,"_triangleOrientationOverride",void 0),r([o()],p.prototype,"messages",void 0),r([o()],p.prototype,"view",void 0),r([o()],p.prototype,"analysis",void 0),r([o()],p.prototype,"analysisView",void 0),r([o()],p.prototype,"ready",null),r([o()],p.prototype,"loadingMessages",void 0),r([o()],p.prototype,"visible",null),r([o()],p.prototype,"viewMode",null),r([o()],p.prototype,"actualVisualizedMeasurement",null),r([o()],p.prototype,"visualElementOrientation",void 0),r([o()],p.prototype,"triangleCollapseRatioThreshold",void 0),r([o()],p.prototype,"allowVisualElementsOrientationChange",null),r([o()],p.prototype,"labels",null),r([o()],p.prototype,"testData",null),r([o()],p.prototype,"_labelsText",null),r([o()],p.prototype,"_actualVisualElementsOrientation",null),r([o()],p.prototype,"_measurementArrowStripeLength",null),p=r([ge("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],p);const X=yt(1,.5,0,.75),ii={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:X,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:X,guideLineWidth:2,guideLineColor:X,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ae=Math.cos(Ct(12)),si=De(),ai=De(),ni=ve(),ri=ve(),oi=ve();let g=class extends $t(pe){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.result=null,this.measurementMode=$.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new p({view:e,analysis:t,analysisView:this}),this._analysisController=new V({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=L(this._analysisController),this._analysisVisualization=L(this._analysisVisualization)}whenReady(){return this._analysisVisualization.whenReady()}get updating(){var e;return!((e=this._analysisVisualization)==null||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:P(b({},(e=this._analysisVisualization)==null?void 0:e.testData),{visualization:this._analysisVisualization,controller:this._analysisController})}get unit(){return Et(this.analysis.unit,this._defaultUnit)}};r([o()],g.prototype,"updating",null),r([o()],g.prototype,"type",void 0),r([o()],g.prototype,"analysis",void 0),r([o()],g.prototype,"result",void 0),r([o()],g.prototype,"measurementMode",void 0),r([o()],g.prototype,"elevationAlignedStartPoint",void 0),r([o()],g.prototype,"elevationAlignedEndPoint",void 0),r([o({readOnly:!0})],g.prototype,"viewMode",null),r([o({readOnly:!0})],g.prototype,"actualVisualizedMeasurement",null),r([o()],g.prototype,"visualElementOrientation",null),r([o()],g.prototype,"allowVisualElementsOrientationChange",null),r([o()],g.prototype,"triangleCollapseRatioThreshold",null),r([o({readOnly:!0})],g.prototype,"directLabelText",null),r([o({readOnly:!0})],g.prototype,"horizontalLabelText",null),r([o({readOnly:!0})],g.prototype,"verticalLabelText",null),r([o()],g.prototype,"testData",null),r([o()],g.prototype,"_analysisVisualization",void 0),r([o()],g.prototype,"_analysisController",void 0),r([o()],g.prototype,"unit",null),r([o(Dt)],g.prototype,"_defaultUnit",void 0),g=r([ge("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],g);const li=g;var mi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:li});export{mi as D,Nt as r};
