import{a as t,d as a,gH as y,n,bF as d,G as o,gI as V}from"./vendor.f59113c8.js";let r=class extends d{constructor(i){super(i),this.type="group",this.layerViews=new o}initialize(){this.handles.add([this.layerViews.on("change",i=>this._layerViewsChangeHandler(i)),this.layer.watch("visibilityMode",()=>this._visibilityModeHandler(),!0),this.watch("visible",()=>this._visibleHandler(),!0)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]})}set layerViews(i){this._set("layerViews",V(i,this._get("layerViews")))}get updatingProgress(){return this.layerViews.length===0?1:this.layerViews.reduce((i,e)=>i+e.updatingProgress,0)/this.layerViews.length}isUpdating(){return this.layerViews.some(i=>i.updating)}_hasLayerViewVisibleOverrides(){return this.layerViews.some(i=>i._isOverridden("visible"))}_findLayerViewForLayer(i){return i&&this.layerViews.find(e=>e.layer===i)}_firstVisibleOnLayerOrder(){const i=this.layer.layers.find(e=>{const s=this._findLayerViewForLayer(e);return s&&s.visible});return i&&this._findLayerViewForLayer(i)}_enforceExclusiveVisibility(i){this._hasLayerViewVisibleOverrides()&&(i||!(i=this._firstVisibleOnLayerOrder())&&this.layerViews.length>0&&(i=this._findLayerViewForLayer(this.layer.layers.getItemAt(0))),this.layerViews.forEach(e=>{e.visible=e===i}))}_layerViewsChangeHandler(i){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map(l=>l.watch("visible",h=>this._layerViewVisibleHandler(h,l),!0)).toArray(),"grouplayerview:visible");const e=i.added[i.added.length-1];let s=null;e&&e.visible&&(s=e),this._enforceVisibility(s)}_enforceVisibility(i){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":{const e=this.visible;this.layerViews.forEach(s=>{s.visible=e});break}case"exclusive":this._enforceExclusiveVisibility(i)}}_visibilityModeHandler(){this._enforceVisibility()}_layerViewVisibleHandler(i,e){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":i!==this.visible&&(e.visible=this.visible);break;case"exclusive":this._enforceExclusiveVisibility(i&&e)}}_visibleHandler(){var i;this._hasLayerViewVisibleOverrides()&&((i=this.layer)==null?void 0:i.visibilityMode)==="inherited"&&this._enforceVisibility()}};t([a({cast:y})],r.prototype,"layerViews",null),t([a({readOnly:!0})],r.prototype,"updatingProgress",null),t([a()],r.prototype,"view",void 0),r=t([n("esri.views.layers.GroupLayerView")],r);const w=r;export{w as default};
