var we=Object.defineProperty,Ce=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var X=(e,t,i)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,R=(e,t)=>{for(var i in t||(t={}))Se.call(t,i)&&X(e,i,t[i]);if(W)for(var i of W(t))De.call(t,i)&&X(e,i,t[i]);return e},Y=(e,t)=>Ce(e,Re(t));import{g8 as ye,b7 as j,af as Oe,g9 as Ne,ga as Z,bx as K,bM as Ie,r as d,c0 as Pe,bd as J,gb as Me,$ as T,gc as Ve,t as g,aa as B,a as o,d as l,n as V,h as ge,u as _e,ap as Le,ay as $e,aC as Fe,p as w,a$ as Q,z as b,aF as ve,bQ as Ue,aG as Ae,gd as Ge,ge as qe,bf as He,F as k,gf as ze,gg as Qe,gh as ke,gi as je,b6 as Be,gj as We,R as N,W as I,v as Xe,g as L,b as Ye,f as Ze,cK as Ke,c as Je,G as ee,P as D,L as C,aD as et,j as Ee,H as S,U as $,bS as tt,gk as it,gl as st,em as te,c2 as rt,a5 as ie,w as at,x as xe,gm as se,gn as nt,bW as U,go as re,gp as ot,gq as ae,cP as O,gr as lt,gs as ut,gt as ht,a2 as dt,gu as ne,a1 as oe,gv as ct,gw as pt,gx as mt,bO as le,b_ as ft,bN as yt,gy as gt,ai as _t,I as Ft,eV as vt,al as Et,o as xt,D as Tt,aL as P}from"./vendor.f59113c8.js";import{p as bt,A as wt}from"./Graphics3DFeatureProcessor.38590a49.js";import{m as Ct}from"./FeatureStore.31cfcef2.js";import{l as Rt}from"./projectExtentUtils.7c7bec59.js";class St{constructor(t,i){this.highestResolutionVersion=null,this.versions=[],this.ref(t,i)}get isReferenced(){return this.versions.length!==0}get isSingle(){return this.versions.length===1&&this.versions[0].refCount===1}ref(t,i){const s=this.feature;v.oldVersion=s,this.feature&&Object.defineProperty(t,"uid",{value:this.feature.uid,configurable:!0});for(const a of this.versions)if(a.resolution===i){a.refCount++;const n=this.highestResolutionVersion===a&&!ye(t,a.feature);return(n||this.highestResolutionVersion!==a)&&(a.feature=t),v.newVersion=n?t:s,v}const r={feature:t,resolution:i,refCount:1};return this.versions.push(r),!this.highestResolutionVersion||i<this.highestResolutionVersion.resolution?(v.newVersion=t,this.highestResolutionVersion=r):v.newVersion=s,v}unref(t){for(let i=0;i<this.versions.length;i++){const s=this.versions[i];if(s.resolution===t)return s.refCount--,v.oldVersion=this.feature,s.refCount===0&&(this.versions[i]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===s&&(this._recalculateHighestResolutionVersion(),v.oldVersion=s.feature)),v.newVersion=this.feature,v}return null}get feature(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(this.versions.length===0)return void(this.highestResolutionVersion=null);let t=this.versions[0];for(let i=1;i<this.versions.length;i++){const s=this.versions[i];s.resolution<t.resolution&&(t=s)}this.highestResolutionVersion=t}}class Dt{constructor(t){this._feature=t,this.refCount=1}get isReferenced(){return this.refCount!==0}get isSingle(){return this.refCount===1}ref(t){return++this.refCount,v.oldVersion=this._feature,this.feature&&Object.defineProperty(t,"uid",{value:this.feature.uid,configurable:!0}),ye(this._feature,t)||(this._feature=t),v.newVersion=this._feature,v}unref(){return v.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(v.newVersion=null,v):(v.newVersion=this._feature,v)}get feature(){return this._feature}}const v={oldVersion:null,newVersion:null},Ot=16438,ue=new Set;class Nt{constructor(t){this.descriptor=t,this.fetchStatus=m.FETCH_NEEDED,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=A,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=ue,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(t){this._displayingFeatures=t,this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}get features(){return this._features}get featureLimit(){return this._featureLimit}set featureLimit(t){this._featureLimit!==t&&(this._featureLimit=t,this._estimatedUnusedSizeDirty=!0)}get availableFields(){return this._availableFields}setFeatures(t,i,s){this._availableFields=Oe(s,ue),this._features=t,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,t&&t.length>0?(this._emptyFeatureRatio=i/(t.length+i),this._numVertices=t.reduce((r,a)=>r+Ne(a.geometry),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}get emptyFeatureRatio(){return this._emptyFeatureRatio}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(t){this._numFeatures=t}get hasPreciseFeatureCount(){return this._numFeatures>A}get needsFeatureCount(){return this._numFeatures===A}get numVertices(){return this._numVertices}get id(){return this.descriptor.id}get estimatedSize(){return this.updateMemoryEstimates(),this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(let t=0;t<this._features.length;++t){const i=Z(this._features[t]);this._estimatedSize+=i,t>=this.featureLimit&&(this._estimatedUnusedSize+=i)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(let t=this.featureLimit;t<this._features.length;++t)this._estimatedUnusedSize+=Z(this._features[t]);return!0}return!1}get isFetching(){return this.fetchStatus===m.FETCHING||this.fetchStatus===m.REFETCHING}get isRefetching(){return this.fetchStatus===m.REFETCHING}get needsFetching(){return this.fetchStatus===m.FETCH_NEEDED||this.fetchStatus===m.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===m.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===m.DONE||this.fetchStatus===m.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===m.REFETCHING?m.REFETCH_NEEDED:m.FETCH_NEEDED}get needsDisplayUpdate(){return!!this._features&&!Pt(this._features,this.displayingFeatures,this.featureLimit)}intersects(t){return!t||!this.descriptor.extent||(K(t,he),Ie(this.descriptor.extent,he))}intersectionIncludingBorrowed(t,i){const s=d(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return t||s?(t?(K(t,i),Pe(i,s,i)):J(i,s),i):(J(i,Me),i)}_shuffle(t){this._features.sort((i,s)=>T(i,t)-T(s,t)),Ve(this._features,Ot),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}reduceFeatures(t,i,s){if(t<=0)return!1;if(!this._features)return this.featureLimit=0,!1;let r=!1;this.featureLimit=Math.ceil(this.numFeatures*t),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===m.DONE&&this._features.length>0&&(this.fetchStatus=m.REFETCH_NEEDED,r=!0)),!this._shuffled&&t<1&&this._shuffle(s);const a=Math.max(this.featureLimit,Math.ceil(i*this.numFeatures));return this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,this.fetchStatus===m.FULL&&(this.fetchStatus=m.DONE)),r}get cache(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(t){this.requestController=null,this._availableFields=t.availableFields,this._features=t.features,this._numFeatures=t.numFeatures,this._emptyFeatureRatio=t.emptyFeatureRatio,this.fetchStatus=t.fetchStatus,this.featuresMissing=t.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}const A=-1,It=-2;var m;function Pt(e,t,i){if(g(t)||g(e)||i!==t.length||i>e.length)return!1;for(let s=0;s<i;++s)if(e[s]!==t[s])return!1;return!0}(function(e){e[e.FETCH_NEEDED=0]="FETCH_NEEDED",e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED",e[e.FETCHING=2]="FETCHING",e[e.REFETCHING=3]="REFETCHING",e[e.DONE=4]="DONE",e[e.FULL=5]="FULL"})(m||(m={}));const he=j(),G=B.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");let _=class extends ge{constructor(e){super(e),this._useTileCount=!1,this.updating=!1,this.updatingTotal=0,this.updatingRemaining=0,this.expectedFeatureDiff=0,this.maximumNumberOfFeaturesExceeded=!1,this.maximumNumberOfFeaturesExceededThrottle=1e3,this._fullRatio=1,this._farRatio=1,this.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},this.handles=new _e,this._frameTask=Le,this._dirty=!1,this.featureTiles=new Map,this.displayingFeatureReferences=new Map,this.numDisplayingFeatureReferences=0,this.suspended=!0,this.pendingEdits=null}set maximumNumberOfFeatures(e){e=e||1/0;const t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this._maximumFeaturesUpdated(t,e))}set memoryFactor(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this._setDirty())}set lodFactor(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&d(this.context.query.queryFeatureCount)}set useTileCount(e){this._useTileCount=e,this.notifyChange("useTileCount")}get memoryForUnusedFeatures(){let e=0;return this.featureTiles.forEach(t=>e+=t.estimatedUnusedSize),e}get totalVertices(){let e=0;return this.featureTiles.forEach(t=>e+=t.numVertices),e}get totalFeatures(){let e=0;return this.featureTiles.forEach(t=>e+=t.numFeatures),e}set filterExtent(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))return void G.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");const t=this._get("filterExtent");if(t===e||t&&e&&t.equals(e))return;const i=e?e.clone():null;this._set("filterExtent",i),this._reclip(i,t)}initialize(){this.handles.add($e(this,"tileDescriptors","change",()=>this._setDirty(),()=>this._setDirty())),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?St:Dt;const e=this.context.scheduler;d(e)&&(this._frameTask=e.registerTask(Fe.FEATURE_TILE_FETCHER,this)),this._setDirty()}destroy(){this._frameTask.remove(),this.handles=w(this.handles),this.featureTiles.forEach(e=>{this._cancelFetchTile(e),this._removeTile(e)}),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)}get paused(){return this.suspended||!!this.pendingEdits}restart(){this.featureTiles.forEach(e=>{this._cancelFetchTile(e),this._clearTile(e),this._resetFetchTile(e)}),d(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}refetch(){this.featureTiles.forEach(e=>{this._cancelFetchTile(e),this._resetFetchTile(e)}),d(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}suspend(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())}resume(){this.suspended&&(this.suspended=!1,this._unpause())}_pause(){this.paused&&(this.featureTiles.forEach(e=>this._cancelFetchTile(e)),this._updated())}_unpause(){this.paused||(this._setDirty(),this._updated())}get availableFields(){let e=null;return this.featureTiles.forEach(t=>{g(t.displayingFeatures)||t.displayingFeatures.length===0||(g(e)?e=new Set(t.availableFields):e.forEach(i=>{t.availableFields.has(i)||Q(e).delete(i)}))}),d(e)?e:new Set}applyEdits(e){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const t=this.pendingEdits;t.count++;const i=t.edits.then(()=>e.result.catch(s=>{if(b(s))throw s;return null}).then(s=>s&&(this._applyEditsDeleteFeatures(s.deletedFeatures),this._applyEditsAddUpdateFeatures(s.addedFeatures,s.updatedFeatures,t.controller.signal).then(()=>s))).then(s=>(--t.count==0&&(this.pendingEdits===t&&(this.pendingEdits=null),d(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated()),s)));return t.edits=i,this._updated(),i}_applyEditsDeleteFeatures(e){if(e.length===0)return;const t=this.context.globalIdField,i=t&&this.availableFields.has(t),s=new Set,r=this.objectIdField;e.forEach(({objectId:a,globalId:n})=>{if((!a||a<0)&&t){i||G.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected in the view`);const u=this.features.find(c=>c.attributes&&c.attributes[t]===n);u&&s.add(T(u,r))}else s.add(a)}),this.featureTiles.forEach(a=>{if(!a.features)return;const n=a.features.filter(u=>!s.has(T(u,this.objectIdField)));n.length!==a.features.length&&(a.setFeatures(n,0,a.availableFields),this._invalidateCounts())})}async _applyEditsAddUpdateFeatures(e,t,i){const s=[],r=new Set;if(e.forEach(n=>s.push(n.objectId)),t.forEach(n=>{s.push(n.objectId),r.add(n.objectId)}),s.length===0)return;const a=[];this.featureTiles.forEach(n=>{const u=this._applyEditsAddUpdateTile(n,s,r,i);u&&a.push(u)}),await ve(a)}async _applyEditsAddUpdateTile(e,t,i,s){if(!e.features)return;const r=this._createQuery(e);r.resultType=void 0,r.cacheHint=!1,r.objectIds=t;const a=await this._queryFeatures(r,s);let n=null;if(i.size>0){const u=e.features.filter(c=>!i.has(T(c,this.objectIdField)));u.length!==e.features.length&&(n=u)}if(a.features.length>0){n||(n=e.features.slice());for(const u of a.features)n.push(u)}n&&(e.hasPreciseFeatureCount&&(e.numFeatures=Math.max(e.numFeatures,n.length)),e.setFeatures(n,0,de(e.availableFields,a.fields)),this._invalidateCounts())}_queryFeatures(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:Ut})}_setDirty(){this._dirty=!0,this._updated()}get running(){return this.updating}runTask(e){if(this._frameTask.processQueue(e),!this._dirty||!this.constructed)return;this._dirty=!1;const t=this._getListOfTiles();if(this._markTilesNotAlive(t),!e.run(()=>this._addTiles(t,e))||!e.run(()=>this._filterExtentTiles(t,e))||!e.run(()=>this._removeTiles(t,e))||e.done)return void this._setDirty();const i=this._sortTiles(t);e.run(()=>this._displayTiles(i,e))&&e.run(()=>this._fetchTiles(i,e))&&e.run(()=>this._updateMemoryEstimates(i,e))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}_markTilesNotAlive(e){for(const t of e)t.alive=!1}_addTiles(e,t){return!this.suspended&&(this.tileDescriptors.forEach(i=>{const s=this.featureTiles.get(i.id);s?s.alive=!0:t.done||(e.push(this._addTile(i)),t.madeProgress())}),t.hasProgressed)}_filterExtentTiles(e,t){for(const i of e){if(t.done)break;i.alive&&(i.filtered=!i.intersects(this.filterExtent),i.filtered&&(this._clearTile(i),t.madeProgress()))}return t.hasProgressed}_removeTiles(e,t){for(let i=e.length-1;i>=0&&!t.done;i--){const s=e[i];s.alive||(this._removeTile(s),i!==e.length-1&&(e[i]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}_sortTiles(e){return e.sort((t,i)=>t.descriptor.loadPriority-i.descriptor.loadPriority),e}_displayTiles(e,t){const i=this._updateRatio(e),s=r=>{const a=this._fullRatio<1?i(r)*this._farRatio:1;return r.reduceFeatures(a,this.memoryFactor,this.objectIdField)&&this._setDirty(),this._showTile(r)};for(const r of e)if(!t.run(()=>s(r))){this._setDirty();break}return t.hasProgressed}_fetchTiles(e,t){if(this.paused)return!1;let i=!1;for(const s of e){if(!s.needsFetching)continue;const r=d(this.context.memoryCache)?this.context.memoryCache.pop(s.id):null;if(d(r))s.cache=r,this._setDirty(),this._scheduleUpdated(),t.madeProgress();else{if(this._needsNumFeatures(s)){const a=new AbortController,n=this._fetchTileCount(s,a.signal);this._handleRequest(s,n,a,()=>s.numFeatures=It),i=!0,t.madeProgress()}if(t.done)return!0}}if(i)return t.hasProgressed;for(const s of e)if(s.needsFetching){const r=new AbortController,a=this._fetchTile(s,r.signal);if(this._handleRequest(s,a,r,n=>{s.setFeatures([],0,null),this._invalidateCounts(),s.featuresMissing=!1,this.context.logFetchError(G,n)}),t.madeProgress(),t.done)return!0}return t.hasProgressed}_updateMemoryEstimates(e,t){return e.some(i=>!t.run(()=>i.updateMemoryEstimates())&&(this._setDirty(),!0)),t.hasProgressed}_reclip(e,t){if(!this.constructed)return;const i=new Array;this.featureTiles.forEach(s=>{g(s.displayingFeatures)||s.displayingFeatures.length===0||(s.intersectionIncludingBorrowed(t,ce),s.intersectionIncludingBorrowed(e,pe),Ue(ce,pe)||i.push(s))}),this._refreshDisplayingFeatures(i),this._updated()}_refreshDisplayingFeatures(e){const t=new Set,i=this.changes.updates;for(const s of e)if(!g(s.displayingFeatures))for(const r of s.displayingFeatures){const a=T(r,this.objectIdField);if(t.has(a))continue;t.add(a);const{feature:n}=this.displayingFeatureReferences.get(a);i.removes.push(n),i.adds.push(n)}this._applyChanges()}_updated(){let e=0;this.paused||this.featureTiles.forEach(i=>i.isFetching?++e:0);const t=this._dirty||e>0||!!this.pendingEdits;if(this._set("updating",t),t){let i=0,s=0,r=0,a=0,n=0;const u=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(h=>{if(++s,h.isFetching&&h.hasPreciseFeatureCount){const F=this._maximumFeaturesForTile(h)*(1-h.emptyFeatureRatio),x=d(h.displayingFeatures)?h.displayingFeatures.length*u:0;n+=F-x}h.needsFetching?++a:h.numFeatures>0&&(++r,i+=h.numFeatures)}),a+=e;let c=0,f=0;i?(f=i,c=Math.min(a*i/r,i)):(f=s,c=a),n=Math.min(this.maximumNumberOfFeatures-this.features.length,n),this._set("updatingTotal",f),this._set("updatingRemaining",c),this._set("expectedFeatureDiff",n)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const e=Ae(this.featureTiles,t=>t.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",e)}_updateRatio(e){const t=Mt(e),i=a=>1/(1<<Math.max(0,t-a.descriptor.lij[0]));let s=0,r=0;for(const a of e){const n=a.numFeatures;s+=n,r+=n*i(a)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/s),this._farRatio=this.maximumNumberOfFeatures/r,this._scheduleUpdated(),i}_maximumFeaturesUpdated(e,t){e!==t&&(t>e&&this.featureTiles.forEach(i=>{if(!i.featuresMissing)return;const s=this._maximumFeaturesForTile(i);i.features&&(i.features.length>=s||i.fetchStatus===m.FULL)||(this._cancelFetchTile(i),this._resetFetchTile(i))}),this._setDirty())}_addTile(e){const t=new Nt(e);return this.featureTiles.set(t.id,t),this._resetFetchTile(t),this._referenceDisplayingFeaturesFromRelatedTiles(t),t}_referenceDisplayingFeaturesFromRelatedTiles(e){const t=e.descriptor.resolution;this.featureTiles.forEach(i=>{if(!(g(i.displayingFeatures)||e===i||e.descriptor.lij&&i.descriptor.lij&&!Ge(e.descriptor.lij,i.descriptor.lij))){g(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&i.descriptor.extent&&(g(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=qe(e.descriptor.extent)),He(e.extentIncludingBorrowedFeatures,i.descriptor.extent,e.extentIncludingBorrowedFeatures));for(const s of i.displayingFeatures){e.displayingFeatures.push(s);const r=this.displayingFeatureReferences.get(T(s,this.objectIdField));r.ref(r.feature,t),this.numDisplayingFeatureReferences++}}}),e.featureLimit=d(e.displayingFeatures)?e.displayingFeatures.length:0}_removeTile(e){this._clearTile(e),this.featureTiles.delete(e.id)}_resetFetchTile(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=m.DONE):e.fetchStatus=m.FETCH_NEEDED}_cancelFetchTile(e){const t=e.requestController;d(t)&&(e.requestController=null,e.resetFetching(),t.abort())}async _fetchTileCount(e,t){return e.numFeatures=await this._fetchCount(e,t),this._updateRatio(this._getListOfTiles()),e.fetchStatus===m.REFETCHING?m.REFETCH_NEEDED:m.FETCH_NEEDED}async _fetchTile(e,t){const i=this._maximumFeaturesForTile(e);if(i<=0)return Lt(e);const s=this._getMaxRecordCount(e),r=Math.ceil(i/s);if(q(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=i&&r>k.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(e,t);const a=this._createQuery(e);if(a.maxRecordCountFactor=Math.ceil(i/s),e.isRefetching&&e.features&&e.features.length>0){const h=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/s);a.maxRecordCountFactor=Math.max(h+1,a.maxRecordCountFactor)}const{features:n,exceededTransferLimit:u,fields:c}=await this._queryFeatures(a,t),f=u?a.maxRecordCountFactor>=k.MAX_MAX_RECORD_COUNT_FACTOR?m.FULL:m.DONE:m.FULL;return await this._frameTask.schedule(()=>{e.featuresMissing=n.length<e.numFeatures||u;const h=this._removeEmptyFeatures(n);e.setFeatures(n,h,Te(c))},t),this._invalidateCounts(),f}async _fetchCount(e,t){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(e),{signal:t})}async _fetchPagedTile(e,t){let i,s=0,r=0,a=0,n=this._maximumFeaturesForTile(e)-a;const u=this._getMaxRecordCount(e);let c=null;for(;;){const f=this._createQuery(e),h=this._setPagingParameters(f,s,n,u),{features:F,exceededTransferLimit:x,fields:be}=await this._queryFeatures(f,t);if(await this._frameTask.schedule(()=>{h&&(s+=Q(f.num)),a+=F.length,r+=this._removeEmptyFeatures(F),e.featuresMissing=s<e.numFeatures||x,i=i?i.concat(F):F,c=de(c,be),e.setFeatures(i,r,c)},t),this._invalidateCounts(),this._setDirty(),n=this._maximumFeaturesForTile(e)-a,!h||!x||n<=0)return x?m.DONE:m.FULL}}_createFeatureCountQuery(e){const t=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}_createQuery(e){const t=this.context.createQuery(),i=e.descriptor.extent;if(i){const s=this.context.tilingScheme.spatialReference;t.geometry=ze(i,s)}return this._setResolutionParams(t,e),this._useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}_setPagingParameters(e,t,i,s){return!!this.context.capabilities.supportsPagination&&(e.start=t,i>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(i/s),e.num=Math.min(e.maxRecordCountFactor*s,i)):e.num=Math.min(s),!0)}_getEffectiveTileResolution(e){if(e.descriptor.resolution==null)return null;const t=this.context.viewingMode===Qe.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}get supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&this.context.geometryType!=="point"}_setResolutionParams(e,t){if(!this.supportsResolution)return;const i=this._getEffectiveTileResolution(t);i!=null&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new ke({mode:"view",originPosition:"upper-left",tolerance:i,extent:this.context.fullExtent}):this.context.geometryType==="polyline"&&(e.maxAllowableOffset=i))}_removeEmptyFeatures(e){const t=e.length;for(let i=0;i<e.length;){const s=e[i];je(s.geometry)?++i:(e[i]=e[e.length-1],--e.length)}return t-e.length}_needsNumFeatures(e){return this.useTileCount&&e.needsFeatureCount&&!q(e)}_getMaxRecordCount(e){const{tileMaxRecordCount:t,maxRecordCount:i}=this.context;return this._useTileQuery(e)&&d(t)&&t>0&&this.context.capabilities.supportsResultType?t:d(i)&&i>0?i:$t}_useTileQuery(e){return(!q(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}_handleRequest(e,t,i,s){e.fetchStatus=e.needsRefetching?m.REFETCHING:m.FETCHING,e.requestController=i;let r=!1;t.then(a=>{e.requestController=null,e.fetchStatus=a}).catch(a=>{e.requestController===i&&(e.requestController=null,e.fetchStatus=m.DONE),b(a)?r=!0:s(a)}).then(()=>{r||this._setDirty(),this._scheduleUpdated()})}_scheduleUpdated(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(Be(()=>{this.handles.remove("scheduleUpdated"),this._updated()}),"scheduleUpdated")}_showTile(e){if(d(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;const t=e.features;if(e.featureLimit===0||!t){const n=d(e.displayingFeatures)&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],n}const i=e.descriptor.resolution,s=this.changes.updates,r=this.changes.adds,a=Math.min(e.featureLimit,t.length);e.featureLimit=a;for(let n=0;n<a;++n){const u=t[n],c=T(u,this.objectIdField),f=this.displayingFeatureReferences.get(c);if(f){const h=f.ref(u,i);h.oldVersion!==h.newVersion&&(s.removes.push(h.oldVersion),s.adds.push(h.newVersion))}else this.displayingFeatureReferences.set(c,new this.FeatureReferenceClass(u,i)),r.push(u);this.numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=t.slice(0,a),!0}_hideTile(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}_hideTileFeatures(e){if(g(e.displayingFeatures))return;const t=this.changes.updates,i=this.changes.removes;for(const s of e.displayingFeatures){const r=T(s,this.objectIdField),a=this.displayingFeatureReferences.get(r);if(!a)continue;const n=a.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,n?n.oldVersion!==n.newVersion&&(n.newVersion==null?(this.displayingFeatureReferences.delete(r),i.push(n.oldVersion)):(t.adds.push(n.newVersion),t.removes.push(n.oldVersion))):console.error("Hiding unreferenced feature")}this._applyChanges(),e.displayingFeatures=null}_applyChanges(){const e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);const t=this.changes.adds,i=this.changes.removes,s=Math.min(t.length,i.length);let r=0;for(;r<s;){const a=Math.min(r+At,s);this.features.addMany(t.slice(r,a)),this.features.removeMany(i.slice(r,a)),r=a}t.length>s&&this.features.addMany(r===0?t:t.slice(r)),i.length>s&&this.features.removeMany(r===0?i:i.slice(r)),t.length=0,i.length=0}_clearTile(e){if(this._hideTile(e),e.features&&d(this.context.memoryCache)){const t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this.featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((e,t)=>e+(t.features?t.features.length:0),0)}_maximumFeaturesForTile(e){const t=e.hasPreciseFeatureCount?e.numFeatures:1/0,i=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,s=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(i*s/(1-e.emptyFeatureRatio)),t)}get test(){return{process:e=>this.runTask(e),getFeatureTileById:e=>this.featureTiles.get(e),forEachFeatureTile:e=>this.featureTiles.forEach(e)}}};function q(e){return e.id==="dummy-tile-full-extent"}function Mt(e){let t=0;for(const i of e)i.features&&i.features.length>0&&i.alive&&(t=Math.max(t,i.descriptor.lij[0]));return t}function Zt(e){const t=e.capabilities.query;return{supportsMultipleResolutions:Vt(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function Vt(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function Lt(e){return e.setFeatures([],0,null),e.featuresMissing=!1,m.DONE}function Te(e){return g(e)?new Set:new Set(e.map(t=>t.name))}function de(e,t){if(g(e)||g(t))return Te(t);const i=new Set;for(const{name:s}of t)e.has(s)&&i.add(s);return i}o([l({constructOnly:!0})],_.prototype,"features",void 0),o([l()],_.prototype,"tileDescriptors",void 0),o([l({value:1/0})],_.prototype,"maximumNumberOfFeatures",null),o([l({value:1})],_.prototype,"memoryFactor",null),o([l({value:1})],_.prototype,"lodFactor",null),o([l()],_.prototype,"useTileCount",null),o([l({readOnly:!0})],_.prototype,"updating",void 0),o([l({readOnly:!0})],_.prototype,"updatingTotal",void 0),o([l({readOnly:!0})],_.prototype,"updatingRemaining",void 0),o([l({readOnly:!0})],_.prototype,"expectedFeatureDiff",void 0),o([l({readOnly:!0})],_.prototype,"memoryForUnusedFeatures",null),o([l({readOnly:!0})],_.prototype,"maximumNumberOfFeaturesExceeded",void 0),o([l({constructOnly:!0})],_.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),o([l({readOnly:!0})],_.prototype,"totalVertices",null),o([l({readOnly:!0})],_.prototype,"totalFeatures",null),o([l()],_.prototype,"filterExtent",null),o([l({constructOnly:!0})],_.prototype,"context",void 0),_=o([V("esri.views.3d.layers.support.FeatureTileFetcher3D")],_);const $t=2e3,ce=j(),pe=j(),Ut=6e5,At=200,Gt=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class qt{constructor(t,i,s){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=t,this.view=s,this.tilingScheme=new We(i),this.loadedSymbols=Gt.map(r=>new N(new I({material:{color:[r[0],r[1],r[2],.6]},outline:{color:"black",size:1}}))),this.loadingSymbols=[new N(new I({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new N(new I({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new N(new I({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.update()}update(){this._enabled?(this._synchronizeMaps(this.loadingGraphics,{filter:t=>t.isFetching,symbols:this.loadingSymbols}),this._synchronizeMaps(this.loadedGraphics,{filter:t=>!t.isFetching,symbols:this.loadedSymbols}),this._synchronizeMaps(this.pendingGraphics,{filter:t=>!t.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(t=>{this.view.graphics.removeMany(t)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(t=>{this.view.graphics.removeMany(t)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(t=>{this.view.graphics.removeMany(t)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))}showDataExtent(t){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),!t)return;const i=Xe.fromExtent(t);this.dataExtentGraphic=new L({geometry:i,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}_synchronizeMaps(t,i){const s=[];t.forEach((r,a)=>{const n=this.tileFetcher.test.getFeatureTileById(a);n&&i.filter(n)||(this.view.graphics.removeMany(r),s.push(a))}),s.forEach(r=>t.delete(r)),this.tileFetcher.test.forEachFeatureTile(r=>{if(i.filter(r)&&!t.has(r.id)){const[a,n,u]=r.descriptor.lij;this.tilingScheme.ensureMaxLod(a);const c=this.tilingScheme.getExtentGeometry(a,n,u),f=[new L({geometry:c,symbol:i.symbols[a%i.symbols.length]}),new L({geometry:c.center,symbol:new Ye({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new Ze({text:`${a}/${n}/${u}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];t.set(r.id,f),this.view.graphics.addMany(f)}})}}const H=B.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");let y=class extends Ke(ge){constructor(e){super(e),this.type="feature-tile-3d",this.watchUpdatingTracking=new Je,this.serviceDataExtent=null,this.serviceDataCount=E.NO_SERVICE_DATA_COUNT,this.vertexLimitExceeded=!1,this.displayFeatureLimit=null,this.suspended=!1,this.tileFetcher=null,this.handles=new _e,this.fetchDataInfoPromise=null,this.fetchDataInfoAbortController=null,this.lifeCycleAbortController=new AbortController}set extent(e){if(e&&!e.spatialReference.equals(this.layerView.view.spatialReference))return void H.error("#extent=","extent needs to be in the same spatial reference as the view");const t=this._get("extent");if(t===e||t&&e&&t.equals(e))return;const i=e?e.clone():null;this._set("extent",i)}get updating(){return!!(d(this.tileFetcher)&&this.tileFetcher.updating||this.fetchDataInfoPromise!=null||this.mode==="tiles"&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}get updatingTotal(){return this.updating&&d(this.tileFetcher)?this.tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&d(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&d(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return d(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(!d(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return d(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0}set maximumNumberOfFeatures(e){e!==this.maximumNumberOfFeatures&&(e==null?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get mode(){var e,t;const i=this.layerView.layer;if(i.type==="feature"&&d(i.infoFor3D))return"snapshot";if(((e=this.layerView.view.qualitySettings)==null||(t=e.graphics3D)==null?void 0:t.snapshotAvailable)===!1||this.serviceDataCount===E.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";const s=this.layerView.view,r=s&&s.featureTiles,a=r&&r.tilingScheme;if(i&&i.minScale&&this.serviceDataExtent&&a){const n=this._approximateExtentSizeAtScale(i.minScale,a);if((this.serviceDataExtent.width/n+this.serviceDataExtent.height/n)/2>E.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const e=this._get("maxTotalSnapshotVertices")||0,t=this.mode==="snapshot"&&d(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(e,t)}_approximateExtentSizeAtScale(e,t){const i=this.layerView.view,s=Math.ceil((i.width/t.pixelSize+i.height/t.pixelSize)/2),r=t.levels[0];return s*((r.tileSize[0]/(r.scale/e)+r.tileSize[1]/(r.scale/e))/2)}get tileDescriptors(){return this.mode==="snapshot"?new ee([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new ee}get test(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}initialize(){this.watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal))),this.watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),D),this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){const e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery")&&e.type!=="ogc-feature")throw new C("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})}destroy(){this._cancelFetchServiceDataInfo(),this.tileFetcher=w(this.tileFetcher),this.handles=w(this.handles),this.tilesHandle=et(this.tilesHandle),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)}suspend(){this.suspended||(this.suspended=!0,d(this.tileFetcher)&&this.tileFetcher.suspend())}resume(){this.suspended&&(this.suspended=!1,d(this.tileFetcher)&&this.tileFetcher.resume())}restart(){const e=()=>{d(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(e,e))}refetch(){const e=()=>{d(this.tileFetcher)&&this.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(e,e))}_initializeTileFetcher(){const e=this.layerView.view;if(!e)return;const t=Ee(()=>{var i;return(i=e.featureTiles)==null?void 0:i.tilingScheme},this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(t),t.then(()=>{const{layerView:i,tileDescriptors:s}=this,r=i.layer,a=new _({context:this.context,filterExtent:this.extent,tileDescriptors:s,features:this.graphics});this.tileFetcher=a,this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();const n=this.layerView.view.resourceController;n&&(this.handles.add(n.memoryController.events.on("quality-changed",h=>{a.memoryFactor=h})),this.tileFetcher.memoryFactor=n.memoryController.memoryFactor);const u=this.context.geometryType==="polygon"?"polygonLodFactor":this.context.geometryType==="polyline"?"polylineLodFactor":null;u&&this.handles.add(S(()=>{var h,F,x;return(h=this.layerView.view)==null||(F=h.qualitySettings)==null||(x=F.graphics3D)==null?void 0:x[u]},h=>a.lodFactor=h||1,D));const c=h=>{a.maximumNumberOfFeatures=h,a.useTileCount=this.serviceDataCount>h},f=h=>a.useTileCount=h>this.maximumNumberOfFeatures;r.type!=="ogc-feature"&&this.watchUpdatingTracking.add(()=>r.createQueryVersion,()=>this._dataFilterChanged()),this.watchUpdatingTracking.add(()=>i.availableFields,(h,F)=>this._availableFieldsChanged(F,h)),this.watchUpdatingTracking.add(()=>i.requiredFields,(h,F)=>this._requiredFieldsChanged(F,h)),this.handles.add([r.on("apply-edits",h=>this._applyEdits(h)),this.watch("extent",h=>a.filterExtent=h,!0),this.watch("tileDescriptors",h=>a.tileDescriptors=h,!0),S(()=>this.maximumNumberOfFeatures,c,$),S(()=>this.serviceDataCount,f,$),S(()=>tt.FEATURE_TILE_FETCH_SHOW_TILES,h=>{h&&a&&!a.debugger?(a.debugger=new qt(a,e.featureTiles.tilingScheme.toTileInfo(),e),a.debugger.update()):!h&&this.tileFetcher&&a.debugger&&(a.debugger.destroy(),a.debugger=null)},$)]),this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}_modeChanged(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:H.warn("Unhandled feature layer mode "+this.mode);case"snapshot":d(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()}_applyEdits(e){g(this.tileFetcher)||this.tileFetcher.applyEdits(e).then(t=>{t&&(t.deletedFeatures.length||t.updatedFeatures.length||t.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(t=>{if(!b(t))throw t})}_availableFieldsChanged(e,t){d(this.tileFetcher)&&me(this.tileFetcher.availableFields,t)&&this.refetch()}_requiredFieldsChanged(e,t){d(this.tileFetcher)&&me(this.tileFetcher.availableFields,t)&&this.restart()}_createVertexLimitExceededQuery(e){const t=this.layerView.layer,i=t.createQuery();return i.outStatistics=[new it({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(i.cacheHint=!0),i}_createDataInfoQuery(){const e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_fullExtentIsAccurate(){const e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return st(e.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}async _updateServiceDataExtent(e){try{await this._tryUpdateServiceDataExtent(e)}catch(t){b(t)||this._set("serviceDataExtent",te(this.layerView.fullExtentInLocalViewSpatialReference))}}async _tryUpdateServiceDataExtent(e){const t=this.layerView,i=t.layer,s=i.capabilities.query.supportsExtent,r=te(t.fullExtentInLocalViewSpatialReference),a=i.fullExtent,n=this._fullExtentIsAccurate(),u=this.serviceDataCount;if(s&&u<=E.MAX_FEATURE_COUNT_FOR_EXTENT&&(!r||!n)&&"queryExtent"in i){const c=this._createDataInfoQuery(),f=await i.queryExtent(c,{timeout:E.QUERY_EXTENT_TIMEOUT,signal:e});this._set("serviceDataExtent",f.extent)}else if(r)this._set("serviceDataExtent",r);else if(d(a)){const c="portalItem"in i?i.portalItem:null,f=await rt(a,t.view.spatialReference,c,e);this._set("serviceDataExtent",f)}else this._set("serviceDataExtent",null)}async _updateServiceDataCount(e){const t=this.layerView.layer;if(!("queryFeatureCount"in t))return void this._set("serviceDataCount",E.NO_SERVICE_DATA_COUNT);const i=await ie(t.queryFeatureCount(this._createDataInfoQuery(),{timeout:E.QUERY_STATISTICS_TIMEOUT,signal:e}));if(i.ok===!0)this._set("serviceDataCount",i.value);else{if(b(i.error))throw i.error;this._set("serviceDataCount",E.NO_SERVICE_DATA_COUNT)}}get vertexLimitInfo(){if(g(this.displayFeatureLimit)||g(this.displayFeatureLimit.averageSymbolComplexity))return null;const{averageSymbolComplexity:e,maximumTotalNumberOfPrimitives:t}=this.displayFeatureLimit,{primitivesPerCoordinate:i,primitivesPerFeature:s}=e,r=this._get("vertexLimitInfo");return g(r)||r.maximumTotalNumberOfPrimitives!==t||r.primitivesPerCoordinate!==i||r.primitivesPerFeature!==s?{primitivesPerCoordinate:i,primitivesPerFeature:s,maximumTotalNumberOfPrimitives:t}:r}get supportsExceedsLimitQuery(){const e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics}get minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}async _updateVertexLimitExceeded(e,t){const i=this.vertexLimitInfo;if(g(i))return void this._set("vertexLimitExceeded",!1);const s=i.primitivesPerFeature<=0,r=this.minimumNumberOfVerticesForGeometry>1;if(!s&&!r)return void this._set("vertexLimitExceeded",!1);const{primitivesPerFeature:a,primitivesPerCoordinate:n,maximumTotalNumberOfPrimitives:u}=i;let c;a!==0&&d(e)&&await e;const f=this.serviceDataCount,h=f!==E.NO_SERVICE_DATA_COUNT;if(c=Math.ceil(h?(u-f*a)/(n||1):u/(n||1)),r&&(c=Math.min(c,kt)),h&&this.minimumNumberOfVerticesForGeometry*f>c)return void this._set("vertexLimitExceeded",!0);if(!this.supportsExceedsLimitQuery)return void this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>c);const F=await ie(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(c),{timeout:E.QUERY_STATISTICS_TIMEOUT,signal:t}));if(F.ok===!1){if(b(F.error))throw F.error;return void this._set("vertexLimitExceeded",!1)}const x=F.value.features[0];x&&x.attributes?this._set("vertexLimitExceeded",!!x.attributes.exceedslimit):this._set("vertexLimitExceeded",!1)}async _fetchServiceDataInfo(){this._cancelFetchServiceDataInfo();let e=new AbortController;const t=e.signal,i=this._updateServiceDataCount(t),s=ve([i,this._updateVertexLimitExceeded(i,t)]),r=s.then(()=>this._updateServiceDataExtent(t)).catch(a=>{b(a)||H.error("#fetchServiceDataInfo()",a)}).then(()=>{r===this.fetchDataInfoPromise&&(this.fetchDataInfoPromise=null,this.fetchDataInfoAbortController=null),e=null});return e&&(this.fetchDataInfoPromise=r),this.fetchDataInfoAbortController=e,s.then(()=>{},()=>{})}_cancelFetchServiceDataInfo(){const e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())}get debug(){return{storedFeatures:d(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:d(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:d(this.tileFetcher)?this.tileFetcher.totalVertices:0}}};o([l({readOnly:!0})],y.prototype,"type",void 0),o([l({constructOnly:!0})],y.prototype,"graphics",void 0),o([l({constructOnly:!0})],y.prototype,"layerView",void 0),o([l({constructOnly:!0})],y.prototype,"context",void 0),o([l()],y.prototype,"extent",null),o([l()],y.prototype,"updating",null),o([l({readOnly:!0})],y.prototype,"watchUpdatingTracking",void 0),o([l()],y.prototype,"updatingTotal",null),o([l()],y.prototype,"updatingRemaining",null),o([l()],y.prototype,"expectedFeatureDiff",null),o([l()],y.prototype,"memoryForUnusedFeatures",null),o([l()],y.prototype,"maximumNumberOfFeaturesExceeded",null),o([l({readOnly:!0})],y.prototype,"serviceDataExtent",void 0),o([l({readOnly:!0})],y.prototype,"serviceDataCount",void 0),o([l({readOnly:!0})],y.prototype,"vertexLimitExceeded",void 0),o([l()],y.prototype,"displayFeatureLimit",void 0),o([l({type:Number})],y.prototype,"maximumNumberOfFeatures",null),o([l({readOnly:!0})],y.prototype,"mode",null),o([l({readOnly:!0})],y.prototype,"maxTotalSnapshotVertices",null),o([l({readOnly:!0,dependsOn:["mode"]})],y.prototype,"tileDescriptors",null),o([l()],y.prototype,"tileFetcher",void 0),o([l()],y.prototype,"fetchDataInfoPromise",void 0),o([l({readOnly:!0})],y.prototype,"vertexLimitInfo",null),y=o([V("esri.layers.graphics.controllers.FeatureTileController3D")],y);const Ht=1e4,zt=12e3,Qt=1e4,kt=5e6;function me(e,t){if(!t)return!1;for(const i of t)if(!e.has(i))return!0;return!1}var E;(function(e){function t(){e.MAX_FEATURE_COUNT_FOR_EXTENT=Ht,e.QUERY_STATISTICS_TIMEOUT=zt,e.QUERY_EXTENT_TIMEOUT=Qt}e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=t})(E||(E={})),E.reset();const z=B.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor"),M=50;let p=class extends at{constructor(e){super(e),this.type="heatmap",this.filterVisibility={filterChanged(){},dirty:!1},this.preferredUpdatePolicy=xe.ASYNC,this.dataExtent=null,this._renderGeometries=new Map,this._material=new se({}),this._materialWithField=new se({isAttributeDriven:!0}),this._fieldTotal=0,this._memoryFactor=1}initialize(){this._featureStore=new Ct({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const{colorBufferFloat:e,textureFloat:t}=this._renderView.capabilities,{floatBufferBlendWorking:i}=this._renderView.renderingContext.driverTest;if(t==null||!t.textureFloat)throw new C("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float.");if(e==null||!e.textureFloat)throw new C("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL2 extension EXT_color_buffer_float or the WebGL1 extension WEBGL_color_buffer_float.");if(e==null||!e.floatBlend)throw new C("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend.");if(!i)throw new C("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend. This device claims support for it, but does not actually support it.");this._memoryFactor=this.owner.view.resourceController.memoryController.memoryFactor,this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,s=>this._onLoadedFeaturesChange(s),D),this.updatingHandles.addWhen(()=>this._materialParameters,s=>this._forEachMaterial(r=>r.setParameters(s)),D),this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},nt),this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:s,numeric:r})=>{if(d(s)&&r){let a=0;this._featureStore.forEach(n=>{var u;a+=(u=n.attributes[s])!=null?u:0}),this._fieldTotal=a}else this._fieldTotal=this._featureStore.numFeatures},D),this.handles.add([S(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:s,field:r})=>{var a;s&&!r&&z.warn(`Heatmap renderer field '${s}' for layer '${(a=this.layer.title)!=null?a:this.layer.id}' not found`)}),S(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:s,numeric:r})=>{var a;d(s)&&!r&&z.warn(`Heatmap renderer field '${s.name}' for layer '${(a=this.layer.title)!=null?a:this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),this.owner.view.resourceController.memoryController.events.on("quality-changed",()=>{var s,r,a,n,u;this._memoryFactor=(s=(r=this.owner)==null||(a=r.view)==null||(n=a.resourceController)==null||(u=n.memoryController)==null?void 0:u.memoryFactor)!=null?s:1})])}destroy(){this._overlayRenderer.removeGeometries(Array.from(this._renderGeometries.values()),this.owner,U.Geometry.REMOVE),this._renderGeometries.clear(),this._material=re(this._material),this._materialWithField=re(this._materialWithField),this._featureStore.clear(),this._featureStore=null}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this.updatingHandles.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get displayFeatureLimit(){var e,t;const i=this._memoryFactor,s=(e=this.owner)==null||(t=e.view)==null?void 0:t.qualitySettings,r=s?Math.ceil(s.heatmap.maxTotalNumberOfFeatures*i):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:r*2,maximumNumberOfFeatures:r}}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get scaleVisibilitySuspended(){return!1}get usedMemory(){var e,t,i,s,r;const a=this.usedMemoryPerFeature*this._featureStore.numFeatures,{R32F:n}=(e=this._renderView)==null||(t=e.capabilities)==null?void 0:t.colorBufferFloat,u=n!=null?1:4,c=4,f=(i=Math.ceil(((s=this._overlayRenderer)==null||(r=s.overlays[0])==null?void 0:r.resolution)*this._densityMapPixelRatio))!=null?i:0;return f*f*u*c+a+(d(this._heatmapRenderer)?3*Math.min(this._heatmapRenderer.blurRadius,M):0)*u*c}get usedMemoryPerFeature(){if(this._featureStore.numFeatures===0)return 0;let e=0;this._featureStore.forEach(s=>e+=ot(s.attributes)),e/=this._featureStore.numFeatures;const t=vt(),i=6;return i*ae([0,0,0],t)+i*ae([0,0],t)+(this._heatmapRendererFieldIsNumeric?i*t:0)+e}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return{core:{visible:this._featureStore.numFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}get _overlayRenderer(){return this.owner.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return Q(this._overlayRenderer.spatialReference)}get _materialParameters(){return Y(R(R({},this._blurRadiusParameters),this._densityParameters),{colorRampData:this._colorRampData,pixelRatio:this._densityMapPixelRatio})}get _densityParameters(){const e=this._heatmapRenderer;return g(e)?null:{minDensity:e.minPixelIntensity,maxDensity:e.maxPixelIntensity,fieldTotal:this._fieldTotal}}get _blurRadiusParameters(){return O(this._heatmapRenderer,({referenceScale:e,blurRadius:t})=>({searchRadius:this._clampSearchRadius(t),resolutionForScale:e===0?0:lt(e,this.owner.view.spatialReference)}))}get _colorRampData(){return O(this._heatmapRenderer,e=>ut(e.colorStops))}get _densityMapPixelRatio(){var e,t,i;const s=this._memoryFactor;return((e=(t=this.owner)==null||(i=t.view)==null?void 0:i.qualitySettings.heatmap.pixelRatio)!=null?e:1)*Math.sqrt(s)}get _renderView(){return this.owner.view._stage.renderView}get _featuresArePoints(){return this.layer.geometryType==="point"}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const e=this.layer.renderer;return(e==null?void 0:e.type)==="heatmap"?e:null}get _heatmapRendererFieldName(){return O(this._heatmapRenderer,e=>e.field)}get _heatmapRendererField(){return O(this._heatmapRendererFieldName,e=>this.layer.fieldsIndex.get(e))}get _heatmapRendererFieldIsNumeric(){const e=this._heatmapRendererField;return!g(e)&&ht(e)}async whenGraphicBounds(){return null}computeAttachmentOrigin(){return null}highlight(){return fe}maskOccludee(){return fe}setObjectIdVisibility(){}async setup(){}_onLoadedFeaturesChange(e){if(!this._featuresArePoints)return;const{objectIdField:t}=this.layer;this._featureStore.removeManyById(e.removed.map(n=>T(n,t))),this._featureStore.addMany(e.added.map(n=>new dt(ne(new oe,n.geometry),n.attributes,O(n.centroid,u=>ne(new oe,u)),T(n,t))));const i=e.added,s=e.removed;this._fieldTotal+=this._computeFieldTotalChange(i,s);const r=ct(s,({uid:n})=>{const u=this._renderGeometries.get(n);return this._renderGeometries.delete(n),u}),a=i.map(n=>{const u=this._pointGraphicToRenderGeometry(n);return this._renderGeometries.set(n.uid,u),u});r.length>0&&this._overlayRenderer.removeGeometries(r,this.owner,U.Geometry.REMOVE),a.length>0&&this._overlayRenderer.addGeometries(a,this.owner,U.Geometry.ADD,!0),(a.length>0||r.length>0)&&this._renderView.requestRender()}_recreate(){if(!this._loadedPointGraphics)return;const e=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:e,removed:e})}_pointGraphicToRenderGeometry(e){const t=this._heatmapRendererFieldName,i=d(t)?this._materialWithField:this._material,s=Et();pt(e.geometry,s,this._overlaySpatialReference),s[2]=mt;const r=[[le.POSITION,{data:s,size:s.length}]],a=this._heatmapRendererFieldIsNumeric;var n;d(t)&&r.push([le.FEATUREATTRIBUTE,{data:[a&&(n=e.attributes[t])!=null?n:0],size:1}]);const u=new ft(new yt(r,null,gt.Point),i,{layerUid:this.layer.uid,graphicUid:e.uid});return _t(u.boundingSphere,s),u}_forEachMaterial(e){e(this._material),e(this._materialWithField)}_computeFieldTotalChange(e,t){if(g(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return e.length-t.length;const i=this._heatmapRendererFieldName,s=(r,a)=>{var n;return r+((n=a.attributes[i])!=null?n:0)};return e.reduce(s,0)-t.reduce(s,0)}_clampSearchRadius(e){return e>M&&z.warnOnce(`SceneView supports a maximum blurRadius of ${M} for HeatmapRenderer.`),Math.min(e,M)}};o([l()],p.prototype,"type",void 0),o([l({constructOnly:!0})],p.prototype,"owner",void 0),o([l()],p.prototype,"layer",null),o([l()],p.prototype,"featureStore",null),o([l()],p.prototype,"updating",null),o([l()],p.prototype,"updatingRemaining",null),o([l()],p.prototype,"suspendInfo",null),o([l()],p.prototype,"legendEnabled",null),o([l()],p.prototype,"filterVisibility",void 0),o([l()],p.prototype,"displayFeatureLimit",null),o([l()],p.prototype,"preferredUpdatePolicy",void 0),o([l()],p.prototype,"hasZ",null),o([l()],p.prototype,"hasM",null),o([l()],p.prototype,"dataExtent",void 0),o([l()],p.prototype,"_featureStore",void 0),o([l()],p.prototype,"_overlayRenderer",null),o([l()],p.prototype,"_overlaySpatialReference",null),o([l()],p.prototype,"_materialParameters",null),o([l()],p.prototype,"_densityParameters",null),o([l()],p.prototype,"_blurRadiusParameters",null),o([l()],p.prototype,"_colorRampData",null),o([l()],p.prototype,"_densityMapPixelRatio",null),o([l()],p.prototype,"_renderGeometries",void 0),o([l()],p.prototype,"_material",void 0),o([l()],p.prototype,"_materialWithField",void 0),o([l()],p.prototype,"_renderView",null),o([l()],p.prototype,"_featuresArePoints",null),o([l()],p.prototype,"_loadedPointGraphics",null),o([l()],p.prototype,"_heatmapRenderer",null),o([l()],p.prototype,"_heatmapRendererFieldName",null),o([l()],p.prototype,"_heatmapRendererField",null),o([l()],p.prototype,"_heatmapRendererFieldIsNumeric",null),o([l()],p.prototype,"_fieldTotal",void 0),o([l()],p.prototype,"_memoryFactor",void 0),p=o([V("esri.views.3d.layers.support.HeatmapFeatureProcessor")],p);const fe=Ft(),Kt=e=>{let t=class extends e{constructor(){super(...arguments),this.controller=null,this.updatePolicy=xe.SYNC,this.suspendResumeExtentMode="computed",this.slicePlaneEnabled=!1,this.drapeSourceType=xt.Features,this.fullExtentInLocalViewSpatialReference=null,this.suspendResumeExtent=null,this._controllerCreated=!1,this.clippingExtent=null,this.supportsHeightUnitConversion=!0,this.pendingController=null,this.queryEngine=null}initialize(){const i=this.layer;"isTable"in i&&i.isTable?this.addResolvingPromise(Promise.reject(new C("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:i}))):(this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add(()=>this.layer.renderer,s=>this._recreateProcessor(s),D),this.addResolvingPromise((async()=>{const s=await Rt(this);this.fullExtentInLocalViewSpatialReference=s,await this._initializeController()})()),this.updatingHandles.add(()=>this.updatePolicy,s=>this.processor.preferredUpdatePolicy=s),this.queryEngine=new bt({layerView:this,priority:Fe.FEATURE_QUERY_ENGINE}),this.notifyChange("updating"))}destroy(){this._destroyPendingController(),this.controller=w(this.controller),this._set("processor",w(this.processor)),this.queryEngine=w(this.queryEngine),this.loadedGraphics=null}_destroyPendingController(){this.pendingController=w(this.pendingController)}get legendEnabled(){var i;return this.canResume()&&((i=this.processor)==null?void 0:i.legendEnabled)}get graphics3DProcessor(){var i;return((i=this.processor)==null?void 0:i.type)==="graphics-3d"?this.processor:null}get heatmapProcessor(){var i;return((i=this.processor)==null?void 0:i.type)==="heatmap"?this.processor:null}getGraphicFromGraphicUid(i){var s;let r=null;return(s=this.loadedGraphics)==null||s.forEach(a=>{a.uid===i&&(r=Tt(a,this.layer))}),r}whenGraphicBounds(i,s){var r;return(r=this.processor)==null?void 0:r.whenGraphicBounds(i,s)}computeAttachmentOrigin(i,s){var r;return(r=this.processor)==null?void 0:r.computeAttachmentOrigin(i,s)}queryFeatures(i,s){return this.queryEngine.executeQuery(this._ensureQuery(i),P(s,"signal"))}queryObjectIds(i,s){return this.queryEngine.executeQueryForIds(this._ensureQuery(i),P(s,"signal"))}queryFeatureCount(i,s){return this.queryEngine.executeQueryForCount(this._ensureQuery(i),P(s,"signal"))}queryExtent(i,s){return this.queryEngine.executeQueryForExtent(this._ensureQuery(i),P(s,"signal"))}_ensureQuery(i){return g(i)?this.createQuery():k.from(i)}highlight(i){return this.processor.highlight(i,this.layer.objectIdField)}maskOccludee(i){return this.processor.maskOccludee(i)}canResume(){var i;return super.canResume()&&!((i=this.processor)!=null&&i.scaleVisibilitySuspended)}getSuspendInfo(){const i=super.getSuspendInfo();return this.processor?R(R({},i),this.processor.suspendInfo):i}isUpdating(){var i,s,r;return!(!this.processor||this.processor.destroyed)&&!(this._controllerCreated&&((i=this.controller)==null||!i.updating)&&(s=this.view)!=null&&(r=s.basemapTerrain)!=null&&r.ready&&!this.processor.updating)}async _initializeController(){const i=this.createController();this.pendingController=i,await i.when(),this._setControllerWhenInitialized(i)}async _setControllerWhenInitialized(i){try{await this.when()}catch{}this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()&&!this.destroyed?(await Ee(()=>{var s,r;return(s=this.view)==null||(r=s.basemapTerrain)==null?void 0:r.ready}),this.beforeSetController(i),this.pendingController=null,this.controller=i,this.loadedGraphics=i.graphics,this.notifyChange("updating")):this._destroyPendingController()}_updateClippingExtent(i){if(this.clippingExtent=i,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=i,!0}}async _validateGeometryType(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return Promise.reject(new C("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}}_recreateProcessor(i){var s,r;const a=(i==null?void 0:i.type)==="heatmap",n=((s=this.processor)==null?void 0:s.type)==="heatmap",u=this.processor;if(u&&a===n)return;const c=a?new p({owner:this}):new wt({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:f=>this._updateClippingExtent(f)});this._set("processor",c),u==null||u.destroy(),(r=this.queryEngine)==null||r.clear(),this.addResolvingPromise(c.setup())}_getResourceInfo(){var i,s;const r=this.controller instanceof y?this.controller:null;return R({displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:(i=r==null?void 0:r.maximumNumberOfFeatures)!=null?i:-1,totalNumberOfFeatures:(s=r==null?void 0:r.serviceDataCount)!=null?s:-1,nodes:0},this.processor.performanceInfo)}get performanceInfo(){return this._getResourceInfo()}};return o([l()],t.prototype,"loadedGraphics",void 0),o([l()],t.prototype,"suspended",void 0),o([l({readOnly:!0})],t.prototype,"legendEnabled",null),o([l()],t.prototype,"updating",void 0),o([l()],t.prototype,"controller",void 0),o([l()],t.prototype,"processor",void 0),o([l({readOnly:!0})],t.prototype,"updatePolicy",void 0),o([l({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),o([l({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),o([l({readOnly:!0})],t.prototype,"suspendInfo",void 0),o([l()],t.prototype,"graphics3DProcessor",null),o([l()],t.prototype,"heatmapProcessor",null),t=o([V("esri.views.3d.layers.FeatureLikeLayerView3D")],t),t};export{Zt as A,Kt as E,y as O};
